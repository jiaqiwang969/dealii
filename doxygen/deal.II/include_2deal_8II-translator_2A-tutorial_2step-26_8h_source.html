<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="canonical" href="https://www.dealii.org/current/doxygen/deal.II/include_2deal_8II-translator_2A-tutorial_2step-26_8h_source.html" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The deal.II Library: include/deal.II-translator/A-tutorial/step-26.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link rel="SHORTCUT ICON" href="deal.ico"></link>
<script type="text/javascript" src="custom.js"></script>
<meta name="author" content="The deal.II Authors <authors@dealii.org>"></meta>
<meta name="copyright" content="Copyright (C) 1998 - 2021 by the deal.II authors"></meta>
<meta name="deal.II-version" content="10.0.0-pre"></meta>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo200.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Reference documentation for deal.II version 10.0.0-pre</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!--Extra macros for MathJax:-->
<div style="display:none">
\(\newcommand{\dealvcentcolon}{\mathrel{\mathop{:}}}\)
\(\newcommand{\dealcoloneq}{\dealvcentcolon\mathrel{\mkern-1.2mu}=}\)
\(\newcommand{\jump}[1]{\left[\!\left[ #1 \right]\!\right]}\)
\(\newcommand{\average}[1]{\left\{\!\left\{ #1 \right\}\!\right\}}\)
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="dir_386d89ad50a3909c2af5a93b48d2c3ff.html">deal.II-translator</a></li><li class="navelem"><a class="el" href="dir_7812fe2bbb6fb6db2d3962cae8700ca0.html">A-tutorial</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">step-26.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="include_2deal_8II-translator_2A-tutorial_2step-26_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160; ,</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                                     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component) <span class="keyword">const</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;   {</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;     (void)component;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;     <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component == 0, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 1));</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;     <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;   }</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;* </div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160; </div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;* </div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;* </div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;ThecodeHeatEquationcodeimplementation&quot;</span>&gt;&lt;/a&gt;  &lt;h3&gt;The &lt;code&gt;HeatEquation&lt;/code&gt; implementation&lt;/h3&gt;   </div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;*   It is time now <span class="keywordflow">for</span> the implementation of the main <span class="keyword">class</span>. Let<span class="stringliteral">&#39;s start with the constructor which selects a linear element, a time step constant at 1/500 (remember that one period of the source on the right hand side was set to 0.2 above, so we resolve each period with 100 time steps) and chooses the Crank Nicolson method by setting   @f$\theta=1/2@f$  .</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="stringliteral">   template &lt;int dim&gt;</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="stringliteral">   HeatEquation&lt;dim&gt;::HeatEquation()</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="stringliteral">     : fe(1)</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="stringliteral">     , dof_handler(triangulation)</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="stringliteral">     , time_step(1. / 500)</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="stringliteral">     , theta(0.5)</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="stringliteral">   {}</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="stringliteral">*   &lt;a name=&quot;codeHeatEquationsetup_systemcode&quot;&gt;&lt;/a&gt;  &lt;h4&gt;&lt;code&gt;HeatEquation::setup_system&lt;/code&gt;&lt;/h4&gt;   </span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="stringliteral">*   The next function is the one that sets up the DoFHandler object, computes the constraints, and sets the linear algebra objects to their correct sizes. We also compute the mass and Laplace matrix here by simply calling two functions in the library.   </span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="stringliteral">*   Note that we do not take the hanging node constraints into account when assembling the matrices (both functions have an AffineConstraints argument that defaults to an empty object). This is because we are going to condense the constraints in run() after combining the matrices for the current time-step.</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="stringliteral">   template &lt;int dim&gt;</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="stringliteral">   void HeatEquation&lt;dim&gt;::setup_system()</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="stringliteral">   {</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="stringliteral">     dof_handler.distribute_dofs(fe);</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="stringliteral">     std::cout &lt;&lt; std::endl</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="stringliteral">               &lt;&lt; &quot;===========================================&quot; &lt;&lt; std::endl</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="stringliteral">               &lt;&lt; &quot;Number of active cells: &quot; &lt;&lt; triangulation.n_active_cells()</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="stringliteral">               &lt;&lt; std::endl</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="stringliteral">               &lt;&lt; &quot;Number of degrees of freedom: &quot; &lt;&lt; dof_handler.n_dofs()</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="stringliteral">               &lt;&lt; std::endl</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="stringliteral">               &lt;&lt; std::endl;</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="stringliteral">     constraints.clear();</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="stringliteral">     DoFTools::make_hanging_node_constraints(dof_handler, constraints);</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="stringliteral">     constraints.close();</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="stringliteral">     DynamicSparsityPattern dsp(dof_handler.n_dofs());</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="stringliteral">     DoFTools::make_sparsity_pattern(dof_handler,</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="stringliteral">                                     dsp,</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="stringliteral">                                     constraints,</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="stringliteral">                                      /*keep_constrained_dofs = */  true);</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="stringliteral">     sparsity_pattern.copy_from(dsp);</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="stringliteral">     mass_matrix.reinit(sparsity_pattern);</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="stringliteral">     laplace_matrix.reinit(sparsity_pattern);</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="stringliteral">     system_matrix.reinit(sparsity_pattern);</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="stringliteral">     MatrixCreator::create_mass_matrix(dof_handler,</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="stringliteral">                                       QGauss&lt;dim&gt;(fe.degree + 1),</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="stringliteral">                                       mass_matrix);</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="stringliteral">     MatrixCreator::create_laplace_matrix(dof_handler,</span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="stringliteral">                                          QGauss&lt;dim&gt;(fe.degree + 1),</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="stringliteral">                                          laplace_matrix);</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="stringliteral">     solution.reinit(dof_handler.n_dofs());</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="stringliteral">     old_solution.reinit(dof_handler.n_dofs());</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="stringliteral">     system_rhs.reinit(dof_handler.n_dofs());</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="stringliteral">   }</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="stringliteral">*   &lt;a name=&quot;codeHeatEquationsolve_time_stepcode&quot;&gt;&lt;/a&gt;  &lt;h4&gt;&lt;code&gt;HeatEquation::solve_time_step&lt;/code&gt;&lt;/h4&gt;   </span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="stringliteral">*   The next function is the one that solves the actual linear system for a single time step. There is nothing surprising here:</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="stringliteral">   template &lt;int dim&gt;</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="stringliteral">   void HeatEquation&lt;dim&gt;::solve_time_step()</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="stringliteral">   {</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="stringliteral">     SolverControl            solver_control(1000, 1e-8 system_rhs.l2_norm());</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="stringliteral">     SolverCG&lt;Vector&lt;double&gt;&gt; cg(solver_control);</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="stringliteral">     PreconditionSSOR&lt;SparseMatrix&lt;double&gt;&gt; preconditioner;</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="stringliteral">     preconditioner.initialize(system_matrix, 1.0);</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="stringliteral">     cg.solve(system_matrix, solution, system_rhs, preconditioner);</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="stringliteral">     constraints.distribute(solution);</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="stringliteral">     std::cout &lt;&lt; &quot;     &quot; &lt;&lt; solver_control.last_step() &lt;&lt; &quot; CG iterations.&quot;</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="stringliteral">               &lt;&lt; std::endl;</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="stringliteral">   }</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="stringliteral">*   &lt;a name=&quot;codeHeatEquationoutput_resultscode&quot;&gt;&lt;/a&gt;  &lt;h4&gt;&lt;code&gt;HeatEquation::output_results&lt;/code&gt;&lt;/h4&gt;   </span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="stringliteral">*   Neither is there anything new in generating graphical output other than the fact that we tell the DataOut object what the current time and time step number is, so that this can be written into the output file :</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="stringliteral">   template &lt;int dim&gt;</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="stringliteral">   void HeatEquation&lt;dim&gt;::output_results() const</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="stringliteral">   {</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="stringliteral">     DataOut&lt;dim&gt; data_out;</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="stringliteral">     data_out.attach_dof_handler(dof_handler);</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="stringliteral">     data_out.add_data_vector(solution, &quot;U&quot;);</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="stringliteral">     data_out.build_patches();</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="stringliteral">     data_out.set_flags(DataOutBase::VtkFlags(time, timestep_number));</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="stringliteral">     const std::string filename =</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="stringliteral">       &quot;solution-&quot; + Utilities::int_to_string(timestep_number, 3) + &quot;.vtk&quot;;</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="stringliteral">     std::ofstream output(filename);</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="stringliteral">     data_out.write_vtk(output);</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="stringliteral">   }</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="stringliteral">*   &lt;a name=&quot;codeHeatEquationrefine_meshcode&quot;&gt;&lt;/a&gt;  &lt;h4&gt;&lt;code&gt;HeatEquation::refine_mesh&lt;/code&gt;&lt;/h4&gt;   </span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="stringliteral">*   This function is the interesting part of the program. It takes care of the adaptive mesh refinement. The three tasks this function performs is to first find out which cells to refine/coarsen, then to actually do the refinement and eventually transfer the solution vectors between the two different grids. The first task is simply achieved by using the well-established Kelly error estimator on the solution. The second task is to actually do the remeshing. That involves only basic functions as well, such as the   &lt;code&gt;refine_and_coarsen_fixed_fraction&lt;/code&gt;   that refines those cells with the largest estimated error that together make up 60 per cent of the error, and coarsens those cells with the smallest error that make up for a combined 40 per cent of the error. Note that for problems such as the current one where the areas where something is going on are shifting around, we want to aggressively coarsen so that we can move cells around to where it is necessary.   </span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="stringliteral">*   As already discussed in the introduction, too small a mesh leads to too small a time step, whereas too large a mesh leads to too little resolution. Consequently, after the first two steps, we have two loops that limit refinement and coarsening to an allowable range of cells:</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;<span class="stringliteral">   template &lt;int dim&gt;</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="stringliteral">   void HeatEquation&lt;dim&gt;::refine_mesh(const unsigned int min_grid_level,</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="stringliteral">                                       const unsigned int max_grid_level)</span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="stringliteral">   {</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="stringliteral">     Vector&lt;float&gt; estimated_error_per_cell(triangulation.n_active_cells());</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="stringliteral">     KellyErrorEstimator&lt;dim&gt;::estimate(</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="stringliteral">       dof_handler,</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="stringliteral">       QGauss&lt;dim</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="stringliteral">- 1&gt;(fe.degree + 1),</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="stringliteral">       std::map&lt;types::boundary_id, const Function&lt;dim&gt;&gt;(),</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="stringliteral">       solution,</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="stringliteral">       estimated_error_per_cell);</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="stringliteral">     GridRefinement::refine_and_coarsen_fixed_fraction(triangulation,</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="stringliteral">                                                       estimated_error_per_cell,</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="stringliteral">                                                       0.6,</span></div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="stringliteral">                                                       0.4);</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="stringliteral">     if (triangulation.n_levels() &gt; max_grid_level)</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="stringliteral">       for (const auto &amp;cell :</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;<span class="stringliteral">            triangulation.active_cell_iterators_on_level(max_grid_level))</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="stringliteral">         cell-&gt;clear_refine_flag();</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="stringliteral">     for (const auto &amp;cell :</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="stringliteral">          triangulation.active_cell_iterators_on_level(min_grid_level))</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="stringliteral">       cell-&gt;clear_coarsen_flag();</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="stringliteral">*  These two loops above are slightly different but this is easily explained. In the first loop, instead of calling   &lt;code&gt;triangulation.end()&lt;/code&gt;   we may as well have called   &lt;code&gt;triangulation.end_active(max_grid_level)&lt;/code&gt;  . The two calls should yield the same iterator since iterators are sorted by level and there should not be any cells on levels higher than on level   &lt;code&gt;max_grid_level&lt;/code&gt;  . In fact, this very piece of code makes sure that this is the case.</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="stringliteral">*  As part of mesh refinement we need to transfer the solution vectors from the old mesh to the new one. To this end we use the SolutionTransfer class and we have to prepare the solution vectors that should be transferred to the new grid (we will lose the old grid once we have done the refinement so the transfer has to happen concurrently with refinement). At the point where we call this function, we will have just computed the solution, so we no longer need the old_solution variable (it will be overwritten by the solution just after the mesh may have been refined, i.e., at the end of the time step; see below). In other words, we only need the one solution vector, and we copy it to a temporary object where it is safe from being reset when we further down below call   &lt;code&gt;setup_system()&lt;/code&gt;  .     </span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="stringliteral">*   Consequently, we initialize a SolutionTransfer object by attaching it to the old DoF handler. We then prepare the triangulation and the data vector for refinement (in this order).</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="stringliteral">     SolutionTransfer&lt;dim&gt; solution_trans(dof_handler);</span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="stringliteral">     Vector&lt;double&gt; previous_solution;</span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="stringliteral">     previous_solution = solution;</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="stringliteral">     triangulation.prepare_coarsening_and_refinement();</span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="stringliteral">     solution_trans.prepare_for_coarsening_and_refinement(previous_solution);</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="stringliteral">*  Now everything is ready, so do the refinement and recreate the DoF structure on the new grid, and finally initialize the matrix structures and the new vectors in the   &lt;code&gt;setup_system&lt;/code&gt;   function. Next, we actually perform the interpolation of the solution from old to new grid. The final step is to apply the hanging node constraints to the solution vector, i.e., to make sure that the values of degrees of freedom located on hanging nodes are so that the solution is continuous. This is necessary since SolutionTransfer only operates on cells locally, without regard to the neighborhood.</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="stringliteral">     triangulation.execute_coarsening_and_refinement();</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;<span class="stringliteral">     setup_system();</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;<span class="stringliteral">     solution_trans.interpolate(previous_solution, solution);</span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="stringliteral">     constraints.distribute(solution);</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="stringliteral">   }</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="stringliteral">*   &lt;a name=&quot;codeHeatEquationruncode&quot;&gt;&lt;/a&gt;  &lt;h4&gt;&lt;code&gt;HeatEquation::run&lt;/code&gt;&lt;/h4&gt;   </span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="stringliteral">*   This is the main driver of the program, where we loop over all time steps. At the top of the function, we set the number of initial global mesh refinements and the number of initial cycles of adaptive mesh refinement by repeating the first time step a few times. Then we create a mesh, initialize the various objects we will work with, set a label for where we should start when re-running the first time step, and interpolate the initial solution onto out mesh (we choose the zero function here, which of course we could do in a simpler way by just setting the solution vector to zero). We also output the initial time step once.   </span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="stringliteral">*  </span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="stringliteral">*   @note   If you&#39;</span>re an experienced programmer, you may be surprised that we use a   &lt;code&gt;<span class="keywordflow">goto</span>&lt;/code&gt;   statement in <span class="keyword">this</span> piece of code!   &lt;code&gt;<span class="keywordflow">goto</span>&lt;/code&gt;   statements are not particularly well liked any more since Edsgar Dijkstra, <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> of the greats of computer science, wrote a letter in 1968 called <span class="stringliteral">&quot;Go To Statement considered harmful&quot;</span> (see &lt;a href=<span class="stringliteral">&quot;http://en.wikipedia.org/wiki/Considered_harmful&quot;</span>&gt;here&lt;/a&gt;). The author of <span class="keyword">this</span> code subscribes to <span class="keyword">this</span> notion whole-heartedly:   &lt;code&gt;goto&lt;/code&gt;   is hard to understand. In fact, deal.II contains virtually no occurrences: excluding code that was essentially transcribed from books and not counting duplicated code pieces, there are 3 locations in about 600,000 lines of code at the time <span class="keyword">this</span> note is written; we also use it in 4 tutorial programs, in exactly the same context as here. Instead of trying to justify the occurrence here, let<span class="stringliteral">&#39;s first look at the code and we&#39;</span>ll come back to the issue at the <a class="code" href="namespaceTrilinosWrappers_1_1internal.html#aee42c8e3004e2e81eac3c3356d3ec46b">end</a> of <span class="keyword">function</span>.</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;* </div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;* </div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;* @code</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;   template &lt;int dim&gt;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;   <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">HeatEquation&lt;dim&gt;::run</a>()</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;   {</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> initial_global_refinement       = 2;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_adaptive_pre_refinement_steps = 4;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;* </div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;     <a class="code" href="namespaceGridGenerator.html#a3b2a4ad8296c2b72a11d23b5969e8cc0">GridGenerator::hyper_L</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>);</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;     <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.refine_global(initial_global_refinement);</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;* </div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;     setup_system();</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;* </div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pre_refinement_step = 0;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;* </div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;     <a class="code" href="classVector.html">Vector&lt;double&gt;</a> tmp;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;     <a class="code" href="classVector.html">Vector&lt;double&gt;</a> forcing_terms;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;* </div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;   start_time_iteration:</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;* </div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;     time            = 0.0;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;     timestep_number = 0;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;* </div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;     tmp.<a class="code" href="classVector.html#ac4a4dbef7dd65ef8ad35ae56b57d7c05">reinit</a>(solution.size());</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;     forcing_terms.<a class="code" href="classVector.html#ac4a4dbef7dd65ef8ad35ae56b57d7c05">reinit</a>(solution.size());</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;* </div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160; </div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;     <a class="code" href="namespaceVectorTools.html#a761f008bdeb7d94a69205ae824deefad">VectorTools::interpolate</a>(dof_handler,</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                              <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(),</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                              old_solution);</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;     solution = old_solution;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;* </div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;     output_results();</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;* </div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;* </div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;*  Then we start the main <a class="code" href="group__MeshWorker.html#gad10f528ab87f39fbb0531d24f238b2f3">loop</a> until the computed time exceeds our <a class="code" href="namespaceTrilinosWrappers_1_1internal.html#aee42c8e3004e2e81eac3c3356d3ec46b">end</a> time of 0.5. The <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> task is to build the right hand side of the linear system we need to solve in each time step. Recall that it contains the term   @f$MU^{n-1}-(1-\theta)k_n AU^{n-1}@f$  . We put these terms into the variable system_rhs, with the help of a temporary vector:</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;* </div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;* </div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;* @code</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;     <span class="keywordflow">while</span> (time &lt;= 0.5)</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;       {</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;         time += time_step;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;         ++timestep_number;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;* </div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;         std::cout &lt;&lt; <span class="stringliteral">&quot;Time step &quot;</span> &lt;&lt; timestep_number &lt;&lt; <span class="stringliteral">&quot; at t=&quot;</span> &lt;&lt; time</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                   &lt;&lt; std::endl;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;* </div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;         <a class="code" href="namespaceLocalIntegrators_1_1L2.html#a1c15243765304a803037988b5561627d">mass_matrix</a>.vmult(system_rhs, old_solution);</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;* </div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;         laplace_matrix.vmult(tmp, old_solution);</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;         system_rhs.add(-(1</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;* </div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;- theta) time_step, tmp);</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;* </div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;* </div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;*  The <a class="code" href="grid__out_8cc.html#a2cc229a4f1ffc75e83ed269d5f725729">second</a> piece is to compute the contributions of the source terms. This corresponds to the term   @f$k_n</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160; \left[ (1-\theta)<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">F</a>^{n-1} + \theta <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">F</a>^n \right]@f$  . The following code calls   <a class="code" href="namespaceVectorTools.html#a6e325333a138893e181da47f29ac680a">VectorTools::create_right_hand_side</a>   to compute the vectors   @f$F@f$  , where we <span class="keyword">set</span> the time of the right hand side (source) <span class="keyword">function</span> before we evaluate it. The result of <span class="keyword">this</span> all ends up in the forcing_terms variable:</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;* </div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;* </div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;* @code</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;         RightHandSide&lt;dim&gt; rhs_function;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;         rhs_function.set_time(time);</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;         <a class="code" href="namespaceVectorTools.html#a6e325333a138893e181da47f29ac680a">VectorTools::create_right_hand_side</a>(dof_handler,</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                                             <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(fe.degree + 1),</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                                             rhs_function,</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;                                             tmp);</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;         forcing_terms = tmp;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;         forcing_terms= time_step theta;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;* </div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;         rhs_function.set_time(time</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;* </div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;- time_step);</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;         <a class="code" href="namespaceVectorTools.html#a6e325333a138893e181da47f29ac680a">VectorTools::create_right_hand_side</a>(dof_handler,</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                                             <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(fe.degree + 1),</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                                             rhs_function,</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                                             tmp);</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;* </div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;         forcing_terms.<a class="code" href="classVector.html#a10b0336c485e36c7b4b105dd2a926002">add</a>(time_step (1</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;* </div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;- theta), tmp);</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;* </div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;* </div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;*  Next, we add the forcing terms to the ones that come from the time stepping, and also build the <a class="code" href="namespaceLAPACKSupport.html#a1a9009db0d9a77923a7031b549b9b638a5bc7c54a9c20485772672825c6a73003">matrix</a>   @f$M+k_n\theta <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>@f$   that we have to <a class="code" href="classSymmetricTensor.html#a33cd1a6c91c24a5ca34dfbc43c338d1c">invert</a> in each time step. The <span class="keyword">final</span> piece of these operations is to eliminate hanging node constrained degrees of freedom from the linear system:</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;* </div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;* </div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;* @code</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;         system_rhs += forcing_terms;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;* </div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;         system_matrix.copy_from(<a class="code" href="namespaceLocalIntegrators_1_1L2.html#a1c15243765304a803037988b5561627d">mass_matrix</a>);</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;         system_matrix.<a class="code" href="classVector.html#a10b0336c485e36c7b4b105dd2a926002">add</a>(theta time_step, laplace_matrix);</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;* </div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;         constraints.condense(system_matrix, system_rhs);</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;* </div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;* </div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;*  There is <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> more operation we need to <span class="keywordflow">do</span> before we can solve it: boundary <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a>. To <span class="keyword">this</span> <a class="code" href="namespaceTrilinosWrappers_1_1internal.html#aee42c8e3004e2e81eac3c3356d3ec46b">end</a>, we create a boundary <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a> object, <span class="keyword">set</span> the proper time to the <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> of the current time step, and evaluate it as we have done many times before. The result is used to also <span class="keyword">set</span> the correct boundary <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a> in the linear system:</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;* </div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;* </div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;* @code</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;         {</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;           BoundaryValues&lt;dim&gt; boundary_values_function;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;           boundary_values_function.set_time(time);</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;* </div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;           std::map&lt;types::global_dof_index, double&gt; boundary_values;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;           <a class="code" href="namespaceVectorTools.html#af27ac28c698a9ed0199faed50a204538">VectorTools::interpolate_boundary_values</a>(dof_handler,</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;                                                    0,</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;                                                    boundary_values_function,</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                                                    boundary_values);</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;* </div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;           <a class="code" href="namespaceMatrixTools.html#a9ad0eb7a8662628534586716748d62fb">MatrixTools::apply_boundary_values</a>(boundary_values,</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                                              system_matrix,</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                                              solution,</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                                              system_rhs);</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;         }</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;* </div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;* </div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;*  With <span class="keyword">this</span> out of the way, all we have to <span class="keywordflow">do</span> is solve the system, generate graphical data, and...</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;* </div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;* </div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;* @code</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;         solve_time_step();</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;* </div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;         output_results();</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;* </div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;* </div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;*  ...take care of mesh refinement. Here, what we want to <span class="keywordflow">do</span> is (i) <a class="code" href="namespaceGridRefinement.html#a1cf30058b31ce7f9b389e8310bb9fc54">refine</a> the requested number of times at the very beginning of the solution procedure, after which we jump to the top to restart the time iteration, (ii) <a class="code" href="namespaceGridRefinement.html#a1cf30058b31ce7f9b389e8310bb9fc54">refine</a> every fifth time step after that.         </div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;*   The time <a class="code" href="group__MeshWorker.html#gad10f528ab87f39fbb0531d24f238b2f3">loop</a> and, indeed, the main part of the program ends with starting into the next time step by setting old_solution to the solution we have just computed.</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;* </div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;* </div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;* @code</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;         if ((timestep_number == 1) &amp;&amp;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;             (pre_refinement_step &lt; n_adaptive_pre_refinement_steps))</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;           {</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;             refine_mesh(initial_global_refinement,</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;                         initial_global_refinement +</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;                           n_adaptive_pre_refinement_steps);</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;             ++pre_refinement_step;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;* </div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;             tmp.<a class="code" href="classVector.html#ac4a4dbef7dd65ef8ad35ae56b57d7c05">reinit</a>(solution.size());</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;             forcing_terms.<a class="code" href="classVector.html#ac4a4dbef7dd65ef8ad35ae56b57d7c05">reinit</a>(solution.size());</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;* </div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;             std::cout &lt;&lt; std::endl;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;* </div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;             <span class="keywordflow">goto</span> start_time_iteration;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;           }</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((timestep_number &gt; 0) &amp;&amp; (timestep_number % 5 == 0))</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;           {</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;             refine_mesh(initial_global_refinement,</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;                         initial_global_refinement +</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                           n_adaptive_pre_refinement_steps);</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;             tmp.<a class="code" href="classVector.html#ac4a4dbef7dd65ef8ad35ae56b57d7c05">reinit</a>(solution.size());</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;             forcing_terms.<a class="code" href="classVector.html#ac4a4dbef7dd65ef8ad35ae56b57d7c05">reinit</a>(solution.size());</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;           }</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;* </div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;         old_solution = solution;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;       }</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;   }</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160; } <span class="comment">// namespace Step26</span></div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;* </div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;*  Now that you have seen what the <span class="keyword">function</span> does, let us come back to the issue of the   &lt;code&gt;<span class="keywordflow">goto</span>&lt;/code&gt;  . In essence, what the code does is something like <span class="keyword">this</span>:   &lt;div <span class="keyword">class</span>=CodeFragmentInTutorialComment&gt;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;* </div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;* </div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;@code</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;   <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a> ()</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;   {</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;     initialize;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;   start_time_iteration:</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;     <span class="keywordflow">for</span> (timestep=1...)</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;     {</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        solve timestep;</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        <span class="keywordflow">if</span> (timestep==1 &amp;&amp; not happy with the result)</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;        {</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;          adjust some data structures;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;          <span class="keywordflow">goto</span> start_time_iteration; <span class="comment">// simply try again</span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        }</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        postprocess;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;     }</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;   }</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;* </div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160; &lt;/div&gt;   Here, the condition <span class="stringliteral">&quot;happy with the result&quot;</span> is whether we<span class="stringliteral">&#39;d like to keep the current mesh or would rather refine the mesh and start over on the new mesh. We could of course replace the use of the   &lt;code&gt;goto&lt;/code&gt;   by the following:   &lt;div class=CodeFragmentInTutorialComment&gt;</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="stringliteral">@code</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="stringliteral">   void run ()</span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="stringliteral">   {</span></div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="stringliteral">     initialize;</span></div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="stringliteral">     while (true)</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="stringliteral">     {</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="stringliteral">        solve timestep;</span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="stringliteral">        if (not happy with the result)</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="stringliteral">           adjust some data structures;</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="stringliteral">        else</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="stringliteral">           break;</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="stringliteral">     }</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="stringliteral">     postprocess;</span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="stringliteral">     for (timestep=2...)</span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="stringliteral">     {</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="stringliteral">        solve timestep;</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="stringliteral">        postprocess;</span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="stringliteral">     }</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="stringliteral">   }</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="stringliteral"> &lt;/div&gt;   This has the advantage of getting rid of the   &lt;code&gt;goto&lt;/code&gt;   but the disadvantage of having to duplicate the code that implements the &quot;solve timestep&quot; and &quot;postprocess&quot; operations in two different places. This could be countered by putting these parts of the code (sizable chunks in the actual implementation above) into their own functions, but a   &lt;code&gt;while(true)&lt;/code&gt;   loop with a   &lt;code&gt;break&lt;/code&gt;   statement is not really all that much easier to read or understand than a   &lt;code&gt;goto&lt;/code&gt;  .</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="stringliteral">*  In the end, one might simply agree that &lt;i&gt;in general&lt;/i&gt;   &lt;code&gt;goto&lt;/code&gt;   statements are a bad idea but be pragmatic and state that there may be occasions where they can help avoid code duplication and awkward control flow. This may be one of these places, and it matches the position Steve McConnell takes in his excellent book &quot;Code Complete&quot;   @cite CodeComplete   about good programming practices (see the mention of this book in the introduction of   @ref step_1 &quot;step-1&quot;  ) that spends a surprising ten pages on the question of   &lt;code&gt;goto&lt;/code&gt;   in general.</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="stringliteral">*  </span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="stringliteral">*  </span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="stringliteral">*  &lt;a name=&quot;Thecodemaincodefunction&quot;&gt;&lt;/a&gt;  &lt;h3&gt;The &lt;code&gt;main&lt;/code&gt; function&lt;/h3&gt;</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;<span class="stringliteral">*  Having made it this far,  there is, again, nothing much to discuss for the main function of this program: it looks like all such functions since   @ref step_6 &quot;step-6&quot;  .</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="stringliteral"> int main()</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="stringliteral"> {</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="stringliteral">   try</span></div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="stringliteral">     {</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="stringliteral">       using namespace Step26;</span></div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="stringliteral">       HeatEquation&lt;2&gt; heat_equation_solver;</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="stringliteral">       heat_equation_solver.run();</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="stringliteral">     }</span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="stringliteral">   catch (std::exception &amp;exc)</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="stringliteral">     {</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="stringliteral">       std::cerr &lt;&lt; std::endl</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="stringliteral">                 &lt;&lt; std::endl</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="stringliteral">                 &lt;&lt; &quot;----------------------------------------------------&quot;</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="stringliteral">                 &lt;&lt; std::endl;</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="stringliteral">       std::cerr &lt;&lt; &quot;Exception on processing: &quot; &lt;&lt; std::endl</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="stringliteral">                 &lt;&lt; exc.what() &lt;&lt; std::endl</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="stringliteral">                 &lt;&lt; &quot;Aborting!&quot; &lt;&lt; std::endl</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="stringliteral">                 &lt;&lt; &quot;----------------------------------------------------&quot;</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="stringliteral">                 &lt;&lt; std::endl;</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="stringliteral">       return 1;</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="stringliteral">     }</span></div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="stringliteral">   catch (...)</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="stringliteral">     {</span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="stringliteral">       std::cerr &lt;&lt; std::endl</span></div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="stringliteral">                 &lt;&lt; std::endl</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="stringliteral">                 &lt;&lt; &quot;----------------------------------------------------&quot;</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="stringliteral">                 &lt;&lt; std::endl;</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="stringliteral">       std::cerr &lt;&lt; &quot;Unknown exception!&quot; &lt;&lt; std::endl</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="stringliteral">                 &lt;&lt; &quot;Aborting!&quot; &lt;&lt; std::endl</span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="stringliteral">                 &lt;&lt; &quot;----------------------------------------------------&quot;</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="stringliteral">                 &lt;&lt; std::endl;</span></div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="stringliteral">       return 1;</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="stringliteral">     }</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="stringliteral">   return 0;</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="stringliteral"> }</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="stringliteral">* &lt;a name=&quot;Results&quot;&gt;&lt;/a&gt;&lt;h1&gt;Results&lt;/h1&gt;</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="stringliteral">* As in many of the tutorials, the actual output of the program matters lessthan how we arrived there. Nonetheless, here it is:</span></div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;<span class="stringliteral">===========================================</span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="stringliteral">Number of active cells: 48</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="stringliteral">Number of degrees of freedom: 65</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="stringliteral">Time step 1 at t=0.002</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="stringliteral">     7 CG iterations.</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;<span class="stringliteral">===========================================</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;<span class="stringliteral">Number of active cells: 60</span></div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;<span class="stringliteral">Number of degrees of freedom: 81</span></div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;<span class="stringliteral">Time step 1 at t=0.002</span></div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="stringliteral">     7 CG iterations.</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;<span class="stringliteral">===========================================</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<span class="stringliteral">Number of active cells: 105</span></div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="stringliteral">Number of degrees of freedom: 136</span></div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;<span class="stringliteral">Time step 1 at t=0.002</span></div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;<span class="stringliteral">     7 CG iterations.</span></div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<span class="stringliteral">[...]</span></div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="stringliteral">Time step 249 at t=0.498</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="stringliteral">     13 CG iterations.</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="stringliteral">Time step 250 at t=0.5</span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="stringliteral">     14 CG iterations.</span></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="stringliteral">===========================================</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="stringliteral">Number of active cells: 1803</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="stringliteral">Number of degrees of freedom: 2109</span></div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="stringliteral">@endcode</span></div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="stringliteral">* Maybe of more interest is a visualization of the solution and the mesh on whichit was computed:</span></div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;<span class="stringliteral">*   &lt;img src=&quot;https://www.dealii.org/images/steps/developer/step-26.movie.gif&quot; alt=&quot;Animation of the solution of step 26.&quot;&gt;  </span></div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="stringliteral">* The movie shows how the two sources switch on and off and how the mesh reactsto this. It is quite obvious that the mesh as is is probably not the best wecould come up with. We&#39;</span>ll <span class="keyword">get</span> back to <span class="keyword">this</span> in the next section.</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;* </div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;* &lt;a name=<span class="stringliteral">&quot;extensions&quot;</span>&gt;&lt;/a&gt;&lt;a name=<span class="stringliteral">&quot;Possibilitiesforextensions&quot;</span>&gt;&lt;/a&gt;&lt;h3&gt;Possibilities <span class="keywordflow">for</span> extensions&lt;/h3&gt;</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;* </div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;* There are at least two areas where <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> can improve <span class="keyword">this</span> program significantly:adaptive time stepping and a better choice of the mesh.</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;* &lt;a name=<span class="stringliteral">&quot;Adaptivetimestepping&quot;</span>&gt;&lt;/a&gt;&lt;h4&gt;Adaptive time stepping&lt;/h4&gt;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;* </div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;* Having chosen an implicit time stepping scheme, we are not bound by anyCFL-like condition on the time step. Furthermore, because the time scales onwhich change happens on a given cell in the heat equation are not bound to thecells <a class="code" href="namespaceGridTools.html#acd5ccc543d561cfb086b571d1f7818cb">diameter</a> (unlike the <span class="keywordflow">case</span> with the wave equation, where we had a fixedspeed of information transport that couples the temporal and spatial scales),we can choose the time step as we please. Or, better, choose it as we deemnecessary <span class="keywordflow">for</span> accuracy.</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;* Looking at the solution, it is clear that the action does not happen uniformlyover time: a lot is changing around the time we <span class="keywordflow">switch</span> on a source, thingsbecome less dramatic once a source is on <span class="keywordflow">for</span> a little <span class="keywordflow">while</span>, and we enter along phase of decline when both sources are off. During these times, we couldsurely <span class="keyword">get</span> away with a larger time step than before without sacrificing toomuch accuracy.</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;* The literature has many suggestions on how to choose the time step sizeadaptively. Much can be learned, <span class="keywordflow">for</span> example, from the way ODE solvers choosetheir time steps. One can also be inspired by a posteriori error estimatorsthat can, ideally, be written in a way that the consist of a temporal and aspatial contribution to the overall error. If the temporal <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> is too large,we should choose a smaller time step. Ideas in <span class="keyword">this</span> direction can be found,<span class="keywordflow">for</span> example, in the PhD thesis of a former principal developer of deal.II,Ralf Hartmann, published by the University of Heidelberg, Germany, in 2002.</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;* </div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;* &lt;a name=<span class="stringliteral">&quot;Bettertimesteppingmethods&quot;</span>&gt;&lt;/a&gt;&lt;h4&gt;Better time stepping methods&lt;/h4&gt;</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;* </div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;* We here use <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> of the simpler time stepping methods, namely the <a class="code" href="grid__out_8cc.html#a2cc229a4f1ffc75e83ed269d5f725729">second</a> orderin time Crank-Nicolson method. However, more accurate methods such asRunge-Kutta methods are available and should be used as they <span class="keywordflow">do</span> not representmuch additional effort. It is not difficult to implement <span class="keyword">this</span> <span class="keywordflow">for</span> the currentprogram, but a more systematic treatment is also given in   @ref step_52 <span class="stringliteral">&quot;step-52&quot;</span>  .</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;* </div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;* &lt;a name=<span class="stringliteral">&quot;Betterrefinementcriteria&quot;</span>&gt;&lt;/a&gt;&lt;h4&gt;Better refinement criteria&lt;/h4&gt;</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;* </div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;* If you look at the meshes in the movie above, it is clear that they are notparticularly well suited to the task at hand. In fact, they look ratherrandom.</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;* There are two factors at play. First, there are some islands where cellshave been refined but that are surrounded by non-refined cells (and thereare probably also a few occasional coarsened islands). These are not terrible,as they most of the time <span class="keywordflow">do</span> not affect the approximation quality of the mesh,but they also don<span class="stringliteral">&#39;t help because so many of their additional degrees offreedom are in fact constrained by hanging node constraints. That said,this is easy to fix: the Triangulation class takes an argument to itsconstructor indicating a level of &quot;mesh smoothing&quot;. Passing one of manypossible flags, this instructs the triangulation to refine some additionalcells, or not to refine some cells, so that the resulting mesh does not havethese artifacts.</span></div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="stringliteral">* The second problem is more severe: the mesh appears to lag the solution.The underlying reason is that we only adapt the mesh once every fifthtime step, and only allow for a single refinement in these cases. Whenever asource switches on, the solution had been very smooth in this area before andthe mesh was consequently rather coarse. This implies that the next time stepwhen we refine the mesh, we will get one refinement level more in this area,and five time steps later another level, etc. But this is not enough: first,we should refine immediately when a source switches on (after all, in thecurrent context we at least know what the right hand side is), and we shouldallow for more than one refinement level. Of course, all of this can be doneusing deal.II, it just requires a bit of algorithmic thinking in how to makethis work!</span></div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="stringliteral">* &lt;a name=&quot;Positivitypreservation&quot;&gt;&lt;/a&gt;&lt;h4&gt;Positivity preservation&lt;/h4&gt;</span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="stringliteral">* To increase the accuracy and resolution of your simulation in time, onetypically decreases the time step size   @f$k_n@f$  . If you start playing aroundwith the time step in this particular example, you will notice that thesolution becomes partly negative, if   @f$k_n@f$   is below a certain threshold.This is not what we would expect to happen (in nature).</span></div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;<span class="stringliteral">* To get an idea of this behavior mathematically, let us consider a general,fully discrete problem:</span></div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="stringliteral">* @f{align*}</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="stringliteral">  A u^{n} = B u^{n-1}.</span></div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;<span class="stringliteral">@f}</span></div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<span class="stringliteral">* The general form of the   @f$i@f$  th equation then reads:</span></div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;<span class="stringliteral">* @f{align*}</span></div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;<span class="stringliteral">  a_{ii} u^{n}_i &amp;= b_{ii} u^{n-1}_i +</span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;<span class="stringliteral">  \sum\limits_{j \in S_i} \left( b_{ij} u^{n-1}_j</span></div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="stringliteral">- a_{ij} u^{n}_j \right),</span></div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="stringliteral">@f}</span></div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="stringliteral">* where   @f$S_i@f$   is the set of degrees of freedom that DoF   @f$i@f$   couples with (i.e.,for which either the matrix   @f$A@f$   or matrix   @f$B@f$   has a nonzero entry at position  @f$(i,j)@f$  ). If all coefficientsfulfill the following conditions:</span></div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;<span class="stringliteral">* @f{align*}</span></div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;<span class="stringliteral">  a_{ii} &amp;&gt; 0, &amp; b_{ii} &amp;\geq 0, &amp; a_{ij} &amp;\leq 0, &amp; b_{ij} &amp;\geq 0,</span></div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;<span class="stringliteral">  &amp;</span></div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;<span class="stringliteral">  \forall j &amp;\in S_i,</span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;<span class="stringliteral">@f}</span></div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="stringliteral">* all solutions   @f$u^{n}@f$   keep their sign from the previous ones   @f$u^{n-1}@f$  , andconsequently from the initial values   @f$u^0@f$  . See e.g.&lt;a href=&quot;http://bookstore.siam.org/cs14/&quot;&gt;Kuzmin, H&amp;auml;m&amp;auml;l&amp;auml;inen&lt;/a&gt;for more information on positivity preservation.</span></div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="stringliteral">* Depending on the PDE to solve and the time integration scheme used, one isable to deduce conditions for the time step   @f$k_n@f$  . For the heat equation withthe Crank-Nicolson scheme,&lt;a href=&quot;https://doi.org/10.2478/cmam-2010-0025&quot;&gt;Schatz et. al.&lt;/a&gt; havetranslated it to the following ones:</span></div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="stringliteral">* @f{align*}</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="stringliteral">  (1</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;<span class="stringliteral">- \theta) k a_{ii} &amp;\leq m_{ii},\qquad \forall i,</span></div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;<span class="stringliteral">  &amp;</span></div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;<span class="stringliteral">  \theta k \left| a_{ij} \right| &amp;\geq m_{ij},\qquad j \neq i,</span></div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="stringliteral">@f}</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="stringliteral">* where   @f$M = m_{ij}@f$   denotes the mass matrix and   @f$A = a_{ij}@f$   the stiffnessmatrix with   @f$a_{ij} \leq 0@f$   for   @f$j \neq i@f$  , respectively. With  @f$a_{ij} \leq 0@f$  , we can formulate bounds for the global time step   @f$k@f$   asfollows:</span></div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="stringliteral">* @f{align*}</span></div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;<span class="stringliteral">  k_{\text{max}} &amp;= \frac{ 1 }{ 1</span></div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;<span class="stringliteral">- \theta }</span></div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;<span class="stringliteral">  \min\left( \frac{ m_{ii} }{ a_{ii} } \right),~ \forall i,</span></div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;<span class="stringliteral">  &amp;</span></div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;<span class="stringliteral">  k_{\text{min}} &amp;= \frac{ 1 }{ \theta  }</span></div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;<span class="stringliteral">  \max\left( \frac{ m_{ij} }{ \left|a_{ij}\right| } \right),~ j \neq i.</span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;<span class="stringliteral">@f}</span></div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="stringliteral">* In other words, the time step is constrained by &lt;i&gt;both a lower</span></div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;<span class="stringliteral">and upper bound&lt;/i&gt; in case of a Crank-Nicolson scheme. These bounds should beconsidered along with the CFL condition to ensure significance of the performedsimulations.</span></div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;<span class="stringliteral">* Being unable to make the time step as small as we want to get moreaccuracy without losing the positivity property is annoying. It raisesthe question of whether we can at least &lt;i&gt;compute&lt;/i&gt; the minimal time stepwe can choose  to ensure positivity preservation in this particular tutorial.Indeed, we can usethe SparseMatrix objects for both mass and stiffness that are created viathe MatrixCreator functions. Iterating through each entry via SparseMatrixIteratorslets us check for diagonal and off-diagonal entries to set a proper time stepdynamically. For quadratic matrices, the diagonal element is stored as thefirst member of a row (see SparseMatrix documentation). An exemplary codesnippet on how to grab the entries of interest from the   &lt;code&gt;mass_matrix&lt;/code&gt;  is shown below.</span></div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;<span class="stringliteral">Assert (mass_matrix.m() == mass_matrix.n(), ExcNotQuadratic());</span></div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;<span class="stringliteral">const unsigned int num_rows = mass_matrix.m();</span></div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;<span class="stringliteral">double mass_matrix_min_diag    = std::numeric_limits&lt;double&gt;::max(),</span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;<span class="stringliteral">       mass_matrix_max_offdiag = 0.;</span></div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;<span class="stringliteral">SparseMatrixIterators::Iterator&lt;double,true&gt; row_it (&amp;mass_matrix, 0);</span></div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;<span class="stringliteral">for(unsigned int m = 0; m&lt;num_rows; ++m)</span></div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;<span class="stringliteral">{</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;<span class="stringliteral">  // check the diagonal element</span></div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="stringliteral">  row_it = mass_matrix.begin(m);</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;<span class="stringliteral">  mass_matrix_min_diag = std::min(row_it-&gt;value(), mass_matrix_min_diag);</span></div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;<span class="stringliteral">  ++row_it;</span></div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;<span class="stringliteral">  // check the off-diagonal elements</span></div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;<span class="stringliteral">  for(; row_it != mass_matrix.end(m); ++row_it)</span></div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;<span class="stringliteral">    mass_matrix_max_offdiag = std::max(row_it-&gt;value(), mass_matrix_max_offdiag);</span></div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;<span class="stringliteral">}</span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;<span class="stringliteral">@endcode</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="stringliteral">* Using the information so computed, we can bound the time step via the formulasabove.</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;<span class="stringliteral">* &lt;a name=&quot;PlainProg&quot;&gt;&lt;/a&gt;&lt;h1&gt; The plain program&lt;/h1&gt;  @include &quot;step-26.cc&quot;  </span></div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="stringliteral">*</span></div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;<span class="stringliteral">*/</span></div><div class="ttc" id="group__MeshWorker_html_gad10f528ab87f39fbb0531d24f238b2f3"><div class="ttname"><a href="group__MeshWorker.html#gad10f528ab87f39fbb0531d24f238b2f3">MeshWorker::loop</a></div><div class="ttdeci">void loop(ITERATOR begin, typename identity&lt; ITERATOR &gt;::type end, DOFINFO &amp;dinfo, INFOBOX &amp;info, const std::function&lt; void(DOFINFO &amp;, typename INFOBOX::CellInfo &amp;)&gt; &amp;cell_worker, const std::function&lt; void(DOFINFO &amp;, typename INFOBOX::CellInfo &amp;)&gt; &amp;boundary_worker, const std::function&lt; void(DOFINFO &amp;, DOFINFO &amp;, typename INFOBOX::CellInfo &amp;, typename INFOBOX::CellInfo &amp;)&gt; &amp;face_worker, ASSEMBLER &amp;assembler, const LoopControl &amp;lctrl=LoopControl())</div><div class="ttdef"><b>Definition:</b> <a href="loop_8h_source.html#l00449">loop.h:449</a></div></div>
<div class="ttc" id="namespaceVectorTools_html_a761f008bdeb7d94a69205ae824deefad"><div class="ttname"><a href="namespaceVectorTools.html#a761f008bdeb7d94a69205ae824deefad">VectorTools::interpolate</a></div><div class="ttdeci">void interpolate(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const Function&lt; spacedim, typename VectorType::value_type &gt; &amp;function, VectorType &amp;vec, const ComponentMask &amp;component_mask=ComponentMask())</div></div>
<div class="ttc" id="namespaceMatrixTools_html_a9ad0eb7a8662628534586716748d62fb"><div class="ttname"><a href="namespaceMatrixTools.html#a9ad0eb7a8662628534586716748d62fb">MatrixTools::apply_boundary_values</a></div><div class="ttdeci">void apply_boundary_values(const std::map&lt; types::global_dof_index, number &gt; &amp;boundary_values, SparseMatrix&lt; number &gt; &amp;matrix, Vector&lt; number &gt; &amp;solution, Vector&lt; number &gt; &amp;right_hand_side, const bool eliminate_columns=true)</div><div class="ttdef"><b>Definition:</b> <a href="matrix__tools_8cc_source.html#l00081">matrix_tools.cc:81</a></div></div>
<div class="ttc" id="namespaceGridTools_html_acd5ccc543d561cfb086b571d1f7818cb"><div class="ttname"><a href="namespaceGridTools.html#acd5ccc543d561cfb086b571d1f7818cb">GridTools::diameter</a></div><div class="ttdeci">double diameter(const Triangulation&lt; dim, spacedim &gt; &amp;tria)</div><div class="ttdef"><b>Definition:</b> <a href="grid__tools_8cc_source.html#l00081">grid_tools.cc:81</a></div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_a1a9009db0d9a77923a7031b549b9b638a5bc7c54a9c20485772672825c6a73003"><div class="ttname"><a href="namespaceLAPACKSupport.html#a1a9009db0d9a77923a7031b549b9b638a5bc7c54a9c20485772672825c6a73003">LAPACKSupport::matrix</a></div><div class="ttdoc">Contents is actually a matrix. </div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00060">lapack_support.h:60</a></div></div>
<div class="ttc" id="classVector_html"><div class="ttname"><a href="classVector.html">Vector</a></div><div class="ttdef"><b>Definition:</b> <a href="mapping__q1__eulerian_8h_source.html#l00033">mapping_q1_eulerian.h:33</a></div></div>
<div class="ttc" id="namespaceinternal_html_aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804"><div class="ttname"><a href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">internal::EvaluatorQuantity::value</a></div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_aceda56512460bbad2f9fdb8a3d0e1e51"><div class="ttname"><a href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">LAPACKSupport::one</a></div><div class="ttdeci">static const types::blas_int one</div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00198">lapack_support.h:198</a></div></div>
<div class="ttc" id="grid__out_8cc_html_a2cc229a4f1ffc75e83ed269d5f725729"><div class="ttname"><a href="grid__out_8cc.html#a2cc229a4f1ffc75e83ed269d5f725729">second</a></div><div class="ttdeci">Point&lt; 2 &gt; second</div><div class="ttdef"><b>Definition:</b> <a href="grid__out_8cc_source.html#l04588">grid_out.cc:4588</a></div></div>
<div class="ttc" id="namespaceVectorTools_html_a6e325333a138893e181da47f29ac680a"><div class="ttname"><a href="namespaceVectorTools.html#a6e325333a138893e181da47f29ac680a">VectorTools::create_right_hand_side</a></div><div class="ttdeci">void create_right_hand_side(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const Quadrature&lt; dim &gt; &amp;q, const Function&lt; spacedim, typename VectorType::value_type &gt; &amp;rhs, VectorType &amp;rhs_vector, const AffineConstraints&lt; typename VectorType::value_type &gt; &amp;constraints=AffineConstraints&lt; typename VectorType::value_type &gt;())</div></div>
<div class="ttc" id="group__Exceptions_html_ga0d685aad996180f9851183ae3e29019a"><div class="ttname"><a href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">StandardExceptions::ExcIndexRange</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcIndexRange(int arg1, int arg2, int arg3)</div></div>
<div class="ttc" id="namespacePhysics_1_1Elasticity_1_1Kinematics_html_aa87528a28ad8a95fa89a3876e6f986c8"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">Physics::Elasticity::Kinematics::F</a></div><div class="ttdeci">Tensor&lt; 2, dim, Number &gt; F(const Tensor&lt; 2, dim, Number &gt; &amp;Grad_u)</div></div>
<div class="ttc" id="namespaceGridGenerator_html_a3b2a4ad8296c2b72a11d23b5969e8cc0"><div class="ttname"><a href="namespaceGridGenerator.html#a3b2a4ad8296c2b72a11d23b5969e8cc0">GridGenerator::hyper_L</a></div><div class="ttdeci">void hyper_L(Triangulation&lt; dim &gt; &amp;tria, const double left=-1., const double right=1., const bool colorize=false)</div></div>
<div class="ttc" id="classSymmetricTensor_html_a33cd1a6c91c24a5ca34dfbc43c338d1c"><div class="ttname"><a href="classSymmetricTensor.html#a33cd1a6c91c24a5ca34dfbc43c338d1c">SymmetricTensor::invert</a></div><div class="ttdeci">constexpr SymmetricTensor&lt; 2, dim, Number &gt; invert(const SymmetricTensor&lt; 2, dim, Number &gt; &amp;t)</div><div class="ttdef"><b>Definition:</b> <a href="symmetric__tensor_8h_source.html#l03289">symmetric_tensor.h:3289</a></div></div>
<div class="ttc" id="classQGauss_html"><div class="ttname"><a href="classQGauss.html">QGauss</a></div><div class="ttdef"><b>Definition:</b> <a href="quadrature__lib_8h_source.html#l00039">quadrature_lib.h:39</a></div></div>
<div class="ttc" id="classVector_html_a10b0336c485e36c7b4b105dd2a926002"><div class="ttname"><a href="classVector.html#a10b0336c485e36c7b4b105dd2a926002">Vector::add</a></div><div class="ttdeci">void add(const std::vector&lt; size_type &gt; &amp;indices, const std::vector&lt; OtherNumber &gt; &amp;values)</div></div>
<div class="ttc" id="namespaceLocalIntegrators_1_1L2_html_a1c15243765304a803037988b5561627d"><div class="ttname"><a href="namespaceLocalIntegrators_1_1L2.html#a1c15243765304a803037988b5561627d">LocalIntegrators::L2::mass_matrix</a></div><div class="ttdeci">void mass_matrix(FullMatrix&lt; double &gt; &amp;M, const FEValuesBase&lt; dim &gt; &amp;fe, const double factor=1.)</div><div class="ttdef"><b>Definition:</b> <a href="l2_8h_source.html#l00057">l2.h:57</a></div></div>
<div class="ttc" id="group__Exceptions_html_ga70a0bb353656e704acf927945277bbc6"><div class="ttname"><a href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a></div><div class="ttdeci">#define Assert(cond, exc)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2exceptions_8h_source.html#l01415">exceptions.h:1415</a></div></div>
<div class="ttc" id="namespaceTrilinosWrappers_1_1internal_html_aee42c8e3004e2e81eac3c3356d3ec46b"><div class="ttname"><a href="namespaceTrilinosWrappers_1_1internal.html#aee42c8e3004e2e81eac3c3356d3ec46b">TrilinosWrappers::internal::end</a></div><div class="ttdeci">VectorType::value_type * end(VectorType &amp;V)</div><div class="ttdef"><b>Definition:</b> <a href="trilinos__sparse__matrix_8cc_source.html#l00067">trilinos_sparse_matrix.cc:67</a></div></div>
<div class="ttc" id="grid__out_8cc_html_a827a345f29da7caeb588b11013869a01"><div class="ttname"><a href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a></div><div class="ttdeci">Point&lt; 2 &gt; first</div><div class="ttdef"><b>Definition:</b> <a href="grid__out_8cc_source.html#l04587">grid_out.cc:4587</a></div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_a40707d49114d54318c823f3b750e89a4"><div class="ttname"><a href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">LAPACKSupport::A</a></div><div class="ttdeci">static const char A</div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00158">lapack_support.h:158</a></div></div>
<div class="ttc" id="namespaceVectorTools_html_af27ac28c698a9ed0199faed50a204538"><div class="ttname"><a href="namespaceVectorTools.html#af27ac28c698a9ed0199faed50a204538">VectorTools::interpolate_boundary_values</a></div><div class="ttdeci">void interpolate_boundary_values(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const std::map&lt; types::boundary_id, const Function&lt; spacedim, number &gt; *&gt; &amp;function_map, std::map&lt; types::global_dof_index, number &gt; &amp;boundary_values, const ComponentMask &amp;component_mask=ComponentMask())</div></div>
<div class="ttc" id="classFunctions_1_1ZeroFunction_html"><div class="ttname"><a href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction</a></div><div class="ttdef"><b>Definition:</b> <a href="function_8h_source.html#l00444">function.h:444</a></div></div>
<div class="ttc" id="classVector_html_ac4a4dbef7dd65ef8ad35ae56b57d7c05"><div class="ttname"><a href="classVector.html#ac4a4dbef7dd65ef8ad35ae56b57d7c05">Vector::reinit</a></div><div class="ttdeci">virtual void reinit(const size_type N, const bool omit_zeroing_entries=false)</div></div>
<div class="ttc" id="namespaceEvaluationFlags_html_a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58"><div class="ttname"><a href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">EvaluationFlags::values</a></div><div class="ttdef"><b>Definition:</b> <a href="evaluation__flags_8h_source.html#l00054">evaluation_flags.h:54</a></div></div>
<div class="ttc" id="p4est__wrappers_8cc_html_ace00f2f80d9780ef9aa1007e1c22c6a4"><div class="ttname"><a href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a></div><div class="ttdeci">const ::parallel::distributed::Triangulation&lt; dim, spacedim &gt; * triangulation</div><div class="ttdef"><b>Definition:</b> <a href="p4est__wrappers_8cc_source.html#l00069">p4est_wrappers.cc:69</a></div></div>
<div class="ttc" id="namespaceGridRefinement_html_a1cf30058b31ce7f9b389e8310bb9fc54"><div class="ttname"><a href="namespaceGridRefinement.html#a1cf30058b31ce7f9b389e8310bb9fc54">GridRefinement::refine</a></div><div class="ttdeci">void refine(Triangulation&lt; dim, spacedim &gt; &amp;tria, const Vector&lt; Number &gt; &amp;criteria, const double threshold, const unsigned int max_to_mark=numbers::invalid_unsigned_int)</div><div class="ttdef"><b>Definition:</b> <a href="grid_2grid__refinement_8cc_source.html#l00168">grid_refinement.cc:168</a></div></div>
<div class="ttc" id="namespaceWorkStream_1_1internal_1_1tbb__no__coloring_html_a8673698a405bf47aa24002aeb6d76d70"><div class="ttname"><a href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">WorkStream::internal::tbb_no_coloring::run</a></div><div class="ttdeci">void run(const Iterator &amp;begin, const typename identity&lt; Iterator &gt;::type &amp;end, Worker worker, Copier copier, const ScratchData &amp;sample_scratch_data, const CopyData &amp;sample_copy_data, const unsigned int queue_length, const unsigned int chunk_size)</div><div class="ttdef"><b>Definition:</b> <a href="work__stream_8h_source.html#l00562">work_stream.h:562</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
