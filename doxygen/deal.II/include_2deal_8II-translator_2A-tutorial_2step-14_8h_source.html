<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="canonical" href="https://www.dealii.org/current/doxygen/deal.II/include_2deal_8II-translator_2A-tutorial_2step-14_8h_source.html" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The deal.II Library: include/deal.II-translator/A-tutorial/step-14.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link rel="SHORTCUT ICON" href="deal.ico"></link>
<script type="text/javascript" src="custom.js"></script>
<meta name="author" content="The deal.II Authors <authors@dealii.org>"></meta>
<meta name="copyright" content="Copyright (C) 1998 - 2021 by the deal.II authors"></meta>
<meta name="deal.II-version" content="10.0.0-pre"></meta>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo200.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Reference documentation for deal.II version 10.0.0-pre</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!--Extra macros for MathJax:-->
<div style="display:none">
\(\newcommand{\dealvcentcolon}{\mathrel{\mathop{:}}}\)
\(\newcommand{\dealcoloneq}{\dealvcentcolon\mathrel{\mkern-1.2mu}=}\)
\(\newcommand{\jump}[1]{\left[\!\left[ #1 \right]\!\right]}\)
\(\newcommand{\average}[1]{\left\{\!\left\{ #1 \right\}\!\right\}}\)
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="dir_386d89ad50a3909c2af5a93b48d2c3ff.html">deal.II-translator</a></li><li class="navelem"><a class="el" href="dir_7812fe2bbb6fb6db2d3962cae8700ca0.html">A-tutorial</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">step-14.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="include_2deal_8II-translator_2A-tutorial_2step-14_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160; ) <span class="keyword">const</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;     {</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;       std::ofstream out(output_name_base + <span class="stringliteral">&quot;-&quot;</span> +</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                         <a class="code" href="namespacePatterns_1_1Tools.html#a72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(this-&gt;refinement_cycle) + <span class="stringliteral">&quot;.svg&quot;</span>);</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;       <a class="code" href="classGridOut.html">GridOut</a>().<a class="code" href="classGridOut.html#a1fa6434f6a8d8cda104d47728d30c657">write_svg</a>(dof_handler.get_triangulation(), out);</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;     }</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;   } <span class="comment">// namespace Evaluation</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;* </div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160; </div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;* </div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;TheLaplacesolverclasses&quot;</span>&gt;&lt;/a&gt;  &lt;h3&gt;The Laplace solver classes&lt;/h3&gt;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;* </div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;* </div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;*  Next are the actual solver classes. Again, we discuss only the differences to the previous program.</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;* </div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;* </div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;* @code</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;   <span class="keyword">namespace </span>LaplaceSolver</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;   {</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;* </div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;TheLaplacesolverbaseclass&quot;</span>&gt;&lt;/a&gt;  &lt;h4&gt;The Laplace solver base <span class="keyword">class</span>&lt;/h4&gt;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;* </div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;* </div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;*  This <span class="keyword">class </span>is almost unchanged, with the exception that it declares two more <a class="code" href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">functions</a>:   &lt;code&gt;output_solution&lt;/code&gt;   will be used to generate output files from the actual solutions computed by derived classes, and the   &lt;code&gt;set_refinement_cycle&lt;/code&gt;   function by which the testing framework sets the number of the refinement cycle to a local variable in this class; this number is later used to generate filenames for the solution output.</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;* </div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;* </div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;* @code</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;     template &lt;int dim&gt;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;     class Base</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;     {</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;     <span class="keyword">public</span>:</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;       Base(<a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;coarse_grid);</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;       <span class="keyword">virtual</span> ~Base() = <span class="keywordflow">default</span>;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;* </div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;       <span class="keyword">virtual</span> <span class="keywordtype">void</span> solve_problem() = 0;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;       <span class="keyword">virtual</span> <span class="keywordtype">void</span> postprocess(</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;         <span class="keyword">const</span> Evaluation::EvaluationBase&lt;dim&gt; &amp;postprocessor) <span class="keyword">const</span> = 0;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;       <span class="keyword">virtual</span> <span class="keywordtype">void</span>         refine_grid()                            = 0;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;       <span class="keyword">virtual</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_dofs() <span class="keyword">const</span>                           = 0;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;* </div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;       <span class="keyword">virtual</span> <span class="keywordtype">void</span> set_refinement_cycle(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cycle);</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;* </div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;       <span class="keyword">virtual</span> <span class="keywordtype">void</span> output_solution() <span class="keyword">const</span> = 0;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;* </div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;     <span class="keyword">protected</span>:</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;       <span class="keyword">const</span> <a class="code" href="classSmartPointer.html">SmartPointer&lt;Triangulation&lt;dim&gt;</a>&gt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;* </div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> refinement_cycle;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;     };</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;* </div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160; </div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;     Base&lt;dim&gt;::Base(<a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;coarse_grid)</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;       : <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>(&amp;coarse_grid)</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;       , refinement_cycle(<a class="code" href="namespacenumbers.html">numbers</a>::<a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">invalid_unsigned_int</a>)</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;     {}</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;* </div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160; </div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;* </div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;     <span class="keywordtype">void</span> Base&lt;dim&gt;::set_refinement_cycle(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cycle)</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;     {</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;       refinement_cycle = cycle;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;     }</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;* </div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160; </div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;* </div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;TheLaplaceSolverclass&quot;</span>&gt;&lt;/a&gt;  &lt;h4&gt;The Laplace Solver <span class="keyword">class</span>&lt;/h4&gt;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;* </div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;* </div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;*  Likewise, the   &lt;code&gt;Solver&lt;/code&gt;   <span class="keyword">class </span>is entirely unchanged and will thus not be discussed.</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;* </div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;* </div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;* @code</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;     <span class="keyword">class </span>Solver : <span class="keyword">public</span> <span class="keyword">virtual</span> Base&lt;dim&gt;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;     {</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;     <span class="keyword">public</span>:</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;       Solver(<a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;       <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>,</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;              <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp; fe,</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;              <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature&lt;dim&gt;</a> &amp;    quadrature,</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;              <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature</a>&lt;dim</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;* </div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;- 1&gt; &amp;face_quadrature,</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;              <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;      boundary_values);</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;       <span class="keyword">virtual</span> ~Solver() <span class="keyword">override</span>;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;* </div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;       <span class="keyword">virtual</span> <span class="keywordtype">void</span> solve_problem() <span class="keyword">override</span>;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;* </div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;       <span class="keyword">virtual</span> <span class="keywordtype">void</span> postprocess(</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;         <span class="keyword">const</span> Evaluation::EvaluationBase&lt;dim&gt; &amp;postprocessor) <span class="keyword">const override</span>;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;* </div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;       <span class="keyword">virtual</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_dofs() <span class="keyword">const override</span>;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;* </div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;     <span class="keyword">protected</span>:</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;       <span class="keyword">const</span> <a class="code" href="classSmartPointer.html">SmartPointer&lt;const FiniteElement&lt;dim&gt;</a>&gt;  fe;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;       <span class="keyword">const</span> <a class="code" href="classSmartPointer.html">SmartPointer&lt;const Quadrature&lt;dim&gt;</a>&gt;     quadrature;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;       <span class="keyword">const</span> <a class="code" href="classSmartPointer.html">SmartPointer</a>&lt;<span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature</a>&lt;dim</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;* </div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;- 1&gt;&gt; face_quadrature;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;       <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>                               dof_handler;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;       <a class="code" href="classVector.html">Vector&lt;double&gt;</a>                                solution;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;       <span class="keyword">const</span> <a class="code" href="classSmartPointer.html">SmartPointer&lt;const Function&lt;dim&gt;</a>&gt;       boundary_values;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;* </div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;       <span class="keyword">virtual</span> <span class="keywordtype">void</span> assemble_rhs(<a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;rhs) <span class="keyword">const</span> = 0;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;* </div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;     <span class="keyword">private</span>:</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;       <span class="keyword">struct </span>LinearSystem</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;       {</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;         LinearSystem(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler);</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;* </div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;         <span class="keywordtype">void</span> solve(<a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;solution) <span class="keyword">const</span>;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;* </div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;         <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> hanging_node_constraints;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;         <a class="code" href="classSparsityPattern.html">SparsityPattern</a>           sparsity_pattern;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;         <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a>      <a class="code" href="namespaceLAPACKSupport.html#a1a9009db0d9a77923a7031b549b9b638a5bc7c54a9c20485772672825c6a73003">matrix</a>;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;         <a class="code" href="classVector.html">Vector&lt;double&gt;</a>            rhs;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;       };</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;* </div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160; </div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;* </div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;*  The remainder of the <span class="keyword">class </span>is essentially a <a class="code" href="namespaceinternal_1_1VectorOperations.html#a40c8daa0881cff0123fbaeb08929f5cb">copy</a> of   @ref step_13 &quot;step-13&quot;   as well, including the data structures and <a class="code" href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">functions</a> necessary to compute the linear system in <a class="code" href="namespaceparallel.html">parallel</a> using the <a class="code" href="namespaceWorkStream.html">WorkStream</a> framework:</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;* </div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;* </div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;* @code</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;       struct AssemblyScratchData</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;       {</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;         AssemblyScratchData(<span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;fe,</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                             <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature&lt;dim&gt;</a> &amp;   quadrature);</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;         AssemblyScratchData(<span class="keyword">const</span> AssemblyScratchData &amp;scratch_data);</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;* </div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;         <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;       };</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;* </div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;       <span class="keyword">struct </span>AssemblyCopyData</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;       {</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;         <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a>                   <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;         std::vector&lt;types::global_dof_index&gt; local_dof_indices;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;       };</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;* </div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160; </div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;       <span class="keywordtype">void</span> assemble_linear_system(LinearSystem &amp;linear_system);</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;* </div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;       <span class="keywordtype">void</span> local_assemble_matrix(</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;         <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;         AssemblyScratchData &amp;                                 scratch_data,</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;         AssemblyCopyData &amp;                                    copy_data) <span class="keyword">const</span>;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;* </div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160; </div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;       <span class="keywordtype">void</span> copy_local_to_global(<span class="keyword">const</span> AssemblyCopyData &amp;copy_data,</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                                 LinearSystem &amp;          linear_system) <span class="keyword">const</span>;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;     };</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;* </div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160; </div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;* </div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;     Solver&lt;dim&gt;::Solver(<a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;       <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>,</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                         <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp; fe,</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                         <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature&lt;dim&gt;</a> &amp;    quadrature,</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                         <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature</a>&lt;dim</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;* </div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;- 1&gt; &amp;face_quadrature,</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                         <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;      boundary_values)</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;       : Base&lt;dim&gt;(triangulation)</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;       , fe(&amp;fe)</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;       , quadrature(&amp;quadrature)</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;       , face_quadrature(&amp;face_quadrature)</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;       , dof_handler(triangulation)</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;       , boundary_values(&amp;boundary_values)</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;     {}</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;* </div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160; </div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;     Solver&lt;dim&gt;::~Solver()</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;     {</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;       dof_handler.clear();</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;     }</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;* </div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160; </div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;     <span class="keywordtype">void</span> Solver&lt;dim&gt;::solve_problem()</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;     {</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;       dof_handler.distribute_dofs(*fe);</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;       solution.reinit(dof_handler.n_dofs());</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;* </div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;       LinearSystem linear_system(dof_handler);</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;       assemble_linear_system(linear_system);</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;       linear_system.solve(solution);</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;     }</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;* </div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160; </div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;     <span class="keywordtype">void</span> Solver&lt;dim&gt;::postprocess(</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;       <span class="keyword">const</span> Evaluation::EvaluationBase&lt;dim&gt; &amp;postprocessor)<span class="keyword"> const</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="keyword">     </span>{</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;       postprocessor(dof_handler, solution);</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;     }</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;* </div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160; </div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> Solver&lt;dim&gt;::n_dofs()<span class="keyword"> const</span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="keyword">     </span>{</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;       <span class="keywordflow">return</span> dof_handler.n_dofs();</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;     }</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;* </div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160; </div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;* </div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;*  The following few <a class="code" href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">functions</a> and constructors are verbatim copies taken from   @ref step_13 <span class="stringliteral">&quot;step-13&quot;</span>  :</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;* </div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;* </div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;* @code</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;     <span class="keywordtype">void</span> Solver&lt;dim&gt;::assemble_linear_system(LinearSystem &amp;linear_system)</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;     {</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;       <a class="code" href="classThreads_1_1Task.html">Threads::Task&lt;void&gt;</a> rhs_task =</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;         <a class="code" href="group__threads.html#ga8c1e15b84e1bb58a8029fc6d6ddf3cbf">Threads::new_task</a>(&amp;Solver&lt;dim&gt;::assemble_rhs,<span class="keyword">this</span>, linear_system.rhs);</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;* </div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;       <span class="keyword">auto</span> worker =</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;         [<span class="keyword">this</span>](<span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                AssemblyScratchData &amp;scratch_data,</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                AssemblyCopyData &amp;   copy_data) {</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;           this-&gt;local_assemble_matrix(cell, scratch_data, copy_data);</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;         };</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;* </div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;       <span class="keyword">auto</span> copier = [<span class="keyword">this</span>, &amp;linear_system](<span class="keyword">const</span> AssemblyCopyData &amp;copy_data) {</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;         this-&gt;copy_local_to_global(copy_data, linear_system);</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;       };</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;* </div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;       <a class="code" href="namespaceWorkStream.html#ab8ceb010811941c351803b671a19fb73">WorkStream::run</a>(dof_handler.begin_active(),</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;                       dof_handler.end(),</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                       worker,</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;                       copier,</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;                       AssemblyScratchData(*fe,quadrature),</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;                       AssemblyCopyData());</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;       linear_system.hanging_node_constraints.condense(linear_system.matrix);</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;* </div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;       std::map&lt;types::global_dof_index, double&gt; boundary_value_map;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;       <a class="code" href="namespaceVectorTools.html#af27ac28c698a9ed0199faed50a204538">VectorTools::interpolate_boundary_values</a>(dof_handler,</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;                                                0,</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;                                               boundary_values,</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                                                boundary_value_map);</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;* </div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;       rhs_task.<a class="code" href="classThreads_1_1Task.html#a9aed8f99d2b88bd0d6cfff95e38c3ac7">join</a>();</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;       linear_system.hanging_node_constraints.condense(linear_system.rhs);</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;* </div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;       <a class="code" href="namespaceMatrixTools.html#a9ad0eb7a8662628534586716748d62fb">MatrixTools::apply_boundary_values</a>(boundary_value_map,</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                                          linear_system.matrix,</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;                                          solution,</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                                          linear_system.rhs);</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;     }</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;* </div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160; </div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;     Solver&lt;dim&gt;::AssemblyScratchData::AssemblyScratchData(</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;       <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;fe,</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;       <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature&lt;dim&gt;</a> &amp;   quadrature)</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;       : fe_values(fe, quadrature, <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>)</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;     {}</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;* </div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160; </div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;     Solver&lt;dim&gt;::AssemblyScratchData::AssemblyScratchData(</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;       <span class="keyword">const</span> AssemblyScratchData &amp;scratch_data)</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;       : fe_values(scratch_data.fe_values.get_fe(),</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                   scratch_data.fe_values.get_quadrature(),</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;                   <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>)</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;     {}</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;* </div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160; </div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;     <span class="keywordtype">void</span> Solver&lt;dim&gt;::local_assemble_matrix(</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;       <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;       AssemblyScratchData &amp;                                 scratch_data,</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;       AssemblyCopyData &amp;                                    copy_data)<span class="keyword"> const</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="keyword">     </span>{</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell = fe-&gt;n_dofs_per_cell();</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points    = quadrature-&gt;size();</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;* </div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;       copy_data.cell_matrix.reinit(dofs_per_cell, dofs_per_cell);</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;* </div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;       copy_data.local_dof_indices.resize(dofs_per_cell);</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;* </div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;       scratch_data.fe_values.reinit(cell);</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;* </div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; n_q_points; ++q_point)</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; dofs_per_cell; ++j)</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;             copy_data.cell_matrix(i, j) +=</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;               (scratch_data.fe_values.shape_grad(i, q_point)</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;                scratch_data.fe_values.shape_grad(j, q_point)</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                scratch_data.fe_values.JxW(q_point));</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;* </div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;       cell-&gt;get_dof_indices(copy_data.local_dof_indices);</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;     }</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;* </div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160; </div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;* </div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;     <span class="keywordtype">void</span> Solver&lt;dim&gt;::copy_local_to_global(<span class="keyword">const</span> AssemblyCopyData &amp;copy_data,</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;                                            LinearSystem &amp;linear_system)<span class="keyword"> const</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;<span class="keyword">     </span>{</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; copy_data.local_dof_indices.size(); ++i)</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; copy_data.local_dof_indices.size(); ++j)</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;           linear_system.matrix.add(copy_data.local_dof_indices[i],</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;                                    copy_data.local_dof_indices[j],</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                                    copy_data.cell_matrix(i, j));</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;     }</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;* </div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160; </div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;* </div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;*  Now <span class="keywordflow">for</span> the <a class="code" href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">functions</a> that implement actions in the linear system <span class="keyword">class</span>. First, the constructor initializes all data elements to their correct sizes, and sets up a number of additional data structures, such as constraints due to hanging nodes. Since setting up the hanging nodes and finding out about the <a class="code" href="namespaceDoFTools.html#ad31df71a29dd76de9b4ab241b2527160a155b9e72113d7008c60732d350bfbb7a">nonzero</a> elements of the <a class="code" href="namespaceLAPACKSupport.html#a1a9009db0d9a77923a7031b549b9b638a5bc7c54a9c20485772672825c6a73003">matrix</a> is independent, we <span class="keywordflow">do</span> that in <a class="code" href="namespaceparallel.html">parallel</a> (<span class="keywordflow">if</span> the library was configured to use concurrency, at least; otherwise, the actions are performed sequentially). Note that we start only <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> thread, and <span class="keywordflow">do</span> the <a class="code" href="grid__out_8cc.html#a2cc229a4f1ffc75e83ed269d5f725729">second</a> action in the main thread. Since only <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> thread is generated, we don<span class="stringliteral">&#39;t use the   &lt;code&gt;Threads::TaskGroup&lt;/code&gt;   class here, but rather use the one created task object directly to wait for this particular task&#39;</span>s exit. The approach is generally the same as the <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> we have used in   &lt;code&gt;Solver::assemble_linear_system()&lt;/code&gt;   above.     </div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;*   Note that taking the address of the   &lt;code&gt;<a class="code" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a>&lt;/code&gt;   <span class="keyword">function</span> is a little tricky, since there are actually three <a class="code" href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">functions</a> of <span class="keyword">this</span> name, <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> <span class="keywordflow">for each</span> supported space dimension. Taking addresses of overloaded <a class="code" href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">functions</a> is somewhat complicated in <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a09916360abaee5f1fb31994dbc96787b">C</a>++, since the address-of operator   &lt;code&gt;&amp;&lt;/code&gt;   in that <span class="keywordflow">case</span> returns a <span class="keyword">set</span> of <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a> (the addresses of all <a class="code" href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">functions</a> with that name), and selecting the right <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> is then the next step. If the context dictates which <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> to take (<span class="keywordflow">for</span> example by assigning to a <span class="keyword">function</span> pointer of known type), then the compiler can <span class="keywordflow">do</span> that by itself, but <span class="keywordflow">if</span> <span class="keyword">this</span> <span class="keyword">set</span> of pointers shall be given as the argument to a <span class="keyword">function</span> that takes a <span class="keyword">template</span>, the compiler could choose all without having a preference <span class="keywordflow">for</span> <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a>. We therefore have to make it clear to the compiler which <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> we would like to have; <span class="keywordflow">for</span> <span class="keyword">this</span>, we could use a cast, but <span class="keywordflow">for</span> more clarity, we assign it to a temporary   &lt;code&gt;mhnc_p&lt;/code&gt;   (<span class="keywordtype">short</span> for &lt;code&gt;pointer to <a class="code" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">make_hanging_node_constraints</a>&lt;/code&gt;) with the right type, and <span class="keyword">using</span> <span class="keyword">this</span> pointer instead.</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;* </div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;* </div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;* @code</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;     template &lt;int dim&gt;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;     Solver&lt;dim&gt;::LinearSystem::LinearSystem(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler)</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;     {</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;       hanging_node_constraints.clear();</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;* </div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;       void (*mhnc_p)(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;, <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> &amp;) =</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;         &amp;<a class="code" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a>;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;* </div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;* </div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;*  Start a side task then <span class="keywordflow">continue</span> on the main thread</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;* </div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;* </div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;* @code</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;       <a class="code" href="classThreads_1_1Task.html">Threads::Task&lt;void&gt;</a> side_task =</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;         <a class="code" href="group__threads.html#ga8c1e15b84e1bb58a8029fc6d6ddf3cbf">Threads::new_task</a>(mhnc_p, dof_handler, hanging_node_constraints);</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;* </div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;       <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(), dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;       <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler, dsp);</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;* </div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160; </div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;* </div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;* </div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;*  Wait <span class="keywordflow">for</span> the side task to be done before going further</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;* </div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;* </div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;* @code</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;       side_task.join();</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;* </div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;       hanging_node_constraints.close();</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;       hanging_node_constraints.condense(dsp);</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;       sparsity_pattern.copy_from(dsp);</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;* </div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;       <a class="code" href="namespaceLAPACKSupport.html#a1a9009db0d9a77923a7031b549b9b638a5bc7c54a9c20485772672825c6a73003">matrix</a>.reinit(sparsity_pattern);</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;       rhs.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;     }</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;* </div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160; </div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;* </div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;     <span class="keywordtype">void</span> Solver&lt;dim&gt;::LinearSystem::solve(<a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;solution)<span class="keyword"> const</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="keyword">     </span>{</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;       <a class="code" href="classSolverControl.html">SolverControl</a>            solver_control(5000, 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-12);</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;       <a class="code" href="classSolverCG.html">SolverCG&lt;Vector&lt;double&gt;</a>&gt; cg(solver_control);</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;* </div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;       <a class="code" href="classPreconditionSSOR.html">PreconditionSSOR&lt;SparseMatrix&lt;double&gt;</a>&gt; preconditioner;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;       preconditioner.<a class="code" href="classPreconditionSSOR.html#a7a3d66b17bb0ea1b16606e222474c2ea">initialize</a>(<a class="code" href="namespaceLAPACKSupport.html#a1a9009db0d9a77923a7031b549b9b638a5bc7c54a9c20485772672825c6a73003">matrix</a>, 1.2);</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;* </div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;       cg.solve(<a class="code" href="namespaceLAPACKSupport.html#a1a9009db0d9a77923a7031b549b9b638a5bc7c54a9c20485772672825c6a73003">matrix</a>, solution, rhs, preconditioner);</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;* </div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;       hanging_node_constraints.distribute(solution);</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;     }</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;* </div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160; </div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;* </div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;* </div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;ThePrimalSolverclass&quot;</span>&gt;&lt;/a&gt;  &lt;h4&gt;The PrimalSolver <span class="keyword">class</span>&lt;/h4&gt;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;* </div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;* </div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;*  The   &lt;code&gt;PrimalSolver&lt;/code&gt;   <span class="keyword">class </span>is also mostly unchanged except for implementing the   &lt;code&gt;output_solution&lt;/code&gt;   function. We keep the   &lt;code&gt;GlobalRefinement&lt;/code&gt; and &lt;code&gt;RefinementKelly&lt;/code&gt;   classes in this program, and they can then rely on the default implementation of this function which simply outputs the primal solution. The class implementing dual weighted error estimators will overload this function itself, to also output the dual solution.</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;* </div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;* </div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;* @code</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;     <span class="keyword">class </span>PrimalSolver : <span class="keyword">public</span> Solver&lt;dim&gt;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;     {</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;     <span class="keyword">public</span>:</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;       PrimalSolver(<a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;       <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>,</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;                    <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp; fe,</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;                    <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature&lt;dim&gt;</a> &amp;    quadrature,</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;                    <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature</a>&lt;dim</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;* </div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;- 1&gt; &amp;face_quadrature,</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                    <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;      rhs_function,</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;                    <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;      boundary_values);</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;* </div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;       <span class="keyword">virtual</span> <span class="keywordtype">void</span> output_solution() <span class="keyword">const override</span>;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;* </div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;     <span class="keyword">protected</span>:</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;       <span class="keyword">const</span> <a class="code" href="classSmartPointer.html">SmartPointer&lt;const Function&lt;dim&gt;</a>&gt; rhs_function;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;       <span class="keyword">virtual</span> <span class="keywordtype">void</span> assemble_rhs(<a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;rhs) <span class="keyword">const override</span>;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;     };</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;* </div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160; </div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;     PrimalSolver&lt;dim&gt;::PrimalSolver(<a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;       <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>,</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;                                     <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp; fe,</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;                                     <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature&lt;dim&gt;</a> &amp;    quadrature,</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;                                     <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature</a>&lt;dim</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;* </div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;- 1&gt; &amp;face_quadrature,</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;                                     <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;      rhs_function,</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;                                     <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;      boundary_values)</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;       : Base&lt;dim&gt;(triangulation)</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;       , Solver&lt;dim&gt;(triangulation,</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;                     fe,</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;                     quadrature,</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;                     face_quadrature,</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;                     boundary_values)</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;       , rhs_function(&amp;rhs_function)</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;     {}</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;* </div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160; </div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;* </div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;     <span class="keywordtype">void</span> PrimalSolver&lt;dim&gt;::output_solution()<span class="keyword"> const</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="keyword">     </span>{</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;       <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;       data_out.<a class="code" href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">attach_dof_handler</a>(this-&gt;dof_handler);</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;       data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(this-&gt;solution, <span class="stringliteral">&quot;solution&quot;</span>);</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;       data_out.<a class="code" href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">build_patches</a>();</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;* </div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;       std::ofstream out(<span class="stringliteral">&quot;solution-&quot;</span> + <a class="code" href="namespacePatterns_1_1Tools.html#a72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(this-&gt;refinement_cycle) +</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;                         <span class="stringliteral">&quot;.vtu&quot;</span>);</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;       data_out.<a class="code" href="classDataOutInterface.html#a78e73ad285a8792ff0f9f227b82eb108">write</a>(out, <a class="code" href="namespaceDataOutBase.html#aa3cbced9f1d4ae661f13018f4c980aa1acff6079f78795530409873a79263ad7e">DataOutBase::vtu</a>);</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;     }</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;* </div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160; </div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;* </div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;     <span class="keywordtype">void</span> PrimalSolver&lt;dim&gt;::assemble_rhs(<a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;rhs)<span class="keyword"> const</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="keyword">     </span>{</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;       <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(*this-&gt;fe,</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;                              this-&gt;quadrature,</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;                               <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> |</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;                                 <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;* </div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell = this-&gt;fe-&gt;n_dofs_per_cell();</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points    = this-&gt;quadrature-&gt;size();</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;* </div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;       <a class="code" href="classVector.html">Vector&lt;double&gt;</a>                       cell_rhs(dofs_per_cell);</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;       std::vector&lt;double&gt;                  rhs_values(n_q_points);</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;       std::vector&lt;types::global_dof_index&gt; local_dof_indices(dofs_per_cell);</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;* </div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;       <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : this-&gt;dof_handler.<a class="code" href="group__CPP11.html#gacdb6d3adec96a13a7079f6c893e1d3ff">active_cell_iterators</a>())</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;         {</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;           cell_rhs = 0;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;* </div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;           fe_values.reinit(cell);</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;* </div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;           rhs_function-&gt;value_list(fe_values.get_quadrature_points(),</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;                                    rhs_values);</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;* </div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; n_q_points; ++q_point)</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;               cell_rhs(i) += (fe_values.shape_value(i, q_point) <span class="comment">// phi_i(x_q)</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;                               rhs_values[q_point]               <span class="comment">// f((x_q)</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;                               fe_values.JxW(q_point));            <span class="comment">// dx</span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;* </div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;           cell-&gt;get_dof_indices(local_dof_indices);</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;             rhs(local_dof_indices[i]) += cell_rhs(i);</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;         }</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;     }</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;* </div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160; </div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;* </div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;TheRefinementGlobalandRefinementKellyclasses&quot;</span>&gt;&lt;/a&gt;  &lt;h4&gt;The RefinementGlobal and RefinementKelly classes&lt;/h4&gt;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;* </div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;* </div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;*  For the following two classes, the same applies as <span class="keywordflow">for</span> most of the above: the <span class="keyword">class </span>is taken from the previous example as-is:</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;* </div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;* </div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;* @code</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;     template &lt;int dim&gt;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;     class RefinementGlobal : <span class="keyword">public</span> PrimalSolver&lt;dim&gt;</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;     {</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;     <span class="keyword">public</span>:</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;       RefinementGlobal(<a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;       coarse_grid,</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;                        <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp; fe,</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;                        <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature&lt;dim&gt;</a> &amp;    quadrature,</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;                        <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature</a>&lt;dim</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;* </div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;- 1&gt; &amp;face_quadrature,</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;                        <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;      rhs_function,</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;                        <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;      boundary_values);</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;* </div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;       <span class="keyword">virtual</span> <span class="keywordtype">void</span> refine_grid() <span class="keyword">override</span>;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;     };</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;* </div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160; </div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;* </div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;     RefinementGlobal&lt;dim&gt;::RefinementGlobal(</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;       <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;       coarse_grid,</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;       <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp; fe,</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;       <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature&lt;dim&gt;</a> &amp;    quadrature,</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;       <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature</a>&lt;dim</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;* </div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;- 1&gt; &amp;face_quadrature,</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;       <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;      rhs_function,</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;       <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;      boundary_values)</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;       : Base&lt;dim&gt;(coarse_grid)</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;       , PrimalSolver&lt;dim&gt;(coarse_grid,</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;                           fe,</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;                           quadrature,</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;                           face_quadrature,</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;                           rhs_function,</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;                           boundary_values)</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;     {}</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;* </div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160; </div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;* </div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;     <span class="keywordtype">void</span> RefinementGlobal&lt;dim&gt;::refine_grid()</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;     {</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;       this-&gt;<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>-&gt;refine_global(1);</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;     }</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;* </div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160; </div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;* </div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;     <span class="keyword">class </span>RefinementKelly : <span class="keyword">public</span> PrimalSolver&lt;dim&gt;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;     {</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;     <span class="keyword">public</span>:</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;       RefinementKelly(<a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;       coarse_grid,</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;                       <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp; fe,</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;                       <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature&lt;dim&gt;</a> &amp;    quadrature,</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;                       <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature</a>&lt;dim</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;* </div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;- 1&gt; &amp;face_quadrature,</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;                       <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;      rhs_function,</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;                       <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;      boundary_values);</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;* </div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;       <span class="keyword">virtual</span> <span class="keywordtype">void</span> refine_grid() <span class="keyword">override</span>;</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;     };</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;* </div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160; </div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;* </div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;     RefinementKelly&lt;dim&gt;::RefinementKelly(</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;       <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;       coarse_grid,</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;       <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp; fe,</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;       <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature&lt;dim&gt;</a> &amp;    quadrature,</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;       <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature</a>&lt;dim</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;* </div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;- 1&gt; &amp;face_quadrature,</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;       <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;      rhs_function,</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;       <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;      boundary_values)</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;       : Base&lt;dim&gt;(coarse_grid)</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;       , PrimalSolver&lt;dim&gt;(coarse_grid,</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;                           fe,</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;                           quadrature,</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;                           face_quadrature,</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;                           rhs_function,</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                           boundary_values)</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;     {}</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;* </div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160; </div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;* </div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;     <span class="keywordtype">void</span> RefinementKelly&lt;dim&gt;::refine_grid()</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;     {</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;       <a class="code" href="classVector.html">Vector&lt;float&gt;</a> estimated_error_per_cell(</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;         this-&gt;<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>-&gt;n_active_cells());</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;       <a class="code" href="classKellyErrorEstimator.html#ae2269e1c9903e9d863b7abd54948af00">KellyErrorEstimator&lt;dim&gt;::estimate</a>(</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;         this-&gt;dof_handler,</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;         <a class="code" href="classQGauss.html">QGauss</a>&lt;dim</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;* </div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;- 1&gt;(this-&gt;fe-&gt;degree + 1),</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;         std::map&lt;<a class="code" href="classunsigned_01int.html">types::boundary_id</a>, <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a>&gt;(),</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;         this-&gt;solution,</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;         estimated_error_per_cell);</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;       <a class="code" href="namespaceGridRefinement.html#a48e5395381ed87155942a61a1edd134d">GridRefinement::refine_and_coarsen_fixed_number</a>(*this-&gt;<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>,</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;                                                       estimated_error_per_cell,</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;                                                       0.3,</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;                                                       0.03);</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;       this-&gt;<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>-&gt;execute_coarsening_and_refinement();</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;     }</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;* </div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160; </div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;* </div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;* </div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;TheRefinementWeightedKellyclass&quot;</span>&gt;&lt;/a&gt;  &lt;h4&gt;The RefinementWeightedKelly <span class="keyword">class</span>&lt;/h4&gt;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;* </div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;* </div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;*  This <span class="keyword">class </span>is a variant of the previous <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a>, in that it allows to weight the refinement indicators we get from the library&#39;s Kelly indicator by some function. We include this class since the goal of this example program is to demonstrate automatic refinement criteria even for complex output quantities such as <a class="code" href="namespaceOpenCASCADE.html#a9509efa83e3b2fa42616fe0623cba696">point</a> <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a> or stresses. If we did not solve a dual problem and compute the weights thereof, we would probably be tempted to give a hand-crafted weighting to the indicators to account for the fact that we are going to evaluate these quantities. This class accepts such a weighting function as argument to its constructor:</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;* </div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;* </div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;* @code</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;     template &lt;int dim&gt;</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;     class RefinementWeightedKelly : <span class="keyword">public</span> PrimalSolver&lt;dim&gt;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;     {</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;     <span class="keyword">public</span>:</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;       RefinementWeightedKelly(<a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;       coarse_grid,</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;                               <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp; fe,</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;                               <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature&lt;dim&gt;</a> &amp;    quadrature,</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;                               <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature</a>&lt;dim</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;* </div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;- 1&gt; &amp;face_quadrature,</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;                               <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;      rhs_function,</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;                               <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;      boundary_values,</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;                               <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;      weighting_function);</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;* </div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;       <span class="keyword">virtual</span> <span class="keywordtype">void</span> refine_grid() <span class="keyword">override</span>;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;* </div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;     <span class="keyword">private</span>:</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;       <span class="keyword">const</span> <a class="code" href="classSmartPointer.html">SmartPointer&lt;const Function&lt;dim&gt;</a>&gt; weighting_function;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;     };</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;* </div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160; </div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;* </div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;     RefinementWeightedKelly&lt;dim&gt;::RefinementWeightedKelly(</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;       <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;       coarse_grid,</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;       <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp; fe,</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;       <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature&lt;dim&gt;</a> &amp;    quadrature,</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;       <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature</a>&lt;dim</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;* </div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;- 1&gt; &amp;face_quadrature,</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;       <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;      rhs_function,</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;       <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;      boundary_values,</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;       <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;      weighting_function)</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;       : Base&lt;dim&gt;(coarse_grid)</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;       , PrimalSolver&lt;dim&gt;(coarse_grid,</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;                           fe,</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;                           quadrature,</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;                           face_quadrature,</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;                           rhs_function,</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;                           boundary_values)</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;       , weighting_function(&amp;weighting_function)</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;     {}</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;* </div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160; </div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;* </div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;* </div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;*  Now, here comes the main <span class="keyword">function</span>, including the weighting:</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;* </div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;* </div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;* @code</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;     <span class="keywordtype">void</span> RefinementWeightedKelly&lt;dim&gt;::refine_grid()</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;     {</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;* </div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;*  First compute some residual based error indicators <span class="keywordflow">for</span> all cells by a method already implemented in the library. What exactly we compute here is described in more detail in the documentation of that <span class="keyword">class</span>.</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;* </div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;* </div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;* @code</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;       <a class="code" href="classVector.html">Vector&lt;float&gt;</a> estimated_error_per_cell(</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;         this-&gt;<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>-&gt;n_active_cells());</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;       std::map&lt;types::boundary_id, const Function&lt;dim&gt;&gt; dummy_function_map;</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;       <a class="code" href="classKellyErrorEstimator.html#ae2269e1c9903e9d863b7abd54948af00">KellyErrorEstimator&lt;dim&gt;::estimate</a>(this-&gt;dof_handler,</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;                                         this-&gt;face_quadrature,</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;                                          dummy_function_map,</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;                                          this-&gt;solution,</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;                                          estimated_error_per_cell);</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;* </div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;* </div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;*  Next weigh each entry in the vector of indicators by the <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a> of the <span class="keyword">function</span> given to the constructor, evaluated at the cell <a class="code" href="data__out__base_8cc.html#a8188ef4709fc9a4cc076d37447783ba1">center</a>. We need to write the result into the vector entry that corresponds to the current cell, which we can obtain by asking the cell what its index among all active cells is <span class="keyword">using</span>   <a class="code" href="classCellAccessor.html#ad4b8ec35236bea8ee91a72bbd19762fe">CellAccessor::active_cell_index</a>().   (In reality, <span class="keyword">this</span> index is <a class="code" href="namespaceLAPACKSupport.html#a0d8802698d585eec62a2a54e6387b05b">zero</a> <span class="keywordflow">for</span> the <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> cell we handle in the <a class="code" href="group__MeshWorker.html#gad10f528ab87f39fbb0531d24f238b2f3">loop</a>, <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> <span class="keywordflow">for</span> the <a class="code" href="grid__out_8cc.html#a2cc229a4f1ffc75e83ed269d5f725729">second</a> cell, etc., and we could as well just keep track of <span class="keyword">this</span> index <span class="keyword">using</span> an integer counter; but <span class="keyword">using</span>   <a class="code" href="classCellAccessor.html#ad4b8ec35236bea8ee91a72bbd19762fe">CellAccessor::active_cell_index</a>()   makes this more explicit.)</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;* </div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;* </div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;* @code</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;       for (const auto &amp;cell : this-&gt;dof_handler.active_cell_iterators())</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;         estimated_error_per_cell(cell-&gt;active_cell_index())=</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;           weighting_function-&gt;value(cell-&gt;<a class="code" href="data__out__base_8cc.html#a8188ef4709fc9a4cc076d37447783ba1">center</a>());</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;* </div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;       <a class="code" href="namespaceGridRefinement.html">GridRefinement</a>::<a class="code" href="namespaceparallel_1_1distributed_1_1GridRefinement.html#aa2ffb707a796ae6dedb75036606ef2e6">refine_and_coarsen_fixed_number</a>(*this-&gt;<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>,</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;                                                       estimated_error_per_cell,</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;                                                       0.3,</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;                                                       0.03);</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;       this-&gt;triangulation-&gt;execute_coarsening_and_refinement();</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;     }</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;* </div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;   } <span class="comment">// namespace LaplaceSolver</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;* </div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160; </div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160; @endcode</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;* </div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;*   &lt;a name=&quot;Equationdata&quot;&gt;&lt;/a&gt;  &lt;h3&gt;Equation data&lt;/h3&gt;   </div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;*   In this example program, we work with the same data sets as in the previous <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a>, but as it may so happen that someone wants to <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a> the program with different boundary <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a> and right hand side <a class="code" href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">functions</a>, or on a different grid, we show a simple technique to do exactly that. For more clarity, we furthermore <a class="code" href="namespaceUtilities.html#a1ebf9e8745b1c1c0f314d24a1ec90921">pack</a> everything that has to do with equation data into a namespace of its own.   </div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;*   The underlying assumption is that this is a research program, and that there we often have a number of test cases that consist of a domain, a right hand side, boundary <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a>, possibly a specified coefficient, and a number of other parameters. They often vary all at the same time when shifting from one example to another. To make handling such sets of problem description parameters simple is the goal of the following.   </div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;*   Basically, the idea is this: let us have a structure for each <a class="code" href="group__CUDAWrappers.html#gabb7130e2cea54654455ca41ef304f939">set</a> of data, in which we <a class="code" href="namespaceUtilities.html#a1ebf9e8745b1c1c0f314d24a1ec90921">pack</a> everything that describes a test case: here, these are two subclasses, one called   &lt;code&gt;BoundaryValues&lt;/code&gt;   for the boundary values of the exact solution, and one called   &lt;code&gt;RightHandSide&lt;/code&gt;  , and then a way to generate the coarse grid. Since the solution of the previous example program looked like curved ridges, we use this name here for the enclosing class. Note that the names of the two inner classes have to be the same for all enclosing test case classes, and also that we have attached the dimension template argument to the enclosing class rather than to the inner ones, to make further processing simpler.  (From a language viewpoint, a namespace would be better to encapsulate these inner classes, rather than a structure. However, namespaces cannot be given as template arguments, so we use a structure to allow a <a class="code" href="grid__out_8cc.html#a2cc229a4f1ffc75e83ed269d5f725729">second</a> <span class="keywordtype">object</span> to select from within its given argument. The enclosing structure, of course, has no member variables apart from the classes it declares, and a static function to generate the coarse mesh; it will in <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98af25b68380698c53fa6da3e05379c0855">general</a> never be instantiated.)   </div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;*   The idea is then the following (this is the right time to also take a brief look at the code below): we can generate objects for boundary values and right hand side by simply giving the name of the outer class as a template argument to a class which we <a class="code" href="namespaceThreads_1_1internal.html#a8d237a30d09b13e0b5adbe0fd1dfb188">call</a> here   &lt;code&gt;Data::SetUp&lt;/code&gt;  , and it then creates objects for the inner classes. In this case, to get all that characterizes the curved ridge solution, we would simply generate an instance of   &lt;code&gt;Data::SetUp@&lt;Data::CurvedRidge@&gt;&lt;/code&gt;  , and everything we need to know about the solution would be static member variables and functions of that <span class="keywordtype">object</span>.   </div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;*   This approach might seem like overkill in this case, but will become very handy once a certain <a class="code" href="group__CUDAWrappers.html#gabb7130e2cea54654455ca41ef304f939">set</a> up is not only characterized by Dirichlet boundary values and a right hand side function, but in addition by material properties, Neumann values, different boundary descriptors, etc. In that case, the   &lt;code&gt;SetUp&lt;/code&gt;   class might consist of a dozen or more objects, and each descriptor class (like the   &lt;code&gt;CurvedRidges&lt;/code&gt;   class below) would have to provide them. Then, you will be happy to be able to change from one <a class="code" href="group__CUDAWrappers.html#gabb7130e2cea54654455ca41ef304f939">set</a> of data to another by only changing the template argument to the   &lt;code&gt;SetUp&lt;/code&gt;   class at one place, rather than at many.   </div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;*   With this framework for different test cases, we are almost finished, but one thing remains: by now we can select statically, by changing one template argument, which data <a class="code" href="group__CUDAWrappers.html#gabb7130e2cea54654455ca41ef304f939">set</a> to choose. In order to be able to do that dynamically, i.<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>. at <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a> time, we need a base class. This we provide in the obvious way, see below, with virtual abstract functions. It forces us to introduce a <a class="code" href="grid__out_8cc.html#a2cc229a4f1ffc75e83ed269d5f725729">second</a> template parameter   &lt;code&gt;dim&lt;/code&gt;   which we need for the base class (which could be avoided using some template magic, but we omit that), but that&#39;s all.   </div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;*   Adding new testcases is now simple, you don&#39;t have to touch the framework classes, only a structure like the   &lt;code&gt;CurvedRidges&lt;/code&gt;   one is needed.</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;* </div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;* </div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;* @code</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;   namespace Data</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;   {</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;* </div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;TheSetUpBaseandSetUpclasses&quot;</span>&gt;&lt;/a&gt;  &lt;h4&gt;The SetUpBase and SetUp classes&lt;/h4&gt;</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;* </div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;* </div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;*  Based on the above description, the   &lt;code&gt;SetUpBase&lt;/code&gt;   <span class="keyword">class </span>then looks as follows. To allow using the   &lt;code&gt;<a class="code" href="classSmartPointer.html">SmartPointer</a>&lt;/code&gt;   class with this class, we derived from the   &lt;code&gt;<a class="code" href="classSubscriptor.html">Subscriptor</a>&lt;/code&gt;   class.</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;* </div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;* </div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;* @code</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;     <span class="keyword">struct </span>SetUpBase : <span class="keyword">public</span> <a class="code" href="classSubscriptor.html">Subscriptor</a></div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;     {</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;       <span class="keyword">virtual</span> <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;get_boundary_values() <span class="keyword">const</span> = 0;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;* </div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;       <span class="keyword">virtual</span> <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;get_right_hand_side() <span class="keyword">const</span> = 0;</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;* </div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;       <span class="keyword">virtual</span> <span class="keywordtype">void</span></div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;       create_coarse_grid(<a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;coarse_grid) <span class="keyword">const</span> = 0;</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;     };</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;* </div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160; </div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;* </div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;*  And now <span class="keywordflow">for</span> the derived <span class="keyword">class </span>that takes the template argument as explained above.     </div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;*   Here we <a class="code" href="namespaceUtilities.html#a1ebf9e8745b1c1c0f314d24a1ec90921">pack</a> the data elements into <span class="keyword">private</span> variables, and allow access to them through the methods of the base <span class="keyword">class</span>.</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;* </div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;* </div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;* @code</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;     <span class="keyword">template</span> &lt;<span class="keyword">class</span> Traits, <span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;     <span class="keyword">struct </span>SetUp : <span class="keyword">public</span> SetUpBase&lt;dim&gt;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;     {</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;       <span class="keyword">virtual</span> <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;get_boundary_values() <span class="keyword">const override</span>;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;* </div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;       <span class="keyword">virtual</span> <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;get_right_hand_side() <span class="keyword">const override</span>;</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;* </div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160; </div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;       <span class="keyword">virtual</span> <span class="keywordtype">void</span></div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;       create_coarse_grid(<a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;coarse_grid) <span class="keyword">const override</span>;</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;* </div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;     <span class="keyword">private</span>:</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;       <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">typename</span> Traits::BoundaryValues boundary_values;</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;       <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">typename</span> Traits::RightHandSide  right_hand_side;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;     };</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;* </div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;* </div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;*  We have to provide definitions <span class="keywordflow">for</span> the <span class="keyword">static</span> member variables of the above <span class="keyword">class</span>:</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;* </div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;* </div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;* @code</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;     <span class="keyword">template</span> &lt;<span class="keyword">class</span> Traits, <span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;     <span class="keyword">const</span> <span class="keyword">typename</span> Traits::BoundaryValues SetUp&lt;Traits, dim&gt;::boundary_values;</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;     <span class="keyword">template</span> &lt;<span class="keyword">class</span> Traits, <span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;     <span class="keyword">const</span> <span class="keyword">typename</span> Traits::RightHandSide SetUp&lt;Traits, dim&gt;::right_hand_side;</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;* </div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;* </div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;*  And definitions of the member <a class="code" href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">functions</a>:</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;* </div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;* </div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;* @code</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;     <span class="keyword">template</span> &lt;<span class="keyword">class</span> Traits, <span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;     <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;SetUp&lt;Traits, dim&gt;::get_boundary_values()<span class="keyword"> const</span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;<span class="keyword">     </span>{</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;       <span class="keywordflow">return</span> boundary_values;</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;     }</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;* </div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160; </div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;     <span class="keyword">template</span> &lt;<span class="keyword">class</span> Traits, <span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;     <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;SetUp&lt;Traits, dim&gt;::get_right_hand_side()<span class="keyword"> const</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;<span class="keyword">     </span>{</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;       <span class="keywordflow">return</span> right_hand_side;</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;     }</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;* </div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160; </div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;     <span class="keyword">template</span> &lt;<span class="keyword">class</span> Traits, <span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;     <span class="keywordtype">void</span> SetUp&lt;Traits, dim&gt;::create_coarse_grid(</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;       <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;coarse_grid)<span class="keyword"> const</span></div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;<span class="keyword">     </span>{</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;       Traits::create_coarse_grid(coarse_grid);</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;     }</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;* </div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160; </div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;* </div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;TheCurvedRidgesclass&quot;</span>&gt;&lt;/a&gt;  &lt;h4&gt;The CurvedRidges <span class="keyword">class</span>&lt;/h4&gt;</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;* </div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;* </div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;*  The <span class="keyword">class </span>that is used to describe the boundary values and right hand side of the   &lt;code&gt;curved ridge&lt;/code&gt;   problem already used in the   @ref step_13 &quot;step-13&quot;   example program is then like so:</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;* </div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;* </div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;* @code</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;     template &lt;int dim&gt;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;     struct CurvedRidges</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;     {</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;       <span class="keyword">class </span>BoundaryValues : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;       {</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;       <span class="keyword">public</span>:</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;         <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p,</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;                              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component) <span class="keyword">const</span>;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;       };</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;* </div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160; </div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;       <span class="keyword">class </span>RightHandSide : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;       {</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;       <span class="keyword">public</span>:</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;         <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p,</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;                              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component) <span class="keyword">const</span>;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;       };</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;* </div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;       <span class="keyword">static</span> <span class="keywordtype">void</span> create_coarse_grid(<a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;coarse_grid);</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;     };</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;* </div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160; </div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;     <span class="keywordtype">double</span> CurvedRidges&lt;dim&gt;::BoundaryValues::value(</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;       <span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp;p,</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  <span class="comment">/*component*/</span> )<span class="keyword"> const</span></div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="keyword">     </span>{</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;       <span class="keywordtype">double</span> q = p(0);</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 1; i &lt; dim; ++i)</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;         q += std::sin(10 p(i) + 5 p(0) p(0));</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;       <span class="keyword">const</span> <span class="keywordtype">double</span> exponential = <a class="code" href="vectorization_8h.html#a19f846bda83b7e3f4531daacb40c64e1">std::exp</a>(q);</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;       <span class="keywordflow">return</span> exponential;</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;     }</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;* </div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160; </div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;* </div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;     <span class="keywordtype">double</span> CurvedRidges&lt;dim&gt;::RightHandSide::value(</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;       <span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp;p,</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  <span class="comment">/*component*/</span> )<span class="keyword"> const</span></div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;<span class="keyword">     </span>{</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;       <span class="keywordtype">double</span> q = p(0);</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 1; i &lt; dim; ++i)</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;         q += std::sin(10 p(i) + 5 p(0) p(0));</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;       <span class="keyword">const</span> <span class="keywordtype">double</span> u  = <a class="code" href="vectorization_8h.html#a19f846bda83b7e3f4531daacb40c64e1">std::exp</a>(q);</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;       <span class="keywordtype">double</span>       t1 = 1, t2 = 0, t3 = 0;</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 1; i &lt; dim; ++i)</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;         {</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;           t1 += <a class="code" href="vectorization_8h.html#a11c48f86a4f2adf21555e64049ecde8c">std::cos</a>(10 p(i) + 5 p(0) p(0)) 10 p(0);</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;           t2 += 10 <a class="code" href="vectorization_8h.html#a11c48f86a4f2adf21555e64049ecde8c">std::cos</a>(10 p(i) + 5 p(0) p(0))</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;* </div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;-</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;                 100 <a class="code" href="vectorization_8h.html#ad9b7aa5c50bf9ce988a0f756a3f2baa5">std::sin</a>(10 p(i) + 5 p(0) p(0)) p(0) p(0);</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;           t3 += 100 <a class="code" href="namespacestd.html">std</a>::cos(10 p(i) + 5 p(0) p(0))</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;                   <a class="code" href="namespacestd.html">std</a>::cos(10 p(i) + 5 p(0) p(0))</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;* </div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;-</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;                 100 <a class="code" href="namespacestd.html">std</a>::sin(10 p(i) + 5 p(0) p(0));</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;         }</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;       t1 = t1 t1;</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;* </div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;       return</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;* </div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;-u (t1 + t2 + t3);</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;     }</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;* </div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160; </div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;     template &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;     <span class="keywordtype">void</span> CurvedRidges&lt;dim&gt;::create_coarse_grid(<a class="code" href="classTriangulation.html">Triangulation</a>&lt;dim&gt; &amp;coarse_grid)</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;     {</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;       <a class="code" href="namespaceGridGenerator.html#acea0cbcd68e52ce8113d1134b87de403">GridGenerator::hyper_cube</a>(coarse_grid,</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;* </div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;-1, 1);</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;       coarse_grid.refine_global(2);</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;     }</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;* </div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160; </div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;* </div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;TheExercise_2_3class&quot;</span>&gt;&lt;/a&gt;  &lt;h4&gt;The Exercise_2_3 <span class="keyword">class</span>&lt;/h4&gt;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;* </div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;* </div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;*  This example program was written <span class="keywordflow">while</span> giving practical courses <span class="keywordflow">for</span> a lecture on adaptive finite element methods and duality based error estimates. For these courses, we had one exercise, which required to solve the Laplace equation with constant right hand side on a square domain with a square hole in the <a class="code" href="data__out__base_8cc.html#a8188ef4709fc9a4cc076d37447783ba1">center</a>, and <a class="code" href="namespaceLAPACKSupport.html#a0d8802698d585eec62a2a54e6387b05b">zero</a> boundary values. Since the implementation of the properties of <span class="keyword">this</span> problem is so particularly simple here, lets <span class="keywordflow">do</span> it. As the number of the exercise was 2.3, we take the liberty to retain <span class="keyword">this</span> name <span class="keywordflow">for</span> the <span class="keyword">class </span>as well.</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;* </div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;* </div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;* @code</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;     <span class="keyword">struct </span>Exercise_2_3</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;     {</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;* </div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;*  We need a <span class="keyword">class </span>to denote the boundary values of the problem. In this case, this is simple: it&#39;s the <a class="code" href="namespaceLAPACKSupport.html#a0d8802698d585eec62a2a54e6387b05b">zero</a> function, so don&#39;t even declare a class, just an alias:</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;* </div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;* </div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;* @code</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;       using BoundaryValues = <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction</a>&lt;dim&gt;;</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;* </div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;* </div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;*  Second, a <span class="keyword">class </span>that denotes the right hand side. Since they are constant, just subclass the corresponding class of the library and be done:</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;* </div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;* </div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;* @code</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;       class RightHandSide : <span class="keyword">public</span> <a class="code" href="classFunctions_1_1ConstantFunction.html">Functions::ConstantFunction</a>&lt;dim&gt;</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;       {</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;       <span class="keyword">public</span>:</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;         RightHandSide()</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;           : <a class="code" href="namespaceFunctions.html">Functions</a>::<a class="code" href="classFunctions_1_1ConstantFunction.html">ConstantFunction</a>&lt;dim&gt;(1.)</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;         {}</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;       };</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;* </div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;* </div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;*  Finally a <span class="keyword">function</span> to generate the coarse grid. This is somewhat more complicated here, see immediately below.</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;* </div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;* </div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;* @code</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;       <span class="keyword">static</span> <span class="keywordtype">void</span> create_coarse_grid(<a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;coarse_grid);</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;     };</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;* </div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160; </div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;* </div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;*  As stated above, the grid <span class="keywordflow">for</span> <span class="keyword">this</span> example is the square [-1,1]^2 with the square [-1/2,1/2]^2 as hole in it. We create the coarse grid as 4 times 4 cells with the middle four ones missing. To understand how exactly the mesh is going to look, it may be simplest to just look at the <span class="stringliteral">&quot;Results&quot;</span> section of <span class="keyword">this</span> tutorial program <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a>. In <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98af25b68380698c53fa6da3e05379c0855">general</a>, <span class="keywordflow">if</span> you<span class="stringliteral">&#39;d like to understand more about creating meshes either from scratch by hand, as we do here, or using other techniques, you should take a look at   @ref step_49 &quot;step-49&quot;  .     </span></div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;<span class="stringliteral">*   Of course, the example has an extension to 3d, but since this function cannot be written in a dimension independent way we choose not to implement this here, but rather only specialize the template for dim=2. If you compile the program for 3d, you&#39;</span>ll <span class="keyword">get</span> a message from the linker that <span class="keyword">this</span> <span class="keyword">function</span> is not implemented <span class="keywordflow">for</span> 3<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>, and needs to be provided.     </div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;*   For the creation of <span class="keyword">this</span> geometry, the library has no predefined method. In <span class="keyword">this</span> <span class="keywordflow">case</span>, the geometry is still simple enough to <span class="keywordflow">do</span> the creation by hand, rather than <span class="keyword">using</span> a mesh generator.</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;* </div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;* </div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;* @code</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;     <span class="keyword">template</span> &lt;&gt;</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;     <span class="keywordtype">void</span> Exercise_2_3&lt;2&gt;::create_coarse_grid(<a class="code" href="classTriangulation.html">Triangulation&lt;2&gt;</a> &amp;coarse_grid)</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;     {</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;* </div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;*  We <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> define the space dimension, to allow those parts of the <span class="keyword">function</span> that are actually dimension independent to use <span class="keyword">this</span> variable. That makes it simpler <span class="keywordflow">if</span> you later take <span class="keyword">this</span> as a starting <a class="code" href="namespaceOpenCASCADE.html#a9509efa83e3b2fa42616fe0623cba696">point</a> to implement a 3d version of <span class="keyword">this</span> mesh. The next step is then to have a list of <a class="code" href="data__out__base_8cc.html#accc45da40beb7ae1b485306984e904a2">vertices</a>. Here, they are 24 (5 times 5, with the middle one omitted). It is probably best to draw a sketch here.</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;* </div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;* </div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;* @code</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dim = 2;</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;* </div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;       <span class="keyword">const</span> std::vector&lt;<a class="code" href="classPoint.html">Point&lt;2&gt;</a>&gt; <a class="code" href="data__out__base_8cc.html#accc45da40beb7ae1b485306984e904a2">vertices</a> = {</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;         {-1.0,</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;* </div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;-1.0}, {-0.5,</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;* </div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;-1.0}, {+0.0,</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;* </div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;-1.0}, {+0.5,</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;* </div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;-1.0}, {+1.0,</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;* </div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;-1.0}, </div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;         {-1.0,</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;* </div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;-0.5}, {-0.5,</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;* </div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;-0.5}, {+0.0,</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;* </div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;-0.5}, {+0.5,</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;* </div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;-0.5}, {+1.0,</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;* </div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;-0.5}, </div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;         {-1.0, +0.0}, {-0.5, +0.0}, {+0.5, +0.0}, {+1.0, +0.0},               </div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;         {-1.0, +0.5}, {-0.5, +0.5}, {+0.0, +0.5}, {+0.5, +0.5}, {+1.0, +0.5}, </div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;         {-1.0, +1.0}, {-0.5, +1.0}, {+0.0, +1.0}, {+0.5, +1.0}, {+1.0, +1.0}};</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;* </div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;* </div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;*  Next, we have to define the cells and the <a class="code" href="data__out__base_8cc.html#accc45da40beb7ae1b485306984e904a2">vertices</a> they contain.</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;* </div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;* </div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;* @code</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;       <span class="keyword">const</span> std::vector&lt;std::array&lt;int, GeometryInfo&lt;dim&gt;::vertices_per_cell&gt;&gt;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;         cell_vertices = {{{0, 1, 5, 6}},</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;                          {{1, 2, 6, 7}},</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;                          {{2, 3, 7, 8}},</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;                          {{3, 4, 8, 9}},</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;                          {{5, 6, 10, 11}},</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;                          {{8, 9, 12, 13}},</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;                          {{10, 11, 14, 15}},</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;                          {{12, 13, 17, 18}},</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;                          {{14, 15, 19, 20}},</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;                          {{15, 16, 20, 21}},</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;                          {{16, 17, 21, 22}},</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;                          {{17, 18, 22, 23}}};</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;* </div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a> = cell_vertices.size();</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;* </div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;* </div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;*  Again, we generate a C++ vector type from <span class="keyword">this</span>, but <span class="keyword">this</span> time by looping over the cells (yes, <span class="keyword">this</span> is boring). Additionally, we <span class="keyword">set</span> the material indicator to <a class="code" href="namespaceLAPACKSupport.html#a0d8802698d585eec62a2a54e6387b05b">zero</a> <span class="keywordflow">for</span> all the cells:</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;* </div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;* </div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;* @code</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;       std::vector&lt;CellData&lt;dim&gt;&gt; cells(n_cells, <a class="code" href="structCellData.html">CellData&lt;dim&gt;</a>());</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>; ++i)</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;         {</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; cell_vertices[i].size(); ++j)</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;             cells[i].<a class="code" href="data__out__base_8cc.html#accc45da40beb7ae1b485306984e904a2">vertices</a>[j] = cell_vertices[i][j];</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;           cells[i].material_id = 0;</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;         }</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;* </div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;* </div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;*  Finally pass all <span class="keyword">this</span> information to the library to generate a triangulation. The last parameter may be used to pass information about non-<a class="code" href="namespaceLAPACKSupport.html#a0d8802698d585eec62a2a54e6387b05b">zero</a> boundary indicators at certain faces of the triangulation to the library, but we don<span class="stringliteral">&#39;t want that here, so we give an empty object:</span></div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;<span class="stringliteral">       coarse_grid.create_triangulation(vertices, cells, SubCellData());</span></div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;<span class="stringliteral">*  And since we want that the evaluation point (3/4,3/4) in this example is a grid point, we refine once globally:</span></div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;<span class="stringliteral">       coarse_grid.refine_global(1);</span></div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;<span class="stringliteral">     }</span></div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;<span class="stringliteral">   } // namespace Data</span></div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;<span class="stringliteral">*   &lt;a name=&quot;Discussion&quot;&gt;&lt;/a&gt;  &lt;h4&gt;Discussion&lt;/h4&gt;   </span></div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;<span class="stringliteral">*   As you have now read through this framework, you may be wondering why we have not chosen to implement the classes implementing a certain setup (like the   &lt;code&gt;CurvedRidges&lt;/code&gt;   class) directly as classes derived from   &lt;code&gt;Data::SetUpBase&lt;/code&gt;  . Indeed, we could have done very well so. The only reason is that then we would have to have member variables for the solution and right hand side classes in the   &lt;code&gt;CurvedRidges&lt;/code&gt;   class, as well as member functions overloading the abstract functions of the base class giving access to these member variables. The   &lt;code&gt;SetUp&lt;/code&gt;   class has the sole reason to relieve us from the need to reiterate these member variables and functions that would be necessary in all such classes. In some way, the template mechanism here only provides a way to have default implementations for a number of functions that depend on external quantities and can thus not be provided using normal virtual functions, at least not without the help of templates.   </span></div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;<span class="stringliteral">*   However, there might be good reasons to actually implement classes derived from   &lt;code&gt;Data::SetUpBase&lt;/code&gt;  , for example if the solution or right hand side classes require constructors that take arguments, which the   &lt;code&gt;Data::SetUpBase&lt;/code&gt;   class cannot provide. In that case, subclassing is a worthwhile strategy. Other possibilities for special cases are to derive from   &lt;code&gt;Data::SetUp@&lt;SomeSetUp@&gt;&lt;/code&gt;   where   &lt;code&gt;SomeSetUp&lt;/code&gt;   denotes a class, or even to explicitly specialize   &lt;code&gt;Data::SetUp@&lt;SomeSetUp@&gt;&lt;/code&gt;  . The latter allows to transparently use the way the   &lt;code&gt;SetUp&lt;/code&gt;   class is used for other set-ups, but with special actions taken for special arguments.   </span></div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;<span class="stringliteral">*   A final observation favoring the approach taken here is the following: we have found numerous times that when starting a project, the number of parameters (usually boundary values, right hand side, coarse grid, just as here) was small, and the number of test cases was small as well. One then starts out by handcoding them into a number of   &lt;code&gt;switch&lt;/code&gt;   statements. Over time, projects grow, and so does the number of test cases. The number of   &lt;code&gt;switch&lt;/code&gt;   statements grows with that, and their length as well, and one starts to find ways to consider impossible examples where domains, boundary values, and right hand sides do not fit together any more, and starts losing the overview over the whole structure. Encapsulating everything belonging to a certain test case into a structure of its own has proven worthwhile for this, as it keeps everything that belongs to one test case in one place. Furthermore, it allows to put these things all in one or more files that are only devoted to test cases and their data, without having to bring their actual implementation into contact with the rest of the program.</span></div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="stringliteral">*  </span></div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;<span class="stringliteral">*  </span></div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;<span class="stringliteral">*  &lt;a name=&quot;Dualfunctionals&quot;&gt;&lt;/a&gt;  &lt;h3&gt;Dual functionals&lt;/h3&gt;</span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;<span class="stringliteral">*  As with the other components of the program, we put everything we need to describe dual functionals into a namespace of its own, and define an abstract base class that provides the interface the class solving the dual problem needs for its work.   </span></div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;<span class="stringliteral">*   We will then implement two such classes, for the evaluation of a point value and of the derivative of the solution at that point. For these functionals we already have the corresponding evaluation objects, so they are complementary.</span></div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;<span class="stringliteral">   namespace DualFunctional</span></div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;<span class="stringliteral">   {</span></div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;<span class="stringliteral">*   &lt;a name=&quot;TheDualFunctionalBaseclass&quot;&gt;&lt;/a&gt;  &lt;h4&gt;The DualFunctionalBase class&lt;/h4&gt;</span></div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;<span class="stringliteral">*  First start with the base class for dual functionals. Since for linear problems the characteristics of the dual problem play a role only in the right hand side, we only need to provide for a function that assembles the right hand side for a given discretization:</span></div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;<span class="stringliteral">     template &lt;int dim&gt;</span></div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;<span class="stringliteral">     class DualFunctionalBase : public Subscriptor</span></div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;<span class="stringliteral">     {</span></div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;<span class="stringliteral">     public:</span></div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;<span class="stringliteral">       virtual void assemble_rhs(const DoFHandler&lt;dim&gt; &amp;dof_handler,</span></div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;<span class="stringliteral">                                 Vector&lt;double&gt; &amp;       rhs) const = 0;</span></div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;<span class="stringliteral">     };</span></div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;<span class="stringliteral">*   &lt;a name=&quot;ThedualfunctionalPointValueEvaluationclass&quot;&gt;&lt;/a&gt;  &lt;h4&gt;The dual functional PointValueEvaluation class&lt;/h4&gt;</span></div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;<span class="stringliteral">*  As a first application, we consider the functional corresponding to the evaluation of the solution&#39;</span>s <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a> at a given <a class="code" href="namespaceOpenCASCADE.html#a9509efa83e3b2fa42616fe0623cba696">point</a> which again we assume to be a vertex. Apart from the constructor that takes and stores the evaluation <a class="code" href="namespaceOpenCASCADE.html#a9509efa83e3b2fa42616fe0623cba696">point</a>, <span class="keyword">this</span> <span class="keyword">class </span>consists only of the function that <span class="keyword">implements</span> assembling the right hand side.</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;* </div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;* </div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;* @code</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;     template &lt;int dim&gt;</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;     class PointValueEvaluation : <span class="keyword">public</span> DualFunctionalBase&lt;dim&gt;</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;     {</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;     <span class="keyword">public</span>:</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;       PointValueEvaluation(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp;evaluation_point);</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;* </div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;       <span class="keyword">virtual</span> <span class="keywordtype">void</span> assemble_rhs(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;                                 <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;       rhs) <span class="keyword">const override</span>;</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;* </div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;       <a class="code" href="namespaceinternal.html#a3ad80900781e8648c01c491a7545894e">DeclException1</a>(</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;         ExcEvaluationPointNotFound,</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;         <a class="code" href="classPoint.html">Point&lt;dim&gt;</a>,</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;         &lt;&lt; <span class="stringliteral">&quot;The evaluation point &quot;</span> &lt;&lt; arg1</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; was not found among the vertices of the present grid.&quot;</span>);</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;* </div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;     <span class="keyword">protected</span>:</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;       <span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> evaluation_point;</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;     };</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;* </div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160; </div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;     PointValueEvaluation&lt;dim&gt;::PointValueEvaluation(</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;       <span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp;evaluation_point)</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;       : evaluation_point(evaluation_point)</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;     {}</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;* </div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160; </div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;* </div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;*  As <span class="keywordflow">for</span> doing the main purpose of the <span class="keyword">class</span>, assembling the right hand side, let us <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> consider what is necessary: The right hand side of the dual problem is a vector of values J(phi_i), where J is the error functional, and phi_i is the i-th shape <span class="keyword">function</span>. Here, J is the evaluation at the point x0, i.e. J(phi_i)=phi_i(x0).     </div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;*   Now, we have assumed that the evaluation point is a vertex. Thus, <span class="keywordflow">for</span> the usual finite elements we might be <span class="keyword">using</span> in <span class="keyword">this</span> program, we can take <span class="keywordflow">for</span> granted that at such a point exactly one shape <span class="keyword">function</span> is <a class="code" href="namespaceDoFTools.html#ad31df71a29dd76de9b4ab241b2527160a155b9e72113d7008c60732d350bfbb7a">nonzero</a>, and in particular has the <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a> one. Thus, we <span class="keyword">set</span> the right hand side vector to all-zeros, then seek <span class="keywordflow">for</span> the shape <span class="keyword">function</span> associated with that point and <span class="keyword">set</span> the corresponding <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a> of the right hand side vector to <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a>:</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;* </div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;* </div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;* @code</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;     <span class="keywordtype">void</span></div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;     PointValueEvaluation&lt;dim&gt;::assemble_rhs(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;                                             <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;       rhs)<span class="keyword"> const</span></div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;<span class="keyword">     </span>{</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;* </div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;*  So, <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> <span class="keyword">set</span> everything to zeros...</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;* </div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;* </div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;* @code</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;       rhs.<a class="code" href="classVector.html#ac4a4dbef7dd65ef8ad35ae56b57d7c05">reinit</a>(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;* </div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;* </div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;*  ...then loop over cells and find the evaluation point among the <a class="code" href="data__out__base_8cc.html#accc45da40beb7ae1b485306984e904a2">vertices</a> (or very close to a vertex, which may happen due to floating point round-off):</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;* </div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;* </div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;* @code</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;       for (const auto &amp;cell : dof_handler.active_cell_iterators())</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;         for (const auto vertex : cell-&gt;<a class="code" href="grid__tools_8cc.html#a9bb17554c06536e62c37d90eb7a28d6a">vertex_indices</a>())</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;           if (cell-&gt;vertex(vertex).distance(evaluation_point) &lt;</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;               cell-&gt;<a class="code" href="namespaceGridTools.html#acd5ccc543d561cfb086b571d1f7818cb">diameter</a>() 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-8)</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;             {</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;* </div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;*  Ok, found, so <span class="keyword">set</span> corresponding entry, and leave <span class="keyword">function</span> since we are finished:</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;* </div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;* </div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;* @code</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;               rhs(cell-&gt;vertex_dof_index(vertex, 0)) = 1;</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;               <span class="keywordflow">return</span>;</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;             }</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;* </div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;* </div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;*  Finally, a sanity check: <span class="keywordflow">if</span> we somehow got here, then we must have missed the evaluation <a class="code" href="namespaceOpenCASCADE.html#a9509efa83e3b2fa42616fe0623cba696">point</a>, so <span class="keyword">raise</span> an exception unconditionally:</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;* </div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;* </div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;* @code</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;       <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, ExcEvaluationPointNotFound(evaluation_point));</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;     }</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;* </div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160; </div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;* </div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;ThedualfunctionalPointXDerivativeEvaluationclass&quot;</span>&gt;&lt;/a&gt;  &lt;h4&gt;The dual functional PointXDerivativeEvaluation <span class="keyword">class</span>&lt;/h4&gt;</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;* </div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;* </div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;*  As <a class="code" href="grid__out_8cc.html#a2cc229a4f1ffc75e83ed269d5f725729">second</a> application, we again consider the evaluation of the x-derivative of the solution at one point. Again, the declaration of the <span class="keyword">class</span>, and the implementation of its constructor is not too interesting:</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;* </div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;* </div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;* @code</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;     <span class="keyword">class </span>PointXDerivativeEvaluation : <span class="keyword">public</span> DualFunctionalBase&lt;dim&gt;</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;     {</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;     <span class="keyword">public</span>:</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;       PointXDerivativeEvaluation(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp;evaluation_point);</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;* </div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;       <span class="keyword">virtual</span> <span class="keywordtype">void</span> assemble_rhs(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;                                 <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;       rhs) <span class="keyword">const</span>;</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;* </div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;       <a class="code" href="namespaceinternal.html#a3ad80900781e8648c01c491a7545894e">DeclException1</a>(</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;         ExcEvaluationPointNotFound,</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;         <a class="code" href="classPoint.html">Point&lt;dim&gt;</a>,</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;         &lt;&lt; <span class="stringliteral">&quot;The evaluation point &quot;</span> &lt;&lt; arg1</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; was not found among the vertices of the present grid.&quot;</span>);</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;* </div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;     <span class="keyword">protected</span>:</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;       <span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> evaluation_point;</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;     };</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;* </div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160; </div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;     PointXDerivativeEvaluation&lt;dim&gt;::PointXDerivativeEvaluation(</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;       <span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp;evaluation_point)</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;       : evaluation_point(evaluation_point)</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;     {}</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;* </div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160; </div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;* </div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;*  What is interesting is the implementation of <span class="keyword">this</span> functional: here, J(phi_i)=<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>/<a class="code" href="namespaceDataOutBase.html#aa3cbced9f1d4ae661f13018f4c980aa1af54db6e70b60a249b36f803d0657b39e">dx</a> phi_i(x0).     </div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;*   We could, as in the implementation of the respective evaluation <span class="keywordtype">object</span> take the average of the <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aea91b5f00e4be473005cc331b8644ab2f1">gradients</a> of each shape <span class="keyword">function</span> phi_i at <span class="keyword">this</span> evaluation point. However, we take a slightly different approach: we simply take the average over all cells that surround <span class="keyword">this</span> point. The question which cells   &lt;code&gt;surrounds&lt;/code&gt;   the evaluation point is made dependent on the mesh width by including those cells <span class="keywordflow">for</span> which the distance of the cell<span class="stringliteral">&#39;s midpoint to the evaluation point is less than the cell&#39;</span>s <a class="code" href="namespaceGridTools.html#acd5ccc543d561cfb086b571d1f7818cb">diameter</a>.     </div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;*   Taking the average of the <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaae2b6dfb8a5c48206992d8310d176c37c">gradient</a> over the area/<a class="code" href="namespaceGridTools.html#a9e8169dc4981e90ba5d2386a87efa042">volume</a> of these cells leads to a dual solution which is very close to the one which would result from the point evaluation of the <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaae2b6dfb8a5c48206992d8310d176c37c">gradient</a>. It is simple to justify theoretically that <span class="keyword">this</span> does not change the method significantly.</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;* </div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;* </div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;* @code</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;     <span class="keywordtype">void</span> PointXDerivativeEvaluation&lt;dim&gt;::assemble_rhs(</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;       <span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;       <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;       rhs)<span class="keyword"> const</span></div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;<span class="keyword">     </span>{</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;* </div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;*  Again, <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> <span class="keyword">set</span> all entries to <a class="code" href="namespaceLAPACKSupport.html#a0d8802698d585eec62a2a54e6387b05b">zero</a>:</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;* </div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;* </div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;* @code</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;       rhs.<a class="code" href="classVector.html#ac4a4dbef7dd65ef8ad35ae56b57d7c05">reinit</a>(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;* </div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;* </div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;*  Initialize a   &lt;code&gt;<a class="code" href="classFEValues.html">FEValues</a>&lt;/code&gt;   <span class="keywordtype">object</span> with a quadrature formula, have abbreviations <span class="keywordflow">for</span> the number of quadrature points and shape functions...</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;* </div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;* </div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;* @code</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;       <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>        quadrature(dof_handler.<a class="code" href="classDoFHandler.html#ac1fedeb50b5f03b13d8b69f86e33f726">get_fe</a>().<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1);</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;       <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>      fe_values(dof_handler.<a class="code" href="classDoFHandler.html#ac1fedeb50b5f03b13d8b69f86e33f726">get_fe</a>(),</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;                               quadrature,</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;                               <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> |</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;                                 <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points    = fe_values.<a class="code" href="classFEValuesBase.html#a807c3049bfe81743fc0f237dfc2fbdea">n_quadrature_points</a>;</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell = dof_handler.<a class="code" href="classDoFHandler.html#ac1fedeb50b5f03b13d8b69f86e33f726">get_fe</a>().<a class="code" href="classFiniteElementData.html#ae2fa3b8d578ba488b4f37061bb0278bb">dofs_per_cell</a>;</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;* </div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;* </div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;*  ...and have two objects that are used to store the global indices of the degrees of freedom on a cell, and the values of the <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aea91b5f00e4be473005cc331b8644ab2f1">gradients</a> of the shape functions at the quadrature points:</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;* </div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;* </div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;* @code</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;       <a class="code" href="classVector.html">Vector&lt;double&gt;</a>            cell_rhs(dofs_per_cell);</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;       std::vector&lt;unsigned int&gt; local_dof_indices(dofs_per_cell);</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;* </div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;* </div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;*  Finally have a variable in which we will <a class="code" href="namespaceUtilities_1_1MPI.html#ab544a3bf3301a6dd3e705ee352c5551b">sum</a> up the area/<a class="code" href="namespaceGridTools.html#a9e8169dc4981e90ba5d2386a87efa042">volume</a> of the cells over which we integrate, by integrating the unit functions on these cells:</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;* </div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;* </div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;* @code</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;       <span class="keywordtype">double</span> total_volume = 0;</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;* </div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;* </div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;*  Then start the loop over all cells, and select those cells which are close enough to the evaluation <a class="code" href="namespaceOpenCASCADE.html#a9509efa83e3b2fa42616fe0623cba696">point</a>:</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;* </div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;* </div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;* @code</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;       <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : dof_handler.<a class="code" href="group__CPP11.html#gacdb6d3adec96a13a7079f6c893e1d3ff">active_cell_iterators</a>())</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;         <span class="keywordflow">if</span> (cell-&gt;center().distance(evaluation_point) &lt;= cell-&gt;diameter())</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;           {</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;* </div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;*  If we have found such a cell, then initialize the   &lt;code&gt;<a class="code" href="classFEValues.html">FEValues</a>&lt;/code&gt;   <span class="keywordtype">object</span> and integrate the x-component of the <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaae2b6dfb8a5c48206992d8310d176c37c">gradient</a> of each shape <span class="keyword">function</span>, as well as the unit <span class="keyword">function</span> <span class="keywordflow">for</span> the total area/<a class="code" href="namespaceGridTools.html#a9e8169dc4981e90ba5d2386a87efa042">volume</a>.</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;* </div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;* </div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;* @code</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;             fe_values.reinit(cell);</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;             cell_rhs = 0;</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;* </div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_q_points; ++q)</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;               {</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;                 <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;                   cell_rhs(i) +=</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;                     fe_values.shape_grad(i, q)[0] <span class="comment">// (d/dx phi_i(x_q))</span></div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;                     fe_values.JxW(q);           <span class="comment">// dx</span></div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;                 total_volume += fe_values.JxW(q);</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;               }</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;* </div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;* </div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;*  If we have the local contributions, distribute them to the global vector:</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;* </div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;* </div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;* @code</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;             cell-&gt;get_dof_indices(local_dof_indices);</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;               rhs(local_dof_indices[i]) += cell_rhs(i);</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;           }</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;* </div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;* </div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;*  After we have looped over all cells, check whether we have found any at all, by making sure that their <a class="code" href="namespaceGridTools.html#a9e8169dc4981e90ba5d2386a87efa042">volume</a> is non-<a class="code" href="namespaceLAPACKSupport.html#a0d8802698d585eec62a2a54e6387b05b">zero</a>. If not, then the results will be botched, as the right hand side should then still be <a class="code" href="namespaceLAPACKSupport.html#a0d8802698d585eec62a2a54e6387b05b">zero</a>, so <span class="keywordflow">throw</span> an exception:</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;* </div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;* </div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;* @code</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;       <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(total_volume &gt; 0,</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;                   ExcEvaluationPointNotFound(evaluation_point));</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;* </div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;* </div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;*  Finally, we have by now only integrated the <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aea91b5f00e4be473005cc331b8644ab2f1">gradients</a> of the shape <a class="code" href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">functions</a>, not taking their <a class="code" href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1a485d4198c1f422388b80cadb98af1f27">mean</a> <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a>. We fix <span class="keyword">this</span> by dividing by the measure of the <a class="code" href="namespaceGridTools.html#a9e8169dc4981e90ba5d2386a87efa042">volume</a> over which we have integrated:</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;* </div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;* </div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;* @code</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;       rhs /= total_volume;</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;     }</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;* </div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160; </div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;   } <span class="comment">// namespace DualFunctional</span></div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;* </div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160; </div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;* </div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;ExtendingtheLaplaceSolvernamespace&quot;</span>&gt;&lt;/a&gt;  &lt;h3&gt;Extending the LaplaceSolver <span class="keyword">namespace</span>&lt;/h3&gt;</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;* </div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;* </div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;* @code</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;   <span class="keyword">namespace </span>LaplaceSolver</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;   {</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;* </div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;TheDualSolverclass&quot;</span>&gt;&lt;/a&gt;  &lt;h4&gt;The DualSolver <span class="keyword">class</span>&lt;/h4&gt;</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;* </div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;* </div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;*  In the same way as the   &lt;code&gt;PrimalSolver&lt;/code&gt;   <span class="keyword">class </span>above, we now implement a   &lt;code&gt;DualSolver&lt;/code&gt;  . It has all the same features, the only difference is that it does not take a function object denoting a right hand side object, but now takes a   &lt;code&gt;DualFunctionalBase&lt;/code&gt;   object that will <a class="code" href="namespaceinternal.html#a2b3d48efdf7c94da455dc6a3553bab79">assemble</a> the right hand side vector of the dual problem. The rest of the class is rather trivial.     </div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;*   Since both primal and dual solver will use the same <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>, but different discretizations, it now becomes clear why we have made the   &lt;code&gt;Base&lt;/code&gt;   <span class="keyword">class </span>a virtual one: since the final class will be derived from both   &lt;code&gt;PrimalSolver&lt;/code&gt;   as well as   &lt;code&gt;DualSolver&lt;/code&gt;, it would have two &lt;code&gt;Base&lt;/code&gt;   instances, would we not have marked the inheritance as <span class="keyword">virtual</span>. Since in many applications the base class would store much more information than just the triangulation which needs to be shared between primal and dual solvers, we do not usually want to use two such base classes.</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;* </div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;* </div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;* @code</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;     template &lt;int dim&gt;</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;     class DualSolver : <span class="keyword">public</span> Solver&lt;dim&gt;</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;     {</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;     <span class="keyword">public</span>:</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;       DualSolver(</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;         <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;                           triangulation,</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;         <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;                     fe,</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;         <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature&lt;dim&gt;</a> &amp;                        quadrature,</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;         <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature</a>&lt;dim</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;* </div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;- 1&gt; &amp;                    face_quadrature,</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;         <span class="keyword">const</span> DualFunctional::DualFunctionalBase&lt;dim&gt; &amp;dual_functional);</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;* </div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;     <span class="keyword">protected</span>:</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;       <span class="keyword">const</span> <a class="code" href="classSmartPointer.html">SmartPointer&lt;const DualFunctional::DualFunctionalBase&lt;dim&gt;</a>&gt;</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;                    dual_functional;</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;       <span class="keyword">virtual</span> <span class="keywordtype">void</span> assemble_rhs(<a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;rhs) <span class="keyword">const override</span>;</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;* </div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;       <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a> boundary_values;</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;     };</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;* </div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;     <span class="keyword">const</span> <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a> DualSolver&lt;dim&gt;::boundary_values;</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;* </div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;     DualSolver&lt;dim&gt;::DualSolver(</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;       <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;                           triangulation,</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;       <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;                     fe,</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;       <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature&lt;dim&gt;</a> &amp;                        quadrature,</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;       <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature</a>&lt;dim</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;* </div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;- 1&gt; &amp;                    face_quadrature,</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;       <span class="keyword">const</span> DualFunctional::DualFunctionalBase&lt;dim&gt; &amp;dual_functional)</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;       : Base&lt;dim&gt;(triangulation)</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;       , Solver&lt;dim&gt;(triangulation,</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;                     fe,</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;                     quadrature,</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;                     face_quadrature,</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;                     boundary_values)</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;       , dual_functional(&amp;dual_functional)</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;     {}</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;* </div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160; </div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;* </div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;     <span class="keywordtype">void</span> DualSolver&lt;dim&gt;::assemble_rhs(<a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;rhs)<span class="keyword"> const</span></div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;<span class="keyword">     </span>{</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;       dual_functional-&gt;assemble_rhs(this-&gt;dof_handler, rhs);</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;     }</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;* </div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160; </div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;* </div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;TheWeightedResidualclass&quot;</span>&gt;&lt;/a&gt;  &lt;h4&gt;The WeightedResidual <span class="keyword">class</span>&lt;/h4&gt;</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;* </div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;* </div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;*  Here <span class="keywordflow">finally</span> comes the main <span class="keyword">class </span>of this program, the one that <span class="keyword">implements</span> the dual weighted residual error estimator. It joins the primal and dual solver classes to use them for the computation of primal and dual solutions, and implements the error representation formula for use as error estimate and mesh refinement.     </div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;*   The <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> few of the functions of this class are mostly overriders of the respective functions of the base class:</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;* </div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;* </div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;* @code</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;     template &lt;int dim&gt;</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;     class WeightedResidual : <span class="keyword">public</span> PrimalSolver&lt;dim&gt;, <span class="keyword">public</span> DualSolver&lt;dim&gt;</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;     {</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;     <span class="keyword">public</span>:</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;       WeightedResidual(</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;         <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;                           coarse_grid,</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;         <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;                     primal_fe,</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;         <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;                     dual_fe,</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;         <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature&lt;dim&gt;</a> &amp;                        quadrature,</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;         <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature</a>&lt;dim</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;* </div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;- 1&gt; &amp;                    face_quadrature,</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;         <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;                          rhs_function,</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;         <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;                          boundary_values,</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;         <span class="keyword">const</span> DualFunctional::DualFunctionalBase&lt;dim&gt; &amp;dual_functional);</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;* </div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;       <span class="keyword">virtual</span> <span class="keywordtype">void</span> solve_problem() <span class="keyword">override</span>;</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;* </div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;       <span class="keyword">virtual</span> <span class="keywordtype">void</span> postprocess(</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;         <span class="keyword">const</span> Evaluation::EvaluationBase&lt;dim&gt; &amp;postprocessor) <span class="keyword">const override</span>;</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;* </div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;       <span class="keyword">virtual</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_dofs() <span class="keyword">const override</span>;</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;* </div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;       <span class="keyword">virtual</span> <span class="keywordtype">void</span> refine_grid() <span class="keyword">override</span>;</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;* </div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;       <span class="keyword">virtual</span> <span class="keywordtype">void</span> output_solution() <span class="keyword">const override</span>;</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;* </div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;     <span class="keyword">private</span>:</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;* </div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;*  In the <span class="keyword">private</span> section, we have two functions that are used to <a class="code" href="namespaceThreads_1_1internal.html#a8d237a30d09b13e0b5adbe0fd1dfb188">call</a> the   &lt;code&gt;solve_problem&lt;/code&gt;   functions of the primal and dual base classes. These two functions will be called in <a class="code" href="namespaceparallel.html">parallel</a> by the   &lt;code&gt;solve_problem&lt;/code&gt;   <span class="keyword">function</span> of <span class="keyword">this</span> <span class="keyword">class</span>.</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;* </div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;* </div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;* @code</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;       <span class="keywordtype">void</span> solve_primal_problem();</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;       <span class="keywordtype">void</span> solve_dual_problem();</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;* </div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;*  Then declare abbreviations <span class="keywordflow">for</span> active cell iterators, to avoid that we have to write <span class="keyword">this</span> lengthy name over and over again:</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;* </div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;* </div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;*  </div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;* </div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;* @code</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;       <span class="keyword">using</span> active_cell_iterator =</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;         <span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::active_cell_iterator</a>;</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;* </div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;* </div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;*  Next, declare a data type that we will us to store the contribution of faces to the error estimator. The idea is that we can compute the face terms from each of the two cells to <span class="keyword">this</span> face, as they are the same when viewed from both sides. What we will <span class="keywordflow">do</span> is to compute them only once, based on some rules explained below which of the two adjacent cells will be in charge to <span class="keywordflow">do</span> so. We then store the contribution of each face in a map mapping faces to their <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a>, and only collect the contributions <span class="keywordflow">for each</span> cell by looping over the cells a <a class="code" href="grid__out_8cc.html#a2cc229a4f1ffc75e83ed269d5f725729">second</a> time and grabbing the values from the map.       </div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;*   The data type of <span class="keyword">this</span> map is declared here:</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;* </div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;* </div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;* @code</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;       <span class="keyword">using</span> FaceIntegrals =</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;         <span class="keyword">typename</span> std::map&lt;typename DoFHandler&lt;dim&gt;::face_iterator, <span class="keywordtype">double</span>&gt;;</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;* </div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;* </div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;*  In the computation of the error estimates on cells and faces, we need a number of helper objects, such as   &lt;code&gt;<a class="code" href="classFEValues.html">FEValues</a>&lt;/code&gt;   and   &lt;code&gt;<a class="code" href="classFEFaceValues.html">FEFaceValues</a>&lt;/code&gt;   <a class="code" href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">functions</a>, but also temporary objects storing the values and <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aea91b5f00e4be473005cc331b8644ab2f1">gradients</a> of primal and dual solutions, <span class="keywordflow">for</span> example. These fields are needed in the three functions that <span class="keywordflow">do</span> the integration on cells, and regular and irregular faces, respectively.       </div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;*   There are three reasonable ways to provide these fields: <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a>, as local variables in the <span class="keyword">function</span> that needs them; <a class="code" href="grid__out_8cc.html#a2cc229a4f1ffc75e83ed269d5f725729">second</a>, as member variables of <span class="keyword">this</span> <span class="keyword">class</span>; third, as arguments passed to that <span class="keyword">function</span>.       </div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;*   These three alternatives all have drawbacks: the third that their number is not negligible and would make calling these functions a lengthy enterprise. The <a class="code" href="grid__out_8cc.html#a2cc229a4f1ffc75e83ed269d5f725729">second</a> has the drawback that it disallows parallelization, since the threads that will compute the error estimate have to have their own copies of these variables each, so member variables of the enclosing <span class="keyword">class </span>will not work. The <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> approach, although straightforward, has a subtle but important drawback: we will <a class="code" href="namespaceThreads_1_1internal.html#a8d237a30d09b13e0b5adbe0fd1dfb188">call</a> these functions over and over again, many thousands of times maybe; it now turns out that allocating vectors and other objects that need memory from the heap is an expensive business in terms of <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a>-time, since memory allocation is expensive when several threads are involved. It is thus significantly better to allocate the memory only once, and recycle the objects as often as possible.       </div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;*   What to do? Our answer is to use a variant of the third strategy. In fact, this is exactly what the <a class="code" href="namespaceWorkStream.html">WorkStream</a> concept is supposed to do (we have already introduced it above, but see also   @ref threads  ). To avoid that we have to give these functions a dozen or so arguments, we <a class="code" href="namespaceUtilities.html#a1ebf9e8745b1c1c0f314d24a1ec90921">pack</a> all these variables into two structures, one which is used for the computations on cells, the other doing them on the faces. Both are then joined into the WeightedResidualScratchData class that will serve as the &quot;scratch data&quot; class of the <a class="code" href="namespaceWorkStream.html">WorkStream</a> concept:</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;* </div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;* </div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;* @code</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;       struct <a class="code" href="structCellData.html">CellData</a></div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;       {</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;         <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>                           fe_values;</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;         <span class="keyword">const</span> <a class="code" href="classSmartPointer.html">SmartPointer&lt;const Function&lt;dim&gt;</a>&gt; right_hand_side;</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;* </div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;         std::vector&lt;double&gt; <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#aaff3056f2b80ada5c55d8c5825932c22">cell_residual</a>;</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;         std::vector&lt;double&gt; rhs_values;</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;         std::vector&lt;double&gt; dual_weights;</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;         std::vector&lt;double&gt; cell_laplacians;</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;         <a class="code" href="structCellData.html">CellData</a>(<span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;fe,</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;                  <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature&lt;dim&gt;</a> &amp;   quadrature,</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;                  <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;     right_hand_side);</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;         <a class="code" href="structCellData.html">CellData</a>(<span class="keyword">const</span> <a class="code" href="structCellData.html">CellData</a> &amp;cell_data);</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;       };</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;* </div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;       <span class="keyword">struct </span>FaceData</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;       {</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;         <a class="code" href="classFEFaceValues.html">FEFaceValues&lt;dim&gt;</a>    fe_face_values_cell;</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;         <a class="code" href="classFEFaceValues.html">FEFaceValues&lt;dim&gt;</a>    fe_face_values_neighbor;</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;         <a class="code" href="classFESubfaceValues.html">FESubfaceValues&lt;dim&gt;</a> fe_subface_values_cell;</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;* </div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;         std::vector&lt;double&gt;                  jump_residual;</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;         std::vector&lt;double&gt;                  dual_weights;</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;         <span class="keyword">typename</span> std::vector&lt;Tensor&lt;1, dim&gt;&gt; cell_grads;</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;         <span class="keyword">typename</span> std::vector&lt;Tensor&lt;1, dim&gt;&gt; neighbor_grads;</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;         FaceData(<span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp; fe,</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;                  <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature</a>&lt;dim</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;* </div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;- 1&gt; &amp;face_quadrature);</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;         FaceData(<span class="keyword">const</span> FaceData &amp;face_data);</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;       };</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;* </div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;       <span class="keyword">struct </span>WeightedResidualScratchData</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;       {</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;         WeightedResidualScratchData(</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;           <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp; primal_fe,</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;           <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature&lt;dim&gt;</a> &amp;    primal_quadrature,</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;           <span class="keyword">const</span> <a class="code" href="classQuadrature.html">Quadrature</a>&lt;dim</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;* </div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;- 1&gt; &amp;primal_face_quadrature,</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;           <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;      rhs_function,</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;           <span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;     primal_solution,</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;           <span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;     dual_weights);</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;* </div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;         WeightedResidualScratchData(</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;           <span class="keyword">const</span> WeightedResidualScratchData &amp;scratch_data);</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;* </div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;         <a class="code" href="structCellData.html">CellData</a>       cell_data;</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;         FaceData       face_data;</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;         <a class="code" href="classVector.html">Vector&lt;double&gt;</a> primal_solution;</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;         <a class="code" href="classVector.html">Vector&lt;double&gt;</a> dual_weights;</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;       };</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;* </div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160; </div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;* </div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;*    <a class="code" href="namespaceWorkStream.html#ab8ceb010811941c351803b671a19fb73">WorkStream::run</a>   generally wants both a scratch <span class="keywordtype">object</span> and a <a class="code" href="namespaceinternal_1_1VectorOperations.html#a40c8daa0881cff0123fbaeb08929f5cb">copy</a> <span class="keywordtype">object</span>. Here, <span class="keywordflow">for</span> reasons similar to what we had in   @ref step_9 <span class="stringliteral">&quot;step-9&quot;</span>   when discussing the computation of an approximation of the <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaae2b6dfb8a5c48206992d8310d176c37c">gradient</a>, we don<span class="stringliteral">&#39;t actually need a &quot;copy data&quot; structure. Since WorkStream insists on having one of these, we just declare an empty structure that does nothing other than being there.</span></div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;<span class="stringliteral">       struct WeightedResidualCopyData</span></div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;<span class="stringliteral">       {};</span></div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;<span class="stringliteral">*  Regarding the evaluation of the error estimator, we have one driver function that uses   WorkStream::run()   to call the second function on every cell:</span></div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;<span class="stringliteral">       void estimate_error(Vector&lt;float&gt; &amp;error_indicators) const;</span></div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;<span class="stringliteral">       void estimate_on_one_cell(const active_cell_iterator &amp; cell,</span></div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;<span class="stringliteral">                                 WeightedResidualScratchData &amp;scratch_data,</span></div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;<span class="stringliteral">                                 WeightedResidualCopyData &amp;   copy_data,</span></div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;<span class="stringliteral">                                 Vector&lt;float&gt; &amp;              error_indicators,</span></div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;<span class="stringliteral">                                 FaceIntegrals &amp;face_integrals) const;</span></div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;<span class="stringliteral">*  Then we have functions that do the actual integration of the error representation formula. They will treat the terms on the cell interiors, on those faces that have no hanging nodes, and on those faces with hanging nodes, respectively:</span></div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;<span class="stringliteral">       void integrate_over_cell(const active_cell_iterator &amp;cell,</span></div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;<span class="stringliteral">                                const Vector&lt;double&gt; &amp;      primal_solution,</span></div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;<span class="stringliteral">                                const Vector&lt;double&gt; &amp;      dual_weights,</span></div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;<span class="stringliteral">                                CellData &amp;                  cell_data,</span></div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;<span class="stringliteral">                                Vector&lt;float&gt; &amp;error_indicators) const;</span></div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;<span class="stringliteral">       void integrate_over_regular_face(const active_cell_iterator &amp;cell,</span></div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;<span class="stringliteral">                                        const unsigned int          face_no,</span></div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;<span class="stringliteral">                                        const Vector&lt;double&gt; &amp;primal_solution,</span></div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;<span class="stringliteral">                                        const Vector&lt;double&gt; &amp;dual_weights,</span></div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;<span class="stringliteral">                                        FaceData &amp;            face_data,</span></div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;<span class="stringliteral">                                        FaceIntegrals &amp;face_integrals) const;</span></div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;<span class="stringliteral">       void integrate_over_irregular_face(const active_cell_iterator &amp;cell,</span></div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;<span class="stringliteral">                                          const unsigned int          face_no,</span></div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;<span class="stringliteral">                                          const Vector&lt;double&gt; &amp;primal_solution,</span></div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;<span class="stringliteral">                                          const Vector&lt;double&gt; &amp;dual_weights,</span></div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;<span class="stringliteral">                                          FaceData &amp;            face_data,</span></div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;<span class="stringliteral">                                          FaceIntegrals &amp;face_integrals) const;</span></div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;<span class="stringliteral">     };</span></div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;<span class="stringliteral">*  In the implementation of this class, we first have the constructors of the   &lt;code&gt;CellData&lt;/code&gt; and &lt;code&gt;FaceData&lt;/code&gt;   member classes, and the   &lt;code&gt;WeightedResidual&lt;/code&gt;   constructor. They only initialize fields to their correct lengths, so we do not have to discuss them in too much detail:</span></div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;<span class="stringliteral">     template &lt;int dim&gt;</span></div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;<span class="stringliteral">     WeightedResidual&lt;dim&gt;::CellData::CellData(</span></div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;<span class="stringliteral">       const FiniteElement&lt;dim&gt; &amp;fe,</span></div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;<span class="stringliteral">       const Quadrature&lt;dim&gt; &amp;   quadrature,</span></div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;<span class="stringliteral">       const Function&lt;dim&gt; &amp;     right_hand_side)</span></div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;<span class="stringliteral">       : fe_values(fe,</span></div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;<span class="stringliteral">                   quadrature,</span></div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;<span class="stringliteral">                   update_values | update_hessians | update_quadrature_points |</span></div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;<span class="stringliteral">                     update_JxW_values)</span></div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;<span class="stringliteral">       , right_hand_side(&amp;right_hand_side)</span></div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;<span class="stringliteral">       , cell_residual(quadrature.size())</span></div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;<span class="stringliteral">       , rhs_values(quadrature.size())</span></div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;<span class="stringliteral">       , dual_weights(quadrature.size())</span></div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;<span class="stringliteral">       , cell_laplacians(quadrature.size())</span></div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;<span class="stringliteral">     {}</span></div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;<span class="stringliteral">     template &lt;int dim&gt;</span></div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;<span class="stringliteral">     WeightedResidual&lt;dim&gt;::CellData::CellData(const CellData &amp;cell_data)</span></div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;<span class="stringliteral">       : fe_values(cell_data.fe_values.get_fe(),</span></div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;<span class="stringliteral">                   cell_data.fe_values.get_quadrature(),</span></div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;<span class="stringliteral">                   update_values | update_hessians | update_quadrature_points |</span></div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;<span class="stringliteral">                     update_JxW_values)</span></div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;<span class="stringliteral">       , right_hand_side(cell_data.right_hand_side)</span></div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;<span class="stringliteral">       , cell_residual(cell_data.cell_residual)</span></div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;<span class="stringliteral">       , rhs_values(cell_data.rhs_values)</span></div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;<span class="stringliteral">       , dual_weights(cell_data.dual_weights)</span></div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;<span class="stringliteral">       , cell_laplacians(cell_data.cell_laplacians)</span></div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;<span class="stringliteral">     {}</span></div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;<span class="stringliteral">     template &lt;int dim&gt;</span></div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;<span class="stringliteral">     WeightedResidual&lt;dim&gt;::FaceData::FaceData(</span></div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;<span class="stringliteral">       const FiniteElement&lt;dim&gt; &amp; fe,</span></div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;<span class="stringliteral">       const Quadrature&lt;dim</span></div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;<span class="stringliteral">- 1&gt; &amp;face_quadrature)</span></div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;<span class="stringliteral">       : fe_face_values_cell(fe,</span></div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;<span class="stringliteral">                             face_quadrature,</span></div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;<span class="stringliteral">                             update_values | update_gradients |</span></div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;<span class="stringliteral">                               update_JxW_values | update_normal_vectors)</span></div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;<span class="stringliteral">       , fe_face_values_neighbor(fe,</span></div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;<span class="stringliteral">                                 face_quadrature,</span></div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;<span class="stringliteral">                                 update_values | update_gradients |</span></div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;<span class="stringliteral">                                   update_JxW_values | update_normal_vectors)</span></div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;<span class="stringliteral">       , fe_subface_values_cell(fe, face_quadrature, update_gradients)</span></div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;<span class="stringliteral">     {</span></div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;<span class="stringliteral">       const unsigned int n_face_q_points = face_quadrature.size();</span></div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;<span class="stringliteral">       jump_residual.resize(n_face_q_points);</span></div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;<span class="stringliteral">       dual_weights.resize(n_face_q_points);</span></div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;<span class="stringliteral">       cell_grads.resize(n_face_q_points);</span></div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;<span class="stringliteral">       neighbor_grads.resize(n_face_q_points);</span></div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;<span class="stringliteral">     }</span></div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;<span class="stringliteral">     template &lt;int dim&gt;</span></div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;<span class="stringliteral">     WeightedResidual&lt;dim&gt;::FaceData::FaceData(const FaceData &amp;face_data)</span></div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;<span class="stringliteral">       : fe_face_values_cell(face_data.fe_face_values_cell.get_fe(),</span></div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;<span class="stringliteral">                             face_data.fe_face_values_cell.get_quadrature(),</span></div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;<span class="stringliteral">                             update_values | update_gradients |</span></div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;<span class="stringliteral">                               update_JxW_values | update_normal_vectors)</span></div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;<span class="stringliteral">       , fe_face_values_neighbor(</span></div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;<span class="stringliteral">           face_data.fe_face_values_neighbor.get_fe(),</span></div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;<span class="stringliteral">           face_data.fe_face_values_neighbor.get_quadrature(),</span></div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;<span class="stringliteral">           update_values | update_gradients | update_JxW_values |</span></div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;<span class="stringliteral">             update_normal_vectors)</span></div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;<span class="stringliteral">       , fe_subface_values_cell(</span></div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;<span class="stringliteral">           face_data.fe_subface_values_cell.get_fe(),</span></div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;<span class="stringliteral">           face_data.fe_subface_values_cell.get_quadrature(),</span></div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;<span class="stringliteral">           update_gradients)</span></div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;<span class="stringliteral">       , jump_residual(face_data.jump_residual)</span></div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;<span class="stringliteral">       , dual_weights(face_data.dual_weights)</span></div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;<span class="stringliteral">       , cell_grads(face_data.cell_grads)</span></div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;<span class="stringliteral">       , neighbor_grads(face_data.neighbor_grads)</span></div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;<span class="stringliteral">     {}</span></div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;<span class="stringliteral">     template &lt;int dim&gt;</span></div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;<span class="stringliteral">     WeightedResidual&lt;dim&gt;::WeightedResidualScratchData::</span></div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;<span class="stringliteral">       WeightedResidualScratchData(</span></div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;<span class="stringliteral">         const FiniteElement&lt;dim&gt; &amp; primal_fe,</span></div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;<span class="stringliteral">         const Quadrature&lt;dim&gt; &amp;    primal_quadrature,</span></div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;<span class="stringliteral">         const Quadrature&lt;dim</span></div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;<span class="stringliteral">- 1&gt; &amp;primal_face_quadrature,</span></div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;<span class="stringliteral">         const Function&lt;dim&gt; &amp;      rhs_function,</span></div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;<span class="stringliteral">         const Vector&lt;double&gt; &amp;     primal_solution,</span></div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;<span class="stringliteral">         const Vector&lt;double&gt; &amp;     dual_weights)</span></div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;<span class="stringliteral">       : cell_data(primal_fe, primal_quadrature, rhs_function)</span></div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;<span class="stringliteral">       , face_data(primal_fe, primal_face_quadrature)</span></div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;<span class="stringliteral">       , primal_solution(primal_solution)</span></div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;<span class="stringliteral">       , dual_weights(dual_weights)</span></div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;<span class="stringliteral">     {}</span></div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;<span class="stringliteral">     template &lt;int dim&gt;</span></div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;<span class="stringliteral">     WeightedResidual&lt;dim&gt;::WeightedResidualScratchData::</span></div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;<span class="stringliteral">       WeightedResidualScratchData(</span></div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;<span class="stringliteral">         const WeightedResidualScratchData &amp;scratch_data)</span></div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;<span class="stringliteral">       : cell_data(scratch_data.cell_data)</span></div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;<span class="stringliteral">       , face_data(scratch_data.face_data)</span></div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;<span class="stringliteral">       , primal_solution(scratch_data.primal_solution)</span></div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;<span class="stringliteral">       , dual_weights(scratch_data.dual_weights)</span></div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;<span class="stringliteral">     {}</span></div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;<span class="stringliteral">     template &lt;int dim&gt;</span></div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;<span class="stringliteral">     WeightedResidual&lt;dim&gt;::WeightedResidual(</span></div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;<span class="stringliteral">       Triangulation&lt;dim&gt; &amp;                           coarse_grid,</span></div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;<span class="stringliteral">       const FiniteElement&lt;dim&gt; &amp;                     primal_fe,</span></div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;<span class="stringliteral">       const FiniteElement&lt;dim&gt; &amp;                     dual_fe,</span></div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;<span class="stringliteral">       const Quadrature&lt;dim&gt; &amp;                        quadrature,</span></div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;<span class="stringliteral">       const Quadrature&lt;dim</span></div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;<span class="stringliteral">- 1&gt; &amp;                    face_quadrature,</span></div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;<span class="stringliteral">       const Function&lt;dim&gt; &amp;                          rhs_function,</span></div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;<span class="stringliteral">       const Function&lt;dim&gt; &amp;                          bv,</span></div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;<span class="stringliteral">       const DualFunctional::DualFunctionalBase&lt;dim&gt; &amp;dual_functional)</span></div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;<span class="stringliteral">       : Base&lt;dim&gt;(coarse_grid)</span></div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;<span class="stringliteral">       , PrimalSolver&lt;dim&gt;(coarse_grid,</span></div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;<span class="stringliteral">                           primal_fe,</span></div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;<span class="stringliteral">                           quadrature,</span></div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;<span class="stringliteral">                           face_quadrature,</span></div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;<span class="stringliteral">                           rhs_function,</span></div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;<span class="stringliteral">                           bv)</span></div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;<span class="stringliteral">       , DualSolver&lt;dim&gt;(coarse_grid,</span></div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;<span class="stringliteral">                         dual_fe,</span></div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;<span class="stringliteral">                         quadrature,</span></div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;<span class="stringliteral">                         face_quadrature,</span></div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;<span class="stringliteral">                         dual_functional)</span></div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;<span class="stringliteral">     {}</span></div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;<span class="stringliteral">*  The next five functions are boring, as they simply relay their work to the base classes. The first calls the primal and dual solvers in parallel, while postprocessing the solution and retrieving the number of degrees of freedom is done by the primal class.</span></div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;<span class="stringliteral">     template &lt;int dim&gt;</span></div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;<span class="stringliteral">     void WeightedResidual&lt;dim&gt;::solve_problem()</span></div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;<span class="stringliteral">     {</span></div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;<span class="stringliteral">       Threads::TaskGroup&lt;void&gt; tasks;</span></div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;<span class="stringliteral">       tasks +=</span></div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;<span class="stringliteral">         Threads::new_task(&amp;WeightedResidual&lt;dim&gt;::solve_primal_problem,this);</span></div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;<span class="stringliteral">       tasks +=</span></div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;<span class="stringliteral">         Threads::new_task(&amp;WeightedResidual&lt;dim&gt;::solve_dual_problem,this);</span></div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;<span class="stringliteral">       tasks.join_all();</span></div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;<span class="stringliteral">     }</span></div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;<span class="stringliteral">     template &lt;int dim&gt;</span></div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;<span class="stringliteral">     void WeightedResidual&lt;dim&gt;::solve_primal_problem()</span></div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;<span class="stringliteral">     {</span></div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;<span class="stringliteral">       PrimalSolver&lt;dim&gt;::solve_problem();</span></div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;<span class="stringliteral">     }</span></div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;<span class="stringliteral">     template &lt;int dim&gt;</span></div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;<span class="stringliteral">     void WeightedResidual&lt;dim&gt;::solve_dual_problem()</span></div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;<span class="stringliteral">     {</span></div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;<span class="stringliteral">       DualSolver&lt;dim&gt;::solve_problem();</span></div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;<span class="stringliteral">     }</span></div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;<span class="stringliteral">     template &lt;int dim&gt;</span></div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;<span class="stringliteral">     void WeightedResidual&lt;dim&gt;::postprocess(</span></div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;<span class="stringliteral">       const Evaluation::EvaluationBase&lt;dim&gt; &amp;postprocessor) const</span></div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;<span class="stringliteral">     {</span></div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;<span class="stringliteral">       PrimalSolver&lt;dim&gt;::postprocess(postprocessor);</span></div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;<span class="stringliteral">     }</span></div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;<span class="stringliteral">     template &lt;int dim&gt;</span></div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;<span class="stringliteral">     unsigned int WeightedResidual&lt;dim&gt;::n_dofs() const</span></div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;<span class="stringliteral">     {</span></div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;<span class="stringliteral">       return PrimalSolver&lt;dim&gt;::n_dofs();</span></div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;<span class="stringliteral">     }</span></div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;<span class="stringliteral">*  Now, it is becoming more interesting: the   &lt;code&gt;refine_grid()&lt;/code&gt;   function asks the error estimator to compute the cell-wise error indicators, then uses their absolute values for mesh refinement.</span></div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;<span class="stringliteral">     template &lt;int dim&gt;</span></div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;<span class="stringliteral">     void WeightedResidual&lt;dim&gt;::refine_grid()</span></div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;<span class="stringliteral">     {</span></div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;<span class="stringliteral">*  First call the function that computes the cell-wise and global error:</span></div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;<span class="stringliteral">       Vector&lt;float&gt; error_indicators(this-&gt;triangulation-&gt;n_active_cells());</span></div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;<span class="stringliteral">       estimate_error(error_indicators);</span></div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;<span class="stringliteral">*  Then note that marking cells for refinement or coarsening only works if all indicators are positive, to allow their comparison. Thus, drop the signs on all these indicators:</span></div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;<span class="stringliteral">       for (float &amp;error_indicator : error_indicators)</span></div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;<span class="stringliteral">         error_indicator = std::fabs(error_indicator);</span></div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;<span class="stringliteral">*  Finally, we can select between different strategies for refinement. The default here is to refine those cells with the largest error indicators that make up for a total of 80 per cent of the error, while we coarsen those with the smallest indicators that make up for the bottom 2 per cent of the error.</span></div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;<span class="stringliteral">       GridRefinement::refine_and_coarsen_fixed_fraction(*this-&gt;triangulation,</span></div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;<span class="stringliteral">                                                         error_indicators,</span></div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;<span class="stringliteral">                                                         0.8,</span></div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;<span class="stringliteral">                                                         0.02);</span></div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;<span class="stringliteral">       this-&gt;triangulation-&gt;execute_coarsening_and_refinement();</span></div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;<span class="stringliteral">     }</span></div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;<span class="stringliteral">*  Since we want to output both the primal and the dual solution, we overload the   &lt;code&gt;output_solution&lt;/code&gt;   function. The only interesting feature of this function is that the primal and dual solutions are defined on different finite element spaces, which is not the format the   &lt;code&gt;DataOut&lt;/code&gt;   class expects. Thus, we have to transfer them to a common finite element space. Since we want the solutions only to see them qualitatively, we contend ourselves with interpolating the dual solution to the (smaller) primal space. For the interpolation, there is a library function, that takes a AffineConstraints object including the hanging node constraints. The rest is standard.</span></div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;<span class="stringliteral">     template &lt;int dim&gt;</span></div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;<span class="stringliteral">     void WeightedResidual&lt;dim&gt;::output_solution() const</span></div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;<span class="stringliteral">     {</span></div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;<span class="stringliteral">       AffineConstraints&lt;double&gt; primal_hanging_node_constraints;</span></div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;<span class="stringliteral">       DoFTools::make_hanging_node_constraints(PrimalSolver&lt;dim&gt;::dof_handler,</span></div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;<span class="stringliteral">                                               primal_hanging_node_constraints);</span></div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;<span class="stringliteral">       primal_hanging_node_constraints.close();</span></div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;<span class="stringliteral">       Vector&lt;double&gt; dual_solution(PrimalSolver&lt;dim&gt;::dof_handler.n_dofs());</span></div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;<span class="stringliteral">       FETools::interpolate(DualSolver&lt;dim&gt;::dof_handler,</span></div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;<span class="stringliteral">                            DualSolver&lt;dim&gt;::solution,</span></div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;<span class="stringliteral">                            PrimalSolver&lt;dim&gt;::dof_handler,</span></div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;<span class="stringliteral">                            primal_hanging_node_constraints,</span></div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;<span class="stringliteral">                            dual_solution);</span></div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;<span class="stringliteral">       DataOut&lt;dim&gt; data_out;</span></div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;<span class="stringliteral">       data_out.attach_dof_handler(PrimalSolver&lt;dim&gt;::dof_handler);</span></div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;<span class="stringliteral">*  Add the data vectors for which we want output. Add them both, the   &lt;code&gt;DataOut&lt;/code&gt;   functions can handle as many data vectors as you wish to write to output:</span></div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;<span class="stringliteral">       data_out.add_data_vector(PrimalSolver&lt;dim&gt;::solution, &quot;primal_solution&quot;);</span></div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;<span class="stringliteral">       data_out.add_data_vector(dual_solution, &quot;dual_solution&quot;);</span></div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;<span class="stringliteral">       data_out.build_patches();</span></div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;<span class="stringliteral">       std::ofstream out(&quot;solution-&quot; + std::to_string(this-&gt;refinement_cycle) +</span></div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;<span class="stringliteral">                         &quot;.vtu&quot;);</span></div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;<span class="stringliteral">       data_out.write(out, DataOutBase::vtu);</span></div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;<span class="stringliteral">     }</span></div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;<span class="stringliteral">*   &lt;a name=&quot;Estimatingerrors&quot;&gt;&lt;/a&gt;  &lt;h3&gt;Estimating errors&lt;/h3&gt;</span></div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;<span class="stringliteral">*   &lt;a name=&quot;Errorestimationdriverfunctions&quot;&gt;&lt;/a&gt;  &lt;h4&gt;Error estimation driver functions&lt;/h4&gt;     </span></div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;<span class="stringliteral">*   As for the actual computation of error estimates, let&#39;</span>s start with the <span class="keyword">function</span> that drives all <span class="keyword">this</span>, i.e. calls those functions that actually <span class="keywordflow">do</span> the work, and <span class="keywordflow">finally</span> collects the results.</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;* </div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;* </div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;* @code</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;     <span class="keywordtype">void</span></div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;     WeightedResidual&lt;dim&gt;::estimate_error(<a class="code" href="classVector.html">Vector&lt;float&gt;</a> &amp;error_indicators)<span class="keyword"> const</span></div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;<span class="keyword">     </span>{</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;* </div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;*  The <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> task in computing the error is to <span class="keyword">set</span> up vectors that denote the primal solution, and the weights (z-z_h)=(z-I_hz), both in the finite element space <span class="keywordflow">for</span> which we have computed the dual solution. For <span class="keyword">this</span>, we have to <a class="code" href="namespaceFETools.html#ad29759cb8c51f8d369a371f63be8dde0">interpolate</a> the primal solution to the dual finite element space, and to subtract the interpolation of the computed dual solution to the primal finite element space. Fortunately, the library provides functions <span class="keywordflow">for</span> the interpolation into larger or smaller finite element spaces, so <span class="keyword">this</span> is mostly obvious.       </div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;*   First, let<span class="stringliteral">&#39;s do that for the primal solution: it is cell-wise interpolated into the finite element space in which we have solved the dual problem: But, again as in the   &lt;code&gt;WeightedResidual::output_solution&lt;/code&gt;   function we first need to create an AffineConstraints object including the hanging node constraints, but this time of the dual finite element space.</span></div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;<span class="stringliteral">       AffineConstraints&lt;double&gt; dual_hanging_node_constraints;</span></div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;<span class="stringliteral">       DoFTools::make_hanging_node_constraints(DualSolver&lt;dim&gt;::dof_handler,</span></div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;<span class="stringliteral">                                               dual_hanging_node_constraints);</span></div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;<span class="stringliteral">       dual_hanging_node_constraints.close();</span></div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;<span class="stringliteral">       Vector&lt;double&gt; primal_solution(DualSolver&lt;dim&gt;::dof_handler.n_dofs());</span></div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;<span class="stringliteral">       FETools::interpolate(PrimalSolver&lt;dim&gt;::dof_handler,</span></div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;<span class="stringliteral">                            PrimalSolver&lt;dim&gt;::solution,</span></div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;<span class="stringliteral">                            DualSolver&lt;dim&gt;::dof_handler,</span></div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;<span class="stringliteral">                            dual_hanging_node_constraints,</span></div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;<span class="stringliteral">                            primal_solution);</span></div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;<span class="stringliteral">*  Then for computing the interpolation of the numerically approximated dual solution z into the finite element space of the primal solution and subtracting it from z: use the   &lt;code&gt;interpolate_difference&lt;/code&gt;   function, that gives (z-I_hz) in the element space of the dual solution.</span></div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;<span class="stringliteral">       AffineConstraints&lt;double&gt; primal_hanging_node_constraints;</span></div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;<span class="stringliteral">       DoFTools::make_hanging_node_constraints(PrimalSolver&lt;dim&gt;::dof_handler,</span></div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;<span class="stringliteral">                                               primal_hanging_node_constraints);</span></div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;<span class="stringliteral">       primal_hanging_node_constraints.close();</span></div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;<span class="stringliteral">       Vector&lt;double&gt; dual_weights(DualSolver&lt;dim&gt;::dof_handler.n_dofs());</span></div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;<span class="stringliteral">       FETools::interpolation_difference(DualSolver&lt;dim&gt;::dof_handler,</span></div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;<span class="stringliteral">                                         dual_hanging_node_constraints,</span></div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;<span class="stringliteral">                                         DualSolver&lt;dim&gt;::solution,</span></div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;<span class="stringliteral">                                         PrimalSolver&lt;dim&gt;::dof_handler,</span></div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;<span class="stringliteral">                                         primal_hanging_node_constraints,</span></div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;<span class="stringliteral">                                         dual_weights);</span></div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;<span class="stringliteral">*  Note that this could probably have been more efficient since those constraints have been used previously when assembling matrix and right hand side for the primal problem and writing out the dual solution. We leave the optimization of the program in this respect as an exercise.</span></div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;<span class="stringliteral">*  Having computed the dual weights we now proceed with computing the cell and face residuals of the primal solution. First we set up a map between face iterators and their jump term contributions of faces to the error estimator. The reason is that we compute the jump terms only once, from one side of the face, and want to collect them only afterwards when looping over all cells a second time.       </span></div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;<span class="stringliteral">*   We initialize this map already with a value of</span></div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;<span class="stringliteral">*  - e20 for all faces, since this value will stand out in the results if something should go wrong and we fail to compute the value for a face for some reason. Secondly, this initialization already makes the   std::map   object allocate all objects it may possibly need. This is important since we will write into this structure from parallel threads, and doing so would not be thread-safe if the map needed to allocate memory and thereby reshape its data structures. In other words, the initial initialization relieves us from the necessity to synchronize the threads through a mutex each time they write to (and modify the structure of) this map.</span></div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;<span class="stringliteral">       FaceIntegrals face_integrals;</span></div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;<span class="stringliteral">       for (const auto &amp;cell :</span></div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;<span class="stringliteral">            DualSolver&lt;dim&gt;::dof_handler.active_cell_iterators())</span></div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;<span class="stringliteral">         for (const auto &amp;face : cell-&gt;face_iterators())</span></div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;<span class="stringliteral">           face_integrals[face] =</span></div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;<span class="stringliteral">-1e20;</span></div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;<span class="stringliteral">       auto worker = [this,</span></div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;<span class="stringliteral">                      &amp;error_indicators,</span></div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;<span class="stringliteral">                      &amp;face_integrals](const active_cell_iterator &amp; cell,</span></div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;<span class="stringliteral">                                       WeightedResidualScratchData &amp;scratch_data,</span></div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;<span class="stringliteral">                                       WeightedResidualCopyData &amp;   copy_data) {</span></div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;<span class="stringliteral">         this-&gt;estimate_on_one_cell(</span></div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;<span class="stringliteral">           cell, scratch_data, copy_data, error_indicators, face_integrals);</span></div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;<span class="stringliteral">       };</span></div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;<span class="stringliteral">       auto do_nothing_copier =</span></div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;<span class="stringliteral">         std::function&lt;void(const WeightedResidualCopyData &amp;)&gt;();</span></div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;<span class="stringliteral">*  Then hand it all off to   WorkStream::run()   to compute the estimators for all cells in parallel:</span></div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;<span class="stringliteral">       WorkStream::run(</span></div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;<span class="stringliteral">         DualSolver&lt;dim&gt;::dof_handler.begin_active(),</span></div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;<span class="stringliteral">         DualSolver&lt;dim&gt;::dof_handler.end(),</span></div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;<span class="stringliteral">         worker,</span></div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;<span class="stringliteral">         do_nothing_copier,</span></div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;<span class="stringliteral">         WeightedResidualScratchData(*DualSolver&lt;dim&gt;::fe,</span></div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;<span class="stringliteral">                                    DualSolver&lt;dim&gt;::quadrature,</span></div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;<span class="stringliteral">                                    DualSolver&lt;dim&gt;::face_quadrature,</span></div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;<span class="stringliteral">                                    this-&gt;rhs_function,</span></div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;<span class="stringliteral">                                     primal_solution,</span></div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;<span class="stringliteral">                                     dual_weights),</span></div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;<span class="stringliteral">         WeightedResidualCopyData());</span></div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;<span class="stringliteral">*  Once the error contributions are computed, sum them up. For this, note that the cell terms are already set, and that only the edge terms need to be collected. Thus, loop over all cells and their faces, make sure that the contributions of each of the faces are there, and add them up. Only take minus one half of the jump term, since the other half will be taken by the neighboring cell.</span></div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;<span class="stringliteral">       unsigned int present_cell = 0;</span></div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;<span class="stringliteral">       for (const auto &amp;cell :</span></div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;<span class="stringliteral">            DualSolver&lt;dim&gt;::dof_handler.active_cell_iterators())</span></div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;<span class="stringliteral">         {</span></div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;<span class="stringliteral">           for (const auto &amp;face : cell-&gt;face_iterators())</span></div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;<span class="stringliteral">             {</span></div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;<span class="stringliteral">               Assert(face_integrals.find(face) != face_integrals.end(),</span></div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;<span class="stringliteral">                      ExcInternalError());</span></div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;<span class="stringliteral">               error_indicators(present_cell)</span></div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;<span class="stringliteral">-= 0.5 face_integrals[face];</span></div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;<span class="stringliteral">             }</span></div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;<span class="stringliteral">           ++present_cell;</span></div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;<span class="stringliteral">         }</span></div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;<span class="stringliteral">       std::cout &lt;&lt; &quot;   Estimated error=&quot;</span></div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;<span class="stringliteral">                 &lt;&lt; std::accumulate(error_indicators.begin(),</span></div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;<span class="stringliteral">                                    error_indicators.end(),</span></div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;<span class="stringliteral">                                    0.)</span></div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;<span class="stringliteral">                 &lt;&lt; std::endl;</span></div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;<span class="stringliteral">     }</span></div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;<span class="stringliteral">*   &lt;a name=&quot;Estimatingonasinglecell&quot;&gt;&lt;/a&gt;  &lt;h4&gt;Estimating on a single cell&lt;/h4&gt;</span></div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;<span class="stringliteral">*  Next we have the function that is called to estimate the error on a single cell. The function may be called multiple times if the library was configured to use multithreading. Here it goes:</span></div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;<span class="stringliteral">     template &lt;int dim&gt;</span></div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;<span class="stringliteral">     void WeightedResidual&lt;dim&gt;::estimate_on_one_cell(</span></div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;<span class="stringliteral">       const active_cell_iterator &amp; cell,</span></div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;<span class="stringliteral">       WeightedResidualScratchData &amp;scratch_data,</span></div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;<span class="stringliteral">       WeightedResidualCopyData &amp;   copy_data,</span></div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;<span class="stringliteral">       Vector&lt;float&gt; &amp;              error_indicators,</span></div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;<span class="stringliteral">       FaceIntegrals &amp;              face_integrals) const</span></div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;<span class="stringliteral">     {</span></div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;<span class="stringliteral">*  Because of WorkStream, estimate_on_one_cell requires a CopyData object even if it is no used. The next line silences a warning about this unused variable.</span></div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;<span class="stringliteral">       (void)copy_data;</span></div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;<span class="stringliteral">*  First task on each cell is to compute the cell residual contributions of this cell, and put them into the   &lt;code&gt;error_indicators&lt;/code&gt;   variable:</span></div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;<span class="stringliteral">       integrate_over_cell(cell,</span></div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;<span class="stringliteral">                           scratch_data.primal_solution,</span></div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;<span class="stringliteral">                           scratch_data.dual_weights,</span></div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;<span class="stringliteral">                           scratch_data.cell_data,</span></div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;<span class="stringliteral">                           error_indicators);</span></div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;<span class="stringliteral">*  After computing the cell terms, turn to the face terms. For this, loop over all faces of the present cell, and see whether something needs to be computed on it:</span></div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;<span class="stringliteral">       for (const auto face_no : cell-&gt;face_indices())</span></div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;<span class="stringliteral">         {</span></div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;<span class="stringliteral">*  First, if this face is part of the boundary, then there is nothing to do. However, to make things easier when summing up the contributions of the faces of cells, we enter this face into the list of faces with a zero contribution to the error.</span></div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;<span class="stringliteral">           if (cell-&gt;face(face_no)-&gt;at_boundary())</span></div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;<span class="stringliteral">             {</span></div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;<span class="stringliteral">               face_integrals[cell-&gt;face(face_no)] = 0;</span></div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;<span class="stringliteral">               continue;</span></div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;<span class="stringliteral">             }</span></div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;<span class="stringliteral">*  Next, note that since we want to compute the jump terms on each face only once although we access it twice (if it is not at the boundary), we have to define some rules who is responsible for computing on a face:           </span></div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;<span class="stringliteral">*   First, if the neighboring cell is on the same level as this one, i.e. neither further refined not coarser, then the one with the lower index within this level does the work. In other words: if the other one has a lower index, then skip work on this face:</span></div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;<span class="stringliteral">           if ((cell-&gt;neighbor(face_no)-&gt;has_children() == false) &amp;&amp;</span></div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;<span class="stringliteral">               (cell-&gt;neighbor(face_no)-&gt;level() == cell-&gt;level()) &amp;&amp;</span></div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;<span class="stringliteral">               (cell-&gt;neighbor(face_no)-&gt;index() &lt; cell-&gt;index()))</span></div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;<span class="stringliteral">             continue;</span></div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;<span class="stringliteral">*  Likewise, we always work from the coarser cell if this and its neighbor differ in refinement. Thus, if the neighboring cell is less refined than the present one, then do nothing since we integrate over the subfaces when we visit the coarse cell.</span></div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;<span class="stringliteral">           if (cell-&gt;at_boundary(face_no) == false)</span></div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;<span class="stringliteral">             if (cell-&gt;neighbor(face_no)-&gt;level() &lt; cell-&gt;level())</span></div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;<span class="stringliteral">               continue;</span></div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;<span class="stringliteral">*  Now we know that we are in charge here, so actually compute the face jump terms. If the face is a regular one, i.e.  the other side&#39;</span>s cell is neither coarser not finer than <span class="keyword">this</span> cell, then <a class="code" href="namespaceThreads_1_1internal.html#a8d237a30d09b13e0b5adbe0fd1dfb188">call</a> one <span class="keyword">function</span>, and <span class="keywordflow">if</span> the cell on the other side is further refined, then use another <span class="keyword">function</span>. Note that the <span class="keywordflow">case</span> that the cell on the other side is coarser cannot happen since we have decided above that we handle <span class="keyword">this</span> <span class="keywordflow">case</span> when we pass over that other cell.</div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;* </div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;</div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;* </div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;* @code</div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;           if (cell-&gt;face(face_no)-&gt;has_children() == <span class="keyword">false</span>)</div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;             integrate_over_regular_face(cell,</div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;                                         face_no,</div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;                                         scratch_data.primal_solution,</div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;                                         scratch_data.dual_weights,</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;                                         scratch_data.face_data,</div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;                                         face_integrals);</div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;           <span class="keywordflow">else</span></div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;             integrate_over_irregular_face(cell,</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;                                           face_no,</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;                                           scratch_data.primal_solution,</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;                                           scratch_data.dual_weights,</div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;                                           scratch_data.face_data,</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;                                           face_integrals);</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;         }</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;     }</div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;* </div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160; </div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;* </div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;Computingcelltermerrorcontributions&quot;</span>&gt;&lt;/a&gt;  &lt;h4&gt;Computing cell term error contributions&lt;/h4&gt;</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;* </div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;* </div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;*  As <span class="keywordflow">for</span> the actual computation of the error contributions, <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> turn to the cell terms:</div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;* </div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;</div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;* </div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;* @code</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;     <span class="keywordtype">void</span> WeightedResidual&lt;dim&gt;::integrate_over_cell(</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;       <span class="keyword">const</span> active_cell_iterator &amp;cell,</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;       <span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;      primal_solution,</div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;       <span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;      dual_weights,</div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;       <a class="code" href="structCellData.html">CellData</a> &amp;                  cell_data,</div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;       <a class="code" href="classVector.html">Vector&lt;float&gt;</a> &amp;             error_indicators)<span class="keyword"> const</span></div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;<span class="keyword">     </span>{</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;* </div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;*  The tasks to be done are what appears natural from looking at the error estimation formula: <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> <span class="keyword">get</span> the right hand side and Laplacian of the numerical solution at the quadrature points <span class="keywordflow">for</span> the cell residual,</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;* </div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;</div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;* </div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;* @code</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;       cell_data.fe_values.reinit(cell);</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;       cell_data.right_hand_side-&gt;value_list(</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;         cell_data.fe_values.get_quadrature_points(), cell_data.rhs_values);</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;       cell_data.fe_values.get_function_laplacians(primal_solution,</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;                                                   cell_data.cell_laplacians);</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;* </div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;* </div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;*  ...then <span class="keyword">get</span> the dual weights...</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;* </div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;</div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;* </div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;* @code</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;       cell_data.fe_values.get_function_values(dual_weights,</div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;                                               cell_data.dual_weights);</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;* </div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;* </div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;*  ...and <span class="keywordflow">finally</span> build the <a class="code" href="namespaceUtilities_1_1MPI.html#ab544a3bf3301a6dd3e705ee352c5551b">sum</a> over all quadrature points and store it with the present cell:</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;* </div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;* </div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;* @code</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;       <span class="keywordtype">double</span> <a class="code" href="namespaceUtilities_1_1MPI.html#ab544a3bf3301a6dd3e705ee352c5551b">sum</a> = 0;</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> p = 0; p &lt; cell_data.fe_values.n_quadrature_points; ++p)</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;         sum += ((cell_data.rhs_values[p] + cell_data.cell_laplacians[p])</div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;                 cell_data.dual_weights[p] cell_data.fe_values.JxW(p));</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;       error_indicators(cell-&gt;active_cell_index()) += sum;</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;     }</div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;* </div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160; </div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;* </div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;Computingedgetermerrorcontributions1&quot;</span>&gt;&lt;/a&gt;  &lt;h4&gt;Computing edge term error contributions</div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;* </div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;-- 1&lt;/h4&gt;</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;* </div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;* </div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;*  On the other hand, computation of the edge terms <span class="keywordflow">for</span> the error estimate is not so simple. First, we have to distinguish between faces with and without hanging nodes. Because it is the simple <span class="keywordflow">case</span>, we <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> consider the <span class="keywordflow">case</span> without hanging nodes on a face (let<span class="stringliteral">&#39;s call this the `regular&#39;</span> <span class="keywordflow">case</span>):</div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;* </div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;</div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;* </div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;* @code</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;     template &lt;int dim&gt;</div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;     void WeightedResidual&lt;dim&gt;::integrate_over_regular_face(</div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;       const active_cell_iterator &amp;cell,</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;       const unsigned int          face_no,</div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;       const <a class="code" href="classVector.html">Vector</a>&lt;double&gt; &amp;      primal_solution,</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;       const <a class="code" href="classVector.html">Vector</a>&lt;double&gt; &amp;      dual_weights,</div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;       FaceData &amp;                  face_data,</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;       FaceIntegrals &amp;             face_integrals) const</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;     {</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points =</div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;         face_data.fe_face_values_cell.n_quadrature_points;</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;* </div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;* </div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;*  The <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> step is to <span class="keyword">get</span> the values of the <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aea91b5f00e4be473005cc331b8644ab2f1">gradients</a> at the quadrature points of the finite element field on the present cell. For <span class="keyword">this</span>, initialize the   &lt;code&gt;<a class="code" href="classFEFaceValues.html">FEFaceValues</a>&lt;/code&gt;   <span class="keywordtype">object</span> corresponding to <span class="keyword">this</span> side of the face, and <a class="code" href="namespaceTensorAccessors.html#a5798da96660fa8e6798917501d65dbd8">extract</a> the <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aea91b5f00e4be473005cc331b8644ab2f1">gradients</a> <span class="keyword">using</span> that <span class="keywordtype">object</span>.</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;* </div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;</div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;* </div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;* @code</div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;       face_data.fe_face_values_cell.reinit(cell, face_no);</div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;       face_data.fe_face_values_cell.get_function_gradients(</div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;         primal_solution, face_data.cell_grads);</div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;* </div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;* </div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;*  The <a class="code" href="grid__out_8cc.html#a2cc229a4f1ffc75e83ed269d5f725729">second</a> step is then to <a class="code" href="namespaceTensorAccessors.html#a5798da96660fa8e6798917501d65dbd8">extract</a> the <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aea91b5f00e4be473005cc331b8644ab2f1">gradients</a> of the finite element solution at the quadrature points on the other side of the face, i.e. from the neighboring cell.       </div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;*   For <span class="keyword">this</span>, <span class="keywordflow">do</span> a sanity check before: make sure that the neighbor actually exists (yes, we should not have come here <span class="keywordflow">if</span> the neighbor did not exist, but in complicated software there are bugs, so better check <span class="keyword">this</span>), and <span class="keywordflow">if</span> <span class="keyword">this</span> is not the <span class="keywordflow">case</span> <span class="keywordflow">throw</span> an error.</div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;* </div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;* </div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;* @code</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;       <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(cell-&gt;neighbor(face_no).state() == <a class="code" href="namespaceIteratorState.html#a4e92f4a9d339ff987cc3eb5b0a1ac507a457da025bc5a3a2231a667bd5c6f3c92">IteratorState::valid</a>,</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;              <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;* </div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;*  If we have that, then we need to find out with which face of the neighboring cell we have to work, i.e. the   &lt;code&gt;how-many<span class="stringliteral">&#39;th&lt;/code&gt;   the neighbor the present cell is of the cell behind the present face. For this, there is a function, and we put the result into a variable with the name   &lt;code&gt;neighbor_neighbor&lt;/code&gt;  :</span></div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;<span class="stringliteral">       const unsigned int neighbor_neighbor =</span></div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;<span class="stringliteral">         cell-&gt;neighbor_of_neighbor(face_no);</span></div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;<span class="stringliteral">*  Then define an abbreviation for the neighbor cell, initialize the   &lt;code&gt;FEFaceValues&lt;/code&gt;   object on that cell, and extract the gradients on that cell:</span></div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;<span class="stringliteral">       const active_cell_iterator neighbor = cell-&gt;neighbor(face_no);</span></div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;<span class="stringliteral">       face_data.fe_face_values_neighbor.reinit(neighbor, neighbor_neighbor);</span></div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;<span class="stringliteral">       face_data.fe_face_values_neighbor.get_function_gradients(</span></div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;<span class="stringliteral">         primal_solution, face_data.neighbor_grads);</span></div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;<span class="stringliteral">*  Now that we have the gradients on this and the neighboring cell, compute the jump residual by multiplying the jump in the gradient with the normal vector:</span></div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;<span class="stringliteral">       for (unsigned int p = 0; p &lt; n_q_points; ++p)</span></div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;<span class="stringliteral">         face_data.jump_residual[p] =</span></div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;<span class="stringliteral">           ((face_data.cell_grads[p]</span></div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;<span class="stringliteral">- face_data.neighbor_grads[p])</span></div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;<span class="stringliteral">            face_data.fe_face_values_cell.normal_vector(p));</span></div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;<span class="stringliteral">*  Next get the dual weights for this face:</span></div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;<span class="stringliteral">       face_data.fe_face_values_cell.get_function_values(dual_weights,</span></div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;<span class="stringliteral">                                                         face_data.dual_weights);</span></div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;<span class="stringliteral">*  Finally, we have to compute the sum over jump residuals, dual weights, and quadrature weights, to get the result for this face:</span></div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;<span class="stringliteral">       double face_integral = 0;</span></div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;<span class="stringliteral">       for (unsigned int p = 0; p &lt; n_q_points; ++p)</span></div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;<span class="stringliteral">         face_integral +=</span></div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;<span class="stringliteral">           (face_data.jump_residual[p] face_data.dual_weights[p]</span></div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;<span class="stringliteral">            face_data.fe_face_values_cell.JxW(p));</span></div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;<span class="stringliteral">*  Double check that the element already exists and that it was not already written to...</span></div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;<span class="stringliteral">       Assert(face_integrals.find(cell-&gt;face(face_no)) != face_integrals.end(),</span></div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;<span class="stringliteral">              ExcInternalError());</span></div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;<span class="stringliteral">       Assert(face_integrals[cell-&gt;face(face_no)] ==</span></div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;<span class="stringliteral">-1e20, ExcInternalError());</span></div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;<span class="stringliteral">*  ...then store computed value at assigned location. Note that the stored value does not contain the factor 1/2 that appears in the error representation. The reason is that the term actually does not have this factor if we loop over all faces in the triangulation, but only appears if we write it as a sum over all cells and all faces of each cell; we thus visit the same face twice. We take account of this by using this factor</span></div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;<span class="stringliteral">*  - /2 later, when we sum up the contributions for each cell individually.</span></div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;<span class="stringliteral">       face_integrals[cell-&gt;face(face_no)] = face_integral;</span></div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;<span class="stringliteral">     }</span></div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;<span class="stringliteral">*   &lt;a name=&quot;Computingedgetermerrorcontributions2&quot;&gt;&lt;/a&gt;  &lt;h4&gt;Computing edge term error contributions</span></div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;<span class="stringliteral">-- 2&lt;/h4&gt;</span></div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;<span class="stringliteral">*  We are still missing the case of faces with hanging nodes. This is what is covered in this function:</span></div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;<span class="stringliteral">     template &lt;int dim&gt;</span></div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;<span class="stringliteral">     void WeightedResidual&lt;dim&gt;::integrate_over_irregular_face(</span></div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;<span class="stringliteral">       const active_cell_iterator &amp;cell,</span></div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;<span class="stringliteral">       const unsigned int          face_no,</span></div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;<span class="stringliteral">       const Vector&lt;double&gt; &amp;      primal_solution,</span></div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;<span class="stringliteral">       const Vector&lt;double&gt; &amp;      dual_weights,</span></div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;<span class="stringliteral">       FaceData &amp;                  face_data,</span></div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;<span class="stringliteral">       FaceIntegrals &amp;             face_integrals) const</span></div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;<span class="stringliteral">     {</span></div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;<span class="stringliteral">*  First again two abbreviations, and some consistency checks whether the function is called only on faces for which it is supposed to be called:</span></div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;<span class="stringliteral">       const unsigned int n_q_points =</span></div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;<span class="stringliteral">         face_data.fe_face_values_cell.n_quadrature_points;</span></div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;<span class="stringliteral">       const typename DoFHandler&lt;dim&gt;::face_iterator face = cell-&gt;face(face_no);</span></div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;<span class="stringliteral">       const typename DoFHandler&lt;dim&gt;::cell_iterator neighbor =</span></div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;<span class="stringliteral">         cell-&gt;neighbor(face_no);</span></div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;<span class="stringliteral">       Assert(neighbor.state() == IteratorState::valid, ExcInternalError());</span></div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;<span class="stringliteral">       Assert(neighbor-&gt;has_children(), ExcInternalError());</span></div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;<span class="stringliteral">       (void)neighbor;</span></div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;<span class="stringliteral">*  Then find out which neighbor the present cell is of the adjacent cell. Note that we will operate on the children of this adjacent cell, but that their orientation is the same as that of their mother, i.e. the neighbor direction is the same.</span></div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;<span class="stringliteral">       const unsigned int neighbor_neighbor =</span></div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;<span class="stringliteral">         cell-&gt;neighbor_of_neighbor(face_no);</span></div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;<span class="stringliteral">*  Then simply do everything we did in the previous function for one face for all the sub-faces now:</span></div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;<span class="stringliteral">       for (unsigned int subface_no = 0; subface_no &lt; face-&gt;n_children();</span></div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;<span class="stringliteral">            ++subface_no)</span></div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;<span class="stringliteral">         {</span></div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;<span class="stringliteral">*  Start with some checks again: get an iterator pointing to the cell behind the present subface and check whether its face is a subface of the one we are considering. If that were not the case, then there would be either a bug in the   &lt;code&gt;neighbor_neighbor&lt;/code&gt;   function called above, or</span></div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;<span class="stringliteral">*  -  worse</span></div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;<span class="stringliteral">*  -  some function in the library did not keep to some underlying assumptions about cells, their children, and their faces. In any case, even though this assertion should not be triggered, it does not harm to be cautious, and in optimized mode computations the assertion will be removed anyway.</span></div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;<span class="stringliteral">           const active_cell_iterator neighbor_child =</span></div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;<span class="stringliteral">             cell-&gt;neighbor_child_on_subface(face_no, subface_no);</span></div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;<span class="stringliteral">           Assert(neighbor_child-&gt;face(neighbor_neighbor) ==</span></div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;<span class="stringliteral">                    cell-&gt;face(face_no)-&gt;child(subface_no),</span></div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;<span class="stringliteral">                  ExcInternalError());</span></div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;<span class="stringliteral">*  Now start the work by again getting the gradient of the solution first at this side of the interface,</span></div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;<span class="stringliteral">           face_data.fe_subface_values_cell.reinit(cell, face_no, subface_no);</span></div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;<span class="stringliteral">           face_data.fe_subface_values_cell.get_function_gradients(</span></div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;<span class="stringliteral">             primal_solution, face_data.cell_grads);</span></div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;<span class="stringliteral">*  then at the other side,</span></div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;<span class="stringliteral">           face_data.fe_face_values_neighbor.reinit(neighbor_child,</span></div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;<span class="stringliteral">                                                    neighbor_neighbor);</span></div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;<span class="stringliteral">           face_data.fe_face_values_neighbor.get_function_gradients(</span></div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;<span class="stringliteral">             primal_solution, face_data.neighbor_grads);</span></div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;<span class="stringliteral">*  and finally building the jump residuals. Since we take the normal vector from the other cell this time, revert the sign of the first term compared to the other function:</span></div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;<span class="stringliteral">           for (unsigned int p = 0; p &lt; n_q_points; ++p)</span></div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;<span class="stringliteral">             face_data.jump_residual[p] =</span></div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;<span class="stringliteral">               ((face_data.neighbor_grads[p]</span></div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;<span class="stringliteral">- face_data.cell_grads[p])</span></div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;<span class="stringliteral">                face_data.fe_face_values_neighbor.normal_vector(p));</span></div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;<span class="stringliteral">*  Then get dual weights:</span></div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;<span class="stringliteral">           face_data.fe_face_values_neighbor.get_function_values(</span></div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;<span class="stringliteral">             dual_weights, face_data.dual_weights);</span></div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;<span class="stringliteral">*  At last, sum up the contribution of this sub-face, and set it in the global map:</span></div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;<span class="stringliteral">           double face_integral = 0;</span></div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;<span class="stringliteral">           for (unsigned int p = 0; p &lt; n_q_points; ++p)</span></div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;<span class="stringliteral">             face_integral +=</span></div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;<span class="stringliteral">               (face_data.jump_residual[p] face_data.dual_weights[p]</span></div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;<span class="stringliteral">                face_data.fe_face_values_neighbor.JxW(p));</span></div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;<span class="stringliteral">           face_integrals[neighbor_child-&gt;face(neighbor_neighbor)] =</span></div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;<span class="stringliteral">             face_integral;</span></div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;<span class="stringliteral">         }</span></div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;<span class="stringliteral">*  Once the contributions of all sub-faces are computed, loop over all sub-faces to collect and store them with the mother face for simple use when later collecting the error terms of cells. Again make safety checks that the entries for the sub-faces have been computed and do not carry an invalid value.</span></div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;<span class="stringliteral">       double sum = 0;</span></div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;<span class="stringliteral">       for (unsigned int subface_no = 0; subface_no &lt; face-&gt;n_children();</span></div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;<span class="stringliteral">            ++subface_no)</span></div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;<span class="stringliteral">         {</span></div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;<span class="stringliteral">           Assert(face_integrals.find(face-&gt;child(subface_no)) !=</span></div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;<span class="stringliteral">                    face_integrals.end(),</span></div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;<span class="stringliteral">                  ExcInternalError());</span></div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;<span class="stringliteral">           Assert(face_integrals[face-&gt;child(subface_no)] !=</span></div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;<span class="stringliteral">-1e20,</span></div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;<span class="stringliteral">                  ExcInternalError());</span></div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;<span class="stringliteral">           sum += face_integrals[face-&gt;child(subface_no)];</span></div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;<span class="stringliteral">         }</span></div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;<span class="stringliteral">*  Finally store the value with the parent face.</span></div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;<span class="stringliteral">       face_integrals[face] = sum;</span></div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;<span class="stringliteral">     }</span></div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;<span class="stringliteral">   } // namespace LaplaceSolver</span></div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;<span class="stringliteral">*   &lt;a name=&quot;Asimulationframework&quot;&gt;&lt;/a&gt;  &lt;h3&gt;A simulation framework&lt;/h3&gt;</span></div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;<span class="stringliteral">*  In the previous example program, we have had two functions that were used to drive the process of solving on subsequently finer grids. We extend this here to allow for a number of parameters to be passed to these functions, and put all of that into framework class.   </span></div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;<span class="stringliteral">*   You will have noted that this program is built up of a number of small parts (evaluation functions, solver classes implementing various refinement methods, different dual functionals, different problem and data descriptions), which makes the program relatively simple to extend, but also allows to solve a large number of different problems by replacing one part by another. We reflect this flexibility by declaring a structure in the following framework class that holds a number of parameters that may be set to test various combinations of the parts of this program, and which can be used to test it at various problems and discretizations in a simple way.</span></div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;<span class="stringliteral">   template &lt;int dim&gt;</span></div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;<span class="stringliteral">   struct Framework</span></div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;<span class="stringliteral">   {</span></div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;<span class="stringliteral">   public:</span></div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;<span class="stringliteral">*  First, we declare two abbreviations for simple use of the respective data types:</span></div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;<span class="stringliteral">     using Evaluator     = Evaluation::EvaluationBase&lt;dim&gt;;</span></div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;<span class="stringliteral">     using EvaluatorList = std::list&lt;Evaluator&gt;;</span></div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;<span class="stringliteral">*  Then we have the structure which declares all the parameters that may be set. In the default constructor of the structure, these values are all set to default values, for simple use.</span></div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;<span class="stringliteral">     struct ProblemDescription</span></div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;<span class="stringliteral">     {</span></div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;<span class="stringliteral">*  First allow for the degrees of the piecewise polynomials by which the primal and dual problems will be discretized. They default to (bi-, tri-)linear ansatz functions for the primal, and (bi-, tri-)quadratic ones for the dual problem. If a refinement criterion is chosen that does not need the solution of a dual problem, the value of the dual finite element degree is of course ignored.</span></div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;<span class="stringliteral">       unsigned int primal_fe_degree;</span></div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;<span class="stringliteral">       unsigned int dual_fe_degree;</span></div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;<span class="stringliteral">*  Then have an object that describes the problem type, i.e. right hand side, domain, boundary values, etc. The pointer needed here defaults to the Null pointer, i.e. you will have to set it in actual instances of this object to make it useful.</span></div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;<span class="stringliteral">       std::unique_ptr&lt;const Data::SetUpBase&lt;dim&gt;&gt; data;</span></div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;<span class="stringliteral">*  Since we allow to use different refinement criteria (global refinement, refinement by the Kelly error indicator, possibly with a weight, and using the dual estimator), define a number of enumeration values, and subsequently a variable of that type. It will default to   &lt;code&gt;dual_weighted_error_estimator&lt;/code&gt;  .</span></div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;<span class="stringliteral">       enum RefinementCriterion</span></div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;<span class="stringliteral">       {</span></div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;<span class="stringliteral">         dual_weighted_error_estimator,</span></div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;<span class="stringliteral">         global_refinement,</span></div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;<span class="stringliteral">         kelly_indicator,</span></div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;<span class="stringliteral">         weighted_kelly_indicator</span></div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;<span class="stringliteral">       };</span></div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;<span class="stringliteral">       RefinementCriterion refinement_criterion;</span></div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;<span class="stringliteral">*  Next, an object that describes the dual functional. It is only needed if the dual weighted residual refinement is chosen, and also defaults to a Null pointer.</span></div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;<span class="stringliteral">       std::unique_ptr&lt;const DualFunctional::DualFunctionalBase&lt;dim&gt;&gt;</span></div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;<span class="stringliteral">         dual_functional;</span></div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;<span class="stringliteral">*  Then a list of evaluation objects. Its default value is empty, i.e. no evaluation objects.</span></div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;<span class="stringliteral">       EvaluatorList evaluator_list;</span></div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;<span class="stringliteral">*  Next to last, a function that is used as a weight to the   &lt;code&gt;RefinementWeightedKelly&lt;/code&gt;   class. The default value of this pointer is zero, but you have to set it to some other value if you want to use the   &lt;code&gt;weighted_kelly_indicator&lt;/code&gt;   refinement criterion.</span></div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;<span class="stringliteral">       std::unique_ptr&lt;const Function&lt;dim&gt;&gt; kelly_weight;</span></div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;<span class="stringliteral">*  Finally, we have a variable that denotes the maximum number of degrees of freedom we allow for the (primal) discretization. If it is exceeded, we stop the process of solving and intermittent mesh refinement. Its default value is 20,000.</span></div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;<span class="stringliteral">       unsigned int max_degrees_of_freedom;</span></div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;<span class="stringliteral">*  Finally the default constructor of this class:</span></div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;<span class="stringliteral">       ProblemDescription();</span></div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;<span class="stringliteral">     };</span></div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;<span class="stringliteral">*  The driver framework class only has one method which calls solver and mesh refinement intermittently, and does some other small tasks in between. Since it does not need data besides the parameters given to it, we make it static:</span></div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;<span class="stringliteral">     static void run(const ProblemDescription &amp;descriptor);</span></div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;<span class="stringliteral">   };</span></div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;<span class="stringliteral">*  As for the implementation, first the constructor of the parameter object, setting all values to their defaults:</span></div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;<span class="stringliteral">   template &lt;int dim&gt;</span></div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;<span class="stringliteral">   Framework&lt;dim&gt;::ProblemDescription::ProblemDescription()</span></div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;<span class="stringliteral">     : primal_fe_degree(1)</span></div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;<span class="stringliteral">     , dual_fe_degree(2)</span></div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;<span class="stringliteral">     , refinement_criterion(dual_weighted_error_estimator)</span></div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;<span class="stringliteral">     , max_degrees_of_freedom(20000)</span></div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;<span class="stringliteral">   {}</span></div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;<span class="stringliteral">*  Then the function which drives the whole process:</span></div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;<span class="stringliteral">   template &lt;int dim&gt;</span></div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;<span class="stringliteral">   void Framework&lt;dim&gt;::run(const ProblemDescription &amp;descriptor)</span></div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;<span class="stringliteral">   {</span></div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;<span class="stringliteral">*  First create a triangulation from the given data object,</span></div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;<span class="stringliteral">     Triangulation&lt;dim&gt; triangulation(</span></div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;<span class="stringliteral">       Triangulation&lt;dim&gt;::smoothing_on_refinement);</span></div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;<span class="stringliteral">     descriptor.data-&gt;create_coarse_grid(triangulation);</span></div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;<span class="stringliteral">*  then a set of finite elements and appropriate quadrature formula:</span></div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;<span class="stringliteral">     const FE_Q&lt;dim&gt;       primal_fe(descriptor.primal_fe_degree);</span></div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;<span class="stringliteral">     const FE_Q&lt;dim&gt;       dual_fe(descriptor.dual_fe_degree);</span></div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;<span class="stringliteral">     const QGauss&lt;dim&gt;     quadrature(descriptor.dual_fe_degree + 1);</span></div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;<span class="stringliteral">     const QGauss&lt;dim</span></div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;<span class="stringliteral">- 1&gt; face_quadrature(descriptor.dual_fe_degree + 1);</span></div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;<span class="stringliteral">*  Next, select one of the classes implementing different refinement criteria.</span></div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;<span class="stringliteral">     std::unique_ptr&lt;LaplaceSolver::Base&lt;dim&gt;&gt; solver;</span></div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;<span class="stringliteral">     switch (descriptor.refinement_criterion)</span></div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;<span class="stringliteral">       {</span></div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;<span class="stringliteral">         case ProblemDescription::dual_weighted_error_estimator:</span></div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;<span class="stringliteral">           {</span></div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;<span class="stringliteral">             solver = std::make_unique&lt;LaplaceSolver::WeightedResidual&lt;dim&gt;&gt;(</span></div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;<span class="stringliteral">               triangulation,</span></div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;<span class="stringliteral">               primal_fe,</span></div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;<span class="stringliteral">               dual_fe,</span></div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;<span class="stringliteral">               quadrature,</span></div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;<span class="stringliteral">               face_quadrature,</span></div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;<span class="stringliteral">               descriptor.data-&gt;get_right_hand_side(),</span></div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;<span class="stringliteral">               descriptor.data-&gt;get_boundary_values(),</span></div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;<span class="stringliteral">              descriptor.dual_functional);</span></div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;<span class="stringliteral">             break;</span></div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;<span class="stringliteral">           }</span></div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;<span class="stringliteral">         case ProblemDescription::global_refinement:</span></div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;<span class="stringliteral">           {</span></div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;<span class="stringliteral">             solver = std::make_unique&lt;LaplaceSolver::RefinementGlobal&lt;dim&gt;&gt;(</span></div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;<span class="stringliteral">               triangulation,</span></div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;<span class="stringliteral">               primal_fe,</span></div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;<span class="stringliteral">               quadrature,</span></div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;<span class="stringliteral">               face_quadrature,</span></div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;<span class="stringliteral">               descriptor.data-&gt;get_right_hand_side(),</span></div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;<span class="stringliteral">               descriptor.data-&gt;get_boundary_values());</span></div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;<span class="stringliteral">             break;</span></div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;<span class="stringliteral">           }</span></div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;<span class="stringliteral">         case ProblemDescription::kelly_indicator:</span></div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;<span class="stringliteral">           {</span></div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;<span class="stringliteral">             solver = std::make_unique&lt;LaplaceSolver::RefinementKelly&lt;dim&gt;&gt;(</span></div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;<span class="stringliteral">               triangulation,</span></div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;<span class="stringliteral">               primal_fe,</span></div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;<span class="stringliteral">               quadrature,</span></div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;<span class="stringliteral">               face_quadrature,</span></div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;<span class="stringliteral">               descriptor.data-&gt;get_right_hand_side(),</span></div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;<span class="stringliteral">               descriptor.data-&gt;get_boundary_values());</span></div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;<span class="stringliteral">             break;</span></div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;<span class="stringliteral">           }</span></div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;<span class="stringliteral">         case ProblemDescription::weighted_kelly_indicator:</span></div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;<span class="stringliteral">           {</span></div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;<span class="stringliteral">             solver =</span></div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;<span class="stringliteral">               std::make_unique&lt;LaplaceSolver::RefinementWeightedKelly&lt;dim&gt;&gt;(</span></div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;<span class="stringliteral">                 triangulation,</span></div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;<span class="stringliteral">                 primal_fe,</span></div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;<span class="stringliteral">                 quadrature,</span></div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;<span class="stringliteral">                 face_quadrature,</span></div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;<span class="stringliteral">                 descriptor.data-&gt;get_right_hand_side(),</span></div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;<span class="stringliteral">                 descriptor.data-&gt;get_boundary_values(),</span></div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;<span class="stringliteral">                descriptor.kelly_weight);</span></div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;<span class="stringliteral">             break;</span></div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;<span class="stringliteral">           }</span></div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;<span class="stringliteral">         default:</span></div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;<span class="stringliteral">           AssertThrow(false, ExcInternalError());</span></div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;<span class="stringliteral">       }</span></div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;<span class="stringliteral">*  Now that all objects are in place, run the main loop. The stopping criterion is implemented at the bottom of the loop.     </span></div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;<span class="stringliteral">*   In the loop, first set the new cycle number, then solve the problem, output its solution(s), apply the evaluation objects to it, then decide whether we want to refine the mesh further and solve again on this mesh, or jump out of the loop.</span></div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;<span class="stringliteral">     for (unsigned int step = 0; true; ++step)</span></div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;<span class="stringliteral">       {</span></div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;<span class="stringliteral">         std::cout &lt;&lt; &quot;Refinement cycle: &quot; &lt;&lt; step &lt;&lt; std::endl;</span></div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;<span class="stringliteral">         solver-&gt;set_refinement_cycle(step);</span></div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;<span class="stringliteral">         solver-&gt;solve_problem();</span></div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;<span class="stringliteral">         solver-&gt;output_solution();</span></div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;<span class="stringliteral">         std::cout &lt;&lt; &quot;   Number of degrees of freedom=&quot; &lt;&lt; solver-&gt;n_dofs()</span></div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;<span class="stringliteral">                   &lt;&lt; std::endl;</span></div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;<span class="stringliteral">         for (const auto &amp;evaluator : descriptor.evaluator_list)</span></div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;<span class="stringliteral">           {</span></div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;<span class="stringliteral">             evaluator-&gt;set_refinement_cycle(step);</span></div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;<span class="stringliteral">             solver-&gt;postprocess(*evaluator);</span></div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;<span class="stringliteral">           }</span></div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;<span class="stringliteral">         if (solver-&gt;n_dofs() &lt; descriptor.max_degrees_of_freedom)</span></div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;<span class="stringliteral">           solver-&gt;refine_grid();</span></div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;<span class="stringliteral">         else</span></div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;<span class="stringliteral">           break;</span></div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;<span class="stringliteral">       }</span></div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;<span class="stringliteral">*  Clean up the screen after the loop has run:</span></div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;<span class="stringliteral">     std::cout &lt;&lt; std::endl;</span></div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;<span class="stringliteral">   }</span></div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;<span class="stringliteral"> } // namespace Step14</span></div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;<span class="stringliteral">*   &lt;a name=&quot;Themainfunction&quot;&gt;&lt;/a&gt;  &lt;h3&gt;The main function&lt;/h3&gt;</span></div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;<span class="stringliteral">*  Here finally comes the main function. It drives the whole process by specifying a set of parameters to be used for the simulation (polynomial degrees, evaluation and dual functionals, etc), and passes them packed into a structure to the frame work class above.</span></div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;<span class="stringliteral"> int main()</span></div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;<span class="stringliteral"> {</span></div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;<span class="stringliteral">   try</span></div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;<span class="stringliteral">     {</span></div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;<span class="stringliteral">       using namespace Step14;</span></div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;<span class="stringliteral">*  Describe the problem we want to solve here by passing a descriptor object to the function doing the rest of the work:</span></div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;<span class="stringliteral">       const unsigned int                 dim = 2;</span></div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;<span class="stringliteral">       Framework&lt;dim&gt;::ProblemDescription descriptor;</span></div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;<span class="stringliteral">*  First set the refinement criterion we wish to use:</span></div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;<span class="stringliteral">       descriptor.refinement_criterion =</span></div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;<span class="stringliteral">         Framework&lt;dim&gt;::ProblemDescription::dual_weighted_error_estimator;</span></div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;<span class="stringliteral">*  Here, we could as well have used   &lt;code&gt;global_refinement&lt;/code&gt;   or   &lt;code&gt;weighted_kelly_indicator&lt;/code&gt;  . Note that the information given about dual finite elements, dual functional, etc is only important for the given choice of refinement criterion, and is ignored otherwise.</span></div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;<span class="stringliteral">*  Then set the polynomial degrees of primal and dual problem. We choose here bi-linear and bi-quadratic ones:</span></div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;<span class="stringliteral">       descriptor.primal_fe_degree = 1;</span></div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;<span class="stringliteral">       descriptor.dual_fe_degree   = 2;</span></div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;<span class="stringliteral">*  Then set the description of the test case, i.e. domain, boundary values, and right hand side. These are prepackaged in classes. We take here the description of   &lt;code&gt;Exercise_2_3&lt;/code&gt;  , but you can also use   &lt;code&gt;CurvedRidges@&lt;dim@&gt;&lt;/code&gt;  :</span></div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;<span class="stringliteral">       descriptor.data =</span></div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;<span class="stringliteral">         std::make_unique&lt;Data::SetUp&lt;Data::Exercise_2_3&lt;dim&gt;, dim&gt;&gt;();</span></div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;<span class="stringliteral">*  Next set first a dual functional, then a list of evaluation objects. We choose as default the evaluation of the value at an evaluation point, represented by the classes   &lt;code&gt;PointValueEvaluation&lt;/code&gt;   in the namespaces of evaluation and dual functional classes. You can also set the   &lt;code&gt;PointXDerivativeEvaluation&lt;/code&gt;   classes for the x-derivative instead of the value at the evaluation point.       </span></div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;<span class="stringliteral">*   Note that dual functional and evaluation objects should match. However, you can give as many evaluation functionals as you want, so you can have both point value and derivative evaluated after each step.  One such additional evaluation is to output the grid in each step.</span></div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;<span class="stringliteral">       const Point&lt;dim&gt; evaluation_point(0.75, 0.75);</span></div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;<span class="stringliteral">       descriptor.dual_functional =</span></div><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;<span class="stringliteral">         std::make_unique&lt;DualFunctional::PointValueEvaluation&lt;dim&gt;&gt;(</span></div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;<span class="stringliteral">           evaluation_point);</span></div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;<span class="stringliteral">       Evaluation::PointValueEvaluation&lt;dim&gt; postprocessor1(evaluation_point);</span></div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;<span class="stringliteral">       Evaluation::GridOutput&lt;dim&gt;           postprocessor2(&quot;grid&quot;);</span></div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;<span class="stringliteral">       descriptor.evaluator_list.push_back(&amp;postprocessor1);</span></div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;<span class="stringliteral">       descriptor.evaluator_list.push_back(&amp;postprocessor2);</span></div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;<span class="stringliteral">*  Set the maximal number of degrees of freedom after which we want the program to stop refining the mesh further:</span></div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;<span class="stringliteral">       descriptor.max_degrees_of_freedom = 20000;</span></div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;<span class="stringliteral">*  Finally pass the descriptor object to a function that runs the entire solution with it:</span></div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;<span class="stringliteral">       Framework&lt;dim&gt;::run(descriptor);</span></div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;<span class="stringliteral">     }</span></div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;<span class="stringliteral">*  Catch exceptions to give information about things that failed:</span></div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;<span class="stringliteral">   catch (std::exception &amp;exc)</span></div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;<span class="stringliteral">     {</span></div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;<span class="stringliteral">       std::cerr &lt;&lt; std::endl</span></div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;<span class="stringliteral">                 &lt;&lt; std::endl</span></div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;<span class="stringliteral">                 &lt;&lt; &quot;----------------------------------------------------&quot;</span></div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;<span class="stringliteral">                 &lt;&lt; std::endl;</span></div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;<span class="stringliteral">       std::cerr &lt;&lt; &quot;Exception on processing: &quot; &lt;&lt; std::endl</span></div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;<span class="stringliteral">                 &lt;&lt; exc.what() &lt;&lt; std::endl</span></div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;<span class="stringliteral">                 &lt;&lt; &quot;Aborting!&quot; &lt;&lt; std::endl</span></div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;<span class="stringliteral">                 &lt;&lt; &quot;----------------------------------------------------&quot;</span></div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;<span class="stringliteral">                 &lt;&lt; std::endl;</span></div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;<span class="stringliteral">       return 1;</span></div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;<span class="stringliteral">     }</span></div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;<span class="stringliteral">   catch (...)</span></div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;<span class="stringliteral">     {</span></div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;<span class="stringliteral">       std::cerr &lt;&lt; std::endl</span></div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;<span class="stringliteral">                 &lt;&lt; std::endl</span></div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;<span class="stringliteral">                 &lt;&lt; &quot;----------------------------------------------------&quot;</span></div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;<span class="stringliteral">                 &lt;&lt; std::endl;</span></div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;<span class="stringliteral">       std::cerr &lt;&lt; &quot;Unknown exception!&quot; &lt;&lt; std::endl</span></div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;<span class="stringliteral">                 &lt;&lt; &quot;Aborting!&quot; &lt;&lt; std::endl</span></div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;<span class="stringliteral">                 &lt;&lt; &quot;----------------------------------------------------&quot;</span></div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;<span class="stringliteral">                 &lt;&lt; std::endl;</span></div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;<span class="stringliteral">       return 1;</span></div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;<span class="stringliteral">     }</span></div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;<span class="stringliteral">   return 0;</span></div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;<span class="stringliteral"> }</span></div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;<span class="stringliteral">* &lt;a name=&quot;Results&quot;&gt;&lt;/a&gt;&lt;h1&gt;Results&lt;/h1&gt;</span></div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;<span class="stringliteral">* &lt;a name=&quot;Pointvalues&quot;&gt;&lt;/a&gt;&lt;h3&gt;Point values&lt;/h3&gt;</span></div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;<span class="stringliteral">* This program offers a lot of possibilities to play around. We can thusonly show a small part of all possible results that can be obtainedwith the help of this program. However, you are encouraged to just tryit out, by changing the settings in the main program. Here, we startby simply letting it run, unmodified:</span></div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;<span class="stringliteral">Refinement cycle: 0</span></div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;<span class="stringliteral">   Number of degrees of freedom=72</span></div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;<span class="stringliteral">   Point value=0.03243</span></div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;<span class="stringliteral">   Estimated error=0.000702385</span></div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;<span class="stringliteral">Refinement cycle: 1</span></div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;<span class="stringliteral">   Number of degrees of freedom=67</span></div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;<span class="stringliteral">   Point value=0.0324827</span></div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;<span class="stringliteral">   Estimated error=0.000888953</span></div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;<span class="stringliteral">Refinement cycle: 2</span></div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;<span class="stringliteral">   Number of degrees of freedom=130</span></div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;<span class="stringliteral">   Point value=0.0329619</span></div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;<span class="stringliteral">   Estimated error=0.000454606</span></div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;<span class="stringliteral">Refinement cycle: 3</span></div><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;<span class="stringliteral">   Number of degrees of freedom=307</span></div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;<span class="stringliteral">   Point value=0.0331934</span></div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;<span class="stringliteral">   Estimated error=0.000241254</span></div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;<span class="stringliteral">Refinement cycle: 4</span></div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;<span class="stringliteral">   Number of degrees of freedom=718</span></div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;<span class="stringliteral">   Point value=0.0333675</span></div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;<span class="stringliteral">   Estimated error=7.4912e-05</span></div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;<span class="stringliteral">Refinement cycle: 5</span></div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;<span class="stringliteral">   Number of degrees of freedom=1665</span></div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;<span class="stringliteral">   Point value=0.0334083</span></div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;<span class="stringliteral">   Estimated error=3.69111e-05</span></div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;<span class="stringliteral">Refinement cycle: 6</span></div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;<span class="stringliteral">   Number of degrees of freedom=3975</span></div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;<span class="stringliteral">   Point value=0.033431</span></div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;<span class="stringliteral">   Estimated error=1.54218e-05</span></div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;<span class="stringliteral">Refinement cycle: 7</span></div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;<span class="stringliteral">   Number of degrees of freedom=8934</span></div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;<span class="stringliteral">   Point value=0.0334406</span></div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;<span class="stringliteral">   Estimated error=6.28359e-06</span></div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;<span class="stringliteral">Refinement cycle: 8</span></div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;<span class="stringliteral">   Number of degrees of freedom=21799</span></div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;<span class="stringliteral">   Point value=0.0334444</span></div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;<span class="stringliteral">@endcode</span></div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;<span class="stringliteral">* First let&#39;</span>s look what the program actually computed. On the seventhgrid, primal and dual numerical solutions look like <span class="keyword">this</span> (<span class="keyword">using</span> acolor scheme intended to evoke the snow-capped mountains ofColorado that the original author of <span class="keyword">this</span> program now callshome):  &lt;table align=<span class="stringliteral">&quot;center&quot;</span>&gt;</div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;  &lt;tr&gt;</div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;    &lt;td width=<span class="stringliteral">&quot;50%&quot;</span>&gt;</div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;      &lt;img src=<span class="stringliteral">&quot;https://www.dealii.org/images/steps/developer/step-14.point-value.solution-7.9.2.png&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span>&gt;</div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;    &lt;/td&gt;</div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;    &lt;td width=<span class="stringliteral">&quot;50%&quot;</span>&gt;</div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;      &lt;img src=<span class="stringliteral">&quot;https://www.dealii.org/images/steps/developer/step-14.point-value.solution-7-dual.9.2.png&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span>&gt;</div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;    &lt;/td&gt;</div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;  &lt;/tr&gt;</div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;&lt;/table&gt;  Apparently, the region at the bottom left is so unimportant <span class="keywordflow">for</span> thepoint value evaluation at the top right that the grid is left entirelyunrefined there, even though the solution has singularities at the innercorner of that cell! Dueto the symmetry in right hand side and domain, the solution shouldactually look like at the top right in all four corners, but the meshrefinement criterion involving the dual solution chose to <a class="code" href="namespaceGridRefinement.html#a1cf30058b31ce7f9b389e8310bb9fc54">refine</a> themdifferently</div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;* </div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;*  -  because we said that we really only care about a singlefunction value somewhere at the top right.</div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;* </div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;</div><div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;* </div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;* Here are some of the meshes that are produced in refinement cycles 0,2, 4 (top row), and 5, 7, and 8 (bottom row):</div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;*   &lt;table width=<span class="stringliteral">&quot;80%&quot;</span> align=<span class="stringliteral">&quot;center&quot;</span>&gt;</div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;  &lt;tr&gt;</div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;    &lt;td&gt;&lt;img src=<span class="stringliteral">&quot;https://www.dealii.org/images/steps/developer/step-14.point-value.grid-0.9.2.png&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span> width=<span class="stringliteral">&quot;100%&quot;</span>&gt;&lt;/td&gt;</div><div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;    &lt;td&gt;&lt;img src=<span class="stringliteral">&quot;https://www.dealii.org/images/steps/developer/step-14.point-value.grid-2.9.2.png&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span> width=<span class="stringliteral">&quot;100%&quot;</span>&gt;&lt;/td&gt;</div><div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;    &lt;td&gt;&lt;img src=<span class="stringliteral">&quot;https://www.dealii.org/images/steps/developer/step-14.point-value.grid-4.9.2.png&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span> width=<span class="stringliteral">&quot;100%&quot;</span>&gt;&lt;/td&gt;</div><div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;  &lt;/tr&gt;</div><div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;  &lt;tr&gt;</div><div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;    &lt;td&gt;&lt;img src=<span class="stringliteral">&quot;https://www.dealii.org/images/steps/developer/step-14.point-value.grid-5.9.2.png&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span> width=<span class="stringliteral">&quot;100%&quot;</span>&gt;&lt;/td&gt;</div><div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;    &lt;td&gt;&lt;img src=<span class="stringliteral">&quot;https://www.dealii.org/images/steps/developer/step-14.point-value.grid-7.9.2.png&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span> width=<span class="stringliteral">&quot;100%&quot;</span>&gt;&lt;/td&gt;</div><div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;    &lt;td&gt;&lt;img src=<span class="stringliteral">&quot;https://www.dealii.org/images/steps/developer/step-14.point-value.grid-8.9.2.png&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span> width=<span class="stringliteral">&quot;100%&quot;</span>&gt;&lt;/td&gt;</div><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;  &lt;/tr&gt;</div><div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;&lt;/table&gt;  </div><div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;* Note the subtle interplay between resolving the corner singularities,and resolving around the point of evaluation. It will be ratherdifficult to generate such a mesh by hand, as <span class="keyword">this</span> would involve tojudge quantitatively how much which of the four corner singularitiesshould be resolved, and to <span class="keyword">set</span> the weight compared to the vicinity ofthe evaluation point.</div><div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;* </div><div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;</div><div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;* </div><div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;* The program prints the point value and the estimated error in thisquantity. From extrapolating it, we can guess that the exact value issomewhere close to 0.0334473, plus or minus 0.0000001 (note that we getalmost 6 <a class="code" href="namespaceIteratorState.html#a4e92f4a9d339ff987cc3eb5b0a1ac507a457da025bc5a3a2231a667bd5c6f3c92">valid</a> digits from only 22,000 (primal) degrees offreedom. This number cannot be obtained from the <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a> of thefunctional alone, but I have used the assumption that the errorestimator is mostly exact, and extrapolated the computed <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a> plusthe estimated error, to <span class="keyword">get</span> an approximation of the truevalue. Computing with more degrees of freedom shows that thisassumption is indeed <a class="code" href="namespaceIteratorState.html#a4e92f4a9d339ff987cc3eb5b0a1ac507a457da025bc5a3a2231a667bd5c6f3c92">valid</a>.</div><div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;* </div><div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;</div><div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;* </div><div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;* From the computed results, we can generate two graphs: one that showsthe convergence of the error   @f$J(u)-J(u_h)@f$   (taking theextrapolated <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a> as correct) in the point value, and the value thatwe <span class="keyword">get</span> by adding up computed value   @f$J(u_h)@f$   and estimatederror eta (<span class="keywordflow">if</span> the error estimator   @f$eta@f$   were exact, then the value  @f$J(u_h)+\eta@f$   would equal the exact point value, and the errorin <span class="keyword">this</span> quantity would <a class="code" href="namespaceDoFTools.html#ad31df71a29dd76de9b4ab241b2527160a6a742e14fbc92a1c202d77d4f319d5ec">always</a> be <a class="code" href="namespaceLAPACKSupport.html#a0d8802698d585eec62a2a54e6387b05b">zero</a>; however, since the errorestimator is only a</div><div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;* </div><div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;*  - good</div><div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;* </div><div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;*  - approximation to the <span class="keyword">true</span> error, we canby <span class="keyword">this</span> only <a class="code" href="namespaceUtilities_1_1MPI.html#a9e963546bd81b0cdd88e1840cfa8f227">reduce</a> the size of the error). In <span class="keyword">this</span> graph, we alsoindicate the complexity   @f${\cal <a class="code" href="namespaceLAPACKSupport.html#ae4c4142bb80d7e6e5214c37fac73e1da">O</a>}(1/<a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>)@f$   to show that mesh refinementacts optimal in <span class="keyword">this</span> <span class="keywordflow">case</span>. The <a class="code" href="grid__out_8cc.html#a2cc229a4f1ffc75e83ed269d5f725729">second</a> chart comparestrue and estimated error, and shows that the two are actually veryclose to each other, even <span class="keywordflow">for</span> such a complicated quantity as the pointvalue:</div><div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;* </div><div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;</div><div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;*   &lt;table width=<span class="stringliteral">&quot;80%&quot;</span> align=<span class="stringliteral">&quot;center&quot;</span>&gt;</div><div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;  &lt;tr&gt;</div><div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;    &lt;td&gt;&lt;img src=<span class="stringliteral">&quot;https://www.dealii.org/images/steps/developer/step-14.point-value.error.png&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span> width=<span class="stringliteral">&quot;100%&quot;</span>&gt;&lt;/td&gt;</div><div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;    &lt;td&gt;&lt;img src=<span class="stringliteral">&quot;https://www.dealii.org/images/steps/developer/step-14.point-value.error-estimation.png&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span> width=<span class="stringliteral">&quot;100%&quot;</span>&gt;&lt;/td&gt;</div><div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;  &lt;/tr&gt;</div><div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;&lt;/table&gt;  </div><div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;* </div><div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;</div><div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;* &lt;a name=<span class="stringliteral">&quot;Comparingrefinementcriteria&quot;</span>&gt;&lt;/a&gt;&lt;h3&gt;Comparing refinement criteria&lt;/h3&gt;</div><div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;* </div><div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;</div><div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;* </div><div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;* Since we have accepted quite some effort when <span class="keyword">using</span> the meshrefinement driven by the dual weighted error estimator (<span class="keywordflow">for</span> solvingthe dual problem, and <span class="keywordflow">for</span> evaluating the error representation), it isworth <span class="keywordflow">while</span> asking whether that effort was successful. To <span class="keyword">this</span> <a class="code" href="namespaceTrilinosWrappers_1_1internal.html#aee42c8e3004e2e81eac3c3356d3ec46b">end</a>, wefirst compare the achieved error levels <span class="keywordflow">for</span> different mesh refinementcriteria. To generate <span class="keyword">this</span> data, simply change the value of the meshrefinement criterion variable in the main program. The results arethus (<span class="keywordflow">for</span> the weight in the Kelly indicator, we have chosen thefunction   @f$1/(r^2+0.1^2)@f$  , where   @f$r@f$  is the distance to the evaluation point; it can be shown that <span class="keyword">this</span> isthe optimal weight <span class="keywordflow">if</span> we neglect the effects of boundaries):</div><div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;*   &lt;img src=<span class="stringliteral">&quot;https://www.dealii.org/images/steps/developer/step-14.point-value.error-comparison.png&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span>&gt;  </div><div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;* </div><div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;</div><div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;* </div><div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;* Checking these <a class="code" href="namespacenumbers.html">numbers</a>, we see that <span class="keywordflow">for</span> global refinement, the erroris proportional to   @f$O(1/(<a class="code" href="numbers_8h.html#ac4a2ed1890a931d0b6a55933310eadca">sqrt</a>(<a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>) <a class="code" href="numbers_8h.html#a5ecbfe991bebf7e99864f2e4eb3ea8df">log</a>(<a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>)))@f$  , and <span class="keywordflow">for</span> the dualestimator   @f$O(1/<a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>)@f$  . Generally speaking, we see that the dualweighted error estimator is better than the other refinementindicators, at least when compared with those that have a similarlyregular behavior. The Kelly indicator produces smaller errors, butjumps about the picture rather irregularly, with the error alsochanging signs sometimes. Therefore, its behavior does not allow toextrapolate the results to larger values of <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>. Furthermore, <span class="keywordflow">if</span> wetrust the error estimates of the dual weighted error estimator, theresults can be improved by adding the estimated error to the computedvalues. In terms of reliability, the weighted estimator is thus betterthan the Kelly indicator, although the latter sometimes producessmaller errors.</div><div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;* </div><div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;</div><div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;* </div><div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;* &lt;a name=<span class="stringliteral">&quot;Evaluationofpointstresses&quot;</span>&gt;&lt;/a&gt;&lt;h3&gt;Evaluation of point stresses&lt;/h3&gt;</div><div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;* </div><div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;</div><div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;* </div><div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;* Besides evaluating the values of the solution at a certain <a class="code" href="namespaceOpenCASCADE.html#a9509efa83e3b2fa42616fe0623cba696">point</a>, theprogram also offers the possibility to evaluate the x-derivatives at acertain <a class="code" href="namespaceOpenCASCADE.html#a9509efa83e3b2fa42616fe0623cba696">point</a>, and also to tailor mesh refinement <span class="keywordflow">for</span> this. To let theprogram compute these quantities, simply replace the two occurrences of  &lt;code&gt;PointValueEvaluation&lt;/code&gt;   in the main <span class="keyword">function</span> by  &lt;code&gt;PointXDerivativeEvaluation&lt;/code&gt;  , and let the program <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a>:</div><div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;* @code</div><div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;Refinement cycle: 0</div><div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;   Number of degrees of freedom=72</div><div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;   <a class="code" href="classPoint.html">Point</a> x-derivative=-0.0719397</div><div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;   Estimated error=-0.0126173</div><div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;Refinement cycle: 1</div><div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;   Number of degrees of freedom=61</div><div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;   <a class="code" href="classPoint.html">Point</a> x-derivative=-0.0707956</div><div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;   Estimated error=-0.00774316</div><div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;Refinement cycle: 2</div><div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;   Number of degrees of freedom=131</div><div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;   <a class="code" href="classPoint.html">Point</a> x-derivative=-0.0568671</div><div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;   Estimated error=-0.00313426</div><div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;Refinement cycle: 3</div><div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;   Number of degrees of freedom=247</div><div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;   <a class="code" href="classPoint.html">Point</a> x-derivative=-0.053033</div><div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;   Estimated error=-0.00136114</div><div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;Refinement cycle: 4</div><div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;   Number of degrees of freedom=532</div><div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;   <a class="code" href="classPoint.html">Point</a> x-derivative=-0.0526429</div><div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;   Estimated error=-0.000558868</div><div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;Refinement cycle: 5</div><div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;   Number of degrees of freedom=1267</div><div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;   <a class="code" href="classPoint.html">Point</a> x-derivative=-0.0526955</div><div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;   Estimated error=-0.000220116</div><div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;Refinement cycle: 6</div><div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;   Number of degrees of freedom=2864</div><div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;   <a class="code" href="classPoint.html">Point</a> x-derivative=-0.0527495</div><div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;   Estimated error=-9.46731e-05</div><div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;Refinement cycle: 7</div><div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;   Number of degrees of freedom=6409</div><div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;   <a class="code" href="classPoint.html">Point</a> x-derivative=-0.052785</div><div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;   Estimated error=-4.21543e-05</div><div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;Refinement cycle: 8</div><div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;   Number of degrees of freedom=14183</div><div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;   <a class="code" href="classPoint.html">Point</a> x-derivative=-0.0528028</div><div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;   Estimated error=-2.04241e-05</div><div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;Refinement cycle: 9</div><div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;   Number of degrees of freedom=29902</div><div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;   <a class="code" href="classPoint.html">Point</a> x-derivative=-0.052814</div><div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;@endcode</div><div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;* </div><div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;* </div><div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;</div><div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;* </div><div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;* The solution looks roughly the same as before (the exact solution ofcourse   &lt;em&gt;  is  &lt;/em&gt;   the same, only the grid changed a little), but thedual solution is now different. <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a> close-up around the point ofevaluation shows <span class="keyword">this</span>:  &lt;table align=<span class="stringliteral">&quot;center&quot;</span>&gt;</div><div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;  &lt;tr&gt;</div><div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;    &lt;td width=<span class="stringliteral">&quot;50%&quot;</span>&gt;</div><div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;      &lt;img src=<span class="stringliteral">&quot;https://www.dealii.org/images/steps/developer/step-14.point-derivative.solution-7-dual.png&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span>&gt;</div><div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;    &lt;/td&gt;</div><div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;    &lt;td width=<span class="stringliteral">&quot;50%&quot;</span>&gt;</div><div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;      &lt;img src=<span class="stringliteral">&quot;https://www.dealii.org/images/steps/developer/step-14.point-derivative.solution-7-dual-close-up.png&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span>&gt;</div><div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;    &lt;/td&gt;</div><div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;&lt;/table&gt;  This time, the grids in refinement cycles 0, 5, 6, 7, 8, and 9 looklike <span class="keyword">this</span>:</div><div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;*   &lt;table align=<span class="stringliteral">&quot;center&quot;</span> width=<span class="stringliteral">&quot;80%&quot;</span>&gt;</div><div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;  &lt;tr&gt;</div><div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;    &lt;td&gt;&lt;img src=<span class="stringliteral">&quot;https://www.dealii.org/images/steps/developer/step-14.point-derivative.grid-0.9.2.png&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span> width=<span class="stringliteral">&quot;100%&quot;</span>&gt;&lt;/td&gt;</div><div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;    &lt;td&gt;&lt;img src=<span class="stringliteral">&quot;https://www.dealii.org/images/steps/developer/step-14.point-derivative.grid-5.9.2.png&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span> width=<span class="stringliteral">&quot;100%&quot;</span>&gt;&lt;/td&gt;</div><div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;    &lt;td&gt;&lt;img src=<span class="stringliteral">&quot;https://www.dealii.org/images/steps/developer/step-14.point-derivative.grid-6.9.2.png&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span> width=<span class="stringliteral">&quot;100%&quot;</span>&gt;&lt;/td&gt;</div><div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;  &lt;/tr&gt;</div><div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;  &lt;tr&gt;</div><div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;    &lt;td&gt;&lt;img src=<span class="stringliteral">&quot;https://www.dealii.org/images/steps/developer/step-14.point-derivative.grid-7.9.2.png&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span> width=<span class="stringliteral">&quot;100%&quot;</span>&gt;&lt;/td&gt;</div><div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;    &lt;td&gt;&lt;img src=<span class="stringliteral">&quot;https://www.dealii.org/images/steps/developer/step-14.point-derivative.grid-8.9.2.png&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span> width=<span class="stringliteral">&quot;100%&quot;</span>&gt;&lt;/td&gt;</div><div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;    &lt;td&gt;&lt;img src=<span class="stringliteral">&quot;https://www.dealii.org/images/steps/developer/step-14.point-derivative.grid-9.9.2.png&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span> width=<span class="stringliteral">&quot;100%&quot;</span>&gt;&lt;/td&gt;</div><div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;  &lt;/tr&gt;</div><div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;&lt;/table&gt;  </div><div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;* Note the asymmetry of the grids compared with those we obtained forthe point evaluation. This is due to the fact that the domain and the primalsolution may be <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a1c0655acd718579199c777967de9eea5">symmetric</a> about the <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86">diagonal</a>, but the   @f$x@f$  -derivative isnot, and the latter enters the refinement criterion.</div><div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;* </div><div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;</div><div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;* </div><div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;* Then, it is interesting to compare actually computed values of thequantity of interest (i.e. the x-derivative of the solution at onepoint) with a reference value of</div><div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;* </div><div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;*  - .0528223... plus or minus0.0000005. We <span class="keyword">get</span> <span class="keyword">this</span> reference value by computing on finer grid aftersome more mesh refinements, with approximately 130,000 cells.Recall that <span class="keywordflow">if</span> the error is   @f$O(1/<a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>)@f$   in the optimal <span class="keywordflow">case</span>, thentaking a mesh with ten times more cells gives us one additional digitin the result.</div><div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;* </div><div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;</div><div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;* </div><div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;* In the left part of the following chart, you again see the convergenceof the error towards <span class="keyword">this</span> extrapolated value, <span class="keywordflow">while</span> on the right yousee a comparison of <span class="keyword">true</span> and estimated error:</div><div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;*   &lt;table width=<span class="stringliteral">&quot;80%&quot;</span> align=<span class="stringliteral">&quot;center&quot;</span>&gt;</div><div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;  &lt;tr&gt;</div><div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;    &lt;td&gt;&lt;img src=<span class="stringliteral">&quot;https://www.dealii.org/images/steps/developer/step-14.point-derivative.error.png&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span> width=<span class="stringliteral">&quot;100%&quot;</span>&gt;&lt;/td&gt;</div><div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;    &lt;td&gt;&lt;img src=<span class="stringliteral">&quot;https://www.dealii.org/images/steps/developer/step-14.point-derivative.error-estimation.png&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span> width=<span class="stringliteral">&quot;100%&quot;</span>&gt;&lt;/td&gt;</div><div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;  &lt;/tr&gt;</div><div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;&lt;/table&gt;  </div><div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;* After an <a class="code" href="namespaceAlgorithms_1_1Events.html#a15a12dfdadd39a026d192ad96cb6207b">initial</a> phase where the <span class="keyword">true</span> error changes its <a class="code" href="namespaceDifferentiation_1_1SD.html#aa55d50a1ffa79c27f9bd9ea104f15158">sign</a>, theestimated error matches it quite well, again. Also note the dramaticimprovement in the error when <span class="keyword">using</span> the estimated error to correct thecomputed value of   @f$J(u_h)@f$  .</div><div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;* </div><div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;</div><div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;* </div><div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;* &lt;a name=<span class="stringliteral">&quot;step13revisited&quot;</span>&gt;&lt;/a&gt;&lt;h3&gt;step-13 revisited&lt;/h3&gt;</div><div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;* </div><div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;</div><div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;* </div><div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;* If instead of the   &lt;code&gt;Exercise_2_3&lt;/code&gt;   data <span class="keyword">set</span>, we choose  &lt;code&gt;CurvedRidges&lt;/code&gt;   in the main <span class="keyword">function</span>, and choose   @f$(0.5,0.5)@f$  as the evaluation <a class="code" href="namespaceOpenCASCADE.html#a9509efa83e3b2fa42616fe0623cba696">point</a>, then we can redo thecomputations of the previous example program, to compare whether theresults obtained with the help of the dual weighted error estimatorare better than those we had previously.</div><div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;* </div><div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;</div><div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;* </div><div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;* First, the meshes after 9 adaptive refinement cycles obtained withthe point evaluation and derivative evaluation refinementcriteria, respectively, look like <span class="keyword">this</span>:</div><div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;*   &lt;table width=<span class="stringliteral">&quot;80%&quot;</span> align=<span class="stringliteral">&quot;center&quot;</span>&gt;</div><div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;  &lt;tr&gt;</div><div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;    &lt;td&gt;&lt;img src=<span class="stringliteral">&quot;https://www.dealii.org/images/steps/developer/step-14.step-13.point-value.png&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span> width=<span class="stringliteral">&quot;100%&quot;</span>&gt;&lt;/td&gt;</div><div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;    &lt;td&gt;&lt;img src=<span class="stringliteral">&quot;https://www.dealii.org/images/steps/developer/step-14.step-13.point-derivative.png&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span> width=<span class="stringliteral">&quot;100%&quot;</span>&gt;&lt;/td&gt;</div><div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;  &lt;/tr&gt;</div><div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;&lt;/table&gt;  </div><div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;* The features of the solution can still be seen in the mesh, but since thesolution is smooth, the singularities of the dual solution entirelydominate the mesh refinement criterion, and lead to stronglyconcentrated meshes. The solution after the seventh refinement step lookslike the following:</div><div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;*   &lt;table width=<span class="stringliteral">&quot;40%&quot;</span> align=<span class="stringliteral">&quot;center&quot;</span>&gt;</div><div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;  &lt;tr&gt;</div><div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;    &lt;td&gt;&lt;img src=<span class="stringliteral">&quot;https://www.dealii.org/images/steps/developer/step-14.step-13.solution-7.9.2.png&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span> width=<span class="stringliteral">&quot;100%&quot;</span>&gt;&lt;/td&gt;</div><div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;  &lt;/tr&gt;</div><div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;&lt;/table&gt;  </div><div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;* Obviously, the solution is worse at some places, but the meshrefinement process should have taken care that these places are notimportant <span class="keywordflow">for</span> computing the point value.</div><div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;* </div><div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;</div><div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;* </div><div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;* </div><div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;</div><div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;* The next point is to compare the <span class="keyword">new</span> (duality based) mesh refinementcriterion with the old ones. These are the results:</div><div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;*   &lt;img src=<span class="stringliteral">&quot;https://www.dealii.org/images/steps/developer/step-14.step-13.error-comparison.png&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span>&gt;  </div><div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;* </div><div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;</div><div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;* </div><div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;* The results are, well, somewhat mixed. First, the Kelly indicatordisqualifies itself by its unsteady behavior, changing the <a class="code" href="namespaceDifferentiation_1_1SD.html#aa55d50a1ffa79c27f9bd9ea104f15158">sign</a> of theerror several times, and with increasing errors under meshrefinement. The dual weighted error estimator has a monotone decreasein the error, and is better than the weighted Kelly and globalrefinement, but the margin is not as large as expected. This is, here,due to the fact the global refinement can exploit the regularstructure of the meshes around the point of evaluation, which leads toa better order of convergence <span class="keywordflow">for</span> the point error. However, <span class="keywordflow">if</span> we hada mesh that is not locally rectangular, <span class="keywordflow">for</span> example because we had toapproximate curved boundaries, or <span class="keywordflow">if</span> the coefficients were notconstant, then <span class="keyword">this</span> advantage of globally refinement meshes wouldvanish, <span class="keywordflow">while</span> the good performance of the duality based estimatorwould remain.</div><div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;* </div><div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;</div><div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;* </div><div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;* </div><div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;</div><div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;* &lt;a name=<span class="stringliteral">&quot;Conclusionsandoutlook&quot;</span>&gt;&lt;/a&gt;&lt;h3&gt;Conclusions and outlook&lt;/h3&gt;</div><div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;* </div><div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;</div><div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;* </div><div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;* The results here are not too clearly indicating the superiority of thedual weighted error estimation approach <span class="keywordflow">for</span> mesh refinement over othermesh refinement criteria, such as the Kelly indicator. This is due tothe relative simplicity of the shown applications. If you are notconvinced yet that <span class="keyword">this</span> approach is indeed superior, you are invitedto browse through the literature indicated in the introduction, whereplenty of examples are provided where the dual weighted approach canreduce the necessary numerical work by orders of magnitude, makingthis the only way to compute certain quantities to reasonableaccuracies at all.</div><div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;* </div><div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;</div><div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;* </div><div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;* Besides the objections you may <span class="keyword">raise</span> against its use as a meshrefinement criterion, consider that accurate knowledge of the error inthe quantity one might want to compute is of great use, since we canstop computations when we are satisfied with the accuracy. Using moretraditional approaches, it is very difficult to <span class="keyword">get</span> accurate estimatesfor arbitrary quantities, except <span class="keywordflow">for</span>, maybe, the error in the energynorm, and we will then have no guarantee that the result we computedsatisfies any requirements on its accuracy. Also, as was shown <span class="keywordflow">for</span> theevaluation of point values and derivatives, the error estimate can beused to <a class="code" href="namespaceFETools.html#ab2c5f72f3b99909fdf7d7bb215792400">extrapolate</a> the results, yielding much higher accuracy in thequantity we want to know.</div><div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;* </div><div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;</div><div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;* </div><div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;* Leaving these mathematical considerations, we tried to write theprogram in a modular way, such that implementing another test <span class="keywordflow">case</span>, oranother evaluation and dual functional is simple. You are encouragedto take the program as a basis <span class="keywordflow">for</span> your own experiments, and to play alittle.</div><div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;* </div><div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;</div><div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;* &lt;a name=<span class="stringliteral">&quot;PlainProg&quot;</span>&gt;&lt;/a&gt;&lt;h1&gt; The plain program&lt;/h1&gt;  @include <span class="stringliteral">&quot;step-14.cc&quot;</span>  </div><div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;*</div><div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;*/</div><div class="ttc" id="vectorization_8h_html_a11c48f86a4f2adf21555e64049ecde8c"><div class="ttname"><a href="vectorization_8h.html#a11c48f86a4f2adf21555e64049ecde8c">std::cos</a></div><div class="ttdeci">inline ::VectorizedArray&lt; Number, width &gt; cos(const ::VectorizedArray&lt; Number, width &gt; &amp;x)</div><div class="ttdef"><b>Definition:</b> <a href="vectorization_8h_source.html#l05359">vectorization.h:5359</a></div></div>
<div class="ttc" id="group__feaccess_html_ggaa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85"><div class="ttname"><a href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a></div><div class="ttdoc">Transformed quadrature weights. </div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00103">fe_update_flags.h:103</a></div></div>
<div class="ttc" id="classunsigned_01int_html"><div class="ttname"><a href="classunsigned_01int.html">unsigned int</a></div></div>
<div class="ttc" id="group__feaccess_html_ggaa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea"><div class="ttname"><a href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a></div><div class="ttdoc">Shape function values. </div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00062">fe_update_flags.h:62</a></div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_a45557450a3c1ae0e74d7ddf12c43bc98a1c0655acd718579199c777967de9eea5"><div class="ttname"><a href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a1c0655acd718579199c777967de9eea5">LAPACKSupport::symmetric</a></div><div class="ttdoc">Matrix is symmetric. </div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00116">lapack_support.h:116</a></div></div>
<div class="ttc" id="group__MeshWorker_html_gad10f528ab87f39fbb0531d24f238b2f3"><div class="ttname"><a href="group__MeshWorker.html#gad10f528ab87f39fbb0531d24f238b2f3">MeshWorker::loop</a></div><div class="ttdeci">void loop(ITERATOR begin, typename identity&lt; ITERATOR &gt;::type end, DOFINFO &amp;dinfo, INFOBOX &amp;info, const std::function&lt; void(DOFINFO &amp;, typename INFOBOX::CellInfo &amp;)&gt; &amp;cell_worker, const std::function&lt; void(DOFINFO &amp;, typename INFOBOX::CellInfo &amp;)&gt; &amp;boundary_worker, const std::function&lt; void(DOFINFO &amp;, DOFINFO &amp;, typename INFOBOX::CellInfo &amp;, typename INFOBOX::CellInfo &amp;)&gt; &amp;face_worker, ASSEMBLER &amp;assembler, const LoopControl &amp;lctrl=LoopControl())</div><div class="ttdef"><b>Definition:</b> <a href="loop_8h_source.html#l00449">loop.h:449</a></div></div>
<div class="ttc" id="namespaceDifferentiation_1_1SD_html_aa55d50a1ffa79c27f9bd9ea104f15158"><div class="ttname"><a href="namespaceDifferentiation_1_1SD.html#aa55d50a1ffa79c27f9bd9ea104f15158">Differentiation::SD::sign</a></div><div class="ttdeci">Expression sign(const Expression &amp;x)</div><div class="ttdef"><b>Definition:</b> <a href="symengine__math_8cc_source.html#l00280">symengine_math.cc:280</a></div></div>
<div class="ttc" id="namespacenumbers_html_a8ae36952c7e0cc778b47b5371b3aeff1"><div class="ttname"><a href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a></div><div class="ttdeci">static const unsigned int invalid_unsigned_int</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00167">types.h:167</a></div></div>
<div class="ttc" id="namespaceMatrixTools_html_a9ad0eb7a8662628534586716748d62fb"><div class="ttname"><a href="namespaceMatrixTools.html#a9ad0eb7a8662628534586716748d62fb">MatrixTools::apply_boundary_values</a></div><div class="ttdeci">void apply_boundary_values(const std::map&lt; types::global_dof_index, number &gt; &amp;boundary_values, SparseMatrix&lt; number &gt; &amp;matrix, Vector&lt; number &gt; &amp;solution, Vector&lt; number &gt; &amp;right_hand_side, const bool eliminate_columns=true)</div><div class="ttdef"><b>Definition:</b> <a href="matrix__tools_8cc_source.html#l00081">matrix_tools.cc:81</a></div></div>
<div class="ttc" id="classFunction_html"><div class="ttname"><a href="classFunction.html">Function&lt; dim &gt;</a></div></div>
<div class="ttc" id="numbers_8h_html_a5ecbfe991bebf7e99864f2e4eb3ea8df"><div class="ttname"><a href="numbers_8h.html#a5ecbfe991bebf7e99864f2e4eb3ea8df">std::log</a></div><div class="ttdeci">::VectorizedArray&lt; Number, width &gt; log(const ::VectorizedArray&lt; Number, width &gt; &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="vectorization_8h_source.html#l05421">vectorization.h:5421</a></div></div>
<div class="ttc" id="structCellData_html"><div class="ttname"><a href="structCellData.html">CellData</a></div><div class="ttdef"><b>Definition:</b> <a href="tria__description_8h_source.html#l00053">tria_description.h:53</a></div></div>
<div class="ttc" id="vectorization_8h_html_a19f846bda83b7e3f4531daacb40c64e1"><div class="ttname"><a href="vectorization_8h.html#a19f846bda83b7e3f4531daacb40c64e1">std::exp</a></div><div class="ttdeci">inline ::VectorizedArray&lt; Number, width &gt; exp(const ::VectorizedArray&lt; Number, width &gt; &amp;x)</div><div class="ttdef"><b>Definition:</b> <a href="vectorization_8h_source.html#l05400">vectorization.h:5400</a></div></div>
<div class="ttc" id="namespaceGridTools_html_acd5ccc543d561cfb086b571d1f7818cb"><div class="ttname"><a href="namespaceGridTools.html#acd5ccc543d561cfb086b571d1f7818cb">GridTools::diameter</a></div><div class="ttdeci">double diameter(const Triangulation&lt; dim, spacedim &gt; &amp;tria)</div><div class="ttdef"><b>Definition:</b> <a href="grid__tools_8cc_source.html#l00081">grid_tools.cc:81</a></div></div>
<div class="ttc" id="classPreconditionSSOR_html_a7a3d66b17bb0ea1b16606e222474c2ea"><div class="ttname"><a href="classPreconditionSSOR.html#a7a3d66b17bb0ea1b16606e222474c2ea">PreconditionSSOR::initialize</a></div><div class="ttdeci">void initialize(const MatrixType &amp;A, const typename BaseClass::AdditionalData &amp;parameters=typename BaseClass::AdditionalData())</div></div>
<div class="ttc" id="classCellAccessor_html_ad4b8ec35236bea8ee91a72bbd19762fe"><div class="ttname"><a href="classCellAccessor.html#ad4b8ec35236bea8ee91a72bbd19762fe">CellAccessor::active_cell_index</a></div><div class="ttdeci">unsigned int active_cell_index() const</div><div class="ttdef"><b>Definition:</b> <a href="tria__accessor_8cc_source.html#l02099">tria_accessor.cc:2099</a></div></div>
<div class="ttc" id="namespaceDataOutBase_html_aa3cbced9f1d4ae661f13018f4c980aa1acff6079f78795530409873a79263ad7e"><div class="ttname"><a href="namespaceDataOutBase.html#aa3cbced9f1d4ae661f13018f4c980aa1acff6079f78795530409873a79263ad7e">DataOutBase::vtu</a></div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8h_source.html#l01380">data_out_base.h:1380</a></div></div>
<div class="ttc" id="classSmartPointer_html"><div class="ttname"><a href="classSmartPointer.html">SmartPointer</a></div><div class="ttdef"><b>Definition:</b> <a href="smartpointer_8h_source.html#l00060">smartpointer.h:60</a></div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_a1a9009db0d9a77923a7031b549b9b638a5bc7c54a9c20485772672825c6a73003"><div class="ttname"><a href="namespaceLAPACKSupport.html#a1a9009db0d9a77923a7031b549b9b638a5bc7c54a9c20485772672825c6a73003">LAPACKSupport::matrix</a></div><div class="ttdoc">Contents is actually a matrix. </div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00060">lapack_support.h:60</a></div></div>
<div class="ttc" id="classDynamicSparsityPattern_html"><div class="ttname"><a href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamic__sparsity__pattern_8h_source.html#l00296">dynamic_sparsity_pattern.h:296</a></div></div>
<div class="ttc" id="namespacePhysics_1_1Elasticity_1_1Kinematics_html_a9587d5229555daa5b1fa1ba2f8a40adb"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">Physics::Elasticity::Kinematics::e</a></div><div class="ttdeci">SymmetricTensor&lt; 2, dim, Number &gt; e(const Tensor&lt; 2, dim, Number &gt; &amp;F)</div></div>
<div class="ttc" id="group__threads_html_ga8c1e15b84e1bb58a8029fc6d6ddf3cbf"><div class="ttname"><a href="group__threads.html#ga8c1e15b84e1bb58a8029fc6d6ddf3cbf">Threads::new_task</a></div><div class="ttdeci">Task&lt; RT &gt; new_task(const std::function&lt; RT()&gt; &amp;function)</div><div class="ttdef"><b>Definition:</b> <a href="thread__management_8h_source.html#l01174">thread_management.h:1174</a></div></div>
<div class="ttc" id="classThreads_1_1Task_html"><div class="ttname"><a href="classThreads_1_1Task.html">Threads::Task</a></div><div class="ttdef"><b>Definition:</b> <a href="thread__management_8h_source.html#l00891">thread_management.h:891</a></div></div>
<div class="ttc" id="classVector_html"><div class="ttname"><a href="classVector.html">Vector</a></div><div class="ttdef"><b>Definition:</b> <a href="mapping__q1__eulerian_8h_source.html#l00033">mapping_q1_eulerian.h:33</a></div></div>
<div class="ttc" id="classAffineConstraints_html"><div class="ttname"><a href="classAffineConstraints.html">AffineConstraints&lt; double &gt;</a></div></div>
<div class="ttc" id="namespaceinternal_html_aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804"><div class="ttname"><a href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">internal::EvaluatorQuantity::value</a></div></div>
<div class="ttc" id="classDataOut_html_a087f63e22f0614bca326dbdca288c646"><div class="ttname"><a href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">DataOut::build_patches</a></div><div class="ttdeci">virtual void build_patches(const unsigned int n_subdivisions=0)</div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__out_8cc_source.html#l01071">data_out.cc:1071</a></div></div>
<div class="ttc" id="classFiniteElementData_html_a2cbf5ad6b464871261dbd054bced18a8"><div class="ttname"><a href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">FiniteElementData::degree</a></div><div class="ttdeci">const unsigned int degree</div><div class="ttdef"><b>Definition:</b> <a href="fe__base_8h_source.html#l00373">fe_base.h:373</a></div></div>
<div class="ttc" id="classThreads_1_1Task_html_a9aed8f99d2b88bd0d6cfff95e38c3ac7"><div class="ttname"><a href="classThreads_1_1Task.html#a9aed8f99d2b88bd0d6cfff95e38c3ac7">Threads::Task::join</a></div><div class="ttdeci">void join() const</div><div class="ttdef"><b>Definition:</b> <a href="thread__management_8h_source.html#l00965">thread_management.h:965</a></div></div>
<div class="ttc" id="namespaceDataOutBase_html_aa3cbced9f1d4ae661f13018f4c980aa1af54db6e70b60a249b36f803d0657b39e"><div class="ttname"><a href="namespaceDataOutBase.html#aa3cbced9f1d4ae661f13018f4c980aa1af54db6e70b60a249b36f803d0657b39e">DataOutBase::dx</a></div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8h_source.html#l01325">data_out_base.h:1325</a></div></div>
<div class="ttc" id="namespacestd_html"><div class="ttname"><a href="namespacestd.html">std</a></div><div class="ttdoc">STL namespace. </div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_aceda56512460bbad2f9fdb8a3d0e1e51"><div class="ttname"><a href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">LAPACKSupport::one</a></div><div class="ttdeci">static const types::blas_int one</div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00198">lapack_support.h:198</a></div></div>
<div class="ttc" id="namespaceLocalIntegrators_1_1Advection_html_a8bc7b8136646134f73a4193adefe15f8"><div class="ttname"><a href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">LocalIntegrators::Advection::cell_matrix</a></div><div class="ttdeci">void cell_matrix(FullMatrix&lt; double &gt; &amp;M, const FEValuesBase&lt; dim &gt; &amp;fe, const FEValuesBase&lt; dim &gt; &amp;fetest, const ArrayView&lt; const std::vector&lt; double &gt;&gt; &amp;velocity, const double factor=1.)</div><div class="ttdef"><b>Definition:</b> <a href="advection_8h_source.html#l00063">advection.h:63</a></div></div>
<div class="ttc" id="group__feaccess_html_ggaa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a"><div class="ttname"><a href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a></div><div class="ttdoc">Transformed quadrature points. </div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00097">fe_update_flags.h:97</a></div></div>
<div class="ttc" id="group__Exceptions_html_gafc0ca7ad85b3ebd64e8e51689ac85caf"><div class="ttname"><a href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a></div><div class="ttdeci">#define AssertThrow(cond, exc)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2exceptions_8h_source.html#l01519">exceptions.h:1519</a></div></div>
<div class="ttc" id="grid__out_8cc_html_a2cc229a4f1ffc75e83ed269d5f725729"><div class="ttname"><a href="grid__out_8cc.html#a2cc229a4f1ffc75e83ed269d5f725729">second</a></div><div class="ttdeci">Point&lt; 2 &gt; second</div><div class="ttdef"><b>Definition:</b> <a href="grid__out_8cc_source.html#l04588">grid_out.cc:4588</a></div></div>
<div class="ttc" id="namespaceLocalIntegrators_1_1Advection_html_aaff3056f2b80ada5c55d8c5825932c22"><div class="ttname"><a href="namespaceLocalIntegrators_1_1Advection.html#aaff3056f2b80ada5c55d8c5825932c22">LocalIntegrators::Advection::cell_residual</a></div><div class="ttdeci">void cell_residual(Vector&lt; double &gt; &amp;result, const FEValuesBase&lt; dim &gt; &amp;fe, const std::vector&lt; Tensor&lt; 1, dim &gt;&gt; &amp;input, const ArrayView&lt; const std::vector&lt; double &gt;&gt; &amp;velocity, double factor=1.)</div><div class="ttdef"><b>Definition:</b> <a href="advection_8h_source.html#l00117">advection.h:117</a></div></div>
<div class="ttc" id="namespaceWorkStream_html"><div class="ttname"><a href="namespaceWorkStream.html">WorkStream</a></div><div class="ttdef"><b>Definition:</b> <a href="work__stream_8h_source.html#l00079">work_stream.h:79</a></div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_ae4c4142bb80d7e6e5214c37fac73e1da"><div class="ttname"><a href="namespaceLAPACKSupport.html#ae4c4142bb80d7e6e5214c37fac73e1da">LAPACKSupport::O</a></div><div class="ttdeci">static const char O</div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00168">lapack_support.h:168</a></div></div>
<div class="ttc" id="classDoFHandler_html_ac1fedeb50b5f03b13d8b69f86e33f726"><div class="ttname"><a href="classDoFHandler.html#ac1fedeb50b5f03b13d8b69f86e33f726">DoFHandler::get_fe</a></div><div class="ttdeci">const FiniteElement&lt; dim, spacedim &gt; &amp; get_fe(const unsigned int index=0) const</div></div>
<div class="ttc" id="classPoint_html"><div class="ttname"><a href="classPoint.html">Point&lt; dim &gt;</a></div></div>
<div class="ttc" id="namespaceFETools_html_ad29759cb8c51f8d369a371f63be8dde0"><div class="ttname"><a href="namespaceFETools.html#ad29759cb8c51f8d369a371f63be8dde0">FETools::interpolate</a></div><div class="ttdeci">void interpolate(const DoFHandler&lt; dim, spacedim &gt; &amp;dof1, const InVector &amp;u1, const DoFHandler&lt; dim, spacedim &gt; &amp;dof2, OutVector &amp;u2)</div></div>
<div class="ttc" id="classDataOutInterface_html_a78e73ad285a8792ff0f9f227b82eb108"><div class="ttname"><a href="classDataOutInterface.html#a78e73ad285a8792ff0f9f227b82eb108">DataOutInterface::write</a></div><div class="ttdeci">void write(std::ostream &amp;out, const DataOutBase::OutputFormat output_format=DataOutBase::default_format) const</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8cc_source.html#l08134">data_out_base.cc:8134</a></div></div>
<div class="ttc" id="namespaceparallel_html"><div class="ttname"><a href="namespaceparallel.html">parallel</a></div><div class="ttdef"><b>Definition:</b> <a href="doc_2doxygen_2headers_2distributed_8h_source.html#l00150">distributed.h:150</a></div></div>
<div class="ttc" id="namespaceFETools_html_ab2c5f72f3b99909fdf7d7bb215792400"><div class="ttname"><a href="namespaceFETools.html#ab2c5f72f3b99909fdf7d7bb215792400">FETools::extrapolate</a></div><div class="ttdeci">void extrapolate(const DoFHandler&lt; dim, spacedim &gt; &amp;dof1, const InVector &amp;z1, const DoFHandler&lt; dim, spacedim &gt; &amp;dof2, OutVector &amp;z2)</div></div>
<div class="ttc" id="namespacePhysics_1_1Elasticity_1_1Kinematics_html_a09916360abaee5f1fb31994dbc96787b"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a09916360abaee5f1fb31994dbc96787b">Physics::Elasticity::Kinematics::C</a></div><div class="ttdeci">SymmetricTensor&lt; 2, dim, Number &gt; C(const Tensor&lt; 2, dim, Number &gt; &amp;F)</div></div>
<div class="ttc" id="classFullMatrix_html"><div class="ttname"><a href="classFullMatrix.html">FullMatrix&lt; double &gt;</a></div></div>
<div class="ttc" id="namespaceDoFTools_html_ad31df71a29dd76de9b4ab241b2527160a155b9e72113d7008c60732d350bfbb7a"><div class="ttname"><a href="namespaceDoFTools.html#ad31df71a29dd76de9b4ab241b2527160a155b9e72113d7008c60732d350bfbb7a">DoFTools::nonzero</a></div><div class="ttdef"><b>Definition:</b> <a href="dof__tools_8h_source.html#l00161">dof_tools.h:161</a></div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86"><div class="ttname"><a href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86">LAPACKSupport::diagonal</a></div><div class="ttdoc">Matrix is diagonal. </div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00122">lapack_support.h:122</a></div></div>
<div class="ttc" id="namespaceThreads_1_1internal_html_a8d237a30d09b13e0b5adbe0fd1dfb188"><div class="ttname"><a href="namespaceThreads_1_1internal.html#a8d237a30d09b13e0b5adbe0fd1dfb188">Threads::internal::call</a></div><div class="ttdeci">void call(const std::function&lt; RT()&gt; &amp;function, internal::return_value&lt; RT &gt; &amp;ret_val)</div><div class="ttdef"><b>Definition:</b> <a href="thread__management_8h_source.html#l00346">thread_management.h:346</a></div></div>
<div class="ttc" id="classQuadrature_html"><div class="ttname"><a href="classQuadrature.html">Quadrature</a></div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2quadrature_8h_source.html#l00058">quadrature.h:58</a></div></div>
<div class="ttc" id="namespaceFunctions_html"><div class="ttname"><a href="namespaceFunctions.html">Functions</a></div><div class="ttdef"><b>Definition:</b> <a href="flow__function_8h_source.html#l00029">flow_function.h:29</a></div></div>
<div class="ttc" id="classQGauss_html"><div class="ttname"><a href="classQGauss.html">QGauss</a></div><div class="ttdef"><b>Definition:</b> <a href="quadrature__lib_8h_source.html#l00039">quadrature_lib.h:39</a></div></div>
<div class="ttc" id="classGridOut_html_a1fa6434f6a8d8cda104d47728d30c657"><div class="ttname"><a href="classGridOut.html#a1fa6434f6a8d8cda104d47728d30c657">GridOut::write_svg</a></div><div class="ttdeci">void write_svg(const Triangulation&lt; 2, 2 &gt; &amp;tria, std::ostream &amp;out) const</div><div class="ttdef"><b>Definition:</b> <a href="grid__out_8cc_source.html#l01739">grid_out.cc:1739</a></div></div>
<div class="ttc" id="classFunctions_1_1ConstantFunction_html"><div class="ttname"><a href="classFunctions_1_1ConstantFunction.html">Functions::ConstantFunction</a></div><div class="ttdef"><b>Definition:</b> <a href="function_8h_source.html#l00348">function.h:348</a></div></div>
<div class="ttc" id="classSparsityPattern_html"><div class="ttname"><a href="classSparsityPattern.html">SparsityPattern</a></div><div class="ttdef"><b>Definition:</b> <a href="sparsity__pattern_8h_source.html#l00762">sparsity_pattern.h:762</a></div></div>
<div class="ttc" id="classSolverControl_html"><div class="ttname"><a href="classSolverControl.html">SolverControl</a></div><div class="ttdef"><b>Definition:</b> <a href="solver__control_8h_source.html#l00047">solver_control.h:47</a></div></div>
<div class="ttc" id="namespaceEvaluationFlags_html_a9b7c6d689cb76386839d0d13640f59aea91b5f00e4be473005cc331b8644ab2f1"><div class="ttname"><a href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aea91b5f00e4be473005cc331b8644ab2f1">EvaluationFlags::gradients</a></div><div class="ttdef"><b>Definition:</b> <a href="evaluation__flags_8h_source.html#l00059">evaluation_flags.h:59</a></div></div>
<div class="ttc" id="namespaceUtilities_1_1MPI_html_ab544a3bf3301a6dd3e705ee352c5551b"><div class="ttname"><a href="namespaceUtilities_1_1MPI.html#ab544a3bf3301a6dd3e705ee352c5551b">Utilities::MPI::sum</a></div><div class="ttdeci">T sum(const T &amp;t, const MPI_Comm &amp;mpi_communicator)</div></div>
<div class="ttc" id="namespaceTensorAccessors_html_a5798da96660fa8e6798917501d65dbd8"><div class="ttname"><a href="namespaceTensorAccessors.html#a5798da96660fa8e6798917501d65dbd8">TensorAccessors::extract</a></div><div class="ttdeci">constexpr ReturnType&lt; rank, T &gt;::value_type &amp; extract(T &amp;t, const ArrayType &amp;indices)</div><div class="ttdef"><b>Definition:</b> <a href="tensor__accessors_8h_source.html#l00244">tensor_accessors.h:244</a></div></div>
<div class="ttc" id="group__Exceptions_html_ga70a0bb353656e704acf927945277bbc6"><div class="ttname"><a href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a></div><div class="ttdeci">#define Assert(cond, exc)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2exceptions_8h_source.html#l01415">exceptions.h:1415</a></div></div>
<div class="ttc" id="group__CPP11_html_gacdb6d3adec96a13a7079f6c893e1d3ff"><div class="ttname"><a href="group__CPP11.html#gacdb6d3adec96a13a7079f6c893e1d3ff">DoFHandler::active_cell_iterators</a></div><div class="ttdeci">IteratorRange&lt; active_cell_iterator &gt; active_cell_iterators() const</div><div class="ttdef"><b>Definition:</b> <a href="dof__handler_8cc_source.html#l02327">dof_handler.cc:2327</a></div></div>
<div class="ttc" id="namespaceparallel_1_1distributed_1_1GridRefinement_html_aa2ffb707a796ae6dedb75036606ef2e6"><div class="ttname"><a href="namespaceparallel_1_1distributed_1_1GridRefinement.html#aa2ffb707a796ae6dedb75036606ef2e6">parallel::distributed::GridRefinement::refine_and_coarsen_fixed_number</a></div><div class="ttdeci">void refine_and_coarsen_fixed_number(parallel::distributed::Triangulation&lt; dim, spacedim &gt; &amp;tria, const ::Vector&lt; Number &gt; &amp;criteria, const double top_fraction_of_cells, const double bottom_fraction_of_cells, const types::global_cell_index max_n_cells=std::numeric_limits&lt; types::global_cell_index &gt;::max())</div><div class="ttdef"><b>Definition:</b> <a href="distributed_2grid__refinement_8cc_source.html#l00493">grid_refinement.cc:493</a></div></div>
<div class="ttc" id="classPreconditionSSOR_html"><div class="ttname"><a href="classPreconditionSSOR.html">PreconditionSSOR</a></div><div class="ttdef"><b>Definition:</b> <a href="precondition_8h_source.html#l00667">precondition.h:667</a></div></div>
<div class="ttc" id="namespaceinternal_html_aa5bef221c94bc6b9c5441c306a72cdbaae2b6dfb8a5c48206992d8310d176c37c"><div class="ttname"><a href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaae2b6dfb8a5c48206992d8310d176c37c">internal::EvaluatorQuantity::gradient</a></div></div>
<div class="ttc" id="numbers_8h_html_ac4a2ed1890a931d0b6a55933310eadca"><div class="ttname"><a href="numbers_8h.html#ac4a2ed1890a931d0b6a55933310eadca">std::sqrt</a></div><div class="ttdeci">::VectorizedArray&lt; Number, width &gt; sqrt(const ::VectorizedArray&lt; Number, width &gt; &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="vectorization_8h_source.html#l05442">vectorization.h:5442</a></div></div>
<div class="ttc" id="classSparseMatrix_html"><div class="ttname"><a href="classSparseMatrix.html">SparseMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="sparse__matrix_8h_source.html#l00479">sparse_matrix.h:479</a></div></div>
<div class="ttc" id="grid__tools_8cc_html_a9bb17554c06536e62c37d90eb7a28d6a"><div class="ttname"><a href="grid__tools_8cc.html#a9bb17554c06536e62c37d90eb7a28d6a">vertex_indices</a></div><div class="ttdeci">unsigned int vertex_indices[2]</div><div class="ttdef"><b>Definition:</b> <a href="grid__tools_8cc_source.html#l01256">grid_tools.cc:1256</a></div></div>
<div class="ttc" id="namespaceVectorTools_html_a69967cb7a148a7169963126249213db1a485d4198c1f422388b80cadb98af1f27"><div class="ttname"><a href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1a485d4198c1f422388b80cadb98af1f27">VectorTools::mean</a></div><div class="ttdef"><b>Definition:</b> <a href="vector__tools__common_8h_source.html#l00066">vector_tools_common.h:66</a></div></div>
<div class="ttc" id="classSolverCG_html"><div class="ttname"><a href="classSolverCG.html">SolverCG</a></div><div class="ttdef"><b>Definition:</b> <a href="solver__cg_8h_source.html#l00078">solver_cg.h:78</a></div></div>
<div class="ttc" id="classDoFHandler_html_aa5b8d3c4b9deb0774dde5c2851e07e1e"><div class="ttname"><a href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">DoFHandler::n_dofs</a></div><div class="ttdeci">types::global_dof_index n_dofs() const</div></div>
<div class="ttc" id="namespaceTrilinosWrappers_1_1internal_html_aee42c8e3004e2e81eac3c3356d3ec46b"><div class="ttname"><a href="namespaceTrilinosWrappers_1_1internal.html#aee42c8e3004e2e81eac3c3356d3ec46b">TrilinosWrappers::internal::end</a></div><div class="ttdeci">VectorType::value_type * end(VectorType &amp;V)</div><div class="ttdef"><b>Definition:</b> <a href="trilinos__sparse__matrix_8cc_source.html#l00067">trilinos_sparse_matrix.cc:67</a></div></div>
<div class="ttc" id="namespacePatterns_1_1Tools_html_a72743302dcb1a0fb1f2f8dc5122d299e"><div class="ttname"><a href="namespacePatterns_1_1Tools.html#a72743302dcb1a0fb1f2f8dc5122d299e">Patterns::Tools::to_string</a></div><div class="ttdeci">std::string to_string(const T &amp;t)</div><div class="ttdef"><b>Definition:</b> <a href="patterns_8h_source.html#l02231">patterns.h:2231</a></div></div>
<div class="ttc" id="data__out__base_8cc_html_accc45da40beb7ae1b485306984e904a2"><div class="ttname"><a href="data__out__base_8cc.html#accc45da40beb7ae1b485306984e904a2">vertices</a></div><div class="ttdeci">Point&lt; 3 &gt; vertices[4]</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8cc_source.html#l00175">data_out_base.cc:175</a></div></div>
<div class="ttc" id="classTriangulation_html"><div class="ttname"><a href="classTriangulation.html">Triangulation&lt; dim &gt;</a></div></div>
<div class="ttc" id="classDataOut__DoFData_html_a79cbe2f02f8dfb85026c71d783dbb703"><div class="ttname"><a href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">DataOut_DoFData::add_data_vector</a></div><div class="ttdeci">void add_data_vector(const VectorType &amp;data, const std::vector&lt; std::string &gt; &amp;names, const DataVectorType type=type_automatic, const std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt; &amp;data_component_interpretation=std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt;())</div><div class="ttdef"><b>Definition:</b> <a href="data__out__dof__data_8h_source.html#l00902">data_out_dof_data.h:902</a></div></div>
<div class="ttc" id="classGridOut_html"><div class="ttname"><a href="classGridOut.html">GridOut</a></div><div class="ttdef"><b>Definition:</b> <a href="grid__out_8h_source.html#l00979">grid_out.h:979</a></div></div>
<div class="ttc" id="classDataOut_html"><div class="ttname"><a href="classDataOut.html">DataOut&lt; dim &gt;</a></div></div>
<div class="ttc" id="namespaceUtilities_html_a1ebf9e8745b1c1c0f314d24a1ec90921"><div class="ttname"><a href="namespaceUtilities.html#a1ebf9e8745b1c1c0f314d24a1ec90921">Utilities::pack</a></div><div class="ttdeci">size_t pack(const T &amp;object, std::vector&lt; char &gt; &amp;dest_buffer, const bool allow_compression=true)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2utilities_8h_source.html#l01066">utilities.h:1066</a></div></div>
<div class="ttc" id="namespacePhysics_1_1Elasticity_1_1Kinematics_html_a15728437b942dab0b0042eb06a407d2c"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">Physics::Elasticity::Kinematics::d</a></div><div class="ttdeci">SymmetricTensor&lt; 2, dim, Number &gt; d(const Tensor&lt; 2, dim, Number &gt; &amp;F, const Tensor&lt; 2, dim, Number &gt; &amp;dF_dt)</div></div>
<div class="ttc" id="namespaceinternal_html_a2b3d48efdf7c94da455dc6a3553bab79"><div class="ttname"><a href="namespaceinternal.html#a2b3d48efdf7c94da455dc6a3553bab79">internal::assemble</a></div><div class="ttdeci">void assemble(const MeshWorker::DoFInfoBox&lt; dim, DOFINFO &gt; &amp;dinfo, A *assembler)</div><div class="ttdef"><b>Definition:</b> <a href="loop_8h_source.html#l00073">loop.h:73</a></div></div>
<div class="ttc" id="classFESubfaceValues_html"><div class="ttname"><a href="classFESubfaceValues.html">FESubfaceValues</a></div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2fe_2fe_8h_source.html#l00043">fe.h:43</a></div></div>
<div class="ttc" id="namespaceDoFTools_html_ad31df71a29dd76de9b4ab241b2527160a6a742e14fbc92a1c202d77d4f319d5ec"><div class="ttname"><a href="namespaceDoFTools.html#ad31df71a29dd76de9b4ab241b2527160a6a742e14fbc92a1c202d77d4f319d5ec">DoFTools::always</a></div><div class="ttdef"><b>Definition:</b> <a href="dof__tools_8h_source.html#l00154">dof_tools.h:154</a></div></div>
<div class="ttc" id="namespaceinternal_1_1TriangulationImplementation_html_a9f815604be9b560fea00beef8d720480"><div class="ttname"><a href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">internal::TriangulationImplementation::n_cells</a></div><div class="ttdeci">unsigned int n_cells(const internal::TriangulationImplementation::NumberCache&lt; 1 &gt; &amp;c)</div><div class="ttdef"><b>Definition:</b> <a href="grid_2tria_8cc_source.html#l12588">tria.cc:12588</a></div></div>
<div class="ttc" id="classFiniteElementData_html_ae2fa3b8d578ba488b4f37061bb0278bb"><div class="ttname"><a href="classFiniteElementData.html#ae2fa3b8d578ba488b4f37061bb0278bb">FiniteElementData::dofs_per_cell</a></div><div class="ttdeci">const unsigned int dofs_per_cell</div><div class="ttdef"><b>Definition:</b> <a href="fe__base_8h_source.html#l00361">fe_base.h:361</a></div></div>
<div class="ttc" id="classKellyErrorEstimator_html_ae2269e1c9903e9d863b7abd54948af00"><div class="ttname"><a href="classKellyErrorEstimator.html#ae2269e1c9903e9d863b7abd54948af00">KellyErrorEstimator::estimate</a></div><div class="ttdeci">static void estimate(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const Quadrature&lt; dim - 1 &gt; &amp;quadrature, const std::map&lt; types::boundary_id, const Function&lt; spacedim, typename InputVector::value_type &gt; *&gt; &amp;neumann_bc, const InputVector &amp;solution, Vector&lt; float &gt; &amp;error, const ComponentMask &amp;component_mask=ComponentMask(), const Function&lt; spacedim &gt; *coefficients=nullptr, const unsigned int n_threads=numbers::invalid_unsigned_int, const types::subdomain_id subdomain_id=numbers::invalid_subdomain_id, const types::material_id material_id=numbers::invalid_material_id, const Strategy strategy=cell_diameter_over_24)</div></div>
<div class="ttc" id="grid__out_8cc_html_a827a345f29da7caeb588b11013869a01"><div class="ttname"><a href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a></div><div class="ttdeci">Point&lt; 2 &gt; first</div><div class="ttdef"><b>Definition:</b> <a href="grid__out_8cc_source.html#l04587">grid_out.cc:4587</a></div></div>
<div class="ttc" id="namespaceAlgorithms_1_1Events_html_a15a12dfdadd39a026d192ad96cb6207b"><div class="ttname"><a href="namespaceAlgorithms_1_1Events.html#a15a12dfdadd39a026d192ad96cb6207b">Algorithms::Events::initial</a></div><div class="ttdeci">const Event initial</div><div class="ttdef"><b>Definition:</b> <a href="event_8cc_source.html#l00065">event.cc:65</a></div></div>
<div class="ttc" id="classFEValuesBase_html_a807c3049bfe81743fc0f237dfc2fbdea"><div class="ttname"><a href="classFEValuesBase.html#a807c3049bfe81743fc0f237dfc2fbdea">FEValuesBase::n_quadrature_points</a></div><div class="ttdeci">const unsigned int n_quadrature_points</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values_8h_source.html#l02027">fe_values.h:2027</a></div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_a40707d49114d54318c823f3b750e89a4"><div class="ttname"><a href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">LAPACKSupport::A</a></div><div class="ttdeci">static const char A</div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00158">lapack_support.h:158</a></div></div>
<div class="ttc" id="group__CUDAWrappers_html_gabb7130e2cea54654455ca41ef304f939"><div class="ttname"><a href="group__CUDAWrappers.html#gabb7130e2cea54654455ca41ef304f939">LinearAlgebra::CUDAWrappers::kernel::set</a></div><div class="ttdeci">__global__ void set(Number *val, const Number s, const size_type N)</div></div>
<div class="ttc" id="namespaceVectorTools_html_af27ac28c698a9ed0199faed50a204538"><div class="ttname"><a href="namespaceVectorTools.html#af27ac28c698a9ed0199faed50a204538">VectorTools::interpolate_boundary_values</a></div><div class="ttdeci">void interpolate_boundary_values(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const std::map&lt; types::boundary_id, const Function&lt; spacedim, number &gt; *&gt; &amp;function_map, std::map&lt; types::global_dof_index, number &gt; &amp;boundary_values, const ComponentMask &amp;component_mask=ComponentMask())</div></div>
<div class="ttc" id="namespaceinternal_html_a3ad80900781e8648c01c491a7545894e"><div class="ttname"><a href="namespaceinternal.html#a3ad80900781e8648c01c491a7545894e">internal::DeclException1</a></div><div class="ttdeci">DeclException1(ExcMatrixFreeAccessToUninitializedMappingField, std::string,&lt;&lt; &quot;You are requesting information from an FEEvaluation/FEFaceEvaluation &quot;&lt;&lt; &quot;object for which this kind of information has not been computed. What &quot;&lt;&lt; &quot;information these objects compute is determined by the update_* flags you &quot;&lt;&lt; &quot;pass to MatrixFree::reinit() via MatrixFree::AdditionalData. Here, &quot;&lt;&lt; &quot;the operation you are attempting requires the &lt;&quot;&lt;&lt; arg1&lt;&lt; &quot;&gt; flag to be set, but it was apparently not specified &quot;&lt;&lt; &quot;upon initialization.&quot;)</div></div>
<div class="ttc" id="classDataOut__DoFData_html_a6ed7c846331069f406b8c9933c37fda4"><div class="ttname"><a href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">DataOut_DoFData::attach_dof_handler</a></div><div class="ttdeci">void attach_dof_handler(const DoFHandler&lt; dim, spacedim &gt; &amp;)</div></div>
<div class="ttc" id="group__feaccess_html_ggaa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20"><div class="ttname"><a href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a></div><div class="ttdoc">Shape function gradients. </div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00068">fe_update_flags.h:68</a></div></div>
<div class="ttc" id="namespaceGridTools_html_a9e8169dc4981e90ba5d2386a87efa042"><div class="ttname"><a href="namespaceGridTools.html#a9e8169dc4981e90ba5d2386a87efa042">GridTools::volume</a></div><div class="ttdeci">double volume(const Triangulation&lt; dim, spacedim &gt; &amp;tria, const Mapping&lt; dim, spacedim &gt; &amp;mapping=(ReferenceCells::get_hypercube&lt; dim &gt;() .template get_default_linear_mapping&lt; dim, spacedim &gt;()))</div><div class="ttdef"><b>Definition:</b> <a href="grid__tools_8cc_source.html#l00137">grid_tools.cc:137</a></div></div>
<div class="ttc" id="classFunctions_1_1ZeroFunction_html"><div class="ttname"><a href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction</a></div><div class="ttdef"><b>Definition:</b> <a href="function_8h_source.html#l00444">function.h:444</a></div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_a8edacd69ab93285f82b7f63c733a86b7"><div class="ttname"><a href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">LAPACKSupport::N</a></div><div class="ttdeci">static const char N</div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00163">lapack_support.h:163</a></div></div>
<div class="ttc" id="classDoFHandler_html"><div class="ttname"><a href="classDoFHandler.html">DoFHandler&lt; dim &gt;</a></div></div>
<div class="ttc" id="namespaceGridGenerator_html_acea0cbcd68e52ce8113d1134b87de403"><div class="ttname"><a href="namespaceGridGenerator.html#acea0cbcd68e52ce8113d1134b87de403">GridGenerator::hyper_cube</a></div><div class="ttdeci">void hyper_cube(Triangulation&lt; dim, spacedim &gt; &amp;tria, const double left=0., const double right=1., const bool colorize=false)</div></div>
<div class="ttc" id="namespacenumbers_html"><div class="ttname"><a href="namespacenumbers.html">numbers</a></div><div class="ttdef"><b>Definition:</b> <a href="numbers_8h_source.html#l00187">numbers.h:187</a></div></div>
<div class="ttc" id="classVector_html_ac4a4dbef7dd65ef8ad35ae56b57d7c05"><div class="ttname"><a href="classVector.html#ac4a4dbef7dd65ef8ad35ae56b57d7c05">Vector::reinit</a></div><div class="ttdeci">virtual void reinit(const size_type N, const bool omit_zeroing_entries=false)</div></div>
<div class="ttc" id="group__constraints_html_gaf78e864edbfba7e0a7477457bfb96b26"><div class="ttname"><a href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a></div><div class="ttdeci">void make_sparsity_pattern(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, SparsityPatternType &amp;sparsity_pattern, const AffineConstraints&lt; number &gt; &amp;constraints=AffineConstraints&lt; number &gt;(), const bool keep_constrained_dofs=true, const types::subdomain_id subdomain_id=numbers::invalid_subdomain_id)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools__sparsity_8cc_source.html#l00064">dof_tools_sparsity.cc:64</a></div></div>
<div class="ttc" id="classFEValues_html"><div class="ttname"><a href="classFEValues.html">FEValues&lt; dim &gt;</a></div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_a45557450a3c1ae0e74d7ddf12c43bc98af25b68380698c53fa6da3e05379c0855"><div class="ttname"><a href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98af25b68380698c53fa6da3e05379c0855">LAPACKSupport::general</a></div><div class="ttdoc">No special properties. </div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00114">lapack_support.h:114</a></div></div>
<div class="ttc" id="data__out__base_8cc_html_a8188ef4709fc9a4cc076d37447783ba1"><div class="ttname"><a href="data__out__base_8cc.html#a8188ef4709fc9a4cc076d37447783ba1">center</a></div><div class="ttdeci">Point&lt; 3 &gt; center</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8cc_source.html#l00170">data_out_base.cc:170</a></div></div>
<div class="ttc" id="namespaceIteratorState_html_a4e92f4a9d339ff987cc3eb5b0a1ac507a457da025bc5a3a2231a667bd5c6f3c92"><div class="ttname"><a href="namespaceIteratorState.html#a4e92f4a9d339ff987cc3eb5b0a1ac507a457da025bc5a3a2231a667bd5c6f3c92">IteratorState::valid</a></div><div class="ttdoc">Iterator points to a valid object. </div><div class="ttdef"><b>Definition:</b> <a href="tria__iterator__base_8h_source.html#l00041">tria_iterator_base.h:41</a></div></div>
<div class="ttc" id="namespaceWorkStream_html_ab8ceb010811941c351803b671a19fb73"><div class="ttname"><a href="namespaceWorkStream.html#ab8ceb010811941c351803b671a19fb73">WorkStream::run</a></div><div class="ttdeci">void run(const std::vector&lt; std::vector&lt; Iterator &gt;&gt; &amp;colored_iterators, Worker worker, Copier copier, const ScratchData &amp;sample_scratch_data, const CopyData &amp;sample_copy_data, const unsigned int queue_length=2 *MultithreadInfo::n_threads(), const unsigned int chunk_size=8)</div><div class="ttdef"><b>Definition:</b> <a href="work__stream_8h_source.html#l01151">work_stream.h:1151</a></div></div>
<div class="ttc" id="namespaceOpenCASCADE_html_a9509efa83e3b2fa42616fe0623cba696"><div class="ttname"><a href="namespaceOpenCASCADE.html#a9509efa83e3b2fa42616fe0623cba696">OpenCASCADE::point</a></div><div class="ttdeci">Point&lt; spacedim &gt; point(const gp_Pnt &amp;p, const double tolerance=1e-10)</div><div class="ttdef"><b>Definition:</b> <a href="opencascade_2utilities_8cc_source.html#l00188">utilities.cc:188</a></div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_a0d8802698d585eec62a2a54e6387b05b"><div class="ttname"><a href="namespaceLAPACKSupport.html#a0d8802698d585eec62a2a54e6387b05b">LAPACKSupport::zero</a></div><div class="ttdeci">static const types::blas_int zero</div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00193">lapack_support.h:193</a></div></div>
<div class="ttc" id="namespaceEvaluationFlags_html_a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58"><div class="ttname"><a href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">EvaluationFlags::values</a></div><div class="ttdef"><b>Definition:</b> <a href="evaluation__flags_8h_source.html#l00054">evaluation_flags.h:54</a></div></div>
<div class="ttc" id="p4est__wrappers_8cc_html_ace00f2f80d9780ef9aa1007e1c22c6a4"><div class="ttname"><a href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a></div><div class="ttdeci">const ::parallel::distributed::Triangulation&lt; dim, spacedim &gt; * triangulation</div><div class="ttdef"><b>Definition:</b> <a href="p4est__wrappers_8cc_source.html#l00069">p4est_wrappers.cc:69</a></div></div>
<div class="ttc" id="classSubscriptor_html"><div class="ttname"><a href="classSubscriptor.html">Subscriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="subscriptor_8h_source.html#l00050">subscriptor.h:50</a></div></div>
<div class="ttc" id="namespaceUtilities_1_1MPI_html_a9e963546bd81b0cdd88e1840cfa8f227"><div class="ttname"><a href="namespaceUtilities_1_1MPI.html#a9e963546bd81b0cdd88e1840cfa8f227">Utilities::MPI::reduce</a></div><div class="ttdeci">T reduce(const T &amp;local_value, const MPI_Comm &amp;comm, const std::function&lt; T(const T &amp;, const T &amp;)&gt; &amp;combiner, const unsigned int root_process=0)</div></div>
<div class="ttc" id="classFiniteElement_html"><div class="ttname"><a href="classFiniteElement.html">FiniteElement&lt; dim &gt;</a></div></div>
<div class="ttc" id="namespaceGridRefinement_html"><div class="ttname"><a href="namespaceGridRefinement.html">GridRefinement</a></div><div class="ttdef"><b>Definition:</b> <a href="grid_2grid__refinement_8h_source.html#l00051">grid_refinement.h:51</a></div></div>
<div class="ttc" id="namespaceinternal_1_1VectorOperations_html_a40c8daa0881cff0123fbaeb08929f5cb"><div class="ttname"><a href="namespaceinternal_1_1VectorOperations.html#a40c8daa0881cff0123fbaeb08929f5cb">internal::VectorOperations::copy</a></div><div class="ttdeci">void copy(const T *begin, const T *end, U *dest)</div><div class="ttdef"><b>Definition:</b> <a href="vector__operations__internal_8h_source.html#l00069">vector_operations_internal.h:69</a></div></div>
<div class="ttc" id="vectorization_8h_html_ad9b7aa5c50bf9ce988a0f756a3f2baa5"><div class="ttname"><a href="vectorization_8h.html#ad9b7aa5c50bf9ce988a0f756a3f2baa5">std::sin</a></div><div class="ttdeci">inline ::VectorizedArray&lt; Number, width &gt; sin(const ::VectorizedArray&lt; Number, width &gt; &amp;x)</div><div class="ttdef"><b>Definition:</b> <a href="vectorization_8h_source.html#l05334">vectorization.h:5334</a></div></div>
<div class="ttc" id="namespaceGridRefinement_html_a48e5395381ed87155942a61a1edd134d"><div class="ttname"><a href="namespaceGridRefinement.html#a48e5395381ed87155942a61a1edd134d">GridRefinement::refine_and_coarsen_fixed_number</a></div><div class="ttdeci">void refine_and_coarsen_fixed_number(Triangulation&lt; dim, spacedim &gt; &amp;triangulation, const Vector&lt; Number &gt; &amp;criteria, const double top_fraction_of_cells, const double bottom_fraction_of_cells, const unsigned int max_n_cells=std::numeric_limits&lt; unsigned int &gt;::max())</div><div class="ttdef"><b>Definition:</b> <a href="grid_2grid__refinement_8cc_source.html#l00322">grid_refinement.cc:322</a></div></div>
<div class="ttc" id="namespaceGridRefinement_html_a1cf30058b31ce7f9b389e8310bb9fc54"><div class="ttname"><a href="namespaceGridRefinement.html#a1cf30058b31ce7f9b389e8310bb9fc54">GridRefinement::refine</a></div><div class="ttdeci">void refine(Triangulation&lt; dim, spacedim &gt; &amp;tria, const Vector&lt; Number &gt; &amp;criteria, const double threshold, const unsigned int max_to_mark=numbers::invalid_unsigned_int)</div><div class="ttdef"><b>Definition:</b> <a href="grid_2grid__refinement_8cc_source.html#l00168">grid_refinement.cc:168</a></div></div>
<div class="ttc" id="namespaceinternal_1_1p4est_html_a4b980c7b4b4d9984e93d73c7d30173ea"><div class="ttname"><a href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">internal::p4est::functions</a></div><div class="ttdeci">int(&amp;) functions(const void *v1, const void *v2)</div><div class="ttdef"><b>Definition:</b> <a href="p4est__wrappers_8cc_source.html#l00339">p4est_wrappers.cc:339</a></div></div>
<div class="ttc" id="namespaceWorkStream_1_1internal_1_1tbb__no__coloring_html_a8673698a405bf47aa24002aeb6d76d70"><div class="ttname"><a href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">WorkStream::internal::tbb_no_coloring::run</a></div><div class="ttdeci">void run(const Iterator &amp;begin, const typename identity&lt; Iterator &gt;::type &amp;end, Worker worker, Copier copier, const ScratchData &amp;sample_scratch_data, const CopyData &amp;sample_copy_data, const unsigned int queue_length, const unsigned int chunk_size)</div><div class="ttdef"><b>Definition:</b> <a href="work__stream_8h_source.html#l00562">work_stream.h:562</a></div></div>
<div class="ttc" id="group__constraints_html_ga3b4ea7dfd313e388d868c4e4aa685799"><div class="ttname"><a href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a></div><div class="ttdeci">void make_hanging_node_constraints(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, AffineConstraints&lt; number &gt; &amp;constraints)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools__constraints_8cc_source.html#l01787">dof_tools_constraints.cc:1787</a></div></div>
<div class="ttc" id="classFEFaceValues_html"><div class="ttname"><a href="classFEFaceValues.html">FEFaceValues</a></div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2fe_2fe_8h_source.html#l00041">fe.h:41</a></div></div>
<div class="ttc" id="group__Exceptions_html_ga31978c026b8b6b5116df30b8e748f6b7"><div class="ttname"><a href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">StandardExceptions::ExcInternalError</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcInternalError()</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
