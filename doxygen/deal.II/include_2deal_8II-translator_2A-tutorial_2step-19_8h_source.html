<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="canonical" href="https://www.dealii.org/current/doxygen/deal.II/include_2deal_8II-translator_2A-tutorial_2step-19_8h_source.html" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The deal.II Library: include/deal.II-translator/A-tutorial/step-19.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link rel="SHORTCUT ICON" href="deal.ico"></link>
<script type="text/javascript" src="custom.js"></script>
<meta name="author" content="The deal.II Authors <authors@dealii.org>"></meta>
<meta name="copyright" content="Copyright (C) 1998 - 2021 by the deal.II authors"></meta>
<meta name="deal.II-version" content="10.0.0-pre"></meta>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo200.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Reference documentation for deal.II version 10.0.0-pre</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!--Extra macros for MathJax:-->
<div style="display:none">
\(\newcommand{\dealvcentcolon}{\mathrel{\mathop{:}}}\)
\(\newcommand{\dealcoloneq}{\dealvcentcolon\mathrel{\mkern-1.2mu}=}\)
\(\newcommand{\jump}[1]{\left[\!\left[ #1 \right]\!\right]}\)
\(\newcommand{\average}[1]{\left\{\!\left\{ #1 \right\}\!\right\}}\)
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="dir_386d89ad50a3909c2af5a93b48d2c3ff.html">deal.II-translator</a></li><li class="navelem"><a class="el" href="dir_7812fe2bbb6fb6db2d3962cae8700ca0.html">A-tutorial</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">step-19.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="include_2deal_8II-translator_2A-tutorial_2step-19_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160; dim)</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;     , next_unused_particle_id(0)</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;     , n_recently_lost_particles(0)</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;     , n_total_lost_particles(0)</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;     , n_particles_lost_through_anode(0)</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;     , time(0, 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-4)</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;   {</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;     particle_handler.signals.particle_lost.connect(</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;       [<span class="keyword">this</span>](<span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="classParticles_1_1ParticleIterator.html">Particles::ParticleIterator&lt;dim&gt;</a> &amp;        particle,</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;              <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;::active_cell_iterator</a> &amp;cell) {</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;         this-&gt;track_lost_particle(particle, cell);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;       });</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;   }</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;* </div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160; </div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;* </div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;* </div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;ThecodeCathodeRaySimulatormake_gridcodefunction&quot;</span>&gt;&lt;/a&gt;  &lt;h4&gt;The &lt;code&gt;CathodeRaySimulator::make_grid&lt;/code&gt; <span class="keyword">function</span>&lt;/h4&gt;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;* </div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;* </div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;*  The next <span class="keyword">function</span> is then responsible <span class="keywordflow">for</span> generating the mesh on which we want to solve. Recall how the domain looks like:   &lt;p align=<span class="stringliteral">&quot;center&quot;</span>&gt;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160; &lt;img</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160; src=<span class="stringliteral">&quot;https://www.dealii.org/images/steps/developer/step-19.geometry.png&quot;</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; alt=<span class="stringliteral">&quot;The geometry used in this program&quot;</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160; width=<span class="stringliteral">&quot;600&quot;</span>&gt;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160; &lt;/p&gt;   We subdivide <span class="keyword">this</span> geometry into a mesh of   @f$4\times 2@f$   cells that looks like <span class="keyword">this</span>:   &lt;div <span class="keyword">class</span>=CodeFragmentInTutorialComment&gt;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;* </div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;* </div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;@code</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;* </div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;* </div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;* </div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;* </div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;* </div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;---*---*---*---*</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;   \   |   |   |   |</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;* </div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;* </div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;* </div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;* </div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;* </div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;* </div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;* </div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;--*---*---*---*</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;   /   |   |   |   |</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;* </div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;* </div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;* </div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;* </div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;* </div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;---*---*---*---*</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;* </div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160; &lt;/div&gt;   The way <span class="keyword">this</span> is done is by <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> defining where the   @f$15=5\times 3@f$   <a class="code" href="data__out__base_8cc.html#accc45da40beb7ae1b485306984e904a2">vertices</a> are located</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;* </div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;*  -  here, we say that they are on integer points with the middle <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> on the left side moved to the right by a <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a> of `delta=0.5`.   </div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;*   In the following, we then have to say which <a class="code" href="data__out__base_8cc.html#accc45da40beb7ae1b485306984e904a2">vertices</a> together form the 8 cells. The following code is then entirely equivalent to what we also <span class="keywordflow">do</span> in   @ref step_14 <span class="stringliteral">&quot;step-14&quot;</span>  :</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;* </div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;* </div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;* @code</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;   <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;   <span class="keywordtype">void</span> CathodeRaySimulator&lt;dim&gt;::make_grid()</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;   {</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;     static_assert(dim == 2,</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                   <span class="stringliteral">&quot;This function is currently only implemented for 2d.&quot;</span>);</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;* </div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;     <span class="keyword">const</span> <span class="keywordtype">double</span>       delta = 0.5;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nx    = 5;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ny    = 3;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;* </div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;     <span class="keyword">const</span> std::vector&lt;Point&lt;dim&gt;&gt; <a class="code" href="data__out__base_8cc.html#accc45da40beb7ae1b485306984e904a2">vertices</a> </div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;       = {{0, 0},</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;          {1, 0},</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;          {2, 0},</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;          {3, 0},</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;          {4, 0},</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;          {delta, 1},</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;          {1, 1},</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;          {2, 1},</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;          {3, 1},</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;          {4, 1},</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;          {0, 2},</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;          {1, 2},</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;          {2, 2},</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;          {3, 2},</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;          {4, 2}};</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;     <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(vertices.size(), nx ny);</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;* </div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;     <span class="keyword">const</span> std::vector&lt;unsigned int&gt; cell_vertices[(nx</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;* </div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;- 1) (ny</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;* </div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;- 1)] = {</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;       {0, 1, nx + 0, nx + 1},</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;       {1, 2, nx + 1, nx + 2},</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;       {2, 3, nx + 2, nx + 3},</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;       {3, 4, nx + 3, nx + 4},</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;* </div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;       {5, nx + 1, 2 nx + 0, 2 nx + 1},</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;       {nx + 1, nx + 2, 2 nx + 1, 2 nx + 2},</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;       {nx + 2, nx + 3, 2 nx + 2, 2 nx + 3},</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;       {nx + 3, nx + 4, 2 nx + 3, 2 nx + 4}};</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;* </div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;* </div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;*  With these arrays out of the way, we can move to slightly higher higher-<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> data structures. We create a vector of <a class="code" href="structCellData.html">CellData</a> objects that store <span class="keywordflow">for each</span> cell to be created the vertices in question as well as the   @ref GlossMaterialId   <span class="stringliteral">&quot;material id&quot;</span> (which we will here simply <span class="keyword">set</span> to <a class="code" href="namespaceLAPACKSupport.html#a0d8802698d585eec62a2a54e6387b05b">zero</a> since we don<span class="stringliteral">&#39;t use it in the program).     </span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="stringliteral">*   This information is then handed to the   Triangulation::create_triangulation()   function, and the mesh is twice globally refined.</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="stringliteral">     std::vector&lt;CellData&lt;dim&gt;&gt; cells((nx</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="stringliteral">- 1) (ny</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="stringliteral">- 1), CellData&lt;dim&gt;());</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="stringliteral">     for (unsigned int i = 0; i &lt; cells.size(); ++i)</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="stringliteral">       {</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="stringliteral">         cells[i].vertices    = cell_vertices[i];</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="stringliteral">         cells[i].material_id = 0;</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="stringliteral">       }</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="stringliteral">     triangulation.create_triangulation(</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="stringliteral">       vertices,</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="stringliteral">       cells,</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="stringliteral">       SubCellData()); // No boundary information</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="stringliteral">     triangulation.refine_global(2);</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="stringliteral">*  The remaining part of the function loops over all cells and their faces, and if a face is at the boundary determines which boundary indicator should be applied to it. The various conditions should make sense if you compare the code with the picture of the geometry above.     </span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="stringliteral">*   Once done with this step, we refine the mesh once more globally.</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="stringliteral">     for (auto &amp;cell : triangulation.active_cell_iterators())</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="stringliteral">       for (auto &amp;face : cell-&gt;face_iterators())</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="stringliteral">         if (face-&gt;at_boundary())</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="stringliteral">           {</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="stringliteral">             if ((face-&gt;center()[0] &gt; 0) &amp;&amp; (face-&gt;center()[0] &lt; 0.5) &amp;&amp;</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="stringliteral">                 (face-&gt;center()[1] &gt; 0) &amp;&amp; (face-&gt;center()[1] &lt; 2))</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="stringliteral">               face-&gt;set_boundary_id(BoundaryIds::cathode);</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="stringliteral">             else if ((face-&gt;center()[0] &gt; 0) &amp;&amp; (face-&gt;center()[0] &lt; 2))</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="stringliteral">               face-&gt;set_boundary_id(BoundaryIds::focus_element);</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="stringliteral">             else if ((face-&gt;center()[0] &gt; 4</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="stringliteral">- 1e-12) &amp;&amp;</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="stringliteral">                      ((face-&gt;center()[1] &gt; 1.5) || (face-&gt;center()[1] &lt; 0.5)))</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="stringliteral">               face-&gt;set_boundary_id(BoundaryIds::anode);</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="stringliteral">             else</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="stringliteral">               face-&gt;set_boundary_id(BoundaryIds::open);</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="stringliteral">           }</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="stringliteral">     triangulation.refine_global(1);</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="stringliteral">   }</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="stringliteral">*   &lt;a name=&quot;ThecodeCathodeRaySimulatorsetup_systemcodefunction&quot;&gt;&lt;/a&gt;  &lt;h4&gt;The &lt;code&gt;CathodeRaySimulator::setup_system&lt;/code&gt; function&lt;/h4&gt;</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="stringliteral">*  The next function in this program deals with setting up the various objects related to solving the partial differential equations. It is in essence a copy of the corresponding function in   @ref step_6 &quot;step-6&quot;   and requires no further discussion.</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="stringliteral">   template &lt;int dim&gt;</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="stringliteral">   void CathodeRaySimulator&lt;dim&gt;::setup_system()</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="stringliteral">   {</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="stringliteral">     dof_handler.distribute_dofs(fe);</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="stringliteral">     solution.reinit(dof_handler.n_dofs());</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="stringliteral">     system_rhs.reinit(dof_handler.n_dofs());</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="stringliteral">     constraints.clear();</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="stringliteral">     DoFTools::make_hanging_node_constraints(dof_handler, constraints);</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="stringliteral">     VectorTools::interpolate_boundary_values(dof_handler,</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="stringliteral">                                              BoundaryIds::cathode,</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="stringliteral">                                              Functions::ConstantFunction&lt;dim&gt;(</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="stringliteral">-Constants::V0),</span></div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="stringliteral">                                              constraints);</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="stringliteral">     VectorTools::interpolate_boundary_values(dof_handler,</span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="stringliteral">                                              BoundaryIds::focus_element,</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="stringliteral">                                              Functions::ConstantFunction&lt;dim&gt;(</span></div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="stringliteral">-Constants::V0),</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="stringliteral">                                              constraints);</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="stringliteral">     VectorTools::interpolate_boundary_values(dof_handler,</span></div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="stringliteral">                                              BoundaryIds::anode,</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="stringliteral">                                              Functions::ConstantFunction&lt;dim&gt;(</span></div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="stringliteral">                                                +Constants::V0),</span></div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="stringliteral">                                              constraints);</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="stringliteral">     constraints.close();</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="stringliteral">     DynamicSparsityPattern dsp(dof_handler.n_dofs());</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="stringliteral">     DoFTools::make_sparsity_pattern(dof_handler,</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="stringliteral">                                     dsp,</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="stringliteral">                                     constraints,</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="stringliteral">                                      /*keep_constrained_dofs = */  false);</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="stringliteral">     sparsity_pattern.copy_from(dsp);</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="stringliteral">     system_matrix.reinit(sparsity_pattern);</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="stringliteral">   }</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="stringliteral">*   &lt;a name=&quot;ThecodeCathodeRaySimulatorassemble_systemcodefunction&quot;&gt;&lt;/a&gt;  &lt;h4&gt;The &lt;code&gt;CathodeRaySimulator::assemble_system&lt;/code&gt; function&lt;/h4&gt;</span></div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="stringliteral">*  The function that computes the matrix entries is again in essence a copy of the corresponding function in   @ref step_6 &quot;step-6&quot;  :</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="stringliteral">   template &lt;int dim&gt;</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="stringliteral">   void CathodeRaySimulator&lt;dim&gt;::assemble_system()</span></div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="stringliteral">   {</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="stringliteral">     system_matrix = 0;</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="stringliteral">     system_rhs    = 0;</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="stringliteral">     const QGauss&lt;dim&gt; quadrature_formula(fe.degree + 1);</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="stringliteral">     FEValues&lt;dim&gt; fe_values(fe,</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="stringliteral">                             quadrature_formula,</span></div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="stringliteral">                             update_values | update_gradients |</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="stringliteral">                               update_quadrature_points | update_JxW_values);</span></div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;<span class="stringliteral">     const unsigned int dofs_per_cell = fe.dofs_per_cell;</span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="stringliteral">     FullMatrix&lt;double&gt; cell_matrix(dofs_per_cell, dofs_per_cell);</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="stringliteral">     Vector&lt;double&gt;     cell_rhs(dofs_per_cell);</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="stringliteral">     std::vector&lt;types::global_dof_index&gt; local_dof_indices(dofs_per_cell);</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;<span class="stringliteral">     for (const auto &amp;cell : dof_handler.active_cell_iterators())</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;<span class="stringliteral">       {</span></div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;<span class="stringliteral">         cell_matrix = 0;</span></div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;<span class="stringliteral">         cell_rhs    = 0;</span></div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;<span class="stringliteral">         fe_values.reinit(cell);</span></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;<span class="stringliteral">         for (const unsigned int q_index : fe_values.quadrature_point_indices())</span></div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="stringliteral">           for (const unsigned int i : fe_values.dof_indices())</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;<span class="stringliteral">             {</span></div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;<span class="stringliteral">               for (const unsigned int j : fe_values.dof_indices())</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<span class="stringliteral">                 cell_matrix(i, j) +=</span></div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="stringliteral">                   (fe_values.shape_grad(i, q_index) // grad phi_i(x_q)</span></div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="stringliteral">                    fe_values.shape_grad(j, q_index) // grad phi_j(x_q)</span></div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="stringliteral">                    fe_values.JxW(q_index));           // dx</span></div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="stringliteral">             }</span></div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="stringliteral">*  The only interesting part of this function is how it forms the right hand side of the linear system. Recall that the right hand side of the PDE is @f[</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<span class="stringliteral"> \sum_p (N e)\delta(\mathbf x-\mathbf x_p),</span></div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;<span class="stringliteral"> @f] where we have used   @f$p@f$   to index the particles here to avoid confusion with the shape function   @f$\varphi_i@f$  ;   @f$\mathbf x_p@f$   is the position of the   @f$p@f$  th particle.         </span></div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="stringliteral">*   When multiplied by a test function   @f$\varphi_i@f$   and integrated over the domain results in a right hand side vector</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="stringliteral">* @f{align*}{</span></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="stringliteral"> F_i &amp;= \int_\Omega \varphi_i (\mathbf x)\left[</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="stringliteral"> \sum_p (N e)\delta(\mathbf x-\mathbf x_p) \right] dx</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="stringliteral"> \\  &amp;=  \sum_p (N e) \varphi_i(\mathbf x_p).</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="stringliteral"> @f}</span></div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="stringliteral">*  Note that the final line no longer contains an integral, and consequently also no occurrence of   @f$dx@f$   which would require the appearance of the `JxW` symbol in our code.         </span></div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="stringliteral">*   For a given cell   @f$K@f$  , this cell&#39;</span>s contribution to the right hand side is then</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;* </div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;* @f{align*}{</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160; F_i^K &amp;= \sum_{p, \mathbf x_p\in K} (<a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>) \varphi_i(\mathbf x_p),</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160; @f}</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;*  i.e., we only have to worry about those particles that are actually located on the current cell   @f$K@f$  .         </div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;*   In practice, what we <span class="keywordflow">do</span> here is the following: If there are any particles on the current cell, then we <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> obtain an iterator range pointing to the <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> particle of that cell as well as the particle past the last <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> on <span class="keyword">this</span> cell (or the <a class="code" href="namespaceTrilinosWrappers_1_1internal.html#aee42c8e3004e2e81eac3c3356d3ec46b">end</a> iterator)</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;* </div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;*  -  i.e., a half-open range as is common <span class="keywordflow">for</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a09916360abaee5f1fb31994dbc96787b">C</a>++ <a class="code" href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">functions</a>. Knowing now the list of particles, we query their reference locations (with respect to the reference cell), evaluate the shape <a class="code" href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">functions</a> in these reference locations, and compute the force according to the formula above (without any   <a class="code" href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">FEValues::JxW</a>).           </div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;*  </div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;* </div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;*   @note   It is worth pointing out that calling the   <a class="code" href="classParticles_1_1ParticleHandler.html#acaf1232ffce0746baa64122a5c65822e">Particles::ParticleHandler::particles_in_cell</a>()   and   <a class="code" href="namespaceParticles.html">Particles</a>::ParticleHandler::n_particles_in_cell()   <a class="code" href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">functions</a> is not very efficient on problems with a large number of particles. But it illustrates the easiest way to write this algorithm, and so we are willing to incur this cost for the moment for expository purposes. We discuss the issue in more detail in the &lt;a href=&quot;<span class="preprocessor">#extensions&quot;&gt;&quot;possibilities for extensions&quot; section&lt;/a&gt; below, and use a better approach in   @ref step_70 &quot;step-70&quot;  , for example.</span></div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;* </div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;* </div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;* @code</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;         <span class="keywordflow">if</span> (particle_handler.n_particles_in_cell(cell) &gt; 0)</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;           <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;particle : particle_handler.particles_in_cell(cell))</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;             {</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;               <span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp;reference_location =</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;                 particle.get_reference_location();</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;               <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i : fe_values.dof_indices())</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;                 cell_rhs(i) +=</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;                   (fe.shape_value(i, reference_location) <span class="comment">// phi_i(x_p)</span></div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;                    (-Constants::electrons_per_particle   <span class="comment">// N</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;                     Constants::electron_charge));          <span class="comment">// e</span></div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;             }</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;* </div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;* </div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;*  Finally, we can <a class="code" href="namespaceinternal_1_1VectorOperations.html#a40c8daa0881cff0123fbaeb08929f5cb">copy</a> the contributions of <span class="keyword">this</span> cell into the global <a class="code" href="namespaceLAPACKSupport.html#a1a9009db0d9a77923a7031b549b9b638a5bc7c54a9c20485772672825c6a73003">matrix</a> and right hand side vector:</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;* </div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;* </div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;* @code</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;         cell-&gt;get_dof_indices(local_dof_indices);</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;         constraints.distribute_local_to_global(</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;           <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>, cell_rhs, local_dof_indices, system_matrix, system_rhs);</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;       }</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;   }</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;* </div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160; </div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;* </div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;CathodeRaySimulatorsolve&quot;</span>&gt;&lt;/a&gt;  &lt;h4&gt;CathodeRaySimulator::solve&lt;/h4&gt;</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;* </div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;* </div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;*  The <span class="keyword">function</span> that solves the linear system is then again exactly as in   @ref step_6 <span class="stringliteral">&quot;step-6&quot;</span>  :</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;* </div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;* </div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;* @code</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;   <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;   <span class="keywordtype">void</span> CathodeRaySimulator&lt;dim&gt;::solve_field()</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;   {</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;     <a class="code" href="classSolverControl.html">SolverControl</a>            solver_control(1000, 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-12);</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;     <a class="code" href="classSolverCG.html">SolverCG&lt;Vector&lt;double&gt;</a>&gt; solver(solver_control);</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;* </div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;     <a class="code" href="classPreconditionSSOR.html">PreconditionSSOR&lt;SparseMatrix&lt;double&gt;</a>&gt; preconditioner;</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;     preconditioner.<a class="code" href="classPreconditionSSOR.html#a7a3d66b17bb0ea1b16606e222474c2ea">initialize</a>(system_matrix, 1.2);</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;* </div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;     solver.solve(system_matrix, solution, system_rhs, preconditioner);</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;* </div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;     constraints.distribute(solution);</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;   }</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;* </div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160; </div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;* </div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;CathodeRaySimulatorrefine_grid&quot;</span>&gt;&lt;/a&gt;  &lt;h4&gt;CathodeRaySimulator::refine_grid&lt;/h4&gt;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;* </div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;* </div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;*  The <span class="keyword">final</span> field-related <span class="keyword">function</span> is the <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> that refines the grid. We will <a class="code" href="namespaceThreads_1_1internal.html#a8d237a30d09b13e0b5adbe0fd1dfb188">call</a> it a number of times in the <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> time step to obtain a mesh that is well-adapted to the structure of the solution and, in particular, resolves the various singularities in the solution that are due to re-entrant corners and places where the boundary condition type changes. You might want to refer to   @ref step_6 <span class="stringliteral">&quot;step-6&quot;</span>   again <span class="keywordflow">for</span> more details:</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;* </div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;* </div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;* @code</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;   <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;   <span class="keywordtype">void</span> CathodeRaySimulator&lt;dim&gt;::refine_grid()</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;   {</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;     <a class="code" href="classVector.html">Vector&lt;float&gt;</a> estimated_error_per_cell(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells());</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;* </div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;     <a class="code" href="classKellyErrorEstimator.html#ae2269e1c9903e9d863b7abd54948af00">KellyErrorEstimator&lt;dim&gt;::estimate</a>(dof_handler,</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;                                        <a class="code" href="classQGauss.html">QGauss</a>&lt;dim</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;* </div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;- 1&gt;(fe.degree + 1),</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;                                        {},</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;                                        solution,</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;                                        estimated_error_per_cell);</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;* </div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;     <a class="code" href="namespaceGridRefinement.html#a48e5395381ed87155942a61a1edd134d">GridRefinement::refine_and_coarsen_fixed_number</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>,</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;                                                     estimated_error_per_cell,</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;                                                     0.1,</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;                                                     0.03);</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;* </div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;     <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.execute_coarsening_and_refinement();</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;   }</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;* </div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160; </div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;* </div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;CathodeRaySimulatorcreate_particles&quot;</span>&gt;&lt;/a&gt;  &lt;h4&gt;CathodeRaySimulator::create_particles&lt;/h4&gt;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;* </div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;* </div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;*  Let us now turn to the <a class="code" href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">functions</a> that deal with particles. The <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> is about the creation of particles. As mentioned in the introduction, we want to create a particle at points of the cathode <span class="keywordflow">if</span> the the electric field   @f$\mathbf <a class="code" href="namespacenumbers.html#a3c7239f00d5e87dfcf6dd19cbc3ddc74">E</a>=\nabla <a class="code" href="namespaceLAPACKSupport.html#aee5ef58d11434eb1d6a665e64bf17292">V</a>@f$   exceeds a certain threshold, i.e., <span class="keywordflow">if</span>   @f$|\mathbf E| \ge E_\text{threshold}@f$  , and <span class="keywordflow">if</span> furthermore the electric field points into the domain (i.e., <span class="keywordflow">if</span>   @f$\mathbf E \cdot \mathbf n &lt; 0@f$  ). As is common in the finite element method, we evaluate fields (and their derivatives) at specific evaluation points; typically, these are <span class="stringliteral">&quot;quadrature points&quot;</span>, and so we create a <span class="stringliteral">&quot;quadrature formula&quot;</span> that we will use to designate the points at which we want to evaluate the solution. Here, we will simply take <a class="code" href="classQMidpoint.html">QMidpoint</a> implying that we will only check the threshold condition at the midpoints of faces. We then use <span class="keyword">this</span> to initialize an <span class="keywordtype">object</span> of type <a class="code" href="classFEFaceValues.html">FEFaceValues</a> to evaluate the solution at these points.   </div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;*   All of <span class="keyword">this</span> will then be used in a <a class="code" href="group__MeshWorker.html#gad10f528ab87f39fbb0531d24f238b2f3">loop</a> over all cells, their faces, and specifically those faces that are at the boundary and, moreover, the cathode part of the boundary.</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;* </div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;* </div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;* @code</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;   <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;   <span class="keywordtype">void</span> CathodeRaySimulator&lt;dim&gt;::create_particles()</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;   {</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;     <a class="code" href="classFEFaceValues.html">FEFaceValues&lt;dim&gt;</a> fe_face_values(fe,</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;                                      <a class="code" href="classQMidpoint.html">QMidpoint</a>&lt;dim</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;* </div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;- 1&gt;(),</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;                                      <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> |</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;                                        <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> |</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;                                        <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f">update_normal_vectors</a>);</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;* </div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;     std::vector&lt;Tensor&lt;1, dim&gt;&gt; solution_gradients(</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;       fe_face_values.n_quadrature_points);</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;* </div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;     <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : dof_handler.active_cell_iterators())</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;       <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;face : cell-&gt;face_iterators())</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;         <span class="keywordflow">if</span> (face-&gt;at_boundary() &amp;&amp;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;             (face-&gt;boundary_id() == BoundaryIds::cathode))</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;           {</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;             fe_face_values.reinit(cell, face);</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;* </div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;* </div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;*  So we have found a face on the cathode. Next, we let the <a class="code" href="classFEFaceValues.html">FEFaceValues</a> <span class="keywordtype">object</span> compute the <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaae2b6dfb8a5c48206992d8310d176c37c">gradient</a> of the solution at each <span class="stringliteral">&quot;quadrature&quot;</span> <a class="code" href="namespaceOpenCASCADE.html#a9509efa83e3b2fa42616fe0623cba696">point</a>, and <a class="code" href="namespaceTensorAccessors.html#a5798da96660fa8e6798917501d65dbd8">extract</a> the electric field vector from the <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaae2b6dfb8a5c48206992d8310d176c37c">gradient</a> in the form of a <a class="code" href="classTensor.html">Tensor</a> variable through the methods discussed in the   @ref vector_valued   <span class="stringliteral">&quot;vector-valued problems&quot;</span> documentation module.</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;* </div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;* </div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;* @code</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;             <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> electric_potential(0);</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;             fe_face_values[electric_potential].get_function_gradients(</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;               solution, solution_gradients);</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;             <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point :</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;                  fe_face_values.quadrature_point_indices())</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;               {</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;                 <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> E = solution_gradients[q_point];</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;* </div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;* </div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;*  Electrons can only <a class="code" href="namespacePatterns_1_1internal.html#a3cb7cf7c260acaeb90d4e60a288894d1">escape</a> the cathode <span class="keywordflow">if</span> the electric field strength exceeds a threshold and, crucially, <span class="keywordflow">if</span> the electric field pointsinto* the domain. Once we have that checked, we create a <span class="keyword">new</span>   <a class="code" href="classParticles_1_1Particle.html">Particles::Particle</a>   <span class="keywordtype">object</span> at <span class="keyword">this</span> location and <a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffda4ed1da4f7c4036896a6aeb19338d1a81">insert</a> it into the   <a class="code" href="classParticles_1_1ParticleHandler.html">Particles::ParticleHandler</a>   <span class="keywordtype">object</span> with a unique ID.                 </div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;*   The only thing that may be not obvious here is that we also associate with <span class="keyword">this</span> particle the location in the reference coordinates of the cell we are currently on. This is done because we will in <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">downstream</a> <a class="code" href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">functions</a> compute quantities such as the electric field at the location of the particle (<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>.g., to compute the forces that act on it when updating its position in each time step). Evaluating a finite element field at arbitrary coordinates is quite an expensive operation because shape <a class="code" href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">functions</a> are really only defined on the reference cell, and so when asking <span class="keywordflow">for</span> the electric field at an arbitrary point requires us <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> to determine what the reference coordinates of that point are. To avoid having to <span class="keywordflow">do</span> <span class="keyword">this</span> over and over, we determine these coordinates once and <span class="keywordflow">for</span> all and then store these reference coordinates directly with the particle.</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;* </div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;* </div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;* @code</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;                 <span class="keywordflow">if</span> ((E fe_face_values.normal_vector(q_point) &lt; 0) &amp;&amp;</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;                     (E.<a class="code" href="classTensor.html#afd0934b4edd71063f66a9c67540e79fc">norm</a>() &gt; Constants::E_threshold))</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;                   {</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;                     <span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp;location =</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;                       fe_face_values.quadrature_point(q_point);</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;* </div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;                     <a class="code" href="classParticles_1_1Particle.html">Particles::Particle&lt;dim&gt;</a> new_particle;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;                     new_particle.<a class="code" href="classParticles_1_1Particle.html#afbe52b594cf4a8dd11431679c4ef2b52">set_location</a>(location);</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;                     new_particle.<a class="code" href="classParticles_1_1Particle.html#a57efa2034baca617ba3160ccfbbc7cd7">set_reference_location</a>(</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;                       mapping.transform_real_to_unit_cell(cell, location));</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;                     new_particle.<a class="code" href="classParticles_1_1Particle.html#af792bce47ec4746ad2c78e7e800299a8">set_id</a>(next_unused_particle_id);</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;                     particle_handler.insert_particle(new_particle, cell);</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;* </div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;                     ++next_unused_particle_id;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;                   }</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;               }</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;           }</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;* </div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;* </div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;*  At the <a class="code" href="namespaceTrilinosWrappers_1_1internal.html#aee42c8e3004e2e81eac3c3356d3ec46b">end</a> of all of these insertions, we let the `particle_handler` update some <span class="keyword">internal</span> statistics about the particles it stores.</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;* </div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;* </div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;* @code</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;     particle_handler.update_cached_numbers();</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;   }</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;* </div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160; </div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;* </div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;CathodeRaySimulatormove_particles&quot;</span>&gt;&lt;/a&gt;  &lt;h4&gt;CathodeRaySimulator::move_particles&lt;/h4&gt;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;* </div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;* </div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;*  The <a class="code" href="grid__out_8cc.html#a2cc229a4f1ffc75e83ed269d5f725729">second</a> particle-related <span class="keyword">function</span> is the <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> that moves the particles in each time step. To <span class="keywordflow">do</span> <span class="keyword">this</span>, we have to <a class="code" href="group__MeshWorker.html#gad10f528ab87f39fbb0531d24f238b2f3">loop</a> over all cells, the particles in each cell, and evaluate the electric field at each of the particles<span class="stringliteral">&#39; positions.   </span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;<span class="stringliteral">*   The approach used here is conceptually the same used in the `assemble_system()` function: We loop over all cells, find the particles located there (with the same caveat about the inefficiency of the algorithm used here to find these particles), and use FEPointEvaluation object to evaluate the gradient at these positions:</span></div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;<span class="stringliteral">   template &lt;int dim&gt;</span></div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;<span class="stringliteral">   void CathodeRaySimulator&lt;dim&gt;::move_particles()</span></div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;<span class="stringliteral">   {</span></div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;<span class="stringliteral">     const double dt = time.get_next_step_size();</span></div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;<span class="stringliteral">     Vector&lt;double&gt;            solution_values(fe.n_dofs_per_cell());</span></div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;<span class="stringliteral">     FEPointEvaluation&lt;1, dim&gt; evaluator(mapping, fe, update_gradients);</span></div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;<span class="stringliteral">     for (const auto &amp;cell : dof_handler.active_cell_iterators())</span></div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;<span class="stringliteral">       if (particle_handler.n_particles_in_cell(cell) &gt; 0)</span></div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;<span class="stringliteral">         {</span></div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;<span class="stringliteral">           const typename Particles::ParticleHandler&lt;</span></div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="stringliteral">             dim&gt;::particle_iterator_range particles_in_cell =</span></div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="stringliteral">             particle_handler.particles_in_cell(cell);</span></div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="stringliteral">           std::vector&lt;Point&lt;dim&gt;&gt; particle_positions;</span></div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;<span class="stringliteral">           for (const auto &amp;particle : particles_in_cell)</span></div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;<span class="stringliteral">             particle_positions.push_back(particle.get_reference_location());</span></div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;<span class="stringliteral">           cell-&gt;get_dof_values(solution, solution_values);</span></div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;<span class="stringliteral">*  Then we can ask the FEPointEvaluation object for the gradients of the solution (i.e., the electric field   @f$\mathbf E@f$  ) at these locations and loop over the individual particles:</span></div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;<span class="stringliteral">           evaluator.reinit(cell, particle_positions);</span></div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;<span class="stringliteral">           evaluator.evaluate(make_array_view(solution_values),</span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="stringliteral">                              EvaluationFlags::gradients);</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="stringliteral">           {</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;<span class="stringliteral">             typename Particles::ParticleHandler&lt;dim&gt;::particle_iterator</span></div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;<span class="stringliteral">               particle = particles_in_cell.begin();</span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="stringliteral">             for (unsigned int particle_index = 0;</span></div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;<span class="stringliteral">                  particle != particles_in_cell.end();</span></div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;<span class="stringliteral">                  ++particle, ++particle_index)</span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="stringliteral">               {</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="stringliteral">                 const Tensor&lt;1, dim&gt; &amp;E =</span></div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="stringliteral">                   evaluator.get_gradient(particle_index);</span></div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;<span class="stringliteral">*  Having now obtained the electric field at the location of one of the particles, we use this to update first the velocity and then the position. To do so, let us first get the old velocity out of the properties stored with the particle, compute the acceleration, update the velocity, and store this new velocity again in the properties of the particle. Recall that this corresponds to the first of the following set of update equations discussed in the introduction:</span></div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;<span class="stringliteral">* @f{align*}{</span></div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;<span class="stringliteral"> \frac{{\mathbf v}_i^{(n)}</span></div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="stringliteral">-{\mathbf v}_i^{(n-1)}}{\Delta t}</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;<span class="stringliteral"> &amp;= \frac{e\nabla V^{(n)}}{m}</span></div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<span class="stringliteral"> \\ \frac{{\mathbf x}_i^{(n)}-{\mathbf x}_i^{(n-1)}}</span></div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="stringliteral"> {\Delta t} &amp;= {\mathbf v}_i^{(n)}.</span></div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="stringliteral"> @f}</span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="stringliteral">                 const Tensor&lt;1, dim&gt; old_velocity(particle-&gt;get_properties());</span></div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;<span class="stringliteral">                 const Tensor&lt;1, dim&gt; acceleration =</span></div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="stringliteral">                   Constants::electron_charge / Constants::electron_mass E;</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;<span class="stringliteral">                 const Tensor&lt;1, dim&gt; new_velocity =</span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;<span class="stringliteral">                   old_velocity + acceleration dt;</span></div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="stringliteral">                 particle-&gt;set_properties(make_array_view(new_velocity));</span></div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;<span class="stringliteral">*  With the new velocity, we can then also update the location of the particle and tell the particle about it.</span></div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;<span class="stringliteral">                 const Point&lt;dim&gt; new_location =</span></div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;<span class="stringliteral">                   particle-&gt;get_location() + dt new_velocity;</span></div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="stringliteral">                 particle-&gt;set_location(new_location);</span></div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="stringliteral">               }</span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;<span class="stringliteral">           }</span></div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;<span class="stringliteral">         }</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;<span class="stringliteral">*  Having updated the locations and properties (i.e., velocities) of all particles, we need to make sure that the `particle_handler` again knows which cells they are in, and what their locations in the coordinate system of the reference cell are. The following function does that. (It also makes sure that, in parallel computations, particles are moved from one processor to another processor if a particle moves from the subdomain owned by the former to the subdomain owned by the latter.)</span></div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;<span class="stringliteral">     particle_handler.sort_particles_into_subdomains_and_cells();</span></div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;<span class="stringliteral">   }</span></div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;<span class="stringliteral">*   &lt;a name=&quot;CathodeRaySimulatortrack_lost_particle&quot;&gt;&lt;/a&gt;  &lt;h4&gt;CathodeRaySimulator::track_lost_particle&lt;/h4&gt;</span></div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;<span class="stringliteral">*  The final particle-related function is the one that is called whenever a particle is lost from the simulation. This typically happens if it leaves the domain. If that happens, this function is called both the cell (which we can ask for its new location) and the cell it was previously on. The function then keeps track of updating the number of particles lost in this time step, the total number of lost particles, and then estimates whether the particle left through the hole in the middle of the anode. We do so by first checking whether the cell it was in last had an   @f$x@f$   coordinate to the left of the right boundary (located at   @f$x=4@f$  ) and the particle now has a position to the right of the right boundary. If that is so, we compute a direction vector of its motion that is normalized so that the   @f$x@f$   component of the direction vector is equal to   @f$1@f$  . With this direction vector, we can compute where it would have intersected the line   @f$x=4@f$  . If this intersect is between   @f$0.5@f$   and   @f$1.5@f$  , then we claim that the particle left through the hole and increment a counter.</span></div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;<span class="stringliteral">   template &lt;int dim&gt;</span></div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;<span class="stringliteral">   void CathodeRaySimulator&lt;dim&gt;::track_lost_particle(</span></div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;<span class="stringliteral">     const typename Particles::ParticleIterator&lt;dim&gt; &amp;        particle,</span></div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;<span class="stringliteral">     const typename Triangulation&lt;dim&gt;::active_cell_iterator &amp;cell)</span></div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;<span class="stringliteral">   {</span></div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;<span class="stringliteral">     ++n_recently_lost_particles;</span></div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;<span class="stringliteral">     ++n_total_lost_particles;</span></div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;<span class="stringliteral">     const Point&lt;dim&gt; current_location              = particle-&gt;get_location();</span></div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;<span class="stringliteral">     const Point&lt;dim&gt; approximate_previous_location = cell-&gt;center();</span></div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;<span class="stringliteral">     if ((approximate_previous_location[0] &lt; 4) &amp;&amp; (current_location[0] &gt; 4))</span></div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;<span class="stringliteral">       {</span></div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;<span class="stringliteral">         const Tensor&lt;1, dim&gt; direction =</span></div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;<span class="stringliteral">           (current_location</span></div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;<span class="stringliteral">- approximate_previous_location) /</span></div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;<span class="stringliteral">           (current_location[0]</span></div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;<span class="stringliteral">- approximate_previous_location[0]);</span></div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;<span class="stringliteral">         const double right_boundary_intercept =</span></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;<span class="stringliteral">           approximate_previous_location[1] +</span></div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;<span class="stringliteral">           (4</span></div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;<span class="stringliteral">- approximate_previous_location[0]) direction[1];</span></div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;<span class="stringliteral">         if ((right_boundary_intercept &gt; 0.5) &amp;&amp;</span></div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;<span class="stringliteral">             (right_boundary_intercept &lt; 1.5))</span></div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;<span class="stringliteral">           ++n_particles_lost_through_anode;</span></div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;<span class="stringliteral">       }</span></div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;<span class="stringliteral">   }</span></div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;<span class="stringliteral">*   &lt;a name=&quot;CathodeRaySimulatorupdate_timestep_size&quot;&gt;&lt;/a&gt;  &lt;h4&gt;CathodeRaySimulator::update_timestep_size&lt;/h4&gt;</span></div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;<span class="stringliteral">*  As discussed at length in the introduction, we need to respect a time step condition whereby particles can not move further than one cell in one time step. To ensure that this is the case, we again first compute the maximal speed of all particles on each cell, and divide the cell size by that speed. We then compute the next time step size as the minimum of this quantity over all cells, using the safety factor discussed in the introduction, and set this as the desired time step size using the   DiscreteTime::set_desired_time_step_size()   function.</span></div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;<span class="stringliteral">   template &lt;int dim&gt;</span></div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;<span class="stringliteral">   void CathodeRaySimulator&lt;dim&gt;::update_timestep_size()</span></div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;<span class="stringliteral">   {</span></div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;<span class="stringliteral">     if (time.get_step_number() &gt; 0)</span></div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;<span class="stringliteral">       {</span></div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;<span class="stringliteral">         double min_cell_size_over_velocity = std::numeric_limits&lt;double&gt;::max();</span></div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;<span class="stringliteral">         for (const auto &amp;cell : dof_handler.active_cell_iterators())</span></div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;<span class="stringliteral">           if (particle_handler.n_particles_in_cell(cell) &gt; 0)</span></div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;<span class="stringliteral">             {</span></div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;<span class="stringliteral">               const double cell_size = cell-&gt;minimum_vertex_distance();</span></div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;<span class="stringliteral">               double max_particle_velocity(0.0);</span></div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;<span class="stringliteral">               for (const auto &amp;particle :</span></div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;<span class="stringliteral">                    particle_handler.particles_in_cell(cell))</span></div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;<span class="stringliteral">                 {</span></div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;<span class="stringliteral">                   const Tensor&lt;1, dim&gt; velocity(particle.get_properties());</span></div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;<span class="stringliteral">                   max_particle_velocity =</span></div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;<span class="stringliteral">                     std::max(max_particle_velocity, velocity.norm());</span></div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;<span class="stringliteral">                 }</span></div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;<span class="stringliteral">               if (max_particle_velocity &gt; 0)</span></div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;<span class="stringliteral">                 min_cell_size_over_velocity =</span></div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="stringliteral">                   std::min(min_cell_size_over_velocity,</span></div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="stringliteral">                            cell_size / max_particle_velocity);</span></div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="stringliteral">             }</span></div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;<span class="stringliteral">         constexpr double c_safety = 0.5;</span></div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;<span class="stringliteral">         time.set_desired_next_step_size(c_safety 0.5</span></div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;<span class="stringliteral">                                         min_cell_size_over_velocity);</span></div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;<span class="stringliteral">       }</span></div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;<span class="stringliteral">*  As mentioned in the introduction, we have to treat the very first time step differently since there, particles are not available yet or do not yet have the information associated that we need for the computation of a reasonable step length. The formulas below follow the discussion in the introduction.</span></div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;<span class="stringliteral">     else</span></div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;<span class="stringliteral">       {</span></div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;<span class="stringliteral">         const QTrapezoid&lt;dim&gt; vertex_quadrature;</span></div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;<span class="stringliteral">         FEValues&lt;dim&gt; fe_values(fe, vertex_quadrature, update_gradients);</span></div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;<span class="stringliteral">         std::vector&lt;Tensor&lt;1, dim&gt;&gt; field_gradients(vertex_quadrature.size());</span></div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;<span class="stringliteral">         double min_timestep = std::numeric_limits&lt;double&gt;::max();</span></div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;<span class="stringliteral">         for (const auto &amp;cell : dof_handler.active_cell_iterators())</span></div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;<span class="stringliteral">           if (particle_handler.n_particles_in_cell(cell) &gt; 0)</span></div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;<span class="stringliteral">             {</span></div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;<span class="stringliteral">               const double cell_size = cell-&gt;minimum_vertex_distance();</span></div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;<span class="stringliteral">               fe_values.reinit(cell);</span></div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;<span class="stringliteral">               fe_values.get_function_gradients(solution, field_gradients);</span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;<span class="stringliteral">               double max_E = 0;</span></div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;<span class="stringliteral">               for (const auto q_point : fe_values.quadrature_point_indices())</span></div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;<span class="stringliteral">                 max_E = std::max(max_E, field_gradients[q_point].norm());</span></div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;<span class="stringliteral">               if (max_E &gt; 0)</span></div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;<span class="stringliteral">                 min_timestep =</span></div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;<span class="stringliteral">                   std::min(min_timestep,</span></div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;<span class="stringliteral">                            std::sqrt(0.5 cell_size</span></div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;<span class="stringliteral">                                      Constants::electron_mass /</span></div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;<span class="stringliteral">                                      Constants::electron_charge / max_E));</span></div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;<span class="stringliteral">             }</span></div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;<span class="stringliteral">         time.set_desired_next_step_size(min_timestep);</span></div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;<span class="stringliteral">       }</span></div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;<span class="stringliteral">   }</span></div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;<span class="stringliteral">*   &lt;a name=&quot;ThecodeCathodeRaySimulatoroutput_resultscodefunction&quot;&gt;&lt;/a&gt;  &lt;h4&gt;The &lt;code&gt;CathodeRaySimulator::output_results()&lt;/code&gt; function&lt;/h4&gt;</span></div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;<span class="stringliteral">*  The final function implementing pieces of the overall algorithm is the one that generates graphical output. In the current context, we want to output both the electric potential field as well as the particle locations and velocities. But we also want to output the electric field, i.e., the gradient of the solution.   </span></div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;<span class="stringliteral">*   deal.II has a general way how one can compute derived quantities from the solution and output those as well. Here, this is the electric field, but it could also be some other quantity</span></div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;<span class="stringliteral">*  -  say, the norm of the electric field, or in fact anything else one could want to compute from the solution   @f$V_h(\mathbf x)@f$   or its derivatives. This general solution uses the DataPostprocessor class and, in cases like the one here where we want to output a quantity that represents a vector field, the DataPostprocessorVector class.   </span></div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;<span class="stringliteral">*   Rather than try and explain how this class works, let us simply refer to the documentation of the DataPostprocessorVector class that has essentially this case as a well-documented example.</span></div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;<span class="stringliteral">   template &lt;int dim&gt;</span></div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;<span class="stringliteral">   class ElectricFieldPostprocessor : public DataPostprocessorVector&lt;dim&gt;</span></div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;<span class="stringliteral">   {</span></div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;<span class="stringliteral">   public:</span></div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;<span class="stringliteral">     ElectricFieldPostprocessor()</span></div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;<span class="stringliteral">       : DataPostprocessorVector&lt;dim&gt;(&quot;electric_field&quot;, update_gradients)</span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;<span class="stringliteral">     {}</span></div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;<span class="stringliteral">     virtual void evaluate_scalar_field(</span></div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;<span class="stringliteral">       const DataPostprocessorInputs::Scalar&lt;dim&gt; &amp;input_data,</span></div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;<span class="stringliteral">       std::vector&lt;Vector&lt;double&gt;&gt; &amp;computed_quantities) const override</span></div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;<span class="stringliteral">     {</span></div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;<span class="stringliteral">       AssertDimension(input_data.solution_gradients.size(),</span></div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;<span class="stringliteral">                       computed_quantities.size());</span></div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;<span class="stringliteral">       for (unsigned int p = 0; p &lt; input_data.solution_gradients.size(); ++p)</span></div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;<span class="stringliteral">         {</span></div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;<span class="stringliteral">           AssertDimension(computed_quantities[p].size(), dim);</span></div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;<span class="stringliteral">           for (unsigned int d = 0; d &lt; dim; ++d)</span></div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;<span class="stringliteral">             computed_quantities[p][d] = input_data.solution_gradients[p][d];</span></div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;<span class="stringliteral">         }</span></div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;<span class="stringliteral">     }</span></div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;<span class="stringliteral">   };</span></div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;<span class="stringliteral">*  With this, the `output_results()` function becomes relatively straightforward: We use the DataOut class as we have in almost every one of the previous tutorial programs to output the solution (the &quot;electric potential&quot;) and we use the postprocessor defined above to also output its gradient (the &quot;electric field&quot;). This all is then written into a file in VTU format after also associating the current time and time step number with this file.</span></div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;<span class="stringliteral">   template &lt;int dim&gt;</span></div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;<span class="stringliteral">   void CathodeRaySimulator&lt;dim&gt;::output_results() const</span></div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;<span class="stringliteral">   {</span></div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;<span class="stringliteral">     {</span></div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;<span class="stringliteral">       ElectricFieldPostprocessor&lt;dim&gt; electric_field;</span></div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;<span class="stringliteral">       DataOut&lt;dim&gt;                    data_out;</span></div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;<span class="stringliteral">       data_out.attach_dof_handler(dof_handler);</span></div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;<span class="stringliteral">       data_out.add_data_vector(solution, &quot;electric_potential&quot;);</span></div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;<span class="stringliteral">       data_out.add_data_vector(solution, electric_field);</span></div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;<span class="stringliteral">       data_out.build_patches();</span></div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;<span class="stringliteral">       data_out.set_flags(</span></div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;<span class="stringliteral">         DataOutBase::VtkFlags(time.get_current_time(), time.get_step_number()));</span></div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;<span class="stringliteral">       std::ofstream output(&quot;solution-&quot; +</span></div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;<span class="stringliteral">                            Utilities::int_to_string(time.get_step_number(), 4) +</span></div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;<span class="stringliteral">                            &quot;.vtu&quot;);</span></div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;<span class="stringliteral">       data_out.write_vtu(output);</span></div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;<span class="stringliteral">     }</span></div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;<span class="stringliteral">*  Output the particle positions and properties is not more complicated. The   Particles::DataOut   class plays the role of the DataOut class for particles, and all we have to do is tell that class where to take particles from and how to interpret the `dim` components of the properties</span></div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;<span class="stringliteral">*  -  namely, as a single vector indicating the velocity, rather than as `dim` scalar properties. The rest is then the same as above:</span></div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;<span class="stringliteral">     {</span></div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;<span class="stringliteral">       Particles::DataOut&lt;dim, dim&gt; particle_out;</span></div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;<span class="stringliteral">       particle_out.build_patches(</span></div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;<span class="stringliteral">         particle_handler,</span></div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;<span class="stringliteral">         std::vector&lt;std::string&gt;(dim, &quot;velocity&quot;),</span></div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;<span class="stringliteral">         std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;(</span></div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;<span class="stringliteral">           dim, DataComponentInterpretation::component_is_part_of_vector));</span></div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;<span class="stringliteral">       particle_out.set_flags(</span></div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;<span class="stringliteral">         DataOutBase::VtkFlags(time.get_current_time(), time.get_step_number()));</span></div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;<span class="stringliteral">       std::ofstream output(&quot;particles-&quot; +</span></div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;<span class="stringliteral">                            Utilities::int_to_string(time.get_step_number(), 4) +</span></div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;<span class="stringliteral">                            &quot;.vtu&quot;);</span></div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;<span class="stringliteral">       particle_out.write_vtu(output);</span></div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;<span class="stringliteral">     }</span></div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;<span class="stringliteral">   }</span></div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;<span class="stringliteral">*   &lt;a name=&quot;CathodeRaySimulatorrun&quot;&gt;&lt;/a&gt;  &lt;h4&gt;CathodeRaySimulator::run&lt;/h4&gt;</span></div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;<span class="stringliteral">*  The last member function of the principal class of this program is then the driver. At the top, it refines the mesh a number of times by solving the problem (with not particles yet created) on a sequence of finer and finer meshes.</span></div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;<span class="stringliteral">   template &lt;int dim&gt;</span></div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;<span class="stringliteral">   void CathodeRaySimulator&lt;dim&gt;::run()</span></div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;<span class="stringliteral">   {</span></div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;<span class="stringliteral">     make_grid();</span></div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;<span class="stringliteral">*  do a few refinement cycles up front</span></div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;<span class="stringliteral">     const unsigned int n_pre_refinement_cycles = 3;</span></div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;<span class="stringliteral">     for (unsigned int refinement_cycle = 0;</span></div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;<span class="stringliteral">          refinement_cycle &lt; n_pre_refinement_cycles;</span></div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;<span class="stringliteral">          ++refinement_cycle)</span></div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;<span class="stringliteral">       {</span></div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;<span class="stringliteral">         setup_system();</span></div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;<span class="stringliteral">         assemble_system();</span></div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;<span class="stringliteral">         solve_field();</span></div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;<span class="stringliteral">         refine_grid();</span></div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;<span class="stringliteral">       }</span></div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;<span class="stringliteral">*  Now do the loop over time. The sequence of steps follows closely the outline of the algorithm discussed in the introduction. As discussed in great detail in the documentation of the DiscreteTime class, while we move the field and particle information forward by one time step, the time stored in the `time` variable is not consistent with where (some of) these quantities are (in the diction of DiscreteTime, this is the &quot;update stage&quot;). The call to `time.advance_time()` makes everything consistent again by setting the `time` variable to the time at which the field and particles already are, and once we are in this &quot;consistent stage&quot;, we can generate graphical output and write information about the current state of the simulation to screen.</span></div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;<span class="stringliteral">     setup_system();</span></div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;<span class="stringliteral">     do</span></div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;<span class="stringliteral">       {</span></div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;<span class="stringliteral">         std::cout &lt;&lt; &quot;Timestep &quot; &lt;&lt; time.get_step_number() + 1 &lt;&lt; std::endl;</span></div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;<span class="stringliteral">         std::cout &lt;&lt; &quot;  Field degrees of freedom:                 &quot;</span></div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;<span class="stringliteral">                   &lt;&lt; dof_handler.n_dofs() &lt;&lt; std::endl;</span></div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;<span class="stringliteral">         assemble_system();</span></div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;<span class="stringliteral">         solve_field();</span></div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;<span class="stringliteral">         create_particles();</span></div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;<span class="stringliteral">         std::cout &lt;&lt; &quot;  Total number of particles in simulation:  &quot;</span></div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;<span class="stringliteral">                   &lt;&lt; particle_handler.n_global_particles() &lt;&lt; std::endl;</span></div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;<span class="stringliteral">         n_recently_lost_particles = 0;</span></div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;<span class="stringliteral">         update_timestep_size();</span></div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;<span class="stringliteral">         move_particles();</span></div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;<span class="stringliteral">         time.advance_time();</span></div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;<span class="stringliteral">         output_results();</span></div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;<span class="stringliteral">         std::cout &lt;&lt; &quot;  Number of particles lost this time step:  &quot;</span></div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;<span class="stringliteral">                   &lt;&lt; n_recently_lost_particles &lt;&lt; std::endl;</span></div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;<span class="stringliteral">         if (n_total_lost_particles &gt; 0)</span></div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;<span class="stringliteral">           std::cout &lt;&lt; &quot;  Fraction of particles lost through anode: &quot;</span></div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;<span class="stringliteral">                     &lt;&lt; 1. n_particles_lost_through_anode /</span></div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;<span class="stringliteral">                          n_total_lost_particles</span></div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;<span class="stringliteral">                     &lt;&lt; std::endl;</span></div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;<span class="stringliteral">         std::cout &lt;&lt; std::endl</span></div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;<span class="stringliteral">                   &lt;&lt; &quot;  Now at t=&quot; &lt;&lt; time.get_current_time()</span></div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;<span class="stringliteral">                   &lt;&lt; &quot;, dt=&quot; &lt;&lt; time.get_previous_step_size() &lt;&lt; &#39;</span>.<span class="stringliteral">&#39;</span></div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;<span class="stringliteral">                   &lt;&lt; std::endl</span></div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;<span class="stringliteral">                   &lt;&lt; std::endl;</span></div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;<span class="stringliteral">       }</span></div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;<span class="stringliteral">     while (time.is_at_end() == false);</span></div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;<span class="stringliteral">   }</span></div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;<span class="stringliteral"> } // namespace Step19</span></div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;<span class="stringliteral">*   &lt;a name=&quot;Thecodemaincodefunction&quot;&gt;&lt;/a&gt;  &lt;h3&gt;The &lt;code&gt;main&lt;/code&gt; function&lt;/h3&gt;</span></div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;<span class="stringliteral">*  The final function of the program is then again the `main()` function. It is unchanged in all tutorial programs since   @ref step_6 &quot;step-6&quot;   and so there is nothing new to discuss:</span></div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;<span class="stringliteral"> int main()</span></div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;<span class="stringliteral"> {</span></div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;<span class="stringliteral">   try</span></div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;<span class="stringliteral">     {</span></div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;<span class="stringliteral">       Step19::CathodeRaySimulator&lt;2&gt; cathode_ray_simulator_2d;</span></div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;<span class="stringliteral">       cathode_ray_simulator_2d.run();</span></div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;<span class="stringliteral">     }</span></div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;<span class="stringliteral">   catch (std::exception &amp;exc)</span></div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;<span class="stringliteral">     {</span></div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;<span class="stringliteral">       std::cerr &lt;&lt; std::endl</span></div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;<span class="stringliteral">                 &lt;&lt; std::endl</span></div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;<span class="stringliteral">                 &lt;&lt; &quot;----------------------------------------------------&quot;</span></div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;<span class="stringliteral">                 &lt;&lt; std::endl;</span></div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;<span class="stringliteral">       std::cerr &lt;&lt; &quot;Exception on processing: &quot; &lt;&lt; std::endl</span></div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;<span class="stringliteral">                 &lt;&lt; exc.what() &lt;&lt; std::endl</span></div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;<span class="stringliteral">                 &lt;&lt; &quot;Aborting!&quot; &lt;&lt; std::endl</span></div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;<span class="stringliteral">                 &lt;&lt; &quot;----------------------------------------------------&quot;</span></div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;<span class="stringliteral">                 &lt;&lt; std::endl;</span></div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;<span class="stringliteral">       return 1;</span></div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;<span class="stringliteral">     }</span></div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;<span class="stringliteral">   catch (...)</span></div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;<span class="stringliteral">     {</span></div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;<span class="stringliteral">       std::cerr &lt;&lt; std::endl</span></div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;<span class="stringliteral">                 &lt;&lt; std::endl</span></div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;<span class="stringliteral">                 &lt;&lt; &quot;----------------------------------------------------&quot;</span></div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;<span class="stringliteral">                 &lt;&lt; std::endl;</span></div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;<span class="stringliteral">       std::cerr &lt;&lt; &quot;Unknown exception!&quot; &lt;&lt; std::endl</span></div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;<span class="stringliteral">                 &lt;&lt; &quot;Aborting!&quot; &lt;&lt; std::endl</span></div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;<span class="stringliteral">                 &lt;&lt; &quot;----------------------------------------------------&quot;</span></div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;<span class="stringliteral">                 &lt;&lt; std::endl;</span></div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;<span class="stringliteral">       return 1;</span></div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;<span class="stringliteral">     }</span></div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;<span class="stringliteral">   return 0;</span></div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;<span class="stringliteral"> }</span></div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;<span class="stringliteral"> @endcode</span></div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;<span class="stringliteral">* &lt;a name=&quot;Results&quot;&gt;&lt;/a&gt;&lt;h1&gt;Results&lt;/h1&gt;</span></div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;<span class="stringliteral">* When this program is run, it produces output that looks as follows:```Timestep 1  Field degrees of freedom:                                 4989  Total number of particles in simulation:  20  Number of particles lost this time step:  0</span></div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;<span class="stringliteral">*   Now at t=2.12647e-07, dt=2.12647e-07.</span></div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;<span class="stringliteral">* Timestep 2  Field degrees of freedom:                 4989  Total number of particles in simulation:  24  Number of particles lost this time step:  0</span></div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;<span class="stringliteral">*   Now at t=4.14362e-07, dt=2.01715e-07.</span></div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;<span class="stringliteral">* Timestep 3  Field degrees of freedom:                 4989  Total number of particles in simulation:  28  Number of particles lost this time step:  0</span></div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;<span class="stringliteral">*   Now at t=5.96019e-07, dt=1.81657e-07.</span></div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;<span class="stringliteral">* Timestep 4  Field degrees of freedom:                 4989  Total number of particles in simulation:  32  Number of particles lost this time step:  0</span></div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;<span class="stringliteral">*   Now at t=7.42634e-07, dt=1.46614e-07.</span></div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;<span class="stringliteral">* ...</span></div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;<span class="stringliteral">*   Timestep 1000  Field degrees of freedom:                 4989  Total number of particles in simulation:  44  Number of particles lost this time step:  6  Fraction of particles lost through anode: 0.0601266</span></div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;<span class="stringliteral">*   Now at t=4.93276e-05, dt=4.87463e-08.</span></div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;<span class="stringliteral">* Timestep 1001  Field degrees of freedom:                 4989  Total number of particles in simulation:  44  Number of particles lost this time step:  0  Fraction of particles lost through anode: 0.0601266</span></div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;<span class="stringliteral">*   Now at t=4.93759e-05, dt=4.82873e-08.</span></div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;<span class="stringliteral">* ...</span></div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;<span class="stringliteral">* Timestep 2091  Field degrees of freedom:                 4989  Total number of particles in simulation:  44  Number of particles lost this time step:  0  Fraction of particles lost through anode: 0.0503338</span></div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;<span class="stringliteral">*   Now at t=9.99237e-05, dt=4.26254e-08.</span></div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;<span class="stringliteral">* Timestep 2092  Field degrees of freedom:                 4989  Total number of particles in simulation:  44  Number of particles lost this time step:  0  Fraction of particles lost through anode: 0.0503338</span></div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;<span class="stringliteral">*   Now at t=9.99661e-05, dt=4.24442e-08.</span></div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;<span class="stringliteral">* Timestep 2093  Field degrees of freedom:                 4989  Total number of particles in simulation:  44  Number of particles lost this time step:  2  Fraction of particles lost through anode: 0.050308</span></div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;<span class="stringliteral">*   Now at t=0.0001, dt=3.38577e-08.```</span></div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;<span class="stringliteral">* Picking a random few time steps, we can visualize the solution in theform of streamlines for the electric field and dots for the electrons:  &lt;div class=&quot;twocolumn&quot; style=&quot;width: 80%&quot;&gt;</span></div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;<span class="stringliteral">  &lt;div&gt;</span></div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;<span class="stringliteral">    &lt;img src=&quot;https://www.dealii.org/images/steps/developer/step-19.solution.0000.png&quot;</span></div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;<span class="stringliteral">         alt=&quot;The solution at time step 0 (t=0 seconds).&quot;</span></div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;<span class="stringliteral">         width=&quot;500&quot;&gt;</span></div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;<span class="stringliteral">    &lt;br&gt;</span></div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;<span class="stringliteral">    Solution at time step 0 (t=0 seconds).</span></div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;<span class="stringliteral">    &lt;br&gt;</span></div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;<span class="stringliteral">  &lt;/div&gt;</span></div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;<span class="stringliteral">  &lt;div&gt;</span></div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;<span class="stringliteral">    &lt;img src=&quot;https://www.dealii.org/images/steps/developer/step-19.solution.1400.png&quot;</span></div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;<span class="stringliteral">         alt=&quot;The solution at time step 1400 (t=0.000068 seconds).&quot;</span></div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;<span class="stringliteral">         width=&quot;500&quot;&gt;</span></div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;<span class="stringliteral">    &lt;br&gt;</span></div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;<span class="stringliteral">    Solution at time step 1400 (t=0.000068 seconds).</span></div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;<span class="stringliteral">    &lt;br&gt;</span></div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;<span class="stringliteral">  &lt;/div&gt;</span></div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;<span class="stringliteral">  &lt;div&gt;</span></div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;<span class="stringliteral">    &lt;img src=&quot;https://www.dealii.org/images/steps/developer/step-19.solution.0700.png&quot;</span></div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;<span class="stringliteral">         alt=&quot;The solution at time step 700 (t=0.000035 seconds).&quot;</span></div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;<span class="stringliteral">         width=&quot;500&quot;&gt;</span></div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;<span class="stringliteral">    &lt;br&gt;</span></div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;<span class="stringliteral">    Solution at time step 700 (t=0.000035 seconds).</span></div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;<span class="stringliteral">    &lt;br&gt;</span></div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;<span class="stringliteral">  &lt;/div&gt;</span></div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;<span class="stringliteral">  &lt;div&gt;</span></div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;<span class="stringliteral">    &lt;img src=&quot;https://www.dealii.org/images/steps/developer/step-19.solution.2092.png&quot;</span></div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;<span class="stringliteral">         alt=&quot;The solution at time step 2092 (t=0.0001 seconds).&quot;</span></div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;<span class="stringliteral">         width=&quot;500&quot;&gt;</span></div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;<span class="stringliteral">    &lt;br&gt;</span></div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;<span class="stringliteral">    Solution at time step 2092 (t=0.0001 seconds).</span></div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;<span class="stringliteral">    &lt;br&gt;</span></div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;<span class="stringliteral">  &lt;/div&gt;</span></div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;<span class="stringliteral">&lt;/div&gt;  </span></div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;<span class="stringliteral">* That said, a more appropriate way to visualize the results of thisprogram are by creating a video that shows how these electrons move, and howthe electric field changes in response to their motion:</span></div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;<span class="stringliteral">* @htmlonly</span></div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;<span class="stringliteral">&lt;p align=&quot;center&quot;&gt;</span></div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;<span class="stringliteral">  &lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/HwUtE7xuteE&quot;</span></div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;<span class="stringliteral">   frameborder=&quot;0&quot;</span></div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;<span class="stringliteral">   allow=&quot;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&quot;</span></div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;<span class="stringliteral">   allowfullscreen&gt;&lt;/iframe&gt;</span></div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;<span class="stringliteral"> &lt;/p&gt;</span></div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;<span class="stringliteral">@endhtmlonly</span></div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;<span class="stringliteral">* What you can see here is how the &quot;focus element&quot; of the boundary with its negativevoltage repels the electrons and makes sure that they do not just fly awayperpendicular from the cathode (as they do in the initial part of theirtrajectories). It also shows how the electric field linesmove around over time, in response to the charges flying by</span></div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;<span class="stringliteral">*  -  in other words,the feedback the particles have on the electric field that itself drives themotion of the electrons.</span></div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;<span class="stringliteral">* The movie suggests that electrons move in &quot;bunches&quot; or &quot;bursts&quot;. One element ofthis appearance is an artifact of how the movie was created: Every frame of themovie corresponds to one time step, but the time step length varies. More specifically,the fastest particle moving through the smallest cell determines the length of thetime step (see the discussion in the introduction), and consequently time stepsare small whenever a (fast) particle moves through the small cells at the rightedge of the domain; time steps are longer again once the particle has leftthe domain. This slowing-accelerating effect can easily be visualized by plottingthe time step length shown in the screen output.</span></div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;<span class="stringliteral">* The second part of this is real, however: The simulation creates a large groupof particles in the beginning, and fewer after about the 300th time step. Thisis probably because of the negative charge of the particles in the simulation:They reduce the magnitude of the electric field at the (also negatively chargedelectrode) and consequently reduce the number of points on the cathode at whichthe magnitude exceeds the threshold necessary to draw an electron out of theelectrode.</span></div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;<span class="stringliteral">* &lt;a name=&quot;extensions&quot;&gt;&lt;/a&gt;&lt;a name=&quot;Possibilitiesforextensions&quot;&gt;&lt;/a&gt;&lt;h3&gt;Possibilities for extensions&lt;/h3&gt;</span></div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;<span class="stringliteral">* &lt;a name=&quot;Avoidingaperformancebottleneckwithparticles&quot;&gt;&lt;/a&gt;&lt;h4&gt; Avoiding a performance bottleneck with particles &lt;/h4&gt;</span></div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;<span class="stringliteral">* The `assemble_system()`, `move_particles()`, and `update_timestep_size()`functions all call   Particles::ParticleHandler::particles_in_cell()   and  Particles::ParticleHandler::n_particles_in_cell()   that query informationabout the particles located on the current cell. While this is convenient,it&#39;</span>s also inefficient. To understand why <span class="keyword">this</span> is so, <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> needs to knowhow particles are stored in   <a class="code" href="classParticles_1_1ParticleHandler.html">Particles::ParticleHandler</a>:   namely, in adata structure in which particles are ordered in some kind of linearfashion sorted by the cell they are on. Consequently, in order to findthe particles associated with a given cell, these <a class="code" href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">functions</a> need tosearch <span class="keywordflow">for</span> the <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> (and possibly last) particle on a given cell</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;* </div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;*  - an effort that costs   @f${\cal <a class="code" href="namespaceLAPACKSupport.html#ae4c4142bb80d7e6e5214c37fac73e1da">O</a>}(\log <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>)@f$   operations where   @f$N@f$   is thenumber of particles. But <span class="keyword">this</span> is repeated on every cell; assuming thatfor large computations, the number of cells and particles are roughlyproportional, the accumulated cost of these <span class="keyword">function</span> calls is then  @f${\cal <a class="code" href="namespaceLAPACKSupport.html#ae4c4142bb80d7e6e5214c37fac73e1da">O</a>}(N \log <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>)@f$   and consequently larger than the   @f${\cal <a class="code" href="namespaceLAPACKSupport.html#ae4c4142bb80d7e6e5214c37fac73e1da">O</a>}(<a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>)@f$  cost that we should shoot <span class="keywordflow">for</span> with all parts of a program.</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;* We can make <span class="keyword">this</span> cheaper, though. First, instead of calling  <a class="code" href="classParticles_1_1ParticleHandler.html#ac043a4ea224ed50a03b8e9c3d3b98aec">Particles::ParticleHandler::n_particles_in_cell</a>(),   we might <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> <a class="code" href="namespaceThreads_1_1internal.html#a8d237a30d09b13e0b5adbe0fd1dfb188">call</a>  <a class="code" href="classParticles_1_1ParticleHandler.html#acaf1232ffce0746baa64122a5c65822e">Particles::ParticleHandler::particles_in_cell</a>()   and then compute thenumber of particles on a cell by just computing the distance of the lastto the <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> particle on the current cell:</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;* @code</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;  const typename <a class="code" href="namespaceParticles.html">Particles</a>::ParticleHandler&lt;dim, spacedim&gt;::particle_iterator_range</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    particles_in_cell = particle_handler.particles_in_cell(cell);</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;  const <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span></div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    n_particles_in_cell = <a class="code" href="namespacestd.html">std</a>::distance (particles_in_cell.<a class="code" href="namespaceTrilinosWrappers_1_1internal.html#ad88a9499e01173b35d78413e5945e020">begin</a>(),</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;                                         particles_in_cell.<a class="code" href="namespaceTrilinosWrappers_1_1internal.html#aee42c8e3004e2e81eac3c3356d3ec46b">end</a>());</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;@endcode</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;* The <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> of these calls is of course still   @f${\cal <a class="code" href="namespaceLAPACKSupport.html#ae4c4142bb80d7e6e5214c37fac73e1da">O</a>}(\log <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>)@f$  ,but at least the <a class="code" href="grid__out_8cc.html#a2cc229a4f1ffc75e83ed269d5f725729">second</a> <a class="code" href="namespaceThreads_1_1internal.html#a8d237a30d09b13e0b5adbe0fd1dfb188">call</a> only takes a compute time proportional tothe number of particles on the current cell and so, when accumulatedover all cells, has a cost of   @f${\cal <a class="code" href="namespaceLAPACKSupport.html#ae4c4142bb80d7e6e5214c37fac73e1da">O</a>}(<a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>)@f$  .</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;* But we can even <span class="keyword">get</span> rid of the <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> of these calls with some proper algorithmdesign. That<span class="stringliteral">&#39;s because particles are ordered in the same way as cells, and sowe can just walk them as we move along on the cells. The following outlineof an algorithm does this:</span></div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;<span class="stringliteral">* @code</span></div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;<span class="stringliteral">  auto begin_particle_on_cell = particle_handler.begin();</span></div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;<span class="stringliteral">  for (const auto &amp;cell : dof_handler.active_cell_iterators())</span></div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;<span class="stringliteral">    {</span></div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;<span class="stringliteral">      unsigned int n_particles_on_cell = 0;</span></div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="stringliteral">      auto end_particle_on_cell = begin_particle_on_cell;</span></div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;<span class="stringliteral">      while (end_particle_on_cell-&gt;get_surrounding_cell(triangulation)</span></div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;<span class="stringliteral">             == cell)</span></div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;<span class="stringliteral">        {</span></div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;<span class="stringliteral">          ++n_particles_on_cell;</span></div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;<span class="stringliteral">          ++end_particle_on_cell;</span></div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;<span class="stringliteral">        }</span></div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;<span class="stringliteral">      ...now operate on the range of particles from begin_particle_on_cell</span></div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;<span class="stringliteral">         to end_particle_on_cell, all of which are known to be on the current</span></div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;<span class="stringliteral">         cell...;</span></div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;<span class="stringliteral">      // Move the begin iterator forward so that it points to the first</span></div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;<span class="stringliteral">      // particle on the next cell</span></div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;<span class="stringliteral">      begin_particle_on_cell = end_particle_on_cell;</span></div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;<span class="stringliteral">    }</span></div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;<span class="stringliteral">@endcode</span></div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;<span class="stringliteral">* In this code, we touch every cell exactly once and we never have to searchthe big data structure for the first or last particle on each cell. As aconsequence, the algorithm costs a total of   @f${\cal O}(N)@f$   for a completesweep of all particles and all cells.</span></div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;<span class="stringliteral">* It would not be very difficult to implement this scheme for all three of thefunctions in this program that have this issue.</span></div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;<span class="stringliteral">* &lt;a name=&quot;Morestatisticsaboutelectrons&quot;&gt;&lt;/a&gt;&lt;h4&gt; More statistics about electrons &lt;/h4&gt;</span></div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;<span class="stringliteral">* </span></div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;<span class="stringliteral">* The program already computes the fraction of the electrons that leave thedomain through the hole in the anode. But there are other quantities one might beinterested in. For example, the average velocity of these particles. It wouldnot be very difficult to obtain each particle&#39;</span>s velocity from its properties,in the same way as we <span class="keywordflow">do</span> in the `move_particles()` <span class="keyword">function</span>, and computestatistics from it.</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;* </div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;* &lt;a name=<span class="stringliteral">&quot;Abettersynchronizedvisualization&quot;</span>&gt;&lt;/a&gt;&lt;h4&gt; <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a> better-<span class="keyword">synchronized</span> visualization &lt;/h4&gt;</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;* </div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;* As discussed above, there is a varying time difference between different framesof the video because we create output <span class="keywordflow">for</span> every time step. <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a> better way tocreate movies would be to generate a <span class="keyword">new</span> output file in fixed time intervals,regardless of how many time steps lie between each such point.</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;* </div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;* &lt;a name=<span class="stringliteral">&quot;Abettertimeintegrator&quot;</span>&gt;&lt;/a&gt;&lt;h4&gt; <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a> better time integrator &lt;/h4&gt;</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;* </div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;* The problem we are considering in <span class="keyword">this</span> program is a coupled, multiphysicsproblem. But the way we solve it is by <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> computing the (electric) potentialfield and then update the particle locations. This is what is called an<span class="stringliteral">&quot;operator-splitting method&quot;</span>, a concept we will investigate in more detailin   @ref step_58 <span class="stringliteral">&quot;step-58&quot;</span>  .</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;* While it is awkward to think of a way to solve <span class="keyword">this</span> problem that does not involvesplitting the problem into a PDE piece and a particles piece, <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a></div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;*can* (and probably should!) think of a better way to update the particlelocations. Specifically, the equations we use to update the particle locationare</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;* @f{align*}{</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;  \frac{{\mathbf v}_i^{(n)}-{\mathbf v}_i^{(n-1)}}{\Delta t} &amp;= \frac{e\nabla <a class="code" href="namespaceLAPACKSupport.html#aee5ef58d11434eb1d6a665e64bf17292">V</a>^{(n)}}{m}</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;  \\</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;  \frac{{\mathbf x}_i^{(n)}-{\mathbf x}_i^{(n-1)}}{\Delta t} &amp;= {\mathbf v}_i^{(n)}.</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;@f}</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;* This corresponds to a simple forward-Euler time discretization</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;* </div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;*  -  a method offirst order accuracy in the time step size   @f$\Delta t@f$   that we know we shouldavoid because we can <span class="keywordflow">do</span> better. Rather, <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> might want to consider a scheme suchas the[leapfrog scheme](https:<span class="comment">//en.wikipedia.org/wiki/Leapfrog_integration)or more generally[symplectic integrators](https://en.wikipedia.org/wiki/Symplectic_integrator)such as the[Verlet scheme](https://en.wikipedia.org/wiki/Verlet_integration).</span></div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;* </div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;* &lt;a name=<span class="stringliteral">&quot;Parallelization&quot;</span>&gt;&lt;/a&gt;&lt;h4&gt; Parallelization &lt;/h4&gt;</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;* </div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;* In release mode, the program runs in about 3.5 minutes on <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> of the author<span class="stringliteral">&#39;slaptops at the time of writing this. That&#39;</span>s acceptable. But what <span class="keywordflow">if</span> we wantedto make the simulation three-dimensional? If we wanted to not use a maximumof around 100 particles at any given time (as happens with the parametersused here) but 100,000? If we needed a substantially finer mesh?</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;* In those cases, <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> would want to <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a> the program not just on a single processor,but in fact on as many as <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> has available. This requires parallelizationboth the PDE solution as well as over particles. In practice, <span class="keywordflow">while</span> thereare substantial challenges to making <span class="keyword">this</span> efficient and <a class="code" href="namespaceGridTools.html#a0967563badadd81f77f62622dd8bc2cd">scale</a> well, thesechallenges are all addressed in deal.II itself. For example,   @ref step_40 <span class="stringliteral">&quot;step-40&quot;</span>   showshow to parallelize the finite element part, and   @ref step_70 <span class="stringliteral">&quot;step-70&quot;</span>   shows how <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> canthen also parallelize the particles part.</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;* </div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;* &lt;a name=<span class="stringliteral">&quot;PlainProg&quot;</span>&gt;&lt;/a&gt;&lt;h1&gt; The plain program&lt;/h1&gt;  @include <span class="stringliteral">&quot;step-19.cc&quot;</span>  </div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;*</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;*/</div><div class="ttc" id="classParticles_1_1ParticleHandler_html"><div class="ttname"><a href="classParticles_1_1ParticleHandler.html">Particles::ParticleHandler</a></div><div class="ttdef"><b>Definition:</b> <a href="particles_2data__out_8h_source.html#l00033">data_out.h:33</a></div></div>
<div class="ttc" id="group__MeshWorker_html_gad10f528ab87f39fbb0531d24f238b2f3"><div class="ttname"><a href="group__MeshWorker.html#gad10f528ab87f39fbb0531d24f238b2f3">MeshWorker::loop</a></div><div class="ttdeci">void loop(ITERATOR begin, typename identity&lt; ITERATOR &gt;::type end, DOFINFO &amp;dinfo, INFOBOX &amp;info, const std::function&lt; void(DOFINFO &amp;, typename INFOBOX::CellInfo &amp;)&gt; &amp;cell_worker, const std::function&lt; void(DOFINFO &amp;, typename INFOBOX::CellInfo &amp;)&gt; &amp;boundary_worker, const std::function&lt; void(DOFINFO &amp;, DOFINFO &amp;, typename INFOBOX::CellInfo &amp;, typename INFOBOX::CellInfo &amp;)&gt; &amp;face_worker, ASSEMBLER &amp;assembler, const LoopControl &amp;lctrl=LoopControl())</div><div class="ttdef"><b>Definition:</b> <a href="loop_8h_source.html#l00449">loop.h:449</a></div></div>
<div class="ttc" id="group__Exceptions_html_ga9442b63275c9ef3fab29bc222831c49c"><div class="ttname"><a href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a></div><div class="ttdeci">#define AssertDimension(dim1, dim2)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2exceptions_8h_source.html#l01562">exceptions.h:1562</a></div></div>
<div class="ttc" id="structCellData_html"><div class="ttname"><a href="structCellData.html">CellData</a></div><div class="ttdef"><b>Definition:</b> <a href="tria__description_8h_source.html#l00053">tria_description.h:53</a></div></div>
<div class="ttc" id="namespacePatterns_1_1internal_html_a3cb7cf7c260acaeb90d4e60a288894d1"><div class="ttname"><a href="namespacePatterns_1_1internal.html#a3cb7cf7c260acaeb90d4e60a288894d1">Patterns::internal::escape</a></div><div class="ttdeci">std::string escape(const std::string &amp;input, const PatternBase::OutputStyle style)</div><div class="ttdef"><b>Definition:</b> <a href="patterns_8cc_source.html#l00055">patterns.cc:55</a></div></div>
<div class="ttc" id="classPreconditionSSOR_html_a7a3d66b17bb0ea1b16606e222474c2ea"><div class="ttname"><a href="classPreconditionSSOR.html#a7a3d66b17bb0ea1b16606e222474c2ea">PreconditionSSOR::initialize</a></div><div class="ttdeci">void initialize(const MatrixType &amp;A, const typename BaseClass::AdditionalData &amp;parameters=typename BaseClass::AdditionalData())</div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_a1a9009db0d9a77923a7031b549b9b638a5bc7c54a9c20485772672825c6a73003"><div class="ttname"><a href="namespaceLAPACKSupport.html#a1a9009db0d9a77923a7031b549b9b638a5bc7c54a9c20485772672825c6a73003">LAPACKSupport::matrix</a></div><div class="ttdoc">Contents is actually a matrix. </div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00060">lapack_support.h:60</a></div></div>
<div class="ttc" id="namespacePhysics_1_1Elasticity_1_1Kinematics_html_a9587d5229555daa5b1fa1ba2f8a40adb"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">Physics::Elasticity::Kinematics::e</a></div><div class="ttdeci">SymmetricTensor&lt; 2, dim, Number &gt; e(const Tensor&lt; 2, dim, Number &gt; &amp;F)</div></div>
<div class="ttc" id="classParticles_1_1Particle_html"><div class="ttname"><a href="classParticles_1_1Particle.html">Particles::Particle</a></div><div class="ttdef"><b>Definition:</b> <a href="particle_8h_source.html#l00071">particle.h:71</a></div></div>
<div class="ttc" id="classVector_html"><div class="ttname"><a href="classVector.html">Vector</a></div><div class="ttdef"><b>Definition:</b> <a href="mapping__q1__eulerian_8h_source.html#l00033">mapping_q1_eulerian.h:33</a></div></div>
<div class="ttc" id="namespaceGridTools_html_a0967563badadd81f77f62622dd8bc2cd"><div class="ttname"><a href="namespaceGridTools.html#a0967563badadd81f77f62622dd8bc2cd">GridTools::scale</a></div><div class="ttdeci">void scale(const double scaling_factor, Triangulation&lt; dim, spacedim &gt; &amp;triangulation)</div><div class="ttdef"><b>Definition:</b> <a href="grid__tools_8cc_source.html#l02042">grid_tools.cc:2042</a></div></div>
<div class="ttc" id="classParticles_1_1ParticleHandler_html_ac043a4ea224ed50a03b8e9c3d3b98aec"><div class="ttname"><a href="classParticles_1_1ParticleHandler.html#ac043a4ea224ed50a03b8e9c3d3b98aec">Particles::ParticleHandler::n_particles_in_cell</a></div><div class="ttdeci">types::particle_index n_particles_in_cell(const typename Triangulation&lt; dim, spacedim &gt;::active_cell_iterator &amp;cell) const</div><div class="ttdef"><b>Definition:</b> <a href="particle__handler_8cc_source.html#l00282">particle_handler.cc:282</a></div></div>
<div class="ttc" id="namespaceinternal_html_aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804"><div class="ttname"><a href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">internal::EvaluatorQuantity::value</a></div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_aee5ef58d11434eb1d6a665e64bf17292"><div class="ttname"><a href="namespaceLAPACKSupport.html#aee5ef58d11434eb1d6a665e64bf17292">LAPACKSupport::V</a></div><div class="ttdeci">static const char V</div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00188">lapack_support.h:188</a></div></div>
<div class="ttc" id="namespacestd_html"><div class="ttname"><a href="namespacestd.html">std</a></div><div class="ttdoc">STL namespace. </div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_aceda56512460bbad2f9fdb8a3d0e1e51"><div class="ttname"><a href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">LAPACKSupport::one</a></div><div class="ttdeci">static const types::blas_int one</div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00198">lapack_support.h:198</a></div></div>
<div class="ttc" id="namespaceLocalIntegrators_1_1Advection_html_a8bc7b8136646134f73a4193adefe15f8"><div class="ttname"><a href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">LocalIntegrators::Advection::cell_matrix</a></div><div class="ttdeci">void cell_matrix(FullMatrix&lt; double &gt; &amp;M, const FEValuesBase&lt; dim &gt; &amp;fe, const FEValuesBase&lt; dim &gt; &amp;fetest, const ArrayView&lt; const std::vector&lt; double &gt;&gt; &amp;velocity, const double factor=1.)</div><div class="ttdef"><b>Definition:</b> <a href="advection_8h_source.html#l00063">advection.h:63</a></div></div>
<div class="ttc" id="group__feaccess_html_ggaa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a"><div class="ttname"><a href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a></div><div class="ttdoc">Transformed quadrature points. </div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00097">fe_update_flags.h:97</a></div></div>
<div class="ttc" id="namespaceDoFRenumbering_html_a59c1a183ef6288e6bb061eb738b84380"><div class="ttname"><a href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">DoFRenumbering::downstream</a></div><div class="ttdeci">void downstream(DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, const Tensor&lt; 1, spacedim &gt; &amp;direction, const bool dof_wise_renumbering=false)</div><div class="ttdef"><b>Definition:</b> <a href="dof__renumbering_8cc_source.html#l01741">dof_renumbering.cc:1741</a></div></div>
<div class="ttc" id="grid__out_8cc_html_a2cc229a4f1ffc75e83ed269d5f725729"><div class="ttname"><a href="grid__out_8cc.html#a2cc229a4f1ffc75e83ed269d5f725729">second</a></div><div class="ttdeci">Point&lt; 2 &gt; second</div><div class="ttdef"><b>Definition:</b> <a href="grid__out_8cc_source.html#l04588">grid_out.cc:4588</a></div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_ae4c4142bb80d7e6e5214c37fac73e1da"><div class="ttname"><a href="namespaceLAPACKSupport.html#ae4c4142bb80d7e6e5214c37fac73e1da">LAPACKSupport::O</a></div><div class="ttdeci">static const char O</div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00168">lapack_support.h:168</a></div></div>
<div class="ttc" id="classParticles_1_1Particle_html_a57efa2034baca617ba3160ccfbbc7cd7"><div class="ttname"><a href="classParticles_1_1Particle.html#a57efa2034baca617ba3160ccfbbc7cd7">Particles::Particle::set_reference_location</a></div><div class="ttdeci">void set_reference_location(const Point&lt; dim &gt; &amp;new_reference_location)</div><div class="ttdef"><b>Definition:</b> <a href="particle_8h_source.html#l00394">particle.h:394</a></div></div>
<div class="ttc" id="classPoint_html"><div class="ttname"><a href="classPoint.html">Point&lt; dim &gt;</a></div></div>
<div class="ttc" id="namespacePhysics_1_1Elasticity_1_1Kinematics_html_a09916360abaee5f1fb31994dbc96787b"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a09916360abaee5f1fb31994dbc96787b">Physics::Elasticity::Kinematics::C</a></div><div class="ttdeci">SymmetricTensor&lt; 2, dim, Number &gt; C(const Tensor&lt; 2, dim, Number &gt; &amp;F)</div></div>
<div class="ttc" id="namespaceThreads_1_1internal_html_a8d237a30d09b13e0b5adbe0fd1dfb188"><div class="ttname"><a href="namespaceThreads_1_1internal.html#a8d237a30d09b13e0b5adbe0fd1dfb188">Threads::internal::call</a></div><div class="ttdeci">void call(const std::function&lt; RT()&gt; &amp;function, internal::return_value&lt; RT &gt; &amp;ret_val)</div><div class="ttdef"><b>Definition:</b> <a href="thread__management_8h_source.html#l00346">thread_management.h:346</a></div></div>
<div class="ttc" id="classQGauss_html"><div class="ttname"><a href="classQGauss.html">QGauss</a></div><div class="ttdef"><b>Definition:</b> <a href="quadrature__lib_8h_source.html#l00039">quadrature_lib.h:39</a></div></div>
<div class="ttc" id="namespacenumbers_html_a3c7239f00d5e87dfcf6dd19cbc3ddc74"><div class="ttname"><a href="namespacenumbers.html#a3c7239f00d5e87dfcf6dd19cbc3ddc74">numbers::E</a></div><div class="ttdeci">static constexpr double E</div><div class="ttdef"><b>Definition:</b> <a href="numbers_8h_source.html#l00193">numbers.h:193</a></div></div>
<div class="ttc" id="classSolverControl_html"><div class="ttname"><a href="classSolverControl.html">SolverControl</a></div><div class="ttdef"><b>Definition:</b> <a href="solver__control_8h_source.html#l00047">solver_control.h:47</a></div></div>
<div class="ttc" id="namespaceVectorTools_1_1EvaluationFlags_html_ac6721740e24732d6afabcf28ddfc1ffda4ed1da4f7c4036896a6aeb19338d1a81"><div class="ttname"><a href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffda4ed1da4f7c4036896a6aeb19338d1a81">VectorTools::EvaluationFlags::insert</a></div><div class="ttdef"><b>Definition:</b> <a href="vector__tools__evaluate_8h_source.html#l00068">vector_tools_evaluate.h:68</a></div></div>
<div class="ttc" id="namespaceTensorAccessors_html_a5798da96660fa8e6798917501d65dbd8"><div class="ttname"><a href="namespaceTensorAccessors.html#a5798da96660fa8e6798917501d65dbd8">TensorAccessors::extract</a></div><div class="ttdeci">constexpr ReturnType&lt; rank, T &gt;::value_type &amp; extract(T &amp;t, const ArrayType &amp;indices)</div><div class="ttdef"><b>Definition:</b> <a href="tensor__accessors_8h_source.html#l00244">tensor_accessors.h:244</a></div></div>
<div class="ttc" id="classParticles_1_1ParticleHandler_html_acaf1232ffce0746baa64122a5c65822e"><div class="ttname"><a href="classParticles_1_1ParticleHandler.html#acaf1232ffce0746baa64122a5c65822e">Particles::ParticleHandler::particles_in_cell</a></div><div class="ttdeci">particle_iterator_range particles_in_cell(const typename Triangulation&lt; dim, spacedim &gt;::active_cell_iterator &amp;cell)</div><div class="ttdef"><b>Definition:</b> <a href="particle__handler_8cc_source.html#l00318">particle_handler.cc:318</a></div></div>
<div class="ttc" id="classPreconditionSSOR_html"><div class="ttname"><a href="classPreconditionSSOR.html">PreconditionSSOR</a></div><div class="ttdef"><b>Definition:</b> <a href="precondition_8h_source.html#l00667">precondition.h:667</a></div></div>
<div class="ttc" id="namespaceinternal_html_aa5bef221c94bc6b9c5441c306a72cdbaae2b6dfb8a5c48206992d8310d176c37c"><div class="ttname"><a href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaae2b6dfb8a5c48206992d8310d176c37c">internal::EvaluatorQuantity::gradient</a></div></div>
<div class="ttc" id="grid__out_8cc_html_a9082f945c1d289684d0bcd51ee08e11e"><div class="ttname"><a href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a></div><div class="ttdeci">unsigned int level</div><div class="ttdef"><b>Definition:</b> <a href="grid__out_8cc_source.html#l04590">grid_out.cc:4590</a></div></div>
<div class="ttc" id="classSolverCG_html"><div class="ttname"><a href="classSolverCG.html">SolverCG</a></div><div class="ttdef"><b>Definition:</b> <a href="solver__cg_8h_source.html#l00078">solver_cg.h:78</a></div></div>
<div class="ttc" id="namespaceTrilinosWrappers_1_1internal_html_aee42c8e3004e2e81eac3c3356d3ec46b"><div class="ttname"><a href="namespaceTrilinosWrappers_1_1internal.html#aee42c8e3004e2e81eac3c3356d3ec46b">TrilinosWrappers::internal::end</a></div><div class="ttdeci">VectorType::value_type * end(VectorType &amp;V)</div><div class="ttdef"><b>Definition:</b> <a href="trilinos__sparse__matrix_8cc_source.html#l00067">trilinos_sparse_matrix.cc:67</a></div></div>
<div class="ttc" id="data__out__base_8cc_html_accc45da40beb7ae1b485306984e904a2"><div class="ttname"><a href="data__out__base_8cc.html#accc45da40beb7ae1b485306984e904a2">vertices</a></div><div class="ttdeci">Point&lt; 3 &gt; vertices[4]</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8cc_source.html#l00175">data_out_base.cc:175</a></div></div>
<div class="ttc" id="classTriangulation_html"><div class="ttname"><a href="classTriangulation.html">Triangulation</a></div><div class="ttdef"><b>Definition:</b> <a href="grid_2tria_8h_source.html#l00740">tria.h:740</a></div></div>
<div class="ttc" id="classParticles_1_1ParticleIterator_html"><div class="ttname"><a href="classParticles_1_1ParticleIterator.html">Particles::ParticleIterator</a></div><div class="ttdef"><b>Definition:</b> <a href="particle__iterator_8h_source.html#l00039">particle_iterator.h:39</a></div></div>
<div class="ttc" id="structFEValuesExtractors_1_1Scalar_html"><div class="ttname"><a href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a></div><div class="ttdef"><b>Definition:</b> <a href="fe__values__extractors_8h_source.html#l00078">fe_values_extractors.h:78</a></div></div>
<div class="ttc" id="classKellyErrorEstimator_html_ae2269e1c9903e9d863b7abd54948af00"><div class="ttname"><a href="classKellyErrorEstimator.html#ae2269e1c9903e9d863b7abd54948af00">KellyErrorEstimator::estimate</a></div><div class="ttdeci">static void estimate(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const Quadrature&lt; dim - 1 &gt; &amp;quadrature, const std::map&lt; types::boundary_id, const Function&lt; spacedim, typename InputVector::value_type &gt; *&gt; &amp;neumann_bc, const InputVector &amp;solution, Vector&lt; float &gt; &amp;error, const ComponentMask &amp;component_mask=ComponentMask(), const Function&lt; spacedim &gt; *coefficients=nullptr, const unsigned int n_threads=numbers::invalid_unsigned_int, const types::subdomain_id subdomain_id=numbers::invalid_subdomain_id, const types::material_id material_id=numbers::invalid_material_id, const Strategy strategy=cell_diameter_over_24)</div></div>
<div class="ttc" id="grid__out_8cc_html_a827a345f29da7caeb588b11013869a01"><div class="ttname"><a href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a></div><div class="ttdeci">Point&lt; 2 &gt; first</div><div class="ttdef"><b>Definition:</b> <a href="grid__out_8cc_source.html#l04587">grid_out.cc:4587</a></div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_a40707d49114d54318c823f3b750e89a4"><div class="ttname"><a href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">LAPACKSupport::A</a></div><div class="ttdeci">static const char A</div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00158">lapack_support.h:158</a></div></div>
<div class="ttc" id="classTensor_html"><div class="ttname"><a href="classTensor.html">Tensor</a></div><div class="ttdef"><b>Definition:</b> <a href="tensor_8h_source.html#l00396">tensor.h:396</a></div></div>
<div class="ttc" id="classFEValuesBase_html_abade89efb068b71b7ced7082012a2441"><div class="ttname"><a href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">FEValuesBase::JxW</a></div><div class="ttdeci">double JxW(const unsigned int quadrature_point) const</div></div>
<div class="ttc" id="namespaceTrilinosWrappers_1_1internal_html_ad88a9499e01173b35d78413e5945e020"><div class="ttname"><a href="namespaceTrilinosWrappers_1_1internal.html#ad88a9499e01173b35d78413e5945e020">TrilinosWrappers::internal::begin</a></div><div class="ttdeci">VectorType::value_type * begin(VectorType &amp;V)</div><div class="ttdef"><b>Definition:</b> <a href="trilinos__sparse__matrix_8cc_source.html#l00053">trilinos_sparse_matrix.cc:53</a></div></div>
<div class="ttc" id="group__feaccess_html_ggaa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20"><div class="ttname"><a href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a></div><div class="ttdoc">Shape function gradients. </div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00068">fe_update_flags.h:68</a></div></div>
<div class="ttc" id="group__feaccess_html_ggaa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f"><div class="ttname"><a href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f">update_normal_vectors</a></div><div class="ttdoc">Normal vectors. </div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00109">fe_update_flags.h:109</a></div></div>
<div class="ttc" id="namespaceParticles_html"><div class="ttname"><a href="namespaceParticles.html">Particles</a></div><div class="ttdef"><b>Definition:</b> <a href="particles_2data__out_8h_source.html#l00030">data_out.h:30</a></div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_a8edacd69ab93285f82b7f63c733a86b7"><div class="ttname"><a href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">LAPACKSupport::N</a></div><div class="ttdeci">static const char N</div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00163">lapack_support.h:163</a></div></div>
<div class="ttc" id="classParticles_1_1Particle_html_af792bce47ec4746ad2c78e7e800299a8"><div class="ttname"><a href="classParticles_1_1Particle.html#af792bce47ec4746ad2c78e7e800299a8">Particles::Particle::set_id</a></div><div class="ttdeci">void set_id(const types::particle_index &amp;new_id)</div><div class="ttdef"><b>Definition:</b> <a href="particle_8h_source.html#l00421">particle.h:421</a></div></div>
<div class="ttc" id="classQMidpoint_html"><div class="ttname"><a href="classQMidpoint.html">QMidpoint</a></div><div class="ttdef"><b>Definition:</b> <a href="quadrature__lib_8h_source.html#l00084">quadrature_lib.h:84</a></div></div>
<div class="ttc" id="namespaceOpenCASCADE_html_a9509efa83e3b2fa42616fe0623cba696"><div class="ttname"><a href="namespaceOpenCASCADE.html#a9509efa83e3b2fa42616fe0623cba696">OpenCASCADE::point</a></div><div class="ttdeci">Point&lt; spacedim &gt; point(const gp_Pnt &amp;p, const double tolerance=1e-10)</div><div class="ttdef"><b>Definition:</b> <a href="opencascade_2utilities_8cc_source.html#l00188">utilities.cc:188</a></div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_a0d8802698d585eec62a2a54e6387b05b"><div class="ttname"><a href="namespaceLAPACKSupport.html#a0d8802698d585eec62a2a54e6387b05b">LAPACKSupport::zero</a></div><div class="ttdeci">static const types::blas_int zero</div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00193">lapack_support.h:193</a></div></div>
<div class="ttc" id="p4est__wrappers_8cc_html_ace00f2f80d9780ef9aa1007e1c22c6a4"><div class="ttname"><a href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a></div><div class="ttdeci">const ::parallel::distributed::Triangulation&lt; dim, spacedim &gt; * triangulation</div><div class="ttdef"><b>Definition:</b> <a href="p4est__wrappers_8cc_source.html#l00069">p4est_wrappers.cc:69</a></div></div>
<div class="ttc" id="classParticles_1_1Particle_html_afbe52b594cf4a8dd11431679c4ef2b52"><div class="ttname"><a href="classParticles_1_1Particle.html#afbe52b594cf4a8dd11431679c4ef2b52">Particles::Particle::set_location</a></div><div class="ttdeci">void set_location(const Point&lt; spacedim &gt; &amp;new_location)</div><div class="ttdef"><b>Definition:</b> <a href="particle_8h_source.html#l00376">particle.h:376</a></div></div>
<div class="ttc" id="classTensor_html_afd0934b4edd71063f66a9c67540e79fc"><div class="ttname"><a href="classTensor.html#afd0934b4edd71063f66a9c67540e79fc">Tensor::norm</a></div><div class="ttdeci">numbers::NumberTraits&lt; Number &gt;::real_type norm() const</div></div>
<div class="ttc" id="namespaceinternal_1_1VectorOperations_html_a40c8daa0881cff0123fbaeb08929f5cb"><div class="ttname"><a href="namespaceinternal_1_1VectorOperations.html#a40c8daa0881cff0123fbaeb08929f5cb">internal::VectorOperations::copy</a></div><div class="ttdeci">void copy(const T *begin, const T *end, U *dest)</div><div class="ttdef"><b>Definition:</b> <a href="vector__operations__internal_8h_source.html#l00069">vector_operations_internal.h:69</a></div></div>
<div class="ttc" id="namespaceGridRefinement_html_a48e5395381ed87155942a61a1edd134d"><div class="ttname"><a href="namespaceGridRefinement.html#a48e5395381ed87155942a61a1edd134d">GridRefinement::refine_and_coarsen_fixed_number</a></div><div class="ttdeci">void refine_and_coarsen_fixed_number(Triangulation&lt; dim, spacedim &gt; &amp;triangulation, const Vector&lt; Number &gt; &amp;criteria, const double top_fraction_of_cells, const double bottom_fraction_of_cells, const unsigned int max_n_cells=std::numeric_limits&lt; unsigned int &gt;::max())</div><div class="ttdef"><b>Definition:</b> <a href="grid_2grid__refinement_8cc_source.html#l00322">grid_refinement.cc:322</a></div></div>
<div class="ttc" id="namespaceinternal_1_1p4est_html_a4b980c7b4b4d9984e93d73c7d30173ea"><div class="ttname"><a href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">internal::p4est::functions</a></div><div class="ttdeci">int(&amp;) functions(const void *v1, const void *v2)</div><div class="ttdef"><b>Definition:</b> <a href="p4est__wrappers_8cc_source.html#l00339">p4est_wrappers.cc:339</a></div></div>
<div class="ttc" id="namespaceWorkStream_1_1internal_1_1tbb__no__coloring_html_a8673698a405bf47aa24002aeb6d76d70"><div class="ttname"><a href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">WorkStream::internal::tbb_no_coloring::run</a></div><div class="ttdeci">void run(const Iterator &amp;begin, const typename identity&lt; Iterator &gt;::type &amp;end, Worker worker, Copier copier, const ScratchData &amp;sample_scratch_data, const CopyData &amp;sample_copy_data, const unsigned int queue_length, const unsigned int chunk_size)</div><div class="ttdef"><b>Definition:</b> <a href="work__stream_8h_source.html#l00562">work_stream.h:562</a></div></div>
<div class="ttc" id="classFEFaceValues_html"><div class="ttname"><a href="classFEFaceValues.html">FEFaceValues</a></div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2fe_2fe_8h_source.html#l00041">fe.h:41</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
