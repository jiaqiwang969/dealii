<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="canonical" href="https://www.dealii.org/current/doxygen/deal.II/include_2deal_8II-translator_2A-tutorial_2step-37_8h_source.html" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The deal.II Library: include/deal.II-translator/A-tutorial/step-37.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link rel="SHORTCUT ICON" href="deal.ico"></link>
<script type="text/javascript" src="custom.js"></script>
<meta name="author" content="The deal.II Authors <authors@dealii.org>"></meta>
<meta name="copyright" content="Copyright (C) 1998 - 2021 by the deal.II authors"></meta>
<meta name="deal.II-version" content="10.0.0-pre"></meta>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo200.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Reference documentation for deal.II version 10.0.0-pre</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!--Extra macros for MathJax:-->
<div style="display:none">
\(\newcommand{\dealvcentcolon}{\mathrel{\mathop{:}}}\)
\(\newcommand{\dealcoloneq}{\dealvcentcolon\mathrel{\mkern-1.2mu}=}\)
\(\newcommand{\jump}[1]{\left[\!\left[ #1 \right]\!\right]}\)
\(\newcommand{\average}[1]{\left\{\!\left\{ #1 \right\}\!\right\}}\)
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="dir_386d89ad50a3909c2af5a93b48d2c3ff.html">deal.II-translator</a></li><li class="navelem"><a class="el" href="dir_7812fe2bbb6fb6db2d3962cae8700ca0.html">A-tutorial</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">step-37.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="include_2deal_8II-translator_2A-tutorial_2step-37_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160; ) <span class="keyword">const</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;   {</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;     <span class="keywordflow">return</span> 1. / (0.05 + 2. p.square());</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;   }</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;* </div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160; </div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;* </div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;   <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;   <span class="keywordtype">double</span> Coefficient&lt;dim&gt;::value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p,</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                                  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component)<span class="keyword"> const</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="keyword">   </span>{</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;     <span class="keywordflow">return</span> value&lt;double&gt;(p, component);</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;   }</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;* </div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160; </div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;* </div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;Matrixfreeimplementation&quot;</span>&gt;&lt;/a&gt;  &lt;h3&gt;Matrix-<a class="code" href="namespaceUtilities_1_1CUDA.html#afc505a095cc4c7600f65ecb99851312e">free</a> implementation&lt;/h3&gt;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;* </div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;* </div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;*  The following <span class="keyword">class</span>, called   &lt;code&gt;LaplaceOperator&lt;/code&gt;  , implements the differential <span class="keyword">operator</span>. For all practical purposes, it is a <a class="code" href="namespaceLAPACKSupport.html#a1a9009db0d9a77923a7031b549b9b638a5bc7c54a9c20485772672825c6a73003">matrix</a>, i.e., you can ask it <span class="keywordflow">for</span> its size (member functions   &lt;code&gt;m(), n()&lt;/code&gt;  ) and you can <a class="code" href="namespacestd__cxx17.html#aa2fc1031c06af4aea4de90c5a1905473">apply</a> it to a vector (the   &lt;code&gt;vmult()&lt;/code&gt;   function). The difference to a real matrix of course lies in the fact that this class does not actually store the &lt;i&gt;elements&lt;/i&gt; of the matrix, but only knows how to compute the action of the operator when applied to a vector.   </div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;*   The infrastructure describing the matrix size, the initialization from a <a class="code" href="classMatrixFree.html">MatrixFree</a> <span class="keywordtype">object</span>, and the various interfaces to matrix-vector products through vmult() and Tvmult() methods, is provided by the class   MatrixFreeOperator::Base   from which this class derives. The LaplaceOperator class defined here only has to provide a few interfaces, namely the actual action of the operator through the apply_add() method that gets used in the vmult() <a class="code" href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">functions</a>, and a method to compute the <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86">diagonal</a> entries of the underlying matrix. We need the <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86">diagonal</a> for the definition of the multigrid smoother. Since we consider a problem with variable coefficient, we further implement a method that can fill the coefficient <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a>.   </div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;*   Note that the file   &lt;code&gt;include/deal.II/matrix_free/operators.h&lt;/code&gt;   already contains an implementation of the Laplacian through the class   <a class="code" href="namespaceMatrixFreeOperators.html">MatrixFreeOperators</a>::LaplaceOperator.   For educational purposes, the operator is re-implemented in this tutorial program, explaining the ingredients and concepts used there.   </div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;*   This program makes use of the data cache for finite element operator application that is integrated in deal.II. This data cache class is called <a class="code" href="classMatrixFree.html">MatrixFree</a>. It contains mapping information (Jacobians) and index relations between local and global degrees of freedom. It also contains constraints like the ones from hanging nodes or Dirichlet boundary conditions. Moreover, it can issue a <a class="code" href="group__MeshWorker.html#gad10f528ab87f39fbb0531d24f238b2f3">loop</a> over all cells in %<a class="code" href="namespaceparallel.html">parallel</a>, making sure that only cells are worked on that do not share any degree of freedom (this makes the <a class="code" href="group__MeshWorker.html#gad10f528ab87f39fbb0531d24f238b2f3">loop</a> thread-safe when writing into destination vectors). This is a more advanced strategy compared to the <a class="code" href="namespaceWorkStream.html">WorkStream</a> class described in the   @ref threads   module. Of course, to not destroy thread-safety, we have to be careful when writing into class-global structures.   </div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;*   The class implementing the Laplace operator has three template arguments, <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> for the dimension (as many deal.II classes carry), <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> for the degree of the finite element (which we need to enable efficient computations through the <a class="code" href="classFEEvaluation.html">FEEvaluation</a> class), and <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> for the underlying scalar type. We want to use   &lt;code&gt;<span class="keywordtype">double</span>&lt;/code&gt;   <a class="code" href="namespacenumbers.html">numbers</a> (i.<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>., <span class="keywordtype">double</span> precision, 64-bit floating <a class="code" href="namespaceOpenCASCADE.html#a9509efa83e3b2fa42616fe0623cba696">point</a>) for the final matrix, but floats (single precision, 32-bit floating <a class="code" href="namespaceOpenCASCADE.html#a9509efa83e3b2fa42616fe0623cba696">point</a> <a class="code" href="namespacenumbers.html">numbers</a>) for the multigrid <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> matrices (as that is only a preconditioner, and floats can be processed twice as fast). The class <a class="code" href="classFEEvaluation.html">FEEvaluation</a> also takes a template argument for the number of quadrature points in <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> dimension. In the code below, we hard-code it to   &lt;code&gt;fe_degree+1&lt;/code&gt;  . If we wanted to change it independently of the polynomial degree, we would need to add a template parameter as is done in the   <a class="code" href="namespaceMatrixFreeOperators.html">MatrixFreeOperators</a>::LaplaceOperator   class.   </div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;*   As a sidenote, if we implemented several different operations on the same grid and degrees of freedom (like a mass matrix and a Laplace matrix), we would define two classes like the current <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> for each of the operators (derived from the   <a class="code" href="namespaceMatrixFreeOperators.html">MatrixFreeOperators</a>::Base   class), and let both of them refer to the same <a class="code" href="classMatrixFree.html">MatrixFree</a> data cache from the <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98af25b68380698c53fa6da3e05379c0855">general</a> problem class. The interface through   <a class="code" href="namespaceMatrixFreeOperators.html">MatrixFreeOperators</a>::Base   requires us to only provide a minimal <a class="code" href="group__CUDAWrappers.html#gabb7130e2cea54654455ca41ef304f939">set</a> of functions. This concept allows for writing complex application codes with many matrix-<a class="code" href="namespaceUtilities_1_1CUDA.html#afc505a095cc4c7600f65ecb99851312e">free</a> operations.   </div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;*  </div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;* </div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;*   @note   Storing <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a> of type   &lt;code&gt;<a class="code" href="classVectorizedArray.html">VectorizedArray</a>&lt;number&gt;&lt;/code&gt;   requires care: Here, we use the deal.II table class which is prepared to hold the data with correct alignment. However, storing e.g. an   &lt;code&gt;<a class="code" href="namespacestd.html">std</a>::vector&lt;<a class="code" href="classVectorizedArray.html">VectorizedArray</a>&lt;number&gt; &gt;&lt;/code&gt;   is not possible with vectorization: <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a> certain alignment of the data with the memory address boundaries is required (essentially, a <a class="code" href="classVectorizedArray.html">VectorizedArray</a> that is 32 bytes <span class="keywordtype">long</span> in case of AVX needs to start at a memory address that is divisible by 32). The table class (as well as the <a class="code" href="classAlignedVector.html">AlignedVector</a> class it is based on) makes sure that this alignment is respected, whereas   <a class="code" href="namespacestd.html">std</a>::vector   does not in <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98af25b68380698c53fa6da3e05379c0855">general</a>, which may lead to segmentation faults at strange places for some systems or suboptimal performance for other systems.</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;* </div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;* </div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;* @code</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;   template &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, typename number&gt;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;   class LaplaceOperator</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;     : public <a class="code" href="namespaceMatrixFreeOperators.html">MatrixFreeOperators</a>::</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;         Base&lt;dim, <a class="code" href="namespaceLinearAlgebra.html">LinearAlgebra</a>::distributed::<a class="code" href="classVector.html">Vector</a>&lt;number&gt;&gt;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;   {</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;   <span class="keyword">public</span>:</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;     <span class="keyword">using</span> value_type = number;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;* </div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;     LaplaceOperator();</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;* </div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;     <span class="keywordtype">void</span> clear() <span class="keyword">override</span>;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;* </div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;     <span class="keywordtype">void</span> evaluate_coefficient(<span class="keyword">const</span> Coefficient&lt;dim&gt; &amp;coefficient_function);</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;* </div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">compute_diagonal</a>() <span class="keyword">override</span>;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;* </div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;   <span class="keyword">private</span>:</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;     <span class="keyword">virtual</span> <span class="keywordtype">void</span> apply_add(</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;       <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      dst,</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;       <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src) <span class="keyword">const override</span>;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;* </div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;     <span class="keywordtype">void</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;     local_apply(<span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, number&gt;</a> &amp;                   data,</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                 <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      dst,</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                 <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src,</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                 <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;cell_range) <span class="keyword">const</span>;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;* </div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;     <span class="keywordtype">void</span> local_compute_diagonal(</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;       <span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, number&gt;</a> &amp;              data,</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;       <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp; dst,</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;                         dummy,</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;       <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;cell_range) <span class="keyword">const</span>;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;* </div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;     <a class="code" href="classTable.html">Table&lt;2, VectorizedArray&lt;number&gt;</a>&gt; coefficient;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;   };</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;* </div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160; </div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;* </div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;* </div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;*  This is the constructor of the   @p LaplaceOperator   <span class="keyword">class</span>. All it does is to <a class="code" href="namespaceThreads_1_1internal.html#a8d237a30d09b13e0b5adbe0fd1dfb188">call</a> the <span class="keywordflow">default</span> constructor of the base <span class="keyword">class   </span><a class="code" href="classMatrixFreeOperators_1_1Base.html">MatrixFreeOperators::Base</a>,   which in turn is based on the <a class="code" href="classSubscriptor.html">Subscriptor</a> class that asserts that this class is not accessed after going out of scope <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>.g. in a preconditioner.</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;* </div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;* </div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;* @code</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;   <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;   <a class="code" href="classMatrixFreeOperators_1_1LaplaceOperator.html#a333615858395e4c73be651f22b46f910">LaplaceOperator&lt;dim, fe_degree, number&gt;::LaplaceOperator</a>()</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;     : <a class="code" href="namespaceMatrixFreeOperators.html">MatrixFreeOperators</a>::<a class="code" href="classMatrixFreeOperators_1_1Base.html#a10f5ef7a9f7c90c973d9ddf18d05a21a">Base</a>&lt;dim,</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                                 <a class="code" href="namespaceLinearAlgebra.html">LinearAlgebra</a>::distributed::<a class="code" href="classVector.html">Vector</a>&lt;number&gt;&gt;()</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;   {}</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;* </div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160; </div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;* </div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;   <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;   <span class="keywordtype">void</span> <a class="code" href="classMatrixFreeOperators_1_1LaplaceOperator.html#afb746cb7df623be9c68536ca208bd48a">LaplaceOperator&lt;dim, fe_degree, number&gt;::clear</a>()</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;   {</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;     coefficient.reinit(0, 0);</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;     <a class="code" href="classMatrixFreeOperators_1_1Base.html">MatrixFreeOperators::Base&lt;dim, LinearAlgebra::distributed::Vector&lt;number&gt;</a>&gt;<a class="code" href="classMatrixFreeOperators_1_1Base.html#a7a36adee9e3c0ad068afbeed9b0018ce">::</a></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<a class="code" href="classMatrixFreeOperators_1_1Base.html#a7a36adee9e3c0ad068afbeed9b0018ce">       clear</a>();</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;   }</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;* </div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160; </div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;* </div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;* </div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;Computationofcoefficient&quot;</span>&gt;&lt;/a&gt;  &lt;h4&gt;Computation of coefficient&lt;/h4&gt;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;* </div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;* </div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;*  To <a class="code" href="classMatrixFreeOperators_1_1Base.html#ae323450bcbd9e05509cdbf7c4f50f435">initialize</a> the coefficient, we directly give it the Coefficient <span class="keyword">class </span>defined above and then select the method   &lt;code&gt;coefficient_function.<a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a>&lt;/code&gt;   with vectorized number (which the compiler can deduce from the <a class="code" href="namespaceOpenCASCADE.html#a9509efa83e3b2fa42616fe0623cba696">point</a> data type). The use of the <a class="code" href="classFEEvaluation.html">FEEvaluation</a> class (and its template arguments) will be explained below.</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;* </div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;* </div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;* @code</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;   <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;   <span class="keywordtype">void</span> LaplaceOperator&lt;dim, fe_degree, number&gt;::evaluate_coefficient(</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;     <span class="keyword">const</span> Coefficient&lt;dim&gt; &amp;coefficient_function)</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;   {</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a> = this-&gt;data-&gt;n_cell_batches();</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;     <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, fe_degree, fe_degree + 1, 1, number&gt;</a> phi(*this-&gt;data);</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;* </div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;     coefficient.reinit(n_cells, phi.n_q_points);</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = 0; cell &lt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>; ++cell)</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;       {</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;         phi.reinit(cell);</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;           coefficient(cell, q) =</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;             coefficient_function.value(phi.quadrature_point(q));</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;       }</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;   }</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;* </div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160; </div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;* </div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;* </div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;LocalevaluationofLaplaceoperator&quot;</span>&gt;&lt;/a&gt;  &lt;h4&gt;Local evaluation of Laplace <span class="keyword">operator</span>&lt;/h4&gt;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;* </div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;* </div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;*  Here comes the main <span class="keyword">function</span> of <span class="keyword">this</span> <span class="keyword">class</span>, the evaluation of the matrix-vector product (or, in <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98af25b68380698c53fa6da3e05379c0855">general</a>, a finite element <span class="keyword">operator</span> evaluation). This is done in a <span class="keyword">function</span> that takes exactly four arguments, the <a class="code" href="classMatrixFree.html">MatrixFree</a> object, the destination and source vectors, and a range of cells that are to be worked on. The method   &lt;code&gt;cell_loop&lt;/code&gt;   in the <a class="code" href="classMatrixFree.html">MatrixFree</a> <span class="keyword">class </span>will internally <a class="code" href="namespaceThreads_1_1internal.html#a8d237a30d09b13e0b5adbe0fd1dfb188">call</a> this function with some range of cells that is obtained by checking which cells are possible to work on simultaneously so that write operations do not cause any race condition. Note that the cell range used in the <a class="code" href="group__MeshWorker.html#gad10f528ab87f39fbb0531d24f238b2f3">loop</a> is not directly the number of (active) cells in the current mesh, but rather a collection of batches of cells.  In other word, &quot;cell&quot; may be the wrong term to <a class="code" href="namespaceTrilinosWrappers_1_1internal.html#ad88a9499e01173b35d78413e5945e020">begin</a> with, since <a class="code" href="classFEEvaluation.html">FEEvaluation</a> groups data from several cells together. This means that in the <a class="code" href="group__MeshWorker.html#gad10f528ab87f39fbb0531d24f238b2f3">loop</a> over quadrature points we are actually seeing a group of quadrature points of several cells as <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> block. This is done to enable a higher degree of vectorization.  The number of such &quot;cells&quot; or &quot;cell batches&quot; is stored in <a class="code" href="classMatrixFree.html">MatrixFree</a> and can be queried through   <a class="code" href="classMatrixFree.html">MatrixFree</a>::n_cell_batches().   Compared to the deal.II cell iterators, in this class all cells are laid out in a plain array with no direct knowledge of <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> or neighborship relations, which makes it possible to index the cells by unsigned integers.   </div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;*   The implementation of the Laplace operator is quite simple: First, we need to create an object <a class="code" href="classFEEvaluation.html">FEEvaluation</a> that contains the computational kernels and has data fields to store temporary results (e.g. gradients evaluated on all quadrature points on a collection of a few cells). Note that temporary results do not use a lot of memory, and since we specify template arguments with the element order, the data is stored on the stack (without expensive memory allocation). Usually, <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> only needs to <a class="code" href="group__CUDAWrappers.html#gabb7130e2cea54654455ca41ef304f939">set</a> two template arguments, the dimension as a <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> argument and the degree of the finite element as the <a class="code" href="grid__out_8cc.html#a2cc229a4f1ffc75e83ed269d5f725729">second</a> argument (this is equal to the number of degrees of freedom per dimension minus one for FE_Q elements). However, here we also want to be able to use float <a class="code" href="namespacenumbers.html">numbers</a> for the multigrid preconditioner, which is the last (fifth) template argument. Therefore, we cannot rely on the default template arguments and must also fill the third and fourth field, consequently. The third argument specifies the number of quadrature points per direction and has a default <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a> <a class="code" href="vectorization_8h.html#a31b02447b71a04a1ec9bdd1358751e45a465289687a70db7aa7217cc240c29f0f">equal</a> to the degree of the element plus <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a>. The fourth argument sets the number of components (one can also evaluate vector-valued functions in systems of PDEs, but the default is a scalar element), and finally the last argument sets the number type.   </div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;*   Next, we <a class="code" href="group__MeshWorker.html#gad10f528ab87f39fbb0531d24f238b2f3">loop</a> over the given cell range and then we continue with the actual implementation:   &lt;ol&gt;     &lt;li&gt;  Tell the <a class="code" href="classFEEvaluation.html">FEEvaluation</a> object the (macro) cell we want to work on.    &lt;li&gt;  Read in the <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a> of the source vectors (  @p read_dof_values),   including the resolution of constraints. This stores   @f$u_\mathrm{cell}@f$   as described in the introduction.    &lt;li&gt;  Compute the unit-cell <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaae2b6dfb8a5c48206992d8310d176c37c">gradient</a> (the evaluation of finite element <a class="code" href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">functions</a>). Since <a class="code" href="classFEEvaluation.html">FEEvaluation</a> can combine <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a> computations with <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaae2b6dfb8a5c48206992d8310d176c37c">gradient</a> computations, it uses a unified <span class="keyword">interface </span>to all kinds of derivatives of order between <a class="code" href="namespaceLAPACKSupport.html#a0d8802698d585eec62a2a54e6387b05b">zero</a> and two. We only want <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aea91b5f00e4be473005cc331b8644ab2f1">gradients</a>, no <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a> and no <a class="code" href="grid__out_8cc.html#a2cc229a4f1ffc75e83ed269d5f725729">second</a> derivatives, so we <a class="code" href="group__CUDAWrappers.html#gabb7130e2cea54654455ca41ef304f939">set</a> the function arguments to true in the <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaae2b6dfb8a5c48206992d8310d176c37c">gradient</a> slot (<a class="code" href="grid__out_8cc.html#a2cc229a4f1ffc75e83ed269d5f725729">second</a> slot), and to false in the <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a> slot (<a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> slot). There is also a third slot for the Hessian which is false by default, so it needs not be given. Note that the <a class="code" href="classFEEvaluation.html">FEEvaluation</a> class internally evaluates shape <a class="code" href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">functions</a> in an efficient way where <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> dimension is worked on at a time (using the tensor product form of shape <a class="code" href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">functions</a> and quadrature points as mentioned in the introduction). This gives complexity <a class="code" href="vectorization_8h.html#a31b02447b71a04a1ec9bdd1358751e45a465289687a70db7aa7217cc240c29f0f">equal</a> to   @f$\mathcal <a class="code" href="namespaceLAPACKSupport.html#ae4c4142bb80d7e6e5214c37fac73e1da">O</a>(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>^2 (p+1)^{<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>+1})@f$   <span class="keywordflow">for</span> polynomial degree   @f$p@f$   in   @f$d@f$   dimensions, compared to the naive approach with loops over all local degrees of freedom and quadrature points that is used in <a class="code" href="classFEValues.html">FEValues</a> and costs   @f$\mathcal <a class="code" href="namespaceLAPACKSupport.html#ae4c4142bb80d7e6e5214c37fac73e1da">O</a>(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> (p+1)^{2<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>})@f$  .    &lt;li&gt;  Next comes the application of the Jacobian transformation, the multiplication by the variable coefficient and the quadrature weight. <a class="code" href="classFEEvaluation.html">FEEvaluation</a> has an access <span class="keyword">function</span>   @p get_gradient   that applies the Jacobian and returns the gradient in real space. Then, we just need to multiply by the (scalar) coefficient, and let the <span class="keyword">function</span>   @p submit_gradient   <a class="code" href="namespacestd__cxx17.html#aa2fc1031c06af4aea4de90c5a1905473">apply</a> the <a class="code" href="grid__out_8cc.html#a2cc229a4f1ffc75e83ed269d5f725729">second</a> Jacobian (<span class="keywordflow">for</span> the test <span class="keyword">function</span>) and the quadrature weight and Jacobian <a class="code" href="symmetric__tensor_8h.html#a31fa20712aae4f3b8ab9f62729b464d3">determinant</a> (JxW). Note that the submitted <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaae2b6dfb8a5c48206992d8310d176c37c">gradient</a> is stored in the same data field as where it is read from in   @p get_gradient.   Therefore, you need to make sure to not read from the same quadrature <a class="code" href="namespaceOpenCASCADE.html#a9509efa83e3b2fa42616fe0623cba696">point</a> again after having called   @p submit_gradient   on that particular quadrature <a class="code" href="namespaceOpenCASCADE.html#a9509efa83e3b2fa42616fe0623cba696">point</a>. In <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98af25b68380698c53fa6da3e05379c0855">general</a>, it is a good idea to <a class="code" href="namespaceinternal_1_1VectorOperations.html#a40c8daa0881cff0123fbaeb08929f5cb">copy</a> the result of   @p get_gradient   when it is used more often than once.    &lt;li&gt;  Next follows the summation over quadrature points <span class="keywordflow">for</span> all test <a class="code" href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">functions</a> that corresponds to the actual integration step. For the Laplace <span class="keyword">operator</span>, we just multiply by the <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaae2b6dfb8a5c48206992d8310d176c37c">gradient</a>, so we <a class="code" href="namespaceThreads_1_1internal.html#a8d237a30d09b13e0b5adbe0fd1dfb188">call</a> the integrate <span class="keyword">function</span> with the respective argument <span class="keyword">set</span>. If you have an equation where you test by both the <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a> of the test <a class="code" href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">functions</a> and the <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aea91b5f00e4be473005cc331b8644ab2f1">gradients</a>, both <span class="keyword">template</span> arguments need to be <span class="keyword">set</span> to <span class="keyword">true</span>. Calling <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> the integrate <span class="keyword">function</span> <span class="keywordflow">for</span> <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a> and then gradients in a separate <a class="code" href="namespaceThreads_1_1internal.html#a8d237a30d09b13e0b5adbe0fd1dfb188">call</a> leads to wrong results, since the <a class="code" href="grid__out_8cc.html#a2cc229a4f1ffc75e83ed269d5f725729">second</a> <a class="code" href="namespaceThreads_1_1internal.html#a8d237a30d09b13e0b5adbe0fd1dfb188">call</a> will internally overwrite the results from the <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> <a class="code" href="namespaceThreads_1_1internal.html#a8d237a30d09b13e0b5adbe0fd1dfb188">call</a>. Note that there is no <span class="keyword">function</span> argument <span class="keywordflow">for</span> the <a class="code" href="grid__out_8cc.html#a2cc229a4f1ffc75e83ed269d5f725729">second</a> derivative <span class="keywordflow">for</span> integrate step.    &lt;li&gt;  Eventually, the local contributions in the vector   @f$v_\mathrm{cell}@f$   as mentioned in the introduction need to be added into the result vector (and constraints are applied). This is done with a <a class="code" href="namespaceThreads_1_1internal.html#a8d237a30d09b13e0b5adbe0fd1dfb188">call</a> to   @p distribute_local_to_global,   the same name as the corresponding <span class="keyword">function</span> in the <a class="code" href="classAffineConstraints.html">AffineConstraints</a> (only that we now store the local vector in the <a class="code" href="classFEEvaluation.html">FEEvaluation</a> <span class="keywordtype">object</span>, as are the indices between local and global degrees of freedom).    &lt;/ol&gt;  </div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;* </div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;* </div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;* @code</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;   <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;   <span class="keywordtype">void</span> LaplaceOperator&lt;dim, fe_degree, number&gt;::local_apply(</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;     <span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, number&gt;</a> &amp;                   data,</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;     <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      dst,</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;     <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src,</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;     <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;     cell_range)<span class="keyword"> const</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="keyword">   </span>{</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;     <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, fe_degree, fe_degree + 1, 1, number&gt;</a> phi(data);</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;* </div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = cell_range.first; cell &lt; cell_range.second; ++cell)</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;       {</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;         <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(coefficient.size(0), data.<a class="code" href="classMatrixFree.html#a8c9d964339b466bdcb661552e731e222">n_cell_batches</a>());</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;         <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(coefficient.size(1), phi.n_q_points);</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;* </div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;         phi.reinit(cell);</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;         phi.read_dof_values(src);</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;         phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aea91b5f00e4be473005cc331b8644ab2f1">EvaluationFlags::gradients</a>);</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;           phi.submit_gradient(coefficient(cell, q) phi.get_gradient(q), q);</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;         phi.integrate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aea91b5f00e4be473005cc331b8644ab2f1">EvaluationFlags::gradients</a>);</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;         phi.distribute_local_to_global(dst);</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;       }</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;   }</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;* </div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160; </div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;* </div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;* </div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;*  This <span class="keyword">function</span> implements the <a class="code" href="group__MeshWorker.html#gad10f528ab87f39fbb0531d24f238b2f3">loop</a> over all cells <span class="keywordflow">for</span> the   Base::apply_add()   interface. This is done with the   @p cell_loop   of the <a class="code" href="classMatrixFree.html">MatrixFree</a> class, which takes the operator() of this class with arguments <a class="code" href="classMatrixFree.html">MatrixFree</a>, OutVector, InVector, cell_range. When working with MPI parallelization (but no threading) as is done in this tutorial program, the cell <a class="code" href="group__MeshWorker.html#gad10f528ab87f39fbb0531d24f238b2f3">loop</a> corresponds to the following three lines of code:   </div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;*     &lt;div class=CodeFragmentInTutorialComment&gt;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;* </div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;* </div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;@code</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160; src.update_ghost_values();</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160; local_apply(*this-&gt;data, dst, src, <a class="code" href="namespacestd.html">std</a>::make_pair(0<a class="code" href="namespaceLAPACKSupport.html#a3e681d2d74dcf90f6556706d66f81a0d">U</a>,</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                                                   data.n_cell_batches()));</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160; dst.<a class="code" href="namespaceUtilities.html#a6155277fd058eddb1504f9562cb1c04d">compress</a>(<a class="code" href="structVectorOperation.html">VectorOperation</a>::add);</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160; @endcode</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;* </div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160; &lt;/div&gt;     </div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;*   Here, the two calls update_ghost_values() and <a class="code" href="namespaceUtilities.html#a6155277fd058eddb1504f9562cb1c04d">compress</a>() perform the data exchange on processor boundaries for MPI, once for the source vector where we need to read from entries owned by remote processors, and once for the destination vector where we have accumulated parts of the residuals that need to be added to the respective entry of the owner processor. However,   MatrixFree::cell_loop   does not only abstract away those two calls, but also performs some additional optimizations. On the <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> hand, it will <a class="code" href="namespaceAdaptationStrategies_1_1Refinement.html#a0fda1b577bf969eb15b3992120d682a3">split</a> the update_ghost_values() and <a class="code" href="namespaceUtilities.html#a6155277fd058eddb1504f9562cb1c04d">compress</a>() calls in a way to allow for overlapping communication and computation. The local_apply function is then called with three cell ranges representing partitions of the cell range from 0 to   MatrixFree::n_cell_batches().   On the other hand, cell_loop also supports thread parallelism in which case the cell ranges are <a class="code" href="namespaceAdaptationStrategies_1_1Refinement.html#a0fda1b577bf969eb15b3992120d682a3">split</a> into smaller chunks and scheduled in an advanced way that avoids access to the same vector entry by several threads. That feature is explained in   @ref step_48 &quot;step-48&quot;  .   </div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;*   Note that after the cell <a class="code" href="group__MeshWorker.html#gad10f528ab87f39fbb0531d24f238b2f3">loop</a>, the constrained degrees of freedom need to be touched once more for sensible vmult() operators: Since the assembly loop automatically resolves constraints (just as the   <a class="code" href="classAffineConstraints.html">AffineConstraints</a>::distribute_local_to_global()   <a class="code" href="namespaceThreads_1_1internal.html#a8d237a30d09b13e0b5adbe0fd1dfb188">call</a> does), it does not compute any contribution for constrained degrees of freedom, leaving the respective entries <a class="code" href="namespaceLAPACKSupport.html#a0d8802698d585eec62a2a54e6387b05b">zero</a>. This would represent a matrix that had empty rows and columns for constrained degrees of freedom. However, iterative solvers like CG only work for non-singular matrices. The easiest way to do that is to <a class="code" href="group__CUDAWrappers.html#gabb7130e2cea54654455ca41ef304f939">set</a> the sub-block of the matrix that corresponds to constrained DoFs to an <a class="code" href="structidentity.html">identity</a> matrix, in which case application of the matrix would simply <a class="code" href="namespaceinternal_1_1VectorOperations.html#a40c8daa0881cff0123fbaeb08929f5cb">copy</a> the elements of the right hand side vector into the left hand side. Fortunately, the vmult() implementations   <a class="code" href="namespaceMatrixFreeOperators.html">MatrixFreeOperators</a>::Base   do this automatically for us outside the apply_add() function, so we do not need to take further action here.   </div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;*   When using the combination of MatrixFree and <a class="code" href="classFEEvaluation.html">FEEvaluation</a> in <a class="code" href="namespaceparallel.html">parallel</a> with MPI, there is <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> aspect to be careful about &amp;mdash; the indexing used for accessing the vector. For performance reasons, MatrixFree and <a class="code" href="classFEEvaluation.html">FEEvaluation</a> are designed to access vectors in MPI-local index space also when working with multiple processors. Working in local index space means that no index <a class="code" href="namespaceCellSimilarity.html#abbf8aa4eab099bd2356cb51200494c13a4f8507015c458575753e0a45e0c3544a">translation</a> needs to be performed at the place the vector access happens, apart from the unavoidable indirect addressing. However, local index spaces are ambiguous: While it is standard convention to access the locally owned range of a vector with indices between 0 and the local size, the numbering is not so clear for the ghosted entries and somewhat arbitrary. For the matrix-vector product, only the indices appearing on locally owned cells (plus those referenced via hanging node constraints) are necessary. However, in deal.II we often <a class="code" href="group__CUDAWrappers.html#gabb7130e2cea54654455ca41ef304f939">set</a> all the degrees of freedom on ghosted elements as ghosted vector entries, called the   @ref GlossLocallyRelevantDof   &quot;locally relevant DoFs described in the glossary&quot;. In that case, the MPI-local index of a ghosted vector entry can in general be different in the two possible ghost sets, despite referring to the same global index. To avoid problems, <a class="code" href="classFEEvaluation.html">FEEvaluation</a> checks that the partitioning of the vector used for the matrix-vector product does indeed match with the partitioning of the indices in MatrixFree by a check called   <a class="code" href="namespaceLinearAlgebra.html">LinearAlgebra</a>::distributed::<a class="code" href="classVector.html">Vector</a>::partitioners_are_compatible.   To facilitate things, the   <a class="code" href="namespaceMatrixFreeOperators.html">MatrixFreeOperators</a>::Base   class includes a mechanism to fit the ghost <a class="code" href="group__CUDAWrappers.html#gabb7130e2cea54654455ca41ef304f939">set</a> to the correct layout. This happens in the ghost region of the vector, so keep in mind that the ghost region might be modified in both the destination and source vector after a <a class="code" href="namespaceThreads_1_1internal.html#a8d237a30d09b13e0b5adbe0fd1dfb188">call</a> to a vmult() method. This is legitimate because the ghost region of a distributed deal.II vector is a mutable section and filled on demand. Vectors used in matrix-vector products must not be ghosted upon entry of vmult() <a class="code" href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">functions</a>, so no information gets lost.</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;* </div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;* </div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;* @code</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;   template &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, typename number&gt;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;   <span class="keywordtype">void</span> LaplaceOperator&lt;dim, fe_degree, number&gt;::apply_add(</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;     <a class="code" href="namespaceLinearAlgebra.html">LinearAlgebra</a>::distributed::<a class="code" href="classVector.html">Vector</a>&lt;number&gt; &amp;      dst,</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;     const <a class="code" href="namespaceLinearAlgebra.html">LinearAlgebra</a>::distributed::<a class="code" href="classVector.html">Vector</a>&lt;number&gt; &amp;src)<span class="keyword"> const</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="keyword">   </span>{</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;     this-&gt;data-&gt;cell_loop(&amp;LaplaceOperator::local_apply, <span class="keyword">this</span>, dst, src);</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;   }</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;* </div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160; </div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;* </div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;* </div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;*  The following <span class="keyword">function</span> implements the computation of the <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86">diagonal</a> of the <span class="keyword">operator</span>. Computing matrix entries of a matrix-<a class="code" href="namespaceUtilities_1_1CUDA.html#afc505a095cc4c7600f65ecb99851312e">free</a> <span class="keyword">operator</span> evaluation turns out to be more complicated than evaluating the <span class="keyword">operator</span>. Fundamentally, we could obtain a matrix representation of the <span class="keyword">operator</span> by applying the <span class="keyword">operator</span> on &lt;i&gt;all&lt;/i&gt; unit vectors. Of course, that would be very inefficient since we would need to perform &lt;i&gt;n&lt;/i&gt; <span class="keyword">operator</span> evaluations to retrieve the whole matrix. Furthermore, <span class="keyword">this</span> approach would completely ignore the matrix sparsity. On an individual cell, however, <span class="keyword">this</span> is the way to go and actually not that inefficient as there usually is a coupling between all degrees of freedom inside the cell.   </div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;*   We <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> initialize the <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86">diagonal</a> vector to the correct <a class="code" href="namespaceparallel.html">parallel</a> layout. This vector is encapsulated in a member called inverse_diagonal_entries of type <a class="code" href="classDiagonalMatrix.html">DiagonalMatrix</a> in the base <span class="keyword">class   </span><a class="code" href="classMatrixFreeOperators_1_1Base.html">MatrixFreeOperators::Base</a>.   This member is a shared pointer that we <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> need to <a class="code" href="classMatrixFreeOperators_1_1Base.html#ae323450bcbd9e05509cdbf7c4f50f435">initialize</a> and then get the vector representing the <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86">diagonal</a> entries in the matrix. As to the actual <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86">diagonal</a> computation, we again use the cell_loop infrastructure of MatrixFree to invoke a local worker routine called local_compute_diagonal(). Since we will only write into a vector but not have any source vector, we put a dummy argument of type &lt;tt&gt;unsigned <a class="code" href="classint.html">int</a>&lt;/tt&gt; in place of the source vector to confirm with the cell_loop interface. After the loop, we need to <a class="code" href="group__CUDAWrappers.html#gabb7130e2cea54654455ca41ef304f939">set</a> the vector entries subject to Dirichlet boundary conditions to <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> (either those on the boundary described by the <a class="code" href="classAffineConstraints.html">AffineConstraints</a> object inside MatrixFree or the indices at the interface between different grid levels in adaptive multigrid). This is done through the function   <a class="code" href="namespaceMatrixFreeOperators.html">MatrixFreeOperators</a>::<a class="code" href="classMatrixFreeOperators_1_1Base.html#a11ff9854b4433dc8a7795d1c117de2c3">Base::set_constrained_entries_to_one</a>()   and matches with the setting in the matrix-vector product provided by the <a class="code" href="classMatrixFreeOperators_1_1Base.html#a10f5ef7a9f7c90c973d9ddf18d05a21a">Base</a> operator. Finally, we need to <a class="code" href="symmetric__tensor_8h.html#a3656e2f6095f612536b06139a6a2ca39">invert</a> the <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86">diagonal</a> entries which is the form required by the Chebyshev smoother based on the Jacobi iteration. In the loop, we assert that all entries are non-<a class="code" href="namespaceLAPACKSupport.html#a0d8802698d585eec62a2a54e6387b05b">zero</a>, because they should either have obtained a positive contribution from integrals or be constrained and treated by   @p <a class="code" href="classMatrixFreeOperators_1_1Base.html#a11ff9854b4433dc8a7795d1c117de2c3">set_constrained_entries_to_one</a>()   following cell_loop.</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;* </div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;* </div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;* @code</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;   template &lt;int dim, int fe_degree, typename number&gt;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;   void LaplaceOperator&lt;dim, fe_degree, number&gt;<a class="code" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">::compute_diagonal</a>()</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;   {</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;     this-&gt;inverse_diagonal_entries.reset(</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;       <span class="keyword">new</span> <a class="code" href="classDiagonalMatrix.html">DiagonalMatrix</a>&lt;<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a>&gt;());</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;     <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;inverse_diagonal =</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;       this-&gt;inverse_diagonal_entries-&gt;get_vector();</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;     this-&gt;data-&gt;initialize_dof_vector(inverse_diagonal);</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dummy = 0;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;     this-&gt;data-&gt;cell_loop(&amp;LaplaceOperator::local_compute_diagonal,</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                           <span class="keyword">this</span>,</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                           inverse_diagonal,</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                           dummy);</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;* </div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;     this-&gt;set_constrained_entries_to_one(inverse_diagonal);</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;* </div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; inverse_diagonal.<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html#a3db2bea96180138f039b9d2934534492">locally_owned_size</a>(); ++i)</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;       {</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;         <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(inverse_diagonal.<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html#a1c4bc946b94f19d7e11c00f41a39db02">local_element</a>(i) &gt; 0.,</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;No diagonal entry in a positive definite operator &quot;</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                           <span class="stringliteral">&quot;should be zero&quot;</span>));</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;         inverse_diagonal.<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html#a1c4bc946b94f19d7e11c00f41a39db02">local_element</a>(i) =</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;           1. / inverse_diagonal.<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html#a1c4bc946b94f19d7e11c00f41a39db02">local_element</a>(i);</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;       }</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;   }</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;* </div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160; </div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;* </div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;* </div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;*  In the local compute <a class="code" href="group__MeshWorker.html#gad10f528ab87f39fbb0531d24f238b2f3">loop</a>, we compute the <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86">diagonal</a> by a loop over all columns in the local matrix and putting the entry 1 in the &lt;i&gt;i&lt;/i&gt;th slot and a <a class="code" href="namespaceLAPACKSupport.html#a0d8802698d585eec62a2a54e6387b05b">zero</a> entry in all other slots, i.e., we <a class="code" href="namespacestd__cxx17.html#aa2fc1031c06af4aea4de90c5a1905473">apply</a> the cell-wise differential <span class="keyword">operator</span> on <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> unit vector at a time. The inner part invoking   <a class="code" href="classFEEvaluation.html#a710c252e9dccc0c4ce07044cac3bdd9b">FEEvaluation::evaluate</a>,   the loop over quadrature points, and   FEEvalution::integrate,   is exactly the same as in the local_apply <span class="keyword">function</span>. Afterwards, we pick out the &lt;i&gt;i&lt;/i&gt;th entry of the local result and put it to a temporary storage (as we overwrite all entries in the array behind   <a class="code" href="classFEEvaluationBase.html#a0660b27a2a592994dfd2fc917305a3ac">FEEvaluation::get_dof_value</a>()   with the next loop iteration). Finally, the temporary storage is written to the destination vector. Note how we use   <a class="code" href="classFEEvaluationBase.html#a0660b27a2a592994dfd2fc917305a3ac">FEEvaluation::get_dof_value</a>()   and   <a class="code" href="classFEEvaluation.html">FEEvaluation</a>::submit_dof_value()   to read and write to the data field that <a class="code" href="classFEEvaluation.html">FEEvaluation</a> uses for the integration on the <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> hand and writes into the global vector on the other hand.   </div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;*   Given that we are only interested in the matrix <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86">diagonal</a>, we simply throw away all other entries of the local matrix that have been computed along the way. While it might seem wasteful to compute the complete cell matrix and then throw away everything but the diagonal, the integration are so efficient that the computation does not take too much time. Note that the complexity of operator evaluation per element is   @f$\mathcal</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160; <a class="code" href="namespaceLAPACKSupport.html#ae4c4142bb80d7e6e5214c37fac73e1da">O</a>((p+1)^{<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>+1})@f$   <span class="keywordflow">for</span> polynomial degree   @f$k@f$  , so computing the whole matrix costs us   @f$\mathcal <a class="code" href="namespaceLAPACKSupport.html#ae4c4142bb80d7e6e5214c37fac73e1da">O</a>((p+1)^{2<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>+1})@f$   operations, not too far away from   @f$\mathcal <a class="code" href="namespaceLAPACKSupport.html#ae4c4142bb80d7e6e5214c37fac73e1da">O</a>((p+1)^{2<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>})@f$   complexity <span class="keywordflow">for</span> computing the <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86">diagonal</a> with <a class="code" href="classFEValues.html">FEValues</a>. Since <a class="code" href="classFEEvaluation.html">FEEvaluation</a> is also considerably faster due to vectorization and other optimizations, the <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86">diagonal</a> computation with <span class="keyword">this</span> <span class="keyword">function</span> is actually the fastest (simple) variant. (It would be possible to compute the <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86">diagonal</a> with <a class="code" href="namespaceUtilities_1_1MPI.html#ab544a3bf3301a6dd3e705ee352c5551b">sum</a> factorization techniques in   @f$\mathcal</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160; <a class="code" href="namespaceLAPACKSupport.html#ae4c4142bb80d7e6e5214c37fac73e1da">O</a>((p+1)^{<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>+1})@f$   operations involving specifically adapted kernels&amp;mdash;but since such kernels are only useful in that particular context and the <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86">diagonal</a> computation is typically not on the critical path, they have not been implemented in deal.II.)   </div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;*   Note that the code that calls distribute_local_to_global on the vector to accumulate the <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86">diagonal</a> entries into the global matrix has some limitations. For operators with hanging node constraints that distribute an integral contribution of a constrained DoF to several other entries inside the distribute_local_to_global <a class="code" href="namespaceThreads_1_1internal.html#a8d237a30d09b13e0b5adbe0fd1dfb188">call</a>, the vector <span class="keyword">interface </span>used here does not exactly compute the <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86">diagonal</a> entries, but lumps some contributions located on the <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86">diagonal</a> of the local matrix that would <a class="code" href="namespaceTrilinosWrappers_1_1internal.html#aee42c8e3004e2e81eac3c3356d3ec46b">end</a> up in a off-<a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86">diagonal</a> position of the global matrix to the <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86">diagonal</a>. The result is correct up to discretization accuracy as explained in &lt;a</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160; href=<span class="stringliteral">&quot;http://dx.doi.org/10.4208/cicp.101214.021015a&quot;</span>&gt;Kormann (2016),</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160; section 5.3&lt;/a&gt;, but not mathematically <a class="code" href="vectorization_8h.html#a31b02447b71a04a1ec9bdd1358751e45a465289687a70db7aa7217cc240c29f0f">equal</a>. In <span class="keyword">this</span> tutorial program, no harm can happen because the <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86">diagonal</a> is only used <span class="keywordflow">for</span> the multigrid <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> matrices where no hanging node constraints appear.</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;* </div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;* </div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;* @code</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;   <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;   <span class="keywordtype">void</span> LaplaceOperator&lt;dim, fe_degree, number&gt;::local_compute_diagonal(</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;     <span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, number&gt;</a> &amp;             data,</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;     <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;dst,</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;,</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;     <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;cell_range)<span class="keyword"> const</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="keyword">   </span>{</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;     <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, fe_degree, fe_degree + 1, 1, number&gt;</a> phi(data);</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;* </div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;     <a class="code" href="classAlignedVector.html">AlignedVector&lt;VectorizedArray&lt;number&gt;</a>&gt; <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86">diagonal</a>(phi.dofs_per_cell);</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;* </div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = cell_range.first; cell &lt; cell_range.second; ++cell)</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;       {</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;         <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(coefficient.size(0), data.<a class="code" href="classMatrixFree.html#a8c9d964339b466bdcb661552e731e222">n_cell_batches</a>());</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;         <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(coefficient.size(1), phi.n_q_points);</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;* </div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;         phi.reinit(cell);</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; phi.dofs_per_cell; ++i)</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;           {</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; phi.dofs_per_cell; ++j)</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;               phi.submit_dof_value(<a class="code" href="classVectorizedArray.html">VectorizedArray&lt;number&gt;</a>(), j);</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;             phi.submit_dof_value(make_vectorized_array&lt;number&gt;(1.), i);</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;* </div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;             phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aea91b5f00e4be473005cc331b8644ab2f1">EvaluationFlags::gradients</a>);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;               phi.submit_gradient(coefficient(cell, q) phi.get_gradient(q),</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                                   q);</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;             phi.integrate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aea91b5f00e4be473005cc331b8644ab2f1">EvaluationFlags::gradients</a>);</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;             <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86">diagonal</a>[i] = phi.get_dof_value(i);</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;           }</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; phi.dofs_per_cell; ++i)</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;           phi.submit_dof_value(<a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86">diagonal</a>[i], i);</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;         phi.distribute_local_to_global(dst);</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;       }</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;   }</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;* </div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160; </div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;* </div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;* </div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;LaplaceProblemclass&quot;</span>&gt;&lt;/a&gt;  &lt;h3&gt;LaplaceProblem <span class="keyword">class</span>&lt;/h3&gt;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;* </div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;* </div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;*  This <span class="keyword">class </span>is based on the <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> in   @ref step_16 &quot;step-16&quot;  . However, we replaced the <a class="code" href="classSparseMatrix.html">SparseMatrix</a>&lt;<a class="code" href="classdouble.html">double</a>&gt; class by our matrix-<a class="code" href="namespaceUtilities_1_1CUDA.html#afc505a095cc4c7600f65ecb99851312e">free</a> implementation, which means that we can also skip the sparsity patterns. Notice that we define the LaplaceOperator class with the degree of finite element as template argument (the <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a> is defined at the top of the file), and that we use float <a class="code" href="namespacenumbers.html">numbers</a> for the multigrid <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> matrices.   </div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;*   The <span class="keyword">class </span>also has a member variable to keep track of all the detailed timings for setting up the entire chain of data before we actually go about solving the problem. In addition, there is an output stream (that is disabled by default) that can be used to output details for the individual setup operations instead of the summary only that is printed out by default.   </div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;*   Since <span class="keyword">this</span> program is designed to be used with MPI, we also provide the usual   @p pcout   output stream that only prints the information of the processor with MPI rank 0. The grid used <span class="keywordflow">for</span> <span class="keyword">this</span> programs can either be a distributed <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a> based on p4est (in <span class="keywordflow">case</span> deal.II is configured to use p4est), otherwise it is a serial grid that only runs without MPI.</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;* </div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;* </div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;* @code</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;   <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;   <span class="keyword">class </span>LaplaceProblem</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;   {</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;   <span class="keyword">public</span>:</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;     LaplaceProblem();</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;     <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a>();</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;* </div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;   <span class="keyword">private</span>:</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;     <span class="keywordtype">void</span> setup_system();</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;     <span class="keywordtype">void</span> assemble_rhs();</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;     <span class="keywordtype">void</span> solve();</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;     <span class="keywordtype">void</span> output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cycle) <span class="keyword">const</span>;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;* </div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="preprocessor"> #ifdef DEAL_II_WITH_P4EST</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;     <a class="code" href="classparallel_1_1distributed_1_1Triangulation.html">parallel::distributed::Triangulation&lt;dim&gt;</a> <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="preprocessor"> #else</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;     <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="preprocessor"> #endif</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;* </div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;     <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a>       fe;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;     <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> dof_handler;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;* </div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;     <a class="code" href="classMappingQ1.html">MappingQ1&lt;dim&gt;</a> mapping;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;* </div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;     <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> constraints;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;     <span class="keyword">using</span> SystemMatrixType =</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;       LaplaceOperator&lt;dim, degree_finite_element, double&gt;;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;     SystemMatrixType system_matrix;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;* </div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;     <a class="code" href="classMGConstrainedDoFs.html">MGConstrainedDoFs</a> mg_constrained_dofs;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;     <span class="keyword">using</span> LevelMatrixType = LaplaceOperator&lt;dim, degree_finite_element, float&gt;;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;     <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;LevelMatrixType&gt;</a> mg_matrices;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;* </div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;     <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> solution;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;     <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> system_rhs;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;* </div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;     <span class="keywordtype">double</span>             setup_time;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;     <a class="code" href="classConditionalOStream.html">ConditionalOStream</a> pcout;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;     <a class="code" href="classConditionalOStream.html">ConditionalOStream</a> time_details;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;   };</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;* </div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160; </div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;* </div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;* </div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;*  When we initialize the finite element, we of course have to use the degree specified at the top of the file as well (otherwise, an exception will be thrown at some <a class="code" href="namespaceOpenCASCADE.html#a9509efa83e3b2fa42616fe0623cba696">point</a>, since the computational kernel defined in the templated LaplaceOperator <span class="keyword">class</span> and the information from the finite element read out by MatrixFree will not match). The constructor of the <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a> needs to <span class="keyword">set</span> an additional flag that tells the grid to conform to the 2:1 cell balance over <a class="code" href="data__out__base_8cc.html#accc45da40beb7ae1b485306984e904a2">vertices</a>, which is needed <span class="keywordflow">for</span> the convergence of the geometric multigrid routines. For the distributed grid, we also need to specifically enable the multigrid hierarchy.</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;* </div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;* </div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;* @code</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;   <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;   LaplaceProblem&lt;dim&gt;::LaplaceProblem()</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;     :</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160; #ifdef DEAL_II_WITH_P4EST</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;     <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>(</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;       MPI_COMM_WORLD,</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;       <a class="code" href="classTriangulation.html">Triangulation</a>&lt;dim&gt;::limit_level_difference_at_vertices,</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;       <a class="code" href="namespaceparallel.html">parallel</a>::distributed::<a class="code" href="classTriangulation.html">Triangulation</a>&lt;dim&gt;::<a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0acc0ed1c2dd30bca7c7576e65b4045274">construct_multigrid_hierarchy</a>)</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;     ,</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160; #else</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;     <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>(<a class="code" href="classTriangulation.html">Triangulation</a>&lt;dim&gt;::limit_level_difference_at_vertices)</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;     ,</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160; #endif</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;     fe(degree_finite_element)</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;     , dof_handler(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>)</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;     , setup_time(0.)</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;     , pcout(<a class="code" href="namespacestd.html">std</a>::cout, <a class="code" href="namespaceUtilities.html">Utilities</a>::MPI::<a class="code" href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">this_mpi_process</a>(MPI_COMM_WORLD) == 0)</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;     ,</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160; @endcode</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;* </div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;*  The LaplaceProblem class holds an additional output stream that collects detailed timings about the setup phase. This stream, called time_details, is disabled by default through the   @p false   argument specified here. For detailed timings, removing the   @p false   argument prints all the details.</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;* </div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;* </div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;* @code</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;     time_details(<a class="code" href="namespacestd.html">std</a>::cout,</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                  false &amp;&amp; <a class="code" href="namespaceUtilities.html">Utilities</a>::MPI::<a class="code" href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">this_mpi_process</a>(MPI_COMM_WORLD) == 0)</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;   {}</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;* </div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160; </div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;* </div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;* </div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;LaplaceProblemsetup_system&quot;</span>&gt;&lt;/a&gt;  &lt;h4&gt;LaplaceProblem::setup_system&lt;/h4&gt;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;* </div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;* </div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;*  The setup stage is in analogy to   @ref step_16 <span class="stringliteral">&quot;step-16&quot;</span>   with relevant changes due to the LaplaceOperator <span class="keyword">class</span>. The <a class="code" href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a> thing to <span class="keywordflow">do</span> is to <span class="keyword">set</span> up the <a class="code" href="group__dofs.html#ga768cd565b5c25f1ac235586e36ac94d6">DoFHandler</a>, including the degrees of freedom <span class="keywordflow">for</span> the multigrid levels, and to initialize constraints from hanging nodes and homogeneous Dirichlet conditions. Since we intend to use <span class="keyword">this</span> programs in %<a class="code" href="namespaceparallel.html">parallel</a> with MPI, we need to make sure that the constraints <span class="keyword">get</span> to know the locally relevant degrees of freedom, otherwise the storage would explode when <span class="keyword">using</span> more than a few hundred millions of degrees of freedom, see   @ref step_40 <span class="stringliteral">&quot;step-40&quot;</span>  .</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;* </div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;* </div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;*  Once we have created the multigrid dof_handler and the constraints, we can call the <a class="code" href="namespaceinternal.html#a38181f4582ff69679bda7d8e31c37291">reinit</a> <span class="keyword">function</span> <span class="keywordflow">for</span> the global matrix <span class="keyword">operator</span> as well as each <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> of the multigrid scheme. The main action is to <span class="keyword">set</span> up the   &lt;code&gt; MatrixFree &lt;/code&gt;   instance <span class="keywordflow">for</span> the problem. The base <span class="keyword">class </span>of the   &lt;code&gt;LaplaceOperator&lt;/code&gt;   class,   <a class="code" href="namespaceMatrixFreeOperators.html">MatrixFreeOperators</a>::Base,   is initialized with a shared pointer to MatrixFree object. This way, we can simply create it here and then pass it on to the system matrix and <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> matrices, respectively. For setting up MatrixFree, we need to activate the update flag in the AdditionalData field of MatrixFree that enables the storage of quadrature <a class="code" href="namespaceOpenCASCADE.html#a9509efa83e3b2fa42616fe0623cba696">point</a> coordinates in real space (by default, it only caches data for gradients (inverse transposed Jacobians) and JxW values). Note that if we call the <a class="code" href="namespaceinternal.html#a38181f4582ff69679bda7d8e31c37291">reinit</a> function without specifying the <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> (i.e., giving   &lt;code&gt;level = numbers::invalid_unsigned_int&lt;/code&gt;  ), MatrixFree constructs a loop over the active cells. In this tutorial, we do not use threads in addition to MPI, which is why we explicitly disable it by setting the   <a class="code" href="structMatrixFree_1_1AdditionalData.html#a0bcce2facca91b925d3e1a5a00c7704b">MatrixFree::AdditionalData::tasks_parallel_scheme</a>   to   <a class="code" href="structMatrixFree_1_1AdditionalData.html#a5b3198735af965d2fc5019543263f927a70ba08215ce330f13a3fd33adbd977a9">MatrixFree::AdditionalData::none</a>.   Finally, the coefficient is evaluated and vectors are initialized as explained above.</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;* </div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;* </div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;* @code</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;   template &lt;int dim&gt;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;   void LaplaceProblem&lt;dim&gt;::setup_system()</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;   {</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;     <a class="code" href="classTimer.html">Timer</a> time;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;     setup_time = 0;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;* </div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;     system_matrix.clear();</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;     mg_matrices.clear_elements();</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;* </div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;     dof_handler.distribute_dofs(fe);</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;     dof_handler.distribute_mg_dofs();</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;* </div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;     pcout &lt;&lt; <span class="stringliteral">&quot;Number of degrees of freedom: &quot;</span> &lt;&lt; dof_handler.n_dofs()</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;           &lt;&lt; std::endl;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;* </div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;     <a class="code" href="classIndexSet.html">IndexSet</a> locally_relevant_dofs;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;     <a class="code" href="namespaceDoFTools.html#acad7e0841b9046eaafddc4c617ab1d9d">DoFTools::extract_locally_relevant_dofs</a>(dof_handler, locally_relevant_dofs);</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;* </div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;     constraints.clear();</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;     constraints.reinit(locally_relevant_dofs);</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;     <a class="code" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a>(dof_handler, constraints);</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;     <a class="code" href="namespaceVectorTools.html#af27ac28c698a9ed0199faed50a204538">VectorTools::interpolate_boundary_values</a>(</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;       mapping, dof_handler, 0, <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(), constraints);</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;     constraints.close();</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;     setup_time += time.wall_time();</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;     time_details &lt;&lt; <span class="stringliteral">&quot;Distribute DoFs &amp; B.C.     (CPU/wall) &quot;</span> &lt;&lt; time.cpu_time()</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;s/&quot;</span> &lt;&lt; time.wall_time() &lt;&lt; <span class="stringliteral">&quot;s&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;     time.restart();</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;* </div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;     {</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;       <span class="keyword">typename</span> <a class="code" href="structMatrixFree_1_1AdditionalData.html">MatrixFree&lt;dim, double&gt;::AdditionalData</a> additional_data;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;       additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a0bcce2facca91b925d3e1a5a00c7704b">tasks_parallel_scheme</a> =</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;         <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, double&gt;::AdditionalData::none</a>;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;       additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#aa5d597e6c4441d273f4100b6139a2552">mapping_update_flags</a> =</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;         (<a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a>);</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;       std::shared_ptr&lt;MatrixFree&lt;dim, double&gt;&gt; system_mf_storage(</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;         <span class="keyword">new</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, double&gt;</a>());</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;       system_mf_storage-&gt;reinit(mapping,</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;                                 dof_handler,</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;                                 constraints,</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;                                 <a class="code" href="classQGauss.html">QGauss&lt;1&gt;</a>(fe.degree + 1),</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                                 additional_data);</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;       system_matrix.initialize(system_mf_storage);</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;     }</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;* </div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;     system_matrix.evaluate_coefficient(Coefficient&lt;dim&gt;());</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;* </div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;     system_matrix.initialize_dof_vector(solution);</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;     system_matrix.initialize_dof_vector(system_rhs);</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;* </div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;     setup_time += time.wall_time();</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;     time_details &lt;&lt; <span class="stringliteral">&quot;Setup matrix-free system   (CPU/wall) &quot;</span> &lt;&lt; time.cpu_time()</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;s/&quot;</span> &lt;&lt; time.wall_time() &lt;&lt; <span class="stringliteral">&quot;s&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;     time.restart();</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;* </div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;* </div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;*  Next, initialize the matrices <span class="keywordflow">for</span> the multigrid method on all the levels. The data structure <a class="code" href="classMGConstrainedDoFs.html">MGConstrainedDoFs</a> keeps information about the indices subject to boundary conditions as well as the indices on edges between different refinement levels as described in the   @ref step_16 <span class="stringliteral">&quot;step-16&quot;</span>   tutorial program. We then go through the levels of the mesh and construct the constraints and matrices on each <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>. These follow closely the construction of the system matrix on the original mesh, except the slight difference in naming when accessing information on the levels rather than the active cells.</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;* </div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;* </div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;* @code</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nlevels = <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_levels();</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;     mg_matrices.resize(0, nlevels</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;* </div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;- 1);</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;* </div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;     std::set&lt;types::boundary_id&gt; dirichlet_boundary;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;     dirichlet_boundary.insert(0);</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;     mg_constrained_dofs.initialize(dof_handler);</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;     mg_constrained_dofs.make_zero_boundary_constraints(dof_handler,</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                                                        dirichlet_boundary);</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;* </div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; nlevels; ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;       {</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;         <a class="code" href="classIndexSet.html">IndexSet</a> relevant_dofs;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;         <a class="code" href="namespaceDoFTools.html#a1fef7be07cf379b661646e39b9354e17">DoFTools::extract_locally_relevant_level_dofs</a>(dof_handler,</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                                                       <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>,</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                                                       relevant_dofs);</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;         <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> level_constraints;</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;         level_constraints.<a class="code" href="classAffineConstraints.html#a2c9d71b5b7e8851c25a411ccf34de986">reinit</a>(relevant_dofs);</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;         level_constraints.<a class="code" href="classAffineConstraints.html#aef97b22281acb10c914d79a3881e2735">add_lines</a>(</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;           mg_constrained_dofs.get_boundary_indices(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;         level_constraints.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;* </div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;         <span class="keyword">typename</span> <a class="code" href="structMatrixFree_1_1AdditionalData.html">MatrixFree&lt;dim, float&gt;::AdditionalData</a> additional_data;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;         additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a0bcce2facca91b925d3e1a5a00c7704b">tasks_parallel_scheme</a> =</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;           <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, float&gt;::AdditionalData::none</a>;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;         additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#aa5d597e6c4441d273f4100b6139a2552">mapping_update_flags</a> =</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;           (<a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a>);</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;         additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a67c9ff01c51fb7fb3ada151b83cdd409">mg_level</a> = <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;         std::shared_ptr&lt;MatrixFree&lt;dim, float&gt;&gt; mg_mf_storage_level(</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;           <span class="keyword">new</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, float&gt;</a>());</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;         mg_mf_storage_level-&gt;reinit(mapping,</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;                                     dof_handler,</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;                                     level_constraints,</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                                     <a class="code" href="classQGauss.html">QGauss&lt;1&gt;</a>(fe.degree + 1),</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;                                     additional_data);</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;* </div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;         mg_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].initialize(mg_mf_storage_level,</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;                                       mg_constrained_dofs,</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                                       <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;         mg_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].evaluate_coefficient(Coefficient&lt;dim&gt;());</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;       }</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;     setup_time += time.wall_time();</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;     time_details &lt;&lt; <span class="stringliteral">&quot;Setup matrix-free levels   (CPU/wall) &quot;</span> &lt;&lt; time.cpu_time()</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;s/&quot;</span> &lt;&lt; time.wall_time() &lt;&lt; <span class="stringliteral">&quot;s&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;   }</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;* </div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160; </div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;* </div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;* </div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;LaplaceProblemassemble_rhs&quot;</span>&gt;&lt;/a&gt;  &lt;h4&gt;LaplaceProblem::assemble_rhs&lt;/h4&gt;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;* </div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;* </div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;*  The <a class="code" href="namespaceinternal.html#a2b3d48efdf7c94da455dc6a3553bab79">assemble</a> <span class="keyword">function</span> is very simple since all we have to <span class="keywordflow">do</span> is to <a class="code" href="namespaceinternal.html#a2b3d48efdf7c94da455dc6a3553bab79">assemble</a> the right hand side. Thanks to <a class="code" href="classFEEvaluation.html">FEEvaluation</a> and all the data cached in the MatrixFree <span class="keyword">class</span>, which we query from   <a class="code" href="classMatrixFreeOperators_1_1Base.html">MatrixFreeOperators::Base</a>,   <span class="keyword">this</span> can be done in a few lines. Since <span class="keyword">this</span> call is not wrapped into a   <a class="code" href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">MatrixFree::cell_loop</a>   (which would be an alternative), we must not forget to call <a class="code" href="namespaceUtilities.html#a6155277fd058eddb1504f9562cb1c04d">compress</a>() at the <a class="code" href="namespaceTrilinosWrappers_1_1internal.html#aee42c8e3004e2e81eac3c3356d3ec46b">end</a> of the assembly to send all the contributions of the right hand side to the owner of the respective degree of freedom.</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;* </div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;* </div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;* @code</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;   template &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;   <span class="keywordtype">void</span> LaplaceProblem&lt;dim&gt;::assemble_rhs()</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;   {</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;     <a class="code" href="classTimer.html">Timer</a> time;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;* </div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;     system_rhs = 0;</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;     <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, degree_finite_element&gt;</a> phi(</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;      system_matrix.get_matrix_free());</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = 0;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;          cell &lt; system_matrix.get_matrix_free()-&gt;n_cell_batches();</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;          ++cell)</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;       {</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;         phi.<a class="code" href="classFEEvaluation.html#a5e77cd8900f05a73a91ca8edf31f4a91">reinit</a>(cell);</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;           phi.submit_value(make_vectorized_array&lt;double&gt;(1.0), q);</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;         phi.integrate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">EvaluationFlags::values</a>);</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;         phi.distribute_local_to_global(system_rhs);</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;       }</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;     system_rhs.compress(<a class="code" href="structVectorOperation.html#a40c50779cd14ba89bbf0bd9b4561964cae1077e8dbf4afea5d2df8c8b723c0708">VectorOperation::add</a>);</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;* </div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;     setup_time += time.<a class="code" href="classTimer.html#a6f3e76707411b51e7d7e7bfa5755cf02">wall_time</a>();</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;     time_details &lt;&lt; <span class="stringliteral">&quot;Assemble right hand side   (CPU/wall) &quot;</span> &lt;&lt; time.<a class="code" href="classTimer.html#a4e3933a78790d7455daff5acab3f8432">cpu_time</a>()</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;s/&quot;</span> &lt;&lt; time.<a class="code" href="classTimer.html#a6f3e76707411b51e7d7e7bfa5755cf02">wall_time</a>() &lt;&lt; <span class="stringliteral">&quot;s&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;   }</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;* </div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160; </div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;* </div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;* </div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;*   &lt;a name=<span class="stringliteral">&quot;LaplaceProblemsolve&quot;</span>&gt;&lt;/a&gt;  &lt;h4&gt;LaplaceProblem::solve&lt;/h4&gt;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;* </div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;* </div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;*  The solution process is similar as in   @ref step_16 <span class="stringliteral">&quot;step-16&quot;</span>  . We start with the setup of the transfer. For   <a class="code" href="namespaceLinearAlgebraDealII.html#a9fe13d579422411556954ab3f28a59be">LinearAlgebra::distributed::Vector</a>,   there is a very fast transfer <span class="keyword">class </span>called <a class="code" href="classMGTransferMatrixFree.html">MGTransferMatrixFree</a> that does the interpolation between the grid levels with the same fast <a class="code" href="namespaceUtilities_1_1MPI.html#ab544a3bf3301a6dd3e705ee352c5551b">sum</a> factorization kernels that get also used in <a class="code" href="classFEEvaluation.html">FEEvaluation</a>.</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;* </div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;* </div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;* @code</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;   <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;   <span class="keywordtype">void</span> LaplaceProblem&lt;dim&gt;::solve()</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;   {</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;     <a class="code" href="classTimer.html">Timer</a>                            time;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;     <a class="code" href="classMGTransferMatrixFree.html">MGTransferMatrixFree&lt;dim, float&gt;</a> mg_transfer(mg_constrained_dofs);</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;     mg_transfer.build(dof_handler);</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;     setup_time += time.<a class="code" href="classTimer.html#a6f3e76707411b51e7d7e7bfa5755cf02">wall_time</a>();</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;     time_details &lt;&lt; <span class="stringliteral">&quot;MG build transfer time     (CPU/wall) &quot;</span> &lt;&lt; time.<a class="code" href="classTimer.html#a4e3933a78790d7455daff5acab3f8432">cpu_time</a>()</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;s/&quot;</span> &lt;&lt; time.<a class="code" href="classTimer.html#a6f3e76707411b51e7d7e7bfa5755cf02">wall_time</a>() &lt;&lt; <span class="stringliteral">&quot;s\n&quot;</span>;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;     time.<a class="code" href="classTimer.html#aa3f7871196bb56202af2bc982bfbfff6">restart</a>();</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;* </div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;* </div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;*  As a smoother, <span class="keyword">this</span> tutorial program uses a Chebyshev iteration instead of SOR in   @ref step_16 <span class="stringliteral">&quot;step-16&quot;</span>  . (SOR would be very difficult to implement because we <span class="keywordflow">do</span> not have the matrix elements available explicitly, and it is difficult to make it work efficiently in %<a class="code" href="namespaceparallel.html">parallel</a>.)  The smoother is initialized with our <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> matrices and the mandatory additional data <span class="keywordflow">for</span> the Chebyshev smoother. We use a relatively high degree here (5), since matrix-vector products are comparably cheap. We choose to smooth out a range of   @f$[1.2 \hat{\lambda}_{<a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420">\max</a>}/15,1.2 \hat{\lambda}_{<a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420">\max</a>}]@f$   in the smoother where   @f$\hat{\lambda}_{<a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420">\max</a>}@f$   is an estimate of the largest eigenvalue (the factor 1.2 is applied inside <a class="code" href="classPreconditionChebyshev.html">PreconditionChebyshev</a>). In order to compute that eigenvalue, the Chebyshev initialization performs a few steps of a CG algorithm without preconditioner. Since the highest eigenvalue is usually the easiest <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> to find and a rough estimate is enough, we choose 10 iterations. Finally, we also <span class="keyword">set</span> the inner preconditioner type in the Chebyshev method which is a Jacobi iteration. This is represented by the <a class="code" href="classDiagonalMatrix.html">DiagonalMatrix</a> <span class="keyword">class </span>that gets the inverse <a class="code" href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86">diagonal</a> entry provided by our LaplaceOperator class.     </div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;*   On <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> <a class="code" href="namespaceLAPACKSupport.html#a0d8802698d585eec62a2a54e6387b05b">zero</a>, we initialize the smoother differently because we want to use the Chebyshev iteration as a solver. <a class="code" href="classPreconditionChebyshev.html">PreconditionChebyshev</a> allows the user to <span class="keywordflow">switch</span> to solver mode where the number of iterations is internally chosen to the correct <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a>. In the additional data object, <span class="keyword">this</span> setting is activated by choosing the polynomial degree to   @p <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>.   The algorithm will then attack all <a class="code" href="namespaceLAPACKSupport.html#a1a9009db0d9a77923a7031b549b9b638ad91ede5cc912c10676843bf58fa60636">eigenvalues</a> between the smallest and largest <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a> in the coarse <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> matrix. The number of steps in the Chebyshev smoother are chosen such that the Chebyshev convergence estimates guarantee to <a class="code" href="namespaceUtilities_1_1MPI.html#a9e963546bd81b0cdd88e1840cfa8f227">reduce</a> the residual by the number specified in the variable   @p   smoothing_range. Note that <span class="keywordflow">for</span> solving,   @p smoothing_range   is a relative tolerance and chosen smaller than <a class="code" href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">one</a>, in <span class="keyword">this</span> <span class="keywordflow">case</span>, we select three orders of magnitude, whereas it is a number larger than 1 when only selected <a class="code" href="namespaceLAPACKSupport.html#a1a9009db0d9a77923a7031b549b9b638ad91ede5cc912c10676843bf58fa60636">eigenvalues</a> are smoothed.     </div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;*   From a computational <a class="code" href="namespaceOpenCASCADE.html#a9509efa83e3b2fa42616fe0623cba696">point</a> of view, the Chebyshev iteration is a very attractive coarse grid solver as <span class="keywordtype">long</span> as the coarse size is moderate. This is because the Chebyshev method performs only matrix-vector products and vector updates, which typically parallelize better to the largest cluster size with more than a few tens of thousands of cores than inner product involved in other iterative methods. The former involves only local communication between neighbors in the (coarse) mesh, whereas the latter requires global communication over all processors.</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;* </div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;* </div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;* @code</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;     <span class="keyword">using</span> SmootherType =</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;       <a class="code" href="classPreconditionChebyshev.html">PreconditionChebyshev</a>&lt;LevelMatrixType,</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;                             <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt;;</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;     <a class="code" href="classmg_1_1SmootherRelaxation.html">mg::SmootherRelaxation</a>&lt;SmootherType,</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;                            LinearAlgebra::distributed::Vector&lt;float&gt;&gt;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;                                                          mg_smoother;</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;     <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;typename SmootherType::AdditionalData&gt;</a> smoother_data;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;     smoother_data.<a class="code" href="classMGLevelObject.html#a16213121f9153bd08f49652a11886259">resize</a>(0, <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_levels()</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;* </div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;- 1);</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_levels();</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;          ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;       {</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &gt; 0)</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;           {</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;             smoother_data[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].smoothing_range     = 15.;</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;             smoother_data[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].degree              = 5;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;             smoother_data[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].eig_cg_n_iterations = 10;</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;           }</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;         <span class="keywordflow">else</span></div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;           {</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;             smoother_data[0].smoothing_range = 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-3;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;             smoother_data[0].degree          = <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;             smoother_data[0].eig_cg_n_iterations = mg_matrices[0].m();</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;           }</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;         mg_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].compute_diagonal();</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;         smoother_data[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].preconditioner =</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;           mg_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].get_matrix_diagonal_inverse();</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;       }</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;     mg_smoother.initialize(mg_matrices, smoother_data);</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;* </div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;     <a class="code" href="classMGCoarseGridApplySmoother.html">MGCoarseGridApplySmoother&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt;</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;       mg_coarse;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;     mg_coarse.<a class="code" href="classMGCoarseGridApplySmoother.html#a499c7364e40031332e9943a2e5f331a2">initialize</a>(mg_smoother);</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;* </div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160; <span class="keyword">@end</span>code</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;* </div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;*  The next step is to <span class="keyword">set</span> up the <span class="keyword">interface </span>matrices that are needed for the case with hanging nodes. The adaptive multigrid realization in deal.II <span class="keyword">implements</span> an approach called local smoothing. This means that the smoothing on the finest <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> only covers the local part of the mesh defined by the fixed (finest) grid <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> and ignores parts of the computational domain where the terminal cells are coarser than this <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>. As the method progresses to coarser levels, more and more of the global mesh will be covered. At some coarser <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>, the whole mesh will be covered. Since all <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> matrices in the multigrid method cover a single <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> in the mesh, no hanging nodes appear on the <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> matrices. At the interface between multigrid levels, homogeneous Dirichlet boundary conditions are <a class="code" href="group__CUDAWrappers.html#gabb7130e2cea54654455ca41ef304f939">set</a> while smoothing. When the residual is transferred to the next coarser <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>, however, the coupling over the multigrid interface needs to be taken into account. This is done by the so-called interface (or edge) matrices that compute the part of the residual that is missed by the <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> matrix with homogeneous Dirichlet conditions. We refer to the   @ref mg_paper   &quot;<a class="code" href="classMultigrid.html">Multigrid</a> paper by Janssen and Kanschat&quot; for more details.     </div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;*   For the implementation of those interface matrices, there is already a pre-defined class   <a class="code" href="classMatrixFreeOperators_1_1MGInterfaceOperator.html">MatrixFreeOperators::MGInterfaceOperator</a>   that wraps the routines   <a class="code" href="classMatrixFreeOperators_1_1Base.html#a21cefa5a5d4cb726180c89962d8ae472">MatrixFreeOperators::Base::vmult_interface_down</a>()   and   <a class="code" href="classMatrixFreeOperators_1_1Base.html#af4f39d8232619d499709aa6ee968db58">MatrixFreeOperators::Base::vmult_interface_up</a>()   in a new class with   @p   vmult() and   @p Tvmult()   operations (that were originally written for matrices, hence expecting those names). Note that vmult_interface_down is used during the restriction phase of the multigrid <a class="code" href="namespaceLAPACKSupport.html#aee5ef58d11434eb1d6a665e64bf17292">V</a>-cycle, whereas vmult_interface_up is used during the prolongation phase.     </div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;*   Once the interface matrix is created, we <a class="code" href="group__CUDAWrappers.html#gabb7130e2cea54654455ca41ef304f939">set</a> up the remaining <a class="code" href="classMultigrid.html">Multigrid</a> preconditioner infrastructure in complete analogy to   @ref step_16 &quot;step-16&quot;   to obtain a   @p preconditioner   object that can be applied to a matrix.</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;* </div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;* </div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;* @code</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;     <a class="code" href="classmg_1_1Matrix.html">mg::Matrix</a>&lt;LinearAlgebra::distributed::Vector&lt;float&gt;&gt; mg_matrix(</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;       mg_matrices);</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;* </div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;     <a class="code" href="classMGLevelObject.html">MGLevelObject</a>&lt;MatrixFreeOperators::MGInterfaceOperator&lt;LevelMatrixType&gt;&gt;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;       mg_interface_matrices;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;     mg_interface_matrices.resize(0, triangulation.n_global_levels()</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;* </div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;- 1);</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;     for (unsigned int level = 0; level &lt; triangulation.n_global_levels();</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;          ++level)</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;       mg_interface_matrices[level].initialize(mg_matrices[level]);</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;     mg::Matrix&lt;LinearAlgebra::distributed::Vector&lt;float&gt;&gt; mg_interface(</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;       mg_interface_matrices);</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;* </div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;     Multigrid&lt;LinearAlgebra::distributed::Vector&lt;float&gt;&gt; mg(</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;       mg_matrix, mg_coarse, mg_transfer, mg_smoother, mg_smoother);</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;     mg.set_edge_matrices(mg_interface, mg_interface);</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;* </div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;     PreconditionMG&lt;dim,</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;                    LinearAlgebra::distributed::Vector&lt;float&gt;,</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;                    MGTransferMatrixFree&lt;dim, float&gt;&gt;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;       preconditioner(dof_handler, mg, mg_transfer);</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;* </div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160; @endcode</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;* </div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;*  The setup of the multigrid routines is quite easy and one cannot see any difference in the solve process as compared to   @ref step_16 &quot;step-16&quot;  . All the magic is hidden behind the implementation of the   LaplaceOperator::vmult   operation. Note that we print out the solve time and the accumulated setup time through standard out, i.e., in any case, whereas detailed times for the setup operations are only printed in case the flag for detail_times in the constructor is changed.</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;* </div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;* </div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;*  </div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;* </div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;* @code</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;     SolverControl solver_control(100, 1e-12 system_rhs.l2_norm());</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;     SolverCG&lt;LinearAlgebra::distributed::Vector&lt;double&gt;&gt; cg(solver_control);</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;     setup_time += time.wall_time();</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;     time_details &lt;&lt; &quot;MG build smoother time     (CPU/wall) &quot; &lt;&lt; time.cpu_time()</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;                  &lt;&lt; &quot;s/&quot; &lt;&lt; time.wall_time() &lt;&lt; &quot;s\n&quot;;</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;     pcout &lt;&lt; &quot;Total setup time               (wall) &quot; &lt;&lt; setup_time &lt;&lt; &quot;s\n&quot;;</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;* </div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;     time.reset();</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;     time.start();</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;     constraints.set_zero(solution);</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;     cg.solve(system_matrix, solution, system_rhs, preconditioner);</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;* </div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;     constraints.distribute(solution);</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;* </div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;     pcout &lt;&lt; &quot;Time solve (&quot; &lt;&lt; solver_control.last_step() &lt;&lt; &quot; iterations)&quot;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;           &lt;&lt; (solver_control.last_step() &lt; 10 ? &quot;  &quot; : &quot; &quot;) &lt;&lt; &quot;(CPU/wall) &quot;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;           &lt;&lt; time.cpu_time() &lt;&lt; &quot;s/&quot; &lt;&lt; time.wall_time() &lt;&lt; &quot;s\n&quot;;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;   }</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;* </div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160; </div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;* </div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160; @endcode</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;* </div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;*   &lt;a name=&quot;LaplaceProblemoutput_results&quot;&gt;&lt;/a&gt;  &lt;h4&gt;LaplaceProblem::output_results&lt;/h4&gt;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;* </div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;* </div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;*  Here is the data output, which is a simplified version of   @ref step_5 &quot;step-5&quot;  . We use the standard VTU (= compressed VTK) output for each grid produced in the refinement process. In addition, we use a compression algorithm that is optimized for speed rather than disk usage. The default setting (which optimizes for disk usage) makes saving the output take about 4 times as long as running the linear solver, while setting   DataOutBase::VtkFlags::compression_level   to   DataOutBase::VtkFlags::best_speed   lowers this to only one fourth the time of the linear solve.   </div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;*   We disable the output when the mesh gets too large. A variant of this program has been run on hundreds of thousands MPI ranks with as many as 100 billion grid cells, which is not directly accessible to classical visualization tools.</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;* </div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;* </div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;* @code</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;   template &lt;int dim&gt;</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;   void LaplaceProblem&lt;dim&gt;::output_results(const unsigned int cycle) const</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;   {</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;     Timer time;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;     if (triangulation.n_global_active_cells() &gt; 1000000)</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;       return;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;* </div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;     DataOut&lt;dim&gt; data_out;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;* </div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;     solution.update_ghost_values();</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;     data_out.attach_dof_handler(dof_handler);</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;     data_out.add_data_vector(solution, &quot;solution&quot;);</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;     data_out.build_patches(mapping);</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;* </div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;     DataOutBase::VtkFlags flags;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;     flags.compression_level = DataOutBase::VtkFlags::best_speed;</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;     data_out.set_flags(flags);</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;     data_out.write_vtu_with_pvtu_record(</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;       &quot;./&quot;, &quot;solution&quot;, cycle, MPI_COMM_WORLD, 3);</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;* </div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;     time_details &lt;&lt; &quot;Time write output          (CPU/wall) &quot; &lt;&lt; time.cpu_time()</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;                  &lt;&lt; &quot;s/&quot; &lt;&lt; time.wall_time() &lt;&lt; &quot;s\n&quot;;</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;   }</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;* </div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160; </div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;* </div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160; @endcode</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;* </div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;*   &lt;a name=&quot;LaplaceProblemrun&quot;&gt;&lt;/a&gt;  &lt;h4&gt;LaplaceProblem::run&lt;/h4&gt;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;* </div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;* </div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;*  The function that runs the program is very similar to the one in   @ref step_16 &quot;step-16&quot;  . We do few refinement steps in 3D compared to 2D, but that&#39;s it.   </div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;*   Before we run the program, we output some information about the detected vectorization level as discussed in the introduction.</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;* </div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;* </div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;* @code</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;   template &lt;int dim&gt;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;   void LaplaceProblem&lt;dim&gt;::run()</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;   {</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;     {</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;       const unsigned int n_vect_doubles = VectorizedArray&lt;double&gt;::size();</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;       const unsigned int n_vect_bits    = 8 sizeof(double) n_vect_doubles;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;* </div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;       pcout &lt;&lt; &quot;Vectorization over &quot; &lt;&lt; n_vect_doubles</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;             &lt;&lt; &quot; doubles = &quot; &lt;&lt; n_vect_bits &lt;&lt; &quot; bits (&quot;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;             &lt;&lt; Utilities::System::get_current_vectorization_level() &lt;&lt; &quot;)&quot;</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;             &lt;&lt; std::endl;</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;     }</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;* </div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;     for (unsigned int cycle = 0; cycle &lt; 9</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;* </div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;- dim; ++cycle)</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;       {</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;         pcout &lt;&lt; &quot;Cycle &quot; &lt;&lt; cycle &lt;&lt; std::endl;</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;* </div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;         if (cycle == 0)</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;           {</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;             GridGenerator::hyper_cube(triangulation, 0., 1.);</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;             triangulation.refine_global(3</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;* </div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;- dim);</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;           }</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;         triangulation.refine_global(1);</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;         setup_system();</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;         assemble_rhs();</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;         solve();</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;         output_results(cycle);</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;         pcout &lt;&lt; std::endl;</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;       };</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;   }</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160; } <span class="comment">// namespace Step37</span></div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;* </div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160; </div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;* </div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160; @endcode</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;* </div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;*   &lt;a name=&quot;Thecodemaincodefunction&quot;&gt;&lt;/a&gt;  &lt;h3&gt;The &lt;code&gt;main&lt;/code&gt; function&lt;/h3&gt;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;* </div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;* </div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;*  Apart from the fact that we set up the MPI framework according to   @ref step_40 &quot;step-40&quot;  , there are no surprises in the main function.</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;* </div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;* </div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;* @code</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160; int main(int argc, charargv[])</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160; {</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;   try</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;     {</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;       using namespace Step37;</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;* </div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;       Utilities::MPI::MPI_InitFinalize mpi_init(argc, argv, 1);</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;* </div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;       LaplaceProblem&lt;dimension&gt; laplace_problem;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;       laplace_problem.run();</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;     }</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;   catch (std::exception &amp;exc)</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;     {</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;       std::cerr &lt;&lt; std::endl</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;                 &lt;&lt; std::endl</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;                 &lt;&lt; &quot;----------------------------------------------------&quot;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;                 &lt;&lt; std::endl;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;       std::cerr &lt;&lt; &quot;Exception on processing: &quot; &lt;&lt; std::endl</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;                 &lt;&lt; exc.what() &lt;&lt; std::endl</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;                 &lt;&lt; &quot;Aborting!&quot; &lt;&lt; std::endl</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;                 &lt;&lt; &quot;----------------------------------------------------&quot;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;                 &lt;&lt; std::endl;</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;       return 1;</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;     }</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;   catch (...)</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;     {</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;       std::cerr &lt;&lt; std::endl</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;                 &lt;&lt; std::endl</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;                 &lt;&lt; &quot;----------------------------------------------------&quot;</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;                 &lt;&lt; std::endl;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;       std::cerr &lt;&lt; &quot;Unknown exception!&quot; &lt;&lt; std::endl</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;                 &lt;&lt; &quot;Aborting!&quot; &lt;&lt; std::endl</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;                 &lt;&lt; &quot;----------------------------------------------------&quot;</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;                 &lt;&lt; std::endl;</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;       return 1;</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;     }</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;* </div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;   return 0;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160; }</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160; @endcode</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;* &lt;a name=&quot;Results&quot;&gt;&lt;/a&gt;&lt;h1&gt;Results&lt;/h1&gt;</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;* </div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;* &lt;a name=&quot;Programoutput&quot;&gt;&lt;/a&gt;&lt;h3&gt;Program output&lt;/h3&gt;</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;* </div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;* Since this example solves the same problem as   @ref step_5 &quot;step-5&quot;   (except fora different coefficient), there is little to say about thesolution. We show a picture anyway, illustrating the size of thesolution through both isocontours and volume rendering:</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;*   &lt;img src=&quot;https:<span class="comment">//www.dealii.org/images/steps/developer/step-37.solution.png&quot; alt=&quot;&quot;&gt;  </span></div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;* Of more interest is to evaluate some aspects of the multigrid solver.When we run this program in 2D for quadratic (  @f$Q_2@f$  ) elements, we get thefollowing output (when run on one core in release mode):</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;* @code</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;Vectorization over 2 doubles = 128 bits (SSE2)</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;Cycle 0</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;Number of degrees of freedom: 81</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;Total setup time               (wall) 0.00159788s</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;Time solve (6 iterations)  (CPU/wall) 0.000951s/0.000951052s</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;* </div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;Cycle 1</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;Number of degrees of freedom: 289</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;Total setup time               (wall) 0.00114608s</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;Time solve (6 iterations)  (CPU/wall) 0.000935s/0.000934839s</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;* </div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;Cycle 2</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;Number of degrees of freedom: 1089</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;Total setup time               (wall) 0.00244665s</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;Time solve (6 iterations)  (CPU/wall) 0.00207s/0.002069s</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;* </div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;Cycle 3</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;Number of degrees of freedom: 4225</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;Total setup time               (wall) 0.00678205s</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;Time solve (6 iterations)  (CPU/wall) 0.005616s/0.00561595s</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;* </div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;Cycle 4</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;Number of degrees of freedom: 16641</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;Total setup time               (wall) 0.0241671s</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;Time solve (6 iterations)  (CPU/wall) 0.019543s/0.0195441s</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;* </div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;Cycle 5</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;Number of degrees of freedom: 66049</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;Total setup time               (wall) 0.0967851s</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;Time solve (6 iterations)  (CPU/wall) 0.07457s/0.0745709s</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;* </div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;Cycle 6</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;Number of degrees of freedom: 263169</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;Total setup time               (wall) 0.346374s</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;Time solve (6 iterations)  (CPU/wall) 0.260042s/0.265033s</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;@endcode</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;* </div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;* As in   @ref step_16 &quot;step-16&quot;  , we see that the number of CG iterations remains constant withincreasing number of degrees of freedom. A constant number of iterations(together with optimal computational properties) means that the computing timeapproximately quadruples as the problem size quadruples from one cycle to thenext. The code is also very efficient in terms of storage. Around 2-4 milliondegrees of freedom fit into 1 GB of memory, see also the MPI results below. Aninteresting fact is that solving one linear system is cheaper than the setup,despite not building a matrix (approximately half of which is spent in the  DoFHandler::distribute_dofs()   and   DoFHandler::distribute_mg_dofs()  calls). This shows the high efficiency of this approach, but also that thedeal.II data structures are quite expensive to set up and the setup cost mustbe amortized over several system solves.</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;* Not much changes if we run the program in three spatial dimensions. Since weuse uniform mesh refinement, we get eight times as many elements andapproximately eight times as many degrees of freedom with each cycle:</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;* @code</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;Vectorization over 2 doubles = 128 bits (SSE2)</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;Cycle 0</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;Number of degrees of freedom: 125</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;Total setup time               (wall) 0.00231099s</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;Time solve (6 iterations)  (CPU/wall) 0.000692s/0.000922918s</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;* </div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;Cycle 1</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;Number of degrees of freedom: 729</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;Total setup time               (wall) 0.00289083s</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;Time solve (6 iterations)  (CPU/wall) 0.001534s/0.0024128s</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;* </div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;Cycle 2</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;Number of degrees of freedom: 4913</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;Total setup time               (wall) 0.0143182s</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;Time solve (6 iterations)  (CPU/wall) 0.010785s/0.0107841s</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;* </div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;Cycle 3</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;Number of degrees of freedom: 35937</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;Total setup time               (wall) 0.087064s</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;Time solve (6 iterations)  (CPU/wall) 0.063522s/0.06545s</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;* </div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;Cycle 4</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;Number of degrees of freedom: 274625</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;Total setup time               (wall) 0.596306s</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;Time solve (6 iterations)  (CPU/wall) 0.427757s/0.431765s</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;* </div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;Cycle 5</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;Number of degrees of freedom: 2146689</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;Total setup time               (wall) 4.96491s</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;Time solve (6 iterations)  (CPU/wall) 3.53126s/3.56142s</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;@endcode</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;* </div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;* Since it is so easy, we look at what happens if we increase the polynomialdegree. When selecting the degree as four in 3D, i.e., on   @f$\mathcal Q_4@f$  elements, by changing the line &lt;code&gt;const unsigned intdegree_finite_element=4;&lt;/code&gt; at the top of the program, we get thefollowing program output:</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;* @code</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;Vectorization over 2 doubles = 128 bits (SSE2)</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;Cycle 0</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;Number of degrees of freedom: 729</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;Total setup time               (wall) 0.00633097s</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;Time solve (6 iterations)  (CPU/wall) 0.002829s/0.00379395s</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;* </div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;Cycle 1</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;Number of degrees of freedom: 4913</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;Total setup time               (wall) 0.0174279s</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;Time solve (6 iterations)  (CPU/wall) 0.012255s/0.012254s</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;* </div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;Cycle 2</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;Number of degrees of freedom: 35937</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;Total setup time               (wall) 0.082655s</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;Time solve (6 iterations)  (CPU/wall) 0.052362s/0.0523629s</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;* </div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;Cycle 3</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;Number of degrees of freedom: 274625</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;Total setup time               (wall) 0.507943s</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;Time solve (6 iterations)  (CPU/wall) 0.341811s/0.345788s</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;* </div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;Cycle 4</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;Number of degrees of freedom: 2146689</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;Total setup time               (wall) 3.46251s</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;Time solve (7 iterations)  (CPU/wall) 3.29638s/3.3265s</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;* </div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;Cycle 5</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;Number of degrees of freedom: 16974593</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;Total setup time               (wall) 27.8989s</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;Time solve (7 iterations)  (CPU/wall) 26.3705s/27.1077s</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;@endcode</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;* </div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;* Since   @f$\mathcal Q_4@f$   elements on a certain mesh correspond to   @f$\mathcal Q_2@f$  elements on half the mesh size, we can compare the run time at cycle 4 withfourth degree polynomials with cycle 5 using quadratic polynomials, both at2.1 million degrees of freedom. The surprising effect is that the solver for  @f$\mathcal Q_4@f$   element is actually slightly faster than for the quadraticcase, despite using one more linear iteration. The effect that higher-degreepolynomials are similarly fast or even faster than lower degree ones is one ofthe main strengths of matrix-free operator evaluation through sumfactorization, see the &lt;a</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;href=&quot;http:<span class="comment">//dx.doi.org/10.1016/j.compfluid.2012.04.012&quot;&gt;matrix-free</span></div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;paper&lt;/a&gt;. This is fundamentally different to matrix-based methods that getmore expensive per unknown as the polynomial degree increases and the couplinggets denser.</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;* In addition, also the setup gets a bit cheaper for higher order, which isbecause fewer elements need to be set up.</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;* Finally, let us look at the timings with degree 8, which corresponds toanother round of mesh refinement in the lower order methods:</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;* @code</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;Vectorization over 2 doubles = 128 bits (SSE2)</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;Cycle 0</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;Number of degrees of freedom: 4913</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;Total setup time               (wall) 0.0842004s</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;Time solve (8 iterations)  (CPU/wall) 0.019296s/0.0192959s</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;* </div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;Cycle 1</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;Number of degrees of freedom: 35937</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;Total setup time               (wall) 0.327048s</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;Time solve (8 iterations)  (CPU/wall) 0.07517s/0.075999s</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;* </div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;Cycle 2</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;Number of degrees of freedom: 274625</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;Total setup time               (wall) 2.12335s</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;Time solve (8 iterations)  (CPU/wall) 0.448739s/0.453698s</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;* </div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;Cycle 3</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;Number of degrees of freedom: 2146689</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;Total setup time               (wall) 16.1743s</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;Time solve (8 iterations)  (CPU/wall) 3.95003s/3.97717s</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;* </div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;Cycle 4</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;Number of degrees of freedom: 16974593</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;Total setup time               (wall) 130.8s</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;Time solve (8 iterations)  (CPU/wall) 31.0316s/31.767s</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;@endcode</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;* </div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;* Here, the initialization seems considerably slower than before, which ismainly due to the computation of the diagonal of the matrix, which actuallycomputes a 729 x 729 matrix on each cell and throws away everything but thediagonal. The solver times, however, are again very close to the quartic case,showing that the linear increase with the polynomial degree that istheoretically expected is almost completely offset by better computationalcharacteristics and the fact that higher order methods have a smaller share ofdegrees of freedom living on several cells that add to the evaluationcomplexity.</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;* &lt;a name=&quot;Comparisonwithasparsematrix&quot;&gt;&lt;/a&gt;&lt;h3&gt;Comparison with a sparse matrix&lt;/h3&gt;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;* </div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;* In order to understand the capabilities of the matrix-free implementation, wecompare the performance of the 3d example above with a sparse matriximplementation based on   TrilinosWrappers::SparseMatrix   by measuring both thecomputation times for the initialization of the problem (distribute DoFs,setup and assemble matrices, setup multigrid structures) and the actualsolution for the matrix-free variant and the variant based on sparsematrices. We base the preconditioner on float numbers and the actual matrixand vectors on double numbers, as shown above. Tests are run on an Intel Corei7-5500U notebook processor (two cores and &lt;a</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;href=&quot;http:<span class="comment">//en.wikipedia.org/wiki/Advanced_Vector_Extensions&quot;&gt;AVX&lt;/a&gt;support, i.e., four operations on doubles can be done with one CPUinstruction, which is heavily used in FEEvaluation), optimized mode, and twoMPI ranks.</span></div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;*   &lt;table align=&quot;center&quot; class=&quot;doxtable&quot;&gt;</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;  &lt;tr&gt;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    &lt;th&gt;&amp;nbsp;&lt;/th&gt;</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    &lt;th colspan=&quot;2&quot;&gt;Sparse matrix&lt;/th&gt;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    &lt;th colspan=&quot;2&quot;&gt;Matrix-free implementation&lt;/th&gt;</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;  &lt;/tr&gt;</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  &lt;tr&gt;</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    &lt;th&gt;n_dofs&lt;/th&gt;</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    &lt;th&gt;Setup + assemble&lt;/th&gt;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    &lt;th&gt;&amp;nbsp;Solve&amp;nbsp;&lt;/th&gt;</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    &lt;th&gt;Setup + assemble&lt;/th&gt;</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;    &lt;th&gt;&amp;nbsp;Solve&amp;nbsp;&lt;/th&gt;</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;  &lt;/tr&gt;</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;  &lt;tr&gt;</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    &lt;td align=&quot;right&quot;&gt;125&lt;/td&gt;</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    &lt;td align=&quot;center&quot;&gt;0.0042s&lt;/td&gt;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    &lt;td align=&quot;center&quot;&gt;0.0012s&lt;/td&gt;</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    &lt;td align=&quot;center&quot;&gt;0.0022s&lt;/td&gt;</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    &lt;td align=&quot;center&quot;&gt;0.00095s&lt;/td&gt;</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;  &lt;/tr&gt;</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;  &lt;tr&gt;</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    &lt;td align=&quot;right&quot;&gt;729&lt;/td&gt;</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    &lt;td align=&quot;center&quot;&gt;0.012s&lt;/td&gt;</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    &lt;td align=&quot;center&quot;&gt;0.0040s&lt;/td&gt;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    &lt;td align=&quot;center&quot;&gt;0.0027s&lt;/td&gt;</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    &lt;td align=&quot;center&quot;&gt;0.0021s&lt;/td&gt;</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;  &lt;/tr&gt;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;  &lt;tr&gt;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    &lt;td align=&quot;right&quot;&gt;4,913&lt;/td&gt;</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    &lt;td align=&quot;center&quot;&gt;0.082s&lt;/td&gt;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;    &lt;td align=&quot;center&quot;&gt;0.012s&lt;/td&gt;</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    &lt;td align=&quot;center&quot;&gt;0.011s&lt;/td&gt;</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    &lt;td align=&quot;center&quot;&gt;0.0057s&lt;/td&gt;</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;  &lt;/tr&gt;</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;  &lt;tr&gt;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    &lt;td align=&quot;right&quot;&gt;35,937&lt;/td&gt;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    &lt;td align=&quot;center&quot;&gt;0.73s&lt;/td&gt;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    &lt;td align=&quot;center&quot;&gt;0.13s&lt;/td&gt;</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    &lt;td align=&quot;center&quot;&gt;0.048s&lt;/td&gt;</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    &lt;td align=&quot;center&quot;&gt;0.040s&lt;/td&gt;</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  &lt;/tr&gt;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;  &lt;tr&gt;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    &lt;td align=&quot;right&quot;&gt;274,625&lt;/td&gt;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    &lt;td align=&quot;center&quot;&gt;5.43s&lt;/td&gt;</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    &lt;td align=&quot;center&quot;&gt;1.01s&lt;/td&gt;</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    &lt;td align=&quot;center&quot;&gt;0.33s&lt;/td&gt;</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    &lt;td align=&quot;center&quot;&gt;0.25s&lt;/td&gt;</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;  &lt;/tr&gt;</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;  &lt;tr&gt;</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    &lt;td align=&quot;right&quot;&gt;2,146,689&lt;/td&gt;</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;    &lt;td align=&quot;center&quot;&gt;43.8s&lt;/td&gt;</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    &lt;td align=&quot;center&quot;&gt;8.24s&lt;/td&gt;</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    &lt;td align=&quot;center&quot;&gt;2.42s&lt;/td&gt;</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    &lt;td align=&quot;center&quot;&gt;2.06s&lt;/td&gt;</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;  &lt;/tr&gt;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;&lt;/table&gt;  </div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;* The table clearly shows that the matrix-free implementation is more than twiceas fast for the solver, and more than six times as fast when it comes toinitialization costs. As the problem size is made a factor 8 larger, we notethat the times usually go up by a factor eight, too (as the solver iterationsare constant at six). The main deviation is in the sparse matrix between 5kand 36k degrees of freedom, where the time increases by a factor 12. This isthe threshold where the (L3) cache in the processor can no longer hold alldata necessary for the matrix-vector products and all matrix elements must befetched from main memory.</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;* Of course, this picture does not necessarily translate to all cases, as thereare problems where knowledge of matrix entries enables much better solvers (ashappens when the coefficient is varying more strongly than in the aboveexample). Moreover, it also depends on the computer system. The present systemhas good memory performance, so sparse matrices perform comparablywell. Nonetheless, the matrix-free implementation gives a nice speedup alreadyfor the &lt;i&gt;Q&lt;/i&gt;&lt;sub&gt;2&lt;/sub&gt; elements used in this example. This becomesparticularly apparent for time-dependent or nonlinear problems where sparsematrices would need to be reassembled over and over again, which becomes mucheasier with this class. And of course, thanks to the better complexity of theproducts, the method gains increasingly larger advantages when the order of theelements increases (the matrix-free implementation has costs4&lt;i&gt;d&lt;/i&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;i&gt;p&lt;/i&gt; per degree of freedom, compared to2&lt;i&gt;p&lt;sup&gt;d&lt;/sup&gt;&lt;/i&gt; for the sparse matrix, so it will win anyway for order 4and higher in 3d).</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;* &lt;a name=&quot;ResultsforlargescaleparallelcomputationsonSuperMUC&quot;&gt;&lt;/a&gt;&lt;h3&gt; Results for large-scale parallel computations on SuperMUC&lt;/h3&gt;</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;* </div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;* As explained in the introduction and the in-code comments, this program can berun in parallel with MPI. It turns out that geometric multigrid schemes workreally well and can scale to very large machines. To the authors&#39; knowledge,the geometric multigrid results shown here are the largest computations donewith deal.II as of late 2016, run on up to 147,456 cores of the &lt;a</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;href=&quot;https:<span class="comment">//www.lrz.de/services/compute/supermuc/systemdescription/&quot;&gt;complete</span></div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;SuperMUC Phase 1&lt;/a&gt;. The ingredients for scalability beyond 1000 cores arethat no data structure that depends on the global problem size is held in itsentirety on a single processor and that the communication is not too frequentin order not to run into latency issues of the network.  For PDEs solved withiterative solvers, the communication latency is often the limiting factor,rather than the throughput of the network. For the example of the SuperMUCsystem, the point-to-point latency between two processors is between 1e-6 and1e-5 seconds, depending on the proximity in the MPI network. The matrix-vectorproducts with   @p LaplaceOperator   from this class involves severalpoint-to-point communication steps, interleaved with computations on eachcore. The resulting latency of a matrix-vector product is around 1e-4seconds. Global communication, for example an   @p MPI_Allreduce   operation thataccumulates the sum of a single number per rank over all ranks in the MPInetwork, has a latency of 1e-4 seconds. The multigrid V-cycle used in thisprogram is also a form of global communication. Think about the coarse gridsolve that happens on a single processor: It accumulates the contributionsfrom all processors before it starts. When completed, the coarse grid solutionis transferred to finer levels, where more and more processors help insmoothing until the fine grid. Essentially, this is a tree-like pattern overthe processors in the network and controlled by the mesh. As opposed to the  @p MPI_Allreduce   operations where the tree in the reduction is optimized to theactual links in the MPI network, the multigrid V-cycle does this according tothe partitioning of the mesh. Thus, we cannot expect the sameoptimality. Furthermore, the multigrid cycle is not simply a walk up and downthe refinement tree, but also communication on each level when doing thesmoothing. In other words, the global communication in multigrid is morechallenging and related to the mesh that provides less optimizationopportunities. The measured latency of the V-cycle is between 6e-3 and 2e-2seconds, i.e., the same as 60 to 200 MPI_Allreduce operations.</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;* The following figure shows a scaling experiments on   @f$\mathcal Q_3@f$  elements. Along the lines, the problem size is held constant as the number ofcores is increasing. When doubling the number of cores, one expects a halvingof the computational time, indicated by the dotted gray lines. The resultsshow that the implementation shows almost ideal behavior until an absolutetime of around 0.1 seconds is reached. The solver tolerances have been setsuch that the solver performs five iterations. This way of plotting data isthe &lt;b&gt;strong scaling&lt;/b&gt; of the algorithm. As we go to very large corecounts, the curves flatten out a bit earlier, which is because of thecommunication network in SuperMUC where communication between processorsfarther away is slightly slower.</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;*   &lt;img src=&quot;https:<span class="comment">//www.dealii.org/images/steps/developer/step-37.scaling_strong.png&quot; alt=&quot;&quot;&gt;  </span></div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;* In addition, the plot also contains results for &lt;b&gt;weak scaling&lt;/b&gt; that listshow the algorithm behaves as both the number of processor cores and elementsis increased at the same pace. In this situation, we expect that the computetime remains constant. Algorithmically, the number of CG iterations isconstant at 5, so we are good from that end. The lines in the plot arearranged such that the top left point in each data series represents the samesize per processor, namely 131,072 elements (or approximately 3.5 milliondegrees of freedom per core). The gray lines indicating ideal strong scalingare by the same factor of 8 apart. The results show again that the scaling isalmost ideal. The parallel efficiency when going from 288 cores to 147,456cores is at around 75% for a local problem size of 750,000 degrees of freedomper core which takes 1.0s on 288 cores, 1.03s on 2304 cores, 1.19s on 18kcores, and 1.35s on 147k cores. The algorithms also reach a very highutilization of the processor. The largest computation on 147k cores reachesaround 1.7 PFLOPs/s on SuperMUC out of an arithmetic peak of 3.2 PFLOPs/s. Foran iterative PDE solver, this is a very high number and significantly more isoften only reached for dense linear algebra. Sparse linear algebra is limitedto a tenth of this value.</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;* As mentioned in the introduction, the matrix-free method reduces the memoryconsumption of the data structures. Besides the higher performance due to lessmemory transfer, the algorithms also allow for very large problems to fit intomemory. The figure below shows the computational time as we increase theproblem size until an upper limit where the computation exhausts memory. We dothis for 1k cores, 8k cores, and 65k cores and see that the problem size canbe varied over almost two orders of magnitude with ideal scaling. The largestcomputation shown in this picture involves 292 billion (  @f$2.92 \cdot 10^{11}@f$  )degrees of freedom. On a DG computation of 147k cores, the above algorithmswere also run involving up to 549 billion (2^39) DoFs.</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;*   &lt;img src=&quot;https:<span class="comment">//www.dealii.org/images/steps/developer/step-37.scaling_size.png&quot; alt=&quot;&quot;&gt;  </span></div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;* Finally, we note that while performing the tests on the large-scale systemshown above, improvements of the multigrid algorithms in deal.II have beendeveloped. The original version contained the sub-optimal code based onMGSmootherPrecondition where some MPI_Allreduce commands (checking whetherall vector entries are zero) were done on each smoothingoperation on each level, which only became apparent on 65k cores andmore. However, the following picture shows that the improvement already payoff on a smaller scale, here shown on computations on up to 14,336 cores for  @f$\mathcal Q_5@f$   elements:</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;*   &lt;img src=&quot;https:<span class="comment">//www.dealii.org/images/steps/developer/step-37.scaling_oldnew.png&quot; alt=&quot;&quot;&gt;  </span></div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;* </div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;* &lt;a name=&quot;Adaptivity&quot;&gt;&lt;/a&gt;&lt;h3&gt; Adaptivity&lt;/h3&gt;</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;* </div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;* As explained in the code, the algorithm presented here is prepared to run onadaptively refined meshes. If only part of the mesh is refined, the multigridcycle will run with local smoothing and impose Dirichlet conditions along theinterfaces which differ in refinement level for smoothing through the  MatrixFreeOperators::Base   class. Due to the way the degrees of freedom aredistributed over levels, relating the owner of the level cells to the owner ofthe first descendant active cell, there can be an imbalance between differentprocessors in MPI, which limits scalability by a factor of around two to five.</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;* &lt;a name=&quot;Possibilitiesforextensions&quot;&gt;&lt;/a&gt;&lt;h3&gt; Possibilities for extensions&lt;/h3&gt;</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;* </div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;* &lt;a name=&quot;Kellyerrorestimator&quot;&gt;&lt;/a&gt;&lt;h4&gt; Kelly error estimator &lt;/h4&gt;</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;* </div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;* As mentioned above the code is ready for locally adaptive h-refinement.For the Poisson equation one can employ the Kelly error indicator,implemented in the KellyErrorEstimator class. However one needs to be carefulwith the ghost indices of parallel vectors.In order to evaluate the jump terms in the error indicator, each MPI processneeds to know locally relevant DoFs.However   MatrixFree::initialize_dof_vector()   function initializes the vector only withsome locally relevant DoFs.The ghost indices made available in the vector are a tight set of only those indicesthat are touched in the cell integrals (including constraint resolution).This choice has performance reasons, because sending all locally relevant degreesof freedom would be too expensive compared to the matrix-vector product.Consequently the solution vector as-is isnot suitable for the KellyErrorEstimator class.The trick is to change the ghost part of the partition, for example using atemporary vector and   LinearAlgebra::distributed::Vector::copy_locally_owned_data_from()  as shown below.</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;* @code</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;IndexSet locally_relevant_dofs;</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;DoFTools::extract_locally_relevant_dofs(dof_handler, locally_relevant_dofs);</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;LinearAlgebra::distributed::Vector&lt;double&gt; copy_vec(solution);</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;solution.reinit(dof_handler.locally_owned_dofs(),</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;                locally_relevant_dofs,</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;                triangulation.get_communicator());</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;solution.copy_locally_owned_data_from(copy_vec);</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;constraints.distribute(solution);</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;solution.update_ghost_values();</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;@endcode</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;* </div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;* &lt;a name=&quot;Sharedmemoryparallelization&quot;&gt;&lt;/a&gt;&lt;h4&gt; Shared-memory parallelization&lt;/h4&gt;</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;* </div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;* This program is parallelized with MPI only. As an alternative, the MatrixFreeloop can also be issued in hybrid mode, for example by using MPI parallelizingover the nodes of a cluster and with threads through Intel TBB within theshared memory region of one node. To use this, one would need to both set thenumber of threads in the MPI_InitFinalize data structure in the main function,and set the   MatrixFree::AdditionalData::tasks_parallel_scheme   topartition_color to actually do the loop in parallel. This use case isdiscussed in   @ref step_48 &quot;step-48&quot;  .</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;* &lt;a name=&quot;InhomogeneousDirichletboundaryconditions&quot;&gt;&lt;/a&gt;&lt;h4&gt; Inhomogeneous Dirichlet boundary conditions &lt;/h4&gt;</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;* </div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;* The presented program assumes homogeneous Dirichlet boundary conditions. Whengoing to non-homogeneous conditions, the situation is a bit more intricate. Tounderstand how to implement such a setting, let us first recall how thesearise in the mathematical formulation and how they are implemented in amatrix-based variant. In essence, an inhomogeneous Dirichlet condition setssome of the nodal values in the solution to given values rather thandetermining them through the variational principles,@f{eqnarray*}</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;u_h(\mathbf{x}) = \sum_{i\in \mathcal N} \varphi_i(\mathbf{x}) u_i =</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;\sum_{i\in \mathcal N \setminus \mathcal N_D} \varphi_i(\mathbf{x}) u_i +</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;\sum_{i\in \mathcal N_D} \varphi_i(\mathbf{x}) g_i,</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;@f}</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;* where   @f$u_i@f$   denotes the nodal values of the solution and   @f$\mathcal N@f$   denotesthe set of all nodes. The set   @f$\mathcal N_D\subset \mathcal N@f$   is the subsetof the nodes that are subject to Dirichlet boundary conditions where thesolution is forced to equal   @f$u_i = g_i = g(\mathbf{x}_i)@f$   as the interpolationof boundary values on the Dirichlet-constrained node points   @f$i\in \mathcal</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;N_D@f$  . We then insert this solutionrepresentation into the weak form, e.g. the Laplacian shown above, and movethe known quantities to the right hand side:@f{eqnarray*}</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;(\nabla \varphi_i, \nabla u_h)_\Omega &amp;=&amp; (\varphi_i, f)_\Omega \quad \Rightarrow \\</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;\sum_{j\in \mathcal N \setminus \mathcal N_D}(\nabla \varphi_i,\nabla \varphi_j)_\Omega \, u_j &amp;=&amp;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;(\varphi_i, f)_\Omega</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;* </div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;-\sum_{j\in \mathcal N_D} (\nabla \varphi_i,\nabla\varphi_j)_\Omega\, g_j.</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;@f}</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;* In this formula, the equations are tested for all basis functions   @f$\varphi_i@f$  with   @f$i\in N \setminus \mathcal N_D@f$   that are not related to the nodesconstrained by Dirichlet conditions.</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;* In the implementation in deal.II, the integrals   @f$(\nabla \varphi_i,\nabla \varphi_j)_\Omega@f$  on the right hand side are already contained in the local matrix contributionswe assemble on each cell. When using  AffineConstraints::distribute_local_to_global()   as first described in the  @ref step_6 &quot;step-6&quot;   and   @ref step_7 &quot;step-7&quot;   tutorial programs, we can account for the contribution ofinhomogeneous constraints &lt;i&gt;j&lt;/i&gt; by multiplying the columns &lt;i&gt;j&lt;/i&gt; androws &lt;i&gt;i&lt;/i&gt; of the local matrix according to the integrals   @f$(\varphi_i,</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;\varphi_j)_\Omega@f$   by the inhomogeneities and subtracting the resulting fromthe position &lt;i&gt;i&lt;/i&gt; in the global right-hand-side vector, see also the   @ref</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;constraints   module. In essence, we use some of the integrals that geteliminated from the left hand side of the equation to finalize the right handside contribution. Similar mathematics are also involved when first writingall entries into a left hand side matrix and then eliminating matrix rows andcolumns by   MatrixTools::apply_boundary_values().  </div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;* In principle, the components that belong to the constrained degrees of freedomcould be eliminated from the linear system because they do not carry anyinformation. In practice, in deal.II we always keep the size of the linearsystem the same to avoid handling two different numbering systems and avoidconfusion about the two different index sets. In order to ensure that thelinear system does not get singular when not adding anything to constrainedrows, we then add dummy entries to the matrix diagonal that are otherwiseunrelated to the real entries.</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;* In a matrix-free method, we need to take a different approach, since the   @p  LaplaceOperator class represents the matrix-vector product of a&lt;b&gt;homogeneous&lt;/b&gt; operator (the left-hand side of the last formula).  It doesnot matter whether the AffineConstraints object passed to the  MatrixFree::reinit()   contains inhomogeneous constraints or not, the  MatrixFree::cell_loop()   call will only resolve the homogeneous part of theconstraints as long as it represents a &lt;b&gt;linear&lt;/b&gt; operator.</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;* In our matrix-free code, the right hand side computation where thecontribution of inhomogeneous conditions ends up is completely decoupled fromthe matrix operator and handled by a different function above. Thus, we needto explicitly generate the data that enters the right hand side rather thanusing a byproduct of the matrix assembly. Since we already know how to applythe operator on a vector, we could try to use those facilities for a vectorwhere we only set the Dirichlet values:</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;* @code</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;  <span class="comment">// interpolate boundary values on vector solution</span></div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;  std::map&lt;types::global_dof_index, double&gt; boundary_values;</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;  VectorTools::interpolate_boundary_values(mapping,</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;                                           dof_handler,</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;                                           0,</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;                                           BoundaryValueFunction&lt;dim&gt;(),</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;                                           boundary_values);</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;  for (const std::pair&lt;const types::global_dof_index, double&gt; &amp;pair : boundary_values)</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    if (solution.locally_owned_elements().is_element(pair.first))</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;      solution(pair.first) = pair.second;</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;@endcode</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;* or, equivalently, if we already had filled the inhomogeneous constraints intoan AffineConstraints object,</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;* @code</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;  solution = 0;</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;  constraints.distribute(solution);</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;@endcode</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;* </div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;* We could then pass the vector   @p solution   to the   @p    LaplaceOperator::vmult_add()   function and add the new contribution to the   @p  system_rhs vector that gets filled in the   @p LaplaceProblem::assemble_rhs()  function. However, this idea does not work because the  FEEvaluation::read_dof_values()   call used inside the vmult() functions assumeshomogeneous values on all constraints (otherwise the operator would not be alinear operator but an affine one). To also retrieve the values of theinhomogeneities, we could select one of two following strategies.</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;* &lt;a name=&quot;UseFEEvaluationread_dof_values_plaintoavoidresolvingconstraints&quot;&gt;&lt;/a&gt;&lt;h5&gt; Use FEEvaluation::read_dof_values_plain() to avoid resolving constraints &lt;/h5&gt;</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;* </div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;* The class FEEvaluation has a facility that addresses precisely thisrequirement: For non-homogeneous Dirichlet values, we do want to skip theimplicit imposition of homogeneous (Dirichlet) constraints upon reading thedata from the vector   @p solution.   For example, we could extend the   @p    LaplaceProblem::assemble_rhs()   function to deal with inhomogeneous Dirichletvalues as follows, assuming the Dirichlet values have been interpolated intothe object   @p constraints:  </div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;* @code</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;template &lt;int dim&gt;</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;void LaplaceProblem&lt;dim&gt;::assemble_rhs()</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;{</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;  solution = 0;</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;  constraints.distribute(solution);</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;  solution.update_ghost_values();</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;  system_rhs = 0;</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;* </div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;  const Table&lt;2, VectorizedArray&lt;double&gt;&gt; &amp;coefficient = system_matrix.get_coefficient();</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;  FEEvaluation&lt;dim, degree_finite_element&gt; phi(*system_matrix.get_matrix_free());</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;  for (unsigned int cell = 0;</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;       cell &lt; system_matrix.get_matrix_free()-&gt;n_cell_batches();</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;       ++cell)</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    {</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;      phi.reinit(cell);</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;      phi.read_dof_values_plain(solution);</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;      phi.evaluate(EvaluationFlags::gradients);</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;      for (unsigned int q = 0; q &lt; phi.n_q_points; ++q)</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;        {</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;          phi.submit_gradient(-coefficient(cell, q) phi.get_gradient(q), q);</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;          phi.submit_value(make_vectorized_array&lt;double&gt;(1.0), q);</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;        }</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;      phi.integrate(EvaluationFlags::values|EvaluationFlags::gradients);</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;      phi.distribute_local_to_global(system_rhs);</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    }</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;  system_rhs.compress(VectorOperation::add);</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;}</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;@endcode</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;* </div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;* In this code, we replaced the   FEEvaluation::read_dof_values()   function for thetentative solution vector by   FEEvaluation::read_dof_values_plain()   thatignores all constraints. Due to this setup, we must make sure that otherconstraints, e.g. by hanging nodes, are correctly distributed to the inputvector already as they are not resolved as in  FEEvaluation::read_dof_values_plain().   Inside the loop, we then evaluate theLaplacian and repeat the second derivative call with  FEEvaluation::submit_gradient()   from the   @p LaplaceOperator   class, but with thesign switched since we wanted to subtract the contribution of Dirichletconditions on the right hand side vector according to the formula above. Whenwe invoke the   FEEvaluation::integrate()   call, we then set both argumentsregarding the value slot and first derivative slot to true to account for bothterms added in the loop over quadrature points. Once the right hand side isassembled, we then go on to solving the linear system for the homogeneousproblem, say involving a variable   @p solution_update.   After solving, we canadd   @p solution_update   to the   @p solution   vector that contains the final(inhomogeneous) solution.</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;* Note that the negative sign for the Laplacian alongside with a positive signfor the forcing that we needed to build the right hand side is a more generalconcept: We have implemented nothing else than Newton&#39;s method for nonlinearequations, but applied to a linear system. We have used an initial guess forthe variable   @p solution   in terms of the Dirichlet boundary conditions andcomputed a residual   @f$r = f</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;* </div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;- Au_0@f$  . The linear system was then solved as  @f$\Delta u = A^{-1} (f-Au)@f$   and we finally computed   @f$u = u_0 + \Delta u@f$  . For alinear system, we obviously reach the exact solution after a singleiteration. If we wanted to extend the code to a nonlinear problem, we wouldrename the   @p assemble_rhs()   function into a more descriptive name like   @p  assemble_residual() that computes the (weak) form of the residual, whereas the  @p LaplaceOperator::apply_add()   function would get the linearization of theresidual with respect to the solution variable.</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;* &lt;a name=&quot;UseLaplaceOperatorwithasecondAffineConstraintsobjectwithoutDirichletconditions&quot;&gt;&lt;/a&gt;&lt;h5&gt; Use LaplaceOperator with a second AffineConstraints object without Dirichlet conditions &lt;/h5&gt;</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;* </div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;* A second alternative to get the right hand side that re-uses the   @p    LaplaceOperator::apply_add()   function is to instead add a second LaplaceOperatorthat skips Dirichlet constraints. To do this, we initialize a second MatrixFreeobject which does not have any boundary value constraints. This   @p matrix_free  object is then passed to a   @p LaplaceOperator   class instance   @p  inhomogeneous_operator that is only used to create the right hand side:</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;* @code</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;template &lt;int dim&gt;</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;void LaplaceProblem&lt;dim&gt;::assemble_rhs()</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;{</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;  system_rhs = 0;</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;  AffineConstraints&lt;double&gt; no_constraints;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;  no_constraints.close();</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;  LaplaceOperator&lt;dim, degree_finite_element, double&gt; inhomogeneous_operator;</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;* </div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;  typename MatrixFree&lt;dim, double&gt;::AdditionalData additional_data;</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;  additional_data.mapping_update_flags =</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    (update_gradients | update_JxW_values | update_quadrature_points);</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;  std::shared_ptr&lt;MatrixFree&lt;dim, double&gt;&gt; matrix_free(</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    new MatrixFree&lt;dim, double&gt;());</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;  matrix_free-&gt;reinit(dof_handler,</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;                      no_constraints,</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;                      QGauss&lt;1&gt;(fe.degree + 1),</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;                      additional_data);</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;  inhomogeneous_operator.initialize(matrix_free);</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;* </div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;  solution = 0.0;</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;  constraints.distribute(solution);</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;  inhomogeneous_operator.evaluate_coefficient(Coefficient&lt;dim&gt;());</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;  inhomogeneous_operator.vmult(system_rhs, solution);</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;  system_rhs=</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;* </div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;-1.0;</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;* </div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;  FEEvaluation&lt;dim, degree_finite_element&gt; phi(</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;   inhomogeneous_operator.get_matrix_free());</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;  for (unsigned int cell = 0;</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;       cell &lt; inhomogeneous_operator.get_matrix_free()-&gt;n_cell_batches();</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;       ++cell)</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;    {</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;      phi.reinit(cell);</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;      for (unsigned int q = 0; q &lt; phi.n_q_points; ++q)</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;        phi.submit_value(make_vectorized_array&lt;double&gt;(1.0), q);</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;      phi.integrate(EvaluationFlags::values);</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;      phi.distribute_local_to_global(system_rhs);</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;    }</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;  system_rhs.compress(VectorOperation::add);</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;}</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;@endcode</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;* </div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;* A more sophisticated implementation of this technique could reuse the originalMatrixFree object. This can be done by initializing the MatrixFree object withmultiple blocks, where each block corresponds to a different AffineConstraintsobject. Doing this would require making substantial modifications to theLaplaceOperator class, but the   MatrixFreeOperators::LaplaceOperator   class thatcomes with the library can do this. See the discussion on blocks in  MatrixFreeOperators::Base   for more information on how to set up blocks.</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;* </div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;* &lt;a name=&quot;PlainProg&quot;&gt;&lt;/a&gt;&lt;h1&gt; The plain program&lt;/h1&gt;  @include &quot;step-37.cc&quot;  </div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;*</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;*/</div><div class="ttc" id="group__feaccess_html_ggaa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85"><div class="ttname"><a href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a></div><div class="ttdoc">Transformed quadrature weights. </div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00103">fe_update_flags.h:103</a></div></div>
<div class="ttc" id="group__MeshWorker_html_gad10f528ab87f39fbb0531d24f238b2f3"><div class="ttname"><a href="group__MeshWorker.html#gad10f528ab87f39fbb0531d24f238b2f3">MeshWorker::loop</a></div><div class="ttdeci">void loop(ITERATOR begin, typename identity&lt; ITERATOR &gt;::type end, DOFINFO &amp;dinfo, INFOBOX &amp;info, const std::function&lt; void(DOFINFO &amp;, typename INFOBOX::CellInfo &amp;)&gt; &amp;cell_worker, const std::function&lt; void(DOFINFO &amp;, typename INFOBOX::CellInfo &amp;)&gt; &amp;boundary_worker, const std::function&lt; void(DOFINFO &amp;, DOFINFO &amp;, typename INFOBOX::CellInfo &amp;, typename INFOBOX::CellInfo &amp;)&gt; &amp;face_worker, ASSEMBLER &amp;assembler, const LoopControl &amp;lctrl=LoopControl())</div><div class="ttdef"><b>Definition:</b> <a href="loop_8h_source.html#l00449">loop.h:449</a></div></div>
<div class="ttc" id="symmetric__tensor_8h_html_a31fa20712aae4f3b8ab9f62729b464d3"><div class="ttname"><a href="symmetric__tensor_8h.html#a31fa20712aae4f3b8ab9f62729b464d3">determinant</a></div><div class="ttdeci">constexpr Number determinant(const SymmetricTensor&lt; 2, dim, Number &gt; &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="symmetric__tensor_8h_source.html#l02497">symmetric_tensor.h:2497</a></div></div>
<div class="ttc" id="namespacenumbers_html_a8ae36952c7e0cc778b47b5371b3aeff1"><div class="ttname"><a href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a></div><div class="ttdeci">static const unsigned int invalid_unsigned_int</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00167">types.h:167</a></div></div>
<div class="ttc" id="namespaceinternal_html_a38181f4582ff69679bda7d8e31c37291"><div class="ttname"><a href="namespaceinternal.html#a38181f4582ff69679bda7d8e31c37291">internal::reinit</a></div><div class="ttdeci">void reinit(MatrixBlock&lt; MatrixType &gt; &amp;v, const BlockSparsityPattern &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="matrix__block_8h_source.html#l00575">matrix_block.h:575</a></div></div>
<div class="ttc" id="group__Exceptions_html_ga9442b63275c9ef3fab29bc222831c49c"><div class="ttname"><a href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a></div><div class="ttdeci">#define AssertDimension(dim1, dim2)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2exceptions_8h_source.html#l01562">exceptions.h:1562</a></div></div>
<div class="ttc" id="classmg_1_1SmootherRelaxation_html"><div class="ttname"><a href="classmg_1_1SmootherRelaxation.html">mg::SmootherRelaxation</a></div><div class="ttdef"><b>Definition:</b> <a href="mg__smoother_8h_source.html#l00181">mg_smoother.h:181</a></div></div>
<div class="ttc" id="structMatrixFree_1_1AdditionalData_html"><div class="ttname"><a href="structMatrixFree_1_1AdditionalData.html">MatrixFree::AdditionalData</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_8h_source.html#l00128">matrix_free.h:128</a></div></div>
<div class="ttc" id="classAlignedVector_html"><div class="ttname"><a href="classAlignedVector.html">AlignedVector</a></div><div class="ttdef"><b>Definition:</b> <a href="aligned__vector_8h_source.html#l00059">aligned_vector.h:59</a></div></div>
<div class="ttc" id="namespaceLinearAlgebraDealII_html_a9fe13d579422411556954ab3f28a59be"><div class="ttname"><a href="namespaceLinearAlgebraDealII.html#a9fe13d579422411556954ab3f28a59be">LinearAlgebraDealII::Vector</a></div><div class="ttdeci">Vector&lt; double &gt; Vector</div><div class="ttdef"><b>Definition:</b> <a href="generic__linear__algebra_8h_source.html#l00044">generic_linear_algebra.h:44</a></div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_a1a9009db0d9a77923a7031b549b9b638a5bc7c54a9c20485772672825c6a73003"><div class="ttname"><a href="namespaceLAPACKSupport.html#a1a9009db0d9a77923a7031b549b9b638a5bc7c54a9c20485772672825c6a73003">LAPACKSupport::matrix</a></div><div class="ttdoc">Contents is actually a matrix. </div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00060">lapack_support.h:60</a></div></div>
<div class="ttc" id="classMatrixFreeOperators_1_1Base_html"><div class="ttname"><a href="classMatrixFreeOperators_1_1Base.html">MatrixFreeOperators::Base</a></div><div class="ttdef"><b>Definition:</b> <a href="operators_8h_source.html#l00148">operators.h:148</a></div></div>
<div class="ttc" id="namespaceCellSimilarity_html_abbf8aa4eab099bd2356cb51200494c13a4f8507015c458575753e0a45e0c3544a"><div class="ttname"><a href="namespaceCellSimilarity.html#abbf8aa4eab099bd2356cb51200494c13a4f8507015c458575753e0a45e0c3544a">CellSimilarity::translation</a></div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00343">fe_update_flags.h:343</a></div></div>
<div class="ttc" id="namespacePhysics_1_1Elasticity_1_1Kinematics_html_a9587d5229555daa5b1fa1ba2f8a40adb"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">Physics::Elasticity::Kinematics::e</a></div><div class="ttdeci">SymmetricTensor&lt; 2, dim, Number &gt; e(const Tensor&lt; 2, dim, Number &gt; &amp;F)</div></div>
<div class="ttc" id="structMatrixFree_1_1AdditionalData_html_a67c9ff01c51fb7fb3ada151b83cdd409"><div class="ttname"><a href="structMatrixFree_1_1AdditionalData.html#a67c9ff01c51fb7fb3ada151b83cdd409">MatrixFree::AdditionalData::mg_level</a></div><div class="ttdeci">unsigned int mg_level</div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_8h_source.html#l00325">matrix_free.h:325</a></div></div>
<div class="ttc" id="classFEEvaluationBase_html_a0660b27a2a592994dfd2fc917305a3ac"><div class="ttname"><a href="classFEEvaluationBase.html#a0660b27a2a592994dfd2fc917305a3ac">FEEvaluationBase::get_dof_value</a></div><div class="ttdeci">value_type get_dof_value(const unsigned int dof) const</div></div>
<div class="ttc" id="classMatrixFreeOperators_1_1LaplaceOperator_html_a333615858395e4c73be651f22b46f910"><div class="ttname"><a href="classMatrixFreeOperators_1_1LaplaceOperator.html#a333615858395e4c73be651f22b46f910">MatrixFreeOperators::LaplaceOperator::LaplaceOperator</a></div><div class="ttdeci">LaplaceOperator()</div><div class="ttdef"><b>Definition:</b> <a href="operators_8h_source.html#l01796">operators.h:1796</a></div></div>
<div class="ttc" id="classVector_html"><div class="ttname"><a href="classVector.html">Vector</a></div><div class="ttdef"><b>Definition:</b> <a href="mapping__q1__eulerian_8h_source.html#l00033">mapping_q1_eulerian.h:33</a></div></div>
<div class="ttc" id="classAffineConstraints_html"><div class="ttname"><a href="classAffineConstraints.html">AffineConstraints</a></div><div class="ttdef"><b>Definition:</b> <a href="affine__constraints_8h_source.html#l00435">affine_constraints.h:435</a></div></div>
<div class="ttc" id="classVectorizedArray_html"><div class="ttname"><a href="classVectorizedArray.html">VectorizedArray</a></div><div class="ttdef"><b>Definition:</b> <a href="vectorization_8h_source.html#l00409">vectorization.h:409</a></div></div>
<div class="ttc" id="namespaceinternal_html_aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804"><div class="ttname"><a href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">internal::EvaluatorQuantity::value</a></div></div>
<div class="ttc" id="classPreconditionChebyshev_html"><div class="ttname"><a href="classPreconditionChebyshev.html">PreconditionChebyshev</a></div><div class="ttdef"><b>Definition:</b> <a href="precondition_8h_source.html#l00949">precondition.h:949</a></div></div>
<div class="ttc" id="classMGLevelObject_html"><div class="ttname"><a href="classMGLevelObject.html">MGLevelObject</a></div><div class="ttdef"><b>Definition:</b> <a href="mg__level__object_8h_source.html#l00045">mg_level_object.h:45</a></div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_aee5ef58d11434eb1d6a665e64bf17292"><div class="ttname"><a href="namespaceLAPACKSupport.html#aee5ef58d11434eb1d6a665e64bf17292">LAPACKSupport::V</a></div><div class="ttdeci">static const char V</div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00188">lapack_support.h:188</a></div></div>
<div class="ttc" id="namespacestd_html"><div class="ttname"><a href="namespacestd.html">std</a></div><div class="ttdoc">STL namespace. </div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_aceda56512460bbad2f9fdb8a3d0e1e51"><div class="ttname"><a href="namespaceLAPACKSupport.html#aceda56512460bbad2f9fdb8a3d0e1e51">LAPACKSupport::one</a></div><div class="ttdeci">static const types::blas_int one</div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00198">lapack_support.h:198</a></div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_a3e681d2d74dcf90f6556706d66f81a0d"><div class="ttname"><a href="namespaceLAPACKSupport.html#a3e681d2d74dcf90f6556706d66f81a0d">LAPACKSupport::U</a></div><div class="ttdeci">static const char U</div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00178">lapack_support.h:178</a></div></div>
<div class="ttc" id="classdouble_html"><div class="ttname"><a href="classdouble.html">double</a></div></div>
<div class="ttc" id="group__feaccess_html_ggaa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a"><div class="ttname"><a href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a></div><div class="ttdoc">Transformed quadrature points. </div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00097">fe_update_flags.h:97</a></div></div>
<div class="ttc" id="structidentity_html"><div class="ttname"><a href="structidentity.html">identity</a></div><div class="ttdef"><b>Definition:</b> <a href="template__constraints_8h_source.html#l00184">template_constraints.h:184</a></div></div>
<div class="ttc" id="structMatrixFree_1_1AdditionalData_html_a5b3198735af965d2fc5019543263f927a70ba08215ce330f13a3fd33adbd977a9"><div class="ttname"><a href="structMatrixFree_1_1AdditionalData.html#a5b3198735af965d2fc5019543263f927a70ba08215ce330f13a3fd33adbd977a9">MatrixFree::AdditionalData::none</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_8h_source.html#l00142">matrix_free.h:142</a></div></div>
<div class="ttc" id="grid__out_8cc_html_a2cc229a4f1ffc75e83ed269d5f725729"><div class="ttname"><a href="grid__out_8cc.html#a2cc229a4f1ffc75e83ed269d5f725729">second</a></div><div class="ttdeci">Point&lt; 2 &gt; second</div><div class="ttdef"><b>Definition:</b> <a href="grid__out_8cc_source.html#l04588">grid_out.cc:4588</a></div></div>
<div class="ttc" id="structMatrixFree_1_1AdditionalData_html_aa5d597e6c4441d273f4100b6139a2552"><div class="ttname"><a href="structMatrixFree_1_1AdditionalData.html#aa5d597e6c4441d273f4100b6139a2552">MatrixFree::AdditionalData::mapping_update_flags</a></div><div class="ttdeci">UpdateFlags mapping_update_flags</div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_8h_source.html#l00285">matrix_free.h:285</a></div></div>
<div class="ttc" id="classMGLevelObject_html_a16213121f9153bd08f49652a11886259"><div class="ttname"><a href="classMGLevelObject.html#a16213121f9153bd08f49652a11886259">MGLevelObject::resize</a></div><div class="ttdeci">void resize(const unsigned int new_minlevel, const unsigned int new_maxlevel, Args &amp;&amp;... args)</div><div class="ttdef"><b>Definition:</b> <a href="mg__level__object_8h_source.html#l00212">mg_level_object.h:212</a></div></div>
<div class="ttc" id="namespaceWorkStream_html"><div class="ttname"><a href="namespaceWorkStream.html">WorkStream</a></div><div class="ttdef"><b>Definition:</b> <a href="work__stream_8h_source.html#l00079">work_stream.h:79</a></div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_ae4c4142bb80d7e6e5214c37fac73e1da"><div class="ttname"><a href="namespaceLAPACKSupport.html#ae4c4142bb80d7e6e5214c37fac73e1da">LAPACKSupport::O</a></div><div class="ttdeci">static const char O</div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00168">lapack_support.h:168</a></div></div>
<div class="ttc" id="classLinearAlgebra_1_1distributed_1_1Vector_html_a3db2bea96180138f039b9d2934534492"><div class="ttname"><a href="classLinearAlgebra_1_1distributed_1_1Vector.html#a3db2bea96180138f039b9d2934534492">LinearAlgebra::distributed::Vector::locally_owned_size</a></div><div class="ttdeci">size_type locally_owned_size() const</div></div>
<div class="ttc" id="classPoint_html"><div class="ttname"><a href="classPoint.html">Point&lt; dim &gt;</a></div></div>
<div class="ttc" id="namespaceVectorTools_1_1EvaluationFlags_html_ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420"><div class="ttname"><a href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420">VectorTools::EvaluationFlags::max</a></div><div class="ttdef"><b>Definition:</b> <a href="vector__tools__evaluate_8h_source.html#l00057">vector_tools_evaluate.h:57</a></div></div>
<div class="ttc" id="namespaceparallel_html"><div class="ttname"><a href="namespaceparallel.html">parallel</a></div><div class="ttdef"><b>Definition:</b> <a href="doc_2doxygen_2headers_2distributed_8h_source.html#l00150">distributed.h:150</a></div></div>
<div class="ttc" id="classMatrixFree_html"><div class="ttname"><a href="classMatrixFree.html">MatrixFree</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_8h_source.html#l00093">matrix_free.h:93</a></div></div>
<div class="ttc" id="namespaceDoFTools_html_a1fef7be07cf379b661646e39b9354e17"><div class="ttname"><a href="namespaceDoFTools.html#a1fef7be07cf379b661646e39b9354e17">DoFTools::extract_locally_relevant_level_dofs</a></div><div class="ttdeci">void extract_locally_relevant_level_dofs(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, const unsigned int level, IndexSet &amp;dof_set)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools_8cc_source.html#l01175">dof_tools.cc:1175</a></div></div>
<div class="ttc" id="classMappingQ1_html"><div class="ttname"><a href="classMappingQ1.html">MappingQ1</a></div><div class="ttdef"><b>Definition:</b> <a href="mapping__q1_8h_source.html#l00046">mapping_q1.h:46</a></div></div>
<div class="ttc" id="structVectorOperation_html_a40c50779cd14ba89bbf0bd9b4561964cae1077e8dbf4afea5d2df8c8b723c0708"><div class="ttname"><a href="structVectorOperation.html#a40c50779cd14ba89bbf0bd9b4561964cae1077e8dbf4afea5d2df8c8b723c0708">VectorOperation::add</a></div><div class="ttdef"><b>Definition:</b> <a href="vector__operation_8h_source.html#l00057">vector_operation.h:57</a></div></div>
<div class="ttc" id="classFEEvaluation_html_a710c252e9dccc0c4ce07044cac3bdd9b"><div class="ttname"><a href="classFEEvaluation.html#a710c252e9dccc0c4ce07044cac3bdd9b">FEEvaluation::evaluate</a></div><div class="ttdeci">void evaluate(const EvaluationFlags::EvaluationFlags evaluation_flag)</div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86"><div class="ttname"><a href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98a9f7392eb627119096334bd291f1d1e86">LAPACKSupport::diagonal</a></div><div class="ttdoc">Matrix is diagonal. </div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00122">lapack_support.h:122</a></div></div>
<div class="ttc" id="namespaceThreads_1_1internal_html_a8d237a30d09b13e0b5adbe0fd1dfb188"><div class="ttname"><a href="namespaceThreads_1_1internal.html#a8d237a30d09b13e0b5adbe0fd1dfb188">Threads::internal::call</a></div><div class="ttdeci">void call(const std::function&lt; RT()&gt; &amp;function, internal::return_value&lt; RT &gt; &amp;ret_val)</div><div class="ttdef"><b>Definition:</b> <a href="thread__management_8h_source.html#l00346">thread_management.h:346</a></div></div>
<div class="ttc" id="namespaceMatrixFreeOperators_html"><div class="ttname"><a href="namespaceMatrixFreeOperators.html">MatrixFreeOperators</a></div><div class="ttdef"><b>Definition:</b> <a href="operators_8h_source.html#l00040">operators.h:40</a></div></div>
<div class="ttc" id="classLinearAlgebra_1_1distributed_1_1Vector_html_a1c4bc946b94f19d7e11c00f41a39db02"><div class="ttname"><a href="classLinearAlgebra_1_1distributed_1_1Vector.html#a1c4bc946b94f19d7e11c00f41a39db02">LinearAlgebra::distributed::Vector::local_element</a></div><div class="ttdeci">Number local_element(const size_type local_index) const</div></div>
<div class="ttc" id="classQGauss_html"><div class="ttname"><a href="classQGauss.html">QGauss</a></div><div class="ttdef"><b>Definition:</b> <a href="quadrature__lib_8h_source.html#l00039">quadrature_lib.h:39</a></div></div>
<div class="ttc" id="namespaceTriangulationDescription_html_aa1531298eb0a267d9ceca5eb46ada8e0acc0ed1c2dd30bca7c7576e65b4045274"><div class="ttname"><a href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0acc0ed1c2dd30bca7c7576e65b4045274">TriangulationDescription::construct_multigrid_hierarchy</a></div><div class="ttdef"><b>Definition:</b> <a href="tria__description_8h_source.html#l00228">tria_description.h:228</a></div></div>
<div class="ttc" id="vectorization_8h_html_a31b02447b71a04a1ec9bdd1358751e45a465289687a70db7aa7217cc240c29f0f"><div class="ttname"><a href="vectorization_8h.html#a31b02447b71a04a1ec9bdd1358751e45a465289687a70db7aa7217cc240c29f0f">SIMDComparison::equal</a></div></div>
<div class="ttc" id="group__Exceptions_html_gae9a45f517af1401c50811a11083f9114"><div class="ttname"><a href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">StandardExceptions::ExcMessage</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcMessage(std::string arg1)</div></div>
<div class="ttc" id="classFE__Q_html"><div class="ttname"><a href="classFE__Q.html">FE_Q</a></div><div class="ttdef"><b>Definition:</b> <a href="fe__q_8h_source.html#l00554">fe_q.h:554</a></div></div>
<div class="ttc" id="namespaceUtilities_html_a6155277fd058eddb1504f9562cb1c04d"><div class="ttname"><a href="namespaceUtilities.html#a6155277fd058eddb1504f9562cb1c04d">Utilities::compress</a></div><div class="ttdeci">std::string compress(const std::string &amp;input)</div><div class="ttdef"><b>Definition:</b> <a href="base_2utilities_8cc_source.html#l00392">utilities.cc:392</a></div></div>
<div class="ttc" id="classMatrixFreeOperators_1_1Base_html_af4f39d8232619d499709aa6ee968db58"><div class="ttname"><a href="classMatrixFreeOperators_1_1Base.html#af4f39d8232619d499709aa6ee968db58">MatrixFreeOperators::Base::vmult_interface_up</a></div><div class="ttdeci">void vmult_interface_up(VectorType &amp;dst, const VectorType &amp;src) const</div><div class="ttdef"><b>Definition:</b> <a href="operators_8h_source.html#l01446">operators.h:1446</a></div></div>
<div class="ttc" id="namespaceEvaluationFlags_html_a9b7c6d689cb76386839d0d13640f59aea91b5f00e4be473005cc331b8644ab2f1"><div class="ttname"><a href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aea91b5f00e4be473005cc331b8644ab2f1">EvaluationFlags::gradients</a></div><div class="ttdef"><b>Definition:</b> <a href="evaluation__flags_8h_source.html#l00059">evaluation_flags.h:59</a></div></div>
<div class="ttc" id="classMatrixFree_html_abc204ec41ead1b5060f47ef3a5a066d7"><div class="ttname"><a href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">MatrixFree::cell_loop</a></div><div class="ttdeci">void cell_loop(const std::function&lt; void(const MatrixFree&lt; dim, Number, VectorizedArrayType &gt; &amp;, OutVector &amp;, const InVector &amp;, const std::pair&lt; unsigned int, unsigned int &gt; &amp;)&gt; &amp;cell_operation, OutVector &amp;dst, const InVector &amp;src, const bool zero_dst_vector=false) const</div></div>
<div class="ttc" id="namespaceUtilities_1_1MPI_html_ab544a3bf3301a6dd3e705ee352c5551b"><div class="ttname"><a href="namespaceUtilities_1_1MPI.html#ab544a3bf3301a6dd3e705ee352c5551b">Utilities::MPI::sum</a></div><div class="ttdeci">T sum(const T &amp;t, const MPI_Comm &amp;mpi_communicator)</div></div>
<div class="ttc" id="classTimer_html_a6f3e76707411b51e7d7e7bfa5755cf02"><div class="ttname"><a href="classTimer.html#a6f3e76707411b51e7d7e7bfa5755cf02">Timer::wall_time</a></div><div class="ttdeci">double wall_time() const</div><div class="ttdef"><b>Definition:</b> <a href="timer_8cc_source.html#l00264">timer.cc:264</a></div></div>
<div class="ttc" id="classMGTransferMatrixFree_html"><div class="ttname"><a href="classMGTransferMatrixFree.html">MGTransferMatrixFree</a></div><div class="ttdef"><b>Definition:</b> <a href="mg__transfer__matrix__free_8h_source.html#l00049">mg_transfer_matrix_free.h:49</a></div></div>
<div class="ttc" id="classMultigrid_html"><div class="ttname"><a href="classMultigrid.html">Multigrid</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_8h_source.html#l00144">multigrid.h:144</a></div></div>
<div class="ttc" id="group__Exceptions_html_ga70a0bb353656e704acf927945277bbc6"><div class="ttname"><a href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a></div><div class="ttdeci">#define Assert(cond, exc)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2exceptions_8h_source.html#l01415">exceptions.h:1415</a></div></div>
<div class="ttc" id="namespacestd__cxx17_html_aa2fc1031c06af4aea4de90c5a1905473"><div class="ttname"><a href="namespacestd__cxx17.html#aa2fc1031c06af4aea4de90c5a1905473">std_cxx17::apply</a></div><div class="ttdeci">auto apply(F &amp;&amp;fn, Tuple &amp;&amp;t) -&gt; decltype(apply_impl(std::forward&lt; F &gt;(fn), std::forward&lt; Tuple &gt;(t), std::make_index_sequence&lt; std::tuple_size&lt; typename std::remove_reference&lt; Tuple &gt;::type &gt;::value &gt;()))</div><div class="ttdef"><b>Definition:</b> <a href="tuple_8h_source.html#l00036">tuple.h:36</a></div></div>
<div class="ttc" id="classLinearAlgebra_1_1distributed_1_1Vector_html"><div class="ttname"><a href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector</a></div><div class="ttdef"><b>Definition:</b> <a href="la__parallel__vector_8h_source.html#l00121">la_parallel_vector.h:121</a></div></div>
<div class="ttc" id="classMatrixFreeOperators_1_1Base_html_a10f5ef7a9f7c90c973d9ddf18d05a21a"><div class="ttname"><a href="classMatrixFreeOperators_1_1Base.html#a10f5ef7a9f7c90c973d9ddf18d05a21a">MatrixFreeOperators::Base::Base</a></div><div class="ttdeci">Base()</div><div class="ttdef"><b>Definition:</b> <a href="operators_8h_source.html#l00986">operators.h:986</a></div></div>
<div class="ttc" id="classMGCoarseGridApplySmoother_html"><div class="ttname"><a href="classMGCoarseGridApplySmoother.html">MGCoarseGridApplySmoother</a></div><div class="ttdef"><b>Definition:</b> <a href="mg__coarse_8h_source.html#l00040">mg_coarse.h:40</a></div></div>
<div class="ttc" id="namespaceinternal_html_aa5bef221c94bc6b9c5441c306a72cdbaae2b6dfb8a5c48206992d8310d176c37c"><div class="ttname"><a href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaae2b6dfb8a5c48206992d8310d176c37c">internal::EvaluatorQuantity::gradient</a></div></div>
<div class="ttc" id="group__dofs_html_ga768cd565b5c25f1ac235586e36ac94d6"><div class="ttname"><a href="group__dofs.html#ga768cd565b5c25f1ac235586e36ac94d6">hp::DoFHandler</a></div><div class="ttdeci">::DoFHandler&lt; dim, spacedim &gt; DoFHandler</div><div class="ttdef"><b>Definition:</b> <a href="hp_2dof__handler_8h_source.html#l00054">dof_handler.h:54</a></div></div>
<div class="ttc" id="classSparseMatrix_html"><div class="ttname"><a href="classSparseMatrix.html">SparseMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="sparse__matrix_8h_source.html#l00479">sparse_matrix.h:479</a></div></div>
<div class="ttc" id="structVectorOperation_html"><div class="ttname"><a href="structVectorOperation.html">VectorOperation</a></div><div class="ttdef"><b>Definition:</b> <a href="vector__operation_8h_source.html#l00039">vector_operation.h:39</a></div></div>
<div class="ttc" id="grid__out_8cc_html_a9082f945c1d289684d0bcd51ee08e11e"><div class="ttname"><a href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a></div><div class="ttdeci">unsigned int level</div><div class="ttdef"><b>Definition:</b> <a href="grid__out_8cc_source.html#l04590">grid_out.cc:4590</a></div></div>
<div class="ttc" id="namespaceTrilinosWrappers_1_1internal_html_aee42c8e3004e2e81eac3c3356d3ec46b"><div class="ttname"><a href="namespaceTrilinosWrappers_1_1internal.html#aee42c8e3004e2e81eac3c3356d3ec46b">TrilinosWrappers::internal::end</a></div><div class="ttdeci">VectorType::value_type * end(VectorType &amp;V)</div><div class="ttdef"><b>Definition:</b> <a href="trilinos__sparse__matrix_8cc_source.html#l00067">trilinos_sparse_matrix.cc:67</a></div></div>
<div class="ttc" id="classFEEvaluation_html_a5e77cd8900f05a73a91ca8edf31f4a91"><div class="ttname"><a href="classFEEvaluation.html#a5e77cd8900f05a73a91ca8edf31f4a91">FEEvaluation::reinit</a></div><div class="ttdeci">void reinit(const unsigned int cell_batch_index)</div></div>
<div class="ttc" id="data__out__base_8cc_html_accc45da40beb7ae1b485306984e904a2"><div class="ttname"><a href="data__out__base_8cc.html#accc45da40beb7ae1b485306984e904a2">vertices</a></div><div class="ttdeci">Point&lt; 3 &gt; vertices[4]</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8cc_source.html#l00175">data_out_base.cc:175</a></div></div>
<div class="ttc" id="classTriangulation_html"><div class="ttname"><a href="classTriangulation.html">Triangulation&lt; dim &gt;</a></div></div>
<div class="ttc" id="classIndexSet_html"><div class="ttname"><a href="classIndexSet.html">IndexSet</a></div><div class="ttdef"><b>Definition:</b> <a href="index__set_8h_source.html#l00063">index_set.h:63</a></div></div>
<div class="ttc" id="classMatrixFreeOperators_1_1Base_html_a7a36adee9e3c0ad068afbeed9b0018ce"><div class="ttname"><a href="classMatrixFreeOperators_1_1Base.html#a7a36adee9e3c0ad068afbeed9b0018ce">MatrixFreeOperators::Base::clear</a></div><div class="ttdeci">virtual void clear()</div><div class="ttdef"><b>Definition:</b> <a href="operators_8h_source.html#l01023">operators.h:1023</a></div></div>
<div class="ttc" id="namespaceAdaptationStrategies_1_1Refinement_html_a0fda1b577bf969eb15b3992120d682a3"><div class="ttname"><a href="namespaceAdaptationStrategies_1_1Refinement.html#a0fda1b577bf969eb15b3992120d682a3">AdaptationStrategies::Refinement::split</a></div><div class="ttdeci">std::vector&lt; value_type &gt; split(const typename ::Triangulation&lt; dim, spacedim &gt;::cell_iterator &amp;parent, const value_type parent_value)</div></div>
<div class="ttc" id="namespaceLinearAlgebra_html"><div class="ttname"><a href="namespaceLinearAlgebra.html">LinearAlgebra</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2communication__pattern__base_8h_source.html#l00027">communication_pattern_base.h:27</a></div></div>
<div class="ttc" id="structMatrixFree_1_1AdditionalData_html_a0bcce2facca91b925d3e1a5a00c7704b"><div class="ttname"><a href="structMatrixFree_1_1AdditionalData.html#a0bcce2facca91b925d3e1a5a00c7704b">MatrixFree::AdditionalData::tasks_parallel_scheme</a></div><div class="ttdeci">TasksParallelScheme tasks_parallel_scheme</div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_8h_source.html#l00271">matrix_free.h:271</a></div></div>
<div class="ttc" id="classMatrixFreeOperators_1_1Base_html_a11ff9854b4433dc8a7795d1c117de2c3"><div class="ttname"><a href="classMatrixFreeOperators_1_1Base.html#a11ff9854b4433dc8a7795d1c117de2c3">MatrixFreeOperators::Base::set_constrained_entries_to_one</a></div><div class="ttdeci">void set_constrained_entries_to_one(VectorType &amp;dst) const</div><div class="ttdef"><b>Definition:</b> <a href="operators_8h_source.html#l01212">operators.h:1212</a></div></div>
<div class="ttc" id="classMatrixFree_html_a8c9d964339b466bdcb661552e731e222"><div class="ttname"><a href="classMatrixFree.html#a8c9d964339b466bdcb661552e731e222">MatrixFree::n_cell_batches</a></div><div class="ttdeci">unsigned int n_cell_batches() const</div></div>
<div class="ttc" id="classMatrixFreeOperators_1_1LaplaceOperator_html_afb746cb7df623be9c68536ca208bd48a"><div class="ttname"><a href="classMatrixFreeOperators_1_1LaplaceOperator.html#afb746cb7df623be9c68536ca208bd48a">MatrixFreeOperators::LaplaceOperator::clear</a></div><div class="ttdeci">virtual void clear() override</div><div class="ttdef"><b>Definition:</b> <a href="operators_8h_source.html#l01814">operators.h:1814</a></div></div>
<div class="ttc" id="namespacePhysics_1_1Elasticity_1_1Kinematics_html_a15728437b942dab0b0042eb06a407d2c"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">Physics::Elasticity::Kinematics::d</a></div><div class="ttdeci">SymmetricTensor&lt; 2, dim, Number &gt; d(const Tensor&lt; 2, dim, Number &gt; &amp;F, const Tensor&lt; 2, dim, Number &gt; &amp;dF_dt)</div></div>
<div class="ttc" id="namespaceinternal_html_a2b3d48efdf7c94da455dc6a3553bab79"><div class="ttname"><a href="namespaceinternal.html#a2b3d48efdf7c94da455dc6a3553bab79">internal::assemble</a></div><div class="ttdeci">void assemble(const MeshWorker::DoFInfoBox&lt; dim, DOFINFO &gt; &amp;dinfo, A *assembler)</div><div class="ttdef"><b>Definition:</b> <a href="loop_8h_source.html#l00073">loop.h:73</a></div></div>
<div class="ttc" id="classmg_1_1Matrix_html"><div class="ttname"><a href="classmg_1_1Matrix.html">mg::Matrix</a></div><div class="ttdef"><b>Definition:</b> <a href="mg__matrix_8h_source.html#l00044">mg_matrix.h:44</a></div></div>
<div class="ttc" id="namespaceinternal_1_1TriangulationImplementation_html_a9f815604be9b560fea00beef8d720480"><div class="ttname"><a href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">internal::TriangulationImplementation::n_cells</a></div><div class="ttdeci">unsigned int n_cells(const internal::TriangulationImplementation::NumberCache&lt; 1 &gt; &amp;c)</div><div class="ttdef"><b>Definition:</b> <a href="grid_2tria_8cc_source.html#l12588">tria.cc:12588</a></div></div>
<div class="ttc" id="grid__out_8cc_html_a827a345f29da7caeb588b11013869a01"><div class="ttname"><a href="grid__out_8cc.html#a827a345f29da7caeb588b11013869a01">first</a></div><div class="ttdeci">Point&lt; 2 &gt; first</div><div class="ttdef"><b>Definition:</b> <a href="grid__out_8cc_source.html#l04587">grid_out.cc:4587</a></div></div>
<div class="ttc" id="classTimer_html_a4e3933a78790d7455daff5acab3f8432"><div class="ttname"><a href="classTimer.html#a4e3933a78790d7455daff5acab3f8432">Timer::cpu_time</a></div><div class="ttdeci">double cpu_time() const</div><div class="ttdef"><b>Definition:</b> <a href="timer_8cc_source.html#l00236">timer.cc:236</a></div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_a40707d49114d54318c823f3b750e89a4"><div class="ttname"><a href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">LAPACKSupport::A</a></div><div class="ttdeci">static const char A</div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00158">lapack_support.h:158</a></div></div>
<div class="ttc" id="classAffineConstraints_html_a2c9d71b5b7e8851c25a411ccf34de986"><div class="ttname"><a href="classAffineConstraints.html#a2c9d71b5b7e8851c25a411ccf34de986">AffineConstraints::reinit</a></div><div class="ttdeci">void reinit(const IndexSet &amp;local_constraints=IndexSet())</div></div>
<div class="ttc" id="classMGCoarseGridApplySmoother_html_a499c7364e40031332e9943a2e5f331a2"><div class="ttname"><a href="classMGCoarseGridApplySmoother.html#a499c7364e40031332e9943a2e5f331a2">MGCoarseGridApplySmoother::initialize</a></div><div class="ttdeci">void initialize(const MGSmootherBase&lt; VectorType &gt; &amp;coarse_smooth)</div></div>
<div class="ttc" id="group__CUDAWrappers_html_gabb7130e2cea54654455ca41ef304f939"><div class="ttname"><a href="group__CUDAWrappers.html#gabb7130e2cea54654455ca41ef304f939">LinearAlgebra::CUDAWrappers::kernel::set</a></div><div class="ttdeci">__global__ void set(Number *val, const Number s, const size_type N)</div></div>
<div class="ttc" id="classTimer_html_aa3f7871196bb56202af2bc982bfbfff6"><div class="ttname"><a href="classTimer.html#aa3f7871196bb56202af2bc982bfbfff6">Timer::restart</a></div><div class="ttdeci">void restart()</div><div class="ttdef"><b>Definition:</b> <a href="timer_8h_source.html#l00841">timer.h:841</a></div></div>
<div class="ttc" id="namespaceUtilities_html"><div class="ttname"><a href="namespaceUtilities.html">Utilities</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2communication__pattern__base_8h_source.html#l00031">communication_pattern_base.h:31</a></div></div>
<div class="ttc" id="classDiagonalMatrix_html"><div class="ttname"><a href="classDiagonalMatrix.html">DiagonalMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="diagonal__matrix_8h_source.html#l00048">diagonal_matrix.h:48</a></div></div>
<div class="ttc" id="namespaceVectorTools_html_af27ac28c698a9ed0199faed50a204538"><div class="ttname"><a href="namespaceVectorTools.html#af27ac28c698a9ed0199faed50a204538">VectorTools::interpolate_boundary_values</a></div><div class="ttdeci">void interpolate_boundary_values(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const std::map&lt; types::boundary_id, const Function&lt; spacedim, number &gt; *&gt; &amp;function_map, std::map&lt; types::global_dof_index, number &gt; &amp;boundary_values, const ComponentMask &amp;component_mask=ComponentMask())</div></div>
<div class="ttc" id="namespaceTrilinosWrappers_1_1internal_html_ad88a9499e01173b35d78413e5945e020"><div class="ttname"><a href="namespaceTrilinosWrappers_1_1internal.html#ad88a9499e01173b35d78413e5945e020">TrilinosWrappers::internal::begin</a></div><div class="ttdeci">VectorType::value_type * begin(VectorType &amp;V)</div><div class="ttdef"><b>Definition:</b> <a href="trilinos__sparse__matrix_8cc_source.html#l00053">trilinos_sparse_matrix.cc:53</a></div></div>
<div class="ttc" id="group__feaccess_html_ggaa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20"><div class="ttname"><a href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a></div><div class="ttdoc">Shape function gradients. </div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00068">fe_update_flags.h:68</a></div></div>
<div class="ttc" id="classMatrixFreeOperators_1_1Base_html_a21cefa5a5d4cb726180c89962d8ae472"><div class="ttname"><a href="classMatrixFreeOperators_1_1Base.html#a21cefa5a5d4cb726180c89962d8ae472">MatrixFreeOperators::Base::vmult_interface_down</a></div><div class="ttdeci">void vmult_interface_down(VectorType &amp;dst, const VectorType &amp;src) const</div><div class="ttdef"><b>Definition:</b> <a href="operators_8h_source.html#l01392">operators.h:1392</a></div></div>
<div class="ttc" id="classFunctions_1_1ZeroFunction_html"><div class="ttname"><a href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction</a></div><div class="ttdef"><b>Definition:</b> <a href="function_8h_source.html#l00444">function.h:444</a></div></div>
<div class="ttc" id="classDoFHandler_html"><div class="ttname"><a href="classDoFHandler.html">DoFHandler&lt; dim &gt;</a></div></div>
<div class="ttc" id="namespacenumbers_html"><div class="ttname"><a href="namespacenumbers.html">numbers</a></div><div class="ttdef"><b>Definition:</b> <a href="numbers_8h_source.html#l00187">numbers.h:187</a></div></div>
<div class="ttc" id="classFEValues_html"><div class="ttname"><a href="classFEValues.html">FEValues</a></div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2fe_2fe_8h_source.html#l00039">fe.h:39</a></div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_a45557450a3c1ae0e74d7ddf12c43bc98af25b68380698c53fa6da3e05379c0855"><div class="ttname"><a href="namespaceLAPACKSupport.html#a45557450a3c1ae0e74d7ddf12c43bc98af25b68380698c53fa6da3e05379c0855">LAPACKSupport::general</a></div><div class="ttdoc">No special properties. </div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00114">lapack_support.h:114</a></div></div>
<div class="ttc" id="namespaceUtilities_1_1MPI_html_a895dcd8223a0ee6f0e6a80b80e2d5982"><div class="ttname"><a href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">Utilities::MPI::this_mpi_process</a></div><div class="ttdeci">unsigned int this_mpi_process(const MPI_Comm &amp;mpi_communicator)</div><div class="ttdef"><b>Definition:</b> <a href="mpi_8cc_source.html#l00128">mpi.cc:128</a></div></div>
<div class="ttc" id="classMatrixFreeOperators_1_1MGInterfaceOperator_html"><div class="ttname"><a href="classMatrixFreeOperators_1_1MGInterfaceOperator.html">MatrixFreeOperators::MGInterfaceOperator</a></div><div class="ttdef"><b>Definition:</b> <a href="operators_8h_source.html#l00477">operators.h:477</a></div></div>
<div class="ttc" id="classTable_html"><div class="ttname"><a href="classTable.html">Table</a></div><div class="ttdef"><b>Definition:</b> <a href="array__view_8h_source.html#l00034">array_view.h:34</a></div></div>
<div class="ttc" id="classMGConstrainedDoFs_html"><div class="ttname"><a href="classMGConstrainedDoFs.html">MGConstrainedDoFs</a></div><div class="ttdef"><b>Definition:</b> <a href="mg__constrained__dofs_8h_source.html#l00049">mg_constrained_dofs.h:49</a></div></div>
<div class="ttc" id="classparallel_1_1distributed_1_1Triangulation_html"><div class="ttname"><a href="classparallel_1_1distributed_1_1Triangulation.html">parallel::distributed::Triangulation&lt; dim &gt;</a></div></div>
<div class="ttc" id="namespaceOpenCASCADE_html_a9509efa83e3b2fa42616fe0623cba696"><div class="ttname"><a href="namespaceOpenCASCADE.html#a9509efa83e3b2fa42616fe0623cba696">OpenCASCADE::point</a></div><div class="ttdeci">Point&lt; spacedim &gt; point(const gp_Pnt &amp;p, const double tolerance=1e-10)</div><div class="ttdef"><b>Definition:</b> <a href="opencascade_2utilities_8cc_source.html#l00188">utilities.cc:188</a></div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_a0d8802698d585eec62a2a54e6387b05b"><div class="ttname"><a href="namespaceLAPACKSupport.html#a0d8802698d585eec62a2a54e6387b05b">LAPACKSupport::zero</a></div><div class="ttdeci">static const types::blas_int zero</div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00193">lapack_support.h:193</a></div></div>
<div class="ttc" id="namespaceEvaluationFlags_html_a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58"><div class="ttname"><a href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">EvaluationFlags::values</a></div><div class="ttdef"><b>Definition:</b> <a href="evaluation__flags_8h_source.html#l00054">evaluation_flags.h:54</a></div></div>
<div class="ttc" id="symmetric__tensor_8h_html_a3656e2f6095f612536b06139a6a2ca39"><div class="ttname"><a href="symmetric__tensor_8h.html#a3656e2f6095f612536b06139a6a2ca39">invert</a></div><div class="ttdeci">constexpr SymmetricTensor&lt; 2, dim, Number &gt; invert(const SymmetricTensor&lt; 2, dim, Number &gt; &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="symmetric__tensor_8h_source.html#l03289">symmetric_tensor.h:3289</a></div></div>
<div class="ttc" id="p4est__wrappers_8cc_html_ace00f2f80d9780ef9aa1007e1c22c6a4"><div class="ttname"><a href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a></div><div class="ttdeci">const ::parallel::distributed::Triangulation&lt; dim, spacedim &gt; * triangulation</div><div class="ttdef"><b>Definition:</b> <a href="p4est__wrappers_8cc_source.html#l00069">p4est_wrappers.cc:69</a></div></div>
<div class="ttc" id="namespaceDoFTools_html_acad7e0841b9046eaafddc4c617ab1d9d"><div class="ttname"><a href="namespaceDoFTools.html#acad7e0841b9046eaafddc4c617ab1d9d">DoFTools::extract_locally_relevant_dofs</a></div><div class="ttdeci">void extract_locally_relevant_dofs(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, IndexSet &amp;dof_set)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools_8cc_source.html#l01133">dof_tools.cc:1133</a></div></div>
<div class="ttc" id="classSubscriptor_html"><div class="ttname"><a href="classSubscriptor.html">Subscriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="subscriptor_8h_source.html#l00050">subscriptor.h:50</a></div></div>
<div class="ttc" id="namespaceUtilities_1_1MPI_html_a9e963546bd81b0cdd88e1840cfa8f227"><div class="ttname"><a href="namespaceUtilities_1_1MPI.html#a9e963546bd81b0cdd88e1840cfa8f227">Utilities::MPI::reduce</a></div><div class="ttdeci">T reduce(const T &amp;local_value, const MPI_Comm &amp;comm, const std::function&lt; T(const T &amp;, const T &amp;)&gt; &amp;combiner, const unsigned int root_process=0)</div></div>
<div class="ttc" id="classTimer_html"><div class="ttname"><a href="classTimer.html">Timer</a></div><div class="ttdef"><b>Definition:</b> <a href="timer_8h_source.html#l00118">timer.h:118</a></div></div>
<div class="ttc" id="namespaceUtilities_1_1CUDA_html_afc505a095cc4c7600f65ecb99851312e"><div class="ttname"><a href="namespaceUtilities_1_1CUDA.html#afc505a095cc4c7600f65ecb99851312e">Utilities::CUDA::free</a></div><div class="ttdeci">void free(T *&amp;pointer)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2cuda_8h_source.html#l00107">cuda.h:107</a></div></div>
<div class="ttc" id="classAffineConstraints_html_a1611aa37f754086388ca76bcd421cce5"><div class="ttname"><a href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">AffineConstraints::close</a></div><div class="ttdeci">void close()</div></div>
<div class="ttc" id="namespaceLAPACKSupport_html_a1a9009db0d9a77923a7031b549b9b638ad91ede5cc912c10676843bf58fa60636"><div class="ttname"><a href="namespaceLAPACKSupport.html#a1a9009db0d9a77923a7031b549b9b638ad91ede5cc912c10676843bf58fa60636">LAPACKSupport::eigenvalues</a></div><div class="ttdoc">Eigenvalue vector is filled. </div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00068">lapack_support.h:68</a></div></div>
<div class="ttc" id="classConditionalOStream_html"><div class="ttname"><a href="classConditionalOStream.html">ConditionalOStream</a></div><div class="ttdef"><b>Definition:</b> <a href="conditional__ostream_8h_source.html#l00070">conditional_ostream.h:70</a></div></div>
<div class="ttc" id="classint_html"><div class="ttname"><a href="classint.html">int</a></div></div>
<div class="ttc" id="namespaceinternal_1_1VectorOperations_html_a40c8daa0881cff0123fbaeb08929f5cb"><div class="ttname"><a href="namespaceinternal_1_1VectorOperations.html#a40c8daa0881cff0123fbaeb08929f5cb">internal::VectorOperations::copy</a></div><div class="ttdeci">void copy(const T *begin, const T *end, U *dest)</div><div class="ttdef"><b>Definition:</b> <a href="vector__operations__internal_8h_source.html#l00069">vector_operations_internal.h:69</a></div></div>
<div class="ttc" id="namespaceMatrixFreeTools_html_a523190adf5671e317d745fed4b1d357f"><div class="ttname"><a href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">MatrixFreeTools::compute_diagonal</a></div><div class="ttdeci">void compute_diagonal(const MatrixFree&lt; dim, Number, VectorizedArrayType &gt; &amp;matrix_free, LinearAlgebra::distributed::Vector&lt; Number &gt; &amp;diagonal_global, const std::function&lt; void(FEEvaluation&lt; dim, fe_degree, n_q_points_1d, n_components, Number, VectorizedArrayType &gt; &amp;)&gt; &amp;local_vmult, const unsigned int dof_no=0, const unsigned int quad_no=0, const unsigned int first_selected_component=0)</div></div>
<div class="ttc" id="classAffineConstraints_html_aef97b22281acb10c914d79a3881e2735"><div class="ttname"><a href="classAffineConstraints.html#aef97b22281acb10c914d79a3881e2735">AffineConstraints::add_lines</a></div><div class="ttdeci">void add_lines(const std::vector&lt; bool &gt; &amp;lines)</div></div>
<div class="ttc" id="namespaceinternal_1_1p4est_html_a4b980c7b4b4d9984e93d73c7d30173ea"><div class="ttname"><a href="namespaceinternal_1_1p4est.html#a4b980c7b4b4d9984e93d73c7d30173ea">internal::p4est::functions</a></div><div class="ttdeci">int(&amp;) functions(const void *v1, const void *v2)</div><div class="ttdef"><b>Definition:</b> <a href="p4est__wrappers_8cc_source.html#l00339">p4est_wrappers.cc:339</a></div></div>
<div class="ttc" id="classMatrixFreeOperators_1_1Base_html_ae323450bcbd9e05509cdbf7c4f50f435"><div class="ttname"><a href="classMatrixFreeOperators_1_1Base.html#ae323450bcbd9e05509cdbf7c4f50f435">MatrixFreeOperators::Base::initialize</a></div><div class="ttdeci">void initialize(std::shared_ptr&lt; const MatrixFree&lt; dim, value_type, VectorizedArrayType &gt;&gt; data, const std::vector&lt; unsigned int &gt; &amp;selected_row_blocks=std::vector&lt; unsigned int &gt;(), const std::vector&lt; unsigned int &gt; &amp;selected_column_blocks=std::vector&lt; unsigned int &gt;())</div><div class="ttdef"><b>Definition:</b> <a href="operators_8h_source.html#l01073">operators.h:1073</a></div></div>
<div class="ttc" id="namespaceWorkStream_1_1internal_1_1tbb__no__coloring_html_a8673698a405bf47aa24002aeb6d76d70"><div class="ttname"><a href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">WorkStream::internal::tbb_no_coloring::run</a></div><div class="ttdeci">void run(const Iterator &amp;begin, const typename identity&lt; Iterator &gt;::type &amp;end, Worker worker, Copier copier, const ScratchData &amp;sample_scratch_data, const CopyData &amp;sample_copy_data, const unsigned int queue_length, const unsigned int chunk_size)</div><div class="ttdef"><b>Definition:</b> <a href="work__stream_8h_source.html#l00562">work_stream.h:562</a></div></div>
<div class="ttc" id="group__constraints_html_ga3b4ea7dfd313e388d868c4e4aa685799"><div class="ttname"><a href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a></div><div class="ttdeci">void make_hanging_node_constraints(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, AffineConstraints&lt; number &gt; &amp;constraints)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools__constraints_8cc_source.html#l01787">dof_tools_constraints.cc:1787</a></div></div>
<div class="ttc" id="classFEEvaluation_html"><div class="ttname"><a href="classFEEvaluation.html">FEEvaluation</a></div><div class="ttdef"><b>Definition:</b> <a href="fe__evaluation_8h_source.html#l00071">fe_evaluation.h:71</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
