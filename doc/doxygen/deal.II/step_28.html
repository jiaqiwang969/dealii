<!-- HTML header for doxygen 1.8.17-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="canonical" href="https://www.dealii.org/current/doxygen/deal.II/step_28.html" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The deal.II Library: The step-28 tutorial program</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link rel="SHORTCUT ICON" href="deal.ico"></link>
<script type="text/javascript" src="custom.js"></script>
<meta name="author" content="The deal.II Authors <authors@dealii.org>"></meta>
<meta name="copyright" content="Copyright (C) 1998 - 2021 by the deal.II authors"></meta>
<meta name="deal.II-version" content="10.0.0-pre"></meta>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo200.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Reference documentation for deal.II version 10.0.0-pre</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!--Extra macros for MathJax:-->
<div style="display:none">
\(\newcommand{\dealvcentcolon}{\mathrel{\mathop{:}}}\)
\(\newcommand{\dealcoloneq}{\dealvcentcolon\mathrel{\mkern-1.2mu}=}\)
\(\newcommand{\jump}[1]{\left[\!\left[ #1 \right]\!\right]}\)
\(\newcommand{\average}[1]{\left\{\!\left\{ #1 \right\}\!\right\}}\)
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">The step-28 tutorial program </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial depends on <a class="el" href="step_6.html">step-6</a>.</p>
<p> 
<table class="tutorial" width="50%">
<tr><th colspan="2"><b><small>Table of contents</small></b></th></tr>
<tr><td width="50%" valign="top">
<ol>
  <li> <a href="#Intro" class=bold>Introduction</a>
    <ul>
        <li><a href="#Theeigenvalueproblem">The eigenvalue problem</a>
        <li><a href="#Meshesandmeshrefinement">Meshes and mesh refinement</a>
      <ul>
        <li><a href="#Meshrefinement">Mesh refinement</a>
        <li><a href="#Assemblingtermsondifferentmeshes">Assembling terms on different meshes</a>
      </ul>
        <li><a href="#Descriptionofthetestcase">Description of the test case</a>
        <li><a href="#Whattheprogramdoesandhowitdoesthat">What the program does (and how it does that)</a>
    </ul>
  <li> <a href="#CommProg" class=bold>The commented program</a>
    <ul>
        <li><a href="#Includefiles">Include files</a>
        <li><a href="#Materialdata">Material data</a>
        <li><a href="#ThecodeEnergyGroupcodeclass">The <code>EnergyGroup</code> class</a>
      <ul>
      <ul>
        <li><a href="#codeEnergyGroupcodepublicmemberfunctions"><code>EnergyGroup</code> public member functions</a>
        <li><a href="#codeEnergyGroupcodepublicdatamembers"><code>EnergyGroup</code> public data members</a>
        <li><a href="#codeEnergyGroupcodeprivatedatamembers"><code>EnergyGroup</code> private data members</a>
        <li><a href="#codeEnergyGroupcodeprivatememberfunctions"><code>EnergyGroup</code> private member functions</a>
      </ul>
        <li><a href="#ImplementationofthecodeEnergyGroupcodeclass">Implementation of the <code>EnergyGroup</code> class</a>
      <ul>
        <li><a href="#codeEnergyGroupsetup_linear_systemcode"><code>EnergyGroup::setup_linear_system</code></a>
        <li><a href="#codeEnergyGroupassemble_system_matrixcode"><code>EnergyGroup::assemble_system_matrix</code></a>
        <li><a href="#codeEnergyGroupassemble_ingroup_rhscode"><code>EnergyGroup::assemble_ingroup_rhs</code></a>
        <li><a href="#codeEnergyGroupassemble_cross_group_rhscode"><code>EnergyGroup::assemble_cross_group_rhs</code></a>
        <li><a href="#codeEnergyGroupassemble_cross_group_rhs_recursivecode"><code>EnergyGroup::assemble_cross_group_rhs_recursive</code></a>
        <li><a href="#codeEnergyGroupget_fission_sourcecode"><code>EnergyGroup::get_fission_source</code></a>
        <li><a href="#codeEnergyGroupsolvecode"><code>EnergyGroup::solve</code></a>
        <li><a href="#codeEnergyGroupestimate_errorscode"><code>EnergyGroup::estimate_errors</code></a>
        <li><a href="#codeEnergyGrouprefine_gridcode"><code>EnergyGroup::refine_grid</code></a>
        <li><a href="#codeEnergyGroupoutput_resultscode"><code>EnergyGroup::output_results</code></a>
      </ul>
      </ul>
        <li><a href="#ThecodeNeutronDiffusionProblemcodeclasstemplate">The <code>NeutronDiffusionProblem</code> class template</a>
      <ul>
      <ul>
        <li><a href="#codeNeutronDiffusionProblemcodeprivatememberfunctions"><code>NeutronDiffusionProblem</code> private member functions</a>
        <li><a href="#codeNeutronDiffusionProblemcodeprivatemembervariables"><code>NeutronDiffusionProblem</code> private member variables</a>
      </ul>
        <li><a href="#ImplementationofthecodeParameterscodeclass">Implementation of the <code>Parameters</code> class</a>
        <li><a href="#ImplementationofthecodeNeutronDiffusionProblemcodeclass">Implementation of the <code>NeutronDiffusionProblem</code> class</a>
      <ul>
        <li><a href="#codeNeutronDiffusionProbleminitialize_problemcode"><code>NeutronDiffusionProblem::initialize_problem</code></a>
        <li><a href="#codeNeutronDiffusionProblemget_total_fission_sourcecode"><code>NeutronDiffusionProblem::get_total_fission_source</code></a>
        <li><a href="#codeNeutronDiffusionProblemrefine_gridcode"><code>NeutronDiffusionProblem::refine_grid</code></a>
        <li><a href="#codeNeutronDiffusionProblemruncode"><code>NeutronDiffusionProblem::run</code></a>
      </ul>
      </ul>
        <li><a href="#Thecodemaincodefunction">The <code>main()</code> function</a>
      </ul>
</ol></td><td width="50%" valign="top"><ol>
  <li value="3"> <a href="#Results" class=bold>Results</a>
    <ul>
    </ul>
  <li> <a href="#PlainProg" class=bold>The plain program</a>
</ol> </td> </tr> </table>
 <br  />
</p>
<p><em>This program was contributed by Yaqi Wang and Wolfgang Bangerth. Results from this program are used and discussed in the publication "Three-dimensional h-adaptivity for the multigroup neutron diffusion
equations" by Yaqi Wang, Wolfgang Bangerth and Jean Ragusa. The paper's full bibliographic details are as follows: </p><div class="fragment"><div class="line">@Article{WBR09,</div>
<div class="line">  author  = {Yaqi Wang <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#acce0a318676405d57af6ef0f5cbe4ec3">and</a> Wolfgang <a class="code" href="geodynamics__0_8txt.html#a3cea336457392f6beb5acb191c9f4c4b">Bangerth</a> <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#acce0a318676405d57af6ef0f5cbe4ec3">and</a> Jean Ragusa},</div>
<div class="line">  title   = {Three-<a class="code" href="A-headers_2utilities__0_8txt.html#ad2c1ad26b1963cfa351b79adbbf36ef6">dimensional</a> <a class="code" href="auto__derivative__function__0_8txt.html#af5d8dd2d035de856717fb6b5c9438dd5">h</a>-<a class="code" href="refinement__0_8txt.html#a5ec35f5c4745344cf7607638e6cbcb5e">adaptivity</a> <span class="keywordflow">for</span> <a class="code" href="constraints__0_8txt.html#a9132c79972fe954d265b941f34bebed9">the</a> multigroup</div>
<div class="line">             neutron diffusion <a class="code" href="functions__0_8txt.html#a829d3b9f33556b077b89f416303f182c">equations</a>},</div>
<div class="line">  journal = {Progr. Nucl. Energy},</div>
<div class="line">  <a class="code" href="kinsol__0_8txt.html#a2dde6fcf1c80bd5999147ad9c92e81b2">year</a>    = 2009,</div>
<div class="line">  <a class="code" href="base_2bounding__box__0_8txt.html#ac479118cc630e4f4c7d594789b4c6dec">volume</a>  = 51,</div>
<div class="line">  pages   = {543--555}</div>
<div class="line">}</div>
</div><!-- fragment --><p> The paper is available <a href="https://www.semanticscholar.org/paper/Three-dimensional-h-adaptivity-for-the-multigroup-Wang-Bangerth/900592e8e891d9b888d59a69ec58bf2bbda56b4b" target="_top">here</a>. </em></p>
<p><br  />
</p>
<p><a class="anchor" id="Introduction"></a><a class="anchor" id="Intro"></a> </p><h1>Introduction</h1>
<p>In this example, we intend to solve the multigroup diffusion approximation of the neutron transport equation. Essentially, the way to view this is as follows: In a nuclear reactor, neutrons are speeding around at different energies, get absorbed or scattered, or start a new fission event. If viewed at long enough length scales, the movement of neutrons can be considered a diffusion process.</p>
<p>A mathematical description of this would group neutrons into energy bins, and consider the balance equations for the neutron fluxes in each of these bins, or energy groups. The scattering, absorption, and fission events would then be operators within the diffusion equation describing the neutron fluxes. Assume we have energy groups \(g=1,\ldots,G\), where by convention we assume that the neutrons with the highest energy are in group 1 and those with the lowest energy in group \(G\). Then the neutron flux of each group satisfies the following equations: </p><p class="formulaDsp">
\begin{eqnarray*} \frac 1{v_g}\frac{\partial \phi_g(x,t)}{\partial t} &amp;=&amp; \nabla \cdot(D_g(x) \nabla \phi_g(x,t)) - \Sigma_{r,g}(x)\phi_g(x,t) \\ &amp;&amp; \qquad + \chi_g\sum_{g&#39;=1}^G\nu\Sigma_{f,g&#39;}(x)\phi_{g&#39;}(x,t) + \sum_{g&#39;\ne g}\Sigma_{s,g&#39;\to g}(x)\phi_{g&#39;}(x,t) + s_{\mathrm{ext},g}(x,t) \end{eqnarray*}
</p>
<p> augmented by appropriate boundary conditions. Here, \(v_g\) is the velocity of neutrons within group \(g\). In other words, the change in time in flux of neutrons in group \(g\) is governed by the following processes: </p><ul>
<li>
Diffusion \(\nabla \cdot(D_g(x) \nabla \phi_g(x,t))\). Here, \(D_g\) is the (spatially variable) diffusion coefficient. </li>
<li>
Absorption \(\Sigma_{r,g}(x)\phi_g(x,t)\) (note the negative sign). The coefficient \(\Sigma_{r,g}\) is called the <em>removal cross section</em>. </li>
<li>
Nuclear fission \(\chi_g\sum_{g&#39;=1}^G\nu\Sigma_{f,g&#39;}(x)\phi_{g&#39;}(x,t)\). The production of neutrons of energy \(g\) is proportional to the flux of neutrons of energy \(g&#39;\) times the probability \(\Sigma_{f,g&#39;}\) that neutrons of energy \(g&#39;\) cause a fission event times the number \(\nu\) of neutrons produced in each fission event times the probability that a neutron produced in this event has energy \(g\). \(\nu\Sigma_{f,g&#39;}\) is called the <em>fission cross section</em> and \(\chi_g\) the <em>fission spectrum</em>. We will denote the term \(\chi_g\nu\Sigma_{f,g&#39;}\) as the <em>fission distribution cross section</em> in the program. </li>
<li>
Scattering \(\sum_{g&#39;\ne g}\Sigma_{s,g&#39;\to g}(x)\phi_{g&#39;}(x,t)\) of neutrons of energy \(g&#39;\) producing neutrons of energy \(g\). \(\Sigma_{s,g&#39;\to g}\) is called the <em>scattering cross section</em>. The case of elastic, in-group scattering \(g&#39;=g\) exists, too, but we subsume this into the removal cross section. The case \(g&#39;&lt;g\) is called down-scattering, since a neutron loses energy in such an event. On the other hand, \(g&#39;&gt;g\) corresponds to up-scattering: a neutron gains energy in a scattering event from the thermal motion of the atoms surrounding it; up-scattering is therefore only an important process for neutrons with kinetic energies that are already on the same order as the thermal kinetic energy (i.e. in the sub \(eV\) range). </li>
<li>
An extraneous source \(s_{\mathrm{ext},g}\). </li>
</ul>
<p>For realistic simulations in reactor analysis, one may want to split the continuous spectrum of neutron energies into many energy groups, often up to 100. However, if neutron energy spectra are known well enough for some type of reactor (for example Pressurized Water Reactors, PWR), it is possible to obtain satisfactory results with only 2 energy groups.</p>
<p>In the program shown in this tutorial program, we provide the structure to compute with as many energy groups as desired. However, to keep computing times moderate and in order to avoid tabulating hundreds of coefficients, we only provide the coefficients for above equations for a two-group simulation, i.e. \(g=1,2\). We do, however, consider a realistic situation by assuming that the coefficients are not constant, but rather depend on the materials that are assembled into reactor fuel assemblies in rather complicated ways (see below).</p>
<p><a class="anchor" id="Theeigenvalueproblem"></a></p><h3>The eigenvalue problem</h3>
<p>If we consider all energy groups at once, we may write above equations in the following operator form: </p><p class="formulaDsp">
\begin{eqnarray*} \frac 1v \frac{\partial \phi}{\partial t} = -L\phi + F\phi + X\phi + s_{\mathrm{ext}}, \end{eqnarray*}
</p>
<p> where \(L,F,X\) are sinking, fission, and scattering operators, respectively. \(L\) here includes both the diffusion and removal terms. Note that \(L\) is symmetric, whereas \(F\) and \(X\) are not.</p>
<p>It is well known that this equation admits a stable solution if all eigenvalues of the operator \(-L+F+X\) are negative. This can be readily seen by multiplying the equation by \(\phi\) and integrating over the domain, leading to </p><p class="formulaDsp">
\begin{eqnarray*} \frac 1{2v} \frac{\partial}{\partial t} \|\phi\|^2 = ((-L+F+X)\phi,\phi). \end{eqnarray*}
</p>
<p> Stability means that the solution does not grow, i.e. we want the left hand side to be less than zero, which is the case if the eigenvalues of the operator on the right are all negative. For obvious reasons, it is not very desirable if a nuclear reactor produces neutron fluxes that grow exponentially, so eigenvalue analyses are the bread-and-butter of nuclear engineers. The main point of the program is therefore to consider the eigenvalue problem </p><p class="formulaDsp">
\begin{eqnarray*} (L-F-X) \phi = \lambda \phi, \end{eqnarray*}
</p>
<p> where we want to make sure that all eigenvalues are positive. Note that \(L\), being the diffusion operator plus the absorption (removal), is positive definite; the condition that all eigenvalues are positive therefore means that we want to make sure that fission and inter-group scattering are weak enough to not shift the spectrum into the negative.</p>
<p>In nuclear engineering, one typically looks at a slightly different formulation of the eigenvalue problem. To this end, we do not just multiply with \(\phi\) and integrate, but rather multiply with \(\phi(L-X)^{-1}\). We then get the following evolution equation: </p><p class="formulaDsp">
\begin{eqnarray*} \frac 1{2v} \frac{\partial}{\partial t} \|\phi\|^2_{(L-X)^{-1}} = ((L-X)^{-1}(-L+F+X)\phi,\phi). \end{eqnarray*}
</p>
<p> Stability is then guaranteed if the eigenvalues of the following problem are all negative: </p><p class="formulaDsp">
\begin{eqnarray*} (L-X)^{-1}(-L+F+X)\phi = \lambda_F \phi, \end{eqnarray*}
</p>
<p> which is equivalent to the eigenvalue problem </p><p class="formulaDsp">
\begin{eqnarray*} (L-X)\phi = \frac 1{\lambda_F+1} F \phi. \end{eqnarray*}
</p>
<p> The typical formulation in nuclear engineering is to write this as </p><p class="formulaDsp">
\begin{eqnarray*} (L-X) \phi = \frac 1{k_{\mathrm{eff}}} F \phi, \end{eqnarray*}
</p>
<p> where \(k_{\mathrm{eff}}=\frac 1{\lambda^F+1}\). Intuitively, \(k_{\mathrm{eff}}\) is something like the multiplication factor for neutrons per typical time scale and should be less than or equal to one for stable operation of a reactor: if it is less than one, the chain reaction will die down, whereas nuclear bombs for example have a \(k\)-eigenvalue larger than one. A stable reactor should have \(k_{\mathrm{eff}}=1\).</p>
<p>For those who wonder how this can be achieved in practice without inadvertently getting slightly larger than one and triggering a nuclear bomb: first, fission processes happen on different time scales. While most neutrons are released very quickly after a fission event, a small number of neutrons are only released by daughter nuclei after several further decays, up to 10-60 seconds after the fission was initiated. If one is therefore slightly beyond \(k_{\mathrm{eff}}=1\), one therefore has many seconds to react until all the neutrons created in fission re-enter the fission cycle. Nevertheless, control rods in nuclear reactors absorbing neutrons &ndash; and therefore reducing \(k_{\mathrm{eff}}\) &ndash; are designed in such a way that they are all the way in the reactor in at most 2 seconds.</p>
<p>One therefore has on the order of 10-60 seconds to regulate the nuclear reaction if \(k_{\mathrm{eff}}\) should be larger than one for some time, as indicated by a growing neutron flux. Regulation can be achieved by continuously monitoring the neutron flux, and if necessary increase or reduce neutron flux by moving neutron-absorbing control rods a few millimeters into or out of the reactor. On a longer scale, the water cooling the reactor contains boron, a good neutron absorber. Every few hours, boron concentrations are adjusted by adding boron or diluting the coolant.</p>
<p>Finally, some of the absorption and scattering reactions have some stability built in; for example, higher neutron fluxes result in locally higher temperatures, which lowers the density of water and therefore reduces the number of scatterers that are necessary to moderate neutrons from high to low energies before they can start fission events themselves.</p>
<p>In this tutorial program, we solve above \(k\)-eigenvalue problem for two energy groups, and we are looking for the largest multiplication factor \(k_{\mathrm{eff}}\), which is proportional to the inverse of the minimum eigenvalue plus one. To solve the eigenvalue problem, we generally use a modified version of the <em>inverse power method</em>. The algorithm looks like this:</p>
<ol>
<li>
<p class="startli">Initialize \(\phi_g\) and \(k_{\mathrm{eff}}\) with \(\phi_g^{(0)}\) and \(k_{\mathrm{eff}}^{(0)}\) and let \(n=1\).</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Define the so-called <em>fission source</em> by </p><p class="formulaDsp">
\begin{eqnarray*} s_f^{(n-1)}(x) = \frac{1}{k_{\mathrm{eff}}^{(n-1)}} \sum_{g&#39;=1}^G\nu\Sigma_{f,g&#39;}(x)\phi_{g&#39;}^{(n-1)}(x). \end{eqnarray*}
</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Solve for all group fluxes \(\phi_g,g=1,\ldots,G\) using </p><p class="formulaDsp">
\begin{eqnarray*} -\nabla \cdot D_g\nabla \phi_g^{(n)} + \Sigma_{r,g}\phi_g^{(n)} = \chi_g s_f^{(n-1)} + \sum_{g&#39;&lt; g} \Sigma_{s,g&#39;\to g} \phi_{g&#39;}^{(n)} + \sum_{g&#39;&gt; g}\Sigma_{s,g&#39;\to g}\phi_{g&#39;}^{(n-1)}. \end{eqnarray*}
</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Update </p><p class="formulaDsp">
\begin{eqnarray*} k_{\mathrm{eff}}^{(n)} = \sum_{g&#39;=1}^G \int_{\Omega}\nu\Sigma_{f,g&#39;}(x) \phi_{g&#39;}^{(n)}(x)dx. \end{eqnarray*}
</p>
<p class="endli"></p>
</li>
<li>
Compare \(k_{\mathrm{eff}}^{(n)}\) with \(k_{\mathrm{eff}}^{(n-1)}\). If the change greater than a prescribed tolerance then set \(n=n+1\) repeat the iteration starting at step 2, otherwise end the iteration. </li>
</ol>
<p>Note that in this scheme, we do not solve group fluxes exactly in each power iteration, but rather consider previously compute \(\phi_{g&#39;}^{(n)}\) only for down-scattering events \(g&#39;&lt;g\). Up-scattering is only treated by using old iterators \(\phi_{g&#39;}^{(n-1)}\), in essence assuming that the scattering operator is triangular. This is physically motivated since up-scattering does not play a too important role in neutron scattering. In addition, practices shows that the inverse power iteration is stable even using this simplification.</p>
<p>Note also that one can use lots of extrapolation techniques to accelerate the power iteration laid out above. However, none of these are implemented in this example.</p>
<p><a class="anchor" id="Meshesandmeshrefinement"></a></p><h3>Meshes and mesh refinement</h3>
<p>One may wonder whether it is appropriate to solve for the solutions of the individual energy group equations on the same meshes. The question boils down to this: will \(\phi_g\) and \(\phi_{g&#39;}\) have similar smoothness properties? If this is the case, then it is appropriate to use the same mesh for the two; a typical application could be chemical combustion, where typically the concentrations of all or most chemical species change rapidly within the flame front. As it turns out, and as will be apparent by looking at the graphs shown in the results section of this tutorial program, this isn't the case here, however: since the diffusion coefficient is different for different energy groups, fast neutrons (in bins with a small group number \(g\)) have a very smooth flux function, whereas slow neutrons (in bins with a large group number) are much more affected by the local material properties and have a correspondingly rough solution if the coefficient are rough as in the case we compute here. Consequently, we will want to use different meshes to compute each energy group.</p>
<p>This has two implications that we will have to consider: First, we need to find a way to refine the meshes individually. Second, assembling the source terms for the inverse power iteration, where we have to integrate solution \(\phi_{g&#39;}^{(n)}\) defined on mesh \(g&#39;\) against the shape functions defined on mesh \(g\), becomes a much more complicated task.</p>
<p><a class="anchor" id="Meshrefinement"></a></p><h4>Mesh refinement</h4>
<p>We use the usual paradigm: solve on a given mesh, then evaluate an error indicator for each cell of each mesh we have. Because it is so convenient, we again use the a posteriori error estimator by Kelly, Gago, Zienkiewicz and Babuska which approximates the error per cell by integrating the jump of the gradient of the solution along the faces of each cell. Using this, we obtain indicators </p><p class="formulaDsp">
\begin{eqnarray*} \eta_{g,K}, \qquad g=1,2,\ldots,G,\qquad K\in{\cal T}_g, \end{eqnarray*}
</p>
<p> where \({\cal T}_g\) is the triangulation used in the solution of \(\phi_g\). The question is what to do with this. For one, it is clear that refining only those cells with the highest error indicators might lead to bad results. To understand this, it is important to realize that \(\eta_{g,K}\) scales with the second derivative of \(\phi_g\). In other words, if we have two energy groups \(g=1,2\) whose solutions are equally smooth but where one is larger by a factor of 10,000, for example, then only the cells of that mesh will be refined, whereas the mesh for the solution of small magnitude will remain coarse. This is probably not what one wants, since we can consider both components of the solution equally important.</p>
<p>In essence, we would therefore have to scale \(\eta_{g,K}\) by an importance factor \(z_g\) that says how important it is to resolve \(\phi_g\) to any given accuracy. Such important factors can be computed using duality techniques (see, for example, the <a class="el" href="step_14.html">step-14</a> tutorial program, and the reference to the book by Bangerth and Rannacher cited there). We won't go there, however, and simply assume that all energy groups are equally important, and will therefore normalize the error indicators \(\eta_{g,K}\) for group \(g\) by the maximum of the solution \(\phi_g\). We then refine the cells whose errors satisfy </p><p class="formulaDsp">
\begin{eqnarray*} \frac{\eta_{g,K}}{\|\phi_g\|_\infty} &gt; \alpha_1 \displaystyle{\max_{\begin{matrix}1\le g\le G \\ K\in {\cal T}_g\end{matrix}} \frac{\eta_{g,K}}{\|\phi_g\|_\infty}} \end{eqnarray*}
</p>
<p> and coarsen the cells where </p><p class="formulaDsp">
\begin{eqnarray*} \frac{\eta_{g,K}}{\|\phi_g\|_\infty} &lt; \alpha_2 \displaystyle{\max_{\begin{matrix}1\le g\le G \\ K\in {\cal T}_g\end{matrix}} \frac{\eta_{g,K}}{\|\phi_g\|_\infty}}. \end{eqnarray*}
</p>
<p> We chose \(\alpha_1=0.3\) and \(\alpha_2=0.01\) in the code. Note that this will, of course, lead to different meshes for the different energy groups.</p>
<p>The strategy above essentially means the following: If for energy group \(g\) there are many cells \(K\in {\cal T}_g\) on which the error is large, for example because the solution is globally very rough, then many cells will be above the threshold. On the other hand, if there are a few cells with large and many with small errors, for example because the solution is overall rather smooth except at a few places, then only the few cells with large errors will be refined. Consequently, the strategy allows for meshes that track the global smoothness properties of the corresponding solutions rather well.</p>
<p><a class="anchor" id="Assemblingtermsondifferentmeshes"></a></p><h4>Assembling terms on different meshes</h4>
<p>As pointed out above, the multigroup refinement strategy results in different meshes for the different solutions \(\phi_g\). So what's the problem? In essence it goes like this: in step 3 of the eigenvalue iteration, we have form the weak form for the equation to compute \(\phi_g^{(n)}\) as usual by multiplication with test functions \(\varphi_g^i\) defined on the mesh for energy group \(g\); in the process, we have to compute the right hand side vector that contains terms of the following form: </p><p class="formulaDsp">
\begin{eqnarray*} F_i = \int_\Omega f(x) \varphi_g^i(x) \phi_{g&#39;}(x) \ dx, \end{eqnarray*}
</p>
<p> where \(f(x)\) is one of the coefficient functions \(\Sigma_{s,g&#39;\to g}\) or \(\nu\chi_g\Sigma_{f,g&#39;}\) used in the right hand side of eigenvalue equation. The difficulty now is that \(\phi_{g&#39;}\) is defined on the mesh for energy group \(g&#39;\), i.e. it can be expanded as \(\phi_{g&#39;}(x)=\sum_j\phi_{g&#39;}^j \varphi_{g&#39;}^j(x)\), with basis functions \(\varphi_{g&#39;}^j(x)\) defined on mesh \(g&#39;\). The contribution to the right hand side can therefore be written as </p><p class="formulaDsp">
\begin{eqnarray*} F_i = \sum_j \left\{\int_\Omega f(x) \varphi_g^i(x) \varphi_{g&#39;}^j(x) \ dx \right\} \phi_{g&#39;}^j , \end{eqnarray*}
</p>
<p> On the other hand, the test functions \(\varphi_g^i(x)\) are defined on mesh \(g\). This means that we can't just split the integral \(\Omega\) into integrals over the cells of either mesh \(g\) or \(g&#39;\), since the respectively other basis functions may not be defined on these cells.</p>
<p>The solution to this problem lies in the fact that both the meshes for \(g\) and \(g&#39;\) are derived by adaptive refinement from a common coarse mesh. We can therefore always find a set of cells, which we denote by \({\cal T}_g \cap {\cal T}_{g&#39;}\), that satisfy the following conditions: </p><ul>
<li>
the union of the cells covers the entire domain, and </li>
<li>
a cell \(K \in {\cal T}_g \cap {\cal T}_{g&#39;}\) is active on at least one of the two meshes. </li>
</ul>
<p>A way to construct this set is to take each cell of coarse mesh and do the following steps: (i) if the cell is active on either \({\cal T}_g\) or \({\cal T}_{g&#39;}\), then add this cell to the set; (ii) otherwise, i.e. if this cell has children on both meshes, then do step (i) for each of the children of this cell. In fact, deal.II has a function <a class="el" href="namespaceGridTools.html#a32a5016c746ad756046ecff264dfa60d">GridTools::get_finest_common_cells</a> that computes exactly this set of cells that are active on at least one of two meshes.</p>
<p>With this, we can write above integral as follows: </p><p class="formulaDsp">
\begin{eqnarray*} F_i = \sum_{K \in {\cal T}_g \cap {\cal T}_{g&#39;}} \sum_j \left\{\int_K f(x) \varphi_g^i(x) \varphi_{g&#39;}^j(x) \ dx \right\} \phi_{g&#39;}^j. \end{eqnarray*}
</p>
<p> In the code, we compute the right hand side in the function <code>NeutronDiffusionProblem::assemble_rhs</code>, where (among other things) we loop over the set of common most refined cells, calling the function <code>NeutronDiffusionProblem::assemble_common_cell</code> on each pair of these cells.</p>
<p>By construction, there are now three cases to be considered: </p><ol>
<li>
The cell \(K\) is active on both meshes, i.e. both the basis functions \(\varphi_g^i\) as well as \(\varphi_{g&#39;}^j\) are defined on \(K\). </li>
<li>
The cell \(K\) is active on mesh \(g\), but not \(g&#39;\), i.e. the \(\varphi_g^i\) are defined on \(K\), whereas the \(\varphi_{g&#39;}^j\) are defined on children of \(K\). </li>
<li>
The cell \(K\) is active on mesh \(g&#39;\), but not \(g\), with opposite conclusions than in (ii). </li>
</ol>
<p>To compute the right hand side above, we then need to have different code for these three cases, as follows: </p><ol>
<li>
<p class="startli">If the cell \(K\) is active on both meshes, then we can directly evaluate the integral. In fact, we don't even have to bother with the basis functions \(\varphi_{g&#39;}\), since all we need is the values of \(\phi_{g&#39;}\) at the quadrature points. We can do this using the FEValues::get_function_values function. This is done directly in the <code>NeutronDiffusionProblem::assemble_common_cell</code> function.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">If the cell \(K\) is active on mesh \(g\), but not \(g&#39;\), then the basis functions \(\varphi_{g&#39;}^j\) are only defined either on the children \(K_c,0\le c&lt;2^{\texttt{dim}}\), or on children of these children if cell \(K\) is refined more than once on mesh \(g&#39;\).</p>
<p class="interli">Let us assume for a second that \(K\) is only once more refined on mesh \(g&#39;\) than on mesh \(g\). Using the fact that we use embedded finite element spaces where each basis function on one mesh can be written as a linear combination of basis functions on the next refined mesh, we can expand the restriction of \(\phi_g^i\) to child cell \(K_c\) into the basis functions defined on that child cell (i.e. on cells on which the basis functions \(\varphi_{g&#39;}^l\) are defined): </p><p class="formulaDsp">
\begin{eqnarray*} \phi_g^i|_{K_c} = B_c^{il} \varphi_{g&#39;}^l|_{K_c}. \end{eqnarray*}
</p>
<p> Here, and in the following, summation over indices appearing twice is implied. The matrix \(B_c\) is the matrix that interpolated data from a cell to its \(c\)-th child.</p>
<p class="interli">Then we can write the contribution of cell \(K\) to the right hand side component \(F_i\) as </p><p class="formulaDsp">
\begin{eqnarray*} F_i|_K &amp;=&amp; \left\{ \int_K f(x) \varphi_g^i(x) \varphi_{g&#39;}^j(x) \ dx \right\} \phi_{g&#39;}^j \\ &amp;=&amp; \left\{ \sum_{0\le c&lt;2^{\texttt{dim}}} B_c^{il} \int_{K_c} f(x) \varphi_{g&#39;}^l(x) \varphi_{g&#39;}^j(x) \ dx \right\} \phi_{g&#39;}^j. \end{eqnarray*}
</p>
<p> In matrix notation, this can be written as </p><p class="formulaDsp">
\begin{eqnarray*} F_i|_K = \sum_{0\le c&lt;2^{\texttt{dim}}} F_i|_{K_c}, \qquad \qquad F_i|_{K_c} = B_c^{il} M_{K_c}^{lj} \phi_{g&#39;}^j = (B_c M_{K_c})^{ij} \phi_{g&#39;}^j, \end{eqnarray*}
</p>
<p> where \(M_{K_c}^{lj}=\int_{K_c} f(x) \varphi_{g&#39;}^l(x) \varphi_{g&#39;}^j(x)\) is the weighted mass matrix on child \(c\) of cell \(K\).</p>
<p class="interli">The next question is what happens if a child \(K_c\) of \(K\) is not active. Then, we have to apply the process recursively, i.e. we have to interpolate the basis functions \(\varphi_g^i\) onto child \(K_c\) of \(K\), then onto child \(K_{cc&#39;}\) of that cell, onto child \(K_{cc&#39;c&#39;&#39;}\) of that one, etc, until we find an active cell. We then have to sum up all the contributions from all the children, grandchildren, etc, of cell \(K\), with contributions of the form </p><p class="formulaDsp">
\begin{eqnarray*} F_i|_{K_{cc&#39;}} = (B_cB_{c&#39;} M_{K_{cc&#39;}})^{ij} \phi_{g&#39;}^j, \end{eqnarray*}
</p>
<p> or </p><p class="formulaDsp">
\begin{eqnarray*} F_i|_{K_{cc&#39;c&#39;&#39;}} = (B_c B_{c&#39;} B_{c&#39;&#39;}M_{K_{cc&#39;c&#39;&#39;}})^{ij} \phi_{g&#39;}^j, \end{eqnarray*}
</p>
<p> etc. We do this process recursively, i.e. if we sit on cell \(K\) and see that it has children on grid \(g&#39;\), then we call a function <code>assemble_case_2</code> with an identity matrix; the function will multiply it's argument from the left with the prolongation matrix; if the cell has further children, it will call itself with this new matrix, otherwise it will perform the integration.</p>
<p class="endli"></p>
</li>
<li>
The last case is where \(K\) is active on mesh \(g&#39;\) but not mesh \(g\). In that case, we have to express basis function \(\varphi_{g&#39;}^j\) in terms of the basis functions defined on the children of cell \(K\), rather than \(\varphi_g^i\) as before. This of course works in exactly the same way. If the children of \(K\) are active on mesh \(g\), then leading to the expression <p class="formulaDsp">
\begin{eqnarray*} F_i|_K &amp;=&amp; \left\{ \int_K f(x) \varphi_g^i(x) \varphi_{g&#39;}^j(x) \ dx \right\} \phi_{g&#39;}^j \\ &amp;=&amp; \left\{ \sum_{0\le c&lt;2^{\texttt{dim}}} \int_{K_c} f(x) \varphi_g^i(x) B_c^{jl} \varphi_{g}^l(x) \ dx \right\} \phi_{g&#39;}^j. \end{eqnarray*}
</p>
 In matrix notation, this expression now reads as <p class="formulaDsp">
\begin{eqnarray*} F_i|_K = \sum_{0\le c&lt;2^{\texttt{dim}}} F_i|_{K_c}, \qquad \qquad F_i|_{K_c} = M_{K_c}^{il} B_c^{jl} \phi_{g&#39;}^j = (M_{K_c} B_c^T)^{ij} \phi_{g&#39;}^j, \end{eqnarray*}
</p>
 and correspondingly for cases where cell \(K\) is refined more than once on mesh \(g\): <p class="formulaDsp">
\begin{eqnarray*} F_i|_{K_{cc&#39;}} = (M_{K_{cc&#39;}} B_{c&#39;}^T B_c^T)^{ij} \phi_{g&#39;}^j, \end{eqnarray*}
</p>
 or <p class="formulaDsp">
\begin{eqnarray*} F_i|_{K_{cc&#39;c&#39;&#39;}} = (M_{K_{cc&#39;c&#39;&#39;}} B_{c&#39;&#39;}^T B_{c&#39;}^T B_c^T)^{ij} \phi_{g&#39;}^j, \end{eqnarray*}
</p>
 etc. In other words, the process works in exactly the same way as before, except that we have to take the transpose of the prolongation matrices and need to multiply it to the mass matrix from the other side. </li>
</ol>
<p>The expressions for cases (ii) and (iii) can be understood as repeatedly interpolating either the left or right basis functions in the scalar product \((f \varphi_g^i, \varphi_{g&#39;}^j)_K\) onto child cells, and then finally forming the inner product (the mass matrix) on the final cell. To make the symmetry in these cases more obvious, we can write them like this: for case (ii), we have </p><p class="formulaDsp">
\begin{eqnarray*} F_i|_{K_{cc&#39;\cdots c^{(k)}}} = [B_c B_{c&#39;} \cdots B_{c^{(k)}} M_{K_{cc&#39;\cdots c^{(k)}}}]^{ij} \phi_{g&#39;}^j, \end{eqnarray*}
</p>
<p> whereas for case (iii) we get </p><p class="formulaDsp">
\begin{eqnarray*} F_i|_{K_{cc&#39;\cdots c^{(k)}}} = [(B_c B_{c&#39;} \cdots B_{c^{(k)}} M_{K_{cc&#39;\cdots c^{(k)}}})^T]^{ij} \phi_{g&#39;}^j, \end{eqnarray*}
</p>
<p><a class="anchor" id="Descriptionofthetestcase"></a></p><h3>Description of the test case</h3>
<p>A nuclear reactor core is composed of different types of assemblies. An assembly is essentially the smallest unit that can be moved in and out of a reactor, and is usually rectangular or square. However, assemblies are not fixed units, as they are assembled from a complex lattice of different fuel rods, control rods, and instrumentation elements that are held in place relative to each other by spacers that are permanently attached to the rods. To make things more complicated, there are different kinds of assemblies that are used at the same time in a reactor, where assemblies differ in the type and arrangement of rods they are made up of.</p>
<p>Obviously, the arrangement of assemblies as well as the arrangement of rods inside them affect the distribution of neutron fluxes in the reactor (a fact that will be obvious by looking at the solution shown below in the results sections of this program). Fuel rods, for example, differ from each other in the enrichment of U-235 or Pu-239. Control rods, on the other hand, have zero fission, but nonzero scattering and absorption cross sections.</p>
<p>This whole arrangement would make the description or spatially dependent material parameters very complicated. It will not become much simpler, but we will make one approximation: we merge the volume inhabited by each cylindrical rod and the surrounding water into volumes of quadratic cross section into so-called &lsquo;pin cells&rsquo; for which homogenized material data are obtained with nuclear database and knowledge of neutron spectrum. The homogenization makes all material data piecewise constant on the solution domain for a reactor with fresh fuel. Spatially dependent material parameters are then looked up for the quadratic assembly in which a point is located, and then for the quadratic pin cell within this assembly.</p>
<p>In this tutorial program, we simulate a quarter of a reactor consisting of \(4 \times 4\) assemblies. We use symmetry (Neumann) boundary conditions to reduce the problem to one quarter of the domain, and consequently only simulate a \(2\times 2\) set of assemblies. Two of them will be UO \({}_2\) fuel, the other two of them MOX fuel. Each of these assemblies consists of \(17\times 17\) rods of different compositions. In total, we therefore create a \(34\times 34\) lattice of rods. To make things simpler later on, we reflect this fact by creating a coarse mesh of \(34\times 34\) cells (even though the domain is a square, for which we would usually use a single cell). In deal.II, each cell has a <code>material_id</code> which one may use to associated each cell with a particular number identifying the material from which this cell's volume is made of; we will use this material ID to identify which of the 8 different kinds of rods that are used in this testcase make up a particular cell. Note that upon mesh refinement, the children of a cell inherit the material ID, making it simple to track the material even after mesh refinement.</p>
<p>The arrangement of the rods will be clearly visible in the images shown in the results section. The cross sections for materials and for both energy groups are taken from a OECD/NEA benchmark problem. The detailed configuration and material data is given in the code.</p>
<p><a class="anchor" id="Whattheprogramdoesandhowitdoesthat"></a></p><h3>What the program does (and how it does that)</h3>
<p>As a coarse overview of what exactly the program does, here is the basic layout: starting on a coarse mesh that is the same for each energy group, we compute inverse eigenvalue iterations to compute the \(k\)-eigenvalue on a given set of meshes. We stop these iterations when the change in the eigenvalue drops below a certain tolerance, and then write out the meshes and solutions for each energy group for inspection by a graphics program. Because the meshes for the solutions are different, we have to generate a separate output file for each energy group, rather than being able to add all energy group solutions into the same file.</p>
<p>After this, we evaluate the error indicators as explained in one of the sections above for each of the meshes, and refine and coarsen the cells of each mesh independently. Since the eigenvalue iterations are fairly expensive, we don't want to start all over on the new mesh; rather, we use the <a class="el" href="classSolutionTransfer.html">SolutionTransfer</a> class to interpolate the solution on the previous mesh to the next one upon mesh refinement. A simple experiment will convince you that this is a lot cheaper than if we omitted this step. After doing so, we resume our eigenvalue iterations on the next set of meshes.</p>
<p>The program is controlled by a parameter file, using the <a class="el" href="classParameterHandler.html">ParameterHandler</a> class. We will show a parameter file in the results section of this tutorial. For the moment suffice it to say that it controls the polynomial degree of the finite elements used, the number of energy groups (even though all that is presently implemented are the coefficients for a 2-group problem), the tolerance where to stop the inverse eigenvalue iteration, and the number of refinement cycles we will do.</p>
<p><a class="anchor" id="CommProg"></a> </p><h1>The commented program</h1>
<p><a class="anchor" id="Includefiles"></a> </p><h3>Include files</h3>
<p>We start with a bunch of include files that have already been explained in previous tutorial programs. One new one is <code>timer.h</code>: This is the first example program that uses the <a class="el" href="classTimer.html">Timer</a> class. The <a class="el" href="classTimer.html">Timer</a> keeps track of both the elapsed wall clock time (that is, the amount of time that a clock mounted on the wall would measure) and CPU clock time (the amount of time that the current process uses on the CPUs). We will use a <a class="el" href="classTimer.html">Timer</a> below to measure how much CPU time each grid refinement cycle takes.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2timer_8h.html">deal.II/base/timer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2parameter__handler_8h.html">deal.II/base/parameter_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2thread__management_8h.html">deal.II/base/thread_management.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="include_2deal_8II_2base_2utilities_8h.html">deal.II/base/utilities.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2vector_8h.html">deal.II/lac/vector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2full__matrix_8h.html">deal.II/lac/full_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2sparsity__pattern_8h.html">deal.II/lac/sparsity_pattern.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2sparse__matrix_8h.html">deal.II/lac/sparse_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2solver__cg_8h.html">deal.II/lac/solver_cg.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2precondition_8h.html">deal.II/lac/precondition.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__refinement_8h.html">deal.II/grid/grid_refinement.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__out_8h.html">deal.II/grid/grid_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__values_8h.html">deal.II/fe/fe_values.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2matrix__tools_8h.html">deal.II/numerics/matrix_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2error__estimator_8h.html">deal.II/numerics/error_estimator.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
</div><!-- fragment --><p>We use the next include file to access block vectors which provide us a convenient way to manage solution and right hand side vectors of all energy groups:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2block__vector_8h.html">deal.II/lac/block_vector.h</a>&gt;</span></div>
</div><!-- fragment --><p>This include file is for transferring solutions from one mesh to another different mesh. We use it when we are initializing solutions after each mesh iteration:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2solution__transfer_8h.html">deal.II/numerics/solution_transfer.h</a>&gt;</span></div>
</div><!-- fragment --><p>When integrating functions defined on one mesh against shape functions defined on a different mesh, we need a function <code>get_finest_common_cells</code> (as discussed in the introduction) which is defined in the following header file :</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__tools_8h.html">deal.II/grid/grid_tools.h</a>&gt;</span></div>
</div><!-- fragment --><p>We use a little utility class from boost to save the state of an output stream (see the <code>run</code> function below):</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;boost/io/ios_state.hpp&gt;</span></div>
</div><!-- fragment --><p>Here are two more C++ standard headers that we use to define list data types as well as to fine-tune the output we generate:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;list&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iomanip&gt;</span></div>
</div><!-- fragment --><p>The last step is as in all previous programs:</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceStep28.html">Step28</a></div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
</div><!-- fragment --><p><a class="anchor" id="Materialdata"></a> </p><h3>Material data</h3>
<p>First up, we need to define a class that provides material data (including diffusion coefficients, removal cross sections, scattering cross sections, fission cross sections and fission spectra) to the main class.</p>
<p>The parameter to the constructor determines for how many energy groups we set up the relevant tables. At present, this program only includes data for 2 energy groups, but a more sophisticated program may be able to initialize the data structures for more groups as well, depending on how many energy groups are selected in the parameter file.</p>
<p>For each of the different coefficient types, there is one function that returns the value of this coefficient for a particular energy group (or combination of energy groups, as for the distribution cross section \(\chi_g\nu\Sigma_{f,g&#39;}\) or scattering cross section \(\Sigma_{s,g&#39;\to g}\)). In addition to the energy group or groups, these coefficients depend on the type of fuel or control rod, as explained in the introduction. The functions therefore take an additional parameter, <code>material_id</code>, that identifies the particular kind of rod. Within this program, we use <code>n_materials=8</code> different kinds of rods.</p>
<p>Except for the scattering cross section, each of the coefficients therefore can be represented as an entry in a two-dimensional array of floating point values indexed by the energy group number as well as the material ID. The <a class="el" href="classTable.html">Table</a> class template is the ideal way to store such data. Finally, the scattering coefficient depends on both two energy group indices and therefore needs to be stored in a three-dimensional array, for which we again use the <a class="el" href="classTable.html">Table</a> class, where this time the first template argument (denoting the dimensionality of the array) of course needs to be three:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MaterialData</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  MaterialData(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_groups);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> get_diffusion_coefficient(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) <span class="keyword">const</span>;</div>
<div class="line">  <span class="keywordtype">double</span> get_removal_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) <span class="keyword">const</span>;</div>
<div class="line">  <span class="keywordtype">double</span> get_fission_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) <span class="keyword">const</span>;</div>
<div class="line">  <span class="keywordtype">double</span> get_fission_dist_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_1,</div>
<div class="line">                             <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_2,</div>
<div class="line">                             <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) <span class="keyword">const</span>;</div>
<div class="line">  <span class="keywordtype">double</span> get_scattering_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_1,</div>
<div class="line">                           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_2,</div>
<div class="line">                           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) <span class="keyword">const</span>;</div>
<div class="line">  <span class="keywordtype">double</span> get_fission_spectrum(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_groups;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_materials;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTable.html">Table&lt;2, double&gt;</a> diffusion;</div>
<div class="line">  <a class="code" href="classTable.html">Table&lt;2, double&gt;</a> sigma_r;</div>
<div class="line">  <a class="code" href="classTable.html">Table&lt;2, double&gt;</a> nu_sigma_f;</div>
<div class="line">  <a class="code" href="classTable.html">Table&lt;3, double&gt;</a> sigma_s;</div>
<div class="line">  <a class="code" href="classTable.html">Table&lt;2, double&gt;</a> chi;</div>
<div class="line">};</div>
</div><!-- fragment --><p>The constructor of the class is used to initialize all the material data arrays. It takes the number of energy groups as an argument (an throws an error if that value is not equal to two, since at presently only data for two energy groups is implemented; however, using this, the function remains flexible and extendable into the future). In the member initialization part at the beginning, it also resizes the arrays to their correct sizes.</p>
<p>At present, material data is stored for 8 different types of material. This, as well, may easily be extended in the future.</p>
<div class="fragment"><div class="line">MaterialData::MaterialData(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_groups)</div>
<div class="line">  : n_groups(n_groups)</div>
<div class="line">  , n_materials(8)</div>
<div class="line">  , diffusion(n_materials, n_groups)</div>
<div class="line">  , sigma_r(n_materials, n_groups)</div>
<div class="line">  , nu_sigma_f(n_materials, n_groups)</div>
<div class="line">  , sigma_s(n_materials, n_groups, n_groups)</div>
<div class="line">  , chi(n_materials, n_groups)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">switch</span> (this-&gt;n_groups)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">case</span> 2:</div>
<div class="line">        {</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a> = 0; <a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a> &lt; n_materials; ++<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>)</div>
<div class="line">            {</div>
<div class="line">              diffusion[<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>][0] = 1.2;</div>
<div class="line">              diffusion[<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>][1] = 0.4;</div>
<div class="line">              chi[<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>][0]       = 1.0;</div>
<div class="line">              chi[<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>][1]       = 0.0;</div>
<div class="line">              sigma_r[<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>][0]   = 0.03;</div>
<div class="line">              <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_1 = 0; group_1 &lt; n_groups; ++group_1)</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_2 = 0; group_2 &lt; n_groups; ++group_2)</div>
<div class="line">                  sigma_s[<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>][group_1][group_2] = 0.0;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          diffusion[5][1] = 0.2;</div>
<div class="line"> </div>
<div class="line">          sigma_r[4][0] = 0.026;</div>
<div class="line">          sigma_r[5][0] = 0.051;</div>
<div class="line">          sigma_r[6][0] = 0.026;</div>
<div class="line">          sigma_r[7][0] = 0.050;</div>
<div class="line"> </div>
<div class="line">          sigma_r[0][1] = 0.100;</div>
<div class="line">          sigma_r[1][1] = 0.200;</div>
<div class="line">          sigma_r[2][1] = 0.250;</div>
<div class="line">          sigma_r[3][1] = 0.300;</div>
<div class="line">          sigma_r[4][1] = 0.020;</div>
<div class="line">          sigma_r[5][1] = 0.040;</div>
<div class="line">          sigma_r[6][1] = 0.020;</div>
<div class="line">          sigma_r[7][1] = 0.800;</div>
<div class="line"> </div>
<div class="line">          nu_sigma_f[0][0] = 0.0050;</div>
<div class="line">          nu_sigma_f[1][0] = 0.0075;</div>
<div class="line">          nu_sigma_f[2][0] = 0.0075;</div>
<div class="line">          nu_sigma_f[3][0] = 0.0075;</div>
<div class="line">          nu_sigma_f[4][0] = 0.000;</div>
<div class="line">          nu_sigma_f[5][0] = 0.000;</div>
<div class="line">          nu_sigma_f[6][0] = 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-7;</div>
<div class="line">          nu_sigma_f[7][0] = 0.00;</div>
<div class="line"> </div>
<div class="line">          nu_sigma_f[0][1] = 0.125;</div>
<div class="line">          nu_sigma_f[1][1] = 0.300;</div>
<div class="line">          nu_sigma_f[2][1] = 0.375;</div>
<div class="line">          nu_sigma_f[3][1] = 0.450;</div>
<div class="line">          nu_sigma_f[4][1] = 0.000;</div>
<div class="line">          nu_sigma_f[5][1] = 0.000;</div>
<div class="line">          nu_sigma_f[6][1] = 3<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-6;</div>
<div class="line">          nu_sigma_f[7][1] = 0.00;</div>
<div class="line"> </div>
<div class="line">          sigma_s[0][0][1] = 0.020;</div>
<div class="line">          sigma_s[1][0][1] = 0.015;</div>
<div class="line">          sigma_s[2][0][1] = 0.015;</div>
<div class="line">          sigma_s[3][0][1] = 0.015;</div>
<div class="line">          sigma_s[4][0][1] = 0.025;</div>
<div class="line">          sigma_s[5][0][1] = 0.050;</div>
<div class="line">          sigma_s[6][0][1] = 0.025;</div>
<div class="line">          sigma_s[7][0][1] = 0.010;</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">default</span>:</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>,</div>
<div class="line">               <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(</div>
<div class="line">                 <span class="stringliteral">&quot;Presently, only data for 2 groups is implemented&quot;</span>));</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Next are the functions that return the coefficient values for given materials and energy groups. All they do is to make sure that the given arguments are within the allowed ranges, and then look the respective value up in the corresponding tables:</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span></div>
<div class="line">MaterialData::get_diffusion_coefficient(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; n_groups, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, 0, n_groups));</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a> &lt; n_materials,</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>, 0, n_materials));</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> diffusion[<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>][<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>];</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> MaterialData::get_removal_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; n_groups, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, 0, n_groups));</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a> &lt; n_materials,</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>, 0, n_materials));</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> sigma_r[<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>][<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>];</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> MaterialData::get_fission_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; n_groups, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, 0, n_groups));</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a> &lt; n_materials,</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>, 0, n_materials));</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> nu_sigma_f[<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>][<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>];</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> MaterialData::get_scattering_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_1,</div>
<div class="line">                                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_2,</div>
<div class="line">                                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(group_1 &lt; n_groups, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(group_1, 0, n_groups));</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(group_2 &lt; n_groups, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(group_2, 0, n_groups));</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a> &lt; n_materials,</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>, 0, n_materials));</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> sigma_s[<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>][group_1][group_2];</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span></div>
<div class="line">MaterialData::get_fission_spectrum(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; n_groups, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, 0, n_groups));</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a> &lt; n_materials,</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>, 0, n_materials));</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> chi[<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>][<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>];</div>
<div class="line">}</div>
</div><!-- fragment --><p>The function computing the fission distribution cross section is slightly different, since it computes its value as the product of two other coefficients. We don't need to check arguments here, since this already happens when we call the two other functions involved, even though it would probably not hurt either:</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> MaterialData::get_fission_dist_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_1,</div>
<div class="line">                                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_2,</div>
<div class="line">                                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> (get_fission_spectrum(group_1, <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) *</div>
<div class="line">          get_fission_XS(group_2, <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>));</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ThecodeEnergyGroupcodeclass"></a> </p><h3>The <code>EnergyGroup</code> class</h3>
<p>The first interesting class is the one that contains everything that is specific to a single energy group. To group things that belong together into individual objects, we declare a structure that holds the <a class="el" href="classTriangulation.html">Triangulation</a> and <a class="el" href="classDoFHandler.html">DoFHandler</a> objects for the mesh used for a single energy group, and a number of other objects and member functions that we will discuss in the following sections.</p>
<p>The main reason for this class is as follows: for both the forward problem (with a specified right hand side) as well as for the eigenvalue problem, one typically solves a sequence of problems for a single energy group each, rather than the fully coupled problem. This becomes understandable once one realizes that the system matrix for a single energy group is symmetric and positive definite (it is simply a diffusion operator), whereas the matrix for the fully coupled problem is generally nonsymmetric and not definite. It is also very large and quite full if more than a few energy groups are involved.</p>
<p>Let us first look at the equation to solve in the case of an external right hand side (for the time independent case): </p><p class="formulaDsp">
\begin{eqnarray*} -\nabla \cdot(D_g(x) \nabla \phi_g(x)) + \Sigma_{r,g}(x)\phi_g(x) = \chi_g\sum_{g&#39;=1}^G\nu\Sigma_{f,g&#39;}(x)\phi_{g&#39;}(x) + \sum_{g&#39;\ne g}\Sigma_{s,g&#39;\to g}(x)\phi_{g&#39;}(x) + s_{\mathrm{ext},g}(x) \end{eqnarray*}
</p>
<p>We would typically solve this equation by moving all the terms on the right hand side with \(g&#39;=g\) to the left hand side, and solving for \(\phi_g\). Of course, we don't know \(\phi_{g&#39;}\) yet, since the equations for those variables include right hand side terms involving \(\phi_g\). What one typically does in such situations is to iterate: compute </p><p class="formulaDsp">
\begin{eqnarray*} -\nabla \cdot(D_g(x) \nabla \phi^{(n)}_g(x)) &amp;+&amp; \Sigma_{r,g}(x)\phi^{(n)}_g(x) \\ &amp;=&amp; \chi_g\sum_{g&#39;=1}^{g-1}\nu\Sigma_{f,g&#39;}(x)\phi^{(n)}_{g&#39;}(x) + \chi_g\sum_{g&#39;=g}^G\nu\Sigma_{f,g&#39;}(x)\phi^{(n-1)}_{g&#39;}(x) + \sum_{g&#39;\ne g, g&#39;&lt;g}\Sigma_{s,g&#39;\to g}(x)\phi^{(n)}_{g&#39;}(x) + \sum_{g&#39;\ne g, g&#39;&gt;g}\Sigma_{s,g&#39;\to g}(x)\phi^{(n-1)}_{g&#39;}(x) + s_{\mathrm{ext},g}(x) \end{eqnarray*}
</p>
<p>In other words, we solve the equation one by one, using values for \(\phi_{g&#39;}\) from the previous iteration \(n-1\) if \(g&#39;\ge g\) and already computed values for \(\phi_{g&#39;}\) from the present iteration if \(g&#39;&lt;g\).</p>
<p>When computing the eigenvalue, we do a very similar iteration, except that we have no external right hand side and that the solution is scaled after each iteration as explained in the introduction.</p>
<p>In either case, these two cases can be treated jointly if all we do is to equip the following class with these abilities: (i) form the left hand side matrix, (ii) form the in-group right hand side contribution, i.e. involving the extraneous source, and (iii) form that contribution to the right hand side that stems from group \(g&#39;\). This class does exactly these tasks (as well as some book-keeping, such as mesh refinement, setting up matrices and vectors, etc). On the other hand, the class itself has no idea how many energy groups there are, and in particular how they interact, i.e. the decision of how the outer iteration looks (and consequently whether we solve an eigenvalue or a direct problem) is left to the NeutronDiffusionProblem class further down below in this program.</p>
<p>So let us go through the class and its interface:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>EnergyGroup</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGroupcodepublicmemberfunctions"></a> </p><h5><code>EnergyGroup</code> public member functions</h5>
<p>The class has a good number of public member functions, since its the way it operates is controlled from the outside, and therefore all functions that do something significant need to be called from another class. Let's start off with book-keeping: the class obviously needs to know which energy group it represents, which material data to use, and from what coarse grid to start. The constructor takes this information and initializes the relevant member variables with that (see below).</p>
<p>Then we also need functions that set up the linear system, i.e. correctly size the matrix and its sparsity pattern, etc, given a finite element object to use. The <code>setup_linear_system</code> function does that. Finally, for this initial block, there are two functions that return the number of active cells and degrees of freedom used in this object &ndash; using this, we can make the triangulation and DoF handler member variables private, and do not have to grant external use to it, enhancing encapsulation:</p>
<div class="fragment"><div class="line">EnergyGroup(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">            <span class="keyword">const</span> MaterialData &amp;      material_data,</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;coarse_grid,</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup_linear_system();</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>() <span class="keyword">const</span>;</div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_dofs() <span class="keyword">const</span>;</div>
</div><!-- fragment --><p>Then there are functions that assemble the linear system for each iteration and the present energy group. Note that the matrix is independent of the iteration number, so only has to be computed once for each refinement cycle. The situation is a bit more involved for the right hand side that has to be updated in each inverse power iteration, and that is further complicated by the fact that computing it may involve several different meshes as explained in the introduction. To make things more flexible with regard to solving the forward or the eigenvalue problem, we split the computation of the right hand side into a function that assembles the extraneous source and in-group contributions (which we will call with a zero function as source terms for the eigenvalue problem) and one that computes contributions to the right hand side from another energy group:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> assemble_system_matrix();</div>
<div class="line"><span class="keywordtype">void</span> assemble_ingroup_rhs(<span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;extraneous_source);</div>
<div class="line"><span class="keywordtype">void</span> assemble_cross_group_rhs(<span class="keyword">const</span> EnergyGroup&lt;dim&gt; &amp;g_prime);</div>
</div><!-- fragment --><p>Next we need a set of functions that actually compute the solution of a linear system, and do something with it (such as computing the fission source contribution mentioned in the introduction, writing graphical information to an output file, computing error indicators, or actually refining the grid based on these criteria and thresholds for refinement and coarsening). All these functions will later be called from the driver class <code>NeutronDiffusionProblem</code>, or any other class you may want to implement to solve a problem involving the neutron flux equations:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>();</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> get_fission_source() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> estimate_errors(<a class="code" href="classVector.html">Vector&lt;float&gt;</a> &amp;error_indicators) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> refine_grid(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;float&gt;</a> &amp;error_indicators,</div>
<div class="line">                 <span class="keyword">const</span> <span class="keywordtype">double</span>         refine_threshold,</div>
<div class="line">                 <span class="keyword">const</span> <span class="keywordtype">double</span>         coarsen_threshold);</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGroupcodepublicdatamembers"></a> </p><h5><code>EnergyGroup</code> public data members</h5>
<p>As is good practice in object oriented programming, we hide most data members by making them private. However, we have to grant the class that drives the process access to the solution vector as well as the solution of the previous iteration, since in the power iteration, the solution vector is scaled in every iteration by the present guess of the eigenvalue we are looking for:</p>
<div class="fragment"><div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>;</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> solution_old;</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGroupcodeprivatedatamembers"></a> </p><h5><code>EnergyGroup</code> private data members</h5>
<p>The rest of the data members are private. Compared to all the previous tutorial programs, the only new data members are an integer storing which energy group this object represents, and a reference to the material data object that this object's constructor gets passed from the driver class. Likewise, the constructor gets a reference to the finite element object we are to use.</p>
<p>Finally, we have to apply boundary values to the linear system in each iteration, i.e. quite frequently. Rather than interpolating them every time, we interpolate them once on each new mesh and then store them along with all the other data of this class:</p>
<div class="fragment"><div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>;</div>
<div class="line">  <span class="keyword">const</span> MaterialData &amp;material_data;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a>        <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>;</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>;</div>
<div class="line">  <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>           dof_handler;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classSparsityPattern.html">SparsityPattern</a>      <a class="code" href="trilinos__sparse__matrix__0_8txt.html#ab4e34663c28496ee1b07f40fd5d00fa1">sparsity_pattern</a>;</div>
<div class="line">  <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> system_matrix;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> system_rhs;</div>
<div class="line"> </div>
<div class="line">  std::map&lt;types::global_dof_index, double&gt; boundary_values;</div>
<div class="line">  <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a>                 hanging_node_constraints;</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGroupcodeprivatememberfunctions"></a> </p><h5><code>EnergyGroup</code> private member functions</h5>
<p>There is one private member function in this class. It recursively walks over cells of two meshes to compute the cross-group right hand side terms. The algorithm for this is explained in the introduction to this program. The arguments to this function are a reference to an object representing the energy group against which we want to integrate a right hand side term, an iterator to a cell of the mesh used for the present energy group, an iterator to a corresponding cell on the other mesh, and the matrix that interpolates the degrees of freedom from the coarser of the two cells to the finer one:</p>
<div class="fragment"><div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keywordtype">void</span> assemble_cross_group_rhs_recursive(</div>
<div class="line">    <span class="keyword">const</span> EnergyGroup&lt;dim&gt; &amp;                       g_prime,</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::cell_iterator</a> &amp;cell_g,</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::cell_iterator</a> &amp;cell_g_prime,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> &amp;                     prolongation_matrix);</div>
<div class="line">};</div>
</div><!-- fragment --><p><a class="anchor" id="ImplementationofthecodeEnergyGroupcodeclass"></a> </p><h4>Implementation of the <code>EnergyGroup</code> class</h4>
<p>The first few functions of this class are mostly self-explanatory. The constructor only sets a few data members and creates a copy of the given triangulation as the base for the triangulation used for this energy group. The next two functions simply return data from private data members, thereby enabling us to make these data members private.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">EnergyGroup&lt;dim&gt;::EnergyGroup(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                              <span class="keyword">const</span> MaterialData &amp;      material_data,</div>
<div class="line">                              <span class="keyword">const</span> <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;coarse_grid,</div>
<div class="line">                              <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>)</div>
<div class="line">  : <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">  , material_data(material_data)</div>
<div class="line">  , <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>)</div>
<div class="line">  , dof_handler(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.copy_triangulation(coarse_grid);</div>
<div class="line">  dof_handler.distribute_dofs(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">EnergyGroup&lt;dim&gt;::n_active_cells</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> EnergyGroup&lt;dim&gt;::n_dofs()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> dof_handler.n_dofs();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGroupsetup_linear_systemcode"></a> </p><h5><code>EnergyGroup::setup_linear_system</code></h5>
<p>The first "real" function is the one that sets up the mesh, matrices, etc, on the new mesh or after mesh refinement. We use this function to initialize sparse system matrices, and the right hand side vector. If the solution vector has never been set before (as indicated by a zero size), we also initialize it and set it to a default value. We don't do that if it already has a non-zero size (i.e. this function is called after mesh refinement) since in that case we want to preserve the solution across mesh refinement (something we do in the <code>EnergyGroup::refine_grid</code> function).</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> EnergyGroup&lt;dim&gt;::setup_linear_system()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_dofs = dof_handler.n_dofs();</div>
<div class="line"> </div>
<div class="line">  hanging_node_constraints.clear();</div>
<div class="line">  <a class="code" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a>(dof_handler,</div>
<div class="line">                                          hanging_node_constraints);</div>
<div class="line">  hanging_node_constraints.close();</div>
<div class="line"> </div>
<div class="line">  system_matrix.clear();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(n_dofs, n_dofs);</div>
<div class="line">  <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler, dsp);</div>
<div class="line">  hanging_node_constraints.condense(dsp);</div>
<div class="line">  <a class="code" href="trilinos__sparse__matrix__0_8txt.html#ab4e34663c28496ee1b07f40fd5d00fa1">sparsity_pattern</a>.copy_from(dsp);</div>
<div class="line"> </div>
<div class="line">  system_matrix.reinit(<a class="code" href="trilinos__sparse__matrix__0_8txt.html#ab4e34663c28496ee1b07f40fd5d00fa1">sparsity_pattern</a>);</div>
<div class="line"> </div>
<div class="line">  system_rhs.reinit(n_dofs);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.size() == 0)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.reinit(n_dofs);</div>
<div class="line">      solution_old.reinit(n_dofs);</div>
<div class="line">      solution_old = 1.0;</div>
<div class="line">      <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>     = solution_old;</div>
<div class="line">    }</div>
</div><!-- fragment --><p>At the end of this function, we update the list of boundary nodes and their values, by first clearing this list and the re-interpolating boundary values (remember that this function is called after first setting up the mesh, and each time after mesh refinement).</p>
<p>To understand the code, it is necessary to realize that we create the mesh using the <code><a class="el" href="namespaceGridGenerator.html#ac76417d7404b75cf53c732f456e6e971">GridGenerator::subdivided_hyper_rectangle</a></code> function (in <code>NeutronDiffusionProblem::initialize_problem</code>) where we set the last parameter to <code>true</code>. This means that boundaries of the domain are "colored", i.e. the four (or six, in 3d) sides of the domain are assigned different boundary indicators. As it turns out, the bottom boundary gets indicator zero, the top one boundary indicator one, and left and right boundaries get indicators two and three, respectively.</p>
<p>In this program, we simulate only one, namely the top right, quarter of a reactor. That is, we want to interpolate boundary conditions only on the top and right boundaries, while do nothing on the bottom and left boundaries (i.e. impose natural, no-flux Neumann boundary conditions). This is most easily generalized to arbitrary dimension by saying that we want to interpolate on those boundaries with indicators 1, 3, ..., which we do in the following loop (note that calls to <code><a class="el" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a></code> are additive, i.e. they do not first clear the boundary value map):</p>
<div class="fragment"><div class="line">  boundary_values.clear();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(dof_handler,</div>
<div class="line">                                             2 * <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> + 1,</div>
<div class="line">                                             <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(),</div>
<div class="line">                                             boundary_values);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGroupassemble_system_matrixcode"></a> </p><h5><code>EnergyGroup::assemble_system_matrix</code></h5>
<p>Next we need functions assembling the system matrix and right hand sides. Assembling the matrix is straightforward given the equations outlined in the introduction as well as what we've seen in previous example programs. Note the use of <code>cell-&gt;<a class="el" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id()</a></code> to get at the kind of material from which a cell is made up of. Note also how we set the order of the quadrature formula so that it is always appropriate for the finite element in use.</p>
<p>Finally, note that since we only assemble the system matrix here, we can't yet eliminate boundary values (we need the right hand side vector for this). We defer this to the <code>EnergyGroup::solve</code> function, at which point all the information is available.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> EnergyGroup&lt;dim&gt;::assemble_system_matrix()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> quadrature_formula(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                          quadrature_formula,</div>
<div class="line">                          <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> |</div>
<div class="line">                            <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> = <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>();</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>    = quadrature_formula.size();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a>(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>, <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a>     cell_rhs(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; <a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.active_cell_iterators())</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a> = 0;</div>
<div class="line"> </div>
<div class="line">      fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> diffusion_coefficient =</div>
<div class="line">        material_data.get_diffusion_coefficient(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;material_id());</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> removal_XS =</div>
<div class="line">        material_data.get_removal_XS(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;material_id());</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q_point)</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> = 0; <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>)</div>
<div class="line">            <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>) +=</div>
<div class="line">              ((diffusion_coefficient * fe_values.shape_grad(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) *</div>
<div class="line">                  fe_values.shape_grad(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point) +</div>
<div class="line">                removal_XS * fe_values.shape_value(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) *</div>
<div class="line">                  fe_values.shape_value(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point)) *</div>
<div class="line">               fe_values.JxW(q_point));</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;get_dof_indices(<a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> = 0; <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>)</div>
<div class="line">          system_matrix.add(<a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>],</div>
<div class="line">                            <a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>[<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>],</div>
<div class="line">                            <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  hanging_node_constraints.condense(system_matrix);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGroupassemble_ingroup_rhscode"></a> </p><h5><code>EnergyGroup::assemble_ingroup_rhs</code></h5>
<p>As explained in the documentation of the <code>EnergyGroup</code> class, we split assembling the right hand side into two parts: the ingroup and the cross-group couplings. First, we need a function to assemble the right hand side of one specific group here, i.e. including an extraneous source (that we will set to zero for the eigenvalue problem) as well as the ingroup fission contributions. (In-group scattering has already been accounted for with the definition of removal cross section.) The function's workings are pretty standard as far as assembling right hand sides go, and therefore does not require more comments except that we mention that the right hand side vector is set to zero at the beginning of the function &ndash; something we are not going to do for the cross-group terms that simply add to the right hand side vector.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">EnergyGroup&lt;dim&gt;::assemble_ingroup_rhs(<span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;extraneous_source)</div>
<div class="line">{</div>
<div class="line">  system_rhs.reinit(dof_handler.n_dofs());</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> quadrature_formula(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> = <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>();</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>    = quadrature_formula.size();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                          quadrature_formula,</div>
<div class="line">                          <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> |</div>
<div class="line">                            <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a>      cell_rhs(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">  std::vector&lt;double&gt; extraneous_source_values(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line">  std::vector&lt;double&gt; solution_old_values(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; <a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.active_cell_iterators())</div>
<div class="line">    {</div>
<div class="line">      cell_rhs = 0;</div>
<div class="line"> </div>
<div class="line">      fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> fission_dist_XS =</div>
<div class="line">        material_data.get_fission_dist_XS(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;material_id());</div>
<div class="line"> </div>
<div class="line">      extraneous_source.<a class="code" href="classFunction.html#a562fc1114e95e702e6696721f71528db">value_list</a>(fe_values.get_quadrature_points(),</div>
<div class="line">                                   extraneous_source_values);</div>
<div class="line"> </div>
<div class="line">      fe_values.get_function_values(solution_old, solution_old_values);</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;get_dof_indices(<a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q_point)</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">          cell_rhs(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>) +=</div>
<div class="line">            ((extraneous_source_values[q_point] +</div>
<div class="line">              fission_dist_XS * solution_old_values[q_point]) *</div>
<div class="line">             fe_values.shape_value(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) * fe_values.JxW(q_point));</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">        system_rhs(<a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) += cell_rhs(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGroupassemble_cross_group_rhscode"></a> </p><h5><code>EnergyGroup::assemble_cross_group_rhs</code></h5>
<p>The more interesting function for assembling the right hand side vector for the equation of a single energy group is the one that couples energy group \(g\) and \(g&#39;\). As explained in the introduction, we first have to find the set of cells common to the meshes of the two energy groups. First we call <code>get_finest_common_cells</code> to obtain this list of pairs of common cells from both meshes. Both cells in a pair may not be active but at least one of them is. We then hand each of these cell pairs off to a function that computes the right hand side terms recursively.</p>
<p>Note that ingroup coupling is handled already before, so we exit the function early if \(g=g&#39;\).</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">EnergyGroup&lt;dim&gt;::assemble_cross_group_rhs(<span class="keyword">const</span> EnergyGroup&lt;dim&gt; &amp;g_prime)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> == g_prime.group)</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> std::list&lt;std::pair&lt;typename DoFHandler&lt;dim&gt;::cell_iterator,</div>
<div class="line">                            <span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::cell_iterator</a>&gt;&gt;</div>
<div class="line">    cell_list =</div>
<div class="line">      <a class="code" href="namespaceGridTools.html#a32a5016c746ad756046ecff264dfa60d">GridTools::get_finest_common_cells</a>(dof_handler, g_prime.dof_handler);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell_pair : cell_list)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> unit_matrix(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; unit_matrix.m(); ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">        unit_matrix(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>) = 1;</div>
<div class="line">      assemble_cross_group_rhs_recursive(g_prime,</div>
<div class="line">                                         cell_pair.first,</div>
<div class="line">                                         cell_pair.second,</div>
<div class="line">                                         unit_matrix);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGroupassemble_cross_group_rhs_recursivecode"></a> </p><h5><code>EnergyGroup::assemble_cross_group_rhs_recursive</code></h5>
<p>This is finally the function that handles assembling right hand side terms on potentially different meshes recursively, using the algorithm described in the introduction. The function takes a reference to the object representing energy group \(g&#39;\), as well as iterators to corresponding cells in the meshes for energy groups \(g\) and \(g&#39;\). At first, i.e. when this function is called from the one above, these two cells will be matching cells on two meshes; however, one of the two may be further refined, and we will call the function recursively with one of the two iterators replaced by one of the children of the original cell.</p>
<p>The last argument is the matrix product matrix \(B_{c^{(k)}}^T \cdots B_{c&#39;}^T B_c^T\) from the introduction that interpolates from the coarser of the two cells to the finer one. If the two cells match, then this is the identity matrix &ndash; exactly what we pass to this function initially.</p>
<p>The function has to consider two cases: that both of the two cells are not further refined, i.e. have no children, in which case we can finally assemble the right hand side contributions of this pair of cells; and that one of the two cells is further refined, in which case we have to keep recursing by looping over the children of the one cell that is not active. These two cases will be discussed below:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> EnergyGroup&lt;dim&gt;::assemble_cross_group_rhs_recursive(</div>
<div class="line">  <span class="keyword">const</span> EnergyGroup&lt;dim&gt; &amp;                       g_prime,</div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::cell_iterator</a> &amp;cell_g,</div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::cell_iterator</a> &amp;cell_g_prime,</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> &amp;                     prolongation_matrix)</div>
<div class="line">{</div>
</div><!-- fragment --><p>The first case is that both cells are no further refined. In that case, we can assemble the relevant terms (see the introduction). This involves assembling the mass matrix on the finer of the two cells (in fact there are two mass matrices with different coefficients, one for the fission distribution cross section \(\chi_g\nu\Sigma_{f,g&#39;}\) and one for the scattering cross section \(\Sigma_{s,g&#39;\to g}\)). This is straight forward, but note how we determine which of the two cells is the finer one by looking at the refinement level of the two cells:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (!cell_g-&gt;has_children() &amp;&amp; !cell_g_prime-&gt;has_children())</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>  quadrature_formula(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a> = quadrature_formula.size();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                            quadrature_formula,</div>
<div class="line">                            <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (cell_g-&gt;level() &gt; cell_g_prime-&gt;level())</div>
<div class="line">      fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(cell_g);</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(cell_g_prime);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> fission_dist_XS =</div>
<div class="line">      material_data.get_fission_dist_XS(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                        g_prime.group,</div>
<div class="line">                                        cell_g_prime-&gt;material_id());</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> scattering_XS =</div>
<div class="line">      material_data.get_scattering_XS(g_prime.group,</div>
<div class="line">                                      <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                      cell_g_prime-&gt;material_id());</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> local_mass_matrix_f(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(),</div>
<div class="line">                                           <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> local_mass_matrix_g(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(),</div>
<div class="line">                                           <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q_point)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(); ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> = 0; <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> &lt; <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(); ++<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>)</div>
<div class="line">          {</div>
<div class="line">            local_mass_matrix_f(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>) +=</div>
<div class="line">              (fission_dist_XS * fe_values.shape_value(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) *</div>
<div class="line">               fe_values.shape_value(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point) * fe_values.JxW(q_point));</div>
<div class="line">            local_mass_matrix_g(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>) +=</div>
<div class="line">              (scattering_XS * fe_values.shape_value(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) *</div>
<div class="line">               fe_values.shape_value(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point) * fe_values.JxW(q_point));</div>
<div class="line">          }</div>
</div><!-- fragment --><p>Now we have all the interpolation (prolongation) matrices as well as local mass matrices, so we only have to form the product </p><p class="formulaDsp">
\[ F_i|_{K_{cc&#39;\cdots c^{(k)}}} = [B_c B_{c&#39;} \cdots B_{c^{(k)}} M_{K_{cc&#39;\cdots c^{(k)}}}]^{ij} \phi_{g&#39;}^j, \]
</p>
<p> or </p><p class="formulaDsp">
\[ F_i|_{K_{cc&#39;\cdots c^{(k)}}} = [(B_c B_{c&#39;} \cdots B_{c^{(k)}} M_{K_{cc&#39;\cdots c^{(k)}}})^T]^{ij} \phi_{g&#39;}^j, \]
</p>
<p> depending on which of the two cells is the finer. We do this using either the matrix-vector product provided by the <code>vmult</code> function, or the product with the transpose matrix using <code>Tvmult</code>. After doing so, we transfer the result into the global right hand side vector of energy group \(g\).</p>
<div class="fragment"><div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> g_prime_new_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> g_prime_old_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">  cell_g_prime-&gt;get_dof_values(g_prime.solution_old, g_prime_old_values);</div>
<div class="line">  cell_g_prime-&gt;get_dof_values(g_prime.solution, g_prime_new_values);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> cell_rhs(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> tmp(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (cell_g-&gt;level() &gt; cell_g_prime-&gt;level())</div>
<div class="line">    {</div>
<div class="line">      prolongation_matrix.<a class="code" href="classFullMatrix.html#a65a409eeef6388d99ac15e2bbe8045f6">vmult</a>(tmp, g_prime_old_values);</div>
<div class="line">      local_mass_matrix_f.vmult(cell_rhs, tmp);</div>
<div class="line"> </div>
<div class="line">      prolongation_matrix.<a class="code" href="classFullMatrix.html#a65a409eeef6388d99ac15e2bbe8045f6">vmult</a>(tmp, g_prime_new_values);</div>
<div class="line">      local_mass_matrix_g.vmult_add(cell_rhs, tmp);</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">      local_mass_matrix_f.vmult(tmp, g_prime_old_values);</div>
<div class="line">      prolongation_matrix.<a class="code" href="classFullMatrix.html#a8219d4fa962f1b041a506221a7a15379">Tvmult</a>(cell_rhs, tmp);</div>
<div class="line"> </div>
<div class="line">      local_mass_matrix_g.vmult(tmp, g_prime_new_values);</div>
<div class="line">      prolongation_matrix.<a class="code" href="classFullMatrix.html#abed6fffa5cb201496d751a4427cb59d6">Tvmult_add</a>(cell_rhs, tmp);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; <a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>(</div>
<div class="line">    <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">  cell_g-&gt;get_dof_indices(<a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(); ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">    system_rhs(<a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) += cell_rhs(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>The alternative is that one of the two cells is further refined. In that case, we have to loop over all the children, multiply the existing interpolation (prolongation) product of matrices from the left with the interpolation from the present cell to its child (using the matrix-matrix multiplication function <code>mmult</code>), and then hand the result off to this very same function again, but with the cell that has children replaced by one of its children:</p>
<div class="fragment"><div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="geometry__info__0_8txt.html#a07de0b60409c551e987416d5062d2742">child</a> = 0;</div>
<div class="line">         child &lt; GeometryInfo&lt;dim&gt;::max_children_per_cell;</div>
<div class="line">         ++<a class="code" href="geometry__info__0_8txt.html#a07de0b60409c551e987416d5062d2742">child</a>)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> new_matrix(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(),</div>
<div class="line">                                      <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">        <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFE__Q__Base.html#af8c966792cf559b9cdc5e5f91e2c6ed6">get_prolongation_matrix</a>(<a class="code" href="geometry__info__0_8txt.html#a07de0b60409c551e987416d5062d2742">child</a>).<a class="code" href="classFullMatrix.html#a21b873fcd180999ad0d268c3278a71ec">mmult</a>(new_matrix,</div>
<div class="line">                                                prolongation_matrix);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (cell_g-&gt;has_children())</div>
<div class="line">          assemble_cross_group_rhs_recursive(g_prime,</div>
<div class="line">                                             cell_g-&gt;child(<a class="code" href="geometry__info__0_8txt.html#a07de0b60409c551e987416d5062d2742">child</a>),</div>
<div class="line">                                             cell_g_prime,</div>
<div class="line">                                             new_matrix);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          assemble_cross_group_rhs_recursive(g_prime,</div>
<div class="line">                                             cell_g,</div>
<div class="line">                                             cell_g_prime-&gt;child(<a class="code" href="geometry__info__0_8txt.html#a07de0b60409c551e987416d5062d2742">child</a>),</div>
<div class="line">                                             new_matrix);</div>
<div class="line">      }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGroupget_fission_sourcecode"></a> </p><h5><code>EnergyGroup::get_fission_source</code></h5>
<p>In the (inverse) power iteration, we use the integrated fission source to update the \(k\)-eigenvalue. Given its definition, the following function is essentially self-explanatory:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">double</span> EnergyGroup&lt;dim&gt;::get_fission_source()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>  quadrature_formula(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1);</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a> = quadrature_formula.size();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                          quadrature_formula,</div>
<div class="line">                          <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;double&gt; solution_values(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> fission_source = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.active_cell_iterators())</div>
<div class="line">    {</div>
<div class="line">      fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> fission_XS =</div>
<div class="line">        material_data.get_fission_XS(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;material_id());</div>
<div class="line"> </div>
<div class="line">      fe_values.get_function_values(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, solution_values);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q_point)</div>
<div class="line">        fission_source +=</div>
<div class="line">          (fission_XS * solution_values[q_point] * fe_values.JxW(q_point));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> fission_source;</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGroupsolvecode"></a> </p><h5><code>EnergyGroup::solve</code></h5>
<p>Next a function that solves the linear system assembled before. Things are pretty much standard, except that we delayed applying boundary values until we get here, since in all the previous functions we were still adding up contributions the right hand side vector.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">EnergyGroup&lt;dim&gt;::solve</a>()</div>
<div class="line">{</div>
<div class="line">  hanging_node_constraints.condense(system_rhs);</div>
<div class="line">  <a class="code" href="namespaceMatrixTools.html#a9ad0eb7a8662628534586716748d62fb">MatrixTools::apply_boundary_values</a>(boundary_values,</div>
<div class="line">                                     system_matrix,</div>
<div class="line">                                     <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>,</div>
<div class="line">                                     system_rhs);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classSolverControl.html">SolverControl</a>            solver_control(system_matrix.m(),</div>
<div class="line">                               1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-12 * system_rhs.l2_norm());</div>
<div class="line">  <a class="code" href="classSolverCG.html">SolverCG&lt;Vector&lt;double&gt;</a>&gt; cg(solver_control);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classPreconditionSSOR.html">PreconditionSSOR&lt;SparseMatrix&lt;double&gt;</a>&gt; <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>;</div>
<div class="line">  <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>.initialize(system_matrix, 1.2);</div>
<div class="line"> </div>
<div class="line">  cg.solve(system_matrix, <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, system_rhs, <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>);</div>
<div class="line"> </div>
<div class="line">  hanging_node_constraints.distribute(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGroupestimate_errorscode"></a> </p><h5><code>EnergyGroup::estimate_errors</code></h5>
<p>Mesh refinement is split into two functions. The first estimates the error for each cell, normalizes it by the magnitude of the solution, and returns it in the vector given as an argument. The calling function collects all error indicators from all energy groups, and computes thresholds for refining and coarsening cells.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> EnergyGroup&lt;dim&gt;::estimate_errors(<a class="code" href="classVector.html">Vector&lt;float&gt;</a> &amp;error_indicators)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="classKellyErrorEstimator.html#aa0917e696d4f8ddb983223a68c512357">KellyErrorEstimator&lt;dim&gt;::estimate</a>(</div>
<div class="line">    dof_handler,</div>
<div class="line">    <a class="code" href="classQGauss.html">QGauss&lt;dim - 1&gt;</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1),</div>
<div class="line">    <a class="code" href="mapping__fe__0_8txt.html#a0af9c36aca1d2fa34a8615b4521ad4de">std::map</a>&lt;<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">types::boundary_id</a>, <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> *&gt;(),</div>
<div class="line">    <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>,</div>
<div class="line">    error_indicators);</div>
<div class="line">  error_indicators /= <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.linfty_norm();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGrouprefine_gridcode"></a> </p><h5><code>EnergyGroup::refine_grid</code></h5>
<p>The second part is to refine the grid given the error indicators compute in the previous function and error thresholds above which cells shall be refined or below which cells shall be coarsened. Note that we do not use any of the functions in <code><a class="el" href="namespaceGridRefinement.html">GridRefinement</a></code> here, but rather set refinement flags ourselves.</p>
<p>After setting these flags, we use the <a class="el" href="classSolutionTransfer.html">SolutionTransfer</a> class to move the solution vector from the old to the new mesh. The procedure used here is described in detail in the documentation of that class:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> EnergyGroup&lt;dim&gt;::refine_grid(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;float&gt;</a> &amp;error_indicators,</div>
<div class="line">                                   <span class="keyword">const</span> <span class="keywordtype">double</span>         refine_threshold,</div>
<div class="line">                                   <span class="keyword">const</span> <span class="keywordtype">double</span>         coarsen_threshold)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.active_cell_iterators())</div>
<div class="line">    <span class="keywordflow">if</span> (error_indicators(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;active_cell_index()) &gt; refine_threshold)</div>
<div class="line">      <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;set_refine_flag();</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (error_indicators(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;active_cell_index()) &lt; coarsen_threshold)</div>
<div class="line">      <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;set_coarsen_flag();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classSolutionTransfer.html">SolutionTransfer&lt;dim&gt;</a> soltrans(dof_handler);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.prepare_coarsening_and_refinement();</div>
<div class="line">  soltrans.prepare_for_coarsening_and_refinement(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.execute_coarsening_and_refinement();</div>
<div class="line">  dof_handler.distribute_dofs(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
<div class="line">  setup_linear_system();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.reinit(dof_handler.n_dofs());</div>
<div class="line">  soltrans.interpolate(solution_old, <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
</div><!-- fragment --><p>enforce constraints to make the interpolated solution conforming on the new mesh:</p>
<div class="fragment"><div class="line">  hanging_node_constraints.distribute(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line">  solution_old.reinit(dof_handler.n_dofs());</div>
<div class="line">  solution_old = <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGroupoutput_resultscode"></a> </p><h5><code>EnergyGroup::output_results</code></h5>
<p>The last function of this class outputs meshes and solutions after each mesh iteration. This has been shown many times before. The only thing worth pointing out is the use of the <code><a class="el" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a></code> function to convert an integer into its string representation. The second argument of that function denotes how many digits we shall use &ndash; if this value was larger than one, then the number would be padded by leading zeros.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> EnergyGroup&lt;dim&gt;::output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keyword">const</span> std::string filename = std::string(<span class="stringliteral">&quot;solution-&quot;</span>) +</div>
<div class="line">                               <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, 2) + <span class="stringliteral">&quot;.&quot;</span> +</div>
<div class="line">                               <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>, 2) + <span class="stringliteral">&quot;.vtu&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line"> </div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">attach_dof_handler</a>(dof_handler);</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, <span class="stringliteral">&quot;solution&quot;</span>);</div>
<div class="line">  data_out.<a class="code" href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">build_patches</a>();</div>
<div class="line"> </div>
<div class="line">  std::ofstream <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>(filename);</div>
<div class="line">  data_out.<a class="code" href="classDataOutInterface.html#a93c780f93105e0daaa76c6c43694b4ae">write_vtu</a>(<a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ThecodeNeutronDiffusionProblemcodeclasstemplate"></a> </p><h3>The <code>NeutronDiffusionProblem</code> class template</h3>
<p>This is the main class of the program, not because it implements all the functionality (in fact, most of it is implemented in the <code>EnergyGroup</code> class) but because it contains the driving algorithm that determines what to compute and when. It is mostly as shown in many of the other tutorial programs in that it has a public <code>run</code> function and private functions doing all the rest. In several places, we have to do something for all energy groups, in which case we will start tasks for each group to let these things run in parallel if deal.II was configured for multithreading. For strategies of parallelization, take a look at the <a class="el" href="group__threads.html">Parallel computing with multiple processors accessing</a> module.</p>
<p>The biggest difference to previous example programs is that we also declare a nested class that has member variables for all the run-time parameters that can be passed to the program in an input file. Right now, these are the number of energy groups, the number of refinement cycles, the polynomial degree of the finite element to be used, and the tolerance used to determine when convergence of the inverse power iteration has occurred. In addition, we have a constructor of this class that sets all these values to their default values, a function <code>declare_parameters</code> that describes to the <a class="el" href="classParameterHandler.html">ParameterHandler</a> class what parameters are accepted in the input file, and a function <code>get_parameters</code> that can extract the values of these parameters from a <a class="el" href="classParameterHandler.html">ParameterHandler</a> object. See also <a class="el" href="step_29.html">step-29</a> for another example of using <a class="el" href="classParameterHandler.html">ParameterHandler</a>.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>NeutronDiffusionProblem</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">class </span>Parameters</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    Parameters();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    <span class="keywordtype">void</span>        get_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_groups;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_refinement_cycles;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> convergence_tolerance;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  NeutronDiffusionProblem(<span class="keyword">const</span> Parameters &amp;<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">run</a>();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
</div><!-- fragment --><p><a class="anchor" id="codeNeutronDiffusionProblemcodeprivatememberfunctions"></a> </p><h5><code>NeutronDiffusionProblem</code> private member functions</h5>
<p>There are not that many member functions in this class since most of the functionality has been moved into the <code>EnergyGroup</code> class and is simply called from the <code><a class="el" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">run()</a></code> member function of this class. The ones that remain have self-explanatory names:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> initialize_problem();</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> refine_grid();</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> get_total_fission_source() <span class="keyword">const</span>;</div>
</div><!-- fragment --><p><a class="anchor" id="codeNeutronDiffusionProblemcodeprivatemembervariables"></a> </p><h5><code>NeutronDiffusionProblem</code> private member variables</h5>
<p>Next, we have a few member variables. In particular, these are (i) a reference to the parameter object (owned by the main function of this program, and passed to the constructor of this class), (ii) an object describing the material parameters for the number of energy groups requested in the input file, and (iii) the finite element to be used by all energy groups:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> Parameters &amp; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>;</div>
<div class="line"><span class="keyword">const</span> MaterialData material_data;</div>
<div class="line"><a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a>          <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>;</div>
</div><!-- fragment --><p>Furthermore, we have (iv) the value of the computed eigenvalue at the present iteration. This is, in fact, the only part of the solution that is shared between all energy groups &ndash; all other parts of the solution, such as neutron fluxes are particular to one or the other energy group, and are therefore stored in objects that describe a single energy group:</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> k_eff;</div>
</div><!-- fragment --><p>The last computational object (v) is an array of pointers to the energy group objects. The length of this array is, of course, equal to the number of energy groups specified in the parameter file.</p>
<div class="fragment"><div class="line">std::vector&lt;std::unique_ptr&lt;EnergyGroup&lt;dim&gt;&gt;&gt; energy_groups;</div>
</div><!-- fragment --><p>Finally (vi) we have a file stream to which we will save summarized output.</p>
<div class="fragment"><div class="line">  std::ofstream convergence_table_stream;</div>
<div class="line">};</div>
</div><!-- fragment --><p><a class="anchor" id="ImplementationofthecodeParameterscodeclass"></a> </p><h4>Implementation of the <code>Parameters</code> class</h4>
<p>Before going on to the implementation of the outer class, we have to implement the functions of the parameters structure. This is pretty straightforward and, in fact, looks pretty much the same for all such parameters classes using the <a class="el" href="classParameterHandler.html">ParameterHandler</a> capabilities. We will therefore not comment further on this:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">NeutronDiffusionProblem&lt;dim&gt;::Parameters::Parameters()</div>
<div class="line">  : n_groups(2)</div>
<div class="line">  , n_refinement_cycles(5)</div>
<div class="line">  , <a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>(2)</div>
<div class="line">  , convergence_tolerance(1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-12)</div>
<div class="line">{}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">NeutronDiffusionProblem&lt;dim&gt;::Parameters::declare_parameters</a>(</div>
<div class="line">  <a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Number of energy groups&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(),</div>
<div class="line">                    <span class="stringliteral">&quot;The number of energy different groups considered&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Refinement cycles&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;5&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(),</div>
<div class="line">                    <span class="stringliteral">&quot;Number of refinement cycles to be performed&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Finite element degree&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(),</div>
<div class="line">                    <span class="stringliteral">&quot;Polynomial degree of the finite element to be used&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(</div>
<div class="line">    <span class="stringliteral">&quot;Power iteration tolerance&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;1e-12&quot;</span>,</div>
<div class="line">    <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">    <span class="stringliteral">&quot;Inner power iterations are stopped when the change in k_eff falls &quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;below this tolerance&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> NeutronDiffusionProblem&lt;dim&gt;::Parameters::get_parameters(</div>
<div class="line">  <a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  n_groups              = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Number of energy groups&quot;</span>);</div>
<div class="line">  n_refinement_cycles   = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Refinement cycles&quot;</span>);</div>
<div class="line">  <a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>             = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Finite element degree&quot;</span>);</div>
<div class="line">  convergence_tolerance = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Power iteration tolerance&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ImplementationofthecodeNeutronDiffusionProblemcodeclass"></a> </p><h4>Implementation of the <code>NeutronDiffusionProblem</code> class</h4>
<p>Now for the <code>NeutronDiffusionProblem</code> class. The constructor and destructor have nothing of much interest:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">NeutronDiffusionProblem&lt;dim&gt;::NeutronDiffusionProblem(</div>
<div class="line">  <span class="keyword">const</span> Parameters &amp;<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>)</div>
<div class="line">  : <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>)</div>
<div class="line">  , material_data(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups)</div>
<div class="line">  , <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.<a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>)</div>
<div class="line">  , k_eff(std::numeric_limits&lt;<a class="code" href="hdf5__0_8txt.html#aae153b86de45d3354cd3edd5b992435e">double</a>&gt;::quiet_NaN())</div>
<div class="line">{}</div>
</div><!-- fragment --><p><a class="anchor" id="codeNeutronDiffusionProbleminitialize_problemcode"></a> </p><h5><code>NeutronDiffusionProblem::initialize_problem</code></h5>
<p>The first function of interest is the one that sets up the geometry of the reactor core. This is described in more detail in the introduction.</p>
<p>The first part of the function defines geometry data, and then creates a coarse mesh that has as many cells as there are fuel rods (or pin cells, for that matter) in that part of the reactor core that we simulate. As mentioned when interpolating boundary values above, the last parameter to the <code><a class="el" href="namespaceGridGenerator.html#ac76417d7404b75cf53c732f456e6e971">GridGenerator::subdivided_hyper_rectangle</a></code> function specifies that sides of the domain shall have unique boundary indicators that will later allow us to determine in a simple way which of the boundaries have Neumann and which have Dirichlet conditions attached to them.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> NeutronDiffusionProblem&lt;dim&gt;::initialize_problem()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rods_per_assembly_x = 17, rods_per_assembly_y = 17;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span>       pin_pitch_x = 1.26, pin_pitch_y = 1.26;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span>       assembly_height = 200;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> assemblies_x = 2, assemblies_y = 2, assemblies_z = 1;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> bottom_left = <a class="code" href="classPoint.html">Point&lt;dim&gt;</a>();</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> upper_right =</div>
<div class="line">    (<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> == 2 ? <a class="code" href="classPoint.html">Point&lt;dim&gt;</a>(assemblies_x * rods_per_assembly_x * pin_pitch_x,</div>
<div class="line">                           assemblies_y * rods_per_assembly_y * pin_pitch_y) :</div>
<div class="line">                <a class="code" href="classPoint.html">Point</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;(assemblies_x * rods_per_assembly_x * pin_pitch_x,</div>
<div class="line">                           assemblies_y * rods_per_assembly_y * pin_pitch_y,</div>
<div class="line">                           assemblies_z * assembly_height));</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;unsigned int&gt; <a class="code" href="data__out__base__0_8txt.html#a292e9ce72a5d87dfef124355ac0fdd32">n_subdivisions</a>;</div>
<div class="line">  <a class="code" href="data__out__base__0_8txt.html#a292e9ce72a5d87dfef124355ac0fdd32">n_subdivisions</a>.push_back(assemblies_x * rods_per_assembly_x);</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> &gt;= 2)</div>
<div class="line">    <a class="code" href="data__out__base__0_8txt.html#a292e9ce72a5d87dfef124355ac0fdd32">n_subdivisions</a>.push_back(assemblies_y * rods_per_assembly_y);</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> &gt;= 3)</div>
<div class="line">    <a class="code" href="data__out__base__0_8txt.html#a292e9ce72a5d87dfef124355ac0fdd32">n_subdivisions</a>.push_back(assemblies_z);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> coarse_grid;</div>
<div class="line">  <a class="code" href="namespaceGridGenerator.html#ac76417d7404b75cf53c732f456e6e971">GridGenerator::subdivided_hyper_rectangle</a>(</div>
<div class="line">    coarse_grid, <a class="code" href="data__out__base__0_8txt.html#a292e9ce72a5d87dfef124355ac0fdd32">n_subdivisions</a>, bottom_left, upper_right, <span class="keyword">true</span>);</div>
</div><!-- fragment --><p>The second part of the function deals with material numbers of pin cells of each type of assembly. Here, we define four different types of assembly, for which we describe the arrangement of fuel rods in the following tables.</p>
<p>The assemblies described here are taken from the benchmark mentioned in the introduction and are (in this order): </p><ol>
<li>
'UX' Assembly: UO2 fuel assembly with 24 guide tubes and a central Moveable Fission Chamber </li>
<li>
'UA' Assembly: UO2 fuel assembly with 24 AIC and a central Moveable Fission Chamber </li>
<li>
'PX' Assembly: MOX fuel assembly with 24 guide tubes and a central Moveable Fission Chamber </li>
<li>
'R' Assembly: a reflector. </li>
</ol>
<p>Note that the numbers listed here and taken from the benchmark description are, in good old Fortran fashion, one-based. We will later subtract one from each number when assigning materials to individual cells to convert things into the C-style zero-based indexing.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_assemblies = 4;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> assembly_materials</div>
<div class="line">  [n_assemblies][rods_per_assembly_x][rods_per_assembly_y] = {</div>
<div class="line">    {{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 5, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 5, 1, 1, 5, 1, 1, 7, 1, 1, 5, 1, 1, 5, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 5, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}},</div>
<div class="line">    {{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 8, 1, 1, 1, 1, 1, 1, 1, 1, 1, 8, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 8, 1, 1, 8, 1, 1, 7, 1, 1, 8, 1, 1, 8, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 8, 1, 1, 1, 1, 1, 1, 1, 1, 1, 8, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}},</div>
<div class="line">    {{2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2},</div>
<div class="line">     {2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2},</div>
<div class="line">     {2, 3, 3, 3, 3, 5, 3, 3, 5, 3, 3, 5, 3, 3, 3, 3, 2},</div>
<div class="line">     {2, 3, 3, 5, 3, 4, 4, 4, 4, 4, 4, 4, 3, 5, 3, 3, 2},</div>
<div class="line">     {2, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 3, 2},</div>
<div class="line">     {2, 3, 5, 4, 4, 5, 4, 4, 5, 4, 4, 5, 4, 4, 5, 3, 2},</div>
<div class="line">     {2, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 2},</div>
<div class="line">     {2, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 2},</div>
<div class="line">     {2, 3, 5, 4, 4, 5, 4, 4, 7, 4, 4, 5, 4, 4, 5, 3, 2},</div>
<div class="line">     {2, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 2},</div>
<div class="line">     {2, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 2},</div>
<div class="line">     {2, 3, 5, 4, 4, 5, 4, 4, 5, 4, 4, 5, 4, 4, 5, 3, 2},</div>
<div class="line">     {2, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 3, 2},</div>
<div class="line">     {2, 3, 3, 5, 3, 4, 4, 4, 4, 4, 4, 4, 3, 5, 3, 3, 2},</div>
<div class="line">     {2, 3, 3, 3, 3, 5, 3, 3, 5, 3, 3, 5, 3, 3, 3, 3, 2},</div>
<div class="line">     {2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2},</div>
<div class="line">     {2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2}},</div>
<div class="line">    {{6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6}}};</div>
</div><!-- fragment --><p>After the description of the materials that make up an assembly, we have to specify the arrangement of assemblies within the core. We use a symmetric pattern that in fact only uses the 'UX' and 'PX' assemblies:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> core[assemblies_x][assemblies_y][assemblies_z] = {</div>
<div class="line">  {{0}, {2}}, {{2}, {0}}};</div>
</div><!-- fragment --><p>We are now in a position to actually set material IDs for each cell. To this end, we loop over all cells, look at the location of the cell's center, and determine which assembly and fuel rod this would be in. (We add a few checks to see that the locations we compute are within the bounds of the arrays in which we have to look up materials.) At the end of the loop, we set material identifiers accordingly:</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : coarse_grid.<a class="code" href="group__CPP11.html#ga4288670ae5bd80367e24918d542cb2d8">active_cell_iterators</a>())</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> cell_center = <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;center();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tmp_x = <a class="code" href="table__handler__0_8txt.html#aa02519610f643695a6a4f66c4062392a">int</a>(cell_center[0] / pin_pitch_x);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ax    = tmp_x / rods_per_assembly_x;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cx    = tmp_x - ax * rods_per_assembly_x;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span>     tmp_y = <a class="code" href="table__handler__0_8txt.html#aa02519610f643695a6a4f66c4062392a">int</a>(cell_center[1] / pin_pitch_y);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ay    = tmp_y / rods_per_assembly_y;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cy    = tmp_y - ay * rods_per_assembly_y;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> az =</div>
<div class="line">      (<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> == 2 ? 0 : <a class="code" href="table__handler__0_8txt.html#aa02519610f643695a6a4f66c4062392a">int</a>(cell_center[<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> - 1] / assembly_height));</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(ax &lt; assemblies_x, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(ay &lt; assemblies_y, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(az &lt; assemblies_z, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(core[ax][ay][az] &lt; n_assemblies, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(cx &lt; rods_per_assembly_x, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(cy &lt; rods_per_assembly_y, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;set_material_id(assembly_materials[core[ax][ay][az]][cx][cy] - 1);</div>
<div class="line">  }</div>
</div><!-- fragment --><p>With the coarse mesh so initialized, we create the appropriate number of energy group objects and let them initialize their individual meshes with the coarse mesh generated above:</p>
<div class="fragment"><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">    energy_groups.emplace_back(std::make_unique&lt;EnergyGroup&lt;dim&gt;&gt;(</div>
<div class="line">      <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, material_data, coarse_grid, <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>));</div>
<div class="line">  convergence_table_stream.open(<span class="stringliteral">&quot;convergence_table&quot;</span>);</div>
<div class="line">  convergence_table_stream.precision(12);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeNeutronDiffusionProblemget_total_fission_sourcecode"></a> </p><h5><code>NeutronDiffusionProblem::get_total_fission_source</code></h5>
<p>In the eigenvalue computation, we need to calculate total fission neutron source after each power iteration. The total power then is used to renew k-effective.</p>
<p>Since the total fission source is a sum over all the energy groups, and since each of these sums can be computed independently, we actually do this in parallel. One of the problems is that the function in the <code>EnergyGroup</code> class that computes the fission source returns a value. We would like to add these values together in the loop itself: ideally, each task would compute its value and then immediately add it to the total. Concurrently summing values in this way requires two features: </p><ol>
<li>
We need a way of storing a value such that multiple threads can read and write into concurrently in a way that prevents data races (i.e., thread-safe reading and writing). </li>
<li>
We need a way to increment such a value that is also thread-safe. </li>
</ol>
<p>The first feature is available through the template class <code>std::atomic</code>. However, the second feature, implemented by <code>std::atomic&lt;double&gt;::fetch_add()</code>, is only available in C++20 and later: since deal.II supports older versions of the C++ language standard we cannot use this feature yet. Hence, instead, we simply write each group's value out to an entry in a vector and sum the values at the end of the function.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">double</span> NeutronDiffusionProblem&lt;dim&gt;::get_total_fission_source()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  std::vector&lt;double&gt;  fission_sources(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups);</div>
<div class="line">  <a class="code" href="classThreads_1_1TaskGroup.html">Threads::TaskGroup&lt;&gt;</a> <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a>;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">    <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a> += Threads::new_task&lt;&gt;([&amp;, <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]() {</div>
<div class="line">      fission_sources[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>] = energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;get_fission_source();</div>
<div class="line">    });</div>
<div class="line">  <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a>.join_all();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> std::accumulate(fission_sources.begin(), fission_sources.end(), 0.0);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeNeutronDiffusionProblemrefine_gridcode"></a> </p><h5><code>NeutronDiffusionProblem::refine_grid</code></h5>
<p>The next function lets the individual energy group objects refine their meshes. Much of this, again, is a task that can be done independently in parallel: first, let all the energy group objects calculate their error indicators in parallel, then compute the maximum error indicator over all energy groups and determine thresholds for refinement and coarsening of cells, and then ask all the energy groups to refine their meshes accordingly, again in parallel.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> NeutronDiffusionProblem&lt;dim&gt;::refine_grid()</div>
<div class="line">{</div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups);</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">    <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>] = energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classBlockVector.html">BlockVector&lt;float&gt;</a> group_error_indicators(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>);</div>
<div class="line"> </div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classThreads_1_1TaskGroup.html">Threads::TaskGroup&lt;&gt;</a> <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a>;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">      <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a> += <a class="code" href="group__threads.html#ga664740f5d3f738649ac2811f8d656d11">Threads::new_task</a>([&amp;, <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]() {</div>
<div class="line">        energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;estimate_errors(</div>
<div class="line">          group_error_indicators.block(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>));</div>
<div class="line">      });</div>
<div class="line">  }</div>
</div><!-- fragment --><p>The destructor of <a class="el" href="classThreads_1_1TaskGroup.html">Threads::TaskGroup</a> joins all threads so we know that the computation is done by the time we exit the scope.</p>
<div class="fragment"><div class="line">  <span class="keyword">const</span> <span class="keywordtype">float</span> max_error         = group_error_indicators.linfty_norm();</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">float</span> refine_threshold  = 0.3 * max_error;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">float</span> coarsen_threshold = 0.01 * max_error;</div>
<div class="line"> </div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classThreads_1_1TaskGroup.html">Threads::TaskGroup&lt;void&gt;</a> <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a>;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">      <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a> += <a class="code" href="group__threads.html#ga664740f5d3f738649ac2811f8d656d11">Threads::new_task</a>([&amp;, <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]() {</div>
<div class="line">        energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;refine_grid(group_error_indicators.block(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>),</div>
<div class="line">                                          refine_threshold,</div>
<div class="line">                                          coarsen_threshold);</div>
<div class="line">      });</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeNeutronDiffusionProblemruncode"></a> </p><h5><code>NeutronDiffusionProblem::run</code></h5>
<p>Finally, this is the function where the meat is: iterate on a sequence of meshes, and on each of them do a power iteration to compute the eigenvalue.</p>
<p>Given the description of the algorithm in the introduction, there is actually not much to comment on:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">NeutronDiffusionProblem&lt;dim&gt;::run</a>()</div>
<div class="line">{</div>
</div><!-- fragment --><p>We would like to change the output precision for just this function and restore the state of <code>std::cout</code> when this function returns. Hence, we need a way to undo the output format change. Boost provides a convenient way to save the state of an output stream and restore it at the end of the current block (when the destructor of <code>restore_flags</code> is called) with the <code>ios_flags_saver</code> class, which we use here.</p>
<div class="fragment"><div class="line">boost::io::ios_flags_saver restore_flags(std::cout);</div>
<div class="line">std::cout &lt;&lt; std::setprecision(12) &lt;&lt; <a class="code" href="reordering__0_8txt.html#aeae12ef6560114f41bf3f5cccf586727">std::fixed</a>;</div>
</div><!-- fragment --><p>We calculate the error below by the change in k_eff (i.e., the difference between k_eff_old,</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> k_eff_old = 0.0;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> = 0; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_refinement_cycles;</div>
<div class="line">     ++<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>)</div>
<div class="line">  {</div>
</div><!-- fragment --><p>We will measure the CPU time that each cycle takes below. The constructor for <a class="el" href="classTimer.html">Timer</a> calls <a class="el" href="classTimer.html#a3a8b5272198d029779dc9302a54305a8">Timer::start()</a>, so once we create a timer we can query it for information. Since many parts of this loop are parallelized with tasks, the CPU time we measure (if we run with more than one thread) will be larger than the wall time.</p>
<div class="fragment"><div class="line"><a class="code" href="classTimer.html">Timer</a> timer;</div>
<div class="line"> </div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Cycle &quot;</span> &lt;&lt; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> == 0)</div>
<div class="line">  {</div>
<div class="line">    initialize_problem();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">      energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;setup_linear_system();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">    refine_grid();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">      energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a> *= k_eff;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;   Numbers of active cells:       &quot;</span>;</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">  std::cout &lt;&lt; energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>() &lt;&lt; <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line">std::cout &lt;&lt; std::endl;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;   Numbers of degrees of freedom: &quot;</span>;</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">  std::cout &lt;&lt; energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;n_dofs() &lt;&lt; <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line">std::cout &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classThreads_1_1TaskGroup.html">Threads::TaskGroup&lt;&gt;</a> <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a>;</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">  <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a> += <a class="code" href="group__threads.html#ga664740f5d3f738649ac2811f8d656d11">Threads::new_task</a>(</div>
<div class="line">    [&amp;, <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]() { energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;assemble_system_matrix(); });</div>
<div class="line"><a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a>.join_all();</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span>       <a class="code" href="parsed__convergence__table__0_8txt.html#aa2b5a089b26d5eb6842e77a0320440b0">error</a>;</div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="preconditioners__0_8txt.html#abebc9af399f7664771e26564a49c8dc1">iteration</a> = 1;</div>
<div class="line"><span class="keywordflow">do</span></div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">      {</div>
<div class="line">        energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;assemble_ingroup_rhs(</div>
<div class="line">          <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>());</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bgroup = 0; bgroup &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups;</div>
<div class="line">             ++bgroup)</div>
<div class="line">          energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;assemble_cross_group_rhs(</div>
<div class="line">            *energy_groups[bgroup]);</div>
<div class="line"> </div>
<div class="line">        energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;solve();</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    k_eff = get_total_fission_source();</div>
<div class="line">    <a class="code" href="parsed__convergence__table__0_8txt.html#aa2b5a089b26d5eb6842e77a0320440b0">error</a> = <a class="code" href="base_2vectorization_8h.html#aafbdfdd72b6cfe4eae5fa7a16385582f">std::abs</a>(k_eff - k_eff_old) / <a class="code" href="base_2vectorization_8h.html#aafbdfdd72b6cfe4eae5fa7a16385582f">std::abs</a>(k_eff);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> flux_ratio = energy_groups[0]-&gt;solution.linfty_norm() /</div>
<div class="line">                              energy_groups[1]-&gt;solution.linfty_norm();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> max_thermal = energy_groups[1]-&gt;solution.linfty_norm();</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Iter number:&quot;</span> &lt;&lt; std::setw(2) &lt;&lt; <a class="code" href="reordering__0_8txt.html#abc892651c0b2805d80c1933e2fb51c1a">std::right</a></div>
<div class="line">              &lt;&lt; <a class="code" href="preconditioners__0_8txt.html#abebc9af399f7664771e26564a49c8dc1">iteration</a> &lt;&lt; <span class="stringliteral">&quot; k_eff=&quot;</span> &lt;&lt; k_eff</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot; flux_ratio=&quot;</span> &lt;&lt; flux_ratio</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot; max_thermal=&quot;</span> &lt;&lt; max_thermal &lt;&lt; std::endl;</div>
<div class="line">    k_eff_old = k_eff;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">      {</div>
<div class="line">        energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;solution_old =</div>
<div class="line">          energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;solution;</div>
<div class="line">        energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;solution_old /= k_eff;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    ++<a class="code" href="preconditioners__0_8txt.html#abebc9af399f7664771e26564a49c8dc1">iteration</a>;</div>
<div class="line">  }</div>
<div class="line"><span class="keywordflow">while</span> ((<a class="code" href="parsed__convergence__table__0_8txt.html#aa2b5a089b26d5eb6842e77a0320440b0">error</a> &gt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.convergence_tolerance) &amp;&amp; (<a class="code" href="preconditioners__0_8txt.html#abebc9af399f7664771e26564a49c8dc1">iteration</a> &lt; 500));</div>
<div class="line">convergence_table_stream &lt;&lt; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; energy_groups[0]-&gt;n_dofs()</div>
<div class="line">                         &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; energy_groups[1]-&gt;n_dofs() &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">                         &lt;&lt; k_eff &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">                         &lt;&lt; energy_groups[0]-&gt;<a class="code" href="classMultigrid.html#a1f7cde7c4b4637535d07938226012952">solution</a>.linfty_norm() /</div>
<div class="line">                              energy_groups[1]-&gt;solution.linfty_norm()</div>
<div class="line">                         &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">  energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;output_results(<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>);</div>
</div><!-- fragment --><p>Print out information about the simulation as well as the elapsed CPU time. We can call <a class="el" href="classTimer.html#a4e3933a78790d7455daff5acab3f8432">Timer::cpu_time()</a> without first calling <a class="el" href="classTimer.html#a988f79aa183d9d5473c13106f5babe48">Timer::stop()</a> to get the elapsed CPU time at the point of calling the function.</p>
<div class="fragment"><div class="line">        std::cout &lt;&lt; std::endl;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;   Cycle=&quot;</span> &lt;&lt; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt;&lt; <span class="stringliteral">&quot;, n_dofs=&quot;</span></div>
<div class="line">                  &lt;&lt; energy_groups[0]-&gt;n_dofs() + energy_groups[1]-&gt;n_dofs()</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;,  k_eff=&quot;</span> &lt;&lt; k_eff &lt;&lt; <span class="stringliteral">&quot;, time=&quot;</span> &lt;&lt; timer.<a class="code" href="classTimer.html#a4e3933a78790d7455daff5acab3f8432">cpu_time</a>()</div>
<div class="line">                  &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Step28</span></div>
</div><!-- fragment --><p><a class="anchor" id="Thecodemaincodefunction"></a> </p><h3>The <code><a class="el" href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main()</a></code> function</h3>
<p>The last thing in the program in the <code><a class="el" href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main()</a></code> function. The structure is as in most other tutorial programs, with the only exception that we here handle a parameter file. To this end, we first look at the command line arguments passed to this function: if no input file is specified on the command line, then use "project.prm", otherwise take the filename given as the first argument on the command line.</p>
<p>With this, we create a <a class="el" href="classParameterHandler.html">ParameterHandler</a> object, let the <code>NeutronDiffusionProblem::Parameters</code> class declare all the parameters it wants to see in the input file (or, take the default values, if nothing is listed in the parameter file), then read the input file, ask the parameters object to extract the values, and finally hand everything off to an object of type <code>NeutronDiffusionProblem</code> for computation of the eigenvalue:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line">      <span class="keyword">using namespace </span><a class="code" href="namespaceStep28.html">Step28</a>;</div>
<div class="line"> </div>
<div class="line">      std::string filename;</div>
<div class="line">      <span class="keywordflow">if</span> (argc &lt; 2)</div>
<div class="line">        filename = <span class="stringliteral">&quot;project.prm&quot;</span>;</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        filename = argv[1];</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> = 2;</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classParameterHandler.html">ParameterHandler</a> parameter_handler;</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classStep28_1_1NeutronDiffusionProblem_1_1Parameters.html">NeutronDiffusionProblem&lt;dim&gt;::Parameters</a> <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>;</div>
<div class="line">      <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.declare_parameters(parameter_handler);</div>
<div class="line"> </div>
<div class="line">      parameter_handler.<a class="code" href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">parse_input</a>(filename);</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.get_parameters(parameter_handler);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classStep28_1_1NeutronDiffusionProblem.html">NeutronDiffusionProblem&lt;dim&gt;</a> neutron_diffusion_problem(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>);</div>
<div class="line">      neutron_diffusion_problem.run();</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (<a class="code" href="parameter__handler__0_8txt.html#ad919e2b915d8e8226aef004c2d8399a8">std::exception</a> &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p> <a class="anchor" id="Results"></a></p><h1>Results</h1>
<p>We can run the program with the following input file : </p><div class="fragment"><div class="line"><span class="preprocessor"># Listing of Parameters</span></div>
<div class="line"><span class="preprocessor"># ---------------------</span></div>
<div class="line"><span class="preprocessor"># Polynomial degree of the finite element to be used</span></div>
<div class="line"><a class="code" href="A-headers_2exceptions__0_8txt.html#a602682024ec652b990be121b5665f8ce">set</a> Finite <a class="code" href="distributed__0_8txt.html#ac4c845555bda24566ddc584532b7fa57">element</a> <a class="code" href="polynomial__space__0_8txt.html#a03a2f48682e29e39f7bccc11a7d1c4d1">degree</a>     = 2</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># The number of energy different groups considered</span></div>
<div class="line"><a class="code" href="A-headers_2exceptions__0_8txt.html#a602682024ec652b990be121b5665f8ce">set</a> <a class="code" href="namespaceEuler__DG.html#a143bc64b6fa6ced9f11c148a2af3ff09">Number</a> <a class="code" href="multithreading__0_8txt.html#a33468e75b7ea6d2e64b7e88c6ff1217a">of</a> energy groups   = 2</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Inner power iterations are stopped when the change in k_eff falls below this</span></div>
<div class="line"><span class="preprocessor"># tolerance</span></div>
<div class="line"><a class="code" href="A-headers_2exceptions__0_8txt.html#a602682024ec652b990be121b5665f8ce">set</a> Power <a class="code" href="preconditioners__0_8txt.html#abebc9af399f7664771e26564a49c8dc1">iteration</a> <a class="code" href="trilinos__precondition__0_8txt.html#ae2e38e4f182c566122b10d662b9d3f89">tolerance</a> = 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-12</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Number of refinement cycles to be performed</span></div>
<div class="line"><span class="preprocessor">set Refinement cycles         = 12</span></div>
</div><!-- fragment --><p> The output of this program then consists of the console output, a file named &lsquo;convergence_table&rsquo; to record main results of mesh iteration, and the graphical output in vtu format.</p>
<p>The console output looks like this: </p><div class="fragment"><div class="line">Cycle 0:</div>
<div class="line">   Numbers <a class="code" href="multithreading__0_8txt.html#a33468e75b7ea6d2e64b7e88c6ff1217a">of</a> <a class="code" href="dof__tools__0_8txt.html#aa623f15672a6db0f3f730a81a5b432b4">active</a> <a class="code" href="distributed__0_8txt.html#aafea668ad0c451ac7a0fae0f558c36d7">cells</a>:       1156 1156</div>
<div class="line">   Numbers <a class="code" href="multithreading__0_8txt.html#a33468e75b7ea6d2e64b7e88c6ff1217a">of</a> <a class="code" href="fe__q__0_8txt.html#a1a8eaafa20c4d8c9ab128b62a984738c">degrees</a> <a class="code" href="multithreading__0_8txt.html#a33468e75b7ea6d2e64b7e88c6ff1217a">of</a> <a class="code" href="coding__conventions__0_8txt.html#a69730bc7f91dd1be17fd083a66514e73">freedom</a>: 4761 4761</div>
<div class="line"> </div>
<div class="line">Iter <a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>: 1 k_eff=319.375676634310 flux_ratio=6.836246075630 max_thermal=1.433899030144</div>
<div class="line">Iter <a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>: 2 k_eff=0.834072546055 flux_ratio=5.204601882144 max_thermal=0.004630925876</div>
<div class="line">Iter <a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>: 3 k_eff=0.862826188043 flux_ratio=4.645051765984 max_thermal=0.005380396338</div>
<div class="line">...</div>
<div class="line">Iter <a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>:69 k_eff=0.906841960370 flux_ratio=4.384056022578 max_thermal=0.008466414246</div>
<div class="line">Iter <a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>:70 k_eff=0.906841960371 flux_ratio=4.384056022583 max_thermal=0.008466414246</div>
<div class="line"> </div>
<div class="line">   Cycle=0, n_dofs=9522,  k_eff=0.906841960371, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a>=7.623425000000</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Cycle 1:</div>
<div class="line">   Numbers <a class="code" href="multithreading__0_8txt.html#a33468e75b7ea6d2e64b7e88c6ff1217a">of</a> <a class="code" href="dof__tools__0_8txt.html#aa623f15672a6db0f3f730a81a5b432b4">active</a> <a class="code" href="distributed__0_8txt.html#aafea668ad0c451ac7a0fae0f558c36d7">cells</a>:       1156 2380</div>
<div class="line">   Numbers <a class="code" href="multithreading__0_8txt.html#a33468e75b7ea6d2e64b7e88c6ff1217a">of</a> <a class="code" href="fe__q__0_8txt.html#a1a8eaafa20c4d8c9ab128b62a984738c">degrees</a> <a class="code" href="multithreading__0_8txt.html#a33468e75b7ea6d2e64b7e88c6ff1217a">of</a> <a class="code" href="coding__conventions__0_8txt.html#a69730bc7f91dd1be17fd083a66514e73">freedom</a>: 4761 10667</div>
<div class="line"> </div>
<div class="line">Iter <a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>: 1 k_eff=0.906838267472 flux_ratio=4.385474405125 max_thermal=0.008463675976</div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">Cycle 11:</div>
<div class="line">   Numbers <a class="code" href="multithreading__0_8txt.html#a33468e75b7ea6d2e64b7e88c6ff1217a">of</a> <a class="code" href="dof__tools__0_8txt.html#aa623f15672a6db0f3f730a81a5b432b4">active</a> <a class="code" href="distributed__0_8txt.html#aafea668ad0c451ac7a0fae0f558c36d7">cells</a>:       11749 47074</div>
<div class="line">   Numbers <a class="code" href="multithreading__0_8txt.html#a33468e75b7ea6d2e64b7e88c6ff1217a">of</a> <a class="code" href="fe__q__0_8txt.html#a1a8eaafa20c4d8c9ab128b62a984738c">degrees</a> <a class="code" href="multithreading__0_8txt.html#a33468e75b7ea6d2e64b7e88c6ff1217a">of</a> <a class="code" href="coding__conventions__0_8txt.html#a69730bc7f91dd1be17fd083a66514e73">freedom</a>: 50261 204523</div>
<div class="line"> </div>
<div class="line">Iter <a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>: 1 k_eff=0.906798057750 flux_ratio=4.384878772166 max_thermal=0.008464822382</div>
<div class="line">Iter <a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>: 2 k_eff=0.906833008185 flux_ratio=4.384868138638 max_thermal=0.008465057191</div>
<div class="line">...</div>
<div class="line">Iter <a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>:32 k_eff=0.906834736550 flux_ratio=4.384846081793 max_thermal=0.008465019607</div>
<div class="line">Iter <a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>:33 k_eff=0.906834736551 flux_ratio=4.384846081798 max_thermal=0.008465019607</div>
<div class="line"> </div>
<div class="line">   Cycle=11, n_dofs=254784,  k_eff=0.906834736551, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a>=238.593762000000</div>
</div><!-- fragment --><p>We see that power iteration does converge faster after cycle 0 due to the initialization with solution from last mesh iteration. The contents of &lsquo;convergence_table&rsquo; are, </p><div class="fragment"><div class="line">0 4761 4761 0.906841960371 4.38405602258</div>
<div class="line">1 4761 10667 0.906837901031 4.38548908776</div>
<div class="line">2 4761 18805 0.906836075928 4.3854666475</div>
<div class="line">3 6629 27301 0.90683550011 4.38540458087</div>
<div class="line">4 12263 48095 0.906835001796 4.38538179873</div>
<div class="line">5 17501 69297 0.906834858174 4.38485382341</div>
<div class="line">6 19933 78605 0.90683482406 4.38485065879</div>
<div class="line">7 23979 93275 0.906834787555 4.38484837926</div>
<div class="line">8 30285 117017 0.906834761604 4.38484654495</div>
<div class="line">9 40087 154355 0.906834746215 4.38484608319</div>
<div class="line">10 45467 179469 0.906834740155 4.38484600505</div>
<div class="line">11 50261 204523 0.906834736551 4.3848460818</div>
</div><!-- fragment --><p> The meanings of columns are: number of mesh iteration, numbers of degrees of freedom of fast energy group, numbers of DoFs of thermal group, converged k-effective and the ratio between maximum of fast flux and maximum of thermal one.</p>
<p>The grids of fast and thermal energy groups at mesh iteration #9 look as follows:</p>
<p><img src="https://www.dealii.org/images/steps/developer/step-28.grid-0.9.order2.png" alt="" width="400" class="inline"/> &#160; <img src="https://www.dealii.org/images/steps/developer/step-28.grid-1.9.order2.png" alt="" width="400" class="inline"/></p>
<p>We see that the grid of thermal group is much finer than the one of fast group. The solutions on these grids are, (Note: flux are normalized with total fission source equal to 1)</p>
<p><img src="https://www.dealii.org/images/steps/developer/step-28.solution-0.9.order2.png" alt="" width="400" class="inline"/> &#160; <img src="https://www.dealii.org/images/steps/developer/step-28.solution-1.9.order2.png" alt="" width="400" class="inline"/></p>
<p>Then we plot the convergence data with polynomial order being equal to 1,2 and 3.</p>
<p><img src="https://www.dealii.org/images/steps/developer/step-28.convergence.png" alt="" class="inline"/></p>
<p>The estimated &lsquo;exact&rsquo; k-effective = 0.906834721253 which is simply from last mesh iteration of polynomial order 3 minus 2e-10. We see that h-adaptive calculations deliver an algebraic convergence. And the higher polynomial order is, the faster mesh iteration converges. In our problem, we need smaller number of DoFs to achieve same accuracy with higher polynomial order.</p>
<p><a class="anchor" id="PlainProg"></a> </p><h1>The plain program</h1>
<div class="fragment"><div class="line"><span class="comment">/* ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2009 - 2021 by the deal.II authors</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file is part of the deal.II library.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The deal.II library is free software; you can use it, redistribute</span></div>
<div class="line"><span class="comment"> * it, and/or modify it under the terms of the GNU Lesser General</span></div>
<div class="line"><span class="comment"> * Public License as published by the Free Software Foundation; either</span></div>
<div class="line"><span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><span class="comment"> * The full text of the license can be found in the file LICENSE.md at</span></div>
<div class="line"><span class="comment"> * the top level directory of deal.II.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Author: Yaqi Wang, Texas A&amp;M University, 2009, 2010</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2timer_8h.html">deal.II/base/timer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2parameter__handler_8h.html">deal.II/base/parameter_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2thread__management_8h.html">deal.II/base/thread_management.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="include_2deal_8II_2base_2utilities_8h.html">deal.II/base/utilities.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2vector_8h.html">deal.II/lac/vector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2full__matrix_8h.html">deal.II/lac/full_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2sparsity__pattern_8h.html">deal.II/lac/sparsity_pattern.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2sparse__matrix_8h.html">deal.II/lac/sparse_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2solver__cg_8h.html">deal.II/lac/solver_cg.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2precondition_8h.html">deal.II/lac/precondition.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__refinement_8h.html">deal.II/grid/grid_refinement.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__out_8h.html">deal.II/grid/grid_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__values_8h.html">deal.II/fe/fe_values.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2matrix__tools_8h.html">deal.II/numerics/matrix_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2error__estimator_8h.html">deal.II/numerics/error_estimator.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2block__vector_8h.html">deal.II/lac/block_vector.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2solution__transfer_8h.html">deal.II/numerics/solution_transfer.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__tools_8h.html">deal.II/grid/grid_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;boost/io/ios_state.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;list&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceStep28.html">Step28</a></div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">class </span>MaterialData</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    MaterialData(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_groups);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> get_diffusion_coefficient(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) <span class="keyword">const</span>;</div>
<div class="line">    <span class="keywordtype">double</span> get_removal_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) <span class="keyword">const</span>;</div>
<div class="line">    <span class="keywordtype">double</span> get_fission_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) <span class="keyword">const</span>;</div>
<div class="line">    <span class="keywordtype">double</span> get_fission_dist_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_1,</div>
<div class="line">                               <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_2,</div>
<div class="line">                               <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) <span class="keyword">const</span>;</div>
<div class="line">    <span class="keywordtype">double</span> get_scattering_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_1,</div>
<div class="line">                             <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_2,</div>
<div class="line">                             <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) <span class="keyword">const</span>;</div>
<div class="line">    <span class="keywordtype">double</span> get_fission_spectrum(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_groups;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_materials;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;2, double&gt;</a> diffusion;</div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;2, double&gt;</a> sigma_r;</div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;2, double&gt;</a> nu_sigma_f;</div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;3, double&gt;</a> sigma_s;</div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;2, double&gt;</a> chi;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classStep28_1_1MaterialData.html#a3aa25110af7a21c993d9112b19f3670f">MaterialData::MaterialData</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_groups)</div>
<div class="line">    : n_groups(n_groups)</div>
<div class="line">    , n_materials(8)</div>
<div class="line">    , diffusion(n_materials, n_groups)</div>
<div class="line">    , sigma_r(n_materials, n_groups)</div>
<div class="line">    , nu_sigma_f(n_materials, n_groups)</div>
<div class="line">    , sigma_s(n_materials, n_groups, n_groups)</div>
<div class="line">    , chi(n_materials, n_groups)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">switch</span> (this-&gt;n_groups)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">case</span> 2:</div>
<div class="line">          {</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a> = 0; <a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a> &lt; n_materials; ++<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>)</div>
<div class="line">              {</div>
<div class="line">                diffusion[<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>][0] = 1.2;</div>
<div class="line">                diffusion[<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>][1] = 0.4;</div>
<div class="line">                chi[<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>][0]       = 1.0;</div>
<div class="line">                chi[<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>][1]       = 0.0;</div>
<div class="line">                sigma_r[<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>][0]   = 0.03;</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_1 = 0; group_1 &lt; n_groups; ++group_1)</div>
<div class="line">                  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_2 = 0; group_2 &lt; n_groups; ++group_2)</div>
<div class="line">                    sigma_s[<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>][group_1][group_2] = 0.0;</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">            diffusion[5][1] = 0.2;</div>
<div class="line"> </div>
<div class="line">            sigma_r[4][0] = 0.026;</div>
<div class="line">            sigma_r[5][0] = 0.051;</div>
<div class="line">            sigma_r[6][0] = 0.026;</div>
<div class="line">            sigma_r[7][0] = 0.050;</div>
<div class="line"> </div>
<div class="line">            sigma_r[0][1] = 0.100;</div>
<div class="line">            sigma_r[1][1] = 0.200;</div>
<div class="line">            sigma_r[2][1] = 0.250;</div>
<div class="line">            sigma_r[3][1] = 0.300;</div>
<div class="line">            sigma_r[4][1] = 0.020;</div>
<div class="line">            sigma_r[5][1] = 0.040;</div>
<div class="line">            sigma_r[6][1] = 0.020;</div>
<div class="line">            sigma_r[7][1] = 0.800;</div>
<div class="line"> </div>
<div class="line">            nu_sigma_f[0][0] = 0.0050;</div>
<div class="line">            nu_sigma_f[1][0] = 0.0075;</div>
<div class="line">            nu_sigma_f[2][0] = 0.0075;</div>
<div class="line">            nu_sigma_f[3][0] = 0.0075;</div>
<div class="line">            nu_sigma_f[4][0] = 0.000;</div>
<div class="line">            nu_sigma_f[5][0] = 0.000;</div>
<div class="line">            nu_sigma_f[6][0] = 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-7;</div>
<div class="line">            nu_sigma_f[7][0] = 0.00;</div>
<div class="line"> </div>
<div class="line">            nu_sigma_f[0][1] = 0.125;</div>
<div class="line">            nu_sigma_f[1][1] = 0.300;</div>
<div class="line">            nu_sigma_f[2][1] = 0.375;</div>
<div class="line">            nu_sigma_f[3][1] = 0.450;</div>
<div class="line">            nu_sigma_f[4][1] = 0.000;</div>
<div class="line">            nu_sigma_f[5][1] = 0.000;</div>
<div class="line">            nu_sigma_f[6][1] = 3<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-6;</div>
<div class="line">            nu_sigma_f[7][1] = 0.00;</div>
<div class="line"> </div>
<div class="line">            sigma_s[0][0][1] = 0.020;</div>
<div class="line">            sigma_s[1][0][1] = 0.015;</div>
<div class="line">            sigma_s[2][0][1] = 0.015;</div>
<div class="line">            sigma_s[3][0][1] = 0.015;</div>
<div class="line">            sigma_s[4][0][1] = 0.025;</div>
<div class="line">            sigma_s[5][0][1] = 0.050;</div>
<div class="line">            sigma_s[6][0][1] = 0.025;</div>
<div class="line">            sigma_s[7][0][1] = 0.010;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>,</div>
<div class="line">                 <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(</div>
<div class="line">                   <span class="stringliteral">&quot;Presently, only data for 2 groups is implemented&quot;</span>));</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span></div>
<div class="line">  MaterialData::get_diffusion_coefficient(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; n_groups, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, 0, n_groups));</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a> &lt; n_materials,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>, 0, n_materials));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> diffusion[<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>][<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>];</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> MaterialData::get_removal_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; n_groups, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, 0, n_groups));</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a> &lt; n_materials,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>, 0, n_materials));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> sigma_r[<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>][<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>];</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> MaterialData::get_fission_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; n_groups, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, 0, n_groups));</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a> &lt; n_materials,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>, 0, n_materials));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> nu_sigma_f[<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>][<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>];</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> MaterialData::get_scattering_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_1,</div>
<div class="line">                                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_2,</div>
<div class="line">                                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(group_1 &lt; n_groups, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(group_1, 0, n_groups));</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(group_2 &lt; n_groups, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(group_2, 0, n_groups));</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a> &lt; n_materials,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>, 0, n_materials));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> sigma_s[<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>][group_1][group_2];</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span></div>
<div class="line">  MaterialData::get_fission_spectrum(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; n_groups, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, 0, n_groups));</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a> &lt; n_materials,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>, 0, n_materials));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> chi[<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>][<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>];</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> MaterialData::get_fission_dist_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_1,</div>
<div class="line">                                           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_2,</div>
<div class="line">                                           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> (get_fission_spectrum(group_1, <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) *</div>
<div class="line">            get_fission_XS(group_2, <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>));</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span>EnergyGroup</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    EnergyGroup(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                <span class="keyword">const</span> MaterialData &amp;      material_data,</div>
<div class="line">                <span class="keyword">const</span> <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;coarse_grid,</div>
<div class="line">                <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> setup_linear_system();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>() <span class="keyword">const</span>;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_dofs() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> assemble_system_matrix();</div>
<div class="line">    <span class="keywordtype">void</span> assemble_ingroup_rhs(<span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;extraneous_source);</div>
<div class="line">    <span class="keywordtype">void</span> assemble_cross_group_rhs(<span class="keyword">const</span> EnergyGroup&lt;dim&gt; &amp;g_prime);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> get_fission_source() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> estimate_errors(<a class="code" href="classVector.html">Vector&lt;float&gt;</a> &amp;error_indicators) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> refine_grid(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;float&gt;</a> &amp;error_indicators,</div>
<div class="line">                     <span class="keyword">const</span> <span class="keywordtype">double</span>         refine_threshold,</div>
<div class="line">                     <span class="keyword">const</span> <span class="keywordtype">double</span>         coarsen_threshold);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>;</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> solution_old;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>;</div>
<div class="line">    <span class="keyword">const</span> MaterialData &amp;material_data;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a>        <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>;</div>
<div class="line">    <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>           dof_handler;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSparsityPattern.html">SparsityPattern</a>      <a class="code" href="trilinos__sparse__matrix__0_8txt.html#ab4e34663c28496ee1b07f40fd5d00fa1">sparsity_pattern</a>;</div>
<div class="line">    <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> system_matrix;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> system_rhs;</div>
<div class="line"> </div>
<div class="line">    std::map&lt;types::global_dof_index, double&gt; boundary_values;</div>
<div class="line">    <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a>                 hanging_node_constraints;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">void</span> assemble_cross_group_rhs_recursive(</div>
<div class="line">      <span class="keyword">const</span> EnergyGroup&lt;dim&gt; &amp;                       g_prime,</div>
<div class="line">      <span class="keyword">const</span> <span class="keyword">typename</span> DoFHandler&lt;dim&gt;::cell_iterator &amp;cell_g,</div>
<div class="line">      <span class="keyword">const</span> <span class="keyword">typename</span> DoFHandler&lt;dim&gt;::cell_iterator &amp;cell_g_prime,</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> &amp;                     prolongation_matrix);</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  EnergyGroup&lt;dim&gt;::EnergyGroup(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                <span class="keyword">const</span> MaterialData &amp;      material_data,</div>
<div class="line">                                <span class="keyword">const</span> <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;coarse_grid,</div>
<div class="line">                                <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>)</div>
<div class="line">    : <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">    , material_data(material_data)</div>
<div class="line">    , <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>)</div>
<div class="line">    , dof_handler(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.copy_triangulation(coarse_grid);</div>
<div class="line">    dof_handler.distribute_dofs(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">EnergyGroup&lt;dim&gt;::n_active_cells</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> EnergyGroup&lt;dim&gt;::n_dofs()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> dof_handler.n_dofs();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> EnergyGroup&lt;dim&gt;::setup_linear_system()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_dofs = dof_handler.n_dofs();</div>
<div class="line"> </div>
<div class="line">    hanging_node_constraints.clear();</div>
<div class="line">    <a class="code" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a>(dof_handler,</div>
<div class="line">                                            hanging_node_constraints);</div>
<div class="line">    hanging_node_constraints.close();</div>
<div class="line"> </div>
<div class="line">    system_matrix.clear();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(n_dofs, n_dofs);</div>
<div class="line">    <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler, dsp);</div>
<div class="line">    hanging_node_constraints.condense(dsp);</div>
<div class="line">    <a class="code" href="trilinos__sparse__matrix__0_8txt.html#ab4e34663c28496ee1b07f40fd5d00fa1">sparsity_pattern</a>.copy_from(dsp);</div>
<div class="line"> </div>
<div class="line">    system_matrix.reinit(<a class="code" href="trilinos__sparse__matrix__0_8txt.html#ab4e34663c28496ee1b07f40fd5d00fa1">sparsity_pattern</a>);</div>
<div class="line"> </div>
<div class="line">    system_rhs.reinit(n_dofs);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.size() == 0)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.reinit(n_dofs);</div>
<div class="line">        solution_old.reinit(n_dofs);</div>
<div class="line">        solution_old = 1.0;</div>
<div class="line">        <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>     = solution_old;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    boundary_values.clear();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">      <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(dof_handler,</div>
<div class="line">                                               2 * <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> + 1,</div>
<div class="line">                                               <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(),</div>
<div class="line">                                               boundary_values);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> EnergyGroup&lt;dim&gt;::assemble_system_matrix()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> quadrature_formula(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                            quadrature_formula,</div>
<div class="line">                            <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> |</div>
<div class="line">                              <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> = <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>    = quadrature_formula.size();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a>(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>, <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a>     cell_rhs(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; <a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.active_cell_iterators())</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a> = 0;</div>
<div class="line"> </div>
<div class="line">        fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> diffusion_coefficient =</div>
<div class="line">          material_data.get_diffusion_coefficient(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;material_id());</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> removal_XS =</div>
<div class="line">          material_data.get_removal_XS(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;material_id());</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q_point)</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> = 0; <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>)</div>
<div class="line">              <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>) +=</div>
<div class="line">                ((diffusion_coefficient * fe_values.shape_grad(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) *</div>
<div class="line">                    fe_values.shape_grad(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point) +</div>
<div class="line">                  removal_XS * fe_values.shape_value(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) *</div>
<div class="line">                    fe_values.shape_value(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point)) *</div>
<div class="line">                 fe_values.JxW(q_point));</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;get_dof_indices(<a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> = 0; <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>)</div>
<div class="line">            system_matrix.add(<a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>],</div>
<div class="line">                              <a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>[<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>],</div>
<div class="line">                              <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>));</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    hanging_node_constraints.condense(system_matrix);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span></div>
<div class="line">  EnergyGroup&lt;dim&gt;::assemble_ingroup_rhs(<span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;extraneous_source)</div>
<div class="line">  {</div>
<div class="line">    system_rhs.reinit(dof_handler.n_dofs());</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> quadrature_formula(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> = <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>    = quadrature_formula.size();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                            quadrature_formula,</div>
<div class="line">                            <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> |</div>
<div class="line">                              <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a>      cell_rhs(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">    std::vector&lt;double&gt; extraneous_source_values(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line">    std::vector&lt;double&gt; solution_old_values(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; <a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.active_cell_iterators())</div>
<div class="line">      {</div>
<div class="line">        cell_rhs = 0;</div>
<div class="line"> </div>
<div class="line">        fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> fission_dist_XS =</div>
<div class="line">          material_data.get_fission_dist_XS(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;material_id());</div>
<div class="line"> </div>
<div class="line">        extraneous_source.<a class="code" href="classFunction.html#a562fc1114e95e702e6696721f71528db">value_list</a>(fe_values.get_quadrature_points(),</div>
<div class="line">                                     extraneous_source_values);</div>
<div class="line"> </div>
<div class="line">        fe_values.get_function_values(solution_old, solution_old_values);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;get_dof_indices(<a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q_point)</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">            cell_rhs(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>) +=</div>
<div class="line">              ((extraneous_source_values[q_point] +</div>
<div class="line">                fission_dist_XS * solution_old_values[q_point]) *</div>
<div class="line">               fe_values.shape_value(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) * fe_values.JxW(q_point));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">          system_rhs(<a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) += cell_rhs(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>);</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span></div>
<div class="line">  EnergyGroup&lt;dim&gt;::assemble_cross_group_rhs(<span class="keyword">const</span> EnergyGroup&lt;dim&gt; &amp;g_prime)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> == g_prime.group)</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> std::list&lt;std::pair&lt;typename DoFHandler&lt;dim&gt;::cell_iterator,</div>
<div class="line">                              <span class="keyword">typename</span> DoFHandler&lt;dim&gt;::cell_iterator&gt;&gt;</div>
<div class="line">      cell_list =</div>
<div class="line">        <a class="code" href="namespaceGridTools.html#a32a5016c746ad756046ecff264dfa60d">GridTools::get_finest_common_cells</a>(dof_handler, g_prime.dof_handler);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell_pair : cell_list)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> unit_matrix(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; unit_matrix.m(); ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">          unit_matrix(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>) = 1;</div>
<div class="line">        assemble_cross_group_rhs_recursive(g_prime,</div>
<div class="line">                                           cell_pair.first,</div>
<div class="line">                                           cell_pair.second,</div>
<div class="line">                                           unit_matrix);</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> EnergyGroup&lt;dim&gt;::assemble_cross_group_rhs_recursive(</div>
<div class="line">    <span class="keyword">const</span> EnergyGroup&lt;dim&gt; &amp;                       g_prime,</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">typename</span> DoFHandler&lt;dim&gt;::cell_iterator &amp;cell_g,</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">typename</span> DoFHandler&lt;dim&gt;::cell_iterator &amp;cell_g_prime,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> &amp;                     prolongation_matrix)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (!cell_g-&gt;has_children() &amp;&amp; !cell_g_prime-&gt;has_children())</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>  quadrature_formula(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1);</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a> = quadrature_formula.size();</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                                quadrature_formula,</div>
<div class="line">                                <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (cell_g-&gt;level() &gt; cell_g_prime-&gt;level())</div>
<div class="line">          fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(cell_g);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(cell_g_prime);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> fission_dist_XS =</div>
<div class="line">          material_data.get_fission_dist_XS(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                            g_prime.group,</div>
<div class="line">                                            cell_g_prime-&gt;material_id());</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> scattering_XS =</div>
<div class="line">          material_data.get_scattering_XS(g_prime.group,</div>
<div class="line">                                          <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                          cell_g_prime-&gt;material_id());</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> local_mass_matrix_f(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(),</div>
<div class="line">                                               <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">        <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> local_mass_matrix_g(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(),</div>
<div class="line">                                               <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q_point)</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(); ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> = 0; <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> &lt; <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(); ++<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>)</div>
<div class="line">              {</div>
<div class="line">                local_mass_matrix_f(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>) +=</div>
<div class="line">                  (fission_dist_XS * fe_values.shape_value(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) *</div>
<div class="line">                   fe_values.shape_value(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point) * fe_values.JxW(q_point));</div>
<div class="line">                local_mass_matrix_g(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>) +=</div>
<div class="line">                  (scattering_XS * fe_values.shape_value(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) *</div>
<div class="line">                   fe_values.shape_value(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point) * fe_values.JxW(q_point));</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classVector.html">Vector&lt;double&gt;</a> g_prime_new_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">        <a class="code" href="classVector.html">Vector&lt;double&gt;</a> g_prime_old_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">        cell_g_prime-&gt;get_dof_values(g_prime.solution_old, g_prime_old_values);</div>
<div class="line">        cell_g_prime-&gt;get_dof_values(g_prime.solution, g_prime_new_values);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classVector.html">Vector&lt;double&gt;</a> cell_rhs(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">        <a class="code" href="classVector.html">Vector&lt;double&gt;</a> tmp(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (cell_g-&gt;level() &gt; cell_g_prime-&gt;level())</div>
<div class="line">          {</div>
<div class="line">            prolongation_matrix.<a class="code" href="classFullMatrix.html#a65a409eeef6388d99ac15e2bbe8045f6">vmult</a>(tmp, g_prime_old_values);</div>
<div class="line">            local_mass_matrix_f.vmult(cell_rhs, tmp);</div>
<div class="line"> </div>
<div class="line">            prolongation_matrix.<a class="code" href="classFullMatrix.html#a65a409eeef6388d99ac15e2bbe8045f6">vmult</a>(tmp, g_prime_new_values);</div>
<div class="line">            local_mass_matrix_g.vmult_add(cell_rhs, tmp);</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          {</div>
<div class="line">            local_mass_matrix_f.vmult(tmp, g_prime_old_values);</div>
<div class="line">            prolongation_matrix.<a class="code" href="classFullMatrix.html#a8219d4fa962f1b041a506221a7a15379">Tvmult</a>(cell_rhs, tmp);</div>
<div class="line"> </div>
<div class="line">            local_mass_matrix_g.vmult(tmp, g_prime_new_values);</div>
<div class="line">            prolongation_matrix.<a class="code" href="classFullMatrix.html#abed6fffa5cb201496d751a4427cb59d6">Tvmult_add</a>(cell_rhs, tmp);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        std::vector&lt;types::global_dof_index&gt; <a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>(</div>
<div class="line">          <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">        cell_g-&gt;get_dof_indices(<a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(); ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">          system_rhs(<a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) += cell_rhs(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="geometry__info__0_8txt.html#a07de0b60409c551e987416d5062d2742">child</a> = 0;</div>
<div class="line">           child &lt; GeometryInfo&lt;dim&gt;::max_children_per_cell;</div>
<div class="line">           ++<a class="code" href="geometry__info__0_8txt.html#a07de0b60409c551e987416d5062d2742">child</a>)</div>
<div class="line">        {</div>
<div class="line">          <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> new_matrix(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(),</div>
<div class="line">                                        <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">          <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFE__Q__Base.html#af8c966792cf559b9cdc5e5f91e2c6ed6">get_prolongation_matrix</a>(<a class="code" href="geometry__info__0_8txt.html#a07de0b60409c551e987416d5062d2742">child</a>).<a class="code" href="classFullMatrix.html#a21b873fcd180999ad0d268c3278a71ec">mmult</a>(new_matrix,</div>
<div class="line">                                                  prolongation_matrix);</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">if</span> (cell_g-&gt;has_children())</div>
<div class="line">            assemble_cross_group_rhs_recursive(g_prime,</div>
<div class="line">                                               cell_g-&gt;child(<a class="code" href="geometry__info__0_8txt.html#a07de0b60409c551e987416d5062d2742">child</a>),</div>
<div class="line">                                               cell_g_prime,</div>
<div class="line">                                               new_matrix);</div>
<div class="line">          <span class="keywordflow">else</span></div>
<div class="line">            assemble_cross_group_rhs_recursive(g_prime,</div>
<div class="line">                                               cell_g,</div>
<div class="line">                                               cell_g_prime-&gt;child(<a class="code" href="geometry__info__0_8txt.html#a07de0b60409c551e987416d5062d2742">child</a>),</div>
<div class="line">                                               new_matrix);</div>
<div class="line">        }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">double</span> EnergyGroup&lt;dim&gt;::get_fission_source()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>  quadrature_formula(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a> = quadrature_formula.size();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                            quadrature_formula,</div>
<div class="line">                            <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;double&gt; solution_values(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> fission_source = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.active_cell_iterators())</div>
<div class="line">      {</div>
<div class="line">        fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> fission_XS =</div>
<div class="line">          material_data.get_fission_XS(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;material_id());</div>
<div class="line"> </div>
<div class="line">        fe_values.get_function_values(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, solution_values);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q_point)</div>
<div class="line">          fission_source +=</div>
<div class="line">            (fission_XS * solution_values[q_point] * fe_values.JxW(q_point));</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> fission_source;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">EnergyGroup&lt;dim&gt;::solve</a>()</div>
<div class="line">  {</div>
<div class="line">    hanging_node_constraints.condense(system_rhs);</div>
<div class="line">    <a class="code" href="namespaceMatrixTools.html#a9ad0eb7a8662628534586716748d62fb">MatrixTools::apply_boundary_values</a>(boundary_values,</div>
<div class="line">                                       system_matrix,</div>
<div class="line">                                       <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>,</div>
<div class="line">                                       system_rhs);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSolverControl.html">SolverControl</a>            solver_control(system_matrix.m(),</div>
<div class="line">                                 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-12 * system_rhs.l2_norm());</div>
<div class="line">    <a class="code" href="classSolverCG.html">SolverCG&lt;Vector&lt;double&gt;</a>&gt; cg(solver_control);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classPreconditionSSOR.html">PreconditionSSOR&lt;SparseMatrix&lt;double&gt;</a>&gt; <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>;</div>
<div class="line">    <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>.initialize(system_matrix, 1.2);</div>
<div class="line"> </div>
<div class="line">    cg.solve(system_matrix, <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, system_rhs, <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>);</div>
<div class="line"> </div>
<div class="line">    hanging_node_constraints.distribute(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> EnergyGroup&lt;dim&gt;::estimate_errors(<a class="code" href="classVector.html">Vector&lt;float&gt;</a> &amp;error_indicators)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="classKellyErrorEstimator.html#aa0917e696d4f8ddb983223a68c512357">KellyErrorEstimator&lt;dim&gt;::estimate</a>(</div>
<div class="line">      dof_handler,</div>
<div class="line">      <a class="code" href="classQGauss.html">QGauss&lt;dim - 1&gt;</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1),</div>
<div class="line">      <a class="code" href="mapping__fe__0_8txt.html#a0af9c36aca1d2fa34a8615b4521ad4de">std::map</a>&lt;<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">types::boundary_id</a>, <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> *&gt;(),</div>
<div class="line">      <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>,</div>
<div class="line">      error_indicators);</div>
<div class="line">    error_indicators /= <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.linfty_norm();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> EnergyGroup&lt;dim&gt;::refine_grid(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;float&gt;</a> &amp;error_indicators,</div>
<div class="line">                                     <span class="keyword">const</span> <span class="keywordtype">double</span>         refine_threshold,</div>
<div class="line">                                     <span class="keyword">const</span> <span class="keywordtype">double</span>         coarsen_threshold)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.active_cell_iterators())</div>
<div class="line">      <span class="keywordflow">if</span> (error_indicators(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;active_cell_index()) &gt; refine_threshold)</div>
<div class="line">        <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;set_refine_flag();</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (error_indicators(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;active_cell_index()) &lt; coarsen_threshold)</div>
<div class="line">        <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;set_coarsen_flag();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSolutionTransfer.html">SolutionTransfer&lt;dim&gt;</a> soltrans(dof_handler);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.prepare_coarsening_and_refinement();</div>
<div class="line">    soltrans.prepare_for_coarsening_and_refinement(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.execute_coarsening_and_refinement();</div>
<div class="line">    dof_handler.distribute_dofs(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
<div class="line">    setup_linear_system();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.reinit(dof_handler.n_dofs());</div>
<div class="line">    soltrans.interpolate(solution_old, <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line">    hanging_node_constraints.distribute(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line">    solution_old.reinit(dof_handler.n_dofs());</div>
<div class="line">    solution_old = <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> EnergyGroup&lt;dim&gt;::output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keyword">const</span> std::string filename = std::string(<span class="stringliteral">&quot;solution-&quot;</span>) +</div>
<div class="line">                                 <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, 2) + <span class="stringliteral">&quot;.&quot;</span> +</div>
<div class="line">                                 <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>, 2) + <span class="stringliteral">&quot;.vtu&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line"> </div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">attach_dof_handler</a>(dof_handler);</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, <span class="stringliteral">&quot;solution&quot;</span>);</div>
<div class="line">    data_out.<a class="code" href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">build_patches</a>();</div>
<div class="line"> </div>
<div class="line">    std::ofstream <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>(filename);</div>
<div class="line">    data_out.<a class="code" href="classDataOutInterface.html#a93c780f93105e0daaa76c6c43694b4ae">write_vtu</a>(<a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span><a class="code" href="classStep28_1_1NeutronDiffusionProblem.html">NeutronDiffusionProblem</a></div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">class </span>Parameters</div>
<div class="line">    {</div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">      Parameters();</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">      <span class="keywordtype">void</span>        get_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_groups;</div>
<div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_refinement_cycles;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">double</span> convergence_tolerance;</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classStep28_1_1NeutronDiffusionProblem.html">NeutronDiffusionProblem</a>(<span class="keyword">const</span> Parameters &amp;<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">run</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> initialize_problem();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> refine_grid();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> get_total_fission_source() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> Parameters &amp; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>;</div>
<div class="line">    <span class="keyword">const</span> MaterialData material_data;</div>
<div class="line">    <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a>          <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> k_eff;</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;std::unique_ptr&lt;EnergyGroup&lt;dim&gt;&gt;&gt; energy_groups;</div>
<div class="line"> </div>
<div class="line">    std::ofstream convergence_table_stream;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <a class="code" href="classStep28_1_1NeutronDiffusionProblem.html">NeutronDiffusionProblem&lt;dim&gt;::Parameters::Parameters</a>()</div>
<div class="line">    : n_groups(2)</div>
<div class="line">    , n_refinement_cycles(5)</div>
<div class="line">    , <a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>(2)</div>
<div class="line">    , convergence_tolerance(1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-12)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">NeutronDiffusionProblem&lt;dim&gt;::Parameters::declare_parameters</a>(</div>
<div class="line">    <a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Number of energy groups&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;The number of energy different groups considered&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Refinement cycles&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;5&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Number of refinement cycles to be performed&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Finite element degree&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Polynomial degree of the finite element to be used&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(</div>
<div class="line">      <span class="stringliteral">&quot;Power iteration tolerance&quot;</span>,</div>
<div class="line">      <span class="stringliteral">&quot;1e-12&quot;</span>,</div>
<div class="line">      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">      <span class="stringliteral">&quot;Inner power iterations are stopped when the change in k_eff falls &quot;</span></div>
<div class="line">      <span class="stringliteral">&quot;below this tolerance&quot;</span>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep28_1_1NeutronDiffusionProblem.html">NeutronDiffusionProblem&lt;dim&gt;::Parameters::get_parameters</a>(</div>
<div class="line">    <a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">  {</div>
<div class="line">    n_groups              = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Number of energy groups&quot;</span>);</div>
<div class="line">    n_refinement_cycles   = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Refinement cycles&quot;</span>);</div>
<div class="line">    <a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>             = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Finite element degree&quot;</span>);</div>
<div class="line">    convergence_tolerance = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Power iteration tolerance&quot;</span>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <a class="code" href="classStep28_1_1NeutronDiffusionProblem.html">NeutronDiffusionProblem&lt;dim&gt;::NeutronDiffusionProblem</a>(</div>
<div class="line">    <span class="keyword">const</span> Parameters &amp;<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>)</div>
<div class="line">    : <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>)</div>
<div class="line">    , material_data(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups)</div>
<div class="line">    , <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.<a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>)</div>
<div class="line">    , k_eff(std::numeric_limits&lt;<a class="code" href="hdf5__0_8txt.html#aae153b86de45d3354cd3edd5b992435e">double</a>&gt;::quiet_NaN())</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep28_1_1NeutronDiffusionProblem.html">NeutronDiffusionProblem&lt;dim&gt;::initialize_problem</a>()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rods_per_assembly_x = 17, rods_per_assembly_y = 17;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>       pin_pitch_x = 1.26, pin_pitch_y = 1.26;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>       assembly_height = 200;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> assemblies_x = 2, assemblies_y = 2, assemblies_z = 1;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> bottom_left = <a class="code" href="classPoint.html">Point&lt;dim&gt;</a>();</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> upper_right =</div>
<div class="line">      (<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> == 2 ? <a class="code" href="classPoint.html">Point&lt;dim&gt;</a>(assemblies_x * rods_per_assembly_x * pin_pitch_x,</div>
<div class="line">                             assemblies_y * rods_per_assembly_y * pin_pitch_y) :</div>
<div class="line">                  <a class="code" href="classPoint.html">Point</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;(assemblies_x * rods_per_assembly_x * pin_pitch_x,</div>
<div class="line">                             assemblies_y * rods_per_assembly_y * pin_pitch_y,</div>
<div class="line">                             assemblies_z * assembly_height));</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;unsigned int&gt; <a class="code" href="data__out__base__0_8txt.html#a292e9ce72a5d87dfef124355ac0fdd32">n_subdivisions</a>;</div>
<div class="line">    <a class="code" href="data__out__base__0_8txt.html#a292e9ce72a5d87dfef124355ac0fdd32">n_subdivisions</a>.push_back(assemblies_x * rods_per_assembly_x);</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> &gt;= 2)</div>
<div class="line">      <a class="code" href="data__out__base__0_8txt.html#a292e9ce72a5d87dfef124355ac0fdd32">n_subdivisions</a>.push_back(assemblies_y * rods_per_assembly_y);</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> &gt;= 3)</div>
<div class="line">      <a class="code" href="data__out__base__0_8txt.html#a292e9ce72a5d87dfef124355ac0fdd32">n_subdivisions</a>.push_back(assemblies_z);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> coarse_grid;</div>
<div class="line">    <a class="code" href="namespaceGridGenerator.html#ac76417d7404b75cf53c732f456e6e971">GridGenerator::subdivided_hyper_rectangle</a>(</div>
<div class="line">      coarse_grid, <a class="code" href="data__out__base__0_8txt.html#a292e9ce72a5d87dfef124355ac0fdd32">n_subdivisions</a>, bottom_left, upper_right, <span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_assemblies = 4;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> assembly_materials</div>
<div class="line">      [n_assemblies][rods_per_assembly_x][rods_per_assembly_y] = {</div>
<div class="line">        {{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 5, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 5, 1, 1, 5, 1, 1, 7, 1, 1, 5, 1, 1, 5, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 5, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}},</div>
<div class="line">        {{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 8, 1, 1, 1, 1, 1, 1, 1, 1, 1, 8, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 8, 1, 1, 8, 1, 1, 7, 1, 1, 8, 1, 1, 8, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 8, 1, 1, 1, 1, 1, 1, 1, 1, 1, 8, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}},</div>
<div class="line">        {{2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2},</div>
<div class="line">         {2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2},</div>
<div class="line">         {2, 3, 3, 3, 3, 5, 3, 3, 5, 3, 3, 5, 3, 3, 3, 3, 2},</div>
<div class="line">         {2, 3, 3, 5, 3, 4, 4, 4, 4, 4, 4, 4, 3, 5, 3, 3, 2},</div>
<div class="line">         {2, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 3, 2},</div>
<div class="line">         {2, 3, 5, 4, 4, 5, 4, 4, 5, 4, 4, 5, 4, 4, 5, 3, 2},</div>
<div class="line">         {2, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 2},</div>
<div class="line">         {2, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 2},</div>
<div class="line">         {2, 3, 5, 4, 4, 5, 4, 4, 7, 4, 4, 5, 4, 4, 5, 3, 2},</div>
<div class="line">         {2, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 2},</div>
<div class="line">         {2, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 2},</div>
<div class="line">         {2, 3, 5, 4, 4, 5, 4, 4, 5, 4, 4, 5, 4, 4, 5, 3, 2},</div>
<div class="line">         {2, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 3, 2},</div>
<div class="line">         {2, 3, 3, 5, 3, 4, 4, 4, 4, 4, 4, 4, 3, 5, 3, 3, 2},</div>
<div class="line">         {2, 3, 3, 3, 3, 5, 3, 3, 5, 3, 3, 5, 3, 3, 3, 3, 2},</div>
<div class="line">         {2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2},</div>
<div class="line">         {2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2}},</div>
<div class="line">        {{6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6}}};</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> core[assemblies_x][assemblies_y][assemblies_z] = {</div>
<div class="line">      {{0}, {2}}, {{2}, {0}}};</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : coarse_grid.<a class="code" href="group__CPP11.html#ga4288670ae5bd80367e24918d542cb2d8">active_cell_iterators</a>())</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> cell_center = <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;center();</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tmp_x = <a class="code" href="table__handler__0_8txt.html#aa02519610f643695a6a4f66c4062392a">int</a>(cell_center[0] / pin_pitch_x);</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ax    = tmp_x / rods_per_assembly_x;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cx    = tmp_x - ax * rods_per_assembly_x;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span>     tmp_y = <a class="code" href="table__handler__0_8txt.html#aa02519610f643695a6a4f66c4062392a">int</a>(cell_center[1] / pin_pitch_y);</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ay    = tmp_y / rods_per_assembly_y;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cy    = tmp_y - ay * rods_per_assembly_y;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> az =</div>
<div class="line">          (<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> == 2 ? 0 : <a class="code" href="table__handler__0_8txt.html#aa02519610f643695a6a4f66c4062392a">int</a>(cell_center[<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> - 1] / assembly_height));</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(ax &lt; assemblies_x, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(ay &lt; assemblies_y, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(az &lt; assemblies_z, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(core[ax][ay][az] &lt; n_assemblies, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(cx &lt; rods_per_assembly_x, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(cy &lt; rods_per_assembly_y, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;set_material_id(assembly_materials[core[ax][ay][az]][cx][cy] - 1);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">      energy_groups.emplace_back(std::make_unique&lt;EnergyGroup&lt;dim&gt;&gt;(</div>
<div class="line">        <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, material_data, coarse_grid, <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>));</div>
<div class="line">    convergence_table_stream.open(<span class="stringliteral">&quot;convergence_table&quot;</span>);</div>
<div class="line">    convergence_table_stream.precision(12);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">double</span> <a class="code" href="classStep28_1_1NeutronDiffusionProblem.html">NeutronDiffusionProblem&lt;dim&gt;::get_total_fission_source</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    std::vector&lt;double&gt;  fission_sources(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups);</div>
<div class="line">    <a class="code" href="classThreads_1_1TaskGroup.html">Threads::TaskGroup&lt;&gt;</a> <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a>;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">      <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a> += Threads::new_task&lt;&gt;([&amp;, <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]() {</div>
<div class="line">        fission_sources[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>] = energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;get_fission_source();</div>
<div class="line">      });</div>
<div class="line">    <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a>.join_all();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> std::accumulate(fission_sources.begin(), fission_sources.end(), 0.0);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep28_1_1NeutronDiffusionProblem.html">NeutronDiffusionProblem&lt;dim&gt;::refine_grid</a>()</div>
<div class="line">  {</div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">      <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>] = energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>();</div>
<div class="line"> </div>
<div class="line">    BlockVector&lt;float&gt; group_error_indicators(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>);</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classThreads_1_1TaskGroup.html">Threads::TaskGroup&lt;&gt;</a> <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a>;</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">        <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a> += <a class="code" href="group__threads.html#ga664740f5d3f738649ac2811f8d656d11">Threads::new_task</a>([&amp;, <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]() {</div>
<div class="line">          energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;estimate_errors(</div>
<div class="line">            group_error_indicators.block(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>));</div>
<div class="line">        });</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">float</span> max_error         = group_error_indicators.linfty_norm();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">float</span> refine_threshold  = 0.3 * max_error;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">float</span> coarsen_threshold = 0.01 * max_error;</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classThreads_1_1TaskGroup.html">Threads::TaskGroup&lt;void&gt;</a> <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a>;</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">        <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a> += <a class="code" href="group__threads.html#ga664740f5d3f738649ac2811f8d656d11">Threads::new_task</a>([&amp;, <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]() {</div>
<div class="line">          energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;refine_grid(group_error_indicators.block(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>),</div>
<div class="line">                                            refine_threshold,</div>
<div class="line">                                            coarsen_threshold);</div>
<div class="line">        });</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">NeutronDiffusionProblem&lt;dim&gt;::run</a>()</div>
<div class="line">  {</div>
<div class="line">    boost::io::ios_flags_saver restore_flags(std::cout);</div>
<div class="line">    std::cout &lt;&lt; std::setprecision(12) &lt;&lt; <a class="code" href="reordering__0_8txt.html#aeae12ef6560114f41bf3f5cccf586727">std::fixed</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> k_eff_old = 0.0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> = 0; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_refinement_cycles;</div>
<div class="line">         ++<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classTimer.html">Timer</a> timer;</div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Cycle &quot;</span> &lt;&lt; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> == 0)</div>
<div class="line">          {</div>
<div class="line">            initialize_problem();</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">              energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;setup_linear_system();</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          {</div>
<div class="line">            refine_grid();</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">              energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a> *= k_eff;</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;   Numbers of active cells:       &quot;</span>;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">          std::cout &lt;&lt; energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>() &lt;&lt; <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line">        std::cout &lt;&lt; std::endl;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;   Numbers of degrees of freedom: &quot;</span>;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">          std::cout &lt;&lt; energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;n_dofs() &lt;&lt; <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line">        std::cout &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classThreads_1_1TaskGroup.html">Threads::TaskGroup&lt;&gt;</a> <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a>;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">          <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a> += <a class="code" href="group__threads.html#ga664740f5d3f738649ac2811f8d656d11">Threads::new_task</a>(</div>
<div class="line">            [&amp;, <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]() { energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;assemble_system_matrix(); });</div>
<div class="line">        <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a>.join_all();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">double</span>       <a class="code" href="parsed__convergence__table__0_8txt.html#aa2b5a089b26d5eb6842e77a0320440b0">error</a>;</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="preconditioners__0_8txt.html#abebc9af399f7664771e26564a49c8dc1">iteration</a> = 1;</div>
<div class="line">        <span class="keywordflow">do</span></div>
<div class="line">          {</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">              {</div>
<div class="line">                energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;assemble_ingroup_rhs(</div>
<div class="line">                  <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>());</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bgroup = 0; bgroup &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups;</div>
<div class="line">                     ++bgroup)</div>
<div class="line">                  energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;assemble_cross_group_rhs(</div>
<div class="line">                    *energy_groups[bgroup]);</div>
<div class="line"> </div>
<div class="line">                energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;solve();</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            k_eff = get_total_fission_source();</div>
<div class="line">            <a class="code" href="parsed__convergence__table__0_8txt.html#aa2b5a089b26d5eb6842e77a0320440b0">error</a> = <a class="code" href="base_2vectorization_8h.html#aafbdfdd72b6cfe4eae5fa7a16385582f">std::abs</a>(k_eff - k_eff_old) / <a class="code" href="base_2vectorization_8h.html#aafbdfdd72b6cfe4eae5fa7a16385582f">std::abs</a>(k_eff);</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> flux_ratio = energy_groups[0]-&gt;solution.linfty_norm() /</div>
<div class="line">                                      energy_groups[1]-&gt;solution.linfty_norm();</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> max_thermal = energy_groups[1]-&gt;solution.linfty_norm();</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Iter number:&quot;</span> &lt;&lt; std::setw(2) &lt;&lt; <a class="code" href="reordering__0_8txt.html#abc892651c0b2805d80c1933e2fb51c1a">std::right</a></div>
<div class="line">                      &lt;&lt; <a class="code" href="preconditioners__0_8txt.html#abebc9af399f7664771e26564a49c8dc1">iteration</a> &lt;&lt; <span class="stringliteral">&quot; k_eff=&quot;</span> &lt;&lt; k_eff</div>
<div class="line">                      &lt;&lt; <span class="stringliteral">&quot; flux_ratio=&quot;</span> &lt;&lt; flux_ratio</div>
<div class="line">                      &lt;&lt; <span class="stringliteral">&quot; max_thermal=&quot;</span> &lt;&lt; max_thermal &lt;&lt; std::endl;</div>
<div class="line">            k_eff_old = k_eff;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">              {</div>
<div class="line">                energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;solution_old =</div>
<div class="line">                  energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;solution;</div>
<div class="line">                energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;solution_old /= k_eff;</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            ++<a class="code" href="preconditioners__0_8txt.html#abebc9af399f7664771e26564a49c8dc1">iteration</a>;</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">while</span> ((<a class="code" href="parsed__convergence__table__0_8txt.html#aa2b5a089b26d5eb6842e77a0320440b0">error</a> &gt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.convergence_tolerance) &amp;&amp; (<a class="code" href="preconditioners__0_8txt.html#abebc9af399f7664771e26564a49c8dc1">iteration</a> &lt; 500));</div>
<div class="line">        convergence_table_stream &lt;&lt; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; energy_groups[0]-&gt;n_dofs()</div>
<div class="line">                                 &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; energy_groups[1]-&gt;n_dofs() &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">                                 &lt;&lt; k_eff &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">                                 &lt;&lt; energy_groups[0]-&gt;<a class="code" href="classMultigrid.html#a1f7cde7c4b4637535d07938226012952">solution</a>.linfty_norm() /</div>
<div class="line">                                      energy_groups[1]-&gt;solution.linfty_norm()</div>
<div class="line">                                 &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">          energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;output_results(<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>);</div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; std::endl;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;   Cycle=&quot;</span> &lt;&lt; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt;&lt; <span class="stringliteral">&quot;, n_dofs=&quot;</span></div>
<div class="line">                  &lt;&lt; energy_groups[0]-&gt;n_dofs() + energy_groups[1]-&gt;n_dofs()</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;,  k_eff=&quot;</span> &lt;&lt; k_eff &lt;&lt; <span class="stringliteral">&quot;, time=&quot;</span> &lt;&lt; timer.<a class="code" href="classTimer.html#a4e3933a78790d7455daff5acab3f8432">cpu_time</a>()</div>
<div class="line">                  &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Step28</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line">      <span class="keyword">using namespace </span><a class="code" href="namespaceStep28.html">Step28</a>;</div>
<div class="line"> </div>
<div class="line">      std::string filename;</div>
<div class="line">      <span class="keywordflow">if</span> (argc &lt; 2)</div>
<div class="line">        filename = <span class="stringliteral">&quot;project.prm&quot;</span>;</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        filename = argv[1];</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> = 2;</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classParameterHandler.html">ParameterHandler</a> parameter_handler;</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classStep28_1_1NeutronDiffusionProblem_1_1Parameters.html">NeutronDiffusionProblem&lt;dim&gt;::Parameters</a> <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>;</div>
<div class="line">      <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.declare_parameters(parameter_handler);</div>
<div class="line"> </div>
<div class="line">      parameter_handler.<a class="code" href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">parse_input</a>(filename);</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.get_parameters(parameter_handler);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classStep28_1_1NeutronDiffusionProblem.html">NeutronDiffusionProblem&lt;dim&gt;</a> neutron_diffusion_problem(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>);</div>
<div class="line">      neutron_diffusion_problem.run();</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (<a class="code" href="parameter__handler__0_8txt.html#ad919e2b915d8e8226aef004c2d8399a8">std::exception</a> &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p><br  />
 This tutorial depends on <a class="el" href="step_6.html">step-6</a> .  
<table class="tutorial" width="50%">
<tr><th colspan="2"><b><small>Table of contents</small></b><b><small>Table of contents</small></b></th></tr>
<tr><td width="50%" valign="top">
<ol>
  <li> <a href="#Intro" class=bold>Introduction</a><a href="#Intro" class=bold>Introduction</a>
    <ul>
        <li><a href="#Theeigenvalueproblem">The eigenvalue problem</a><a href="#Theeigenvalueproblem">The eigenvalue problem</a>
        <li><a href="#Meshesandmeshrefinement">Meshes and mesh refinement</a><a href="#Meshesandmeshrefinement">Meshes and mesh refinement</a>
      <ul>
        <li><a href="#Meshrefinement">Mesh refinement</a><a href="#Meshrefinement">Mesh refinement</a>
        <li><a href="#Assemblingtermsondifferentmeshes">Assembling terms on different meshes</a><a href="#Assemblingtermsondifferentmeshes">Assembling terms on different meshes</a>
      </ul>
        <li><a href="#Descriptionofthetestcase">Description of the test case</a><a href="#Descriptionofthetestcase">Description of the test case</a>
        <li><a href="#Whattheprogramdoesandhowitdoesthat">What the program does (and how it does that)</a><a href="#Whattheprogramdoesandhowitdoesthat">What the program does (and how it does that)</a>
    </ul>
  <li> <a href="#CommProg" class=bold>The commented program</a><a href="#CommProg" class=bold>The commented program</a>
    <ul>
        <li><a href="#Includefiles">Include files</a><a href="#Includefiles">Include files</a>
        <li><a href="#Materialdata">Material data</a><a href="#Materialdata">Material data</a>
        <li><a href="#ThecodeEnergyGroupcodeclass">The <code>EnergyGroup</code> class</a><a href="#ThecodeEnergyGroupcodeclass">The <code>EnergyGroup</code> class</a>
      <ul>
      <ul>
        <li><a href="#codeEnergyGroupcodepublicmemberfunctions"><code>EnergyGroup</code> public member functions</a><a href="#codeEnergyGroupcodepublicmemberfunctions"><code>EnergyGroup</code> public member functions</a>
        <li><a href="#codeEnergyGroupcodepublicdatamembers"><code>EnergyGroup</code> public data members</a><a href="#codeEnergyGroupcodepublicdatamembers"><code>EnergyGroup</code> public data members</a>
        <li><a href="#codeEnergyGroupcodeprivatedatamembers"><code>EnergyGroup</code> private data members</a><a href="#codeEnergyGroupcodeprivatedatamembers"><code>EnergyGroup</code> private data members</a>
        <li><a href="#codeEnergyGroupcodeprivatememberfunctions"><code>EnergyGroup</code> private member functions</a><a href="#codeEnergyGroupcodeprivatememberfunctions"><code>EnergyGroup</code> private member functions</a>
      </ul>
        <li><a href="#ImplementationofthecodeEnergyGroupcodeclass">Implementation of the <code>EnergyGroup</code> class</a><a href="#ImplementationofthecodeEnergyGroupcodeclass">Implementation of the <code>EnergyGroup</code> class</a>
      <ul>
        <li><a href="#codeEnergyGroupsetup_linear_systemcode"><code>EnergyGroup::setup_linear_system</code></a><a href="#codeEnergyGroupsetup_linear_systemcode"><code>EnergyGroup::setup_linear_system</code></a>
        <li><a href="#codeEnergyGroupassemble_system_matrixcode"><code>EnergyGroup::assemble_system_matrix</code></a><a href="#codeEnergyGroupassemble_system_matrixcode"><code>EnergyGroup::assemble_system_matrix</code></a>
        <li><a href="#codeEnergyGroupassemble_ingroup_rhscode"><code>EnergyGroup::assemble_ingroup_rhs</code></a><a href="#codeEnergyGroupassemble_ingroup_rhscode"><code>EnergyGroup::assemble_ingroup_rhs</code></a>
        <li><a href="#codeEnergyGroupassemble_cross_group_rhscode"><code>EnergyGroup::assemble_cross_group_rhs</code></a><a href="#codeEnergyGroupassemble_cross_group_rhscode"><code>EnergyGroup::assemble_cross_group_rhs</code></a>
        <li><a href="#codeEnergyGroupassemble_cross_group_rhs_recursivecode"><code>EnergyGroup::assemble_cross_group_rhs_recursive</code></a><a href="#codeEnergyGroupassemble_cross_group_rhs_recursivecode"><code>EnergyGroup::assemble_cross_group_rhs_recursive</code></a>
        <li><a href="#codeEnergyGroupget_fission_sourcecode"><code>EnergyGroup::get_fission_source</code></a><a href="#codeEnergyGroupget_fission_sourcecode"><code>EnergyGroup::get_fission_source</code></a>
        <li><a href="#codeEnergyGroupsolvecode"><code>EnergyGroup::solve</code></a><a href="#codeEnergyGroupsolvecode"><code>EnergyGroup::solve</code></a>
        <li><a href="#codeEnergyGroupestimate_errorscode"><code>EnergyGroup::estimate_errors</code></a><a href="#codeEnergyGroupestimate_errorscode"><code>EnergyGroup::estimate_errors</code></a>
        <li><a href="#codeEnergyGrouprefine_gridcode"><code>EnergyGroup::refine_grid</code></a><a href="#codeEnergyGrouprefine_gridcode"><code>EnergyGroup::refine_grid</code></a>
        <li><a href="#codeEnergyGroupoutput_resultscode"><code>EnergyGroup::output_results</code></a><a href="#codeEnergyGroupoutput_resultscode"><code>EnergyGroup::output_results</code></a>
      </ul>
      </ul>
        <li><a href="#ThecodeNeutronDiffusionProblemcodeclasstemplate">The <code>NeutronDiffusionProblem</code> class template</a><a href="#ThecodeNeutronDiffusionProblemcodeclasstemplate">The <code>NeutronDiffusionProblem</code> class template</a>
      <ul>
      <ul>
        <li><a href="#codeNeutronDiffusionProblemcodeprivatememberfunctions"><code>NeutronDiffusionProblem</code> private member functions</a><a href="#codeNeutronDiffusionProblemcodeprivatememberfunctions"><code>NeutronDiffusionProblem</code> private member functions</a>
        <li><a href="#codeNeutronDiffusionProblemcodeprivatemembervariables"><code>NeutronDiffusionProblem</code> private member variables</a><a href="#codeNeutronDiffusionProblemcodeprivatemembervariables"><code>NeutronDiffusionProblem</code> private member variables</a>
      </ul>
        <li><a href="#ImplementationofthecodeParameterscodeclass">Implementation of the <code>Parameters</code> class</a><a href="#ImplementationofthecodeParameterscodeclass">Implementation of the <code>Parameters</code> class</a>
        <li><a href="#ImplementationofthecodeNeutronDiffusionProblemcodeclass">Implementation of the <code>NeutronDiffusionProblem</code> class</a><a href="#ImplementationofthecodeNeutronDiffusionProblemcodeclass">Implementation of the <code>NeutronDiffusionProblem</code> class</a>
      <ul>
        <li><a href="#codeNeutronDiffusionProbleminitialize_problemcode"><code>NeutronDiffusionProblem::initialize_problem</code></a><a href="#codeNeutronDiffusionProbleminitialize_problemcode"><code>NeutronDiffusionProblem::initialize_problem</code></a>
        <li><a href="#codeNeutronDiffusionProblemget_total_fission_sourcecode"><code>NeutronDiffusionProblem::get_total_fission_source</code></a><a href="#codeNeutronDiffusionProblemget_total_fission_sourcecode"><code>NeutronDiffusionProblem::get_total_fission_source</code></a>
        <li><a href="#codeNeutronDiffusionProblemrefine_gridcode"><code>NeutronDiffusionProblem::refine_grid</code></a><a href="#codeNeutronDiffusionProblemrefine_gridcode"><code>NeutronDiffusionProblem::refine_grid</code></a>
        <li><a href="#codeNeutronDiffusionProblemruncode"><code>NeutronDiffusionProblem::run</code></a><a href="#codeNeutronDiffusionProblemruncode"><code>NeutronDiffusionProblem::run</code></a>
      </ul>
      </ul>
        <li><a href="#Thecodemaincodefunction">The <code>main()</code> function</a><a href="#Thecodemaincodefunction">The <code>main()</code> function</a>
      </ul>
</ol></td><td width="50%" valign="top"><ol>
  <li value="3"> <a href="#Results" class=bold>Results</a><a href="#Results" class=bold>Results</a>
    <ul>
    </ul>
  <li> <a href="#PlainProg" class=bold>The plain program</a><a href="#PlainProg" class=bold>The plain program</a>
</ol> </td> </tr> </table>
 <br  />
 <br  />
 <em>This program was contributed by Yaqi Wang and Wolfgang Bangerth. Results from this program are used and discussed in the publication "Three-dimensional h-adaptivity for the multigroup neutron diffusion
equations" by Yaqi Wang, Wolfgang Bangerth and Jean Ragusa. The paper's full bibliographic details are as follows:</em></p>
<p><em></p><div class="fragment"><div class="line">@Article{WBR09,</div>
<div class="line">  author  = {Yaqi Wang <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#acce0a318676405d57af6ef0f5cbe4ec3">and</a> Wolfgang <a class="code" href="geodynamics__0_8txt.html#a3cea336457392f6beb5acb191c9f4c4b">Bangerth</a> <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#acce0a318676405d57af6ef0f5cbe4ec3">and</a> Jean Ragusa},</div>
<div class="line">  title   = {Three-<a class="code" href="A-headers_2utilities__0_8txt.html#ad2c1ad26b1963cfa351b79adbbf36ef6">dimensional</a> <a class="code" href="auto__derivative__function__0_8txt.html#af5d8dd2d035de856717fb6b5c9438dd5">h</a>-<a class="code" href="refinement__0_8txt.html#a5ec35f5c4745344cf7607638e6cbcb5e">adaptivity</a> <span class="keywordflow">for</span> <a class="code" href="constraints__0_8txt.html#a9132c79972fe954d265b941f34bebed9">the</a> multigroup</div>
<div class="line">             neutron diffusion <a class="code" href="functions__0_8txt.html#a829d3b9f33556b077b89f416303f182c">equations</a>},</div>
<div class="line">  journal = {Progr. Nucl. Energy},</div>
<div class="line">  <a class="code" href="kinsol__0_8txt.html#a2dde6fcf1c80bd5999147ad9c92e81b2">year</a>    = 2009,</div>
<div class="line">  <a class="code" href="base_2bounding__box__0_8txt.html#ac479118cc630e4f4c7d594789b4c6dec">volume</a>  = 51,</div>
<div class="line">  pages   = {543--555}</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line">@Article{WBR09,</div>
<div class="line">  author  = {Yaqi Wang <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#acce0a318676405d57af6ef0f5cbe4ec3">and</a> Wolfgang <a class="code" href="geodynamics__0_8txt.html#a3cea336457392f6beb5acb191c9f4c4b">Bangerth</a> <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#acce0a318676405d57af6ef0f5cbe4ec3">and</a> Jean Ragusa},</div>
<div class="line">  title   = {Three-<a class="code" href="A-headers_2utilities__0_8txt.html#ad2c1ad26b1963cfa351b79adbbf36ef6">dimensional</a> <a class="code" href="auto__derivative__function__0_8txt.html#af5d8dd2d035de856717fb6b5c9438dd5">h</a>-<a class="code" href="refinement__0_8txt.html#a5ec35f5c4745344cf7607638e6cbcb5e">adaptivity</a> <span class="keywordflow">for</span> <a class="code" href="constraints__0_8txt.html#a9132c79972fe954d265b941f34bebed9">the</a> multigroup</div>
<div class="line">             neutron diffusion <a class="code" href="functions__0_8txt.html#a829d3b9f33556b077b89f416303f182c">equations</a>},</div>
<div class="line">  journal = {Progr. Nucl. Energy},</div>
<div class="line">  <a class="code" href="kinsol__0_8txt.html#a2dde6fcf1c80bd5999147ad9c92e81b2">year</a>    = 2009,</div>
<div class="line">  <a class="code" href="base_2bounding__box__0_8txt.html#ac479118cc630e4f4c7d594789b4c6dec">volume</a>  = 51,</div>
<div class="line">  pages   = {543--555}</div>
<div class="line">}</div>
</div><!-- fragment --><p></em></p>
<p><em>The paper is available <a href="https://www.semanticscholar.org/paper/Three-dimensional-h-adaptivity-for-the-multigroup-Wang-Bangerth/900592e8e891d9b888d59a69ec58bf2bbda56b4b" target="_top">here</a><a href="https://www.semanticscholar.org/paper/Three-dimensional-h-adaptivity-for-the-multigroup-Wang-Bangerth/900592e8e891d9b888d59a69ec58bf2bbda56b4b" target="_top">here</a>. </em> <br  />
 <br  />
</p>
<p><a class="anchor" id="Introduction"></a><a class="anchor" id="Intro"></a> </p><h1>Introduction</h1>
<p>In this example, we intend to solve the multigroup diffusion approximation ofthe neutron transport equation. Essentially, the way to view this is as follows: In anuclear reactor, neutrons are speeding around at different energies, getabsorbed or scattered, or start a new fissionevent. If viewed at long enough length scales, the movement of neutrons can beconsidered a diffusion process. A mathematical description of this would group neutrons into energy bins, andconsider the balance equations for the neutron fluxes in each of thesebins, or energy groups. The scattering, absorption, and fission events wouldthen be operators within the diffusion equation describing the neutronfluxes. Assume we have energy groups \(g=1,\ldots,G\) , where by convention weassume that the neutrons with the highest energy are in group 1 and those withthe lowest energy in group \(G\) . Then the neutron flux of each group satisfies thefollowing equations: </p><p class="formulaDsp">
\begin{eqnarray*} \frac 1{v_g}\frac{\partial \phi_g(x,t)}{\partial t} &amp;=&amp; \nabla \cdot(D_g(x) \nabla \phi_g(x,t)) - \Sigma_{r,g}(x)\phi_g(x,t) \\ &amp;&amp; \qquad + \chi_g\sum_{g&#39;=1}^G\nu\Sigma_{f,g&#39;}(x)\phi_{g&#39;}(x,t) + \sum_{g&#39;\ne g}\Sigma_{s,g&#39;\to g}(x)\phi_{g&#39;}(x,t) + s_{\mathrm{ext},g}(x,t) \end{eqnarray*}
</p>
<p> augmented by appropriate boundary conditions. Here, \(v_g\) is the velocity ofneutrons within group \(g\) . In other words, the change intime in flux of neutrons in group \(g\) is governed by the followingprocesses: </p><ul>
<li>
Diffusion \(\nabla \cdot(D_g(x) \nabla \phi_g(x,t))\) . Here, \(D_g\) is the (spatially variable) diffusion coefficient. </li>
<li>
Absorption \(\Sigma_{r,g}(x)\phi_g(x,t)\) (note the negative sign). The coefficient \(\Sigma_{r,g}\) is called the <em>removal cross section</em>. </li>
<li>
Nuclear fission \(\chi_g\sum_{g&#39;=1}^G\nu\Sigma_{f,g&#39;}(x)\phi_{g&#39;}(x,t)\) . The production of neutrons of energy \(g\) is proportional to the flux of neutrons of energy \(g&#39;\) times the probability \(\Sigma_{f,g&#39;}\) that neutrons of energy \(g&#39;\) cause a fission event times the number \(\nu\) of neutrons produced in each fission event times the probability that a neutron produced in this event has energy \(g\) . \(\nu\Sigma_{f,g&#39;}\) is called the <em>fission cross section</em> and \(\chi_g\) the <em>fission spectrum</em>. We will denote the term \(\chi_g\nu\Sigma_{f,g&#39;}\) as the <em>fission distribution cross section</em> in the program. </li>
<li>
Scattering \(\sum_{g&#39;\ne g}\Sigma_{s,g&#39;\to g}(x)\phi_{g&#39;}(x,t)\) of neutrons of energy \(g&#39;\) producing neutrons of energy \(g\) . \(\Sigma_{s,g&#39;\to g}\) is called the <em>scattering cross section</em>. The case of elastic, in-group scattering \(g&#39;=g\) exists, too, but we subsume this into the removal cross section. The case \(g&#39;&lt;g\) is called down-scattering, since a neutron loses energy in such an event. On the other hand, \(g&#39;&gt;g\) corresponds to up-scattering: a neutron gains energy in a scattering event from the thermal motion of the atoms surrounding it; up-scattering is therefore only an important process for neutrons with kinetic energies that are already on the same order as the thermal kinetic energy (i.e. in the sub \(eV\) range). </li>
<li>
An extraneous source \(s_{\mathrm{ext},g}\) . </li>
</ul>
<p><br  />
 For realistic simulations in reactor analysis, one may want to split thecontinuous spectrum of neutron energies into many energy groups, often up to 100.However, if neutron energy spectra are known well enough for some type ofreactor (for example Pressurized Water Reactors, PWR), it is possible to obtainsatisfactory results with only 2 energy groups. In the program shown in this tutorial program, we provide the structure tocompute with as many energy groups as desired. However, to keep computingtimes moderate and in order to avoid tabulating hundreds of coefficients, weonly provide the coefficients for above equations for a two-group simulation,i.e. \(g=1,2\) . We do, however, consider a realistic situation by assuming thatthe coefficients are not constant, but rather depend on the materials that areassembled into reactor fuel assemblies in rather complicated ways (seebelow).</p>
<p><a class="anchor" id="Theeigenvalueproblem"></a></p><h3>The eigenvalue problem</h3>
<p>If we consider all energy groups at once, we may write above equations in thefollowing operator form: </p><p class="formulaDsp">
\begin{eqnarray*} \frac 1v \frac{\partial \phi}{\partial t} = -L\phi + F\phi + X\phi + s_{\mathrm{ext}}, \end{eqnarray*}
</p>
<p> where \(L,F,X\) are sinking, fission, and scattering operators,respectively. \(L\) here includes both the diffusion and removal terms. Notethat \(L\) is symmetric, whereas \(F\) and \(X\) are not. It is well known that this equation admits a stable solution if alleigenvalues of the operator \(-L+F+X\) are negative. This can be readily seen bymultiplying the equation by \(\phi\) and integrating over the domain, leading to </p><p class="formulaDsp">
\begin{eqnarray*} \frac 1{2v} \frac{\partial}{\partial t} \|\phi\|^2 = ((-L+F+X)\phi,\phi). \end{eqnarray*}
</p>
<p> Stability means that the solution does not grow, i.e. we want the left handside to be less than zero, which is the case if the eigenvalues of theoperator on the right are all negative. For obvious reasons, it isnot very desirable if a nuclear reactor produces neutron fluxes that growexponentially, so eigenvalue analyses are the bread-and-butter of nuclearengineers. The main point of the program is therefore to consider theeigenvalue problem </p><p class="formulaDsp">
\begin{eqnarray*} (L-F-X) \phi = \lambda \phi, \end{eqnarray*}
</p>
<p> where we want to make sure that all eigenvalues are positive. Note that \(L\) ,being the diffusion operator plus the absorption (removal), is positivedefinite; the condition that all eigenvalues are positive therefore means thatwe want to make sure that fission and inter-group scattering are weak enoughto not shift the spectrum into the negative. In nuclear engineering, one typically looks at a slightly differentformulation of the eigenvalue problem. To this end, we do not just multiplywith \(\phi\) and integrate, but rather multiply with \(\phi(L-X)^{-1}\) . We thenget the following evolution equation: </p><p class="formulaDsp">
\begin{eqnarray*} \frac 1{2v} \frac{\partial}{\partial t} \|\phi\|^2_{(L-X)^{-1}} = ((L-X)^{-1}(-L+F+X)\phi,\phi). \end{eqnarray*}
</p>
<p> Stability is then guaranteed if the eigenvalues of the following problem areall negative: </p><p class="formulaDsp">
\begin{eqnarray*} (L-X)^{-1}(-L+F+X)\phi = \lambda_F \phi, \end{eqnarray*}
</p>
<p> which is equivalent to the eigenvalue problem </p><p class="formulaDsp">
\begin{eqnarray*} (L-X)\phi = \frac 1{\lambda_F+1} F \phi. \end{eqnarray*}
</p>
<p> The typical formulation in nuclear engineering is to write this as </p><p class="formulaDsp">
\begin{eqnarray*} (L-X) \phi = \frac 1{k_{\mathrm{eff}}} F \phi, \end{eqnarray*}
</p>
<p> where \(k_{\mathrm{eff}}=\frac 1{\lambda^F+1}\) .Intuitively, \(k_{\mathrm{eff}}\) is something like the multiplicationfactor for neutrons per typical time scale and should be less than or equal toone for stable operation of a reactor: if it is less than one, the chain reaction willdie down, whereas nuclear bombs for example have a \(k\) -eigenvalue larger thanone. A stable reactor should have \(k_{\mathrm{eff}}=1\) . For those who wonder how this can be achieved in practice withoutinadvertently getting slightly larger than one and triggering a nuclear bomb:first, fission processes happen on different time scales. While most neutronsare released very quickly after a fission event, a small number of neutronsare only released by daughter nuclei after several further decays, up to 10-60seconds after the fission was initiated. If one is therefore slightly beyond \(k_{\mathrm{eff}}=1\) , one therefore has many seconds to react until all theneutrons created in fission re-enter the fission cycle. Nevertheless, controlrods in nuclear reactors absorbing neutrons</p>
<ul>
<li>and therefore reducing \(k_{\mathrm{eff}}\) <br  />
</li>
<li>are designed in such a way that they are all the way inthe reactor in at most 2 seconds. One therefore has on the order of 10-60 seconds to regulate the nuclear reactionif \(k_{\mathrm{eff}}\) should be larger than one for some time, as indicated bya growing neutron flux. Regulation can be achieved by continuously monitoringthe neutron flux, and if necessary increase or reduce neutron flux by movingneutron-absorbing control rods a few millimeters into or out of thereactor. On a longer scale, the water cooling the reactor contains boron, agood neutron absorber. Every few hours, boron concentrations are adjusted byadding boron or diluting the coolant. Finally, some of the absorption and scattering reactions have somestability built in; for example, higher neutron fluxes result in locallyhigher temperatures, which lowers the density of water and therefore reducesthe number of scatterers that are necessary to moderate neutrons from high tolow energies before they can start fission events themselves. In this tutorial program, we solve above \(k\) -eigenvalue problem for two energygroups, and we are looking for the largest multiplication factor \(k_{\mathrm{eff}}\) , which is proportional to the inverse of the minimumeigenvalue plus one. To solve the eigenvalue problem, we generallyuse a modified version of the <em>inverse power method</em>. The algorithm lookslike this: <ol>
<li>
Initialize \(\phi_g\) and \(k_{\mathrm{eff}}\) with \(\phi_g^{(0)}\) and \(k_{\mathrm{eff}}^{(0)}\) and let \(n=1\) . </li>
<li>
<p class="startli">Define the so-called <em>fission source</em> by </p><p class="formulaDsp">
\begin{eqnarray*} s_f^{(n-1)}(x) = \frac{1}{k_{\mathrm{eff}}^{(n-1)}} \sum_{g&#39;=1}^G\nu\Sigma_{f,g&#39;}(x)\phi_{g&#39;}^{(n-1)}(x). \end{eqnarray*}
</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Solve for all group fluxes \(\phi_g,g=1,\ldots,G\) using </p><p class="formulaDsp">
\begin{eqnarray*} -\nabla \cdot D_g\nabla \phi_g^{(n)} + \Sigma_{r,g}\phi_g^{(n)} = \chi_g s_f^{(n-1)} + \sum_{g&#39;&lt; g} \Sigma_{s,g&#39;\to g} \phi_{g&#39;}^{(n)} + \sum_{g&#39;&gt; g}\Sigma_{s,g&#39;\to g}\phi_{g&#39;}^{(n-1)}. \end{eqnarray*}
</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Update </p><p class="formulaDsp">
\begin{eqnarray*} k_{\mathrm{eff}}^{(n)} = \sum_{g&#39;=1}^G \int_{\Omega}\nu\Sigma_{f,g&#39;}(x) \phi_{g&#39;}^{(n)}(x)dx. \end{eqnarray*}
</p>
<p class="endli"></p>
</li>
<li>
Compare \(k_{\mathrm{eff}}^{(n)}\) with \(k_{\mathrm{eff}}^{(n-1)}\) . If the change greater than a prescribed tolerance then set \(n=n+1\) repeat the iteration starting at step 2, otherwise end the iteration. </li>
</ol>
<br  />
 Note that in this scheme, we do not solve group fluxes exactly in each poweriteration, but rather consider previously compute \(\phi_{g&#39;}^{(n)}\) only fordown-scattering events \(g&#39;&lt;g\) . Up-scattering is only treated by using olditerators \(\phi_{g&#39;}^{(n-1)}\) , in essence assuming that the scatteringoperator is triangular. This is physically motivated since up-scattering doesnot play a too important role in neutron scattering. In addition, practicesshows that the inverse power iteration is stable even using thissimplification. Note also that one can use lots of extrapolation techniques to accelerate thepower iteration laid out above. However, none of these are implemented in thisexample.</li>
</ul>
<p><a class="anchor" id="Meshesandmeshrefinement"></a></p><h3>Meshes and mesh refinement</h3>
<p>One may wonder whether it is appropriate to solve for the solutions of theindividual energy group equations on the same meshes. The question boils downto this: will \(\phi_g\) and \(\phi_{g&#39;}\) have similar smoothness properties? Ifthis is the case, then it is appropriate to use the same mesh for the two; atypical application could be chemical combustion, where typically theconcentrations of all or most chemical species change rapidly within the flamefront. As it turns out, and as will be apparent by looking at thegraphs shown in the results section of this tutorial program, this isn't thecase here, however: since the diffusion coefficient is different for differentenergy groups, fast neutrons (in bins with a small group number \(g\) ) have a verysmooth flux function, whereas slow neutrons (in bins with a large groupnumber) are much more affected by the local material properties and have acorrespondingly rough solution if the coefficient are rough as in the case wecompute here. Consequently, we will want to use different meshes to computeeach energy group. This has two implications that we will have to consider: First, we need tofind a way to refine the meshes individually. Second, assembling the sourceterms for the inverse power iteration, where we have to integrate solution \(\phi_{g&#39;}^{(n)}\) defined on mesh \(g&#39;\) against the shape functions defined onmesh \(g\) , becomes a much more complicated task.</p>
<p><a class="anchor" id="Meshrefinement"></a></p><h4>Mesh refinement</h4>
<p>We use the usual paradigm: solve on a given mesh, then evaluate an errorindicator for each cell of each mesh we have. Because it is so convenient, weagain use the a posteriori error estimator by Kelly, Gago, Zienkiewiczand Babuska which approximates the error per cell by integrating the jump ofthe gradient of the solution along the faces of each cell. Using this, weobtain indicators </p><p class="formulaDsp">
\begin{eqnarray*} \eta_{g,K}, \qquad g=1,2,\ldots,G,\qquad K\in{\cal T}_g, \end{eqnarray*}
</p>
<p> where \({\cal T}_g\) is the triangulation used in the solution of \(\phi_g\) . The question is what to do with this. For one, it is clear thatrefining only those cells with the highest error indicators might lead to badresults. To understand this, it is important to realize that \(\eta_{g,K}\) scales with the second derivative of \(\phi_g\) . In other words, if we have twoenergy groups \(g=1,2\) whose solutions are equally smooth but where one islarger by a factor of 10,000, for example, then only the cells of that meshwill be refined, whereas the mesh for the solution of small magnitude willremain coarse. This is probably not what one wants, since we can consider bothcomponents of the solution equally important. In essence, we would therefore have to scale \(\eta_{g,K}\) by an importancefactor \(z_g\) that says how important it is to resolve \(\phi_g\) to any givenaccuracy. Such important factors can be computed using duality techniques(see, for example, the <a class="el" href="step_14.html">step-14</a> tutorial program, and thereference to the book by Bangerth and Rannacher cited there). We won't gothere, however, and simply assume that all energy groups are equallyimportant, and will therefore normalize the error indicators \(\eta_{g,K}\) forgroup \(g\) by the maximum of the solution \(\phi_g\) . We then refine the cellswhose errors satisfy </p><p class="formulaDsp">
\begin{eqnarray*} \frac{\eta_{g,K}}{\|\phi_g\|_\infty} &gt; \alpha_1 \displaystyle{\max_{\begin{matrix}1\le g\le G \\ K\in {\cal T}_g\end{matrix}} \frac{\eta_{g,K}}{\|\phi_g\|_\infty}} \end{eqnarray*}
</p>
<p> and coarsen the cells where </p><p class="formulaDsp">
\begin{eqnarray*} \frac{\eta_{g,K}}{\|\phi_g\|_\infty} &lt; \alpha_2 \displaystyle{\max_{\begin{matrix}1\le g\le G \\ K\in {\cal T}_g\end{matrix}} \frac{\eta_{g,K}}{\|\phi_g\|_\infty}}. \end{eqnarray*}
</p>
<p> We chose \(\alpha_1=0.3\) and \(\alpha_2=0.01\) in the code. Note that this will,of course, lead to different meshes for the different energy groups. The strategy above essentially means the following: If for energy group \(g\) there are many cells \(K\in {\cal T}_g\) on which the error is large, forexample because the solution is globally very rough, then many cells will beabove the threshold. On the other hand, if there are a few cells with largeand many with small errors, for example because the solution is overall rathersmooth except at a few places, then only the few cells with large errors willbe refined. Consequently, the strategy allows for meshes that track the globalsmoothness properties of the corresponding solutions rather well.</p>
<p><a class="anchor" id="Assemblingtermsondifferentmeshes"></a></p><h4>Assembling terms on different meshes</h4>
<p>As pointed out above, the multigroup refinement strategy results indifferent meshes for the different solutions \(\phi_g\) . So what's the problem?In essence it goes like this: in step 3 of the eigenvalue iteration, we haveform the weak form for the equation to compute \(\phi_g^{(n)}\) as usual bymultiplication with test functions \(\varphi_g^i\) defined on the mesh forenergy group \(g\) ; in the process, we have tocompute the right hand side vector that contains terms of the following form: </p><p class="formulaDsp">
\begin{eqnarray*} F_i = \int_\Omega f(x) \varphi_g^i(x) \phi_{g&#39;}(x) \ dx, \end{eqnarray*}
</p>
<p> where \(f(x)\) is one of the coefficient functions \(\Sigma_{s,g&#39;\to g}\) or \(\nu\chi_g\Sigma_{f,g&#39;}\) used in the right hand sideof eigenvalue equation. The difficulty now is that \(\phi_{g&#39;}\) is defined onthe mesh for energy group \(g&#39;\) , i.e. it can be expanded as \(\phi_{g&#39;}(x)=\sum_j\phi_{g&#39;}^j \varphi_{g&#39;}^j(x)\) , with basis functions \(\varphi_{g&#39;}^j(x)\) defined on mesh \(g&#39;\) . The contribution to the right handside can therefore be written as </p><p class="formulaDsp">
\begin{eqnarray*} F_i = \sum_j \left\{\int_\Omega f(x) \varphi_g^i(x) \varphi_{g&#39;}^j(x) \ dx \right\} \phi_{g&#39;}^j , \end{eqnarray*}
</p>
<p> On the other hand, the test functions \(\varphi_g^i(x)\) are defined on mesh \(g\) . This means that we can't just split the integral \(\Omega\) into integralsover the cells of either mesh \(g\) or \(g&#39;\) , since the respectively other basisfunctions may not be defined on these cells. The solution to this problem lies in the fact that both the meshes for \(g\) and \(g&#39;\) are derived by adaptive refinement from a common coarse mesh. We cantherefore always find a set of cells, which we denote by \({\cal T}_g \cap {\cal T}_{g&#39;}\) , that satisfy the following conditions: </p><ul>
<li>
the union of the cells covers the entire domain, and </li>
<li>
a cell \(K \in {\cal T}_g \cap {\cal T}_{g&#39;}\) is active on at least one of the two meshes. </li>
</ul>
<p>A way to construct this set is to take each cell of coarse mesh and do thefollowing steps: (i) if the cell is active on either \({\cal T}_g\) or \({\cal T}_{g&#39;}\) , then add this cell to the set; (ii) otherwise, i.e. ifthis cell has children on both meshes, then do step (i) for each of thechildren of this cell. In fact, deal.II has a function <a class="el" href="namespaceGridTools.html#a32a5016c746ad756046ecff264dfa60d">GridTools::get_finest_common_cells</a> that computes exactly this setof cells that are active on at least one of two meshes. With this, we can write above integral as follows: </p><p class="formulaDsp">
\begin{eqnarray*} F_i = \sum_{K \in {\cal T}_g \cap {\cal T}_{g&#39;}} \sum_j \left\{\int_K f(x) \varphi_g^i(x) \varphi_{g&#39;}^j(x) \ dx \right\} \phi_{g&#39;}^j. \end{eqnarray*}
</p>
<p> In the code, wecompute the right hand side in the function <code>NeutronDiffusionProblem::assemble_rhs</code> , where (among other things) weloop over the set of common most refined cells, calling the function <code>NeutronDiffusionProblem::assemble_common_cell</code> on each pair ofthese cells. By construction, there are now three cases to be considered: </p><ol>
<li>
The cell \(K\) is active on both meshes, i.e. both the basis functions \(\varphi_g^i\) as well as \(\varphi_{g&#39;}^j\) are defined on \(K\) . </li>
<li>
The cell \(K\) is active on mesh \(g\) , but not \(g&#39;\) , i.e. the \(\varphi_g^i\) are defined on \(K\) , whereas the \(\varphi_{g&#39;}^j\) are defined on children of \(K\) . </li>
<li>
The cell \(K\) is active on mesh \(g&#39;\) , but not \(g\) , with opposite conclusions than in (ii). </li>
</ol>
<p><br  />
 To compute the right hand side above, we then need to have different code forthese three cases, as follows: </p><ol>
<li>
If the cell \(K\) is active on both meshes, then we can directly evaluate the integral. In fact, we don't even have to bother with the basis functions \(\varphi_{g&#39;}\) , since all we need is the values of \(\phi_{g&#39;}\) at the quadrature points. We can do this using the FEValues::get_function_values function. This is done directly in the <code>NeutronDiffusionProblem::assemble_common_cell</code> function. </li>
<li>
If the cell \(K\) is active on mesh \(g\) , but not \(g&#39;\) , then the basis functions \(\varphi_{g&#39;}^j\) are only defined either on the children \(K_c,0\le c&lt;2^{\texttt{dim}}\) , or on children of these children if cell \(K\) is refined more than once on mesh \(g&#39;\) . Let us assume for a second that \(K\) is only once more refined on mesh \(g&#39;\) than on mesh \(g\) . Using the fact that we use embedded finite element spaces where each basis function on one mesh can be written as a linear combination of basis functions on the next refined mesh, we can expand the restriction of \(\phi_g^i\) to child cell \(K_c\) into the basis functions defined on that child cell (i.e. on cells on which the basis functions \(\varphi_{g&#39;}^l\) are defined): <p class="formulaDsp">
\begin{eqnarray*} \phi_g^i|_{K_c} = B_c^{il} \varphi_{g&#39;}^l|_{K_c}. \end{eqnarray*}
</p>
 Here, and in the following, summation over indices appearing twice is implied. The matrix \(B_c\) is the matrix that interpolated data from a cell to its \(c\) -th child. Then we can write the contribution of cell \(K\) to the right hand side component \(F_i\) as <p class="formulaDsp">
\begin{eqnarray*} F_i|_K &amp;=&amp; \left\{ \int_K f(x) \varphi_g^i(x) \varphi_{g&#39;}^j(x) \ dx \right\} \phi_{g&#39;}^j \\ &amp;=&amp; \left\{ \sum_{0\le c&lt;2^{\texttt{dim}}} B_c^{il} \int_{K_c} f(x) \varphi_{g&#39;}^l(x) \varphi_{g&#39;}^j(x) \ dx \right\} \phi_{g&#39;}^j. \end{eqnarray*}
</p>
 In matrix notation, this can be written as <p class="formulaDsp">
\begin{eqnarray*} F_i|_K = \sum_{0\le c&lt;2^{\texttt{dim}}} F_i|_{K_c}, \qquad \qquad F_i|_{K_c} = B_c^{il} M_{K_c}^{lj} \phi_{g&#39;}^j = (B_c M_{K_c})^{ij} \phi_{g&#39;}^j, \end{eqnarray*}
</p>
 where \(M_{K_c}^{lj}=\int_{K_c} f(x) \varphi_{g&#39;}^l(x) \varphi_{g&#39;}^j(x)\) is the weighted mass matrix on child \(c\) of cell \(K\) . The next question is what happens if a child \(K_c\) of \(K\) is not active. Then, we have to apply the process recursively, i.e. we have to interpolate the basis functions \(\varphi_g^i\) onto child \(K_c\) of \(K\) , then onto child \(K_{cc&#39;}\) of that cell, onto child \(K_{cc&#39;c&#39;&#39;}\) of that one, etc, until we find an active cell. We then have to sum up all the contributions from all the children, grandchildren, etc, of cell \(K\) , with contributions of the form <p class="formulaDsp">
\begin{eqnarray*} F_i|_{K_{cc&#39;}} = (B_cB_{c&#39;} M_{K_{cc&#39;}})^{ij} \phi_{g&#39;}^j, \end{eqnarray*}
</p>
 or <p class="formulaDsp">
\begin{eqnarray*} F_i|_{K_{cc&#39;c&#39;&#39;}} = (B_c B_{c&#39;} B_{c&#39;&#39;}M_{K_{cc&#39;c&#39;&#39;}})^{ij} \phi_{g&#39;}^j, \end{eqnarray*}
</p>
 etc. We do this process recursively, i.e. if we sit on cell \(K\) and see that it has children on grid \(g&#39;\) , then we call a function <code>assemble_case_2</code> with an identity matrix; the function will multiply it's argument from the left with the prolongation matrix; if the cell has further children, it will call itself with this new matrix, otherwise it will perform the integration. </li>
<li>
The last case is where \(K\) is active on mesh \(g&#39;\) but not mesh \(g\) . In that case, we have to express basis function \(\varphi_{g&#39;}^j\) in terms of the basis functions defined on the children of cell \(K\) , rather than \(\varphi_g^i\) as before. This of course works in exactly the same way. If the children of \(K\) are active on mesh \(g\) , then leading to the expression <p class="formulaDsp">
\begin{eqnarray*} F_i|_K &amp;=&amp; \left\{ \int_K f(x) \varphi_g^i(x) \varphi_{g&#39;}^j(x) \ dx \right\} \phi_{g&#39;}^j \\ &amp;=&amp; \left\{ \sum_{0\le c&lt;2^{\texttt{dim}}} \int_{K_c} f(x) \varphi_g^i(x) B_c^{jl} \varphi_{g}^l(x) \ dx \right\} \phi_{g&#39;}^j. \end{eqnarray*}
</p>
 In matrix notation, this expression now reads as <p class="formulaDsp">
\begin{eqnarray*} F_i|_K = \sum_{0\le c&lt;2^{\texttt{dim}}} F_i|_{K_c}, \qquad \qquad F_i|_{K_c} = M_{K_c}^{il} B_c^{jl} \phi_{g&#39;}^j = (M_{K_c} B_c^T)^{ij} \phi_{g&#39;}^j, \end{eqnarray*}
</p>
 and correspondingly for cases where cell \(K\) is refined more than once on mesh \(g\) : <p class="formulaDsp">
\begin{eqnarray*} F_i|_{K_{cc&#39;}} = (M_{K_{cc&#39;}} B_{c&#39;}^T B_c^T)^{ij} \phi_{g&#39;}^j, \end{eqnarray*}
</p>
 or <p class="formulaDsp">
\begin{eqnarray*} F_i|_{K_{cc&#39;c&#39;&#39;}} = (M_{K_{cc&#39;c&#39;&#39;}} B_{c&#39;&#39;}^T B_{c&#39;}^T B_c^T)^{ij} \phi_{g&#39;}^j, \end{eqnarray*}
</p>
 etc. In other words, the process works in exactly the same way as before, except that we have to take the transpose of the prolongation matrices and need to multiply it to the mass matrix from the other side. </li>
</ol>
<p><br  />
</p>
<p>The expressions for cases (ii) and (iii) can be understood as repeatedlyinterpolating either the left or right basis functions in the scalar product \((f \varphi_g^i, \varphi_{g&#39;}^j)_K\) onto child cells, and then finallyforming the inner product (the mass matrix) on the final cell. To make thesymmetry in these cases more obvious, we can write them like this: for case(ii), we have </p><p class="formulaDsp">
\begin{eqnarray*} F_i|_{K_{cc&#39;\cdots c^{(k)}}} = [B_c B_{c&#39;} \cdots B_{c^{(k)}} M_{K_{cc&#39;\cdots c^{(k)}}}]^{ij} \phi_{g&#39;}^j, \end{eqnarray*}
</p>
<p> whereas for case (iii) we get </p><p class="formulaDsp">
\begin{eqnarray*} F_i|_{K_{cc&#39;\cdots c^{(k)}}} = [(B_c B_{c&#39;} \cdots B_{c^{(k)}} M_{K_{cc&#39;\cdots c^{(k)}}})^T]^{ij} \phi_{g&#39;}^j, \end{eqnarray*}
</p>
<p><a class="anchor" id="Descriptionofthetestcase"></a></p><h3>Description of the test case</h3>
<p>A nuclear reactor core is composed of different types of assemblies. Anassembly is essentially the smallest unit that can be moved in and out of areactor, and is usually rectangular or square. However, assemblies are notfixed units, as they are assembled from a complex lattice of different fuelrods, control rods, and instrumentation elements that are held in placerelative to each other by spacers that are permanently attached to the rods.To make things more complicated, there are different kinds of assemblies thatare used at the same time in a reactor, where assemblies differ in the typeand arrangement of rods they are made up of. Obviously, the arrangement of assemblies as well as the arrangement of rodsinside them affect the distribution of neutron fluxes in the reactor (a factthat will be obvious by looking at the solution shown below in the resultssections of this program). Fuel rods, for example, differ from each other inthe enrichment of U-235 or Pu-239. Control rods, on the other hand, have zerofission, but nonzero scattering and absorption cross sections. This whole arrangement would make the description or spatially dependentmaterial parameters very complicated. It will not become much simpler, but wewill make one approximation: we merge the volume inhabited by each cylindricalrod and the surrounding water into volumes of quadratic cross section intoso-called &lsquo;pin cells&rsquo; for which homogenized material data are obtained withnuclear database and knowledge of neutron spectrum. The homogenization makesall material data piecewise constant on the solution domain for a reactor withfresh fuel. Spatially dependent material parameters are then looked up for thequadratic assembly in which a point is located, and then for the quadratic pincell within this assembly. In this tutorial program, we simulate a quarter of a reactor consisting of \(4 \times 4\) assemblies. We use symmetry (Neumann) boundary conditions to reducethe problem to one quarter of the domain, and consequently only simulate a \(2\times 2\) set of assemblies. Two of them will be UO \({}_2\) fuel, the othertwo of them MOX fuel. Each of these assemblies consists of \(17\times 17\) rodsof different compositions. In total, we therefore create a \(34\times 34\) lattice of rods. To make things simpler later on, we reflect this fact bycreating a coarse mesh of \(34\times 34\) cells (even though the domain is asquare, for which we would usually use a single cell). In deal.II, each cellhas a <code>material_id</code> which one may use to associated each cell with aparticular number identifying the material from which this cell's volume ismade of; we will use this material ID to identify which of the 8 differentkinds of rods that are used in this testcase make up a particular cell. Notethat upon mesh refinement, the children of a cell inherit the material ID,making it simple to track the material even after mesh refinement. The arrangement of the rods will be clearly visible in the images shown inthe results section. The cross sections for materials and for both energygroups are taken from a OECD/NEA benchmark problem. The detailed configurationand material data is given in the code.</p>
<p><a class="anchor" id="Whattheprogramdoesandhowitdoesthat"></a></p><h3>What the program does (and how it does that)</h3>
<p>As a coarse overview of what exactly the program does, here is the basiclayout: starting on a coarse mesh that is the same for each energy group, wecompute inverse eigenvalue iterations to compute the \(k\) -eigenvalue on a givenset of meshes. We stop these iterations when the change in the eigenvaluedrops below a certain tolerance, and then write out the meshes and solutionsfor each energy group for inspection by a graphics program. Because the meshesfor the solutions are different, we have to generate a separate output filefor each energy group, rather than being able to add all energy groupsolutions into the same file. After this, we evaluate the error indicators as explained in one of the sectionsabove for each of the meshes, and refine and coarsen the cells of each meshindependently. Since the eigenvalue iterations are fairly expensive, we don'twant to start all over on the new mesh; rather, we use the SolutionTransferclass to interpolate the solution on the previous mesh to the next one uponmesh refinement. A simple experiment will convince you that this is a lotcheaper than if we omitted this step. After doing so, we resume our eigenvalueiterations on the next set of meshes. The program is controlled by a parameter file, using the ParameterHandlerclass. We will show aparameter file in the results section of this tutorial. For the moment sufficeit to say that it controls the polynomial degree of the finite elements used,the number of energy groups (even though all that is presently implemented arethe coefficients for a 2-group problem), the tolerance where to stop theinverse eigenvalue iteration, and the number of refinement cycles we will do.</p>
<p><a class="anchor" id="CommProg"></a> </p><h1>The commented program</h1>
<p><a class="anchor" id="Includefiles"></a> </p><h3>Include files</h3>
<p>We start with a bunch of include files that have already been explained in previous tutorial programs. One new one is <code>timer.h</code> : This is the first example program that uses the <a class="el" href="classTimer.html">Timer</a> class. The <a class="el" href="classTimer.html">Timer</a> keeps track of both the elapsed wall clock time (that is, the amount of time that a clock mounted on the wall would measure) and CPU clock time (the amount of time that the current process uses on the CPUs). We will use a <a class="el" href="classTimer.html">Timer</a> below to measure how much CPU time each grid refinement cycle takes.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2timer_8h.html">deal.II/base/timer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2parameter__handler_8h.html">deal.II/base/parameter_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2thread__management_8h.html">deal.II/base/thread_management.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="include_2deal_8II_2base_2utilities_8h.html">deal.II/base/utilities.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2vector_8h.html">deal.II/lac/vector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2full__matrix_8h.html">deal.II/lac/full_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2sparsity__pattern_8h.html">deal.II/lac/sparsity_pattern.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2sparse__matrix_8h.html">deal.II/lac/sparse_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2solver__cg_8h.html">deal.II/lac/solver_cg.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2precondition_8h.html">deal.II/lac/precondition.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__refinement_8h.html">deal.II/grid/grid_refinement.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__out_8h.html">deal.II/grid/grid_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__values_8h.html">deal.II/fe/fe_values.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2matrix__tools_8h.html">deal.II/numerics/matrix_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2error__estimator_8h.html">deal.II/numerics/error_estimator.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
</div><!-- fragment --><p>We use the next include file to access block vectors which provide us a convenient way to manage solution and right hand side vectors of all energy groups:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2block__vector_8h.html">deal.II/lac/block_vector.h</a>&gt;</span></div>
</div><!-- fragment --><p>This include file is for transferring solutions from one mesh to another different mesh. We use it when we are initializing solutions after each mesh iteration:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2solution__transfer_8h.html">deal.II/numerics/solution_transfer.h</a>&gt;</span></div>
</div><!-- fragment --><p>When integrating functions defined on one mesh against shape functions defined on a different mesh, we need a function <code>get_finest_common_cells</code> (as discussed in the introduction) which is defined in the following header file :</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__tools_8h.html">deal.II/grid/grid_tools.h</a>&gt;</span></div>
</div><!-- fragment --><p>We use a little utility class from boost to save the state of an output stream (see the <code>run</code> function below):</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;boost/io/ios_state.hpp&gt;</span></div>
</div><!-- fragment --><p>Here are two more C++ standard headers that we use to define list data types as well as to fine-tune the output we generate:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;list&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iomanip&gt;</span></div>
</div><!-- fragment --><p>The last step is as in all previous programs:</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceStep28.html">Step28</a></div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
</div><!-- fragment --><p><a class="anchor" id="Materialdata"></a> </p><h3>Material data</h3>
<p>First up, we need to define a class that provides material data (including diffusion coefficients, removal cross sections, scattering cross sections, fission cross sections and fission spectra) to the main class. <br  />
 The parameter to the constructor determines for how many energy groups we set up the relevant tables. At present, this program only includes data for 2 energy groups, but a more sophisticated program may be able to initialize the data structures for more groups as well, depending on how many energy groups are selected in the parameter file. <br  />
 For each of the different coefficient types, there is one function that returns the value of this coefficient for a particular energy group (or combination of energy groups, as for the distribution cross section \(\chi_g\nu\Sigma_{f,g&#39;}\) or scattering cross section \(\Sigma_{s,g&#39;\to g}\) ). In addition to the energy group or groups, these coefficients depend on the type of fuel or control rod, as explained in the introduction. The functions therefore take an additional parameter, <code>material_id</code>, that identifies the particular kind of rod. Within this program, we use <code>n_materials=8</code> different kinds of rods. Except for the scattering cross section, each of the coefficients therefore can be represented as an entry in a two-dimensional array of floating point values indexed by the energy group number as well as the material ID. The <a class="el" href="classTable.html">Table</a> class template is the ideal way to store such data. Finally, the scattering coefficient depends on both two energy group indices and therefore needs to be stored in a three-dimensional array, for which we again use the <a class="el" href="classTable.html">Table</a> class, where this time the first template argument (denoting the dimensionality of the array) of course needs to be three:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MaterialData</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  MaterialData(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_groups);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> get_diffusion_coefficient(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) <span class="keyword">const</span>;</div>
<div class="line">  <span class="keywordtype">double</span> get_removal_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) <span class="keyword">const</span>;</div>
<div class="line">  <span class="keywordtype">double</span> get_fission_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) <span class="keyword">const</span>;</div>
<div class="line">  <span class="keywordtype">double</span> get_fission_dist_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_1,</div>
<div class="line">                             <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_2,</div>
<div class="line">                             <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) <span class="keyword">const</span>;</div>
<div class="line">  <span class="keywordtype">double</span> get_scattering_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_1,</div>
<div class="line">                           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_2,</div>
<div class="line">                           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) <span class="keyword">const</span>;</div>
<div class="line">  <span class="keywordtype">double</span> get_fission_spectrum(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_groups;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_materials;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTable.html">Table&lt;2, double&gt;</a> diffusion;</div>
<div class="line">  <a class="code" href="classTable.html">Table&lt;2, double&gt;</a> sigma_r;</div>
<div class="line">  <a class="code" href="classTable.html">Table&lt;2, double&gt;</a> nu_sigma_f;</div>
<div class="line">  <a class="code" href="classTable.html">Table&lt;3, double&gt;</a> sigma_s;</div>
<div class="line">  <a class="code" href="classTable.html">Table&lt;2, double&gt;</a> chi;</div>
<div class="line">};</div>
</div><!-- fragment --><p>The constructor of the class is used to initialize all the material data arrays. It takes the number of energy groups as an argument (an throws an error if that value is not equal to two, since at presently only data for two energy groups is implemented; however, using this, the function remains flexible and extendable into the future). In the member initialization part at the beginning, it also resizes the arrays to their correct sizes. <br  />
 At present, material data is stored for 8 different types of material. This, as well, may easily be extended in the future.</p>
<div class="fragment"><div class="line">MaterialData::MaterialData(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_groups)</div>
<div class="line">  : n_groups(n_groups)</div>
<div class="line">  , n_materials(8)</div>
<div class="line">  , diffusion(n_materials, n_groups)</div>
<div class="line">  , sigma_r(n_materials, n_groups)</div>
<div class="line">  , nu_sigma_f(n_materials, n_groups)</div>
<div class="line">  , sigma_s(n_materials, n_groups, n_groups)</div>
<div class="line">  , chi(n_materials, n_groups)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">switch</span> (this-&gt;n_groups)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">case</span> 2:</div>
<div class="line">        {</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a> = 0; <a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a> &lt; n_materials; ++<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>)</div>
<div class="line">            {</div>
<div class="line">              diffusion[<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>][0] = 1.2;</div>
<div class="line">              diffusion[<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>][1] = 0.4;</div>
<div class="line">              chi[<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>][0]       = 1.0;</div>
<div class="line">              chi[<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>][1]       = 0.0;</div>
<div class="line">              sigma_r[<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>][0]   = 0.03;</div>
<div class="line">              <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_1 = 0; group_1 &lt; n_groups; ++group_1)</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_2 = 0; group_2 &lt; n_groups; ++group_2)</div>
<div class="line">                  sigma_s[<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>][group_1][group_2] = 0.0;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          diffusion[5][1] = 0.2;</div>
<div class="line"> </div>
<div class="line">          sigma_r[4][0] = 0.026;</div>
<div class="line">          sigma_r[5][0] = 0.051;</div>
<div class="line">          sigma_r[6][0] = 0.026;</div>
<div class="line">          sigma_r[7][0] = 0.050;</div>
<div class="line"> </div>
<div class="line">          sigma_r[0][1] = 0.100;</div>
<div class="line">          sigma_r[1][1] = 0.200;</div>
<div class="line">          sigma_r[2][1] = 0.250;</div>
<div class="line">          sigma_r[3][1] = 0.300;</div>
<div class="line">          sigma_r[4][1] = 0.020;</div>
<div class="line">          sigma_r[5][1] = 0.040;</div>
<div class="line">          sigma_r[6][1] = 0.020;</div>
<div class="line">          sigma_r[7][1] = 0.800;</div>
<div class="line"> </div>
<div class="line">          nu_sigma_f[0][0] = 0.0050;</div>
<div class="line">          nu_sigma_f[1][0] = 0.0075;</div>
<div class="line">          nu_sigma_f[2][0] = 0.0075;</div>
<div class="line">          nu_sigma_f[3][0] = 0.0075;</div>
<div class="line">          nu_sigma_f[4][0] = 0.000;</div>
<div class="line">          nu_sigma_f[5][0] = 0.000;</div>
<div class="line">          nu_sigma_f[6][0] = 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-7;</div>
<div class="line">          nu_sigma_f[7][0] = 0.00;</div>
<div class="line"> </div>
<div class="line">          nu_sigma_f[0][1] = 0.125;</div>
<div class="line">          nu_sigma_f[1][1] = 0.300;</div>
<div class="line">          nu_sigma_f[2][1] = 0.375;</div>
<div class="line">          nu_sigma_f[3][1] = 0.450;</div>
<div class="line">          nu_sigma_f[4][1] = 0.000;</div>
<div class="line">          nu_sigma_f[5][1] = 0.000;</div>
<div class="line">          nu_sigma_f[6][1] = 3<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-6;</div>
<div class="line">          nu_sigma_f[7][1] = 0.00;</div>
<div class="line"> </div>
<div class="line">          sigma_s[0][0][1] = 0.020;</div>
<div class="line">          sigma_s[1][0][1] = 0.015;</div>
<div class="line">          sigma_s[2][0][1] = 0.015;</div>
<div class="line">          sigma_s[3][0][1] = 0.015;</div>
<div class="line">          sigma_s[4][0][1] = 0.025;</div>
<div class="line">          sigma_s[5][0][1] = 0.050;</div>
<div class="line">          sigma_s[6][0][1] = 0.025;</div>
<div class="line">          sigma_s[7][0][1] = 0.010;</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">default</span>:</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>,</div>
<div class="line">               <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(</div>
<div class="line">                 <span class="stringliteral">&quot;Presently, only data for 2 groups is implemented&quot;</span>));</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Next are the functions that return the coefficient values for given materials and energy groups. All they do is to make sure that the given arguments are within the allowed ranges, and then look the respective value up in the corresponding tables:</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span></div>
<div class="line">MaterialData::get_diffusion_coefficient(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; n_groups, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, 0, n_groups));</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a> &lt; n_materials,</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>, 0, n_materials));</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> diffusion[<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>][<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>];</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> MaterialData::get_removal_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; n_groups, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, 0, n_groups));</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a> &lt; n_materials,</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>, 0, n_materials));</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> sigma_r[<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>][<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>];</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> MaterialData::get_fission_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; n_groups, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, 0, n_groups));</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a> &lt; n_materials,</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>, 0, n_materials));</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> nu_sigma_f[<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>][<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>];</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> MaterialData::get_scattering_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_1,</div>
<div class="line">                                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_2,</div>
<div class="line">                                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(group_1 &lt; n_groups, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(group_1, 0, n_groups));</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(group_2 &lt; n_groups, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(group_2, 0, n_groups));</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a> &lt; n_materials,</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>, 0, n_materials));</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> sigma_s[<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>][group_1][group_2];</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span></div>
<div class="line">MaterialData::get_fission_spectrum(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; n_groups, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, 0, n_groups));</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a> &lt; n_materials,</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>, 0, n_materials));</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> chi[<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>][<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>];</div>
<div class="line">}</div>
</div><!-- fragment --><p>The function computing the fission distribution cross section is slightly different, since it computes its value as the product of two other coefficients. We don't need to check arguments here, since this already happens when we call the two other functions involved, even though it would probably not hurt either:</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> MaterialData::get_fission_dist_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_1,</div>
<div class="line">                                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_2,</div>
<div class="line">                                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> (get_fission_spectrum(group_1, <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>)</div>
<div class="line">          get_fission_XS(group_2, <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>));</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ThecodeEnergyGroupcodeclass"></a> </p><h3>The <code>EnergyGroup</code> class</h3>
<p>The first interesting class is the one that contains everything that is specific to a single energy group. To group things that belong together into individual objects, we declare a structure that holds the <a class="el" href="classTriangulation.html">Triangulation</a> and <a class="el" href="classDoFHandler.html">DoFHandler</a> objects for the mesh used for a single energy group, and a number of other objects and member functions that we will discuss in the following sections. <br  />
 The main reason for this class is as follows: for both the forward problem (with a specified right hand side) as well as for the eigenvalue problem, one typically solves a sequence of problems for a single energy group each, rather than the fully coupled problem. This becomes understandable once one realizes that the system matrix for a single energy group is symmetric and positive definite (it is simply a diffusion operator), whereas the matrix for the fully coupled problem is generally nonsymmetric and not definite. It is also very large and quite full if more than a few energy groups are involved. <br  />
 Let us first look at the equation to solve in the case of an external right hand side (for the time independent case): </p><p class="formulaDsp">
\begin{eqnarray*} -\nabla \cdot(D_g(x) \nabla \phi_g(x)) + \Sigma_{r,g}(x)\phi_g(x) = \chi_g\sum_{g&#39;=1}^G\nu\Sigma_{f,g&#39;}(x)\phi_{g&#39;}(x) + \sum_{g&#39;\ne g}\Sigma_{s,g&#39;\to g}(x)\phi_{g&#39;}(x) + s_{\mathrm{ext},g}(x) \end{eqnarray*}
</p>
<p>We would typically solve this equation by moving all the terms on the right hand side with \(g&#39;=g\) to the left hand side, and solving for \(\phi_g\) . Of course, we don't know \(\phi_{g&#39;}\) yet, since the equations for those variables include right hand side terms involving \(\phi_g\) . What one typically does in such situations is to iterate: compute </p><p class="formulaDsp">
\begin{eqnarray*} -\nabla \cdot(D_g(x) \nabla \phi^{(n)}_g(x)) &amp;+&amp; \Sigma_{r,g}(x)\phi^{(n)}_g(x) \\ &amp;=&amp; \chi_g\sum_{g&#39;=1}^{g-1}\nu\Sigma_{f,g&#39;}(x)\phi^{(n)}_{g&#39;}(x) + \chi_g\sum_{g&#39;=g}^G\nu\Sigma_{f,g&#39;}(x)\phi^{(n-1)}_{g&#39;}(x) + \sum_{g&#39;\ne g, g&#39;&lt;g}\Sigma_{s,g&#39;\to g}(x)\phi^{(n)}_{g&#39;}(x) + \sum_{g&#39;\ne g, g&#39;&gt;g}\Sigma_{s,g&#39;\to g}(x)\phi^{(n-1)}_{g&#39;}(x) + s_{\mathrm{ext},g}(x) \end{eqnarray*}
</p>
<p>In other words, we solve the equation one by one, using values for \(\phi_{g&#39;}\) from the previous iteration \(n-1\) if \(g&#39;\ge g\) and already computed values for \(\phi_{g&#39;}\) from the present iteration if \(g&#39;&lt;g\) . <br  />
 When computing the eigenvalue, we do a very similar iteration, except that we have no external right hand side and that the solution is scaled after each iteration as explained in the introduction. <br  />
 In either case, these two cases can be treated jointly if all we do is to equip the following class with these abilities: (i) form the left hand side matrix, (ii) form the in-group right hand side contribution, i.e. involving the extraneous source, and (iii) form that contribution to the right hand side that stems from group \(g&#39;\) . This class does exactly these tasks (as well as some book-keeping, such as mesh refinement, setting up matrices and vectors, etc). On the other hand, the class itself has no idea how many energy groups there are, and in particular how they interact, i.e. the decision of how the outer iteration looks (and consequently whether we solve an eigenvalue or a direct problem) is left to the NeutronDiffusionProblem class further down below in this program. <br  />
 So let us go through the class and its interface:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>EnergyGroup</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGroupcodepublicmemberfunctions"></a> </p><h5><code>EnergyGroup</code> public member functions</h5>
<p><br  />
 The class has a good number of public member functions, since its the way it operates is controlled from the outside, and therefore all functions that do something significant need to be called from another class. Let's start off with book-keeping: the class obviously needs to know which energy group it represents, which material data to use, and from what coarse grid to start. The constructor takes this information and initializes the relevant member variables with that (see below). <br  />
 Then we also need functions that set up the linear system, i.e. correctly size the matrix and its sparsity pattern, etc, given a finite element object to use. The <code>setup_linear_system</code> function does that. Finally, for this initial block, there are two functions that return the number of active cells and degrees of freedom used in this object</p>
<ul>
<li>using this, we can make the triangulation and DoF handler member variables private, and do not have to grant external use to it, enhancing encapsulation:</li>
</ul>
<div class="fragment"><div class="line">EnergyGroup(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">            <span class="keyword">const</span> MaterialData &amp;      material_data,</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;coarse_grid,</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup_linear_system();</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>() <span class="keyword">const</span>;</div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_dofs() <span class="keyword">const</span>;</div>
</div><!-- fragment --><p>Then there are functions that assemble the linear system for each iteration and the present energy group. Note that the matrix is independent of the iteration number, so only has to be computed once for each refinement cycle. The situation is a bit more involved for the right hand side that has to be updated in each inverse power iteration, and that is further complicated by the fact that computing it may involve several different meshes as explained in the introduction. To make things more flexible with regard to solving the forward or the eigenvalue problem, we split the computation of the right hand side into a function that assembles the extraneous source and in-group contributions (which we will call with a zero function as source terms for the eigenvalue problem) and one that computes contributions to the right hand side from another energy group:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> assemble_system_matrix();</div>
<div class="line"><span class="keywordtype">void</span> assemble_ingroup_rhs(<span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;extraneous_source);</div>
<div class="line"><span class="keywordtype">void</span> assemble_cross_group_rhs(<span class="keyword">const</span> EnergyGroup&lt;dim&gt; &amp;g_prime);</div>
</div><!-- fragment --><p>Next we need a set of functions that actually compute the solution of a linear system, and do something with it (such as computing the fission source contribution mentioned in the introduction, writing graphical information to an output file, computing error indicators, or actually refining the grid based on these criteria and thresholds for refinement and coarsening). All these functions will later be called from the driver class <code>NeutronDiffusionProblem</code> , or any other class you may want to implement to solve a problem involving the neutron flux equations:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>();</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> get_fission_source() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> estimate_errors(<a class="code" href="classVector.html">Vector&lt;float&gt;</a> &amp;error_indicators) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> refine_grid(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;float&gt;</a> &amp;error_indicators,</div>
<div class="line">                 <span class="keyword">const</span> <span class="keywordtype">double</span>         refine_threshold,</div>
<div class="line">                 <span class="keyword">const</span> <span class="keywordtype">double</span>         coarsen_threshold);</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGroupcodepublicdatamembers"></a> </p><h5><code>EnergyGroup</code> public data members</h5>
<p><br  />
 As is good practice in object oriented programming, we hide most data members by making them private. However, we have to grant the class that drives the process access to the solution vector as well as the solution of the previous iteration, since in the power iteration, the solution vector is scaled in every iteration by the present guess of the eigenvalue we are looking for:</p>
<div class="fragment"><div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>;</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> solution_old;</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGroupcodeprivatedatamembers"></a> </p><h5><code>EnergyGroup</code> private data members</h5>
<p><br  />
 The rest of the data members are private. Compared to all the previous tutorial programs, the only new data members are an integer storing which energy group this object represents, and a reference to the material data object that this object's constructor gets passed from the driver class. Likewise, the constructor gets a reference to the finite element object we are to use. <br  />
 Finally, we have to apply boundary values to the linear system in each iteration, i.e. quite frequently. Rather than interpolating them every time, we interpolate them once on each new mesh and then store them along with all the other data of this class:</p>
<div class="fragment"><div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>;</div>
<div class="line">  <span class="keyword">const</span> MaterialData &amp;material_data;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a>        <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>;</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>;</div>
<div class="line">  <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>           dof_handler;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classSparsityPattern.html">SparsityPattern</a>      <a class="code" href="trilinos__sparse__matrix__0_8txt.html#ab4e34663c28496ee1b07f40fd5d00fa1">sparsity_pattern</a>;</div>
<div class="line">  <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> system_matrix;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> system_rhs;</div>
<div class="line"> </div>
<div class="line">  std::map&lt;types::global_dof_index, double&gt; boundary_values;</div>
<div class="line">  <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a>                 hanging_node_constraints;</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGroupcodeprivatememberfunctions"></a> </p><h5><code>EnergyGroup</code> private member functions</h5>
<p><br  />
 There is one private member function in this class. It recursively walks over cells of two meshes to compute the cross-group right hand side terms. The algorithm for this is explained in the introduction to this program. The arguments to this function are a reference to an object representing the energy group against which we want to integrate a right hand side term, an iterator to a cell of the mesh used for the present energy group, an iterator to a corresponding cell on the other mesh, and the matrix that interpolates the degrees of freedom from the coarser of the two cells to the finer one:</p>
<div class="fragment"><div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keywordtype">void</span> assemble_cross_group_rhs_recursive(</div>
<div class="line">    <span class="keyword">const</span> EnergyGroup&lt;dim&gt; &amp;                       g_prime,</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::cell_iterator</a> &amp;cell_g,</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::cell_iterator</a> &amp;cell_g_prime,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> &amp;                     prolongation_matrix);</div>
<div class="line">};</div>
</div><!-- fragment --><p><a class="anchor" id="ImplementationofthecodeEnergyGroupcodeclass"></a> </p><h4>Implementation of the <code>EnergyGroup</code> class</h4>
<p>The first few functions of this class are mostly self-explanatory. The constructor only sets a few data members and creates a copy of the given triangulation as the base for the triangulation used for this energy group. The next two functions simply return data from private data members, thereby enabling us to make these data members private.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">EnergyGroup&lt;dim&gt;::EnergyGroup(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                              <span class="keyword">const</span> MaterialData &amp;      material_data,</div>
<div class="line">                              <span class="keyword">const</span> <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;coarse_grid,</div>
<div class="line">                              <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>)</div>
<div class="line">  : <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">  , material_data(material_data)</div>
<div class="line">  , <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>)</div>
<div class="line">  , dof_handler(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.copy_triangulation(coarse_grid);</div>
<div class="line">  dof_handler.distribute_dofs(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">EnergyGroup&lt;dim&gt;::n_active_cells</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> EnergyGroup&lt;dim&gt;::n_dofs()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> dof_handler.n_dofs();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGroupsetup_linear_systemcode"></a> </p><h5><code>EnergyGroup::setup_linear_system</code></h5>
<p><br  />
 The first "real" function is the one that sets up the mesh, matrices, etc, on the new mesh or after mesh refinement. We use this function to initialize sparse system matrices, and the right hand side vector. If the solution vector has never been set before (as indicated by a zero size), we also initialize it and set it to a default value. We don't do that if it already has a non-zero size (i.e. this function is called after mesh refinement) since in that case we want to preserve the solution across mesh refinement (something we do in the <code>EnergyGroup::refine_grid</code> function).</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> EnergyGroup&lt;dim&gt;::setup_linear_system()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_dofs = dof_handler.n_dofs();</div>
<div class="line"> </div>
<div class="line">  hanging_node_constraints.clear();</div>
<div class="line">  <a class="code" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a>(dof_handler,</div>
<div class="line">                                          hanging_node_constraints);</div>
<div class="line">  hanging_node_constraints.close();</div>
<div class="line"> </div>
<div class="line">  system_matrix.clear();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(n_dofs, n_dofs);</div>
<div class="line">  <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler, dsp);</div>
<div class="line">  hanging_node_constraints.condense(dsp);</div>
<div class="line">  <a class="code" href="trilinos__sparse__matrix__0_8txt.html#ab4e34663c28496ee1b07f40fd5d00fa1">sparsity_pattern</a>.copy_from(dsp);</div>
<div class="line"> </div>
<div class="line">  system_matrix.reinit(<a class="code" href="trilinos__sparse__matrix__0_8txt.html#ab4e34663c28496ee1b07f40fd5d00fa1">sparsity_pattern</a>);</div>
<div class="line"> </div>
<div class="line">  system_rhs.reinit(n_dofs);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.size() == 0)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.reinit(n_dofs);</div>
<div class="line">      solution_old.reinit(n_dofs);</div>
<div class="line">      solution_old = 1.0;</div>
<div class="line">      <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>     = solution_old;</div>
<div class="line">    }</div>
</div><!-- fragment --><p>At the end of this function, we update the list of boundary nodes and their values, by first clearing this list and the re-interpolating boundary values (remember that this function is called after first setting up the mesh, and each time after mesh refinement). <br  />
 To understand the code, it is necessary to realize that we create the mesh using the <code><a class="el" href="namespaceGridGenerator.html#ac76417d7404b75cf53c732f456e6e971">GridGenerator::subdivided_hyper_rectangle</a></code> function (in <code>NeutronDiffusionProblem::initialize_problem</code> ) where we set the last parameter to <code>true</code> . This means that boundaries of the domain are "colored", i.e. the four (or six, in 3d) sides of the domain are assigned different boundary indicators. As it turns out, the bottom boundary gets indicator zero, the top one boundary indicator one, and left and right boundaries get indicators two and three, respectively. <br  />
 In this program, we simulate only one, namely the top right, quarter of a reactor. That is, we want to interpolate boundary conditions only on the top and right boundaries, while do nothing on the bottom and left boundaries (i.e. impose natural, no-flux Neumann boundary conditions). This is most easily generalized to arbitrary dimension by saying that we want to interpolate on those boundaries with indicators 1, 3, ..., which we do in the following loop (note that calls to <code><a class="el" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a></code> are additive, i.e. they do not first clear the boundary value map):</p>
<div class="fragment"><div class="line">  boundary_values.clear();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(dof_handler,</div>
<div class="line">                                             2 <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> + 1,</div>
<div class="line">                                             <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(),</div>
<div class="line">                                             boundary_values);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGroupassemble_system_matrixcode"></a> </p><h5><code>EnergyGroup::assemble_system_matrix</code></h5>
<p><br  />
 Next we need functions assembling the system matrix and right hand sides. Assembling the matrix is straightforward given the equations outlined in the introduction as well as what we've seen in previous example programs. Note the use of <code>cell-&gt;<a class="el" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id()</a></code> to get at the kind of material from which a cell is made up of. Note also how we set the order of the quadrature formula so that it is always appropriate for the finite element in use. <br  />
 Finally, note that since we only assemble the system matrix here, we can't yet eliminate boundary values (we need the right hand side vector for this). We defer this to the <code>EnergyGroup::solve</code> function, at which point all the information is available.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> EnergyGroup&lt;dim&gt;::assemble_system_matrix()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> quadrature_formula(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                          quadrature_formula,</div>
<div class="line">                          <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> |</div>
<div class="line">                            <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> = <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>();</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>    = quadrature_formula.size();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a>(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>, <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a>     cell_rhs(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; <a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.active_cell_iterators())</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a> = 0;</div>
<div class="line"> </div>
<div class="line">      fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> diffusion_coefficient =</div>
<div class="line">        material_data.get_diffusion_coefficient(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;material_id());</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> removal_XS =</div>
<div class="line">        material_data.get_removal_XS(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;material_id());</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q_point)</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> = 0; <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>)</div>
<div class="line">            <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>) +=</div>
<div class="line">              ((diffusion_coefficient fe_values.shape_grad(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point)</div>
<div class="line">                  fe_values.shape_grad(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point) +</div>
<div class="line">                removal_XS fe_values.shape_value(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point)</div>
<div class="line">                  fe_values.shape_value(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point))</div>
<div class="line">               fe_values.JxW(q_point));</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;get_dof_indices(<a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> = 0; <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>)</div>
<div class="line">          system_matrix.add(<a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>],</div>
<div class="line">                            <a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>[<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>],</div>
<div class="line">                            <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  hanging_node_constraints.condense(system_matrix);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGroupassemble_ingroup_rhscode"></a> </p><h5><code>EnergyGroup::assemble_ingroup_rhs</code></h5>
<p><br  />
 As explained in the documentation of the <code>EnergyGroup</code> class, we split assembling the right hand side into two parts: the ingroup and the cross-group couplings. First, we need a function to assemble the right hand side of one specific group here, i.e. including an extraneous source (that we will set to zero for the eigenvalue problem) as well as the ingroup fission contributions. (In-group scattering has already been accounted for with the definition of removal cross section.) The function's workings are pretty standard as far as assembling right hand sides go, and therefore does not require more comments except that we mention that the right hand side vector is set to zero at the beginning of the function</p>
<ul>
<li>something we are not going to do for the cross-group terms that simply add to the right hand side vector.</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">EnergyGroup&lt;dim&gt;::assemble_ingroup_rhs(<span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;extraneous_source)</div>
<div class="line">{</div>
<div class="line">  system_rhs.reinit(dof_handler.n_dofs());</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> quadrature_formula(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> = <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>();</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>    = quadrature_formula.size();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                          quadrature_formula,</div>
<div class="line">                          <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> |</div>
<div class="line">                            <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a>      cell_rhs(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">  std::vector&lt;double&gt; extraneous_source_values(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line">  std::vector&lt;double&gt; solution_old_values(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; <a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.active_cell_iterators())</div>
<div class="line">    {</div>
<div class="line">      cell_rhs = 0;</div>
<div class="line"> </div>
<div class="line">      fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> fission_dist_XS =</div>
<div class="line">        material_data.get_fission_dist_XS(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;material_id());</div>
<div class="line"> </div>
<div class="line">      extraneous_source.<a class="code" href="classFunction.html#a562fc1114e95e702e6696721f71528db">value_list</a>(fe_values.get_quadrature_points(),</div>
<div class="line">                                   extraneous_source_values);</div>
<div class="line"> </div>
<div class="line">      fe_values.get_function_values(solution_old, solution_old_values);</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;get_dof_indices(<a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q_point)</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">          cell_rhs(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>) +=</div>
<div class="line">            ((extraneous_source_values[q_point] +</div>
<div class="line">              fission_dist_XS solution_old_values[q_point])</div>
<div class="line">             fe_values.shape_value(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) fe_values.JxW(q_point));</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">        system_rhs(<a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) += cell_rhs(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGroupassemble_cross_group_rhscode"></a> </p><h5><code>EnergyGroup::assemble_cross_group_rhs</code></h5>
<p><br  />
 The more interesting function for assembling the right hand side vector for the equation of a single energy group is the one that couples energy group \(g\) and \(g&#39;\) . As explained in the introduction, we first have to find the set of cells common to the meshes of the two energy groups. First we call <code>get_finest_common_cells</code> to obtain this list of pairs of common cells from both meshes. Both cells in a pair may not be active but at least one of them is. We then hand each of these cell pairs off to a function that computes the right hand side terms recursively. <br  />
 Note that ingroup coupling is handled already before, so we exit the function early if \(g=g&#39;\) .</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">EnergyGroup&lt;dim&gt;::assemble_cross_group_rhs(<span class="keyword">const</span> EnergyGroup&lt;dim&gt; &amp;g_prime)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> == g_prime.group)</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> std::list&lt;std::pair&lt;typename DoFHandler&lt;dim&gt;::cell_iterator,</div>
<div class="line">                            <span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::cell_iterator</a>&gt;&gt;</div>
<div class="line">    cell_list =</div>
<div class="line">      <a class="code" href="namespaceGridTools.html#a32a5016c746ad756046ecff264dfa60d">GridTools::get_finest_common_cells</a>(dof_handler, g_prime.dof_handler);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell_pair : cell_list)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> unit_matrix(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; unit_matrix.m(); ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">        unit_matrix(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>) = 1;</div>
<div class="line">      assemble_cross_group_rhs_recursive(g_prime,</div>
<div class="line">                                         cell_pair.first,</div>
<div class="line">                                         cell_pair.second,</div>
<div class="line">                                         unit_matrix);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGroupassemble_cross_group_rhs_recursivecode"></a> </p><h5><code>EnergyGroup::assemble_cross_group_rhs_recursive</code></h5>
<p><br  />
 This is finally the function that handles assembling right hand side terms on potentially different meshes recursively, using the algorithm described in the introduction. The function takes a reference to the object representing energy group \(g&#39;\) , as well as iterators to corresponding cells in the meshes for energy groups \(g\) and \(g&#39;\) . At first, i.e. when this function is called from the one above, these two cells will be matching cells on two meshes; however, one of the two may be further refined, and we will call the function recursively with one of the two iterators replaced by one of the children of the original cell. <br  />
 The last argument is the matrix product matrix \(B_{c^{(k)}}^T \cdots B_{c&#39;}^T B_c^T\) from the introduction that interpolates from the coarser of the two cells to the finer one. If the two cells match, then this is the identity matrix</p>
<ul>
<li>exactly what we pass to this function initially. <br  />
 The function has to consider two cases: that both of the two cells are not further refined, i.e. have no children, in which case we can finally assemble the right hand side contributions of this pair of cells; and that one of the two cells is further refined, in which case we have to keep recursing by looping over the children of the one cell that is not active. These two cases will be discussed below:</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> EnergyGroup&lt;dim&gt;::assemble_cross_group_rhs_recursive(</div>
<div class="line">  <span class="keyword">const</span> EnergyGroup&lt;dim&gt; &amp;                       g_prime,</div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::cell_iterator</a> &amp;cell_g,</div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::cell_iterator</a> &amp;cell_g_prime,</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> &amp;                     prolongation_matrix)</div>
<div class="line">{</div>
</div><!-- fragment --><p>The first case is that both cells are no further refined. In that case, we can assemble the relevant terms (see the introduction). This involves assembling the mass matrix on the finer of the two cells (in fact there are two mass matrices with different coefficients, one for the fission distribution cross section \(\chi_g\nu\Sigma_{f,g&#39;}\) and one for the scattering cross section \(\Sigma_{s,g&#39;\to g}\) ). This is straight forward, but note how we determine which of the two cells is the finer one by looking at the refinement level of the two cells:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (!cell_g-&gt;has_children() &amp;&amp; !cell_g_prime-&gt;has_children())</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>  quadrature_formula(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a> = quadrature_formula.size();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                            quadrature_formula,</div>
<div class="line">                            <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (cell_g-&gt;level() &gt; cell_g_prime-&gt;level())</div>
<div class="line">      fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(cell_g);</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(cell_g_prime);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> fission_dist_XS =</div>
<div class="line">      material_data.get_fission_dist_XS(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                        g_prime.group,</div>
<div class="line">                                        cell_g_prime-&gt;material_id());</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> scattering_XS =</div>
<div class="line">      material_data.get_scattering_XS(g_prime.group,</div>
<div class="line">                                      <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                      cell_g_prime-&gt;material_id());</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> local_mass_matrix_f(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(),</div>
<div class="line">                                           <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> local_mass_matrix_g(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(),</div>
<div class="line">                                           <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q_point)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(); ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> = 0; <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> &lt; <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(); ++<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>)</div>
<div class="line">          {</div>
<div class="line">            local_mass_matrix_f(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>) +=</div>
<div class="line">              (fission_dist_XS fe_values.shape_value(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point)</div>
<div class="line">               fe_values.shape_value(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point) fe_values.JxW(q_point));</div>
<div class="line">            local_mass_matrix_g(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>) +=</div>
<div class="line">              (scattering_XS fe_values.shape_value(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point)</div>
<div class="line">               fe_values.shape_value(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point) fe_values.JxW(q_point));</div>
<div class="line">          }</div>
</div><!-- fragment --><p>Now we have all the interpolation (prolongation) matrices as well as local mass matrices, so we only have to form the product </p><p class="formulaDsp">
\[ F_i|_{K_{cc&#39;\cdots c^{(k)}}} = [B_c B_{c&#39;} \cdots B_{c^{(k)}} M_{K_{cc&#39;\cdots c^{(k)}}}]^{ij} \phi_{g&#39;}^j, \]
</p>
<p> or </p><p class="formulaDsp">
\[ F_i|_{K_{cc&#39;\cdots c^{(k)}}} = [(B_c B_{c&#39;} \cdots B_{c^{(k)}} M_{K_{cc&#39;\cdots c^{(k)}}})^T]^{ij} \phi_{g&#39;}^j, \]
</p>
<p> depending on which of the two cells is the finer. We do this using either the matrix-vector product provided by the <code>vmult</code> function, or the product with the transpose matrix using <code>Tvmult</code> . After doing so, we transfer the result into the global right hand side vector of energy group \(g\) .</p>
<div class="fragment"><div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> g_prime_new_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> g_prime_old_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">  cell_g_prime-&gt;get_dof_values(g_prime.solution_old, g_prime_old_values);</div>
<div class="line">  cell_g_prime-&gt;get_dof_values(g_prime.solution, g_prime_new_values);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> cell_rhs(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> tmp(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (cell_g-&gt;level() &gt; cell_g_prime-&gt;level())</div>
<div class="line">    {</div>
<div class="line">      prolongation_matrix.<a class="code" href="classFullMatrix.html#a65a409eeef6388d99ac15e2bbe8045f6">vmult</a>(tmp, g_prime_old_values);</div>
<div class="line">      local_mass_matrix_f.vmult(cell_rhs, tmp);</div>
<div class="line"> </div>
<div class="line">      prolongation_matrix.<a class="code" href="classFullMatrix.html#a65a409eeef6388d99ac15e2bbe8045f6">vmult</a>(tmp, g_prime_new_values);</div>
<div class="line">      local_mass_matrix_g.vmult_add(cell_rhs, tmp);</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">      local_mass_matrix_f.vmult(tmp, g_prime_old_values);</div>
<div class="line">      prolongation_matrix.<a class="code" href="classFullMatrix.html#a8219d4fa962f1b041a506221a7a15379">Tvmult</a>(cell_rhs, tmp);</div>
<div class="line"> </div>
<div class="line">      local_mass_matrix_g.vmult(tmp, g_prime_new_values);</div>
<div class="line">      prolongation_matrix.<a class="code" href="classFullMatrix.html#abed6fffa5cb201496d751a4427cb59d6">Tvmult_add</a>(cell_rhs, tmp);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; <a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>(</div>
<div class="line">    <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">  cell_g-&gt;get_dof_indices(<a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(); ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">    system_rhs(<a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) += cell_rhs(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>The alternative is that one of the two cells is further refined. In that case, we have to loop over all the children, multiply the existing interpolation (prolongation) product of matrices from the left with the interpolation from the present cell to its child (using the matrix-matrix multiplication function <code>mmult</code> ), and then hand the result off to this very same function again, but with the cell that has children replaced by one of its children:</p>
<div class="fragment"><div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="geometry__info__0_8txt.html#a07de0b60409c551e987416d5062d2742">child</a> = 0;</div>
<div class="line">         child &lt; GeometryInfo&lt;dim&gt;::max_children_per_cell;</div>
<div class="line">         ++<a class="code" href="geometry__info__0_8txt.html#a07de0b60409c551e987416d5062d2742">child</a>)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> new_matrix(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(),</div>
<div class="line">                                      <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">        <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFE__Q__Base.html#af8c966792cf559b9cdc5e5f91e2c6ed6">get_prolongation_matrix</a>(<a class="code" href="geometry__info__0_8txt.html#a07de0b60409c551e987416d5062d2742">child</a>).<a class="code" href="classFullMatrix.html#a21b873fcd180999ad0d268c3278a71ec">mmult</a>(new_matrix,</div>
<div class="line">                                                prolongation_matrix);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (cell_g-&gt;has_children())</div>
<div class="line">          assemble_cross_group_rhs_recursive(g_prime,</div>
<div class="line">                                             cell_g-&gt;child(<a class="code" href="geometry__info__0_8txt.html#a07de0b60409c551e987416d5062d2742">child</a>),</div>
<div class="line">                                             cell_g_prime,</div>
<div class="line">                                             new_matrix);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          assemble_cross_group_rhs_recursive(g_prime,</div>
<div class="line">                                             cell_g,</div>
<div class="line">                                             cell_g_prime-&gt;child(<a class="code" href="geometry__info__0_8txt.html#a07de0b60409c551e987416d5062d2742">child</a>),</div>
<div class="line">                                             new_matrix);</div>
<div class="line">      }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGroupget_fission_sourcecode"></a> </p><h5><code>EnergyGroup::get_fission_source</code></h5>
<p><br  />
 In the (inverse) power iteration, we use the integrated fission source to update the \(k\) -eigenvalue. Given its definition, the following function is essentially self-explanatory:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">double</span> EnergyGroup&lt;dim&gt;::get_fission_source()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>  quadrature_formula(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1);</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a> = quadrature_formula.size();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                          quadrature_formula,</div>
<div class="line">                          <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;double&gt; solution_values(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> fission_source = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.active_cell_iterators())</div>
<div class="line">    {</div>
<div class="line">      fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> fission_XS =</div>
<div class="line">        material_data.get_fission_XS(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;material_id());</div>
<div class="line"> </div>
<div class="line">      fe_values.get_function_values(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, solution_values);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q_point)</div>
<div class="line">        fission_source +=</div>
<div class="line">          (fission_XS solution_values[q_point] fe_values.JxW(q_point));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> fission_source;</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGroupsolvecode"></a> </p><h5><code>EnergyGroup::solve</code></h5>
<p><br  />
 Next a function that solves the linear system assembled before. Things are pretty much standard, except that we delayed applying boundary values until we get here, since in all the previous functions we were still adding up contributions the right hand side vector.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">EnergyGroup&lt;dim&gt;::solve</a>()</div>
<div class="line">{</div>
<div class="line">  hanging_node_constraints.condense(system_rhs);</div>
<div class="line">  <a class="code" href="namespaceMatrixTools.html#a9ad0eb7a8662628534586716748d62fb">MatrixTools::apply_boundary_values</a>(boundary_values,</div>
<div class="line">                                     system_matrix,</div>
<div class="line">                                     <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>,</div>
<div class="line">                                     system_rhs);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classSolverControl.html">SolverControl</a>            solver_control(system_matrix.m(),</div>
<div class="line">                               1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-12 system_rhs.l2_norm());</div>
<div class="line">  <a class="code" href="classSolverCG.html">SolverCG&lt;Vector&lt;double&gt;</a>&gt; cg(solver_control);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classPreconditionSSOR.html">PreconditionSSOR&lt;SparseMatrix&lt;double&gt;</a>&gt; <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>;</div>
<div class="line">  <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>.initialize(system_matrix, 1.2);</div>
<div class="line"> </div>
<div class="line">  cg.solve(system_matrix, <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, system_rhs, <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>);</div>
<div class="line"> </div>
<div class="line">  hanging_node_constraints.distribute(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGroupestimate_errorscode"></a> </p><h5><code>EnergyGroup::estimate_errors</code></h5>
<p><br  />
 Mesh refinement is split into two functions. The first estimates the error for each cell, normalizes it by the magnitude of the solution, and returns it in the vector given as an argument. The calling function collects all error indicators from all energy groups, and computes thresholds for refining and coarsening cells.</p>
<div class="fragment"><div class="line">   <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">   <span class="keywordtype">void</span> EnergyGroup&lt;dim&gt;::estimate_errors(<a class="code" href="classVector.html">Vector&lt;float&gt;</a> &amp;error_indicators)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">   </span>{</div>
<div class="line">     <a class="code" href="classKellyErrorEstimator.html#aa0917e696d4f8ddb983223a68c512357">KellyErrorEstimator&lt;dim&gt;::estimate</a>(</div>
<div class="line">       dof_handler,</div>
<div class="line">       <a class="code" href="classQGauss.html">QGauss</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a></div>
<div class="line">  </div>
<div class="line">- 1&gt;(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1),</div>
<div class="line">       <a class="code" href="mapping__fe__0_8txt.html#a0af9c36aca1d2fa34a8615b4521ad4de">std::map</a>&lt;<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">types::boundary_id</a>, <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a>&gt;(),</div>
<div class="line">       <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>,</div>
<div class="line">       error_indicators);</div>
<div class="line">     error_indicators /= <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.linfty_norm();</div>
<div class="line">   }</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGrouprefine_gridcode"></a> </p><h5><code>EnergyGroup::refine_grid</code></h5>
<p><br  />
 The second part is to refine the grid given the error indicators compute in the previous function and error thresholds above which cells shall be refined or below which cells shall be coarsened. Note that we do not use any of the functions in <code><a class="el" href="namespaceGridRefinement.html">GridRefinement</a></code> here, but rather set refinement flags ourselves. <br  />
 After setting these flags, we use the <a class="el" href="classSolutionTransfer.html">SolutionTransfer</a> class to move the solution vector from the old to the new mesh. The procedure used here is described in detail in the documentation of that class:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> EnergyGroup&lt;dim&gt;::refine_grid(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;float&gt;</a> &amp;error_indicators,</div>
<div class="line">                                   <span class="keyword">const</span> <span class="keywordtype">double</span>         refine_threshold,</div>
<div class="line">                                   <span class="keyword">const</span> <span class="keywordtype">double</span>         coarsen_threshold)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.active_cell_iterators())</div>
<div class="line">    <span class="keywordflow">if</span> (error_indicators(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;active_cell_index()) &gt; refine_threshold)</div>
<div class="line">      <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;set_refine_flag();</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (error_indicators(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;active_cell_index()) &lt; coarsen_threshold)</div>
<div class="line">      <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;set_coarsen_flag();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classSolutionTransfer.html">SolutionTransfer&lt;dim&gt;</a> soltrans(dof_handler);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.prepare_coarsening_and_refinement();</div>
<div class="line">  soltrans.prepare_for_coarsening_and_refinement(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.execute_coarsening_and_refinement();</div>
<div class="line">  dof_handler.distribute_dofs(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
<div class="line">  setup_linear_system();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.reinit(dof_handler.n_dofs());</div>
<div class="line">  soltrans.interpolate(solution_old, <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
</div><!-- fragment --><p>enforce constraints to make the interpolated solution conforming on the new mesh:</p>
<div class="fragment"><div class="line">  hanging_node_constraints.distribute(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line">  solution_old.reinit(dof_handler.n_dofs());</div>
<div class="line">  solution_old = <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeEnergyGroupoutput_resultscode"></a> </p><h5><code>EnergyGroup::output_results</code></h5>
<p><br  />
 The last function of this class outputs meshes and solutions after each mesh iteration. This has been shown many times before. The only thing worth pointing out is the use of the <code><a class="el" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a></code> function to convert an integer into its string representation. The second argument of that function denotes how many digits we shall use</p>
<ul>
<li>if this value was larger than one, then the number would be padded by leading zeros.</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> EnergyGroup&lt;dim&gt;::output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keyword">const</span> std::string filename = std::string(<span class="stringliteral">&quot;solution-&quot;</span>) +</div>
<div class="line">                               <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, 2) + <span class="stringliteral">&quot;.&quot;</span> +</div>
<div class="line">                               <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>, 2) + <span class="stringliteral">&quot;.vtu&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line"> </div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">attach_dof_handler</a>(dof_handler);</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, <span class="stringliteral">&quot;solution&quot;</span>);</div>
<div class="line">  data_out.<a class="code" href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">build_patches</a>();</div>
<div class="line"> </div>
<div class="line">  std::ofstream <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>(filename);</div>
<div class="line">  data_out.<a class="code" href="classDataOutInterface.html#a93c780f93105e0daaa76c6c43694b4ae">write_vtu</a>(<a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ThecodeNeutronDiffusionProblemcodeclasstemplate"></a> </p><h3>The <code>NeutronDiffusionProblem</code> class template</h3>
<p>This is the main class of the program, not because it implements all the functionality (in fact, most of it is implemented in the <code>EnergyGroup</code> class) but because it contains the driving algorithm that determines what to compute and when. It is mostly as shown in many of the other tutorial programs in that it has a public <code>run</code> function and private functions doing all the rest. In several places, we have to do something for all energy groups, in which case we will start tasks for each group to let these things run in parallel if deal.II was configured for multithreading. For strategies of parallelization, take a look at the <a class="el" href="group__threads.html">Parallel computing with multiple processors accessing</a> module. <br  />
 The biggest difference to previous example programs is that we also declare a nested class that has member variables for all the run-time parameters that can be passed to the program in an input file. Right now, these are the number of energy groups, the number of refinement cycles, the polynomial degree of the finite element to be used, and the tolerance used to determine when convergence of the inverse power iteration has occurred. In addition, we have a constructor of this class that sets all these values to their default values, a function <code>declare_parameters</code> that describes to the <a class="el" href="classParameterHandler.html">ParameterHandler</a> class what parameters are accepted in the input file, and a function <code>get_parameters</code> that can extract the values of these parameters from a <a class="el" href="classParameterHandler.html">ParameterHandler</a> object. See also <a class="el" href="step_29.html">step-29</a> for another example of using <a class="el" href="classParameterHandler.html">ParameterHandler</a>.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>NeutronDiffusionProblem</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">class </span>Parameters</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    Parameters();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    <span class="keywordtype">void</span>        get_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_groups;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_refinement_cycles;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> convergence_tolerance;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  NeutronDiffusionProblem(<span class="keyword">const</span> Parameters &amp;<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">run</a>();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
</div><!-- fragment --><p><a class="anchor" id="codeNeutronDiffusionProblemcodeprivatememberfunctions"></a> </p><h5><code>NeutronDiffusionProblem</code> private member functions</h5>
<p>There are not that many member functions in this class since most of the functionality has been moved into the <code>EnergyGroup</code> class and is simply called from the <code><a class="el" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">run()</a></code> member function of this class. The ones that remain have self-explanatory names:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> initialize_problem();</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> refine_grid();</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> get_total_fission_source() <span class="keyword">const</span>;</div>
</div><!-- fragment --><p><a class="anchor" id="codeNeutronDiffusionProblemcodeprivatemembervariables"></a> </p><h5><code>NeutronDiffusionProblem</code> private member variables</h5>
<p>Next, we have a few member variables. In particular, these are (i) a reference to the parameter object (owned by the main function of this program, and passed to the constructor of this class), (ii) an object describing the material parameters for the number of energy groups requested in the input file, and (iii) the finite element to be used by all energy groups:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> Parameters &amp; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>;</div>
<div class="line"><span class="keyword">const</span> MaterialData material_data;</div>
<div class="line"><a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a>          <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>;</div>
</div><!-- fragment --><p>Furthermore, we have (iv) the value of the computed eigenvalue at the present iteration. This is, in fact, the only part of the solution that is shared between all energy groups</p>
<ul>
<li>all other parts of the solution, such as neutron fluxes are particular to one or the other energy group, and are therefore stored in objects that describe a single energy group:</li>
</ul>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> k_eff;</div>
</div><!-- fragment --><p>The last computational object (v) is an array of pointers to the energy group objects. The length of this array is, of course, equal to the number of energy groups specified in the parameter file.</p>
<div class="fragment"><div class="line">std::vector&lt;std::unique_ptr&lt;EnergyGroup&lt;dim&gt;&gt;&gt; energy_groups;</div>
</div><!-- fragment --><p>Finally (vi) we have a file stream to which we will save summarized output.</p>
<div class="fragment"><div class="line">  std::ofstream convergence_table_stream;</div>
<div class="line">};</div>
</div><!-- fragment --><p><a class="anchor" id="ImplementationofthecodeParameterscodeclass"></a> </p><h4>Implementation of the <code>Parameters</code> class</h4>
<p>Before going on to the implementation of the outer class, we have to implement the functions of the parameters structure. This is pretty straightforward and, in fact, looks pretty much the same for all such parameters classes using the <a class="el" href="classParameterHandler.html">ParameterHandler</a> capabilities. We will therefore not comment further on this:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">NeutronDiffusionProblem&lt;dim&gt;::Parameters::Parameters()</div>
<div class="line">  : n_groups(2)</div>
<div class="line">  , n_refinement_cycles(5)</div>
<div class="line">  , <a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>(2)</div>
<div class="line">  , convergence_tolerance(1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-12)</div>
<div class="line">{}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">NeutronDiffusionProblem&lt;dim&gt;::Parameters::declare_parameters</a>(</div>
<div class="line">  <a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Number of energy groups&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(),</div>
<div class="line">                    <span class="stringliteral">&quot;The number of energy different groups considered&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Refinement cycles&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;5&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(),</div>
<div class="line">                    <span class="stringliteral">&quot;Number of refinement cycles to be performed&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Finite element degree&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(),</div>
<div class="line">                    <span class="stringliteral">&quot;Polynomial degree of the finite element to be used&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(</div>
<div class="line">    <span class="stringliteral">&quot;Power iteration tolerance&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;1e-12&quot;</span>,</div>
<div class="line">    <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">    <span class="stringliteral">&quot;Inner power iterations are stopped when the change in k_eff falls &quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;below this tolerance&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> NeutronDiffusionProblem&lt;dim&gt;::Parameters::get_parameters(</div>
<div class="line">  <a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  n_groups              = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Number of energy groups&quot;</span>);</div>
<div class="line">  n_refinement_cycles   = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Refinement cycles&quot;</span>);</div>
<div class="line">  <a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>             = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Finite element degree&quot;</span>);</div>
<div class="line">  convergence_tolerance = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Power iteration tolerance&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ImplementationofthecodeNeutronDiffusionProblemcodeclass"></a> </p><h4>Implementation of the <code>NeutronDiffusionProblem</code> class</h4>
<p>Now for the <code>NeutronDiffusionProblem</code> class. The constructor and destructor have nothing of much interest:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">NeutronDiffusionProblem&lt;dim&gt;::NeutronDiffusionProblem(</div>
<div class="line">  <span class="keyword">const</span> Parameters &amp;<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>)</div>
<div class="line">  : <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>)</div>
<div class="line">  , material_data(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups)</div>
<div class="line">  , <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.<a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>)</div>
<div class="line">  , k_eff(std::numeric_limits&lt;<a class="code" href="hdf5__0_8txt.html#aae153b86de45d3354cd3edd5b992435e">double</a>&gt;::quiet_NaN())</div>
<div class="line">{}</div>
</div><!-- fragment --><p><a class="anchor" id="codeNeutronDiffusionProbleminitialize_problemcode"></a> </p><h5><code>NeutronDiffusionProblem::initialize_problem</code></h5>
<p><br  />
 The first function of interest is the one that sets up the geometry of the reactor core. This is described in more detail in the introduction. <br  />
 The first part of the function defines geometry data, and then creates a coarse mesh that has as many cells as there are fuel rods (or pin cells, for that matter) in that part of the reactor core that we simulate. As mentioned when interpolating boundary values above, the last parameter to the <code><a class="el" href="namespaceGridGenerator.html#ac76417d7404b75cf53c732f456e6e971">GridGenerator::subdivided_hyper_rectangle</a></code> function specifies that sides of the domain shall have unique boundary indicators that will later allow us to determine in a simple way which of the boundaries have Neumann and which have Dirichlet conditions attached to them.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> NeutronDiffusionProblem&lt;dim&gt;::initialize_problem()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rods_per_assembly_x = 17, rods_per_assembly_y = 17;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span>       pin_pitch_x = 1.26, pin_pitch_y = 1.26;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span>       assembly_height = 200;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> assemblies_x = 2, assemblies_y = 2, assemblies_z = 1;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> bottom_left = <a class="code" href="classPoint.html">Point&lt;dim&gt;</a>();</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> upper_right =</div>
<div class="line">    (<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> == 2 ? <a class="code" href="classPoint.html">Point&lt;dim&gt;</a>(assemblies_x rods_per_assembly_x pin_pitch_x,</div>
<div class="line">                           assemblies_y rods_per_assembly_y pin_pitch_y) :</div>
<div class="line">                <a class="code" href="classPoint.html">Point</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;(assemblies_x rods_per_assembly_x pin_pitch_x,</div>
<div class="line">                           assemblies_y rods_per_assembly_y pin_pitch_y,</div>
<div class="line">                           assemblies_z assembly_height));</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;unsigned int&gt; <a class="code" href="data__out__base__0_8txt.html#a292e9ce72a5d87dfef124355ac0fdd32">n_subdivisions</a>;</div>
<div class="line">  <a class="code" href="data__out__base__0_8txt.html#a292e9ce72a5d87dfef124355ac0fdd32">n_subdivisions</a>.push_back(assemblies_x rods_per_assembly_x);</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> &gt;= 2)</div>
<div class="line">    <a class="code" href="data__out__base__0_8txt.html#a292e9ce72a5d87dfef124355ac0fdd32">n_subdivisions</a>.push_back(assemblies_y rods_per_assembly_y);</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> &gt;= 3)</div>
<div class="line">    <a class="code" href="data__out__base__0_8txt.html#a292e9ce72a5d87dfef124355ac0fdd32">n_subdivisions</a>.push_back(assemblies_z);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> coarse_grid;</div>
<div class="line">  <a class="code" href="namespaceGridGenerator.html#ac76417d7404b75cf53c732f456e6e971">GridGenerator::subdivided_hyper_rectangle</a>(</div>
<div class="line">    coarse_grid, <a class="code" href="data__out__base__0_8txt.html#a292e9ce72a5d87dfef124355ac0fdd32">n_subdivisions</a>, bottom_left, upper_right, <span class="keyword">true</span>);</div>
</div><!-- fragment --><p>The second part of the function deals with material numbers of pin cells of each type of assembly. Here, we define four different types of assembly, for which we describe the arrangement of fuel rods in the following tables. <br  />
 The assemblies described here are taken from the benchmark mentioned in the introduction and are (in this order): </p><ol>
<li>
'UX' Assembly: UO2 fuel assembly with 24 guide tubes and a central Moveable Fission Chamber </li>
<li>
'UA' Assembly: UO2 fuel assembly with 24 AIC and a central Moveable Fission Chamber </li>
<li>
'PX' Assembly: MOX fuel assembly with 24 guide tubes and a central Moveable Fission Chamber </li>
<li>
'R' Assembly: a reflector. </li>
</ol>
<p><br  />
 Note that the numbers listed here and taken from the benchmark description are, in good old Fortran fashion, one-based. We will later subtract one from each number when assigning materials to individual cells to convert things into the C-style zero-based indexing.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_assemblies = 4;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> assembly_materials</div>
<div class="line">  [n_assemblies][rods_per_assembly_x][rods_per_assembly_y] = {</div>
<div class="line">    {{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 5, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 5, 1, 1, 5, 1, 1, 7, 1, 1, 5, 1, 1, 5, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 5, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}},</div>
<div class="line">    {{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 8, 1, 1, 1, 1, 1, 1, 1, 1, 1, 8, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 8, 1, 1, 8, 1, 1, 7, 1, 1, 8, 1, 1, 8, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 8, 1, 1, 1, 1, 1, 1, 1, 1, 1, 8, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">     {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}},</div>
<div class="line">    {{2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2},</div>
<div class="line">     {2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2},</div>
<div class="line">     {2, 3, 3, 3, 3, 5, 3, 3, 5, 3, 3, 5, 3, 3, 3, 3, 2},</div>
<div class="line">     {2, 3, 3, 5, 3, 4, 4, 4, 4, 4, 4, 4, 3, 5, 3, 3, 2},</div>
<div class="line">     {2, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 3, 2},</div>
<div class="line">     {2, 3, 5, 4, 4, 5, 4, 4, 5, 4, 4, 5, 4, 4, 5, 3, 2},</div>
<div class="line">     {2, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 2},</div>
<div class="line">     {2, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 2},</div>
<div class="line">     {2, 3, 5, 4, 4, 5, 4, 4, 7, 4, 4, 5, 4, 4, 5, 3, 2},</div>
<div class="line">     {2, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 2},</div>
<div class="line">     {2, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 2},</div>
<div class="line">     {2, 3, 5, 4, 4, 5, 4, 4, 5, 4, 4, 5, 4, 4, 5, 3, 2},</div>
<div class="line">     {2, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 3, 2},</div>
<div class="line">     {2, 3, 3, 5, 3, 4, 4, 4, 4, 4, 4, 4, 3, 5, 3, 3, 2},</div>
<div class="line">     {2, 3, 3, 3, 3, 5, 3, 3, 5, 3, 3, 5, 3, 3, 3, 3, 2},</div>
<div class="line">     {2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2},</div>
<div class="line">     {2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2}},</div>
<div class="line">    {{6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">     {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6}}};</div>
</div><!-- fragment --><p>After the description of the materials that make up an assembly, we have to specify the arrangement of assemblies within the core. We use a symmetric pattern that in fact only uses the 'UX' and 'PX' assemblies:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> core[assemblies_x][assemblies_y][assemblies_z] = {</div>
<div class="line">  {{0}, {2}}, {{2}, {0}}};</div>
</div><!-- fragment --><p>We are now in a position to actually set material IDs for each cell. To this end, we loop over all cells, look at the location of the cell's center, and determine which assembly and fuel rod this would be in. (We add a few checks to see that the locations we compute are within the bounds of the arrays in which we have to look up materials.) At the end of the loop, we set material identifiers accordingly:</p>
<div class="fragment"><div class="line">     <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : coarse_grid.<a class="code" href="group__CPP11.html#ga4288670ae5bd80367e24918d542cb2d8">active_cell_iterators</a>())</div>
<div class="line">       {</div>
<div class="line">         <span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> cell_center = <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;center();</div>
<div class="line">  </div>
<div class="line">         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tmp_x = <a class="code" href="table__handler__0_8txt.html#aa02519610f643695a6a4f66c4062392a">int</a>(cell_center[0] / pin_pitch_x);</div>
<div class="line">         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ax    = tmp_x / rods_per_assembly_x;</div>
<div class="line">         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cx    = tmp_x</div>
<div class="line">  </div>
<div class="line">- ax rods_per_assembly_x;</div>
<div class="line">  </div>
<div class="line">         <span class="keyword">const</span> <span class="keywordtype">unsigned</span>     tmp_y = <a class="code" href="table__handler__0_8txt.html#aa02519610f643695a6a4f66c4062392a">int</a>(cell_center[1] / pin_pitch_y);</div>
<div class="line">         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ay    = tmp_y / rods_per_assembly_y;</div>
<div class="line">         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cy    = tmp_y</div>
<div class="line">  </div>
<div class="line">- ay rods_per_assembly_y;</div>
<div class="line">  </div>
<div class="line">         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> az =</div>
<div class="line">           (<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> == 2 ? 0 : <a class="code" href="table__handler__0_8txt.html#aa02519610f643695a6a4f66c4062392a">int</a>(cell_center[<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a></div>
<div class="line">  </div>
<div class="line">- 1] / assembly_height));</div>
<div class="line">  </div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(ax &lt; assemblies_x, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(ay &lt; assemblies_y, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(az &lt; assemblies_z, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">  </div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(core[ax][ay][az] &lt; n_assemblies, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">  </div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(cx &lt; rods_per_assembly_x, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(cy &lt; rods_per_assembly_y, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">  </div>
<div class="line">         <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;set_material_id(assembly_materials[core[ax][ay][az]][cx][cy]</div>
<div class="line">  </div>
<div class="line">- 1);</div>
<div class="line">       }</div>
</div><!-- fragment --><p>With the coarse mesh so initialized, we create the appropriate number of energy group objects and let them initialize their individual meshes with the coarse mesh generated above:</p>
<div class="fragment"><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">    energy_groups.emplace_back(std::make_unique&lt;EnergyGroup&lt;dim&gt;&gt;(</div>
<div class="line">      <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, material_data, coarse_grid, <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>));</div>
<div class="line">  convergence_table_stream.open(<span class="stringliteral">&quot;convergence_table&quot;</span>);</div>
<div class="line">  convergence_table_stream.precision(12);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeNeutronDiffusionProblemget_total_fission_sourcecode"></a> </p><h5><code>NeutronDiffusionProblem::get_total_fission_source</code></h5>
<p><br  />
 In the eigenvalue computation, we need to calculate total fission neutron source after each power iteration. The total power then is used to renew k-effective. <br  />
 Since the total fission source is a sum over all the energy groups, and since each of these sums can be computed independently, we actually do this in parallel. One of the problems is that the function in the <code>EnergyGroup</code> class that computes the fission source returns a value. We would like to add these values together in the loop itself: ideally, each task would compute its value and then immediately add it to the total. Concurrently summing values in this way requires two features: </p><ol>
<li>
We need a way of storing a value such that multiple threads can read and write into concurrently in a way that prevents data races (i.e., thread-safe reading and writing).  </li>
<li>
We need a way to increment such a value that is also thread-safe.  </li>
</ol>
<p><br  />
 The first feature is available through the template class <code>std::atomic</code> . However, the second feature, implemented by <code>std::atomic&lt;double&gt;::fetch_add()</code> , is only available in C++20 and later: since deal.II supports older versions of the C++ language standard we cannot use this feature yet. Hence, instead, we simply write each group's value out to an entry in a vector and sum the values at the end of the function.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">double</span> NeutronDiffusionProblem&lt;dim&gt;::get_total_fission_source()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  std::vector&lt;double&gt;  fission_sources(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups);</div>
<div class="line">  <a class="code" href="classThreads_1_1TaskGroup.html">Threads::TaskGroup&lt;&gt;</a> <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a>;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">    <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a> += Threads::new_task&lt;&gt;([&amp;, <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]() {</div>
<div class="line">      fission_sources[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>] = energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;get_fission_source();</div>
<div class="line">    });</div>
<div class="line">  <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a>.join_all();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> std::accumulate(fission_sources.begin(), fission_sources.end(), 0.0);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeNeutronDiffusionProblemrefine_gridcode"></a> </p><h5><code>NeutronDiffusionProblem::refine_grid</code></h5>
<p><br  />
 The next function lets the individual energy group objects refine their meshes. Much of this, again, is a task that can be done independently in parallel: first, let all the energy group objects calculate their error indicators in parallel, then compute the maximum error indicator over all energy groups and determine thresholds for refinement and coarsening of cells, and then ask all the energy groups to refine their meshes accordingly, again in parallel.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> NeutronDiffusionProblem&lt;dim&gt;::refine_grid()</div>
<div class="line">{</div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups);</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">    <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>] = energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classBlockVector.html">BlockVector&lt;float&gt;</a> group_error_indicators(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>);</div>
<div class="line"> </div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classThreads_1_1TaskGroup.html">Threads::TaskGroup&lt;&gt;</a> <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a>;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">      <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a> += <a class="code" href="group__threads.html#ga664740f5d3f738649ac2811f8d656d11">Threads::new_task</a>([&amp;, <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]() {</div>
<div class="line">        energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;estimate_errors(</div>
<div class="line">          group_error_indicators.block(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>));</div>
<div class="line">      });</div>
<div class="line">  }</div>
</div><!-- fragment --><p>The destructor of <a class="el" href="classThreads_1_1TaskGroup.html">Threads::TaskGroup</a> joins all threads so we know that the computation is done by the time we exit the scope.</p>
<div class="fragment"><div class="line">  <span class="keyword">const</span> <span class="keywordtype">float</span> max_error         = group_error_indicators.linfty_norm();</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">float</span> refine_threshold  = 0.3 max_error;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">float</span> coarsen_threshold = 0.01 max_error;</div>
<div class="line"> </div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classThreads_1_1TaskGroup.html">Threads::TaskGroup&lt;void&gt;</a> <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a>;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">      <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a> += <a class="code" href="group__threads.html#ga664740f5d3f738649ac2811f8d656d11">Threads::new_task</a>([&amp;, <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]() {</div>
<div class="line">        energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;refine_grid(group_error_indicators.block(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>),</div>
<div class="line">                                          refine_threshold,</div>
<div class="line">                                          coarsen_threshold);</div>
<div class="line">      });</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeNeutronDiffusionProblemruncode"></a> </p><h5><code>NeutronDiffusionProblem::run</code></h5>
<p><br  />
 Finally, this is the function where the meat is: iterate on a sequence of meshes, and on each of them do a power iteration to compute the eigenvalue. <br  />
 Given the description of the algorithm in the introduction, there is actually not much to comment on:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">NeutronDiffusionProblem&lt;dim&gt;::run</a>()</div>
<div class="line">{</div>
</div><!-- fragment --><p>We would like to change the output precision for just this function and restore the state of <code>std::cout</code> when this function returns. Hence, we need a way to undo the output format change. Boost provides a convenient way to save the state of an output stream and restore it at the end of the current block (when the destructor of <code>restore_flags</code> is called) with the <code>ios_flags_saver</code> class, which we use here.</p>
<div class="fragment"><div class="line">boost::io::ios_flags_saver restore_flags(std::cout);</div>
<div class="line">std::cout &lt;&lt; std::setprecision(12) &lt;&lt; <a class="code" href="reordering__0_8txt.html#aeae12ef6560114f41bf3f5cccf586727">std::fixed</a>;</div>
</div><!-- fragment --><p>We calculate the error below by the change in k_eff (i.e., the difference between k_eff_old,</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> k_eff_old = 0.0;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> = 0; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_refinement_cycles;</div>
<div class="line">     ++<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>)</div>
<div class="line">  {</div>
</div><!-- fragment --><p>We will measure the CPU time that each cycle takes below. The constructor for <a class="el" href="classTimer.html">Timer</a> calls <a class="el" href="classTimer.html#a3a8b5272198d029779dc9302a54305a8">Timer::start()</a>, so once we create a timer we can query it for information. Since many parts of this loop are parallelized with tasks, the CPU time we measure (if we run with more than one thread) will be larger than the wall time.</p>
<div class="fragment"><div class="line">         <a class="code" href="classTimer.html">Timer</a> timer;</div>
<div class="line">  </div>
<div class="line">         std::cout &lt;&lt; <span class="stringliteral">&quot;Cycle &quot;</span> &lt;&lt; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; std::endl;</div>
<div class="line">  </div>
<div class="line">         <span class="keywordflow">if</span> (<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> == 0)</div>
<div class="line">           {</div>
<div class="line">             initialize_problem();</div>
<div class="line">             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">               energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;setup_linear_system();</div>
<div class="line">           }</div>
<div class="line">  </div>
<div class="line">         <span class="keywordflow">else</span></div>
<div class="line">           {</div>
<div class="line">             refine_grid();</div>
<div class="line">             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">               energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>= k_eff;</div>
<div class="line">           }</div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line">         std::cout &lt;&lt; <span class="stringliteral">&quot;   Numbers of active cells:       &quot;</span>;</div>
<div class="line">         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">           std::cout &lt;&lt; energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>() &lt;&lt; <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line">         std::cout &lt;&lt; std::endl;</div>
<div class="line">         std::cout &lt;&lt; <span class="stringliteral">&quot;   Numbers of degrees of freedom: &quot;</span>;</div>
<div class="line">         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">           std::cout &lt;&lt; energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;n_dofs() &lt;&lt; <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line">         std::cout &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line">  </div>
<div class="line">         <a class="code" href="classThreads_1_1TaskGroup.html">Threads::TaskGroup&lt;&gt;</a> <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a>;</div>
<div class="line">         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">           <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a> += <a class="code" href="group__threads.html#ga664740f5d3f738649ac2811f8d656d11">Threads::new_task</a>(</div>
<div class="line">             [&amp;, <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]() { energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;assemble_system_matrix(); });</div>
<div class="line">         <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a>.join_all();</div>
<div class="line">  </div>
<div class="line">         <span class="keywordtype">double</span>       <a class="code" href="parsed__convergence__table__0_8txt.html#aa2b5a089b26d5eb6842e77a0320440b0">error</a>;</div>
<div class="line">         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="preconditioners__0_8txt.html#abebc9af399f7664771e26564a49c8dc1">iteration</a> = 1;</div>
<div class="line">         <span class="keywordflow">do</span></div>
<div class="line">           {</div>
<div class="line">             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">               {</div>
<div class="line">                 energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;assemble_ingroup_rhs(</div>
<div class="line">                   <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>());</div>
<div class="line">  </div>
<div class="line">                 <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bgroup = 0; bgroup &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups;</div>
<div class="line">                      ++bgroup)</div>
<div class="line">                   energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;assemble_cross_group_rhs(</div>
<div class="line">                    energy_groups[bgroup]);</div>
<div class="line">  </div>
<div class="line">                 energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;solve();</div>
<div class="line">               }</div>
<div class="line">  </div>
<div class="line">             k_eff = get_total_fission_source();</div>
<div class="line">             <a class="code" href="parsed__convergence__table__0_8txt.html#aa2b5a089b26d5eb6842e77a0320440b0">error</a> = <a class="code" href="base_2vectorization_8h.html#aafbdfdd72b6cfe4eae5fa7a16385582f">std::abs</a>(k_eff</div>
<div class="line">  </div>
<div class="line">- k_eff_old) / <a class="code" href="base_2vectorization_8h.html#aafbdfdd72b6cfe4eae5fa7a16385582f">std::abs</a>(k_eff);</div>
<div class="line">             <span class="keyword">const</span> <span class="keywordtype">double</span> flux_ratio = energy_groups[0]-&gt;solution.linfty_norm() /</div>
<div class="line">                                       energy_groups[1]-&gt;solution.linfty_norm();</div>
<div class="line">             <span class="keyword">const</span> <span class="keywordtype">double</span> max_thermal = energy_groups[1]-&gt;solution.linfty_norm();</div>
<div class="line">             std::cout &lt;&lt; <span class="stringliteral">&quot;Iter number:&quot;</span> &lt;&lt; std::setw(2) &lt;&lt; <a class="code" href="reordering__0_8txt.html#abc892651c0b2805d80c1933e2fb51c1a">std::right</a></div>
<div class="line">                       &lt;&lt; <a class="code" href="preconditioners__0_8txt.html#abebc9af399f7664771e26564a49c8dc1">iteration</a> &lt;&lt; <span class="stringliteral">&quot; k_eff=&quot;</span> &lt;&lt; k_eff</div>
<div class="line">                       &lt;&lt; <span class="stringliteral">&quot; flux_ratio=&quot;</span> &lt;&lt; flux_ratio</div>
<div class="line">                       &lt;&lt; <span class="stringliteral">&quot; max_thermal=&quot;</span> &lt;&lt; max_thermal &lt;&lt; std::endl;</div>
<div class="line">             k_eff_old = k_eff;</div>
<div class="line">  </div>
<div class="line">             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">               {</div>
<div class="line">                 energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;solution_old =</div>
<div class="line">                   energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;solution;</div>
<div class="line">                 energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;solution_old /= k_eff;</div>
<div class="line">               }</div>
<div class="line">  </div>
<div class="line">             ++<a class="code" href="preconditioners__0_8txt.html#abebc9af399f7664771e26564a49c8dc1">iteration</a>;</div>
<div class="line">           }</div>
<div class="line">         <span class="keywordflow">while</span> ((<a class="code" href="parsed__convergence__table__0_8txt.html#aa2b5a089b26d5eb6842e77a0320440b0">error</a> &gt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.convergence_tolerance) &amp;&amp; (<a class="code" href="preconditioners__0_8txt.html#abebc9af399f7664771e26564a49c8dc1">iteration</a> &lt; 500));</div>
<div class="line">         convergence_table_stream &lt;&lt; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; energy_groups[0]-&gt;n_dofs()</div>
<div class="line">                                  &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; energy_groups[1]-&gt;n_dofs() &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">                                  &lt;&lt; k_eff &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">                                  &lt;&lt; energy_groups[0]-&gt;<a class="code" href="classMultigrid.html#a1f7cde7c4b4637535d07938226012952">solution</a>.linfty_norm() /</div>
<div class="line">                                       energy_groups[1]-&gt;solution.linfty_norm()</div>
<div class="line">                                  &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line">  </div>
<div class="line">         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">           energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;output_results(<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>);</div>
</div><!-- fragment --><p>Print out information about the simulation as well as the elapsed CPU time. We can call <a class="el" href="classTimer.html#a4e3933a78790d7455daff5acab3f8432">Timer::cpu_time()</a> without first calling <a class="el" href="classTimer.html#a988f79aa183d9d5473c13106f5babe48">Timer::stop()</a> to get the elapsed CPU time at the point of calling the function.</p>
<div class="fragment"><div class="line">        std::cout &lt;&lt; std::endl;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;   Cycle=&quot;</span> &lt;&lt; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt;&lt; <span class="stringliteral">&quot;, n_dofs=&quot;</span></div>
<div class="line">                  &lt;&lt; energy_groups[0]-&gt;n_dofs() + energy_groups[1]-&gt;n_dofs()</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;,  k_eff=&quot;</span> &lt;&lt; k_eff &lt;&lt; <span class="stringliteral">&quot;, time=&quot;</span> &lt;&lt; timer.<a class="code" href="classTimer.html#a4e3933a78790d7455daff5acab3f8432">cpu_time</a>()</div>
<div class="line">                  &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Step28</span></div>
</div><!-- fragment --><p><a class="anchor" id="Thecodemaincodefunction"></a> </p><h3>The <code><a class="el" href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main()</a></code> function</h3>
<p>The last thing in the program in the <code><a class="el" href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main()</a></code> function. The structure is as in most other tutorial programs, with the only exception that we here handle a parameter file. To this end, we first look at the command line arguments passed to this function: if no input file is specified on the command line, then use "project.prm", otherwise take the filename given as the first argument on the command line.</p>
<p>With this, we create a <a class="el" href="classParameterHandler.html">ParameterHandler</a> object, let the <code>NeutronDiffusionProblem::Parameters</code> class declare all the parameters it wants to see in the input file (or, take the default values, if nothing is listed in the parameter file), then read the input file, ask the parameters object to extract the values, and finally hand everything off to an object of type <code>NeutronDiffusionProblem</code> for computation of the eigenvalue:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>*argv)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line">      <span class="keyword">using namespace </span><a class="code" href="namespaceStep28.html">Step28</a>;</div>
<div class="line"> </div>
<div class="line">      std::string filename;</div>
<div class="line">      <span class="keywordflow">if</span> (argc &lt; 2)</div>
<div class="line">        filename = <span class="stringliteral">&quot;project.prm&quot;</span>;</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        filename = argv[1];</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> = 2;</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classParameterHandler.html">ParameterHandler</a> parameter_handler;</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classStep28_1_1NeutronDiffusionProblem_1_1Parameters.html">NeutronDiffusionProblem&lt;dim&gt;::Parameters</a> <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>;</div>
<div class="line">      <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.declare_parameters(parameter_handler);</div>
<div class="line"> </div>
<div class="line">      parameter_handler.<a class="code" href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">parse_input</a>(filename);</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.get_parameters(parameter_handler);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classStep28_1_1NeutronDiffusionProblem.html">NeutronDiffusionProblem&lt;dim&gt;</a> neutron_diffusion_problem(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>);</div>
<div class="line">      neutron_diffusion_problem.run();</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (<a class="code" href="parameter__handler__0_8txt.html#ad919e2b915d8e8226aef004c2d8399a8">std::exception</a> &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p> <a class="anchor" id="Results"></a></p><h1>Results</h1>
<p>We can run the program with the following input file : </p><div class="fragment"><div class="line"><span class="preprocessor"># Listing of Parameters</span></div>
<div class="line"><span class="preprocessor">#</span></div>
<div class="line">  </div>
<div class="line">---------------------</div>
<div class="line"><span class="preprocessor"># Polynomial degree of the finite element to be used</span></div>
<div class="line"><a class="code" href="A-headers_2exceptions__0_8txt.html#a602682024ec652b990be121b5665f8ce">set</a> Finite <a class="code" href="distributed__0_8txt.html#ac4c845555bda24566ddc584532b7fa57">element</a> <a class="code" href="polynomial__space__0_8txt.html#a03a2f48682e29e39f7bccc11a7d1c4d1">degree</a>     = 2</div>
<div class="line">  </div>
<div class="line"><span class="preprocessor"># The number of energy different groups considered</span></div>
<div class="line"><a class="code" href="A-headers_2exceptions__0_8txt.html#a602682024ec652b990be121b5665f8ce">set</a> <a class="code" href="namespaceEuler__DG.html#a143bc64b6fa6ced9f11c148a2af3ff09">Number</a> <a class="code" href="multithreading__0_8txt.html#a33468e75b7ea6d2e64b7e88c6ff1217a">of</a> energy groups   = 2</div>
<div class="line">  </div>
<div class="line"><span class="preprocessor"># Inner power iterations are stopped when the change in k_eff falls below this</span></div>
<div class="line"><span class="preprocessor"># tolerance</span></div>
<div class="line"><a class="code" href="A-headers_2exceptions__0_8txt.html#a602682024ec652b990be121b5665f8ce">set</a> Power <a class="code" href="preconditioners__0_8txt.html#abebc9af399f7664771e26564a49c8dc1">iteration</a> <a class="code" href="trilinos__precondition__0_8txt.html#ae2e38e4f182c566122b10d662b9d3f89">tolerance</a> = 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-12</div>
<div class="line">  </div>
<div class="line"><span class="preprocessor"># Number of refinement cycles to be performed</span></div>
<div class="line"><span class="preprocessor">set Refinement cycles         = 12</span></div>
</div><!-- fragment --><p> The output of this program then consists of the console output, a filenamed &lsquo;convergence_table&rsquo; to record main results of mesh iteration,and the graphical output in vtu format. The console output looks like this: </p><div class="fragment"><div class="line">Cycle 0:</div>
<div class="line">   Numbers <a class="code" href="multithreading__0_8txt.html#a33468e75b7ea6d2e64b7e88c6ff1217a">of</a> <a class="code" href="dof__tools__0_8txt.html#aa623f15672a6db0f3f730a81a5b432b4">active</a> <a class="code" href="distributed__0_8txt.html#aafea668ad0c451ac7a0fae0f558c36d7">cells</a>:       1156 1156</div>
<div class="line">   Numbers <a class="code" href="multithreading__0_8txt.html#a33468e75b7ea6d2e64b7e88c6ff1217a">of</a> <a class="code" href="fe__q__0_8txt.html#a1a8eaafa20c4d8c9ab128b62a984738c">degrees</a> <a class="code" href="multithreading__0_8txt.html#a33468e75b7ea6d2e64b7e88c6ff1217a">of</a> <a class="code" href="coding__conventions__0_8txt.html#a69730bc7f91dd1be17fd083a66514e73">freedom</a>: 4761 4761</div>
<div class="line">  </div>
<div class="line">Iter <a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>: 1 k_eff=319.375676634310 flux_ratio=6.836246075630 max_thermal=1.433899030144</div>
<div class="line">Iter <a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>: 2 k_eff=0.834072546055 flux_ratio=5.204601882144 max_thermal=0.004630925876</div>
<div class="line">Iter <a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>: 3 k_eff=0.862826188043 flux_ratio=4.645051765984 max_thermal=0.005380396338</div>
<div class="line">...</div>
<div class="line">Iter <a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>:69 k_eff=0.906841960370 flux_ratio=4.384056022578 max_thermal=0.008466414246</div>
<div class="line">Iter <a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>:70 k_eff=0.906841960371 flux_ratio=4.384056022583 max_thermal=0.008466414246</div>
<div class="line">  </div>
<div class="line">   Cycle=0, n_dofs=9522,  k_eff=0.906841960371, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a>=7.623425000000</div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">Cycle 1:</div>
<div class="line">   Numbers <a class="code" href="multithreading__0_8txt.html#a33468e75b7ea6d2e64b7e88c6ff1217a">of</a> <a class="code" href="dof__tools__0_8txt.html#aa623f15672a6db0f3f730a81a5b432b4">active</a> <a class="code" href="distributed__0_8txt.html#aafea668ad0c451ac7a0fae0f558c36d7">cells</a>:       1156 2380</div>
<div class="line">   Numbers <a class="code" href="multithreading__0_8txt.html#a33468e75b7ea6d2e64b7e88c6ff1217a">of</a> <a class="code" href="fe__q__0_8txt.html#a1a8eaafa20c4d8c9ab128b62a984738c">degrees</a> <a class="code" href="multithreading__0_8txt.html#a33468e75b7ea6d2e64b7e88c6ff1217a">of</a> <a class="code" href="coding__conventions__0_8txt.html#a69730bc7f91dd1be17fd083a66514e73">freedom</a>: 4761 10667</div>
<div class="line">  </div>
<div class="line">Iter <a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>: 1 k_eff=0.906838267472 flux_ratio=4.385474405125 max_thermal=0.008463675976</div>
<div class="line">...</div>
<div class="line">  </div>
<div class="line">Cycle 11:</div>
<div class="line">   Numbers <a class="code" href="multithreading__0_8txt.html#a33468e75b7ea6d2e64b7e88c6ff1217a">of</a> <a class="code" href="dof__tools__0_8txt.html#aa623f15672a6db0f3f730a81a5b432b4">active</a> <a class="code" href="distributed__0_8txt.html#aafea668ad0c451ac7a0fae0f558c36d7">cells</a>:       11749 47074</div>
<div class="line">   Numbers <a class="code" href="multithreading__0_8txt.html#a33468e75b7ea6d2e64b7e88c6ff1217a">of</a> <a class="code" href="fe__q__0_8txt.html#a1a8eaafa20c4d8c9ab128b62a984738c">degrees</a> <a class="code" href="multithreading__0_8txt.html#a33468e75b7ea6d2e64b7e88c6ff1217a">of</a> <a class="code" href="coding__conventions__0_8txt.html#a69730bc7f91dd1be17fd083a66514e73">freedom</a>: 50261 204523</div>
<div class="line">  </div>
<div class="line">Iter <a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>: 1 k_eff=0.906798057750 flux_ratio=4.384878772166 max_thermal=0.008464822382</div>
<div class="line">Iter <a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>: 2 k_eff=0.906833008185 flux_ratio=4.384868138638 max_thermal=0.008465057191</div>
<div class="line">...</div>
<div class="line">Iter <a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>:32 k_eff=0.906834736550 flux_ratio=4.384846081793 max_thermal=0.008465019607</div>
<div class="line">Iter <a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>:33 k_eff=0.906834736551 flux_ratio=4.384846081798 max_thermal=0.008465019607</div>
<div class="line">  </div>
<div class="line">   Cycle=11, n_dofs=254784,  k_eff=0.906834736551, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a>=238.593762000000</div>
</div><!-- fragment --><p>We see that power iteration does converge faster after cycle 0 due to the initializationwith solution from last mesh iteration.The contents of &lsquo;convergence_table&rsquo; are, </p><div class="fragment"><div class="line">0 4761 4761 0.906841960371 4.38405602258</div>
<div class="line">1 4761 10667 0.906837901031 4.38548908776</div>
<div class="line">2 4761 18805 0.906836075928 4.3854666475</div>
<div class="line">3 6629 27301 0.90683550011 4.38540458087</div>
<div class="line">4 12263 48095 0.906835001796 4.38538179873</div>
<div class="line">5 17501 69297 0.906834858174 4.38485382341</div>
<div class="line">6 19933 78605 0.90683482406 4.38485065879</div>
<div class="line">7 23979 93275 0.906834787555 4.38484837926</div>
<div class="line">8 30285 117017 0.906834761604 4.38484654495</div>
<div class="line">9 40087 154355 0.906834746215 4.38484608319</div>
<div class="line">10 45467 179469 0.906834740155 4.38484600505</div>
<div class="line">11 50261 204523 0.906834736551 4.3848460818</div>
</div><!-- fragment --><p> The meanings of columns are: number of mesh iteration, numbers of degrees of freedom of fast energy group, numbers of DoFs of thermal group, convergedk-effective and the ratio between maximum of fast flux and maximum of thermal one. The grids of fast and thermal energy groups at mesh iteration #9 lookas follows: <img src="https://www.dealii.org/images/steps/developer/step-28.grid-0.9.order2.png" alt="" width="400" class="inline"/> &#160; <img src="https://www.dealii.org/images/steps/developer/step-28.grid-1.9.order2.png" alt="" width="400" class="inline"/> <br  />
 We see that the grid of thermal group is much finer than the one of fast group.The solutions on these grids are, (Note: flux are normalized with total fissionsource equal to 1) <img src="https://www.dealii.org/images/steps/developer/step-28.solution-0.9.order2.png" alt="" width="400" class="inline"/> &#160; <img src="https://www.dealii.org/images/steps/developer/step-28.solution-1.9.order2.png" alt="" width="400" class="inline"/> <br  />
 Then we plot the convergence data with polynomial order being equal to 1,2 and 3. <img src="https://www.dealii.org/images/steps/developer/step-28.convergence.png" alt="" class="inline"/> <br  />
 The estimated &lsquo;exact&rsquo; k-effective = 0.906834721253 which is simply from lastmesh iteration of polynomial order 3 minus 2e-10. We see that h-adaptive calculationsdeliver an algebraic convergence. And the higher polynomial order is, the faster meshiteration converges. In our problem, we need smaller number of DoFs to achieve sameaccuracy with higher polynomial order.</p>
<p><a class="anchor" id="PlainProg"></a></p><h1>The plain program</h1>
<div class="fragment"><div class="line"><span class="comment">/* ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2009 - 2021 by the deal.II authors</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file is part of the deal.II library.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The deal.II library is free software; you can use it, redistribute</span></div>
<div class="line"><span class="comment"> * it, and/or modify it under the terms of the GNU Lesser General</span></div>
<div class="line"><span class="comment"> * Public License as published by the Free Software Foundation; either</span></div>
<div class="line"><span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><span class="comment"> * The full text of the license can be found in the file LICENSE.md at</span></div>
<div class="line"><span class="comment"> * the top level directory of deal.II.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Author: Yaqi Wang, Texas A&amp;M University, 2009, 2010</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2timer_8h.html">deal.II/base/timer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2parameter__handler_8h.html">deal.II/base/parameter_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2thread__management_8h.html">deal.II/base/thread_management.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="include_2deal_8II_2base_2utilities_8h.html">deal.II/base/utilities.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2vector_8h.html">deal.II/lac/vector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2full__matrix_8h.html">deal.II/lac/full_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2sparsity__pattern_8h.html">deal.II/lac/sparsity_pattern.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2sparse__matrix_8h.html">deal.II/lac/sparse_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2solver__cg_8h.html">deal.II/lac/solver_cg.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2precondition_8h.html">deal.II/lac/precondition.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__refinement_8h.html">deal.II/grid/grid_refinement.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__out_8h.html">deal.II/grid/grid_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__values_8h.html">deal.II/fe/fe_values.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2matrix__tools_8h.html">deal.II/numerics/matrix_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2error__estimator_8h.html">deal.II/numerics/error_estimator.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2block__vector_8h.html">deal.II/lac/block_vector.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2solution__transfer_8h.html">deal.II/numerics/solution_transfer.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__tools_8h.html">deal.II/grid/grid_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;boost/io/ios_state.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;list&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceStep28.html">Step28</a></div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">class </span>MaterialData</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    MaterialData(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_groups);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> get_diffusion_coefficient(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) <span class="keyword">const</span>;</div>
<div class="line">    <span class="keywordtype">double</span> get_removal_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) <span class="keyword">const</span>;</div>
<div class="line">    <span class="keywordtype">double</span> get_fission_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) <span class="keyword">const</span>;</div>
<div class="line">    <span class="keywordtype">double</span> get_fission_dist_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_1,</div>
<div class="line">                               <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_2,</div>
<div class="line">                               <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) <span class="keyword">const</span>;</div>
<div class="line">    <span class="keywordtype">double</span> get_scattering_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_1,</div>
<div class="line">                             <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_2,</div>
<div class="line">                             <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) <span class="keyword">const</span>;</div>
<div class="line">    <span class="keywordtype">double</span> get_fission_spectrum(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_groups;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_materials;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;2, double&gt;</a> diffusion;</div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;2, double&gt;</a> sigma_r;</div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;2, double&gt;</a> nu_sigma_f;</div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;3, double&gt;</a> sigma_s;</div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;2, double&gt;</a> chi;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classStep28_1_1MaterialData.html#a3aa25110af7a21c993d9112b19f3670f">MaterialData::MaterialData</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_groups)</div>
<div class="line">    : n_groups(n_groups)</div>
<div class="line">    , n_materials(8)</div>
<div class="line">    , diffusion(n_materials, n_groups)</div>
<div class="line">    , sigma_r(n_materials, n_groups)</div>
<div class="line">    , nu_sigma_f(n_materials, n_groups)</div>
<div class="line">    , sigma_s(n_materials, n_groups, n_groups)</div>
<div class="line">    , chi(n_materials, n_groups)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">switch</span> (this-&gt;n_groups)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">case</span> 2:</div>
<div class="line">          {</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a> = 0; <a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a> &lt; n_materials; ++<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>)</div>
<div class="line">              {</div>
<div class="line">                diffusion[<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>][0] = 1.2;</div>
<div class="line">                diffusion[<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>][1] = 0.4;</div>
<div class="line">                chi[<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>][0]       = 1.0;</div>
<div class="line">                chi[<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>][1]       = 0.0;</div>
<div class="line">                sigma_r[<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>][0]   = 0.03;</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_1 = 0; group_1 &lt; n_groups; ++group_1)</div>
<div class="line">                  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_2 = 0; group_2 &lt; n_groups; ++group_2)</div>
<div class="line">                    sigma_s[<a class="code" href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a>][group_1][group_2] = 0.0;</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">            diffusion[5][1] = 0.2;</div>
<div class="line"> </div>
<div class="line">            sigma_r[4][0] = 0.026;</div>
<div class="line">            sigma_r[5][0] = 0.051;</div>
<div class="line">            sigma_r[6][0] = 0.026;</div>
<div class="line">            sigma_r[7][0] = 0.050;</div>
<div class="line"> </div>
<div class="line">            sigma_r[0][1] = 0.100;</div>
<div class="line">            sigma_r[1][1] = 0.200;</div>
<div class="line">            sigma_r[2][1] = 0.250;</div>
<div class="line">            sigma_r[3][1] = 0.300;</div>
<div class="line">            sigma_r[4][1] = 0.020;</div>
<div class="line">            sigma_r[5][1] = 0.040;</div>
<div class="line">            sigma_r[6][1] = 0.020;</div>
<div class="line">            sigma_r[7][1] = 0.800;</div>
<div class="line"> </div>
<div class="line">            nu_sigma_f[0][0] = 0.0050;</div>
<div class="line">            nu_sigma_f[1][0] = 0.0075;</div>
<div class="line">            nu_sigma_f[2][0] = 0.0075;</div>
<div class="line">            nu_sigma_f[3][0] = 0.0075;</div>
<div class="line">            nu_sigma_f[4][0] = 0.000;</div>
<div class="line">            nu_sigma_f[5][0] = 0.000;</div>
<div class="line">            nu_sigma_f[6][0] = 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-7;</div>
<div class="line">            nu_sigma_f[7][0] = 0.00;</div>
<div class="line"> </div>
<div class="line">            nu_sigma_f[0][1] = 0.125;</div>
<div class="line">            nu_sigma_f[1][1] = 0.300;</div>
<div class="line">            nu_sigma_f[2][1] = 0.375;</div>
<div class="line">            nu_sigma_f[3][1] = 0.450;</div>
<div class="line">            nu_sigma_f[4][1] = 0.000;</div>
<div class="line">            nu_sigma_f[5][1] = 0.000;</div>
<div class="line">            nu_sigma_f[6][1] = 3<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-6;</div>
<div class="line">            nu_sigma_f[7][1] = 0.00;</div>
<div class="line"> </div>
<div class="line">            sigma_s[0][0][1] = 0.020;</div>
<div class="line">            sigma_s[1][0][1] = 0.015;</div>
<div class="line">            sigma_s[2][0][1] = 0.015;</div>
<div class="line">            sigma_s[3][0][1] = 0.015;</div>
<div class="line">            sigma_s[4][0][1] = 0.025;</div>
<div class="line">            sigma_s[5][0][1] = 0.050;</div>
<div class="line">            sigma_s[6][0][1] = 0.025;</div>
<div class="line">            sigma_s[7][0][1] = 0.010;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>,</div>
<div class="line">                 <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(</div>
<div class="line">                   <span class="stringliteral">&quot;Presently, only data for 2 groups is implemented&quot;</span>));</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span></div>
<div class="line">  MaterialData::get_diffusion_coefficient(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; n_groups, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, 0, n_groups));</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a> &lt; n_materials,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>, 0, n_materials));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> diffusion[<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>][<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>];</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> MaterialData::get_removal_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; n_groups, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, 0, n_groups));</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a> &lt; n_materials,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>, 0, n_materials));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> sigma_r[<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>][<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>];</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> MaterialData::get_fission_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; n_groups, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, 0, n_groups));</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a> &lt; n_materials,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>, 0, n_materials));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> nu_sigma_f[<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>][<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>];</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> MaterialData::get_scattering_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_1,</div>
<div class="line">                                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_2,</div>
<div class="line">                                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(group_1 &lt; n_groups, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(group_1, 0, n_groups));</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(group_2 &lt; n_groups, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(group_2, 0, n_groups));</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a> &lt; n_materials,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>, 0, n_materials));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> sigma_s[<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>][group_1][group_2];</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span></div>
<div class="line">  MaterialData::get_fission_spectrum(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; n_groups, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, 0, n_groups));</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a> &lt; n_materials,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>, 0, n_materials));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> chi[<a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>][<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>];</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> MaterialData::get_fission_dist_XS(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_1,</div>
<div class="line">                                           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_2,</div>
<div class="line">                                           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> (get_fission_spectrum(group_1, <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>) *</div>
<div class="line">            get_fission_XS(group_2, <a class="code" href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">material_id</a>));</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span>EnergyGroup</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    EnergyGroup(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                <span class="keyword">const</span> MaterialData &amp;      material_data,</div>
<div class="line">                <span class="keyword">const</span> <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;coarse_grid,</div>
<div class="line">                <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> setup_linear_system();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>() <span class="keyword">const</span>;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_dofs() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> assemble_system_matrix();</div>
<div class="line">    <span class="keywordtype">void</span> assemble_ingroup_rhs(<span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;extraneous_source);</div>
<div class="line">    <span class="keywordtype">void</span> assemble_cross_group_rhs(<span class="keyword">const</span> EnergyGroup&lt;dim&gt; &amp;g_prime);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> get_fission_source() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> estimate_errors(<a class="code" href="classVector.html">Vector&lt;float&gt;</a> &amp;error_indicators) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> refine_grid(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;float&gt;</a> &amp;error_indicators,</div>
<div class="line">                     <span class="keyword">const</span> <span class="keywordtype">double</span>         refine_threshold,</div>
<div class="line">                     <span class="keyword">const</span> <span class="keywordtype">double</span>         coarsen_threshold);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>;</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> solution_old;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>;</div>
<div class="line">    <span class="keyword">const</span> MaterialData &amp;material_data;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a>        <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>;</div>
<div class="line">    <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>           dof_handler;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSparsityPattern.html">SparsityPattern</a>      <a class="code" href="trilinos__sparse__matrix__0_8txt.html#ab4e34663c28496ee1b07f40fd5d00fa1">sparsity_pattern</a>;</div>
<div class="line">    <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> system_matrix;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> system_rhs;</div>
<div class="line"> </div>
<div class="line">    std::map&lt;types::global_dof_index, double&gt; boundary_values;</div>
<div class="line">    <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a>                 hanging_node_constraints;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">void</span> assemble_cross_group_rhs_recursive(</div>
<div class="line">      <span class="keyword">const</span> EnergyGroup&lt;dim&gt; &amp;                       g_prime,</div>
<div class="line">      <span class="keyword">const</span> <span class="keyword">typename</span> DoFHandler&lt;dim&gt;::cell_iterator &amp;cell_g,</div>
<div class="line">      <span class="keyword">const</span> <span class="keyword">typename</span> DoFHandler&lt;dim&gt;::cell_iterator &amp;cell_g_prime,</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> &amp;                     prolongation_matrix);</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  EnergyGroup&lt;dim&gt;::EnergyGroup(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                <span class="keyword">const</span> MaterialData &amp;      material_data,</div>
<div class="line">                                <span class="keyword">const</span> <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> &amp;coarse_grid,</div>
<div class="line">                                <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>)</div>
<div class="line">    : <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">    , material_data(material_data)</div>
<div class="line">    , <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>)</div>
<div class="line">    , dof_handler(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.copy_triangulation(coarse_grid);</div>
<div class="line">    dof_handler.distribute_dofs(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">EnergyGroup&lt;dim&gt;::n_active_cells</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> EnergyGroup&lt;dim&gt;::n_dofs()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> dof_handler.n_dofs();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> EnergyGroup&lt;dim&gt;::setup_linear_system()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_dofs = dof_handler.n_dofs();</div>
<div class="line"> </div>
<div class="line">    hanging_node_constraints.clear();</div>
<div class="line">    <a class="code" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a>(dof_handler,</div>
<div class="line">                                            hanging_node_constraints);</div>
<div class="line">    hanging_node_constraints.close();</div>
<div class="line"> </div>
<div class="line">    system_matrix.clear();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(n_dofs, n_dofs);</div>
<div class="line">    <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler, dsp);</div>
<div class="line">    hanging_node_constraints.condense(dsp);</div>
<div class="line">    <a class="code" href="trilinos__sparse__matrix__0_8txt.html#ab4e34663c28496ee1b07f40fd5d00fa1">sparsity_pattern</a>.copy_from(dsp);</div>
<div class="line"> </div>
<div class="line">    system_matrix.reinit(<a class="code" href="trilinos__sparse__matrix__0_8txt.html#ab4e34663c28496ee1b07f40fd5d00fa1">sparsity_pattern</a>);</div>
<div class="line"> </div>
<div class="line">    system_rhs.reinit(n_dofs);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.size() == 0)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.reinit(n_dofs);</div>
<div class="line">        solution_old.reinit(n_dofs);</div>
<div class="line">        solution_old = 1.0;</div>
<div class="line">        <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>     = solution_old;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    boundary_values.clear();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">      <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(dof_handler,</div>
<div class="line">                                               2 * <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> + 1,</div>
<div class="line">                                               <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(),</div>
<div class="line">                                               boundary_values);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> EnergyGroup&lt;dim&gt;::assemble_system_matrix()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> quadrature_formula(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                            quadrature_formula,</div>
<div class="line">                            <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> |</div>
<div class="line">                              <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> = <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>    = quadrature_formula.size();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a>(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>, <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a>     cell_rhs(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; <a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.active_cell_iterators())</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a> = 0;</div>
<div class="line"> </div>
<div class="line">        fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> diffusion_coefficient =</div>
<div class="line">          material_data.get_diffusion_coefficient(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;material_id());</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> removal_XS =</div>
<div class="line">          material_data.get_removal_XS(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;material_id());</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q_point)</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> = 0; <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>)</div>
<div class="line">              <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>) +=</div>
<div class="line">                ((diffusion_coefficient * fe_values.shape_grad(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) *</div>
<div class="line">                    fe_values.shape_grad(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point) +</div>
<div class="line">                  removal_XS * fe_values.shape_value(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) *</div>
<div class="line">                    fe_values.shape_value(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point)) *</div>
<div class="line">                 fe_values.JxW(q_point));</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;get_dof_indices(<a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> = 0; <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>)</div>
<div class="line">            system_matrix.add(<a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>],</div>
<div class="line">                              <a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>[<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>],</div>
<div class="line">                              <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>));</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    hanging_node_constraints.condense(system_matrix);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span></div>
<div class="line">  EnergyGroup&lt;dim&gt;::assemble_ingroup_rhs(<span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;extraneous_source)</div>
<div class="line">  {</div>
<div class="line">    system_rhs.reinit(dof_handler.n_dofs());</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> quadrature_formula(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> = <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>    = quadrature_formula.size();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                            quadrature_formula,</div>
<div class="line">                            <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> |</div>
<div class="line">                              <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a>      cell_rhs(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">    std::vector&lt;double&gt; extraneous_source_values(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line">    std::vector&lt;double&gt; solution_old_values(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; <a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.active_cell_iterators())</div>
<div class="line">      {</div>
<div class="line">        cell_rhs = 0;</div>
<div class="line"> </div>
<div class="line">        fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> fission_dist_XS =</div>
<div class="line">          material_data.get_fission_dist_XS(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;material_id());</div>
<div class="line"> </div>
<div class="line">        extraneous_source.<a class="code" href="classFunction.html#a562fc1114e95e702e6696721f71528db">value_list</a>(fe_values.get_quadrature_points(),</div>
<div class="line">                                     extraneous_source_values);</div>
<div class="line"> </div>
<div class="line">        fe_values.get_function_values(solution_old, solution_old_values);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;get_dof_indices(<a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q_point)</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">            cell_rhs(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>) +=</div>
<div class="line">              ((extraneous_source_values[q_point] +</div>
<div class="line">                fission_dist_XS * solution_old_values[q_point]) *</div>
<div class="line">               fe_values.shape_value(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) * fe_values.JxW(q_point));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">          system_rhs(<a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) += cell_rhs(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>);</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span></div>
<div class="line">  EnergyGroup&lt;dim&gt;::assemble_cross_group_rhs(<span class="keyword">const</span> EnergyGroup&lt;dim&gt; &amp;g_prime)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> == g_prime.group)</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> std::list&lt;std::pair&lt;typename DoFHandler&lt;dim&gt;::cell_iterator,</div>
<div class="line">                              <span class="keyword">typename</span> DoFHandler&lt;dim&gt;::cell_iterator&gt;&gt;</div>
<div class="line">      cell_list =</div>
<div class="line">        <a class="code" href="namespaceGridTools.html#a32a5016c746ad756046ecff264dfa60d">GridTools::get_finest_common_cells</a>(dof_handler, g_prime.dof_handler);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell_pair : cell_list)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> unit_matrix(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; unit_matrix.m(); ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">          unit_matrix(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>) = 1;</div>
<div class="line">        assemble_cross_group_rhs_recursive(g_prime,</div>
<div class="line">                                           cell_pair.first,</div>
<div class="line">                                           cell_pair.second,</div>
<div class="line">                                           unit_matrix);</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> EnergyGroup&lt;dim&gt;::assemble_cross_group_rhs_recursive(</div>
<div class="line">    <span class="keyword">const</span> EnergyGroup&lt;dim&gt; &amp;                       g_prime,</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">typename</span> DoFHandler&lt;dim&gt;::cell_iterator &amp;cell_g,</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">typename</span> DoFHandler&lt;dim&gt;::cell_iterator &amp;cell_g_prime,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> &amp;                     prolongation_matrix)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (!cell_g-&gt;has_children() &amp;&amp; !cell_g_prime-&gt;has_children())</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>  quadrature_formula(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1);</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a> = quadrature_formula.size();</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                                quadrature_formula,</div>
<div class="line">                                <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (cell_g-&gt;level() &gt; cell_g_prime-&gt;level())</div>
<div class="line">          fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(cell_g);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(cell_g_prime);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> fission_dist_XS =</div>
<div class="line">          material_data.get_fission_dist_XS(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                            g_prime.group,</div>
<div class="line">                                            cell_g_prime-&gt;material_id());</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> scattering_XS =</div>
<div class="line">          material_data.get_scattering_XS(g_prime.group,</div>
<div class="line">                                          <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>,</div>
<div class="line">                                          cell_g_prime-&gt;material_id());</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> local_mass_matrix_f(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(),</div>
<div class="line">                                               <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">        <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> local_mass_matrix_g(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(),</div>
<div class="line">                                               <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q_point)</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(); ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> = 0; <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> &lt; <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(); ++<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>)</div>
<div class="line">              {</div>
<div class="line">                local_mass_matrix_f(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>) +=</div>
<div class="line">                  (fission_dist_XS * fe_values.shape_value(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) *</div>
<div class="line">                   fe_values.shape_value(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point) * fe_values.JxW(q_point));</div>
<div class="line">                local_mass_matrix_g(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>) +=</div>
<div class="line">                  (scattering_XS * fe_values.shape_value(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) *</div>
<div class="line">                   fe_values.shape_value(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point) * fe_values.JxW(q_point));</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classVector.html">Vector&lt;double&gt;</a> g_prime_new_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">        <a class="code" href="classVector.html">Vector&lt;double&gt;</a> g_prime_old_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">        cell_g_prime-&gt;get_dof_values(g_prime.solution_old, g_prime_old_values);</div>
<div class="line">        cell_g_prime-&gt;get_dof_values(g_prime.solution, g_prime_new_values);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classVector.html">Vector&lt;double&gt;</a> cell_rhs(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">        <a class="code" href="classVector.html">Vector&lt;double&gt;</a> tmp(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (cell_g-&gt;level() &gt; cell_g_prime-&gt;level())</div>
<div class="line">          {</div>
<div class="line">            prolongation_matrix.<a class="code" href="classFullMatrix.html#a65a409eeef6388d99ac15e2bbe8045f6">vmult</a>(tmp, g_prime_old_values);</div>
<div class="line">            local_mass_matrix_f.vmult(cell_rhs, tmp);</div>
<div class="line"> </div>
<div class="line">            prolongation_matrix.<a class="code" href="classFullMatrix.html#a65a409eeef6388d99ac15e2bbe8045f6">vmult</a>(tmp, g_prime_new_values);</div>
<div class="line">            local_mass_matrix_g.vmult_add(cell_rhs, tmp);</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          {</div>
<div class="line">            local_mass_matrix_f.vmult(tmp, g_prime_old_values);</div>
<div class="line">            prolongation_matrix.<a class="code" href="classFullMatrix.html#a8219d4fa962f1b041a506221a7a15379">Tvmult</a>(cell_rhs, tmp);</div>
<div class="line"> </div>
<div class="line">            local_mass_matrix_g.vmult(tmp, g_prime_new_values);</div>
<div class="line">            prolongation_matrix.<a class="code" href="classFullMatrix.html#abed6fffa5cb201496d751a4427cb59d6">Tvmult_add</a>(cell_rhs, tmp);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        std::vector&lt;types::global_dof_index&gt; <a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>(</div>
<div class="line">          <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">        cell_g-&gt;get_dof_indices(<a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(); ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">          system_rhs(<a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) += cell_rhs(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="geometry__info__0_8txt.html#a07de0b60409c551e987416d5062d2742">child</a> = 0;</div>
<div class="line">           child &lt; GeometryInfo&lt;dim&gt;::max_children_per_cell;</div>
<div class="line">           ++<a class="code" href="geometry__info__0_8txt.html#a07de0b60409c551e987416d5062d2742">child</a>)</div>
<div class="line">        {</div>
<div class="line">          <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> new_matrix(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(),</div>
<div class="line">                                        <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>());</div>
<div class="line">          <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFE__Q__Base.html#af8c966792cf559b9cdc5e5f91e2c6ed6">get_prolongation_matrix</a>(<a class="code" href="geometry__info__0_8txt.html#a07de0b60409c551e987416d5062d2742">child</a>).<a class="code" href="classFullMatrix.html#a21b873fcd180999ad0d268c3278a71ec">mmult</a>(new_matrix,</div>
<div class="line">                                                  prolongation_matrix);</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">if</span> (cell_g-&gt;has_children())</div>
<div class="line">            assemble_cross_group_rhs_recursive(g_prime,</div>
<div class="line">                                               cell_g-&gt;child(<a class="code" href="geometry__info__0_8txt.html#a07de0b60409c551e987416d5062d2742">child</a>),</div>
<div class="line">                                               cell_g_prime,</div>
<div class="line">                                               new_matrix);</div>
<div class="line">          <span class="keywordflow">else</span></div>
<div class="line">            assemble_cross_group_rhs_recursive(g_prime,</div>
<div class="line">                                               cell_g,</div>
<div class="line">                                               cell_g_prime-&gt;child(<a class="code" href="geometry__info__0_8txt.html#a07de0b60409c551e987416d5062d2742">child</a>),</div>
<div class="line">                                               new_matrix);</div>
<div class="line">        }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">double</span> EnergyGroup&lt;dim&gt;::get_fission_source()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>  quadrature_formula(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a> = quadrature_formula.size();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                            quadrature_formula,</div>
<div class="line">                            <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;double&gt; solution_values(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> fission_source = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.active_cell_iterators())</div>
<div class="line">      {</div>
<div class="line">        fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> fission_XS =</div>
<div class="line">          material_data.get_fission_XS(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;material_id());</div>
<div class="line"> </div>
<div class="line">        fe_values.get_function_values(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, solution_values);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q_point)</div>
<div class="line">          fission_source +=</div>
<div class="line">            (fission_XS * solution_values[q_point] * fe_values.JxW(q_point));</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> fission_source;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">EnergyGroup&lt;dim&gt;::solve</a>()</div>
<div class="line">  {</div>
<div class="line">    hanging_node_constraints.condense(system_rhs);</div>
<div class="line">    <a class="code" href="namespaceMatrixTools.html#a9ad0eb7a8662628534586716748d62fb">MatrixTools::apply_boundary_values</a>(boundary_values,</div>
<div class="line">                                       system_matrix,</div>
<div class="line">                                       <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>,</div>
<div class="line">                                       system_rhs);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSolverControl.html">SolverControl</a>            solver_control(system_matrix.m(),</div>
<div class="line">                                 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-12 * system_rhs.l2_norm());</div>
<div class="line">    <a class="code" href="classSolverCG.html">SolverCG&lt;Vector&lt;double&gt;</a>&gt; cg(solver_control);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classPreconditionSSOR.html">PreconditionSSOR&lt;SparseMatrix&lt;double&gt;</a>&gt; <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>;</div>
<div class="line">    <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>.initialize(system_matrix, 1.2);</div>
<div class="line"> </div>
<div class="line">    cg.solve(system_matrix, <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, system_rhs, <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>);</div>
<div class="line"> </div>
<div class="line">    hanging_node_constraints.distribute(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> EnergyGroup&lt;dim&gt;::estimate_errors(<a class="code" href="classVector.html">Vector&lt;float&gt;</a> &amp;error_indicators)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="classKellyErrorEstimator.html#aa0917e696d4f8ddb983223a68c512357">KellyErrorEstimator&lt;dim&gt;::estimate</a>(</div>
<div class="line">      dof_handler,</div>
<div class="line">      <a class="code" href="classQGauss.html">QGauss&lt;dim - 1&gt;</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1),</div>
<div class="line">      <a class="code" href="mapping__fe__0_8txt.html#a0af9c36aca1d2fa34a8615b4521ad4de">std::map</a>&lt;<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">types::boundary_id</a>, <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> *&gt;(),</div>
<div class="line">      <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>,</div>
<div class="line">      error_indicators);</div>
<div class="line">    error_indicators /= <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.linfty_norm();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> EnergyGroup&lt;dim&gt;::refine_grid(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;float&gt;</a> &amp;error_indicators,</div>
<div class="line">                                     <span class="keyword">const</span> <span class="keywordtype">double</span>         refine_threshold,</div>
<div class="line">                                     <span class="keyword">const</span> <span class="keywordtype">double</span>         coarsen_threshold)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.active_cell_iterators())</div>
<div class="line">      <span class="keywordflow">if</span> (error_indicators(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;active_cell_index()) &gt; refine_threshold)</div>
<div class="line">        <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;set_refine_flag();</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (error_indicators(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;active_cell_index()) &lt; coarsen_threshold)</div>
<div class="line">        <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;set_coarsen_flag();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSolutionTransfer.html">SolutionTransfer&lt;dim&gt;</a> soltrans(dof_handler);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.prepare_coarsening_and_refinement();</div>
<div class="line">    soltrans.prepare_for_coarsening_and_refinement(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.execute_coarsening_and_refinement();</div>
<div class="line">    dof_handler.distribute_dofs(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
<div class="line">    setup_linear_system();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.reinit(dof_handler.n_dofs());</div>
<div class="line">    soltrans.interpolate(solution_old, <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line">    hanging_node_constraints.distribute(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line">    solution_old.reinit(dof_handler.n_dofs());</div>
<div class="line">    solution_old = <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> EnergyGroup&lt;dim&gt;::output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keyword">const</span> std::string filename = std::string(<span class="stringliteral">&quot;solution-&quot;</span>) +</div>
<div class="line">                                 <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, 2) + <span class="stringliteral">&quot;.&quot;</span> +</div>
<div class="line">                                 <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>, 2) + <span class="stringliteral">&quot;.vtu&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line"> </div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">attach_dof_handler</a>(dof_handler);</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, <span class="stringliteral">&quot;solution&quot;</span>);</div>
<div class="line">    data_out.<a class="code" href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">build_patches</a>();</div>
<div class="line"> </div>
<div class="line">    std::ofstream <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>(filename);</div>
<div class="line">    data_out.<a class="code" href="classDataOutInterface.html#a93c780f93105e0daaa76c6c43694b4ae">write_vtu</a>(<a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span><a class="code" href="classStep28_1_1NeutronDiffusionProblem.html">NeutronDiffusionProblem</a></div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">class </span>Parameters</div>
<div class="line">    {</div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">      Parameters();</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">      <span class="keywordtype">void</span>        get_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_groups;</div>
<div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_refinement_cycles;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">double</span> convergence_tolerance;</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classStep28_1_1NeutronDiffusionProblem.html">NeutronDiffusionProblem</a>(<span class="keyword">const</span> Parameters &amp;<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">run</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> initialize_problem();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> refine_grid();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> get_total_fission_source() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> Parameters &amp; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>;</div>
<div class="line">    <span class="keyword">const</span> MaterialData material_data;</div>
<div class="line">    <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a>          <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> k_eff;</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;std::unique_ptr&lt;EnergyGroup&lt;dim&gt;&gt;&gt; energy_groups;</div>
<div class="line"> </div>
<div class="line">    std::ofstream convergence_table_stream;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <a class="code" href="classStep28_1_1NeutronDiffusionProblem.html">NeutronDiffusionProblem&lt;dim&gt;::Parameters::Parameters</a>()</div>
<div class="line">    : n_groups(2)</div>
<div class="line">    , n_refinement_cycles(5)</div>
<div class="line">    , <a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>(2)</div>
<div class="line">    , convergence_tolerance(1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-12)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">NeutronDiffusionProblem&lt;dim&gt;::Parameters::declare_parameters</a>(</div>
<div class="line">    <a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Number of energy groups&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;The number of energy different groups considered&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Refinement cycles&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;5&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Number of refinement cycles to be performed&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Finite element degree&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Polynomial degree of the finite element to be used&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(</div>
<div class="line">      <span class="stringliteral">&quot;Power iteration tolerance&quot;</span>,</div>
<div class="line">      <span class="stringliteral">&quot;1e-12&quot;</span>,</div>
<div class="line">      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">      <span class="stringliteral">&quot;Inner power iterations are stopped when the change in k_eff falls &quot;</span></div>
<div class="line">      <span class="stringliteral">&quot;below this tolerance&quot;</span>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep28_1_1NeutronDiffusionProblem.html">NeutronDiffusionProblem&lt;dim&gt;::Parameters::get_parameters</a>(</div>
<div class="line">    <a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">  {</div>
<div class="line">    n_groups              = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Number of energy groups&quot;</span>);</div>
<div class="line">    n_refinement_cycles   = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Refinement cycles&quot;</span>);</div>
<div class="line">    <a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>             = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Finite element degree&quot;</span>);</div>
<div class="line">    convergence_tolerance = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Power iteration tolerance&quot;</span>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <a class="code" href="classStep28_1_1NeutronDiffusionProblem.html">NeutronDiffusionProblem&lt;dim&gt;::NeutronDiffusionProblem</a>(</div>
<div class="line">    <span class="keyword">const</span> Parameters &amp;<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>)</div>
<div class="line">    : <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>)</div>
<div class="line">    , material_data(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups)</div>
<div class="line">    , <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.<a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>)</div>
<div class="line">    , k_eff(std::numeric_limits&lt;<a class="code" href="hdf5__0_8txt.html#aae153b86de45d3354cd3edd5b992435e">double</a>&gt;::quiet_NaN())</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep28_1_1NeutronDiffusionProblem.html">NeutronDiffusionProblem&lt;dim&gt;::initialize_problem</a>()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rods_per_assembly_x = 17, rods_per_assembly_y = 17;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>       pin_pitch_x = 1.26, pin_pitch_y = 1.26;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>       assembly_height = 200;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> assemblies_x = 2, assemblies_y = 2, assemblies_z = 1;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> bottom_left = <a class="code" href="classPoint.html">Point&lt;dim&gt;</a>();</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> upper_right =</div>
<div class="line">      (<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> == 2 ? <a class="code" href="classPoint.html">Point&lt;dim&gt;</a>(assemblies_x * rods_per_assembly_x * pin_pitch_x,</div>
<div class="line">                             assemblies_y * rods_per_assembly_y * pin_pitch_y) :</div>
<div class="line">                  <a class="code" href="classPoint.html">Point</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;(assemblies_x * rods_per_assembly_x * pin_pitch_x,</div>
<div class="line">                             assemblies_y * rods_per_assembly_y * pin_pitch_y,</div>
<div class="line">                             assemblies_z * assembly_height));</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;unsigned int&gt; <a class="code" href="data__out__base__0_8txt.html#a292e9ce72a5d87dfef124355ac0fdd32">n_subdivisions</a>;</div>
<div class="line">    <a class="code" href="data__out__base__0_8txt.html#a292e9ce72a5d87dfef124355ac0fdd32">n_subdivisions</a>.push_back(assemblies_x * rods_per_assembly_x);</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> &gt;= 2)</div>
<div class="line">      <a class="code" href="data__out__base__0_8txt.html#a292e9ce72a5d87dfef124355ac0fdd32">n_subdivisions</a>.push_back(assemblies_y * rods_per_assembly_y);</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> &gt;= 3)</div>
<div class="line">      <a class="code" href="data__out__base__0_8txt.html#a292e9ce72a5d87dfef124355ac0fdd32">n_subdivisions</a>.push_back(assemblies_z);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> coarse_grid;</div>
<div class="line">    <a class="code" href="namespaceGridGenerator.html#ac76417d7404b75cf53c732f456e6e971">GridGenerator::subdivided_hyper_rectangle</a>(</div>
<div class="line">      coarse_grid, <a class="code" href="data__out__base__0_8txt.html#a292e9ce72a5d87dfef124355ac0fdd32">n_subdivisions</a>, bottom_left, upper_right, <span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_assemblies = 4;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> assembly_materials</div>
<div class="line">      [n_assemblies][rods_per_assembly_x][rods_per_assembly_y] = {</div>
<div class="line">        {{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 5, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 5, 1, 1, 5, 1, 1, 7, 1, 1, 5, 1, 1, 5, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 5, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 5, 1, 1, 5, 1, 1, 5, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}},</div>
<div class="line">        {{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 8, 1, 1, 1, 1, 1, 1, 1, 1, 1, 8, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 8, 1, 1, 8, 1, 1, 7, 1, 1, 8, 1, 1, 8, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 8, 1, 1, 1, 1, 1, 1, 1, 1, 1, 8, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 8, 1, 1, 8, 1, 1, 8, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},</div>
<div class="line">         {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}},</div>
<div class="line">        {{2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2},</div>
<div class="line">         {2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2},</div>
<div class="line">         {2, 3, 3, 3, 3, 5, 3, 3, 5, 3, 3, 5, 3, 3, 3, 3, 2},</div>
<div class="line">         {2, 3, 3, 5, 3, 4, 4, 4, 4, 4, 4, 4, 3, 5, 3, 3, 2},</div>
<div class="line">         {2, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 3, 2},</div>
<div class="line">         {2, 3, 5, 4, 4, 5, 4, 4, 5, 4, 4, 5, 4, 4, 5, 3, 2},</div>
<div class="line">         {2, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 2},</div>
<div class="line">         {2, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 2},</div>
<div class="line">         {2, 3, 5, 4, 4, 5, 4, 4, 7, 4, 4, 5, 4, 4, 5, 3, 2},</div>
<div class="line">         {2, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 2},</div>
<div class="line">         {2, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 2},</div>
<div class="line">         {2, 3, 5, 4, 4, 5, 4, 4, 5, 4, 4, 5, 4, 4, 5, 3, 2},</div>
<div class="line">         {2, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 3, 2},</div>
<div class="line">         {2, 3, 3, 5, 3, 4, 4, 4, 4, 4, 4, 4, 3, 5, 3, 3, 2},</div>
<div class="line">         {2, 3, 3, 3, 3, 5, 3, 3, 5, 3, 3, 5, 3, 3, 3, 3, 2},</div>
<div class="line">         {2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2},</div>
<div class="line">         {2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2}},</div>
<div class="line">        {{6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},</div>
<div class="line">         {6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6}}};</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> core[assemblies_x][assemblies_y][assemblies_z] = {</div>
<div class="line">      {{0}, {2}}, {{2}, {0}}};</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : coarse_grid.<a class="code" href="group__CPP11.html#ga4288670ae5bd80367e24918d542cb2d8">active_cell_iterators</a>())</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> cell_center = <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;center();</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tmp_x = <a class="code" href="table__handler__0_8txt.html#aa02519610f643695a6a4f66c4062392a">int</a>(cell_center[0] / pin_pitch_x);</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ax    = tmp_x / rods_per_assembly_x;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cx    = tmp_x - ax * rods_per_assembly_x;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span>     tmp_y = <a class="code" href="table__handler__0_8txt.html#aa02519610f643695a6a4f66c4062392a">int</a>(cell_center[1] / pin_pitch_y);</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ay    = tmp_y / rods_per_assembly_y;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cy    = tmp_y - ay * rods_per_assembly_y;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> az =</div>
<div class="line">          (<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> == 2 ? 0 : <a class="code" href="table__handler__0_8txt.html#aa02519610f643695a6a4f66c4062392a">int</a>(cell_center[<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> - 1] / assembly_height));</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(ax &lt; assemblies_x, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(ay &lt; assemblies_y, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(az &lt; assemblies_z, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(core[ax][ay][az] &lt; n_assemblies, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(cx &lt; rods_per_assembly_x, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(cy &lt; rods_per_assembly_y, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;set_material_id(assembly_materials[core[ax][ay][az]][cx][cy] - 1);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">      energy_groups.emplace_back(std::make_unique&lt;EnergyGroup&lt;dim&gt;&gt;(</div>
<div class="line">        <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>, material_data, coarse_grid, <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>));</div>
<div class="line">    convergence_table_stream.open(<span class="stringliteral">&quot;convergence_table&quot;</span>);</div>
<div class="line">    convergence_table_stream.precision(12);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">double</span> <a class="code" href="classStep28_1_1NeutronDiffusionProblem.html">NeutronDiffusionProblem&lt;dim&gt;::get_total_fission_source</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    std::vector&lt;double&gt;  fission_sources(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups);</div>
<div class="line">    <a class="code" href="classThreads_1_1TaskGroup.html">Threads::TaskGroup&lt;&gt;</a> <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a>;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">      <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a> += Threads::new_task&lt;&gt;([&amp;, <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]() {</div>
<div class="line">        fission_sources[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>] = energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;get_fission_source();</div>
<div class="line">      });</div>
<div class="line">    <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a>.join_all();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> std::accumulate(fission_sources.begin(), fission_sources.end(), 0.0);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep28_1_1NeutronDiffusionProblem.html">NeutronDiffusionProblem&lt;dim&gt;::refine_grid</a>()</div>
<div class="line">  {</div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">      <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>] = energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>();</div>
<div class="line"> </div>
<div class="line">    BlockVector&lt;float&gt; group_error_indicators(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>);</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classThreads_1_1TaskGroup.html">Threads::TaskGroup&lt;&gt;</a> <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a>;</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">        <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a> += <a class="code" href="group__threads.html#ga664740f5d3f738649ac2811f8d656d11">Threads::new_task</a>([&amp;, <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]() {</div>
<div class="line">          energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;estimate_errors(</div>
<div class="line">            group_error_indicators.block(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>));</div>
<div class="line">        });</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">float</span> max_error         = group_error_indicators.linfty_norm();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">float</span> refine_threshold  = 0.3 * max_error;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">float</span> coarsen_threshold = 0.01 * max_error;</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classThreads_1_1TaskGroup.html">Threads::TaskGroup&lt;void&gt;</a> <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a>;</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">        <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a> += <a class="code" href="group__threads.html#ga664740f5d3f738649ac2811f8d656d11">Threads::new_task</a>([&amp;, <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]() {</div>
<div class="line">          energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;refine_grid(group_error_indicators.block(<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>),</div>
<div class="line">                                            refine_threshold,</div>
<div class="line">                                            coarsen_threshold);</div>
<div class="line">        });</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">NeutronDiffusionProblem&lt;dim&gt;::run</a>()</div>
<div class="line">  {</div>
<div class="line">    boost::io::ios_flags_saver restore_flags(std::cout);</div>
<div class="line">    std::cout &lt;&lt; std::setprecision(12) &lt;&lt; <a class="code" href="reordering__0_8txt.html#aeae12ef6560114f41bf3f5cccf586727">std::fixed</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> k_eff_old = 0.0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> = 0; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_refinement_cycles;</div>
<div class="line">         ++<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classTimer.html">Timer</a> timer;</div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Cycle &quot;</span> &lt;&lt; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> == 0)</div>
<div class="line">          {</div>
<div class="line">            initialize_problem();</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">              energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;setup_linear_system();</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          {</div>
<div class="line">            refine_grid();</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">              energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a> *= k_eff;</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;   Numbers of active cells:       &quot;</span>;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">          std::cout &lt;&lt; energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>() &lt;&lt; <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line">        std::cout &lt;&lt; std::endl;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;   Numbers of degrees of freedom: &quot;</span>;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">          std::cout &lt;&lt; energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;n_dofs() &lt;&lt; <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line">        std::cout &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classThreads_1_1TaskGroup.html">Threads::TaskGroup&lt;&gt;</a> <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a>;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">          <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a> += <a class="code" href="group__threads.html#ga664740f5d3f738649ac2811f8d656d11">Threads::new_task</a>(</div>
<div class="line">            [&amp;, <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]() { energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;assemble_system_matrix(); });</div>
<div class="line">        <a class="code" href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a>.join_all();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">double</span>       <a class="code" href="parsed__convergence__table__0_8txt.html#aa2b5a089b26d5eb6842e77a0320440b0">error</a>;</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="preconditioners__0_8txt.html#abebc9af399f7664771e26564a49c8dc1">iteration</a> = 1;</div>
<div class="line">        <span class="keywordflow">do</span></div>
<div class="line">          {</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">              {</div>
<div class="line">                energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;assemble_ingroup_rhs(</div>
<div class="line">                  <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>());</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bgroup = 0; bgroup &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups;</div>
<div class="line">                     ++bgroup)</div>
<div class="line">                  energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;assemble_cross_group_rhs(</div>
<div class="line">                    *energy_groups[bgroup]);</div>
<div class="line"> </div>
<div class="line">                energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;solve();</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            k_eff = get_total_fission_source();</div>
<div class="line">            <a class="code" href="parsed__convergence__table__0_8txt.html#aa2b5a089b26d5eb6842e77a0320440b0">error</a> = <a class="code" href="base_2vectorization_8h.html#aafbdfdd72b6cfe4eae5fa7a16385582f">std::abs</a>(k_eff - k_eff_old) / <a class="code" href="base_2vectorization_8h.html#aafbdfdd72b6cfe4eae5fa7a16385582f">std::abs</a>(k_eff);</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> flux_ratio = energy_groups[0]-&gt;solution.linfty_norm() /</div>
<div class="line">                                      energy_groups[1]-&gt;solution.linfty_norm();</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> max_thermal = energy_groups[1]-&gt;solution.linfty_norm();</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Iter number:&quot;</span> &lt;&lt; std::setw(2) &lt;&lt; <a class="code" href="reordering__0_8txt.html#abc892651c0b2805d80c1933e2fb51c1a">std::right</a></div>
<div class="line">                      &lt;&lt; <a class="code" href="preconditioners__0_8txt.html#abebc9af399f7664771e26564a49c8dc1">iteration</a> &lt;&lt; <span class="stringliteral">&quot; k_eff=&quot;</span> &lt;&lt; k_eff</div>
<div class="line">                      &lt;&lt; <span class="stringliteral">&quot; flux_ratio=&quot;</span> &lt;&lt; flux_ratio</div>
<div class="line">                      &lt;&lt; <span class="stringliteral">&quot; max_thermal=&quot;</span> &lt;&lt; max_thermal &lt;&lt; std::endl;</div>
<div class="line">            k_eff_old = k_eff;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">              {</div>
<div class="line">                energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;solution_old =</div>
<div class="line">                  energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;solution;</div>
<div class="line">                energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;solution_old /= k_eff;</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            ++<a class="code" href="preconditioners__0_8txt.html#abebc9af399f7664771e26564a49c8dc1">iteration</a>;</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">while</span> ((<a class="code" href="parsed__convergence__table__0_8txt.html#aa2b5a089b26d5eb6842e77a0320440b0">error</a> &gt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.convergence_tolerance) &amp;&amp; (<a class="code" href="preconditioners__0_8txt.html#abebc9af399f7664771e26564a49c8dc1">iteration</a> &lt; 500));</div>
<div class="line">        convergence_table_stream &lt;&lt; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; energy_groups[0]-&gt;n_dofs()</div>
<div class="line">                                 &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; energy_groups[1]-&gt;n_dofs() &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">                                 &lt;&lt; k_eff &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">                                 &lt;&lt; energy_groups[0]-&gt;<a class="code" href="classMultigrid.html#a1f7cde7c4b4637535d07938226012952">solution</a>.linfty_norm() /</div>
<div class="line">                                      energy_groups[1]-&gt;solution.linfty_norm()</div>
<div class="line">                                 &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> = 0; <a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.n_groups; ++<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>)</div>
<div class="line">          energy_groups[<a class="code" href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a>]-&gt;output_results(<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>);</div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; std::endl;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;   Cycle=&quot;</span> &lt;&lt; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt;&lt; <span class="stringliteral">&quot;, n_dofs=&quot;</span></div>
<div class="line">                  &lt;&lt; energy_groups[0]-&gt;n_dofs() + energy_groups[1]-&gt;n_dofs()</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;,  k_eff=&quot;</span> &lt;&lt; k_eff &lt;&lt; <span class="stringliteral">&quot;, time=&quot;</span> &lt;&lt; timer.<a class="code" href="classTimer.html#a4e3933a78790d7455daff5acab3f8432">cpu_time</a>()</div>
<div class="line">                  &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Step28</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line">      <span class="keyword">using namespace </span><a class="code" href="namespaceStep28.html">Step28</a>;</div>
<div class="line"> </div>
<div class="line">      std::string filename;</div>
<div class="line">      <span class="keywordflow">if</span> (argc &lt; 2)</div>
<div class="line">        filename = <span class="stringliteral">&quot;project.prm&quot;</span>;</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        filename = argv[1];</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> = 2;</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classParameterHandler.html">ParameterHandler</a> parameter_handler;</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classStep28_1_1NeutronDiffusionProblem_1_1Parameters.html">NeutronDiffusionProblem&lt;dim&gt;::Parameters</a> <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>;</div>
<div class="line">      <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.declare_parameters(parameter_handler);</div>
<div class="line"> </div>
<div class="line">      parameter_handler.<a class="code" href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">parse_input</a>(filename);</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.get_parameters(parameter_handler);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classStep28_1_1NeutronDiffusionProblem.html">NeutronDiffusionProblem&lt;dim&gt;</a> neutron_diffusion_problem(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>);</div>
<div class="line">      neutron_diffusion_problem.run();</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (<a class="code" href="parameter__handler__0_8txt.html#ad919e2b915d8e8226aef004c2d8399a8">std::exception</a> &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p> <br  />
 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="aclassFullMatrix_html_a8219d4fa962f1b041a506221a7a15379"><div class="ttname"><a href="classFullMatrix.html#a8219d4fa962f1b041a506221a7a15379">FullMatrix::Tvmult</a></div><div class="ttdeci">void Tvmult(Vector&lt; number2 &gt; &amp;w, const Vector&lt; number2 &gt; &amp;v, const bool adding=false) const</div></div>
<div class="ttc" id="apolynomial__0_8txt_html_af1258c87f1d73d29bd17331843ac1d25"><div class="ttname"><a href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a></div><div class="ttdeci">namespace in which classes relating to the description of d polynomial spaces are declared ***Base class for all D polynomials A polynomial is represented in this class by its coefficients which are set through the constructor or by derived classes There are two paths for evaluation of polynomials One is based on the coefficients which are evaluated through the Horner scheme which is a robust general purpose scheme An alternative and more stable evaluation of high degree polynomials with roots in the unit interval is provided by a product in terms of the roots This form is available for special polynomials such as Lagrange polynomials or Legendre polynomials and used with the respective constructor To obtain this more stable evaluation form the constructor with the roots in form of a Lagrange polynomial must be used In case a manipulation is done that changes the roots the representation is switched to the coefficient form This class is a typical example of a possible template argument for the TensorProductPolynomials class **Constructor The coefficients of the polynomial are passed as and denote the i e the first element of the array denotes the constant the second the linear and so on The degree of the polynomial represented by this object is thus the number of elements in the&lt; tt &gt; coefficient&lt;/tt &gt; array minus one **Constructor creating a zero polynomial of degree *[2.x.3] *Constructor for a Lagrange polynomial and its point of evaluation The idea is to where j is the evaluation point specified as argument and the support points contain all the evaluation is based on products of the whereas the Horner scheme is used for polynomials in the coefficient form **Return the values and the derivatives of the Polynomial at point&lt; tt &gt; x&lt;/tt &gt;&lt; tt &gt; i</div><div class="ttdef"><b>Definition:</b> <a href="polynomial__0_8txt_source.html#l00024">polynomial_0.txt:24</a></div></div>
<div class="ttc" id="aclassDataOut__DoFData_html_a79cbe2f02f8dfb85026c71d783dbb703"><div class="ttname"><a href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">DataOut_DoFData::add_data_vector</a></div><div class="ttdeci">void add_data_vector(const VectorType &amp;data, const std::vector&lt; std::string &gt; &amp;names, const DataVectorType type=type_automatic, const std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt; &amp;data_component_interpretation=std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt;())</div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__out__dof__data_8h_source.html#l01096">data_out_dof_data.h:1096</a></div></div>
<div class="ttc" id="aclassFEValues_html_a21f914e63d588e2652a9514620653d77"><div class="ttname"><a href="classFEValues.html#a21f914e63d588e2652a9514620653d77">FEValues::reinit</a></div><div class="ttdeci">void reinit(const TriaIterator&lt; DoFCellAccessor&lt; dim, spacedim, level_dof_access &gt;&gt; &amp;cell)</div></div>
<div class="ttc" id="aparsed__convergence__table__0_8txt_html_aa2b5a089b26d5eb6842e77a0320440b0"><div class="ttname"><a href="parsed__convergence__table__0_8txt.html#aa2b5a089b26d5eb6842e77a0320440b0">error</a></div><div class="ttdeci">precision How many digits to use when writing the error</div><div class="ttdef"><b>Definition:</b> <a href="parsed__convergence__table__0_8txt_source.html#l00041">parsed_convergence_table_0.txt:41</a></div></div>
<div class="ttc" id="anewton__0_8txt_html_af4dc1cb00f59a52e48df46a4c205a8e6"><div class="ttname"><a href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a></div><div class="ttdeci">*Operator class performing Newton s iteration with standard step size control and adaptive matrix generation This class performs a Newton iteration up to convergence determined by control If after an update the norm of the residual has become larger then step size control is activated and the update is subsequently divided by two until the residual actually becomes depending on the tends to be this method applies an adaptive reassembling strategy Only if the reduction factor for the residual is more than receiving the applications computing the residual and solving the linear respectively **Declare the parameters applicable to Newton s method **Read the parameters in the ParameterHandler **Initialize the pointer data_out for debugging **The actual Newton iteration The initial value is in&lt; tt &gt; which also contains the result after convergence Values in&lt; tt &gt; in&lt;/tt &gt; are not used by but will be handed down to the objects **Set the maximal residual reduction allowed without triggering assembling in the next step Return the previous value **Control object for the Newton iteration **The indicating that the matrix must be assembled anew upon start **A flag used to decide how many stepsize iteration should be made Default is the original value of Enter zero here to turn off stepsize control *Controlled by&lt; tt &gt; Stepsize iterations&lt;/tt &gt; in parameter file **Threshold for re assembling matrix If the quotient of two consecutive residuals is smaller than this the system matrix is not assembled in this step *This parameter should be adjusted to the residual gain of the inner solver The default values is resulting in reassembling in every Newton step **Print update and updated solution after each step into file&lt; tt &gt; Newton_NNN&lt;/tt &gt; **Write debug output to[2.x.3] the higher the number</div><div class="ttdef"><b>Definition:</b> <a href="newton__0_8txt_source.html#l00034">newton_0.txt:34</a></div></div>
<div class="ttc" id="afe_2fe__values_8h_html"><div class="ttname"><a href="fe_2fe__values_8h.html">fe_values.h</a></div></div>
<div class="ttc" id="afe_2fe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20"><div class="ttname"><a href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a></div><div class="ttdeci">@ update_gradients</div><div class="ttdoc">Shape function gradients.</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__update__flags_8h_source.html#l00077">fe_update_flags.h:77</a></div></div>
<div class="ttc" id="adistributed__0_8txt_html_afec1b694405cadb2d251275096ad3563"><div class="ttname"><a href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a></div><div class="ttdeci">if we even only hold bytes per line in this sparsity we ll need GB for this object even if every single line is empty Of only million lines will be non for which we need MB plus whatever is necessary to store the actual column indices of nonzero entries Let s say we have a moderately complex problem with entries per for each of which we store the column index worth then we ll need bytes for each of the million lines that correspond to the degrees of freedom we for a total of GB And we ll need bytes for each of the million lines that we don t for a total of GB It is clear that this ratio doesn t become any better if we go to even higher numbers of processors *The solution to this problem is to really only use any memory at all for those parts of the linear system that we or need for some other reason For all other we must know that they but we can not set up any part of our data structure To this there exists a class called IndexSet that denotes a set of indices which we care for and for which we may have to allocate memory The data structures for sparsity patterns constraint matrices matrices and vector can be initialized with these IndexSet objects to really only care for those rows or entries that correspond to indices in the index set and not care about all others These objects will then ask how many indices exist in the set allocate memory for each one of and when you want to access data for global degree of freedom[2.x.28] you will be redirected to the result of calling[2.x.29] with index[2.x.30] instead Accessing data for elements[2.x.31] for which[2.x.32] is false will yield an error *The remaining question is how to identify the set of indices that correspond to degrees of freedom we need to worry about on each processor To this you can use the[2.x.33] function to get at all the indices a processor owns Note that this is a subset of the degrees of freedom that are defined on the locally owned one sometimes needs the set of all degrees of freedom on the locally owned subdomain as well as the adjacent ghost cells This information is provided by the[2.x.35] function ***A typical parallel application is dealing with two different kinds of parallel but there are of course different vector types that can each represent both ghosted vectors are typically used for data output</div><div class="ttdef"><b>Definition:</b> <a href="distributed__0_8txt_source.html#l00059">distributed_0.txt:59</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_aeaf3c7846747695b1f327677e3716ec5"><div class="ttname"><a href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">ParameterHandler::get_double</a></div><div class="ttdeci">double get_double(const std::string &amp;entry_name) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l01068">parameter_handler.cc:1068</a></div></div>
<div class="ttc" id="aA-headers_2utilities__0_8txt_html_ad2c1ad26b1963cfa351b79adbbf36ef6"><div class="ttname"><a href="A-headers_2utilities__0_8txt.html#ad2c1ad26b1963cfa351b79adbbf36ef6">dimensional</a></div><div class="ttdeci">****This module simply collects a number of functions and classes that provide general tools for tasks that do not usually have much to do with finite element programs in but happen to be required there just as well ******Here are a few simple classes that help in storage and viewing data For the Table templates allow to use not only arrays of but also two dimensional(rectangular) tables of arbitrary objects</div></div>
<div class="ttc" id="ahdf5__0_8txt_html_aae153b86de45d3354cd3edd5b992435e"><div class="ttname"><a href="hdf5__0_8txt.html#aae153b86de45d3354cd3edd5b992435e">double</a></div><div class="ttdeci">*Namespace containing deal II s HDF5 interface whereas writing and reading raw data in a dataset can be done independently or double</div><div class="ttdef"><b>Definition:</b> <a href="hdf5__0_8txt_source.html#l00045">hdf5_0.txt:45</a></div></div>
<div class="ttc" id="aclassSolverCG_html"><div class="ttname"><a href="classSolverCG.html">SolverCG</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2solver__cg_8h_source.html#l00088">solver_cg.h:88</a></div></div>
<div class="ttc" id="agroup__threads_html_ga664740f5d3f738649ac2811f8d656d11"><div class="ttname"><a href="group__threads.html#ga664740f5d3f738649ac2811f8d656d11">Threads::new_task</a></div><div class="ttdeci">Task&lt; RT &gt; new_task(const std::function&lt; RT()&gt; &amp;function)</div><div class="ttdef"><b>Definition:</b> <a href="base_2thread__management_8h_source.html#l01316">thread_management.h:1316</a></div></div>
<div class="ttc" id="apetsc__precondition__0_8txt_html_a41ebb2d49faa97a3d9eab4b4f13c2742"><div class="ttname"><a href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a></div><div class="ttdeci">*Base class for preconditioner classes using the PETSc functionality The classes in this hierarchy don t do a whole lot except for providing a function that sets the preconditioner and certain parameters on the preconditioning context of the solver These classes are basically here only to allow a similar interface as already used for the deal II solver and preconditioner classes Note that derived classes only provide interfaces to the relevant functionality of PETSc PETSc does not implement all preconditioners for all matrix types In particular some preconditioners are not going to work for parallel jobs such as for example the ILU preconditioner ***Constructor **Destructor **Destroys the preconditioner</div><div class="ttdef"><b>Definition:</b> <a href="petsc__precondition__0_8txt_source.html#l00002">petsc_precondition_0.txt:2</a></div></div>
<div class="ttc" id="aclassFullMatrix_html_a65a409eeef6388d99ac15e2bbe8045f6"><div class="ttname"><a href="classFullMatrix.html#a65a409eeef6388d99ac15e2bbe8045f6">FullMatrix::vmult</a></div><div class="ttdeci">void vmult(Vector&lt; number2 &gt; &amp;w, const Vector&lt; number2 &gt; &amp;v, const bool adding=false) const</div></div>
<div class="ttc" id="aA-headers_2exceptions__0_8txt_html_a8fba07b9a84b89e6be225f5f95c3e355"><div class="ttname"><a href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">run</a></div><div class="ttdeci">the program is just and one can not intelligently work around that *It is sometimes useful to change the behavior of the[2.x.6] macro from aborting a program to throwing exceptions On the other exceptions are not allowed to propagate out of destructors of classes For this there is a variant of the called[2.x.7] that can be used in destructors These use cases are discussed further down below on this page **Dynamic such as whether an output file can be written to *These are things that shouldn t be checked because it is not guaranteed that a program for which the condition is satisfied in a debug mode run</div><div class="ttdef"><b>Definition:</b> <a href="A-headers_2exceptions__0_8txt_source.html#l00022">exceptions_0.txt:22</a></div></div>
<div class="ttc" id="areordering__0_8txt_html_abc892651c0b2805d80c1933e2fb51c1a"><div class="ttname"><a href="reordering__0_8txt.html#abc892651c0b2805d80c1933e2fb51c1a">right</a></div><div class="ttdeci">if it is not then it aborts in linear time as well *Both algorithms are described in the paper On orienting edges of unstructured two and three dimensional R M W W L ACM Transactions on Mathematical A preprint is available as *[1.x.19] **Prior to the implementation of the algorithms described we used a branch and cut algorithm initially implemented in by Wolfgang Bangerth Although it is no longer here is how it and why it doesn t always work for large meshes since its run time can be exponential in bad cases *The first observation is that although there are problems are usually local For in the second example mentioned if we had numbered the cells in a way that neighboring cells have similar cell then the amount of backtracking needed is greatly reduced in the implementation of the the first step is to renumber the cells in a Cuthill McKee and so on this represents finding zones of cells consecutively further away from the initial cells and number them in this front marching way This already greatly improves locality of problems and consequently reduced the necessary amount of backtracking *The second point is that we can use some methods to prune the which usually lead to a valid orientation of all cells very quickly *The first such method is based on the observation that if we fail to insert one cell with number then this may not be due to cell N unless N is a direct neighbor of N The reason is for the latter cannot be the case if we fail to add cell then it is not necessary to track back to cell but we can track back to the neighbor of N with the largest cell index and which has already been added this method can fail to yield a valid path through the tree if not applied with care Consider the following initially extracted from a mesh of cells generated automatically by the program BAMG(this program usually generates meshes that are quite badly balanced, often have many **- sometimes 10 or more **- neighbors of one vertex, and exposed several problems in the initial algorithm;note also that the example is in 2d where we now have the much better algorithm described above, but the same observations also apply to 3d) we will therefore find no orientation of cell in which it can be added without violation of the consistency of the triangulation According to the rule stated we track back to the neighbor with greatest which is but since its bottom line is to th right)</div><div class="ttdef"><b>Definition:</b> <a href="reordering__0_8txt_source.html#l00125">reordering_0.txt:125</a></div></div>
<div class="ttc" id="aclassFE__Q_html"><div class="ttname"><a href="classFE__Q.html">FE_Q&lt; dim &gt;</a></div></div>
<div class="ttc" id="anamespaceUtilities_html_a6195c5f009ea8c7c536c6ffdf108c32f"><div class="ttname"><a href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a></div><div class="ttdeci">std::string int_to_string(const unsigned int value, const unsigned int digits=numbers::invalid_unsigned_int)</div><div class="ttdef"><b>Definition:</b> <a href="base_2utilities_8cc_source.html#l00473">utilities.cc:473</a></div></div>
<div class="ttc" id="anamespaceGridTools_html_a32a5016c746ad756046ecff264dfa60d"><div class="ttname"><a href="namespaceGridTools.html#a32a5016c746ad756046ecff264dfa60d">GridTools::get_finest_common_cells</a></div><div class="ttdeci">std::list&lt; std::pair&lt; typename MeshType::cell_iterator, typename MeshType::cell_iterator &gt; &gt; get_finest_common_cells(const MeshType &amp;mesh_1, const MeshType &amp;mesh_2)</div><div class="ttdef"><b>Definition:</b> <a href="grid__tools__dof__handlers_8cc_source.html#l01106">grid_tools_dof_handlers.cc:1106</a></div></div>
<div class="ttc" id="agrid_2grid__tools_8h_html"><div class="ttname"><a href="grid_2grid__tools_8h.html">grid_tools.h</a></div></div>
<div class="ttc" id="anamespacedealii_html"><div class="ttname"><a href="namespacedealii.html">dealii</a></div><div class="ttdef"><b>Definition:</b> <a href="doc_2doxygen_2headers_2namespace__dealii_8h_source.html#l00026">namespace_dealii.h:26</a></div></div>
<div class="ttc" id="afe_2fe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea"><div class="ttname"><a href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a></div><div class="ttdeci">@ update_values</div><div class="ttdoc">Shape function values.</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__update__flags_8h_source.html#l00070">fe_update_flags.h:70</a></div></div>
<div class="ttc" id="areordering__0_8txt_html_aeae12ef6560114f41bf3f5cccf586727"><div class="ttname"><a href="reordering__0_8txt.html#aeae12ef6560114f41bf3f5cccf586727">fixed</a></div><div class="ttdeci">it will soon be obvious that there can t exists such a even if we allow that there might be cells with clockwise and counterclockwise orientation of the lines at the same time *One might argue that the definition of unique directions for faces and and the definition of directions relative to the cells they is a misfeature of deal II In it makes reading in grids created by mesh generators rather as they usually don t follow these conventions when generating their output On the other there are good reasons to introduce such as they can make programming much simpler in many leading to an increase in speed of some computations as one can avoid expensive checks in many places because the orientation of faces is known by assumption that it is guaranteed by the triangulation *The purpose of this class is now to find an ordering for a given set of cells such that the generated triangulation satisfies all the requirements stated above To this end we will first show some examples why this is a difficult problem and then develop algorithms that finds such a reordering Note that the algorithm operates on a set of CellData objects that are used to describe a mesh to the triangulation class These objects are for example generated by the GridIn class when reading in grids from input files *As a last question for this first the answer is no(which also underlines that using such orientations might be an **- unfortunately uncurable **- misfeature of deal.II). A simple counter-example in 3d illustrates this if that is then we can stop following all paths below this point and track back immediately it is already obvious that the tree has fixed[2.x.4] leaves in two space since each of the[2.x.5] cells can be added in four orientations Most of these nodes can be discarded since firstly the orientation of the first cell is and secondly if we add one cell that has a neighbor that has already been then there are already only two possible orientations so the total number of checks we have to make until we find a valid way is significantly smaller than[2.x.6] the algorithm is still exponential in time and linear in the two examples above show that the exponential estimate is not a pessimistic University of and that for we can find an algorithm that in practice is usually only roughly linear in time and memory We will describe these algorithms in the following A full description and theoretical analysis is given in *[2.x.7] **The algorithm uses the fact that opposite faces of a cell need to have the same orientation So you start with one arbitrary choose an orientation Then the orientation of the opposite face is already fixed Then go to the two cells across the two faces we have</div><div class="ttdef"><b>Definition:</b> <a href="reordering__0_8txt_source.html#l00078">reordering_0.txt:78</a></div></div>
<div class="ttc" id="aiterators__0_8txt_html_a6cf0880ba2af3a1be4aacdbbd4b90f9c"><div class="ttname"><a href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a></div><div class="ttdeci">where BaseIterator usually is one of thestandard iterators discussed above *The FilteredIterator gets an additional Predicate in its constructor and willskip all objects where this Predicate evaluates to&lt; tt &gt; false&lt;/tt &gt; Acollection of predicates already implemented can be found in the namespaceIteratorFilters ***IteratorsLoops Iterating over objects *All iterators of the same kind and iterating over thesame kind of geometrical objects traverse the mesh in the sameorder Take this code all iterators will always point to the same mesh even though&lt; tt &gt; DoFHandler&lt;/tt &gt; and&lt; tt &gt; Triangulation&lt;/tt &gt; are very different and even if the DoFHandlers are handling different finite the difference is only in the Accessor As mentioned the order in which iterators traverse the forest ofobjects is actually well but application programs should notassume any such but rather consider this an implementation detailof the library *Corresponding to above the order in which iterators traverse activeobjects is the same for all iterators in the following the difference to the previous example being that here we only consider active but theyare really rather dumb Their magic only lies in the fact that they point tosome useful in this case the Accessor For they point to anactual object that stores some data On the other the deal II when do not return a reference to an actual but returnan object that knows how to get at the data that represents cells In thisobject doesn t store itself where the vertices of a cell are or what its neighborsare it knows how to tease this sort of information from out of thearrays and tables and lists that the Triangulation class sets up to describe amesh *Accessing data that characterizes a cell is always done through the i e the expression[2.x.10] grants access to[1.x.6] attributes of this Accessor Examples of properties you can query from aniterator are ***Since dereferencing iterators yields accessor these calls are tomember etc These in turn figure out the relevant datafrom the various data structures that store this data How this is actuallydone and what data structures are used is not really of concern to authors ofapplications in deal II In by hiding the actual data structureswe are able to store data in an efficient not necessarily in a way thatmakes it easily accessible or understandable to application writers ***IteratorsTypedefs Kinds of accessors *Depending on what sort of data you want to there are different kindsof accessor and hexes that make up a triangulation</div><div class="ttdef"><b>Definition:</b> <a href="iterators__0_8txt_source.html#l00063">iterators_0.txt:63</a></div></div>
<div class="ttc" id="aclassBlockVector_html"><div class="ttname"><a href="classBlockVector.html">BlockVector</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2block__vector_8h_source.html#l00071">block_vector.h:71</a></div></div>
<div class="ttc" id="astep-1_8cc_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdef"><b>Definition:</b> <a href="step-1_8cc_source.html#l00086">step-1.cc:86</a></div></div>
<div class="ttc" id="adata__out__base__0_8txt_html_a918b7763318d7dd4fc059a2898fe1ef6"><div class="ttname"><a href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters</a></div><div class="ttdeci">derived classes use their own type to fill in the so that&lt; tt &gt; memory_consumption&lt;/tt &gt; works correctly See the Wikipedia page on the pattern for more information ***Declare all flags with name and type as offered by this for use in input files This method does but child classes may override this method to add fields to&lt; tt &gt; prm&lt;/tt &gt; **Read the parameters declared in declare_parameters() and set the flags for this output format accordingly. This method does nothing</div></div>
<div class="ttc" id="aclassTriangulation_html"><div class="ttname"><a href="classTriangulation.html">Triangulation&lt; dim &gt;</a></div></div>
<div class="ttc" id="agrid_2tria_8h_html"><div class="ttname"><a href="grid_2tria_8h.html">tria.h</a></div></div>
<div class="ttc" id="abase_2parameter__handler_8h_html"><div class="ttname"><a href="base_2parameter__handler_8h.html">parameter_handler.h</a></div></div>
<div class="ttc" id="afe_2fe__q_8h_html"><div class="ttname"><a href="fe_2fe__q_8h.html">fe_q.h</a></div></div>
<div class="ttc" id="abase_2bounding__box__0_8txt_html_ac479118cc630e4f4c7d594789b4c6dec"><div class="ttname"><a href="base_2bounding__box__0_8txt.html#ac479118cc630e4f4c7d594789b4c6dec">volume</a></div><div class="ttdeci">*The enumerator NeighborType describes the neighboring relation between two bounding boxes ***Not in this means that the two boxes touch at one corner of the each box **Attached in this means that the two boxes touch along an edge **Mergeable e g **or one is inside the other **A class that represents a box of arbitrary dimension&lt; tt &gt; spacedim&lt;/tt &gt; and with sides parallel to the coordinate axes that is a region a bounding box is top right for useful in parallel distributed meshes to give a general description of the owners of each portion of the mesh *Taking the cross section of a BoundingBox&lt; spacedim &gt; orthogonal to a given direction gives a box in one dimension the coordinates of the cross section of BoundingBox&lt; 3 &gt; can be ordered in different ways That if we take the cross section orthogonal to the y direction we could either order a coordinate into a coordinate as[2.x.1] or as[2.x.2] This class uses the second convention corresponding to the coordinates being ordered cyclicly[2.x.3] To be if we take a cross z y *This is according to the convention set by the function *[2.x.4] **Standard constructor Creates an object that corresponds to an empty i e a degenerate box with both points being the origin **Standard constructor for non empty Number elements **Return a reference to the boundary_points **Return const a reference to the boundary_points **Test for equality **Test for inequality **Check if the current object and[2.x.5] are i e if the boxes have dimension check if their intersection is non empty Return an enumerator of type NeighborType **Enlarge the current object so that it contains[2.x.6] If the current object already contains[2.x.7] then it is not changed by this function **Return true if the point is inside the Bounding false otherwise The parameter[2.x.8] is a factor by which the bounding box is enlarged relative to the dimensions of the bounding box in order to determine in a numerically robust way whether the point is inside the lower left corner of the bounding box will have each coordinate decreased by[2.x.9] and the upper right corner of the bounding box will have each coordinate increased by[2.x.10] If you call this method with a negative and one of the axes of the original bounding box is smaller than the method will trigger an assertion **Compute the volume(i.e. the dim-dimensional measure) of the BoundingBox. *[0.x.18] *Returns the point in the center of the box. *[0.x.19] *Returns the side length of the box in[2.x.11] *[0.x.20] *Return the lower bound of the box in[2.x.12] *[0.x.21] *Return the upper bound of the box in[2.x.13] *[0.x.22] *Return the bounds of the box in[2.x.14] as a one-dimensional box. *[0.x.23] *Returns the indexth vertex of the box. Vertex is meant in the same way as for a cell</div></div>
<div class="ttc" id="aclassParameterHandler_html_a6d65f458be69e23a348221cb67fc411d"><div class="ttname"><a href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">ParameterHandler::declare_entry</a></div><div class="ttdeci">void declare_entry(const std::string &amp;entry, const std::string &amp;default_value, const Patterns::PatternBase &amp;pattern=Patterns::Anything(), const std::string &amp;documentation=&quot;&quot;, const bool has_to_be_set=false)</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00796">parameter_handler.cc:796</a></div></div>
<div class="ttc" id="ainclude_2deal_8II_2base_2utilities_8h_html"><div class="ttname"><a href="include_2deal_8II_2base_2utilities_8h.html">utilities.h</a></div></div>
<div class="ttc" id="anumerics_2error__estimator_8h_html"><div class="ttname"><a href="numerics_2error__estimator_8h.html">error_estimator.h</a></div></div>
<div class="ttc" id="abase_2timer_8h_html"><div class="ttname"><a href="base_2timer_8h.html">timer.h</a></div></div>
<div class="ttc" id="adata__out__base__0_8txt_html_a292e9ce72a5d87dfef124355ac0fdd32"><div class="ttname"><a href="data__out__base__0_8txt.html#a292e9ce72a5d87dfef124355ac0fdd32">n_subdivisions</a></div><div class="ttdeci">for&lt; tt &gt; n_subdivisions</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base__0_8txt_source.html#l00011">data_out_base_0.txt:11</a></div></div>
<div class="ttc" id="aclassSparseMatrix_html"><div class="ttname"><a href="classSparseMatrix.html">SparseMatrix&lt; double &gt;</a></div></div>
<div class="ttc" id="afunctions__0_8txt_html_a829d3b9f33556b077b89f416303f182c"><div class="ttname"><a href="functions__0_8txt.html#a829d3b9f33556b077b89f416303f182c">equations</a></div><div class="ttdeci">****Functions are used in various places in deal for example to describe boundary coefficients in equations</div><div class="ttdef"><b>Definition:</b> <a href="functions__0_8txt_source.html#l00006">functions_0.txt:6</a></div></div>
<div class="ttc" id="adistributed__0_8txt_html_aafea668ad0c451ac7a0fae0f558c36d7"><div class="ttname"><a href="distributed__0_8txt.html#aafea668ad0c451ac7a0fae0f558c36d7">cells</a></div><div class="ttdeci">in the area occupied by these artificial cells</div><div class="ttdef"><b>Definition:</b> <a href="distributed__0_8txt_source.html#l00037">distributed_0.txt:37</a></div></div>
<div class="ttc" id="aclassFunction_html_a562fc1114e95e702e6696721f71528db"><div class="ttname"><a href="classFunction.html#a562fc1114e95e702e6696721f71528db">Function::value_list</a></div><div class="ttdeci">virtual void value_list(const std::vector&lt; Point&lt; dim &gt;&gt; &amp;points, std::vector&lt; RangeNumberType &gt; &amp;values, const unsigned int component=0) const</div></div>
<div class="ttc" id="anamespaceMatrixTools_html_a9ad0eb7a8662628534586716748d62fb"><div class="ttname"><a href="namespaceMatrixTools.html#a9ad0eb7a8662628534586716748d62fb">MatrixTools::apply_boundary_values</a></div><div class="ttdeci">void apply_boundary_values(const std::map&lt; types::global_dof_index, number &gt; &amp;boundary_values, SparseMatrix&lt; number &gt; &amp;matrix, Vector&lt; number &gt; &amp;solution, Vector&lt; number &gt; &amp;right_hand_side, const bool eliminate_columns=true)</div><div class="ttdef"><b>Definition:</b> <a href="matrix__tools_8cc_source.html#l00081">matrix_tools.cc:81</a></div></div>
<div class="ttc" id="aclassDataOutInterface_html_a93c780f93105e0daaa76c6c43694b4ae"><div class="ttname"><a href="classDataOutInterface.html#a93c780f93105e0daaa76c6c43694b4ae">DataOutInterface::write_vtu</a></div><div class="ttdeci">void write_vtu(std::ostream &amp;out) const</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8cc_source.html#l07232">data_out_base.cc:7232</a></div></div>
<div class="ttc" id="aconstraints__0_8txt_html_a9132c79972fe954d265b941f34bebed9"><div class="ttname"><a href="constraints__0_8txt.html#a9132c79972fe954d265b941f34bebed9">the</a></div><div class="ttdeci">******This module deals with constraints on degrees of freedom The central class to deal with constraints is the AffineConstraints class *Constraints typically come from several for one usually enforces them by requiring that degrees of freedom on the boundary have particular for example[2.x.3] if the boundary condition[2.x.4] requires that the finite element solution[2.x.5] at the location of degree of freedom has the value Such constraints are generated by those versions of the[2.x.6] function that take a AffineConstraints for example no normal as happens in flow problems and is handled by the[2.x.11] function or prescribed tangential as happens in electromagnetic problems and is handled by the[2.x.13] function For the former imagine for example that we are at at vertex where the normal vector has the form[2.x.14] and that the[2.x.15]</div><div class="ttdef"><b>Definition:</b> <a href="constraints__0_8txt_source.html#l00020">constraints_0.txt:20</a></div></div>
<div class="ttc" id="abase_2thread__management_8h_html"><div class="ttname"><a href="base_2thread__management_8h.html">thread_management.h</a></div></div>
<div class="ttc" id="alac_2affine__constraints_8h_html"><div class="ttname"><a href="lac_2affine__constraints_8h.html">affine_constraints.h</a></div></div>
<div class="ttc" id="arefinement__0_8txt_html_a5ec35f5c4745344cf7607638e6cbcb5e"><div class="ttname"><a href="refinement__0_8txt.html#a5ec35f5c4745344cf7607638e6cbcb5e">adaptivity</a></div><div class="ttdeci">*We supply adaptive methods to align computational resources with the complexity of the numerical solution Error estimates are an appropriate means of determining where adjustments need to be made However with hp adaptivity</div><div class="ttdef"><b>Definition:</b> <a href="refinement__0_8txt_source.html#l00002">refinement_0.txt:2</a></div></div>
<div class="ttc" id="adistributed__0_8txt_html_ac2b339f054fd752a401e197097db8cfe"><div class="ttname"><a href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a></div><div class="ttdeci">********clusters ***deal II can use multiple machines connected via MPI to parallelize in addition to the parallelization within a shared memory machine discussed in the[2.x.4] module There are essentially two ways to utilize multiple but only a share of the global sparsity and solution vector is stored on each machine ****The mesh and DoF handler are also i e each processor stores only a share of the cells and degrees of freedom No processor has knowledge of the entire or solution</div><div class="ttdef"><b>Definition:</b> <a href="distributed__0_8txt_source.html#l00025">distributed_0.txt:25</a></div></div>
<div class="ttc" id="aparameter__handler__0_8txt_html_ad919e2b915d8e8226aef004c2d8399a8"><div class="ttname"><a href="parameter__handler__0_8txt.html#ad919e2b915d8e8226aef004c2d8399a8">exception</a></div><div class="ttdeci">since default values may change in the process of program you cannot know the values of parameters not specified in the input file ****It is often convenient to have something happen as soon as a parameter value is read This could be a check that it is valid that a file that is listed in the parameter file exists **or to initiate something else in such as setting a variable outside the this action could also be initiated once all parameters are read via but it is sometimes[1.x.19] to do it right away *This is facilitated by the and can then do whatever they want with it **e save it somewhere outside the ParameterHandler in C one doesn t usually pass around the address of a but an action can be a function like object(taking a string as argument) that results from calling such as a[1.x.20] that has the form **[1.x.21] *and that is attached to a specific parameter. *A typical example of such an action would be as follows the content of the file equals the default value of the parameter the contents of files are never changed after declaration of a parameter a directory in this file system may not have a file called[2.x.20] in it In that the directory represents a subsection as declared and the directory s name will correspond to the name of the subsection It will then have no files in it at but it may have further directories in the code above will lead to a hierarchical representation of data that looks like this(the content of files is indicated at the right in a different font) this is only used when creating output for exceptions If non empty[2.x.35] is the ParameterHandler object will stop parsing lines after encountering[2.x.36] This is handy when adding extra data that shall be parsed manually If[2.x.37] the parameter handler will skip undefined sections and entries This is useful for partially parsing a parameter for example to obtain only the spatial dimension of the problem By default all entries and subsections are expected to be declared The function sets the value of all parameters it encounters in the input file to the provided value Parameters not explicitly listed in the input file are left at the value they previously which will be the default value provided to and for each parameter all associated actions that may previously have been set by or if an associated action throws an exception</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler__0_8txt_source.html#l00241">parameter_handler_0.txt:241</a></div></div>
<div class="ttc" id="aclassMultigrid_html_a1f7cde7c4b4637535d07938226012952"><div class="ttname"><a href="classMultigrid.html#a1f7cde7c4b4637535d07938226012952">Multigrid::solution</a></div><div class="ttdeci">MGLevelObject&lt; VectorType &gt; solution</div><div class="ttdef"><b>Definition:</b> <a href="multigrid_2multigrid_8h_source.html#l00394">multigrid.h:394</a></div></div>
<div class="ttc" id="aclassDataOut__DoFData_html_a6ed7c846331069f406b8c9933c37fda4"><div class="ttname"><a href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">DataOut_DoFData::attach_dof_handler</a></div><div class="ttdeci">void attach_dof_handler(const DoFHandler&lt; dim, spacedim &gt; &amp;)</div></div>
<div class="ttc" id="aclassDoFHandler_html"><div class="ttname"><a href="classDoFHandler.html">DoFHandler</a></div><div class="ttdef"><b>Definition:</b> <a href="dofs_2dof__handler_8h_source.html#l00266">dof_handler.h:266</a></div></div>
<div class="ttc" id="aclassTable_html"><div class="ttname"><a href="classTable.html">Table&lt; 2, double &gt;</a></div></div>
<div class="ttc" id="agroup__constraints_html_ga3b4ea7dfd313e388d868c4e4aa685799"><div class="ttname"><a href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a></div><div class="ttdeci">void make_hanging_node_constraints(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, AffineConstraints&lt; number &gt; &amp;constraints)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools__constraints_8cc_source.html#l01787">dof_tools_constraints.cc:1787</a></div></div>
<div class="ttc" id="aclassFEValues_html"><div class="ttname"><a href="classFEValues.html">FEValues&lt; dim &gt;</a></div></div>
<div class="ttc" id="atrilinos__precondition__0_8txt_html_ae2e38e4f182c566122b10d662b9d3f89"><div class="ttname"><a href="trilinos__precondition__0_8txt.html#ae2e38e4f182c566122b10d662b9d3f89">tolerance</a></div><div class="ttdeci">more required fill in elements require this parameter to be set to a higher integer value The AdditionalData data structure allows to set preconditioner options Besides the fill in these options are some options for and a parameter&lt; tt &gt; overlap&lt;/tt &gt; that determines if and how much overlap there should be between the matrix partitions on the various MPI processes The default settings are for the additional fill for the absolute augmentation tolerance</div><div class="ttdef"><b>Definition:</b> <a href="trilinos__precondition__0_8txt_source.html#l00174">trilinos_precondition_0.txt:174</a></div></div>
<div class="ttc" id="afe_2fe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a"><div class="ttname"><a href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a></div><div class="ttdeci">@ update_quadrature_points</div><div class="ttdoc">Transformed quadrature points.</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__update__flags_8h_source.html#l00116">fe_update_flags.h:116</a></div></div>
<div class="ttc" id="aclassFiniteElementData_html_a2cbf5ad6b464871261dbd054bced18a8"><div class="ttname"><a href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">FiniteElementData::degree</a></div><div class="ttdeci">const unsigned int degree</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__base_8h_source.html#l00428">fe_base.h:428</a></div></div>
<div class="ttc" id="aclassTimer_html"><div class="ttname"><a href="classTimer.html">Timer</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2timer_8h_source.html#l00130">timer.h:130</a></div></div>
<div class="ttc" id="anamespaceinternal_1_1TriangulationImplementation_html_a3344398031a9e10cb9eef0784f8da1be"><div class="ttname"><a href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">internal::TriangulationImplementation::n_active_cells</a></div><div class="ttdeci">unsigned int n_active_cells(const internal::TriangulationImplementation::NumberCache&lt; 1 &gt; &amp;c)</div><div class="ttdef"><b>Definition:</b> <a href="grid_2tria_8cc_source.html#l12595">tria.cc:12595</a></div></div>
<div class="ttc" id="anumerics_2vector__tools_8h_html"><div class="ttname"><a href="numerics_2vector__tools_8h.html">vector_tools.h</a></div></div>
<div class="ttc" id="abase_2function_8h_html"><div class="ttname"><a href="base_2function_8h.html">function.h</a></div></div>
<div class="ttc" id="amultithreading__0_8txt_html_a33468e75b7ea6d2e64b7e88c6ff1217a"><div class="ttname"><a href="multithreading__0_8txt.html#a33468e75b7ea6d2e64b7e88c6ff1217a">of</a></div><div class="ttdeci">namespace are implemented the way they are More information on their implementation can be found in the[2.x.72] WorkStream paper To see the WorkStream class used in practice on tasks like the ones outlined above take a look at or[2.x.78] tutorial programs *To begin given the brief description the way the[2.x.79] function could then be written is like this(note that this is not quite the correct syntax, as will be described below) we recycle these objects after they have been used by[2.x.101] and feed them back into another instance of[2.x.102]</div><div class="ttdef"><b>Definition:</b> <a href="multithreading__0_8txt_source.html#l00171">multithreading_0.txt:171</a></div></div>
<div class="ttc" id="anamespacetypes_html_aaf4eb6ec214fa642dfd956f11a9cd2d7"><div class="ttname"><a href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">types::boundary_id</a></div><div class="ttdeci">unsigned int boundary_id</div><div class="ttdef"><b>Definition:</b> <a href="base_2types_8h_source.html#l00117">types.h:117</a></div></div>
<div class="ttc" id="anumerics_2solution__transfer_8h_html"><div class="ttname"><a href="numerics_2solution__transfer_8h.html">solution_transfer.h</a></div></div>
<div class="ttc" id="aauto__derivative__function__0_8txt_html_af5d8dd2d035de856717fb6b5c9438dd5"><div class="ttname"><a href="auto__derivative__function__0_8txt.html#af5d8dd2d035de856717fb6b5c9438dd5">h</a></div><div class="ttdeci">*This class automatically computes the gradient of a function by employing numerical difference quotients This only if the user function does not provide the gradient function himself *The following example of an user defined function overloads and implements only the where the latter function employs numerical difference quotients *****If the user overloads and implements also the gradient of the users gradient function is called that the usage of the also applies to the see e g respectively *Furthermore that an object of this class does[1.x.1] represent the derivative of a like that gives a directional derivative by calling the this class the AutoDerivativeFunction class can substitute the Function class as base class for user defined classes This class implements the gradient() functions for automatic computation of numerical difference quotients and serves as intermediate class between the base Function class and the user defined function class. ***[2.x.2] **[0.x.1] *Names of difference formulas. *[0.x.2] *The symmetric Euler formula of second order absolutely necessary in this case **Choose the difference formula See the enum DifferenceFormula for available choices **Takes the difference step size&lt; tt &gt; h&lt;/tt &gt; It s within the user s responsibility to choose an appropriate value here&lt; tt &gt; h&lt;/tt &gt; should be chosen taking into account the absolute value of as well as the amount of variation of the function Setting&lt; tt &gt; h</div><div class="ttdef"><b>Definition:</b> <a href="auto__derivative__function__0_8txt_source.html#l00034">auto_derivative_function_0.txt:34</a></div></div>
<div class="ttc" id="akinsol__0_8txt_html_a2dde6fcf1c80bd5999147ad9c92e81b2"><div class="ttname"><a href="kinsol__0_8txt.html#a2dde6fcf1c80bd5999147ad9c92e81b2">year</a></div><div class="ttdeci">**Additional parameters that can be passed to the KINSOL class **KINSOL solution strategy KINSOL includes a Newton Krylov solver(both local and global) as well as Picard and fixed point solvers. *[0.x.3] *Standard Newton iteration. *[0.x.4] *Newton iteration with linesearch. *[0.x.5] *Fixed point iteration. *[0.x.6] *Picard iteration. *[0.x.7] *Initialization parameters for KINSOL. Global parameters the computation will be aborted and an assertion will be thrown **A function object that users may supply and that is intended to prepare the linear solver for subsequent calls to in the solution of linear systems[2.x.78] The exact nature of this system depends on the SolutionStrategy that has been selected In the cases and this function is never called The or a function within the linear solver to compute Jacobian related data that is required by the linear solver It may also preprocess that data as needed for which may involve calling a generic more build preconditioners from the assembled Jacobian In any the data so generated may then be used whenever a linear system is solved The point of this function is that but only as frequently as the solver determines that it is appropriate to perform the setup task In this Jacobian related data generated by thereby saving the effort to regenerate the Jacobian matrix and a preconditioner for it whenever possible[2.x.87] current_u Current value of[2.x.88][2.x.89] current_f Current value of[2.x.90] or[2.x.91] This function should then KINSOL does not call on the internal KINSOL convergence tests then KINSOL calls then only a fixed point iteration strategy can be used Notice that this may not or may converge very slowly A call to this function should store in dst the result of[2.x.93] applied to i J this[2.x.96] vector is generally denoted by[2.x.97][2.x.98] fcur The current value of the implicit right hand side at rhs The system right hand side to solve for[2.x.101] dst The solution of[2.x.102] This function should SUNDIALS no longer provides the ycur and fcur variables **only rhs is provided and dst needs to be returned The first two arguments will therefore be empty vectors in that case In that means that one can no longer compute a Jacobian matrix for the current iterate within this function this has to happen inside the setup_jacobian function above that receives this information If it is important that the Jacobian corresponds to thecurrent then you will also have to set the[2.x.104] variable to indicating that the Jacobian should be re computed in every iteration **A function object that users may supply and that is intended to solve a linear system with the Jacobian matrix This function will be called by then KINSOL does not call on the internal KINSOL convergence tests then KINSOL calls then only a fixed point iteration strategy can be used Notice that this may not or may converge very slowly A call to this function should store in dst the result of[2.x.105] applied to i J indicating that it is not necessary to solve the linear system with the Jacobian matrix but only to a tolerance that KINSOL will adapt over time Arguments to the function and it is used only if implemented The intent for this scaling factor is for problems in which the different components of a solution have vastly different numerical magnitudes **typically because they have different physical units and represent different things For if one were to solve a nonlinear Stokes the solution vector has components that correspond to velocities and other components that correspond to pressures These have different physical units and depending on which units one they may have roughly comparable numerical sizes or maybe they don t To give just one in simulations of flow in the Earth s one has velocities on the order of maybe ten centimeters per year</div><div class="ttdef"><b>Definition:</b> <a href="kinsol__0_8txt_source.html#l00628">kinsol_0.txt:628</a></div></div>
<div class="ttc" id="aclassKellyErrorEstimator_html_aa0917e696d4f8ddb983223a68c512357"><div class="ttname"><a href="classKellyErrorEstimator.html#aa0917e696d4f8ddb983223a68c512357">KellyErrorEstimator::estimate</a></div><div class="ttdeci">static void estimate(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const Quadrature&lt; dim - 1 &gt; &amp;quadrature, const std::map&lt; types::boundary_id, const Function&lt; spacedim, typename InputVector::value_type &gt; * &gt; &amp;neumann_bc, const InputVector &amp;solution, Vector&lt; float &gt; &amp;error, const ComponentMask &amp;component_mask=ComponentMask(), const Function&lt; spacedim &gt; *coefficients=nullptr, const unsigned int n_threads=numbers::invalid_unsigned_int, const types::subdomain_id subdomain_id=numbers::invalid_subdomain_id, const types::material_id material_id=numbers::invalid_material_id, const Strategy strategy=cell_diameter_over_24)</div></div>
<div class="ttc" id="anumerics_2matrix__tools_8h_html"><div class="ttname"><a href="numerics_2matrix__tools_8h.html">matrix_tools.h</a></div></div>
<div class="ttc" id="amapping__fe__0_8txt_html_a0af9c36aca1d2fa34a8615b4521ad4de"><div class="ttname"><a href="mapping__fe__0_8txt.html#a0af9c36aca1d2fa34a8615b4521ad4de">map</a></div><div class="ttdeci">where is the first fundamental form of the map</div><div class="ttdef"><b>Definition:</b> <a href="mapping__fe__0_8txt_source.html#l00084">mapping_fe_0.txt:84</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga0d685aad996180f9851183ae3e29019a"><div class="ttname"><a href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">StandardExceptions::ExcIndexRange</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcIndexRange(int arg1, int arg2, int arg3)</div></div>
<div class="ttc" id="agroup__constraints_html_gaf78e864edbfba7e0a7477457bfb96b26"><div class="ttname"><a href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a></div><div class="ttdeci">void make_sparsity_pattern(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, SparsityPatternType &amp;sparsity_pattern, const AffineConstraints&lt; number &gt; &amp;constraints=AffineConstraints&lt; number &gt;(), const bool keep_constrained_dofs=true, const types::subdomain_id subdomain_id=numbers::invalid_subdomain_id)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools__sparsity_8cc_source.html#l00064">dof_tools_sparsity.cc:64</a></div></div>
<div class="ttc" id="avector__tools__point__value__0_8txt_html_ac7a5c2ceb5c739d5b51cc7e0eee8100a"><div class="ttname"><a href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a></div><div class="ttdeci">*Assembling of right hand sides **Create a right hand side vector for a point source at point[2.x.1] In other it creates a vector[2.x.2] so that[2.x.3] where[2.x.4] are the shape functions described by[2.x.5] and[2.x.6] is the point at which the delta function is located Prior content of the given[2.x.7] vector is deleted This function is for the case of a scalar finite element This function is typically used in one of these two with different values for right hand sides or and then evaluate the solution at the same point every time You could do this by calling[2.x.8] after each solve</div><div class="ttdef"><b>Definition:</b> <a href="vector__tools__point__value__0_8txt_source.html#l00015">vector_tools_point_value_0.txt:15</a></div></div>
<div class="ttc" id="alac_2dynamic__sparsity__pattern_8h_html"><div class="ttname"><a href="lac_2dynamic__sparsity__pattern_8h.html">dynamic_sparsity_pattern.h</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_gae9a45f517af1401c50811a11083f9114"><div class="ttname"><a href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">StandardExceptions::ExcMessage</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcMessage(std::string arg1)</div></div>
<div class="ttc" id="aclassParameterHandler_html_a61fa98fdc0c52980a5b1de0ee1fc5bb2"><div class="ttname"><a href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">ParameterHandler::get_integer</a></div><div class="ttdeci">long int get_integer(const std::string &amp;entry_string) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l01025">parameter_handler.cc:1025</a></div></div>
<div class="ttc" id="anamespaceGridGenerator_html_ac76417d7404b75cf53c732f456e6e971"><div class="ttname"><a href="namespaceGridGenerator.html#ac76417d7404b75cf53c732f456e6e971">GridGenerator::subdivided_hyper_rectangle</a></div><div class="ttdeci">void subdivided_hyper_rectangle(Triangulation&lt; dim, spacedim &gt; &amp;tria, const std::vector&lt; unsigned int &gt; &amp;repetitions, const Point&lt; dim &gt; &amp;p1, const Point&lt; dim &gt; &amp;p2, const bool colorize=false)</div></div>
<div class="ttc" id="aclassDataOut_html_a087f63e22f0614bca326dbdca288c646"><div class="ttname"><a href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">DataOut::build_patches</a></div><div class="ttdeci">virtual void build_patches(const unsigned int n_subdivisions=0)</div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__out_8cc_source.html#l01071">data_out.cc:1071</a></div></div>
<div class="ttc" id="ageodynamics__0_8txt_html_a3cea336457392f6beb5acb191c9f4c4b"><div class="ttname"><a href="geodynamics__0_8txt.html#a3cea336457392f6beb5acb191c9f4c4b">Bangerth</a></div><div class="ttdeci">***deal II s[2.x.1] tutorial contains a set of programs that togetherform the geodynamics demonstration suite The idea of these programs is todemonstrate techniques for advanced finite element software usingapplications from i e the investigation of processes in thesolid earth By doing these programs are supposed to provide a basisfor more dedicated programs that can solve actual for example as part of the work of graduate students orpostdocs A more thorough discussion of the motivation for these programsfollows below the geodynamics testsuite contains the the first of the grants that fundedthe[1.x.0] initiative The Wolfgang Bangerth</div><div class="ttdef"><b>Definition:</b> <a href="geodynamics__0_8txt_source.html#l00019">geodynamics_0.txt:19</a></div></div>
<div class="ttc" id="aclassSolutionTransfer_html"><div class="ttname"><a href="classSolutionTransfer.html">SolutionTransfer</a></div><div class="ttdef"><b>Definition:</b> <a href="numerics_2solution__transfer_8h_source.html#l00277">solution_transfer.h:277</a></div></div>
<div class="ttc" id="ageometry__info__0_8txt_html_a30a552b07accf65da90f851e25d14d1c"><div class="ttname"><a href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a></div><div class="ttdeci">3, where it offers following possibilities:a face(quad) being refined in x- or y-direction(in the face-intern coordinate system) separately,([2.x.79] or([2.x.80] which corresponds to([2.x.81]). Additionally, it offers the possibilities a face can have through repeated anisotropic refinement steps performed on one of the two neighboring cells. It might be possible for example, that a face(quad) is refined with[2.x.82] and afterwards the left child is again refined with[2.x.83], so that there are three active subfaces. Note, however, that only refinement cases are allowed such that each line on a face between two hexes has not more than one hanging node. Furthermore, it is not allowed that two neighboring hexes are refined such that one of the hexes refines the common face with[2.x.84] and the other hex refines that face with[2.x.85] . In fact,[2.x.86] takes care of this situation and ensures that each face of a refined cell is completely contained in a single face of neighboring cells. The following drawings explain the SubfacePossibilities and give the corresponding subface numbers:*[1.x.4] **[2.x.87] *[0.x.68] *Possible cases of faces being subdivided into subface. See documentation to the SubfacePossibilities&lt; 3 &gt; for more details on the subface possibilities. *[0.x.69] *A class that provides all possible cases a face(in the current space dimension[2.x.88] might be subdivided into subfaces. *[2.x.89] *[0.x.70] *Constructor. Take and store a value indicating a particular subface possibility in the list of possible situations specified in the base class. *[0.x.71] *Return the numeric value stored by this class. While the presence of this operator might seem dangerous, it is useful in cases where one would like to have code like&lt; code &gt;switch(subface_case)... case[2.x.90] ...&lt;/code &gt;, which can be written as&lt; code &gt;switch[2.x.91] Another application is to use an object of the current type as an index into an array dim</div><div class="ttdef"><b>Definition:</b> <a href="geometry__info__0_8txt_source.html#l00202">geometry_info_0.txt:202</a></div></div>
<div class="ttc" id="acoding__conventions__0_8txt_html_a69730bc7f91dd1be17fd083a66514e73"><div class="ttname"><a href="coding__conventions__0_8txt.html#a69730bc7f91dd1be17fd083a66514e73">freedom</a></div><div class="ttdeci">their purpose is merely to keepdeal II as uniform as possible Uniformity reduces the number of bugs weproduce because we for always assume that input arguments comebefore output arguments of a function call They also simplify reading codebecause some things become clear already by looking at the style a piece ofcode is without having to look up the exact definition of something **deal II uses[2.x.2] to normalize indentation Astyle file is provided at ***Before a you should run **on each of your files This will make sure indentation is conforming to thestyle guidelines outlined in this page *This is cumbersome and more you can just run **in whatever directory you set up the library to be compiled to indent allsource files that have been changed recently If you want to make sure thatthe indenting is correct for all your you might want to set up apre commit hook One way to do is to copy[2.x.4] to[2.x.5] and make sure it isexecutable *If the system you are working on has more than one version of[2.x.6] degrees of freedom</div><div class="ttdef"><b>Definition:</b> <a href="coding__conventions__0_8txt_source.html#l00018">coding_conventions_0.txt:18</a></div></div>
<div class="ttc" id="atable__handler__0_8txt_html_aa02519610f643695a6a4f66c4062392a"><div class="ttname"><a href="table__handler__0_8txt.html#aa02519610f643695a6a4f66c4062392a">int</a></div><div class="ttdeci">*A&lt; tt &gt; TableEntry&lt;/tt &gt; stores the value of a table entry It can either be of type int</div><div class="ttdef"><b>Definition:</b> <a href="table__handler__0_8txt_source.html#l00002">table_handler_0.txt:2</a></div></div>
<div class="ttc" id="atrilinos__sparse__matrix__0_8txt_html_ab4e34663c28496ee1b07f40fd5d00fa1"><div class="ttname"><a href="trilinos__sparse__matrix__0_8txt.html#ab4e34663c28496ee1b07f40fd5d00fa1">sparsity_pattern</a></div><div class="ttdeci">all column elements of a row are stored on the same processor in any case The vector&lt; tt &gt; n_entries_per_row&lt;/tt &gt; specifies the number of entries in each row of the newly generated matrix **This function is initializes the Trilinos Epetra matrix according to the specified sparsity_pattern</div><div class="ttdef"><b>Definition:</b> <a href="trilinos__sparse__matrix__0_8txt_source.html#l00162">trilinos_sparse_matrix_0.txt:162</a></div></div>
<div class="ttc" id="alac_2sparsity__pattern_8h_html"><div class="ttname"><a href="lac_2sparsity__pattern_8h.html">sparsity_pattern.h</a></div></div>
<div class="ttc" id="aclassDynamicSparsityPattern_html"><div class="ttname"><a href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2dynamic__sparsity__pattern_8h_source.html#l00340">dynamic_sparsity_pattern.h:340</a></div></div>
<div class="ttc" id="aA-headers_2fe__0_8txt_html_ad2c0ca424f5f96a4133eda9a4ebf209b"><div class="ttname"><a href="A-headers_2fe__0_8txt.html#ad2c0ca424f5f96a4133eda9a4ebf209b">group</a></div><div class="ttdeci">if one wants to pick individual there are extractor classes that make this task as described in the[2.x.9] module *The last member of this group</div><div class="ttdef"><b>Definition:</b> <a href="A-headers_2fe__0_8txt_source.html#l00034">fe_0.txt:34</a></div></div>
<div class="ttc" id="aclassSparsityPattern_html"><div class="ttname"><a href="classSparsityPattern.html">SparsityPattern</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2sparsity__pattern_8h_source.html#l00900">sparsity_pattern.h:900</a></div></div>
<div class="ttc" id="aclassStep28_1_1NeutronDiffusionProblem_html"><div class="ttname"><a href="classStep28_1_1NeutronDiffusionProblem.html">Step28::NeutronDiffusionProblem</a></div><div class="ttdef"><b>Definition:</b> <a href="step-28_8cc_source.html#l00751">step-28.cc:751</a></div></div>
<div class="ttc" id="anamespaceVectorTools_html_ab2562d41bb26f362043f9719a8cd9b87"><div class="ttname"><a href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a></div><div class="ttdeci">void interpolate_boundary_values(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const std::map&lt; types::boundary_id, const Function&lt; spacedim, number &gt; * &gt; &amp;function_map, std::map&lt; types::global_dof_index, number &gt; &amp;boundary_values, const ComponentMask &amp;component_mask=ComponentMask())</div></div>
<div class="ttc" id="aclassStep28_1_1NeutronDiffusionProblem_1_1Parameters_html"><div class="ttname"><a href="classStep28_1_1NeutronDiffusionProblem_1_1Parameters.html">Step28::NeutronDiffusionProblem::Parameters</a></div><div class="ttdef"><b>Definition:</b> <a href="step-28_8cc_source.html#l00754">step-28.cc:754</a></div></div>
<div class="ttc" id="adofs_2dof__tools_8h_html"><div class="ttname"><a href="dofs_2dof__tools_8h.html">dof_tools.h</a></div></div>
<div class="ttc" id="agrid_2grid__refinement_8h_html"><div class="ttname"><a href="grid_2grid__refinement_8h.html">grid_refinement.h</a></div></div>
<div class="ttc" id="alac_2precondition_8h_html"><div class="ttname"><a href="lac_2precondition_8h.html">precondition.h</a></div></div>
<div class="ttc" id="agrid_2grid__out_8h_html"><div class="ttname"><a href="grid_2grid__out_8h.html">grid_out.h</a></div></div>
<div class="ttc" id="aclassFiniteElement_html"><div class="ttname"><a href="classFiniteElement.html">FiniteElement&lt; dim &gt;</a></div></div>
<div class="ttc" id="aA-headers_2exceptions__0_8txt_html_a602682024ec652b990be121b5665f8ce"><div class="ttname"><a href="A-headers_2exceptions__0_8txt.html#a602682024ec652b990be121b5665f8ce">set</a></div><div class="ttdeci">&lt;/tt &gt; **If the&lt; tt &gt;&lt;/tt &gt; preprocessor directive is set</div><div class="ttdef"><b>Definition:</b> <a href="A-headers_2exceptions__0_8txt_source.html#l00031">exceptions_0.txt:31</a></div></div>
<div class="ttc" id="aadvection__0_8txt_html_a79a3cbbb7583dd309bf1b14dc20895b6"><div class="ttname"><a href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a></div><div class="ttdeci">**its DG formulations All advection operators depend on an advection velocity denoted by[1.x.0] in the formulas below It is denoted as&lt; tt &gt; velocity&lt;/tt &gt; in the parameter lists The functions cell_matrix() and both upwind_value_matrix() are taking the equation in weak form</div></div>
<div class="ttc" id="aclassQGauss_html"><div class="ttname"><a href="classQGauss.html">QGauss</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2quadrature__lib_8h_source.html#l00039">quadrature_lib.h:39</a></div></div>
<div class="ttc" id="apolynomial__space__0_8txt_html_a03a2f48682e29e39f7bccc11a7d1c4d1"><div class="ttname"><a href="polynomial__space__0_8txt.html#a03a2f48682e29e39f7bccc11a7d1c4d1">degree</a></div><div class="ttdeci">*Representation of the space of polynomials of degree at most n in higher dimensions *Given a vector of[1.x.0] one dimensional polynomials[1.x.1] where[1.x.3] has degree[1.x.4]</div><div class="ttdef"><b>Definition:</b> <a href="polynomial__space__0_8txt_source.html#l00003">polynomial_space_0.txt:3</a></div></div>
<div class="ttc" id="abase_2quadrature__lib_8h_html"><div class="ttname"><a href="base_2quadrature__lib_8h.html">quadrature_lib.h</a></div></div>
<div class="ttc" id="aautomatic__and__symbolic__differentiation__0_8txt_html_a96ecfde131843f52ee49d0e0c1180134"><div class="ttname"><a href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a></div><div class="ttdeci">computing derivatives of these terms is impractical in most applications in impossible to get right Higher derivatives are even more impossible to do without computer aid Automatic or symbolic differentiation is a way out of and gets compile time</div><div class="ttdef"><b>Definition:</b> <a href="automatic__and__symbolic__differentiation__0_8txt_source.html#l00012">automatic_and_symbolic_differentiation_0.txt:12</a></div></div>
<div class="ttc" id="afe__evaluation__0_8txt_html_a8f384576a64c89a6fa8352847523e340"><div class="ttname"><a href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a></div><div class="ttdeci">FE_Q with hanging node constraints connects to more neighbors than a FE_DGQ for and cells which need data exchange are put in different positions inside the cell loop Of if the exact same and then the order is going to be the same because the algorithm is deterministic *dim Dimension in which this class is to be used *fe_degree Degree of the tensor product finite element with fe_degree degrees of freedom per coordinate direction Can be set to **if the degree is not known at compile but performance will usually be worse by a factor of *n_q_points_1d Number of points in the quadrature formula defaults to fe_degree *n_components Number of vector components when solving a system of PDEs If the same operation is applied to several components of a they can be applied simultaneously with one usually[2.x.339] or[2.x.340] Defaults to[2.x.341] double ******An alias to the base class **An underlying number type specified as template argument **The type of function e g VectorizedArrayType for e g Tensor&lt; 1, dim, VectorizedArrayType &gt; for n_q_points</div><div class="ttdef"><b>Definition:</b> <a href="fe__evaluation__0_8txt_source.html#l00537">fe_evaluation_0.txt:537</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga31978c026b8b6b5116df30b8e748f6b7"><div class="ttname"><a href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">StandardExceptions::ExcInternalError</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcInternalError()</div></div>
<div class="ttc" id="adistributed__0_8txt_html_ac4c845555bda24566ddc584532b7fa57"><div class="ttname"><a href="distributed__0_8txt.html#ac4c845555bda24566ddc584532b7fa57">element</a></div><div class="ttdeci">see C J T ***The DoFHandler class builds on the Triangulation class but it can detect whenever we actually use an object of type[2.x.22] as triangulation In that it assigns global numbers for all degrees of freedom that given a finite element</div><div class="ttdef"><b>Definition:</b> <a href="distributed__0_8txt_source.html#l00046">distributed_0.txt:46</a></div></div>
<div class="ttc" id="aclassAffineConstraints_html"><div class="ttname"><a href="classAffineConstraints.html">AffineConstraints&lt; double &gt;</a></div></div>
<div class="ttc" id="anamespaceStep28_html"><div class="ttname"><a href="namespaceStep28.html">Step28</a></div><div class="ttdef"><b>Definition:</b> <a href="step-28_8cc_source.html#l00069">step-28.cc:69</a></div></div>
<div class="ttc" id="anamespacetypes_html_afb65af4be8a9a1d09a0c3ecc967c9d4c"><div class="ttname"><a href="namespacetypes.html#afb65af4be8a9a1d09a0c3ecc967c9d4c">types::material_id</a></div><div class="ttdeci">unsigned int material_id</div><div class="ttdef"><b>Definition:</b> <a href="base_2types_8h_source.html#l00129">types.h:129</a></div></div>
<div class="ttc" id="afe_2fe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85"><div class="ttname"><a href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a></div><div class="ttdeci">@ update_JxW_values</div><div class="ttdoc">Transformed quadrature weights.</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__update__flags_8h_source.html#l00124">fe_update_flags.h:124</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga70a0bb353656e704acf927945277bbc6"><div class="ttname"><a href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a></div><div class="ttdeci">#define Assert(cond, exc)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2exceptions_8h_source.html#l01581">exceptions.h:1581</a></div></div>
<div class="ttc" id="aclassTimer_html_a4e3933a78790d7455daff5acab3f8432"><div class="ttname"><a href="classTimer.html#a4e3933a78790d7455daff5acab3f8432">Timer::cpu_time</a></div><div class="ttdeci">double cpu_time() const</div><div class="ttdef"><b>Definition:</b> <a href="timer_8cc_source.html#l00236">timer.cc:236</a></div></div>
<div class="ttc" id="alac_2block__vector_8h_html"><div class="ttname"><a href="lac_2block__vector_8h.html">block_vector.h</a></div></div>
<div class="ttc" id="aautomatic__and__symbolic__differentiation__0_8txt_html_a680d8b0d6d9162296d224196cfd47028"><div class="ttname"><a href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a></div><div class="ttdeci">and situations where one is given a parameter dependent problem[2.x.4] and wants to form derivatives with regards to the parameters[2.x.5]</div><div class="ttdef"><b>Definition:</b> <a href="automatic__and__symbolic__differentiation__0_8txt_source.html#l00010">automatic_and_symbolic_differentiation_0.txt:10</a></div></div>
<div class="ttc" id="ablock__sparse__matrix__ez__0_8txt_html_af734f4df74ac4822dd99a6cca7203600"><div class="ttname"><a href="block__sparse__matrix__ez__0_8txt.html#af734f4df74ac4822dd99a6cca7203600">m</a></div><div class="ttdeci">Matrix1 *[2.x.1] **A block matrix consisting of blocks of type SparseMatrixEZ *Like the other Block this matrix can be used like a when it comes to access to entries there are functions for the multiplication with BlockVector and access to the individual blocks the block s must be empty **Copy this operation is only allowed if the actual value to be assigned is zero This in order to be able to relay global indices into the matrix to indices into the subobjects Youmust *call this function each time after you have changed the size of the sub objects **Access the block with the given coordinates **Access the block with the given coordinates Version for constant objects **Return the number of blocks in a column **Return the number of blocks in a row **Return whether the object is empty It is empty if no memory is which is the same as that both dimensions are zero This function is just the concatenation of the respective call to all sub matrices **Return number of rows of this which equals the dimension of the which equals the dimension of the domain space It is the sum of the number of columns over the sub matrix blocks of this matrix Recall that the matrix is of size m() times n(). *[0.x.18] *Set the element&lt; tt &gt;(i</div></div>
<div class="ttc" id="alac_2full__matrix_8h_html"><div class="ttname"><a href="lac_2full__matrix_8h.html">full_matrix.h</a></div></div>
<div class="ttc" id="alac_2solver__cg_8h_html"><div class="ttname"><a href="lac_2solver__cg_8h.html">solver_cg.h</a></div></div>
<div class="ttc" id="afe__q__0_8txt_html_a1a8eaafa20c4d8c9ab128b62a984738c"><div class="ttname"><a href="fe__q__0_8txt.html#a1a8eaafa20c4d8c9ab128b62a984738c">degrees</a></div><div class="ttdeci">*Implementation of a scalar Lagrange finite element[2.x.0] that yields the finite element space of piecewise polynomials of degree[2.x.1] in each coordinate direction This class is realized using tensor product polynomials based on D Lagrange polynomials with Gauss or given support points *The standard constructor of this class takes the degree[2.x.2] of this finite element it can take a quadrature formula[2.x.3] defining the support points of the Lagrange interpolation in one coordinate direction *For more information about the&lt; tt &gt; spacedim&lt;/tt &gt; template parameter check the documentation of FiniteElement or the one of Triangulation **The constructor creates a TensorProductPolynomials object that includes the tensor product of[2.x.4] polynomials of degree[2.x.5] This[2.x.6] object provides all values and derivatives of the shape functions In case a quadrature rule is the constructor creates a TensorProductPolynomials object that includes the tensor product of[2.x.7] polynomials with the support points from *[2.x.8] Furthermore the constructor fills the[2.x.9] the[2.x.10] equidistant support points at i where one polynomial is one and all the others are zero For higher polynomial degrees</div><div class="ttdef"><b>Definition:</b> <a href="fe__q__0_8txt_source.html#l00009">fe_q_0.txt:9</a></div></div>
<div class="ttc" id="adofs_2dof__handler_8h_html"><div class="ttname"><a href="dofs_2dof__handler_8h.html">dof_handler.h</a></div></div>
<div class="ttc" id="aclassThreads_1_1TaskGroup_html"><div class="ttname"><a href="classThreads_1_1TaskGroup.html">Threads::TaskGroup</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2thread__management_8h_source.html#l01472">thread_management.h:1472</a></div></div>
<div class="ttc" id="ageometry__info__0_8txt_html_a07de0b60409c551e987416d5062d2742"><div class="ttname"><a href="geometry__info__0_8txt.html#a07de0b60409c551e987416d5062d2742">child</a></div><div class="ttdeci">i&lt; vertices_per_face;++i)&lt;/tt &gt;, at least if[2.x.97] is an&lt; tt &gt;unsigned int&lt;/tt &gt;. *[0.x.86] *Number of lines each face has. *[0.x.87] *Number of quads on each face. *[0.x.88] *Number of lines of a cell. *[0.x.89] *Number of quadrilaterals of a cell. *[0.x.90] *Number of hexahedra of a cell. *[0.x.91] *Rearrange vertices for UCD output. For a cell being written in UCD format, each entry in this field contains the number of a vertex in&lt; tt &gt;deal.II&lt;/tt &gt; that corresponds to the UCD numbering at this location. Typical example:write a cell and arrange the vertices, such that UCD understands them. *[1.x.7] *As the vertex numbering in deal.II versions&lt;=5.1 happened to coincide with the UCD numbering, this field can also be used like a old_to_lexicographic mapping. *[0.x.92] *Rearrange vertices for OpenDX output. For a cell being written in OpenDX format, each entry in this field contains the number of a vertex in&lt; tt &gt;deal.II&lt;/tt &gt; that corresponds to the DX numbering at this location. Typical example:write a cell and arrange the vertices, such that OpenDX understands them. *[1.x.8] **[0.x.93] *This class provides dimension independent information to all topological structures that make up the unit, or[2.x.98] &quot;reference cell&quot;. This class has been superseded by the ReferenceCell class **- see there for more information.**It is the one central point in the library where information about the numbering of vertices, lines, or faces of the reference cell is collected. Consequently, the information of this class is used extensively in the geometric description of Triangulation objects, as well as in various other parts of the code. In particular, it also serves as the focus of writing code in a dimension independent way;for example, instead of writing a loop over vertices 0&lt;=v&lt; 4 in 2d, one would write it as[2.x.99] thus allowing the code to work in 3d as well without changes.*The most frequently used parts of the class are its static members like vertices_per_cell, faces_per_cell, etc. However, the class also offers information about more abstract questions like the orientation of faces, etc. The following documentation gives a textual description of many of these concepts.**[1.x.9] *From version 5.2 onwards deal.II is based on a numbering scheme that uses a lexicographic ordering(with x running fastest) wherever possible, hence trying to adopt a kind of 'canonical' ordering.*The ordering of vertices and faces(lines) in 2d is defined by ****- Vertices are numbered in lexicographic ordering ****- Faces(lines in 2d):first the two faces with normals in x- and then y-direction. For each two faces:first the face with normal in negative coordinate direction, then the one with normal in positive direction, i.e. the faces are ordered according to their normals pointing in **-, x, **-, y direction.****- The direction of a line is represented by the direction of point 0 towards point 1 and is always in one of the coordinate directions ****- Face lines in 3d are ordered, such that the induced 2d local coordinate system(x, y) implies(right hand rule) a normal in face normal direction, see N2/.*The resulting numbering of vertices and faces(lines) in 2d as well as the directions of lines is shown in the following.**[1.x.10] **Note that the orientation of lines has to be correct upon construction of a grid;however, it is automatically preserved upon refinement.*Further we define that child lines have the same direction as their parent, i.e. that&lt; tt &gt;line-&gt;child(0) -&gt;vertex(0)==line-&gt;vertex(0)&lt;/tt &gt; and&lt; tt &gt;line-&gt; child(1) -&gt; vertex(1)==line-&gt;vertex(1)&lt;/tt &gt;. This also implies, that the first sub-line(&lt; tt &gt;line-&gt;child(0)&lt;/tt &gt;) is the one at vertex(0) of the old line. *Similarly we define, that the four children of a quad are adjacent to the vertex with the same number of the old quad. *Note that information about several of these conventions can be extracted at run- or compile-time from the member functions and variables of the present class. **[1.x.11] *When explicit coordinates are required for points in a cell(e.g for quadrature formulae or the point of definition of trial functions), we define the following coordinate system for the unit cell:**[1.x.12] **Here, vertex 0 is the origin of the coordinate system, vertex 1 has coordinates&lt; tt &gt;(1, 0)&lt;/tt &gt;, vertex 2 at&lt; tt &gt;(0, 1)&lt;/tt &gt; and vertex 3 at&lt; tt &gt;(1, 1)&lt;/tt &gt;. The[2.x.100] function can be used to query this information at run-time. **[1.x.13] *By convention, we will use the following numbering conventions for vertices, lines and faces of hexahedra in three space dimensions. Before giving these conventions we declare the following sketch to be the standard way of drawing 3d pictures of hexahedra:**[1.x.14] *The left part of the picture shows the left, bottom and back face of the cube, while the right one shall be the top, right and front face. You may recover the whole cube by moving the two parts together into one. *Note again that information about several of the following conventions can be extracted at run- or compile-time from the member functions and variables of the present class. *[1.x.15] *The ordering of vertices in 3d is defined by the same rules as in the 2d case. In particular, the following is still true:****- Vertices are numbered in lexicographic ordering. *Hence, the vertices are numbered as follows **[1.x.16] **We note, that first the vertices on the bottom face(z=0) are numbered exactly the same way as are the vertices on a quadrilateral. Then the vertices on the top face(z</div></div>
<div class="ttc" id="astep-69_8cc_html_a66a64d07b4db87c87b639bdcf7b18c82"><div class="ttname"><a href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a></div><div class="ttdeci">std::vector&lt; types::global_dof_index &gt; local_dof_indices</div><div class="ttdef"><b>Definition:</b> <a href="step-69_8cc_source.html#l00534">step-69.cc:534</a></div></div>
<div class="ttc" id="alac_2vector_8h_html"><div class="ttname"><a href="lac_2vector_8h.html">vector.h</a></div></div>
<div class="ttc" id="aclassFullMatrix_html_a21b873fcd180999ad0d268c3278a71ec"><div class="ttname"><a href="classFullMatrix.html#a21b873fcd180999ad0d268c3278a71ec">FullMatrix::mmult</a></div><div class="ttdeci">void mmult(FullMatrix&lt; number2 &gt; &amp;C, const FullMatrix&lt; number2 &gt; &amp;B, const bool adding=false) const</div></div>
<div class="ttc" id="aclassPoint_html"><div class="ttname"><a href="classPoint.html">Point&lt; dim &gt;</a></div></div>
<div class="ttc" id="apreconditioners__0_8txt_html_abebc9af399f7664771e26564a49c8dc1"><div class="ttname"><a href="preconditioners__0_8txt.html#abebc9af399f7664771e26564a49c8dc1">iteration</a></div><div class="ttdeci">*****Preconditioners are used to accelerate the iterative solution of linear systems Typical preconditioners are Gauss or but the library also supports more complex ones such as Vanka or incomplete LU sparse direct solvers can be used as preconditioners when available *Broadly preconditioners are which are multiplied with a matrix to improve conditioning The idea that the preconditioned system[1.x.1] is much easier to solve than the original system[1.x.2] What this means exactly depends on the structure of the matrix and cannot be discussed here in generality For positive definite matrices[1.x.3] it means that the spectral condition Richardson iteration</div><div class="ttdef"><b>Definition:</b> <a href="preconditioners__0_8txt_source.html#l00009">preconditioners_0.txt:9</a></div></div>
<div class="ttc" id="aclassFunctions_1_1ZeroFunction_html"><div class="ttname"><a href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2function_8h_source.html#l00516">function.h:516</a></div></div>
<div class="ttc" id="afe__evaluation__0_8txt_html_ad3b9cdeadeb3bcdb52af5db70c041a6e"><div class="ttname"><a href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a></div><div class="ttdeci">FE_Q with hanging node constraints connects to more neighbors than a FE_DGQ for and cells which need data exchange are put in different positions inside the cell loop Of if the exact same and then the order is going to be the same because the algorithm is deterministic *dim Dimension in which this class is to be used *fe_degree Degree of the tensor product finite element with fe_degree degrees of freedom per coordinate direction Can be set to **if the degree is not known at compile but performance will usually be worse by a factor of *n_q_points_1d Number of points in the quadrature formula defaults to fe_degree *n_components Number of vector components when solving a system of PDEs If the same operation is applied to several components of a they can be applied simultaneously with one usually[2.x.339] or[2.x.340] Defaults to[2.x.341] double ******An alias to the base class **An underlying number type specified as template argument **The type of function e g VectorizedArrayType for e g Tensor&lt; 1, dim, VectorizedArrayType &gt; for can be different if such as FE_DGP **static The number of degrees of freedom of all components determined from the given template argument fe_degree Note that the actual number of degrees of freedom dofs_per_cell can be different if such as FE_DGP **static The number of degrees of freedom of all components determined from the given template argument fe_degree Note that the actual number of degrees of freedom dofs_per_cell can be different if such as FE_DGP **Constructor Takes all data stored in MatrixFree If applied to problems with more than one finite element or more than one quadrature formula selected during construction of[2.x.343] the appropriate component can be selected by the optional arguments[2.x.344] matrix_free Data object that contains all data[2.x.345] dof_no If matrix_free was set up with multiple DoFHandler this parameter selects to which DoFHandler AffineConstraints pair the given evaluator should be attached to[2.x.346] quad_no If matrix_free was set up with multiple Quadrature this parameter selects the appropriate number of the quadrature formula[2.x.347] first_selected_component If the dof_handler selected by dof_no uses an FESystem consisting of more than one this parameter allows for selecting the component where the current evaluation routine should start Note that one evaluator does not support combining different shape functions in different components In other the same base element of a FESystem needs to be set for the components between[2.x.348] and[2.x.349][2.x.350] active_fe_index If matrix_free was set up with DoFHandler objects with[2.x.351] this parameter selects to which DoFHandler AffineConstraints pair the given evaluator should be attached to[2.x.352] active_quad_index If matrix_free was set up with[2.x.353] this parameter selects the appropriate number of the quadrature formula **Constructor Takes all data stored in MatrixFree for a given cell which allows to automatically identify the active_fe_index and active_quad_index in case of a p adaptive strategy The rest of the arguments are the same as in the constructor above **Constructor that comes with reduced functionality and works similar as FEValues The arguments are similar to the ones passed to the constructor of with the notable difference that FEEvaluation expects a one dimensional quadrature instead of a[2.x.354] dimensional one The finite element can be both scalar or vector but this method always only selects a scalar base element at a the optional argument[2.x.356] allows to specify the index of the base element to be used for evaluation Note that the internal data structures always assume that the base element is non primitive are not supported currently As known from a call to the reinit method with a[2.x.357] is necessary to make the geometry and degrees of freedom of the current class known::If the iterator includes DoFHandler the initialization allows to also read from or write to vectors in the standard way for[2.x.359] types for one cell at a time this approach is much slower than the path with MatrixFree with MPI since index translation has to be done As only one cell at a time is this method does not vectorize over several but only possibly within the element if the evaluate integrate routines are combined inside user an object of type i the underlying mapping and quadrature points do only need to be evaluated once Make sure to not pass an optional object around when you intend to use the FEEvaluation object in parallel to the given one because otherwise the intended sharing may create race conditions **Copy constructor If FEEvaluationBase was constructed from a fe</div><div class="ttdef"><b>Definition:</b> <a href="fe__evaluation__0_8txt_source.html#l00555">fe_evaluation_0.txt:555</a></div></div>
<div class="ttc" id="aclassParameterHandler_html"><div class="ttname"><a href="classParameterHandler.html">ParameterHandler</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2parameter__handler_8h_source.html#l00820">parameter_handler.h:820</a></div></div>
<div class="ttc" id="aautomatic__and__symbolic__differentiation__0_8txt_html_acce0a318676405d57af6ef0f5cbe4ec3"><div class="ttname"><a href="automatic__and__symbolic__differentiation__0_8txt.html#acce0a318676405d57af6ef0f5cbe4ec3">and</a></div><div class="ttdeci">computing derivatives of these terms is impractical in most applications and</div><div class="ttdef"><b>Definition:</b> <a href="automatic__and__symbolic__differentiation__0_8txt_source.html#l00012">automatic_and_symbolic_differentiation_0.txt:12</a></div></div>
<div class="ttc" id="aclassPreconditionSSOR_html"><div class="ttname"><a href="classPreconditionSSOR.html">PreconditionSSOR</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2precondition_8h_source.html#l00699">precondition.h:699</a></div></div>
<div class="ttc" id="aclassFullMatrix_html"><div class="ttname"><a href="classFullMatrix.html">FullMatrix&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassFunction_html"><div class="ttname"><a href="classFunction.html">Function&lt; dim &gt;</a></div></div>
<div class="ttc" id="acoding__conventions__0_8txt_html_ac639e1db0b03fc797eca55e266afa976"><div class="ttname"><a href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a></div><div class="ttdeci">functions which clear bits or flags should be named[2.x.15] use[2.x.18] instead of *[2.x.19] In the implementation after each three empty lines are expected to enable better readability One empty line occurs in functions to group blocks of since two empty lines are not enough to visibly distinguish sufficiently that the code belongs to two different functions *[2.x.21] Whenever an integer variable can only assume nonnegative it is marked as unsigned The same applies to functions that can only return positive or zero values it should be marked even if passed by value we mark input parameters as const This aids as an additional documentation tool to clarify the intent of a which is often either involuntarily or poor style *[2.x.25] Whenever a function does not change any of the member variable of the embedding class it should be marked as const  *[2.x.27] Function and variable names may not consist of only one or two unless the variable is a pure counting index *[2.x.29] Type the number of children per cell</div><div class="ttdef"><b>Definition:</b> <a href="coding__conventions__0_8txt_source.html#l00027">coding_conventions_0.txt:27</a></div></div>
<div class="ttc" id="amultithreading__0_8txt_html_a3eb2ad97e22e5edf45cbc97570908143"><div class="ttname"><a href="multithreading__0_8txt.html#a3eb2ad97e22e5edf45cbc97570908143">tasks</a></div><div class="ttdeci">if only one is the scheduler would first completely execute task before doing or the other way around This model is able to execute much more efficiently in particular if a large number of tasks is available for see for example the discussion below in section[2.x.20] Abstractions for tasks</div><div class="ttdef"><b>Definition:</b> <a href="multithreading__0_8txt_source.html#l00034">multithreading_0.txt:34</a></div></div>
<div class="ttc" id="aclassSolverControl_html"><div class="ttname"><a href="classSolverControl.html">SolverControl</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2solver__control_8h_source.html#l00052">solver_control.h:52</a></div></div>
<div class="ttc" id="agroup__CPP11_html_ga4288670ae5bd80367e24918d542cb2d8"><div class="ttname"><a href="group__CPP11.html#ga4288670ae5bd80367e24918d542cb2d8">Triangulation::active_cell_iterators</a></div><div class="ttdeci">IteratorRange&lt; active_cell_iterator &gt; active_cell_iterators() const</div><div class="ttdef"><b>Definition:</b> <a href="grid_2tria_8cc_source.html#l12155">tria.cc:12155</a></div></div>
<div class="ttc" id="anamespaceinternal_1_1TriangulationImplementation_html_a9f815604be9b560fea00beef8d720480"><div class="ttname"><a href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">internal::TriangulationImplementation::n_cells</a></div><div class="ttdeci">unsigned int n_cells(const internal::TriangulationImplementation::NumberCache&lt; 1 &gt; &amp;c)</div><div class="ttdef"><b>Definition:</b> <a href="grid_2tria_8cc_source.html#l12588">tria.cc:12588</a></div></div>
<div class="ttc" id="anamespaceEuler__DG_html_a143bc64b6fa6ced9f11c148a2af3ff09"><div class="ttname"><a href="namespaceEuler__DG.html#a143bc64b6fa6ced9f11c148a2af3ff09">Euler_DG::Number</a></div><div class="ttdeci">double Number</div><div class="ttdef"><b>Definition:</b> <a href="step-67_8cc_source.html#l00064">step-67.cc:64</a></div></div>
<div class="ttc" id="apolynomial__space__0_8txt_html_ac00ea19562c135512a6ff275a3cf0d8f"><div class="ttname"><a href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a></div><div class="ttdeci">*Representation of the space of polynomials of degree at most n in higher dimensions *Given a vector of[1.x.0] one dimensional polynomials[1.x.1] where[1.x.3] has this class generates all dim dimensional polynomials of the where the sum and[1.x.8] is less than or equal *[1.x.9] The i e for each dim dimensional polynomial in the polynomial space it gives the indices j</div><div class="ttdef"><b>Definition:</b> <a href="polynomial__space__0_8txt_source.html#l00004">polynomial_space_0.txt:4</a></div></div>
<div class="ttc" id="amg__0_8txt_html_a1dadc108ee1520717957789de4b76416"><div class="ttname"><a href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a></div><div class="ttdeci">****Classes that have to do with multigrid algorithms *The main class with implementation of the multigrid scheme is Multigrid with its function[2.x.1] It uses the abstract following classes in order to perform the multigrid cycle</div><div class="ttdef"><b>Definition:</b> <a href="mg__0_8txt_source.html#l00007">mg_0.txt:7</a></div></div>
<div class="ttc" id="abase_2vectorization_8h_html_aafbdfdd72b6cfe4eae5fa7a16385582f"><div class="ttname"><a href="base_2vectorization_8h.html#aafbdfdd72b6cfe4eae5fa7a16385582f">std::abs</a></div><div class="ttdeci">inline ::VectorizedArray&lt; Number, width &gt; abs(const ::VectorizedArray&lt; Number, width &gt; &amp;x)</div><div class="ttdef"><b>Definition:</b> <a href="base_2vectorization_8h_source.html#l05750">vectorization.h:5750</a></div></div>
<div class="ttc" id="aclassFullMatrix_html_abed6fffa5cb201496d751a4427cb59d6"><div class="ttname"><a href="classFullMatrix.html#abed6fffa5cb201496d751a4427cb59d6">FullMatrix::Tvmult_add</a></div><div class="ttdeci">void Tvmult_add(Vector&lt; number2 &gt; &amp;w, const Vector&lt; number2 &gt; &amp;v) const</div></div>
<div class="ttc" id="anumerics_2data__out_8h_html"><div class="ttname"><a href="numerics_2data__out_8h.html">data_out.h</a></div></div>
<div class="ttc" id="aclassFiniteElementData_html_a33b522422da89e5c080e7405ad49d7c7"><div class="ttname"><a href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">FiniteElementData::n_dofs_per_cell</a></div><div class="ttdeci">unsigned int n_dofs_per_cell() const</div></div>
<div class="ttc" id="aclassDataOut_html"><div class="ttname"><a href="classDataOut.html">DataOut&lt; dim &gt;</a></div></div>
<div class="ttc" id="afe__evaluation__0_8txt_html_a66b432045b82ed9b1c850f6407d4b1ca"><div class="ttname"><a href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a></div><div class="ttdeci">FE_Q with hanging node constraints connects to more neighbors than a FE_DGQ for and cells which need data exchange are put in different positions inside the cell loop Of if the exact same and then the order is going to be the same because the algorithm is deterministic *dim Dimension in which this class is to be used *fe_degree Degree of the tensor product finite element with fe_degree degrees of freedom per coordinate direction Can be set to **if the degree is not known at compile but performance will usually be worse by a factor of *n_q_points_1d Number of points in the quadrature formula defaults to fe_degree *n_components Number of vector components when solving a system of PDEs If the same operation is applied to several components of a they can be applied simultaneously with one usually[2.x.339] or[2.x.340] Defaults to[2.x.341] double ******An alias to the base class **An underlying number type specified as template argument **The type of function e g VectorizedArrayType for e g Tensor&lt; 1, dim, VectorizedArrayType &gt; for can be different if fe_degree</div><div class="ttdef"><b>Definition:</b> <a href="fe__evaluation__0_8txt_source.html#l00537">fe_evaluation_0.txt:537</a></div></div>
<div class="ttc" id="aclassVector_html"><div class="ttname"><a href="classVector.html">Vector&lt; float &gt;</a></div></div>
<div class="ttc" id="aclassFE__Q__Base_html_af8c966792cf559b9cdc5e5f91e2c6ed6"><div class="ttname"><a href="classFE__Q__Base.html#af8c966792cf559b9cdc5e5f91e2c6ed6">FE_Q_Base::get_prolongation_matrix</a></div><div class="ttdeci">virtual const FullMatrix&lt; double &gt; &amp; get_prolongation_matrix(const unsigned int child, const RefinementCase&lt; dim &gt; &amp;refinement_case=RefinementCase&lt; dim &gt;::isotropic_refinement) const override</div><div class="ttdef"><b>Definition:</b> <a href="fe__q__base_8cc_source.html#l01241">fe_q_base.cc:1241</a></div></div>
<div class="ttc" id="alac_2sparse__matrix_8h_html"><div class="ttname"><a href="lac_2sparse__matrix_8h.html">sparse_matrix.h</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a0ddaa05c5463c6c0b7701e18005717a9"><div class="ttname"><a href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">ParameterHandler::parse_input</a></div><div class="ttdeci">virtual void parse_input(std::istream &amp;input, const std::string &amp;filename=&quot;input file&quot;, const std::string &amp;last_line=&quot;&quot;, const bool skip_undefined=false)</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00399">parameter_handler.cc:399</a></div></div>
<div class="ttc" id="afe_2fe__values__0_8txt_html_a15ff2e0c168966d6ae13c4faabcec165"><div class="ttname"><a href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a></div><div class="ttdeci">we have to work a bit harder to compute this information **Default constructor Creates an invalid object **Constructor for an object that represents a single scalar component of a FEValuesBase for the shape function and quadrature point selected by the arguments[2.x.27] shape_function Number of the shape function to be evaluated Note that this number runs from zero to dofs_per_cell</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values__0_8txt_source.html#l00073">fe_values_0.txt:73</a></div></div>
<div class="ttc" id="adof__tools__0_8txt_html_aa623f15672a6db0f3f730a81a5b432b4"><div class="ttname"><a href="dof__tools__0_8txt.html#aa623f15672a6db0f3f730a81a5b432b4">active</a></div><div class="ttdeci">previous contents are not deleted **This function generates a matrix such that when a vector of data with as many elements as there are degrees of freedom of this component on the coarse grid is multiplied to this we obtain a vector with as many elements as there are global degrees of freedom on the fine grid All the elements of the other vector components of the finite element fields on the fine grid are not touched Triangulation of the fine grid can be distributed When called in each process has to have a copy of the coarse grid In this function returns transfer representation for a set of locally owned cells The output of this function is a compressed format that can be used to construct corresponding sparse transfer matrix ****Periodic boundary conditions *[2.x.121] *Insert this functions constrains all DoFs associated with the boundary described by[2.x.125] to the respective DoFs of the boundary described by[2.x.126] More the global DoF see below if[2.x.134] and[2.x.135] are not active this function loops recursively over the children of[2.x.136] and[2.x.137] If only one of the two faces is active</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools__0_8txt_source.html#l00095">dof_tools_0.txt:95</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Double_html"><div class="ttname"><a href="classPatterns_1_1Double.html">Patterns::Double</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2patterns_8h_source.html#l00307">patterns.h:307</a></div></div>
<div class="ttc" id="agrid_2grid__generator_8h_html"><div class="ttname"><a href="grid_2grid__generator_8h.html">grid_generator.h</a></div></div>
<div class="ttc" id="aclassStep28_1_1MaterialData_html_a3aa25110af7a21c993d9112b19f3670f"><div class="ttname"><a href="classStep28_1_1MaterialData.html#a3aa25110af7a21c993d9112b19f3670f">Step28::MaterialData::MaterialData</a></div><div class="ttdeci">MaterialData(const unsigned int n_groups)</div><div class="ttdef"><b>Definition:</b> <a href="step-28_8cc_source.html#l00106">step-28.cc:106</a></div></div>
<div class="ttc" id="acoding__conventions__0_8txt_html_a02f5aa616d7b0799c538fe77d6c6c795"><div class="ttname"><a href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a></div><div class="ttdeci">i e</div><div class="ttdef"><b>Definition:</b> <a href="coding__conventions__0_8txt_source.html#l00028">coding_conventions_0.txt:28</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Integer_html"><div class="ttname"><a href="classPatterns_1_1Integer.html">Patterns::Integer</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2patterns_8h_source.html#l00198">patterns.h:198</a></div></div>
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
