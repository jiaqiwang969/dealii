<!-- HTML header for doxygen 1.8.17-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="canonical" href="https://www.dealii.org/current/doxygen/deal.II/step_66.html" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The deal.II Library: The step-66 tutorial program</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link rel="SHORTCUT ICON" href="deal.ico"></link>
<script type="text/javascript" src="custom.js"></script>
<meta name="author" content="The deal.II Authors <authors@dealii.org>"></meta>
<meta name="copyright" content="Copyright (C) 1998 - 2021 by the deal.II authors"></meta>
<meta name="deal.II-version" content="10.0.0-pre"></meta>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo200.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Reference documentation for deal.II version 10.0.0-pre</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!--Extra macros for MathJax:-->
<div style="display:none">
\(\newcommand{\dealvcentcolon}{\mathrel{\mathop{:}}}\)
\(\newcommand{\dealcoloneq}{\dealvcentcolon\mathrel{\mkern-1.2mu}=}\)
\(\newcommand{\jump}[1]{\left[\!\left[ #1 \right]\!\right]}\)
\(\newcommand{\average}[1]{\left\{\!\left\{ #1 \right\}\!\right\}}\)
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">The step-66 tutorial program </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial depends on <a class="el" href="step_15.html">step-15</a>, <a class="el" href="step_37.html">step-37</a>.</p>
<p> 
<table class="tutorial" width="50%">
<tr><th colspan="2"><b><small>Table of contents</small></b></th></tr>
<tr><td width="50%" valign="top">
<ol>
  <li> <a href="#Intro" class=bold>Introduction</a>
    <ul>
        <li><a href="#Problemformulation">Problem formulation</a>
        <li><a href="#Discretizationwithfiniteelements">Discretization with finite elements</a>
        <li><a href="#Numericallinearalgebra">Numerical linear algebra</a>
        <li><a href="#Triangulation">Triangulation</a>
    </ul>
  <li> <a href="#CommProg" class=bold>The commented program</a>
    <ul>
        <li><a href="#MatrixfreeJacobianOperator">Matrix-free JacobianOperator</a>
      <ul>
        <li><a href="#EvaluationoftheoldNewtonstep">Evaluation of the old Newton step</a>
        <li><a href="#Nonlinearmatrixfreeoperatorapplication">Nonlinear matrix-free operator application</a>
        <li><a href="#DiagonaloftheJacobianOperator">Diagonal of the JacobianOperator</a>
      </ul>
        <li><a href="#GelfandProblemclass">GelfandProblem class</a>
      <ul>
        <li><a href="#GelfandProblemmake_grid">GelfandProblem::make_grid</a>
        <li><a href="#GelfandProblemsetup_system">GelfandProblem::setup_system</a>
        <li><a href="#GelfandProblemevaluate_residual">GelfandProblem::evaluate_residual</a>
        <li><a href="#GelfandProblemlocal_evaluate_residual">GelfandProblem::local_evaluate_residual</a>
        <li><a href="#GelfandProblemassemble_rhs">GelfandProblem::assemble_rhs</a>
        <li><a href="#GelfandProblemcompute_residual">GelfandProblem::compute_residual</a>
        <li><a href="#GelfandProblemcompute_update">GelfandProblem::compute_update</a>
        <li><a href="#GelfandProblemsolve">GelfandProblem::solve</a>
        <li><a href="#GelfandProblemcompute_solution_norm">GelfandProblem::compute_solution_norm</a>
        <li><a href="#GelfandProblemoutput_results">GelfandProblem::output_results</a>
        <li><a href="#GelfandProblemrun">GelfandProblem::run</a>
      </ul>
        <li><a href="#Thecodemaincodefunction">The <code>main</code> function</a>
      </ul>
</ol></td><td width="50%" valign="top"><ol>
  <li value="3"> <a href="#Results" class=bold>Results</a>
    <ul>
        <li><a href="#Programoutput">Program output</a>
        <li><a href="#Newtonsolver">Newton solver</a>
        <li><a href="#Possibilitiesforextensions">Possibilities for extensions</a>
      <ul>
        <li><a href="#MoresophisticatedNewtoniteration">More sophisticated Newton iteration</a>
        <li><a href="#Parallelscalabilityandthreadparallelism">Parallel scalability and thread parallelism</a>
        <li><a href="#Comparisontomatrixbasedmethods">Comparison to matrix-based methods</a>
        <li><a href="#Eigenvalueproblem">Eigenvalue problem</a>
    </ul>
    </ul>
  <li> <a href="#PlainProg" class=bold>The plain program</a>
</ol> </td> </tr> </table>
 <br  />
</p>
<p><em> This program was contributed by Fabian Castelli.</em></p>
<p><em>A version of this code was presented and discussed in <b>[castelli2021numerical]</b> G.F. Castelli: Numerical Investigation of Cahn-Hilliard-Type Phase-Field Models for Battery Active <a class="el" href="namespaceParticles.html">Particles</a>, PhD thesis, Karlsruhe Institute of Technology (KIT), 2021. (To be published)</em></p>
<p><em>Fabian Castelli acknowledges financial support by the German Research Foundation (DFG) through the Research Training Group 2218 SiMET &ndash; Simulation of mechano-electro-thermal processes in lithium-ion batteries, project number 281041241.</em></p>
<p><em>Finally Fabian Castelli would like to thank Timo Heister for the encouragement and advice in writing this tutorial. </em></p>
<p><a class="anchor" id="Intro"></a> <a class="anchor" id="Introduction"></a></p><h1>Introduction</h1>
<p>The aim of this tutorial program is to demonstrate how to solve a nonlinear problem using Newton's method within the matrix-free framework. This tutorial combines several techniques already introduced in <a class="el" href="step_15.html">step-15</a>, <a class="el" href="step_16.html">step-16</a>, <a class="el" href="step_37.html">step-37</a>, <a class="el" href="step_48.html">step-48</a> and others.</p>
<p><a class="anchor" id="Problemformulation"></a></p><h3>Problem formulation</h3>
<p>On the unit circle \(\Omega = \bigl\{ x \in \mathbb{R}^2 : \|x\| \leq 1 \bigr\}\) we consider the following nonlinear elliptic boundary value problem subject to a homogeneous Dirichlet boundary condition: Find a function \(u\colon\Omega\to\mathbb{R}\) such that it holds: </p><p class="formulaDsp">
\begin{align*} - \Delta u &amp;= \exp(u) &amp; \quad &amp; \text{in } \Omega,\\ u &amp;= 0 &amp; \quad &amp; \text{on } \partial\Omega. \end{align*}
</p>
<p> This problem is also called the <em>Gelfand problem</em> and is a typical example for problems from combustion theory, see for example <b>[bebernes1989mathematical]</b>.</p>
<p><a class="anchor" id="Discretizationwithfiniteelements"></a></p><h3>Discretization with finite elements</h3>
<p>As usual, we first derive the weak formulation for this problem by multiplying with a smooth test function \(v\colon\Omega\to\mathbb{R}\) respecting the boundary condition and integrating over the domain \(\Omega\). Integration by parts and putting the term from the right hand side to the left yields the weak formulation: Find a function \(u\colon\Omega\to\mathbb{R}\) such that for all test functions \(v\) it holds: </p><p class="formulaDsp">
\begin{align*} \int_\Omega \nabla v \cdot \nabla u \,\mathrm{d}x - \int_\Omega v \exp(u) \,\mathrm{d}x = 0. \end{align*}
</p>
<p>Choosing the Lagrangian finite element space \(V_h \dealcoloneq \bigl\{ v \in C(\overline{\Omega}) : v|_Q \in \mathbb{Q}_p \text{ for all } Q \in \mathcal{T}_h \bigr\} \cap H_0^1(\Omega)\), which directly incorporates the homogeneous Dirichlet boundary condition, we can define a basis \(\{\varphi_i\}_{i=1,\dots,N}\) and thus it suffices to test only with those basis functions. So the discrete problem reads as follows: Find \(u_h\in V_h\) such that for all \(i=1,\dots,N\) it holds: </p><p class="formulaDsp">
\begin{align*} F(u_h) \dealcoloneq \int_\Omega \nabla \varphi_i \cdot \nabla u_h \,\mathrm{d}x - \int_\Omega \varphi_i \exp(u_h) \,\mathrm{d}x \stackrel{!}{=} 0. \end{align*}
</p>
<p> As each finite element function is a linear combination of the basis functions \(\{\varphi_i\}_{i=1,\dots,N}\), we can identify the finite element solution by a vector from \(\mathbb{R}^N\) consisting of the unknown values in each degree of freedom (DOF). Thus, we define the nonlinear function \(F\colon\mathbb{R}^N\to\mathbb{R}^N\) representing the discrete nonlinear problem.</p>
<p>To solve this nonlinear problem we use Newton's method. So given an initial guess \(u_h^0\in V_h\), which already fulfills the Dirichlet boundary condition, we determine a sequence of Newton steps \(\bigl( u_h^n \bigr)_n\) by successively applying the following scheme: </p><p class="formulaDsp">
\begin{align*} &amp;\text{Solve for } s_h^n\in V_h: \quad &amp; F&#39;(u_h^n)[s_h^n] &amp;= -F(u_h^n),\\ &amp;\text{Update: } &amp; u_h^{n+1} &amp;= u_h^n + s_h^n. \end{align*}
</p>
<p> So in each Newton step we have to solve a linear problem \(A\,x = b\), where the system matrix \(A\) is represented by the Jacobian \(F&#39;(u_h^n)[\,\cdot\,]\colon\mathbb{R}^N\to\mathbb{R}^N\) and the right hand side \(b\) by the negative residual \(-F(u_h^n)\). The solution vector \(x\) is in that case the Newton update of the \(n\)-th Newton step. Note, that we assume an initial guess \(u_h^0\), which already fulfills the Dirichlet boundary conditions of the problem formulation (in fact this could also be an inhomogeneous Dirichlet boundary condition) and thus the Newton updates \(s_h\) satisfy a homogeneous Dirichlet condition.</p>
<p>Until now we only tested with the basis functions, however, we can also represent any function of \(V_h\) as linear combination of basis functions. More mathematically this means, that every element of \(V_h\) can be identified with a vector \(U\in\mathbb{R}^N\) via the representation formula: \(u_h = \sum_{i=1}^N U_i \varphi_i\). So using this we can give an expression for the discrete Jacobian and the residual: </p><p class="formulaDsp">
\begin{align*} A_{i,j} = \bigl( F&#39;(u_h^n) \bigr)_{i,j} &amp;= \int_\Omega \nabla\varphi_i \cdot \nabla \varphi_j \,\mathrm{d} x - \int_\Omega \varphi_i \, \exp( u_h ) \varphi_j \,\mathrm{d} x,\\ b_{i} = \bigl( F(u_h^n) \bigr)_{i} &amp;= \int_\Omega \nabla\varphi_i \cdot \nabla u_h^n \,\mathrm{d} x - \int_\Omega \varphi_i \, \exp( u_h^n ) \,\mathrm{d} x. \end{align*}
</p>
<p> Compared to <a class="el" href="step_15.html">step-15</a> we could also have formed the Frech{\'e}t derivative of the nonlinear function corresponding to the strong formulation of the problem and discretized it afterwards. However, in the end we would get the same set of discrete equations.</p>
<p><a class="anchor" id="Numericallinearalgebra"></a></p><h3>Numerical linear algebra</h3>
<p>Note, how the system matrix, actually the Jacobian, depends on the previous Newton step \(A = F&#39;(u^n)\). Hence we need to tell the function that computes the system matrix about the solution at the last Newton step. In an implementation with a classical <code>assemble_system()</code> function we would gather this information from the last Newton step during assembly by the use of the member functions <a class="el" href="classFEValuesBase.html#a357b422e374f2f2207af3512093f3907">FEValuesBase::get_function_values()</a> and <a class="el" href="classFEValuesBase.html#ad1f4e0deb5d982e8172d82141c634a67">FEValuesBase::get_function_gradients()</a>. The <code>assemble_system()</code> function would then looks like: </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> GelfandProblem&lt;dim&gt;::assemble_system()</div>
<div class="line">{</div>
<div class="line">  system_matrix = 0;</div>
<div class="line">  system_rhs    = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> quadrature_formula(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1);</div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>     fe_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                          quadrature_formula,</div>
<div class="line">                          <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>    = fe_values.n_quadrature_points;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> = fe_values.dofs_per_cell;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a>                   <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a>(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a>                       cell_rhs(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; <a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;Tensor&lt;1, dim&gt;&gt; newton_step_gradients(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line">  std::vector&lt;double&gt;         newton_step_values(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a> = 0.0;</div>
<div class="line">      cell_rhs    = 0.0;</div>
<div class="line"> </div>
<div class="line">      fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">      fe_values.get_function_values(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, newton_step_values);</div>
<div class="line">      fe_values.get_function_gradients(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, newton_step_gradients);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q)</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> nonlinearity = <a class="code" href="base_2vectorization_8h.html#a19f846bda83b7e3f4531daacb40c64e1">std::exp</a>(newton_step_values[q]);</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1a9e60516f3a44e6d7cd4ac533f6bc0209">dx</a>           = fe_values.JxW(q);</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">double</span>         phi_i      = fe_values.shape_value(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q);</div>
<div class="line">              <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> grad_phi_i = fe_values.shape_grad(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q);</div>
<div class="line"> </div>
<div class="line">              <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> = 0; <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>)</div>
<div class="line">                {</div>
<div class="line">                  <span class="keyword">const</span> <span class="keywordtype">double</span>         phi_j      = fe_values.shape_value(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q);</div>
<div class="line">                  <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> grad_phi_j = fe_values.shape_grad(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q);</div>
<div class="line"> </div>
<div class="line">                  <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>) +=</div>
<div class="line">                    (grad_phi_i * grad_phi_j - phi_i * nonlinearity * phi_j) *</div>
<div class="line">                    <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1a9e60516f3a44e6d7cd4ac533f6bc0209">dx</a>;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">              cell_rhs(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>) += (-grad_phi_i * newton_step_gradients[q] +</div>
<div class="line">                              phi_i * newton_step_values[q]) *</div>
<div class="line">                             <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1a9e60516f3a44e6d7cd4ac533f6bc0209">dx</a>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;get_dof_indices(<a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>);</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#a373fbdacd8c486e675b8d2bff8943192">distribute_local_to_global</a>(</div>
<div class="line">        <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a>, cell_rhs, <a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>, system_matrix, system_rhs);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Since we want to solve this problem without storing a matrix, we need to tell the matrix-free operator this information before we use it. Therefore in the derived class <code>JacobianOperator</code> we will implement a function called <code>evaluate_newton_step</code>, which will process the information of the last Newton step prior to the usage of the matrix-vector implementation. Furthermore we want to use a geometric multigrid (GMG) preconditioner for the linear solver, so in order to apply the multilevel operators we need to pass the last Newton step also to these operators. This is kind of a tricky task, since the vector containing the last Newton step has to be interpolated to all levels of the triangulation. In the code this task will be done by the function <a class="el" href="classMGTransferMatrixFree.html#a90aef560cc3d832589ca13a5f18e1414">MGTransferMatrixFree::interpolate_to_mg()</a>. Note, a fundamental difference to the previous cases, where we set up and used a geometric multigrid preconditioner, is the fact, that we can reuse the <a class="el" href="classMGTransferMatrixFree.html">MGTransferMatrixFree</a> object for the computation of all Newton steps. So we can save some work here by defining a class variable and using an already set up <a class="el" href="classMGTransferMatrixFree.html">MGTransferMatrixFree</a> object <code>mg_transfer</code> that was initialized in the <code>setup_system()</code> function. </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::compute_update()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;compute update&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.update_ghost_values();</div>
<div class="line"> </div>
<div class="line">  system_matrix.evaluate_newton_step(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line">  mg_transfer.<a class="code" href="classMGTransferMatrixFree.html#a90aef560cc3d832589ca13a5f18e1414">interpolate_to_mg</a>(dof_handler, mg_solution, <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Set up options for the multilevel preconditioner</span></div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels(); ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">    {</div>
<div class="line">      mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].evaluate_newton_step(mg_solution[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>]);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Define the actual preconditioner</span></div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Solve the linear system</span></div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>The function evaluating the nonlinearity works basically in the same way as the function <code>evaluate_coefficient</code> from <a class="el" href="step_37.html">step-37</a> evaluating a coefficient function. The idea is to use an <a class="el" href="classFEEvaluation.html">FEEvaluation</a> object to evaluate the Newton step and store the expression in a table for all cells and all quadrature points: </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line"><span class="keywordtype">void</span> JacobianOperator&lt;dim, fe_degree, number&gt;::evaluate_newton_step(</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;newton_step)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a> = this-&gt;data-&gt;n_cell_batches();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, fe_degree, fe_degree + 1, 1, number&gt;</a> phi(*this-&gt;data);</div>
<div class="line"> </div>
<div class="line">  nonlinear_values.reinit(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>, phi.n_q_points);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> = 0; <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> &lt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>; ++<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>)</div>
<div class="line">    {</div>
<div class="line">      phi.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line">      phi.read_dof_values_plain(newton_step);</div>
<div class="line">      phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">        {</div>
<div class="line">          nonlinear_values(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, q) = <a class="code" href="base_2vectorization_8h.html#a19f846bda83b7e3f4531daacb40c64e1">std::exp</a>(phi.get_value(q));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Triangulation"></a></p><h3><a class="el" href="classTriangulation.html">Triangulation</a></h3>
<p>As said in <a class="el" href="step_37.html">step-37</a> the matrix-free method gets more efficient if we choose a higher order finite element space. Since we want to solve the problem on the \(d\)-dimensional unit ball, it would be good to have an appropriate boundary approximation to overcome convergence issues. For this reason we use an isoparametric approach with the <a class="el" href="classMappingQGeneric.html">MappingQGeneric</a> class to recover the smooth boundary as well as the mapping for inner cells. In addition, to get a good triangulation in total we make use of the <a class="el" href="classTransfiniteInterpolationManifold.html">TransfiniteInterpolationManifold</a>.</p>
<p><a class="anchor" id="CommProg"></a> </p><h1>The commented program</h1>
<p>First we include the typical headers of the deal.II library needed for this tutorial:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2timer_8h.html">deal.II/base/timer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2vectorization_8h.html">deal.II/base/vectorization.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__accessor_8h.html">deal.II/dofs/dof_accessor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2mapping__q__generic_8h.html">deal.II/fe/mapping_q_generic.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__out_8h.html">deal.II/grid/grid_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2manifold__lib_8h.html">deal.II/grid/manifold_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria__accessor_8h.html">deal.II/grid/tria_accessor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria__iterator_8h.html">deal.II/grid/tria_iterator.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2precondition_8h.html">deal.II/lac/precondition.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2solver__cg_8h.html">deal.II/lac/solver_cg.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2vector_8h.html">deal.II/lac/vector.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
</div><!-- fragment --><p>In particular, we need to include the headers for the matrix-free framework:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_2fe__evaluation_8h.html">deal.II/matrix_free/fe_evaluation.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_2matrix__free_8h.html">deal.II/matrix_free/matrix_free.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_2operators_8h.html">deal.II/matrix_free/operators.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_2tools_8h.html">deal.II/matrix_free/tools.h</a>&gt;</span></div>
</div><!-- fragment --><p>And since we want to use a geometric multigrid preconditioner, we need also the multilevel headers:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__coarse_8h.html">deal.II/multigrid/mg_coarse.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__constrained__dofs_8h.html">deal.II/multigrid/mg_constrained_dofs.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__matrix_8h.html">deal.II/multigrid/mg_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__smoother_8h.html">deal.II/multigrid/mg_smoother.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__tools_8h.html">deal.II/multigrid/mg_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__transfer__matrix__free_8h.html">deal.II/multigrid/mg_transfer_matrix_free.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2multigrid_8h.html">deal.II/multigrid/multigrid.h</a>&gt;</span></div>
</div><!-- fragment --><p>Finally some common C++ headers for in and output:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceStep66.html">Step66</a></div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
</div><!-- fragment --><p><a class="anchor" id="MatrixfreeJacobianOperator"></a> </p><h3>Matrix-free JacobianOperator</h3>
<p>In the beginning we define the matrix-free operator for the Jacobian. As a guideline we follow the tutorials <a class="el" href="step_37.html">step-37</a> and <a class="el" href="step_48.html">step-48</a>, where the precise interface of the <a class="el" href="classMatrixFreeOperators_1_1Base.html">MatrixFreeOperators::Base</a> class was extensively documented.</p>
<p>Since we want to use the Jacobian as system matrix and pass it to the linear solver as well as to the multilevel preconditioner classes, we derive the <code>JacobianOperator</code> class from the <a class="el" href="classMatrixFreeOperators_1_1Base.html">MatrixFreeOperators::Base</a> class, such that we have already the right interface. The two functions we need to override from the base class are the <a class="el" href="classMatrixFreeOperators_1_1Base.html#abc81493aad390198580330cc99203b3c">MatrixFreeOperators::Base::apply_add()</a> and the <a class="el" href="classMatrixFreeOperators_1_1Base.html#a16d883c49c69eef468b39b2e991d8b0d">MatrixFreeOperators::Base::compute_diagonal()</a> function. To allow preconditioning with float precision we define the number type as template argument.</p>
<p>As mentioned already in the introduction, we need to evaluate the Jacobian \(F&#39;\) at the last Newton step \(u_h^n\) for the computation of the Newton update \(s_h^n\). To get the information of the last Newton step \(u_h^n\) we do pretty much the same as in <a class="el" href="step_37.html">step-37</a>, where we stored the values of a coefficient function in a table <code>nonlinear_values</code> once before we use the matrix-free operator. Instead of a function <code>evaluate_coefficient()</code>, we here implement a function <code>evaluate_newton_step()</code>.</p>
<p>As additional private member functions of the <code>JacobianOperator</code> we implement the <code>local_apply()</code> and the <code>local_compute_diagonal()</code> function. The first one is the actual worker function for the matrix-vector application, which we pass to the <a class="el" href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">MatrixFree::cell_loop()</a> in the <code><a class="el" href="operators__0_8txt.html#a92cb2920df95b6f107c2c9a8c75b788c">apply_add()</a></code> function. The later one is the worker function to compute the diagonal, which we pass to the <a class="el" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">MatrixFreeTools::compute_diagonal()</a> function.</p>
<p>For better readability of the source code we further define an alias for the <a class="el" href="classFEEvaluation.html">FEEvaluation</a> object.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line"><span class="keyword">class </span>JacobianOperator</div>
<div class="line">  : <span class="keyword">public</span> <a class="code" href="namespaceMatrixFreeOperators.html">MatrixFreeOperators</a>::</div>
<div class="line">      Base&lt;dim, LinearAlgebra::distributed::Vector&lt;number&gt;&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">using</span> value_type = <a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using</span> FECellIntegrator =</div>
<div class="line">    <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, fe_degree, fe_degree + 1, 1, number&gt;</a>;</div>
<div class="line"> </div>
<div class="line">  JacobianOperator();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="table__0_8txt.html#a7f24305532768edc889062eefd4b28cf">clear</a>() <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> evaluate_newton_step(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;newton_step);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">compute_diagonal</a>() <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="operators__0_8txt.html#a92cb2920df95b6f107c2c9a8c75b788c">apply_add</a>(</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src) <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span></div>
<div class="line">  local_apply(<span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, number&gt;</a> &amp;                   <a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>,</div>
<div class="line">              <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">              <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src,</div>
<div class="line">              <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;cell_range) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> local_compute_diagonal(FECellIntegrator &amp;integrator) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTable.html">Table&lt;2, VectorizedArray&lt;number&gt;</a>&gt; nonlinear_values;</div>
<div class="line">};</div>
</div><!-- fragment --><p>The constructor of the <code>JacobianOperator</code> just calls the constructor of the base class <a class="el" href="classMatrixFreeOperators_1_1Base.html">MatrixFreeOperators::Base</a>, which is itself derived from the <a class="el" href="classSubscriptor.html">Subscriptor</a> class.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">JacobianOperator&lt;dim, fe_degree, number&gt;::JacobianOperator()</div>
<div class="line">  : <a class="code" href="namespaceMatrixFreeOperators.html">MatrixFreeOperators</a>::Base&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>,</div>
<div class="line">                              <a class="code" href="namespaceLinearAlgebra.html">LinearAlgebra</a>::<a class="code" href="distributed__0_8txt.html#ad7a526c3d1317369fada16d420fcb06c">distributed</a>::<a class="code" href="classVector.html">Vector</a>&lt;<a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>&gt;&gt;()</div>
<div class="line">{}</div>
</div><!-- fragment --><p>The <code><a class="el" href="table__0_8txt.html#a7f24305532768edc889062eefd4b28cf">clear()</a></code> function resets the table holding the values for the nonlinearity and call the <code><a class="el" href="table__0_8txt.html#a7f24305532768edc889062eefd4b28cf">clear()</a></code> function of the base class.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="table__0_8txt.html#a7f24305532768edc889062eefd4b28cf">JacobianOperator&lt;dim, fe_degree, number&gt;::clear</a>()</div>
<div class="line">{</div>
<div class="line">  nonlinear_values.reinit(0, 0);</div>
<div class="line">  <a class="code" href="classMatrixFreeOperators_1_1Base.html">MatrixFreeOperators::Base&lt;dim, LinearAlgebra::distributed::Vector&lt;number&gt;</a>&gt;<a class="code" href="table__0_8txt.html#a7f24305532768edc889062eefd4b28cf">::</a></div>
<div class="line"><a class="code" href="table__0_8txt.html#a7f24305532768edc889062eefd4b28cf">    clear</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="EvaluationoftheoldNewtonstep"></a> </p><h4>Evaluation of the old Newton step</h4>
<p>The following <code>evaluate_newton_step()</code> function is based on the <code>evaluate_coefficient()</code> function from <a class="el" href="step_37.html">step-37</a>. However, it does not evaluate a function object, but evaluates a vector representing a finite element function, namely the last Newton step needed for the Jacobian. Therefore we set up a <a class="el" href="classFEEvaluation.html">FEEvaluation</a> object and evaluate the finite element function in the quadrature points with the FEEvaluation::read_dof_values_plain() and <a class="el" href="classFEEvaluation.html#a710c252e9dccc0c4ce07044cac3bdd9b">FEEvaluation::evaluate()</a> functions. We store the evaluated values of the finite element function directly in the <code>nonlinear_values</code> table.</p>
<p>This will work well and in the <code>local_apply()</code> function we can use the values stored in the table to apply the matrix-vector product. However, we can also optimize the implementation of the Jacobian at this stage. We can directly evaluate the nonlinear function <code>std::exp(newton_step[q])</code> and store these values in the table. This skips all evaluations of the nonlinearity in each call of the <code><a class="el" href="linear__operator__0_8txt.html#a64f52ea7f8959e614f32da4664cdbe50">vmult()</a></code> function.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line"><span class="keywordtype">void</span> JacobianOperator&lt;dim, fe_degree, number&gt;::evaluate_newton_step(</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;newton_step)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a> = this-&gt;data-&gt;n_cell_batches();</div>
<div class="line">  FECellIntegrator   phi(*this-&gt;data);</div>
<div class="line"> </div>
<div class="line">  nonlinear_values.reinit(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>, phi.n_q_points);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> = 0; <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> &lt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>; ++<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>)</div>
<div class="line">    {</div>
<div class="line">      phi.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line">      phi.read_dof_values_plain(newton_step);</div>
<div class="line">      phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">        {</div>
<div class="line">          nonlinear_values(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, q) = <a class="code" href="base_2vectorization_8h.html#a19f846bda83b7e3f4531daacb40c64e1">std::exp</a>(phi.get_value(q));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Nonlinearmatrixfreeoperatorapplication"></a> </p><h4>Nonlinear matrix-free operator application</h4>
<p>Now in the <code>local_apply()</code> function, which actually implements the cell wise action of the system matrix, we can use the information of the last Newton step stored in the table <code>nonlinear_values</code>. The rest of this function is basically the same as in <a class="el" href="step_37.html">step-37</a>. We set up the <a class="el" href="classFEEvaluation.html">FEEvaluation</a> object, gather and evaluate the values and gradients of the input vector <code>src</code>, submit the values and gradients according to the form of the Jacobian and finally call <a class="el" href="classFEEvaluation.html#a491779be7bd032d277e41f1dda8dc584">FEEvaluation::integrate_scatter()</a> to perform the cell integration and distribute the local contributions into the global vector <code> dst</code>.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line"><span class="keywordtype">void</span> JacobianOperator&lt;dim, fe_degree, number&gt;::local_apply(</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, number&gt;</a> &amp;                   <a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>,</div>
<div class="line">  <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src,</div>
<div class="line">  <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;     cell_range)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  FECellIntegrator phi(<a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> = cell_range.first; <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> &lt; cell_range.second; ++<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(nonlinear_values.size(0),</div>
<div class="line">                      phi.get_matrix_free().n_cell_batches());</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(nonlinear_values.size(1), phi.n_q_points);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      phi.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">      phi.gather_evaluate(src,</div>
<div class="line">                          <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> |</div>
<div class="line">                            <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">        {</div>
<div class="line">          phi.submit_value(-nonlinear_values(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, q) * phi.get_value(q), q);</div>
<div class="line">          phi.submit_gradient(phi.get_gradient(q), q);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      phi.integrate_scatter(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> |</div>
<div class="line">                              <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>,</div>
<div class="line">                            <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Next we use <a class="el" href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">MatrixFree::cell_loop()</a> to perform the actual loop over all cells computing the cell contribution to the matrix-vector product.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="operators__0_8txt.html#a92cb2920df95b6f107c2c9a8c75b788c">JacobianOperator&lt;dim, fe_degree, number&gt;::apply_add</a>(</div>
<div class="line">  <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  this-&gt;data-&gt;<a class="code" href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">cell_loop</a>(&amp;JacobianOperator::local_apply, <span class="keyword">this</span>, <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>, src);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="DiagonaloftheJacobianOperator"></a> </p><h4>Diagonal of the JacobianOperator</h4>
<p>The internal worker function <code>local_compute_diagonal()</code> for the computation of the diagonal is similar to the above worker function <code>local_apply()</code>. However, as major difference we do not read values from a input vector or distribute any local results to an output vector. Instead the only input argument is the used <a class="el" href="classFEEvaluation.html">FEEvaluation</a> object.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line"><span class="keywordtype">void</span> JacobianOperator&lt;dim, fe_degree, number&gt;::local_compute_diagonal(</div>
<div class="line">  FECellIntegrator &amp;phi)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(nonlinear_values.size(0),</div>
<div class="line">                  phi.get_matrix_free().n_cell_batches());</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(nonlinear_values.size(1), phi.n_q_points);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> = phi.get_current_cell_index();</div>
<div class="line"> </div>
<div class="line">  phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> | <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">    {</div>
<div class="line">      phi.submit_value(-nonlinear_values(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, q) * phi.get_value(q), q);</div>
<div class="line">      phi.submit_gradient(phi.get_gradient(q), q);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  phi.integrate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> | <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Finally we override the <a class="el" href="classMatrixFreeOperators_1_1Base.html#a16d883c49c69eef468b39b2e991d8b0d">MatrixFreeOperators::Base::compute_diagonal()</a> function of the base class of the <code>JacobianOperator</code>. Although the name of the function suggests just the computation of the diagonal, this function does a bit more. Because we only really need the inverse of the matrix diagonal elements for the Chebyshev smoother of the multigrid preconditioner, we compute the diagonal and store the inverse elements. Therefore we first initialize the <code>inverse_diagonal_entries</code>. Then we compute the diagonal by passing the worker function <code>local_compute_diagonal()</code> to the <a class="el" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">MatrixFreeTools::compute_diagonal()</a> function. In the end we loop over the diagonal and invert the elements by hand. Note, that during this loop we catch the constrained DOFs and set them manually to one.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">JacobianOperator&lt;dim, fe_degree, number&gt;::compute_diagonal</a>()</div>
<div class="line">{</div>
<div class="line">  this-&gt;inverse_diagonal_entries.reset(</div>
<div class="line">    <span class="keyword">new</span> <a class="code" href="classDiagonalMatrix.html">DiagonalMatrix</a>&lt;<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a>&gt;());</div>
<div class="line">  <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;inverse_diagonal =</div>
<div class="line">    this-&gt;inverse_diagonal_entries-&gt;get_vector();</div>
<div class="line">  this-&gt;data-&gt;<a class="code" href="classMatrixFree.html#ab92a24942737bbaf04d7e00aceba9b57">initialize_dof_vector</a>(inverse_diagonal);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">MatrixFreeTools::compute_diagonal</a>(*this-&gt;data,</div>
<div class="line">                                    inverse_diagonal,</div>
<div class="line">                                    &amp;JacobianOperator::local_compute_diagonal,</div>
<div class="line">                                    <span class="keyword">this</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;diagonal_element : inverse_diagonal)</div>
<div class="line">    {</div>
<div class="line">      diagonal_element = (<a class="code" href="base_2vectorization_8h.html#aafbdfdd72b6cfe4eae5fa7a16385582f">std::abs</a>(diagonal_element) &gt; 1.0e-10) ?</div>
<div class="line">                           (1.0 / diagonal_element) :</div>
<div class="line">                           1.0;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemclass"></a> </p><h3>GelfandProblem class</h3>
<p>After implementing the matrix-free operators we can now define the solver class for the <em>Gelfand problem</em>. This class is based on the common structure of all previous tutorial programs, in particular it is based on <a class="el" href="step_15.html">step-15</a>, solving also a nonlinear problem. Since we are using the matrix-free framework, we no longer need an assemble_system function any more, instead the information of the matrix is rebuilt in every call of the <code><a class="el" href="linear__operator__0_8txt.html#a64f52ea7f8959e614f32da4664cdbe50">vmult()</a></code> function. However, for the application of the Newton scheme we need to assemble the right hand side of the linearized problems and compute the residuals. Therefore, we implement an additional function <code>evaluate_residual()</code>, which we later call in the <code>assemble_rhs()</code> and the <code>compute_residual()</code> function. Finally, the typical <code><a class="el" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve()</a></code> function here implements the Newton method, whereas the solution of the linearized system is computed in the function <code>compute_update()</code>. As the <a class="el" href="classMatrixFree.html">MatrixFree</a> framework handles the polynomial degree of the Lagrangian finite element method as a template parameter, we declare it also as a template parameter for the problem solver class.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keyword">class </span>GelfandProblem</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  GelfandProblem();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">run</a>();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="step-2_8cc.html#ab108b7b7bca84a81aceda045aaef1961">make_grid</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> setup_system();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> evaluate_residual(</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;src) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> local_evaluate_residual(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, double&gt;</a> &amp;                   <a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>,</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;src,</div>
<div class="line">    <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;     cell_range) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> assemble_rhs();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> compute_residual(<span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> compute_update();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> compute_solution_norm() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>) <span class="keyword">const</span>;</div>
</div><!-- fragment --><p>For the parallel computation we define a <a class="el" href="classparallel_1_1distributed_1_1Triangulation.html">parallel::distributed::Triangulation</a>. As the computational domain is a circle in 2D and a ball in 3D, we assign in addition to the <a class="el" href="classSphericalManifold.html">SphericalManifold</a> for boundary cells a <a class="el" href="classTransfiniteInterpolationManifold.html">TransfiniteInterpolationManifold</a> object for the mapping of the inner cells, which takes care of the inner cells. In this example we use an isoparametric finite element approach and thus use the <a class="el" href="classMappingQGeneric.html">MappingQGeneric</a> class. Note, that we could also create an instance of the <a class="el" href="classMappingQ.html">MappingQ</a> class and set the <code>use_mapping_q_on_all_cells</code> flags in the contructor call to <code>true</code>. For further details on the connection of <a class="el" href="classMappingQ.html">MappingQ</a> and <a class="el" href="classMappingQGeneric.html">MappingQGeneric</a> you may read the detailed description of these classes.</p>
<div class="fragment"><div class="line"><a class="code" href="classparallel_1_1distributed_1_1Triangulation.html">parallel::distributed::Triangulation&lt;dim&gt;</a> <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>;</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classMappingQGeneric.html">MappingQGeneric&lt;dim&gt;</a>                <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>;</div>
</div><!-- fragment --><p>As usual we then define the Lagrangian finite elements <a class="el" href="classFE__Q.html">FE_Q</a> and a <a class="el" href="classDoFHandler.html">DoFHandler</a>.</p>
<div class="fragment"><div class="line"><a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a>       <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>;</div>
<div class="line"><a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> dof_handler;</div>
</div><!-- fragment --><p>For the linearized discrete system we define an <a class="el" href="classAffineConstraints.html">AffineConstraints</a> objects and the <code>system_matrix</code>, which is in this example represented as a matrix-free operator.</p>
<div class="fragment"><div class="line"><a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>;</div>
<div class="line"><span class="keyword">using</span> SystemMatrixType = JacobianOperator&lt;dim, fe_degree, double&gt;;</div>
<div class="line">SystemMatrixType system_matrix;</div>
</div><!-- fragment --><p>The multilevel object is also based on the matrix-free operator for the Jacobian. Since we need to evaluate the Jacobian with the last Newton step, we also need to evaluate the level operator with the last Newton step for the preconditioner. Thus in addition to <code>mg_matrices</code>, we also need a <a class="el" href="classMGLevelObject.html">MGLevelObject</a> to store the interpolated solution vector on each level. As in <a class="el" href="step_37.html">step-37</a> we use float precision for the preconditioner. Moreover, we define the <a class="el" href="classMGTransferMatrixFree.html">MGTransferMatrixFree</a> object as a class variable, since we need to set it up only once when the triangulation has changed and can then use it again in each Newton step.</p>
<div class="fragment"><div class="line"><a class="code" href="classMGConstrainedDoFs.html">MGConstrainedDoFs</a> mg_constrained_dofs;</div>
<div class="line"><span class="keyword">using</span> LevelMatrixType = JacobianOperator&lt;dim, fe_degree, float&gt;;</div>
<div class="line"><a class="code" href="classMGLevelObject.html">MGLevelObject&lt;LevelMatrixType&gt;</a>                           mg_matrices;</div>
<div class="line"><a class="code" href="classMGLevelObject.html">MGLevelObject&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt; mg_solution;</div>
<div class="line"><a class="code" href="classMGTransferMatrixFree.html">MGTransferMatrixFree&lt;dim, float&gt;</a>                         mg_transfer;</div>
</div><!-- fragment --><p>Of course we also need vectors holding the <code>solution</code>, the <code>newton_update</code> and the <code>system_rhs</code>. In that way we can always store the last Newton step in the solution vector and just add the update to get the next Newton step.</p>
<div class="fragment"><div class="line"><a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>;</div>
<div class="line"><a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> newton_update;</div>
<div class="line"><a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> system_rhs;</div>
</div><!-- fragment --><p>Finally we have a variable for the number of iterations of the linear solver.</p>
<div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> linear_iterations;</div>
</div><!-- fragment --><p>For the output in programs running in parallel with MPI, we use the <a class="el" href="classConditionalOStream.html">ConditionalOStream</a> class to avoid multiple output of the same data by different MPI ranks.</p>
<div class="fragment"><div class="line"><a class="code" href="classConditionalOStream.html">ConditionalOStream</a> pcout;</div>
</div><!-- fragment --><p>Finally for the time measurement we use a <a class="el" href="classTimerOutput.html">TimerOutput</a> object, which prints the elapsed CPU and wall times for each function in a nicely formatted table after the program has finished.</p>
<div class="fragment"><div class="line">  <a class="code" href="classTimerOutput.html">TimerOutput</a> computing_timer;</div>
<div class="line">};</div>
</div><!-- fragment --><p>The constructor of the <code>GelfandProblem</code> initializes the class variables. In particular, we set up the multilevel support for the <a class="el" href="classparallel_1_1distributed_1_1Triangulation.html">parallel::distributed::Triangulation</a>, set the mapping degree equal to the finite element degree, initialize the <a class="el" href="classConditionalOStream.html">ConditionalOStream</a> and tell the <a class="el" href="classTimerOutput.html">TimerOutput</a> that we want to see the wall times only on demand.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">GelfandProblem&lt;dim, fe_degree&gt;::GelfandProblem()</div>
<div class="line">  : <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>(MPI_COMM_WORLD,</div>
<div class="line">                  <a class="code" href="classTriangulation.html">Triangulation</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;::limit_level_difference_at_vertices,</div>
<div class="line">                  <a class="code" href="namespaceparallel.html">parallel</a>::<a class="code" href="distributed__0_8txt.html#ad7a526c3d1317369fada16d420fcb06c">distributed</a>::<a class="code" href="classTriangulation.html">Triangulation</a>&lt;</div>
<div class="line">                    <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;::<a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0a3901e6a241f812109912537866771e4c">construct_multigrid_hierarchy</a>)</div>
<div class="line">  , <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>(<a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>)</div>
<div class="line">  , <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>(<a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>)</div>
<div class="line">  , dof_handler(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>)</div>
<div class="line">  , pcout(std::cout, <a class="code" href="namespaceUtilities.html">Utilities</a>::<a class="code" href="base_2partitioner__0_8txt.html#a6d2d0fa485d1660823c59c494fb0fb31">MPI</a>::<a class="code" href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">this_mpi_process</a>(MPI_COMM_WORLD) == 0)</div>
<div class="line">  , computing_timer(MPI_COMM_WORLD,</div>
<div class="line">                    pcout,</div>
<div class="line">                    <a class="code" href="classTimerOutput.html">TimerOutput</a>::never,</div>
<div class="line">                    <a class="code" href="classTimerOutput.html">TimerOutput</a>::wall_times)</div>
<div class="line">{}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemmake_grid"></a> </p><h4>GelfandProblem::make_grid</h4>
<p>As the computational domain we use the <code>dim</code>-dimensional unit ball. We follow the instructions for the <a class="el" href="classTransfiniteInterpolationManifold.html">TransfiniteInterpolationManifold</a> class and also assign a <a class="el" href="classSphericalManifold.html">SphericalManifold</a> for the boundary. Finally, we refine the initial mesh 3 - <code>dim</code> times globally.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="step-2_8cc.html#ab108b7b7bca84a81aceda045aaef1961">GelfandProblem&lt;dim, fe_degree&gt;::make_grid</a>()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;make grid&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classSphericalManifold.html">SphericalManifold&lt;dim&gt;</a>                boundary_manifold;</div>
<div class="line">  <a class="code" href="classTransfiniteInterpolationManifold.html">TransfiniteInterpolationManifold&lt;dim&gt;</a> inner_manifold;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceGridGenerator.html#a533c4778cbc9bcbed365dcab42ca4418">GridGenerator::hyper_ball</a>(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.set_all_manifold_ids(1);</div>
<div class="line">  <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.set_all_manifold_ids_on_boundary(0);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.set_manifold(0, boundary_manifold);</div>
<div class="line"> </div>
<div class="line">  inner_manifold.<a class="code" href="classTransfiniteInterpolationManifold.html#a34326a35d9ec4b6911d90c85c21847d8">initialize</a>(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>);</div>
<div class="line">  <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.set_manifold(1, inner_manifold);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.refine_global(3 - <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemsetup_system"></a> </p><h4>GelfandProblem::setup_system</h4>
<p>The <code>setup_system()</code> function is quasi identical to the one in <a class="el" href="step_37.html">step-37</a>. The only differences are obviously the time measurement with only one <a class="el" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> instead of measuring each part individually, and more importantly the initialization of the <a class="el" href="classMGLevelObject.html">MGLevelObject</a> for the interpolated solution vector of the previous Newton step. Another important change is the setup of the <a class="el" href="classMGTransferMatrixFree.html">MGTransferMatrixFree</a> object, which we can reuse in each Newton step as the <code>triangulation</code> will not be not changed.</p>
<p>Note how we can use the same <a class="el" href="classMatrixFree.html">MatrixFree</a> object twice, for the <code>JacobianOperator</code> and the multigrid preconditioner.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::setup_system()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;setup system&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  system_matrix.clear();</div>
<div class="line">  mg_matrices.clear_elements();</div>
<div class="line"> </div>
<div class="line">  dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
<div class="line">  dof_handler.<a class="code" href="classDoFHandler.html#a9aed31323cbd7619edac310c47e7a7ad">distribute_mg_dofs</a>();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classIndexSet.html">IndexSet</a> locally_relevant_dofs;</div>
<div class="line">  <a class="code" href="namespaceDoFTools.html#acad7e0841b9046eaafddc4c617ab1d9d">DoFTools::extract_locally_relevant_dofs</a>(dof_handler, locally_relevant_dofs);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#addd15bc409c61d6f795f0132c574335b">clear</a>();</div>
<div class="line">  <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#a2c9d71b5b7e8851c25a411ccf34de986">reinit</a>(locally_relevant_dofs);</div>
<div class="line">  <a class="code" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a>(dof_handler, <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>);</div>
<div class="line">  <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(dof_handler,</div>
<div class="line">                                           0,</div>
<div class="line">                                           <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(),</div>
<div class="line">                                           <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>);</div>
<div class="line">  <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div>
<div class="line"> </div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">typename</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, double&gt;::AdditionalData</a> additional_data;</div>
<div class="line">    additional_data.tasks_parallel_scheme =</div>
<div class="line">      <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, double&gt;::AdditionalData::partition_color</a>;</div>
<div class="line">    additional_data.mapping_update_flags =</div>
<div class="line">      (<a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> |</div>
<div class="line">       <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a>);</div>
<div class="line">    <span class="keyword">auto</span> system_mf_storage = std::make_shared&lt;MatrixFree&lt;dim, double&gt;&gt;();</div>
<div class="line">    system_mf_storage-&gt;<a class="code" href="classMatrixFree.html#adb324d469b296f2a6921b41208732ddf">reinit</a>(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                              dof_handler,</div>
<div class="line">                              <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>,</div>
<div class="line">                              <a class="code" href="classQGauss.html">QGauss&lt;1&gt;</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1),</div>
<div class="line">                              additional_data);</div>
<div class="line"> </div>
<div class="line">    system_matrix.initialize(system_mf_storage);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  system_matrix.initialize_dof_vector(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line">  system_matrix.initialize_dof_vector(newton_update);</div>
<div class="line">  system_matrix.initialize_dof_vector(system_rhs);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nlevels = <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels();</div>
<div class="line">  mg_matrices.resize(0, nlevels - 1);</div>
<div class="line">  mg_solution.resize(0, nlevels - 1);</div>
<div class="line"> </div>
<div class="line">  std::set&lt;types::boundary_id&gt; dirichlet_boundary;</div>
<div class="line">  dirichlet_boundary.insert(0);</div>
<div class="line">  mg_constrained_dofs.initialize(dof_handler);</div>
<div class="line">  mg_constrained_dofs.make_zero_boundary_constraints(dof_handler,</div>
<div class="line">                                                     dirichlet_boundary);</div>
<div class="line"> </div>
<div class="line">  mg_transfer.<a class="code" href="classMGTransferMatrixFree.html#a69e2b416ab209936f94db08e865cd92b">initialize_constraints</a>(mg_constrained_dofs);</div>
<div class="line">  mg_transfer.<a class="code" href="classMGTransferMatrixFree.html#a8f214ffade006cfa85e902a94902fc7b">build</a>(dof_handler);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; nlevels; ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classIndexSet.html">IndexSet</a> relevant_dofs;</div>
<div class="line">      <a class="code" href="namespaceDoFTools.html#a1fef7be07cf379b661646e39b9354e17">DoFTools::extract_locally_relevant_level_dofs</a>(dof_handler,</div>
<div class="line">                                                    <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>,</div>
<div class="line">                                                    relevant_dofs);</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> level_constraints;</div>
<div class="line">      level_constraints.<a class="code" href="classAffineConstraints.html#a2c9d71b5b7e8851c25a411ccf34de986">reinit</a>(relevant_dofs);</div>
<div class="line">      level_constraints.<a class="code" href="classAffineConstraints.html#aef97b22281acb10c914d79a3881e2735">add_lines</a>(</div>
<div class="line">        mg_constrained_dofs.get_boundary_indices(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">      level_constraints.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">typename</span> <a class="code" href="structMatrixFree_1_1AdditionalData.html">MatrixFree&lt;dim, float&gt;::AdditionalData</a> additional_data;</div>
<div class="line">      additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a0bcce2facca91b925d3e1a5a00c7704b">tasks_parallel_scheme</a> =</div>
<div class="line">        <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, float&gt;::AdditionalData::partition_color</a>;</div>
<div class="line">      additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#aa5d597e6c4441d273f4100b6139a2552">mapping_update_flags</a> =</div>
<div class="line">        (<a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> |</div>
<div class="line">         <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a>);</div>
<div class="line">      additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a67c9ff01c51fb7fb3ada151b83cdd409">mg_level</a> = <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>;</div>
<div class="line">      <span class="keyword">auto</span> mg_mf_storage_level = std::make_shared&lt;MatrixFree&lt;dim, float&gt;&gt;();</div>
<div class="line">      mg_mf_storage_level-&gt;<a class="code" href="classMultigrid.html#af3c33c4008b7b0d13c69d097fda50630">reinit</a>(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                  dof_handler,</div>
<div class="line">                                  level_constraints,</div>
<div class="line">                                  <a class="code" href="classQGauss.html">QGauss&lt;1&gt;</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1),</div>
<div class="line">                                  additional_data);</div>
<div class="line"> </div>
<div class="line">      mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].initialize(mg_mf_storage_level,</div>
<div class="line">                                    mg_constrained_dofs,</div>
<div class="line">                                    <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">      mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].initialize_dof_vector(mg_solution[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>]);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemevaluate_residual"></a> </p><h4>GelfandProblem::evaluate_residual</h4>
<p>Next we implement a function which evaluates the nonlinear discrete residual for a given input vector ( \(\texttt{dst} = F(\texttt{src})\)). This function is then used for the assembly of the right hand side of the linearized system and later for the computation of the residual of the next Newton step to check if we already reached the error tolerance. As this function should not affect any class variable we define it as a constant function. Internally we exploit the fast finite element evaluation through the <a class="el" href="classFEEvaluation.html">FEEvaluation</a> class and the <a class="el" href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">MatrixFree::cell_loop()</a>, similar to <code><a class="el" href="operators__0_8txt.html#a92cb2920df95b6f107c2c9a8c75b788c">apply_add()</a></code> function of the <code>JacobianOperator</code>.</p>
<p>First we create a pointer to the <a class="el" href="classMatrixFree.html">MatrixFree</a> object, which is stored in the <code>system_matrix</code>. Then we pass the worker function <code>local_evaluate_residual()</code> for the cell wise evaluation of the residual together with the input and output vector to the <a class="el" href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">MatrixFree::cell_loop()</a>. In addition, we enable the zero out of the output vector in the loop, which is more efficient than calling <code>dst = 0.0</code> separately before.</p>
<p>Note that with this approach we do not have to take care about the MPI related data exchange, since all the bookkeeping is done by the <a class="el" href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">MatrixFree::cell_loop()</a>.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::evaluate_residual(</div>
<div class="line">  <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;src)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keyword">auto</span> matrix_free = system_matrix.get_matrix_free();</div>
<div class="line"> </div>
<div class="line">  matrix_free-&gt;cell_loop(</div>
<div class="line">    &amp;GelfandProblem::local_evaluate_residual, <span class="keyword">this</span>, <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>, src, <span class="keyword">true</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemlocal_evaluate_residual"></a> </p><h4>GelfandProblem::local_evaluate_residual</h4>
<p>This is the internal worker function for the evaluation of the residual. Essentially it has the same structure as the <code>local_apply()</code> function of the <code>JacobianOperator</code> and evaluates the residual for the input vector <code>src</code> on the given set of cells <code>cell_range</code>. The difference to the above mentioned <code>local_apply()</code> function is, that we split the <a class="el" href="classFEEvaluation.html#ab53d5c08f460cfe6c9830ac14a427115">FEEvaluation::gather_evaluate()</a> function into FEEvaluation::read_dof_values_plain() and <a class="el" href="classFEEvaluation.html#a710c252e9dccc0c4ce07044cac3bdd9b">FEEvaluation::evaluate()</a>, since the input vector might have constrained DOFs.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::local_evaluate_residual(</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, double&gt;</a> &amp;                   <a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>,</div>
<div class="line">  <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;src,</div>
<div class="line">  <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;     cell_range)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, fe_degree, fe_degree + 1, 1, double&gt;</a> phi(<a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> = cell_range.first; <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> &lt; cell_range.second; ++<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>)</div>
<div class="line">    {</div>
<div class="line">      phi.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">      phi.read_dof_values_plain(src);</div>
<div class="line">      phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> | <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">        {</div>
<div class="line">          phi.submit_value(-std::exp(phi.get_value(q)), q);</div>
<div class="line">          phi.submit_gradient(phi.get_gradient(q), q);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      phi.integrate_scatter(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> |</div>
<div class="line">                              <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>,</div>
<div class="line">                            <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemassemble_rhs"></a> </p><h4>GelfandProblem::assemble_rhs</h4>
<p>Using the above function <code>evaluate_residual()</code> to evaluate the nonlinear residual, the assembly of the right hand side of the linearized system becomes now a very easy task. We just call the <code>evaluate_residual()</code> function and multiply the result with minus one.</p>
<p>Experiences show that using the <a class="el" href="classFEEvaluation.html">FEEvaluation</a> class is much faster than a classical implementation with <a class="el" href="classFEValues.html">FEValues</a> and co.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::assemble_rhs()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;assemble right hand side&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  evaluate_residual(system_rhs, <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line">  system_rhs *= -1.0;</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemcompute_residual"></a> </p><h4>GelfandProblem::compute_residual</h4>
<p>According to <a class="el" href="step_15.html">step-15</a> the following function computes the norm of the nonlinear residual for the solution \(u_h^n + \alpha s_h^n\) with the help of the <code>evaluate_residual()</code> function. The Newton step length \(\alpha\) becomes important if we would use an adaptive version of the Newton method. Then for example we would compute the residual for different step lengths and compare the residuals. However, for our problem the full Newton step with \(\alpha=1\) is the best we can do. An adaptive version of Newton's method becomes interesting if we have no good initial value. Note that in theory Newton's method converges with quadratic order, but only if we have an appropriate initial value. For unsuitable initial values the Newton method diverges even with quadratic order. A common way is then to use a damped version \(\alpha&lt;1\) until the Newton step is good enough and the full Newton step can be performed. This was also discussed in <a class="el" href="step_15.html">step-15</a>.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">double</span> GelfandProblem&lt;dim, fe_degree&gt;::compute_residual(<span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;compute residual&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> <a class="code" href="newton__0_8txt.html#a21f536f84dd77674667ed5d2a30eb3ab">residual</a>;</div>
<div class="line">  <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> evaluation_point;</div>
<div class="line"> </div>
<div class="line">  system_matrix.initialize_dof_vector(<a class="code" href="newton__0_8txt.html#a21f536f84dd77674667ed5d2a30eb3ab">residual</a>);</div>
<div class="line">  system_matrix.initialize_dof_vector(evaluation_point);</div>
<div class="line"> </div>
<div class="line">  evaluation_point = <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>;</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a> &gt; 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-12)</div>
<div class="line">    {</div>
<div class="line">      evaluation_point.<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html#ac029174b48a0707da587b6ce3bc25047">add</a>(<a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>, newton_update);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  evaluate_residual(<a class="code" href="newton__0_8txt.html#a21f536f84dd77674667ed5d2a30eb3ab">residual</a>, evaluation_point);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="newton__0_8txt.html#a21f536f84dd77674667ed5d2a30eb3ab">residual</a>.l2_norm();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemcompute_update"></a> </p><h4>GelfandProblem::compute_update</h4>
<p>In order to compute the Newton updates in each Newton step we solve the linear system with the CG algorithm together with a geometric multigrid preconditioner. For this we first set up the <a class="el" href="classPreconditionMG.html">PreconditionMG</a> object with a Chebyshev smoother like we did in <a class="el" href="step_37.html">step-37</a>.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::compute_update()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;compute update&quot;</span>);</div>
</div><!-- fragment --><p>We remember that the Jacobian depends on the last Newton step stored in the solution vector. So we update the ghost values of the Newton step and pass it to the <code>JacobianOperator</code> to store the information.</p>
<div class="fragment"><div class="line"><a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.update_ghost_values();</div>
<div class="line"> </div>
<div class="line">system_matrix.evaluate_newton_step(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
</div><!-- fragment --><p>Next we also have to pass the last Newton step to the multilevel operators. Therefore, we need to interpolate the Newton step to all levels of the triangulation. This is done with the <a class="el" href="classMGTransferMatrixFree.html#a90aef560cc3d832589ca13a5f18e1414">MGTransferMatrixFree::interpolate_to_mg()</a>.</p>
<div class="fragment"><div class="line">mg_transfer.<a class="code" href="classMGTransferMatrixFree.html#a90aef560cc3d832589ca13a5f18e1414">interpolate_to_mg</a>(dof_handler, mg_solution, <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
</div><!-- fragment --><p>Now we can set up the preconditioner. We define the smoother and pass the interpolated vectors of the Newton step to the multilevel operators.</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> SmootherType =</div>
<div class="line">  <a class="code" href="classPreconditionChebyshev.html">PreconditionChebyshev</a>&lt;LevelMatrixType,</div>
<div class="line">                        <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt;;</div>
<div class="line"><a class="code" href="classmg_1_1SmootherRelaxation.html">mg::SmootherRelaxation</a>&lt;SmootherType,</div>
<div class="line">                       <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt;</div>
<div class="line">                                                     mg_smoother;</div>
<div class="line"><a class="code" href="classMGLevelObject.html">MGLevelObject&lt;typename SmootherType::AdditionalData&gt;</a> smoother_data;</div>
<div class="line">smoother_data.<a class="code" href="classMGLevelObject.html#a16213121f9153bd08f49652a11886259">resize</a>(0, <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels() - 1);</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels();</div>
<div class="line">     ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &gt; 0)</div>
<div class="line">      {</div>
<div class="line">        smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].smoothing_range     = 15.;</div>
<div class="line">        smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].degree              = 4;</div>
<div class="line">        smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].eig_cg_n_iterations = 10;</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        smoother_data[0].smoothing_range = 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-3;</div>
<div class="line">        smoother_data[0].degree          = <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>;</div>
<div class="line">        smoother_data[0].eig_cg_n_iterations = mg_matrices[0].m();</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].evaluate_newton_step(mg_solution[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>]);</div>
<div class="line">    mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].compute_diagonal();</div>
<div class="line"> </div>
<div class="line">    smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].preconditioner =</div>
<div class="line">      mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].get_matrix_diagonal_inverse();</div>
<div class="line">  }</div>
<div class="line">mg_smoother.initialize(mg_matrices, smoother_data);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classMGCoarseGridApplySmoother.html">MGCoarseGridApplySmoother&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt;</div>
<div class="line">  mg_coarse;</div>
<div class="line">mg_coarse.<a class="code" href="classMGCoarseGridApplySmoother.html#a499c7364e40031332e9943a2e5f331a2">initialize</a>(mg_smoother);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt; mg_matrix(</div>
<div class="line">  mg_matrices);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classMGLevelObject.html">MGLevelObject&lt;MatrixFreeOperators::MGInterfaceOperator&lt;LevelMatrixType&gt;</a>&gt;</div>
<div class="line">  mg_interface_matrices;</div>
<div class="line">mg_interface_matrices.<a class="code" href="classMGLevelObject.html#a16213121f9153bd08f49652a11886259">resize</a>(0, <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels() - 1);</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels();</div>
<div class="line">     ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">  {</div>
<div class="line">    mg_interface_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].initialize(mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>]);</div>
<div class="line">  }</div>
<div class="line"><a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt; mg_interface(</div>
<div class="line">  mg_interface_matrices);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classMultigrid.html">Multigrid&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt; <a class="code" href="namespacemg.html">mg</a>(</div>
<div class="line">  mg_matrix, mg_coarse, mg_transfer, mg_smoother, mg_smoother);</div>
<div class="line"><a class="code" href="namespacemg.html">mg</a>.set_edge_matrices(mg_interface, mg_interface);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classPreconditionMG.html">PreconditionMG</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>,</div>
<div class="line">               <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;float&gt;</a>,</div>
<div class="line">               <a class="code" href="classMGTransferMatrixFree.html">MGTransferMatrixFree&lt;dim, float&gt;</a>&gt;</div>
<div class="line">  <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>(dof_handler, <a class="code" href="namespacemg.html">mg</a>, mg_transfer);</div>
</div><!-- fragment --><p>Finally we set up the <a class="el" href="classSolverControl.html">SolverControl</a> and the <a class="el" href="classSolverCG.html">SolverCG</a> to solve the linearized problem for the current Newton update. An important fact of the implementation of <a class="el" href="classSolverCG.html">SolverCG</a> or also <a class="el" href="classSolverGMRES.html">SolverGMRES</a> is, that the vector holding the solution of the linear system (here <code>newton_update</code>) can be used to pass a starting value. In order to start the iterative solver always with a zero vector we reset the <code>newton_update</code> explicitly before calling <a class="el" href="classSolverCG.html#aa52469650d9b9ef2f4cb4884caeb0723">SolverCG::solve()</a>. Afterwards we distribute the Dirichlet boundary conditions stored in <code>constraints</code> and store the number of iteration steps for the later output.</p>
<div class="fragment"><div class="line"><a class="code" href="classSolverControl.html">SolverControl</a> solver_control(100, 1.<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-12);</div>
<div class="line"><a class="code" href="classSolverCG.html">SolverCG&lt;LinearAlgebra::distributed::Vector&lt;double&gt;</a>&gt; cg(solver_control);</div>
<div class="line"> </div>
<div class="line">newton_update = 0.0;</div>
<div class="line"> </div>
<div class="line">cg.solve(system_matrix, newton_update, system_rhs, <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">distribute</a>(newton_update);</div>
<div class="line"> </div>
<div class="line">linear_iterations = solver_control.<a class="code" href="classSolverControl.html#a42aeae81cd6b67ce93b5fbea3328371f">last_step</a>();</div>
</div><!-- fragment --><p>Then for bookkeeping we zero out the ghost values.</p>
<div class="fragment"><div class="line">  <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.zero_out_ghost_values();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemsolve"></a> </p><h4>GelfandProblem::solve</h4>
<p>Now we implement the actual Newton solver for the nonlinear problem.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">GelfandProblem&lt;dim, fe_degree&gt;::solve</a>()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;solve&quot;</span>);</div>
</div><!-- fragment --><p>We define a maximal number of Newton steps and tolerances for the convergence criterion. Usually, with good starting values, the Newton method converges in three to six steps, so maximal ten steps should be totally sufficient. As tolerances we use \(\|F(u^n_h)\|&lt;\text{TOL}_f = 10^{-12}\) for the norm of the residual and \(\|s_h^n\| &lt; \text{TOL}_x = 10^{-10}\) for the norm of the Newton update. This seems a bit over the top, but we will see that, for our example, we will achieve these tolerances after a few steps.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> itmax = 10;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span>       TOLf  = 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-12;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span>       TOLx  = 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-10;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><a class="code" href="classTimer.html">Timer</a> solver_timer;</div>
<div class="line">solver_timer.<a class="code" href="classTimer.html#a3a8b5272198d029779dc9302a54305a8">start</a>();</div>
</div><!-- fragment --><p>Now we start the actual Newton iteration.</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> newton_step = 1; newton_step &lt;= itmax; ++newton_step)</div>
<div class="line">  {</div>
</div><!-- fragment --><p>We assemble the right hand side of the linearized problem and compute the Newton update.</p>
<div class="fragment"><div class="line">assemble_rhs();</div>
<div class="line">compute_update();</div>
</div><!-- fragment --><p>Then we compute the errors, namely the norm of the Newton update and the residual. Note that at this point one could incorporate a step size control for the Newton method by varying the input parameter \(\alpha\) for the compute_residual function. However, here we just use \(\alpha\) equal to one for a plain Newton iteration.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> ERRx = newton_update.<a class="code" href="classBlockVectorBase.html#ac718033fc083f27c45c6bfb4ac780360">l2_norm</a>();</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> ERRf = compute_residual(1.0);</div>
</div><!-- fragment --><p>Next we advance the Newton step by adding the Newton update to the current Newton step.</p>
<div class="fragment"><div class="line"><a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.add(1.0, newton_update);</div>
</div><!-- fragment --><p>A short output will inform us on the current Newton step.</p>
<div class="fragment"><div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;   Nstep &quot;</span> &lt;&lt; newton_step &lt;&lt; <span class="stringliteral">&quot;, errf = &quot;</span> &lt;&lt; ERRf</div>
<div class="line">      &lt;&lt; <span class="stringliteral">&quot;, errx = &quot;</span> &lt;&lt; ERRx &lt;&lt; <span class="stringliteral">&quot;, it = &quot;</span> &lt;&lt; linear_iterations</div>
<div class="line">      &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>After each Newton step we check the convergence criteria. If at least one of those is fulfilled we are done and end the loop. If we haven't found a satisfying solution after the maximal amount of Newton iterations, we inform the user about this shortcoming.</p>
<div class="fragment"><div class="line">      <span class="keywordflow">if</span> (ERRf &lt; TOLf || ERRx &lt; TOLx)</div>
<div class="line">        {</div>
<div class="line">          solver_timer.<a class="code" href="classTimer.html#a988f79aa183d9d5473c13106f5babe48">stop</a>();</div>
<div class="line"> </div>
<div class="line">          pcout &lt;&lt; <span class="stringliteral">&quot;Convergence step &quot;</span> &lt;&lt; newton_step &lt;&lt; <span class="stringliteral">&quot; value &quot;</span> &lt;&lt; ERRf</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot; (used wall time: &quot;</span> &lt;&lt; solver_timer.<a class="code" href="classTimer.html#a6f3e76707411b51e7d7e7bfa5755cf02">wall_time</a>() &lt;&lt; <span class="stringliteral">&quot; s)&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (newton_step == itmax)</div>
<div class="line">        {</div>
<div class="line">          solver_timer.<a class="code" href="classTimer.html#a988f79aa183d9d5473c13106f5babe48">stop</a>();</div>
<div class="line">          pcout &lt;&lt; <span class="stringliteral">&quot;WARNING: No convergence of Newton&#39;s method after &quot;</span></div>
<div class="line">                &lt;&lt; newton_step &lt;&lt; <span class="stringliteral">&quot; steps.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemcompute_solution_norm"></a> </p><h4>GelfandProblem::compute_solution_norm</h4>
<p>The computation of the H1-seminorm of the solution can be done in the same way as in <a class="el" href="step_59.html">step-59</a>. We update the ghost values and use the function <a class="el" href="namespaceVectorTools.html#a676190d2c897ac5da68a9c460fa95832">VectorTools::integrate_difference()</a>. In the end we gather all computations from all MPI ranks and return the norm.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">double</span> GelfandProblem&lt;dim, fe_degree&gt;::compute_solution_norm()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.update_ghost_values();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;float&gt;</a> norm_per_cell(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells());</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceVectorTools.html#a676190d2c897ac5da68a9c460fa95832">VectorTools::integrate_difference</a>(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                    dof_handler,</div>
<div class="line">                                    <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>,</div>
<div class="line">                                    <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(),</div>
<div class="line">                                    norm_per_cell,</div>
<div class="line">                                    <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 2),</div>
<div class="line">                                    <a class="code" href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1a7c450aee1986e226cf1bd7687171d769">VectorTools::H1_seminorm</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.zero_out_ghost_values();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="namespaceVectorTools.html#a21eb62d70953182dcc2b15c4e14dd533">VectorTools::compute_global_error</a>(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>,</div>
<div class="line">                                           norm_per_cell,</div>
<div class="line">                                           <a class="code" href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1a7c450aee1986e226cf1bd7687171d769">VectorTools::H1_seminorm</a>);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemoutput_results"></a> </p><h4>GelfandProblem::output_results</h4>
<p>We generate the graphical output files in vtu format together with a pvtu master file at once by calling the <a class="el" href="classDataOutInterface.html#a0864e51eb173c87e2a3edc9391ea8009">DataOut::write_vtu_with_pvtu_record()</a> function in the same way as in <a class="el" href="step_37.html">step-37</a>. In addition, as in <a class="el" href="step_40.html">step-40</a>, we query the <a class="el" href="namespacetypes.html#a34b501118128294d2bc316a1b052454f">types::subdomain_id</a> of each cell and write the distribution of the triangulation among the MPI ranks into the output file. Finally, we generate the patches of the solution by calling <a class="el" href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">DataOut::build_patches()</a>. However, since we have a computational domain with a curved boundary, we additionally pass the <code>mapping</code> and the finite element degree as number of subdivision. But this is still not enough for the correct representation of the solution, for example in ParaView, because we attached a <a class="el" href="classTransfiniteInterpolationManifold.html">TransfiniteInterpolationManifold</a> to the inner cells, which results in curved cells in the interior. Therefore we pass as third argument the <a class="el" href="classDataOut.html#a1303b5d99f10f3fae984e7d406cfeb37a7996b4e7bad0b5fe0630f3eb57d48313">DataOut::curved_inner_cells</a> option, such that also the inner cells use the corresponding manifold description to build the patches.</p>
<p>Note that we could handle the higher order elements with the flag <a class="el" href="group__Exceptions.html#gaa9dd1830c0ff35a2431704c4d45453eb">DataOutBase::VtkFlags::write_higher_order_cells</a>. However, due to the limited compatibility to previous version of ParaView and the missing support by VisIt, we left this option for a future version.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">GelfandProblem&lt;dim, fe_degree&gt;::output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_active_cells() &gt; 1e6)</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.update_ghost_values();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">attach_dof_handler</a>(dof_handler);</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, <span class="stringliteral">&quot;solution&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;float&gt;</a> <a class="code" href="index__set__0_8txt.html#a85fb0893d080862c6fc2fbcb1e57a791">subdomain</a>(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells());</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="index__set__0_8txt.html#a85fb0893d080862c6fc2fbcb1e57a791">subdomain</a>.size(); ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="index__set__0_8txt.html#a85fb0893d080862c6fc2fbcb1e57a791">subdomain</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>) = <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.locally_owned_subdomain();</div>
<div class="line">    }</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(<a class="code" href="index__set__0_8txt.html#a85fb0893d080862c6fc2fbcb1e57a791">subdomain</a>, <span class="stringliteral">&quot;subdomain&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  data_out.<a class="code" href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">build_patches</a>(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                         <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a>,</div>
<div class="line">                         <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;::curved_inner_cells</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="structDataOutBase_1_1VtkFlags.html">DataOutBase::VtkFlags</a> <a class="code" href="update__flags__0_8txt.html#ac8b7167f13d273c0000a680958db42c5">flags</a>;</div>
<div class="line">  <a class="code" href="update__flags__0_8txt.html#ac8b7167f13d273c0000a680958db42c5">flags</a>.compression_level = <a class="code" href="group__Exceptions.html#ga7ad65742b9dbfb7eeb04b511b5a08d63a3c83e26f202f837328b9f7532773be70">DataOutBase::VtkFlags::best_speed</a>;</div>
<div class="line">  data_out.<a class="code" href="classDataOutInterface.html#ac7280a24690b117454acfb0fa058299c">set_flags</a>(<a class="code" href="update__flags__0_8txt.html#ac8b7167f13d273c0000a680958db42c5">flags</a>);</div>
<div class="line">  data_out.<a class="code" href="classDataOutInterface.html#a0864e51eb173c87e2a3edc9391ea8009">write_vtu_with_pvtu_record</a>(</div>
<div class="line">    <span class="stringliteral">&quot;./&quot;</span>, <span class="stringliteral">&quot;solution_&quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>) + <span class="stringliteral">&quot;d&quot;</span>, <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>, MPI_COMM_WORLD, 3);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.zero_out_ghost_values();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemrun"></a> </p><h4>GelfandProblem::run</h4>
<p>The last missing function of the solver class for the <em>Gelfand problem</em> is the run function. In the beginning we print information about the system specifications and the finite element space we use. The problem is solved several times on a successively refined mesh.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">GelfandProblem&lt;dim, fe_degree&gt;::run</a>()</div>
<div class="line">{</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_ranks =</div>
<div class="line">      <a class="code" href="namespaceUtilities_1_1MPI.html#ac26de0c059200523177bb1d92cc25d00">Utilities::MPI::n_mpi_processes</a>(MPI_COMM_WORLD);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_vect_doubles = <a class="code" href="classVectorizedArrayBase.html#acb35404acc1693aee6e990228924cc09">VectorizedArray&lt;double&gt;::size</a>();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_vect_bits    = 8 * <span class="keyword">sizeof</span>(<a class="code" href="hdf5__0_8txt.html#aae153b86de45d3354cd3edd5b992435e">double</a>) * n_vect_doubles;</div>
<div class="line"> </div>
<div class="line">    std::string DAT_header = <span class="stringliteral">&quot;START DATE: &quot;</span> + <a class="code" href="namespaceUtilities_1_1System.html#aff548b3b9b7a035ea112729700ef7c64">Utilities::System::get_date</a>() +</div>
<div class="line">                             <span class="stringliteral">&quot;, TIME: &quot;</span> + <a class="code" href="namespaceUtilities_1_1System.html#a76bc1cc7649cc416723f450d24fdd91d">Utilities::System::get_time</a>();</div>
<div class="line">    std::string MPI_header = <span class="stringliteral">&quot;Running with &quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(n_ranks) +</div>
<div class="line">                             <span class="stringliteral">&quot; MPI process&quot;</span> + (n_ranks &gt; 1 ? <span class="stringliteral">&quot;es&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">    std::string VEC_header =</div>
<div class="line">      <span class="stringliteral">&quot;Vectorization over &quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(n_vect_doubles) +</div>
<div class="line">      <span class="stringliteral">&quot; doubles = &quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(n_vect_bits) + <span class="stringliteral">&quot; bits (&quot;</span> +</div>
<div class="line">      <a class="code" href="namespaceUtilities_1_1System.html#ade631a789101336840371e3b2e2851e0">Utilities::System::get_current_vectorization_level</a>() +</div>
<div class="line">      <span class="stringliteral">&quot;), VECTORIZATION_LEVEL=&quot;</span> +</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(<a class="code" href="config_8h.html#a32dc208a29f23d1f031fb40b0d21e60e">DEAL_II_COMPILER_VECTORIZATION_LEVEL</a>);</div>
<div class="line">    std::string SOL_header = <span class="stringliteral">&quot;Finite element space: &quot;</span> + <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFE__Q.html#aef8e62ce116e341818549d1730343792">get_name</a>();</div>
<div class="line"> </div>
<div class="line">    pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;=&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line">    pcout &lt;&lt; DAT_header &lt;&lt; std::endl;</div>
<div class="line">    pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;-&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    pcout &lt;&lt; MPI_header &lt;&lt; std::endl;</div>
<div class="line">    pcout &lt;&lt; VEC_header &lt;&lt; std::endl;</div>
<div class="line">    pcout &lt;&lt; SOL_header &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;=&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> = 0; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt; 9 - <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>)</div>
<div class="line">    {</div>
<div class="line">      pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;-&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line">      pcout &lt;&lt; <span class="stringliteral">&quot;Cycle &quot;</span> &lt;&lt; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt;&lt; std::endl;</div>
<div class="line">      pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;-&#39;</span>) &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>The first task in actually solving the problem is to generate or refine the triangulation.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> == 0)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="step-2_8cc.html#ab108b7b7bca84a81aceda045aaef1961">make_grid</a>();</div>
<div class="line">  }</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.refine_global(1);</div>
<div class="line">  }</div>
</div><!-- fragment --><p>Now we set up the system and solve the problem. These steps are accompanied by time measurement and textual output.</p>
<div class="fragment"><div class="line"><a class="code" href="classTimer.html">Timer</a> timer;</div>
<div class="line"> </div>
<div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;Set up system...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">setup_system();</div>
<div class="line"> </div>
<div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;   Triangulation: &quot;</span> &lt;&lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_active_cells()</div>
<div class="line">      &lt;&lt; <span class="stringliteral">&quot; cells&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;   DoFHandler:    &quot;</span> &lt;&lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>() &lt;&lt; <span class="stringliteral">&quot; DoFs&quot;</span></div>
<div class="line">      &lt;&lt; std::endl;</div>
<div class="line">pcout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;Solve using Newton&#39;s method...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>();</div>
<div class="line">pcout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">timer.<a class="code" href="classTimer.html#a988f79aa183d9d5473c13106f5babe48">stop</a>();</div>
<div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;Time for setup+solve (CPU/Wall) &quot;</span> &lt;&lt; timer.<a class="code" href="classTimer.html#a4e3933a78790d7455daff5acab3f8432">cpu_time</a>() &lt;&lt; <span class="stringliteral">&quot;/&quot;</span></div>
<div class="line">      &lt;&lt; timer.<a class="code" href="classTimer.html#a6f3e76707411b51e7d7e7bfa5755cf02">wall_time</a>() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">pcout &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>After the problem was solved we compute the norm of the solution and generate the graphical output files.</p>
<div class="fragment"><div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;Output results...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="multithreading__0_8txt.html#a0759c0124e216ec36f063ad051f4dba0">norm</a> = compute_solution_norm();</div>
<div class="line">output_results(<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>);</div>
<div class="line"> </div>
<div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;  H1 seminorm: &quot;</span> &lt;&lt; <a class="code" href="multithreading__0_8txt.html#a0759c0124e216ec36f063ad051f4dba0">norm</a> &lt;&lt; std::endl;</div>
<div class="line">pcout &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>Finally after each cycle we print the timing information.</p>
<div class="fragment"><div class="line">        computing_timer.print_summary();</div>
<div class="line">        computing_timer.reset();</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Step66</span></div>
</div><!-- fragment --><p><a class="anchor" id="Thecodemaincodefunction"></a> </p><h3>The <code>main</code> function</h3>
<p>As typical for programs running in parallel with MPI we set up the MPI framework and disable shared-memory parallelization by limiting the number of threads to one. Finally to run the solver for the <em>Gelfand problem</em> we create an object of the <code>GelfandProblem</code> class and call the run function. Exemplarily we solve the problem once in 2D and once in 3D each with fourth-order Lagrangian finite elements.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">using namespace </span><a class="code" href="namespaceStep66.html">Step66</a>;</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classUtilities_1_1MPI_1_1MPI__InitFinalize.html">Utilities::MPI::MPI_InitFinalize</a> mpi_init(argc, argv, 1);</div>
<div class="line"> </div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem&lt;2, 4&gt;</a> gelfand_problem;</div>
<div class="line">        gelfand_problem.run();</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem&lt;3, 4&gt;</a> gelfand_problem;</div>
<div class="line">        gelfand_problem.run();</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (<a class="code" href="parameter__handler__0_8txt.html#ad919e2b915d8e8226aef004c2d8399a8">std::exception</a> &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p> <a class="anchor" id="Results"></a></p><h1>Results</h1>
<p>The aim of this tutorial step was to demonstrate the solution of a nonlinear PDE with the matrix-free framework.</p>
<p><a class="anchor" id="Programoutput"></a></p><h3>Program output</h3>
<p>Running the program on two processes in release mode via </p><div class="fragment"><div class="line">cmake . &amp;&amp; make <a class="code" href="A-headers_2exceptions__0_8txt.html#a8cc3d8e2210ca7ca38c1daa0e678229d">release</a> &amp;&amp; make &amp;&amp; mpirun -<a class="code" href="petsc__matrix__base__0_8txt.html#a5a1b8b75c93e6ea5e27829c4fe862a8e">n</a> 2 ./<a class="code" href="table__handler__0_8txt.html#a61e9964f9093088848525ca172895749">step</a>-66</div>
</div><!-- fragment --><p> gives the following output on the console </p><div class="fragment"><div class="line">================================================================================</div>
<div class="line">START DATE: 2021/5/18, TIME: 16:25:48</div>
<div class="line">--------------------------------------------------------------------------------</div>
<div class="line">Running <a class="code" href="multithreading__0_8txt.html#af35ca33203cd802325d779be7b6b41e8">with</a> 2 <a class="code" href="base_2partitioner__0_8txt.html#a6d2d0fa485d1660823c59c494fb0fb31">MPI</a> <a class="code" href="scalapack__0_8txt.html#ac82ea4a38e10783662981895e0a99f43">processes</a></div>
<div class="line">Vectorization over 4 doubles = 256 bits (AVX), VECTORIZATION_LEVEL=2</div>
<div class="line">Finite <a class="code" href="distributed__0_8txt.html#ac4c845555bda24566ddc584532b7fa57">element</a> <a class="code" href="geometry__and__primitives__0_8txt.html#ad687a359ee2f71b8471c9a49cc8172ad">space</a>: <a class="code" href="classFE__Q.html">FE_Q&lt;2&gt;</a>(4)</div>
<div class="line">================================================================================</div>
<div class="line">--------------------------------------------------------------------------------</div>
<div class="line">Cycle 0</div>
<div class="line">--------------------------------------------------------------------------------</div>
<div class="line">Set <a class="code" href="logstream__0_8txt.html#a9767aa0a3a9a2557fff9f4cf0eab48bb">up</a> <a class="code" href="distributed__0_8txt.html#adeac996b7de9cb86911e504716172e83">system</a>...</div>
<div class="line">   <a class="code" href="dofs__0_8txt.html#ace93ab11d5f75755b09a3368db091adc">Triangulation</a>: 20 <a class="code" href="distributed__0_8txt.html#aafea668ad0c451ac7a0fae0f558c36d7">cells</a></div>
<div class="line">   <a class="code" href="group__dofs.html#ga768cd565b5c25f1ac235586e36ac94d6">DoFHandler</a>:    337 <a class="code" href="dof__renumbering__0_8txt.html#a68829910788b5388e9fb6e50b17c1876">DoFs</a></div>
<div class="line"> </div>
<div class="line">Solve <span class="keyword">using</span> <a class="code" href="newton__0_8txt.html#a7ae4bec25ec0fbd4c3968d0926b5c7c6">Newton</a><span class="stringliteral">&#39;s method...</span></div>
<div class="line"><span class="stringliteral">   Nstep 1, errf = 0.00380835, errx = 3.61904, it = 7</span></div>
<div class="line"><span class="stringliteral">   Nstep 2, errf = 3.80167e-06, errx = 0.104353, it = 6</span></div>
<div class="line"><span class="stringliteral">   Nstep 3, errf = 3.97939e-12, errx = 0.00010511, it = 4</span></div>
<div class="line"><span class="stringliteral">   Nstep 4, errf = 2.28859e-13, errx = 1.07726e-10, it = 1</span></div>
<div class="line"><span class="stringliteral">Convergence step 4 value 2.28859e-13 (used wall time: 0.0096409 s)</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">Time for setup+solve (CPU/Wall) 0.015617/0.0156447 s</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">Output results...</span></div>
<div class="line"><span class="stringliteral">  H1 seminorm: 0.773426</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">+---------------------------------------------+------------+------------+</span></div>
<div class="line"><span class="stringliteral">| Total wallclock time elapsed since start    |    0.0286s |            |</span></div>
<div class="line"><span class="stringliteral">|                                             |            |            |</span></div>
<div class="line"><span class="stringliteral">| Section                         | no. calls |  wall time | % of total |</span></div>
<div class="line"><span class="stringliteral">+---------------------------------+-----------+------------+------------+</span></div>
<div class="line"><span class="stringliteral">| assemble right hand side        |         4 |  9.71e-05s |      0.34% |</span></div>
<div class="line"><span class="stringliteral">| compute residual                |         4 |  0.000137s |      0.48% |</span></div>
<div class="line"><span class="stringliteral">| compute update                  |         4 |   0.00901s |        32% |</span></div>
<div class="line"><span class="stringliteral">| make grid                       |         1 |   0.00954s |        33% |</span></div>
<div class="line"><span class="stringliteral">| setup system                    |         1 |   0.00585s |        20% |</span></div>
<div class="line"><span class="stringliteral">| solve                           |         1 |   0.00966s |        34% |</span></div>
<div class="line"><span class="stringliteral">+---------------------------------+-----------+------------+------------+</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">.</span></div>
<div class="line"><span class="stringliteral">.</span></div>
<div class="line"><span class="stringliteral">.</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">--------------------------------------------------------------------------------</span></div>
<div class="line"><span class="stringliteral">Cycle 6</span></div>
<div class="line"><span class="stringliteral">--------------------------------------------------------------------------------</span></div>
<div class="line"><span class="stringliteral">Set up system...</span></div>
<div class="line"><span class="stringliteral">   Triangulation: 81920 cells</span></div>
<div class="line"><span class="stringliteral">   DoFHandler:    1311745 DoFs</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">Solve using Newton&#39;</span><a class="code" href="vector__valued__0_8txt.html#add141cdc4d28d06d71948acb7f0c7150">s</a> <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a16cf6888fefc575ea41503c862c8e66d">method</a>...</div>
<div class="line">   Nstep 1, errf = 5.90478e-05, errx = 231.427, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#ac5d1c63883bb2a85710935e76a7dedd4">it</a> = 9</div>
<div class="line">   Nstep 2, errf = 5.89991e-08, errx = 6.67102, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#ac5d1c63883bb2a85710935e76a7dedd4">it</a> = 6</div>
<div class="line">   Nstep 3, errf = 4.28813e-13, errx = 0.0067188, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#ac5d1c63883bb2a85710935e76a7dedd4">it</a> = 4</div>
<div class="line">Convergence <a class="code" href="table__handler__0_8txt.html#a61e9964f9093088848525ca172895749">step</a> 3 <a class="code" href="functions__0_8txt.html#af9f808a82e8c618e2e7a19dd08a9eae3">value</a> 4.28813e-13 (<a class="code" href="hp__0_8txt.html#a68ab73a4ec065be1fdac93979ba49f51">used</a> wall <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a>: 4.82953 <a class="code" href="vector__valued__0_8txt.html#add141cdc4d28d06d71948acb7f0c7150">s</a>)</div>
<div class="line"> </div>
<div class="line">Time <span class="keywordflow">for</span> setup+<a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a> (CPU/Wall) 6.25094/6.37174 <a class="code" href="vector__valued__0_8txt.html#add141cdc4d28d06d71948acb7f0c7150">s</a></div>
<div class="line"> </div>
<div class="line">Output results...</div>
<div class="line">  H1 seminorm: 0.773426</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">+---------------------------------------------+------------+------------+</div>
<div class="line">| Total wallclock <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a> elapsed <a class="code" href="grid_2manifold__0_8txt.html#a02d8bd1db3a4d0b6d68a99a931ce1b83">since</a> <a class="code" href="timer__0_8txt.html#a48e9e3a8116df3cc4b62db810904e91f">start</a>    |      9.04s |            |</div>
<div class="line">|                                             |            |            |</div>
<div class="line">| <a class="code" href="grid_2grid__refinement__0_8txt.html#a8bdcf8330609e043ba26a394139934f2">Section</a>                         | <a class="code" href="multithreading__0_8txt.html#a4c0a7149e1927066d2fcdb356cb90f7b">no</a>. <a class="code" href="iterators__0_8txt.html#a6365596c7d2490c474cd0b7ce9722b37">calls</a> |  wall <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a> | % <a class="code" href="multithreading__0_8txt.html#a33468e75b7ea6d2e64b7e88c6ff1217a">of</a> total |</div>
<div class="line">+---------------------------------+-----------+------------+------------+</div>
<div class="line">| <a class="code" href="simple__0_8txt.html#a992b60343e16bcad1a2121a36857f2b6">assemble</a> <a class="code" href="reordering__0_8txt.html#abc892651c0b2805d80c1933e2fb51c1a">right</a> <a class="code" href="constraints__0_8txt.html#a836d12b85657b83a8978aff8d7672c23">hand</a> <a class="code" href="update__flags__0_8txt.html#a401b2012c153de7bc4c63a89c334e118">side</a>        |         3 |    0.0827s |      0.91% |</div>
<div class="line">| <a class="code" href="fe_2fe__0_8txt.html#a754f79d53a1f0ebfe04ff6b9ff4abb8a">compute</a> <a class="code" href="newton__0_8txt.html#a21f536f84dd77674667ed5d2a30eb3ab">residual</a>                |         3 |    0.0909s |         1% |</div>
<div class="line">| <a class="code" href="fe_2fe__0_8txt.html#a754f79d53a1f0ebfe04ff6b9ff4abb8a">compute</a> <a class="code" href="mpi__noncontiguous__partitioner__0_8txt.html#a4ef446c02d3d4efe2972f5e7130db5d0">update</a>                  |         3 |      4.65s |        51% |</div>
<div class="line">| setup <a class="code" href="distributed__0_8txt.html#adeac996b7de9cb86911e504716172e83">system</a>                    |         1 |      1.54s |        17% |</div>
<div class="line">| <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>                           |         1 |      4.83s |        53% |</div>
<div class="line">+---------------------------------+-----------+------------+------------+</div>
<div class="line"> </div>
<div class="line">================================================================================</div>
<div class="line">START DATE: 2021/5/18, TIME: 16:26:00</div>
<div class="line">--------------------------------------------------------------------------------</div>
<div class="line">Running <a class="code" href="multithreading__0_8txt.html#af35ca33203cd802325d779be7b6b41e8">with</a> 2 <a class="code" href="base_2partitioner__0_8txt.html#a6d2d0fa485d1660823c59c494fb0fb31">MPI</a> <a class="code" href="scalapack__0_8txt.html#ac82ea4a38e10783662981895e0a99f43">processes</a></div>
<div class="line">Vectorization over 4 doubles = 256 bits (AVX), VECTORIZATION_LEVEL=2</div>
<div class="line">Finite <a class="code" href="distributed__0_8txt.html#ac4c845555bda24566ddc584532b7fa57">element</a> <a class="code" href="geometry__and__primitives__0_8txt.html#ad687a359ee2f71b8471c9a49cc8172ad">space</a>: <a class="code" href="classFE__Q.html">FE_Q&lt;3&gt;</a>(4)</div>
<div class="line">================================================================================</div>
<div class="line"> </div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line"> </div>
<div class="line">--------------------------------------------------------------------------------</div>
<div class="line">Cycle 5</div>
<div class="line">--------------------------------------------------------------------------------</div>
<div class="line">Set <a class="code" href="logstream__0_8txt.html#a9767aa0a3a9a2557fff9f4cf0eab48bb">up</a> <a class="code" href="distributed__0_8txt.html#adeac996b7de9cb86911e504716172e83">system</a>...</div>
<div class="line">   <a class="code" href="dofs__0_8txt.html#ace93ab11d5f75755b09a3368db091adc">Triangulation</a>: 229376 <a class="code" href="distributed__0_8txt.html#aafea668ad0c451ac7a0fae0f558c36d7">cells</a></div>
<div class="line">   <a class="code" href="group__dofs.html#ga768cd565b5c25f1ac235586e36ac94d6">DoFHandler</a>:    14729857 <a class="code" href="dof__renumbering__0_8txt.html#a68829910788b5388e9fb6e50b17c1876">DoFs</a></div>
<div class="line"> </div>
<div class="line">Solve <span class="keyword">using</span> <a class="code" href="newton__0_8txt.html#a7ae4bec25ec0fbd4c3968d0926b5c7c6">Newton</a><span class="stringliteral">&#39;s method...</span></div>
<div class="line"><span class="stringliteral">   Nstep 1, errf = 6.30096e-06, errx = 481.74, it = 8</span></div>
<div class="line"><span class="stringliteral">   Nstep 2, errf = 4.25607e-10, errx = 4.14315, it = 6</span></div>
<div class="line"><span class="stringliteral">   Nstep 3, errf = 7.29563e-13, errx = 0.000321775, it = 2</span></div>
<div class="line"><span class="stringliteral">Convergence step 3 value 7.29563e-13 (used wall time: 133.793 s)</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">Time for setup+solve (CPU/Wall) 226.809/232.615 s</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">Output results...</span></div>
<div class="line"><span class="stringliteral">  H1 seminorm: 0.588667</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">+---------------------------------------------+------------+------------+</span></div>
<div class="line"><span class="stringliteral">| Total wallclock time elapsed since start    |       390s |            |</span></div>
<div class="line"><span class="stringliteral">|                                             |            |            |</span></div>
<div class="line"><span class="stringliteral">| Section                         | no. calls |  wall time | % of total |</span></div>
<div class="line"><span class="stringliteral">+---------------------------------+-----------+------------+------------+</span></div>
<div class="line"><span class="stringliteral">| assemble right hand side        |         3 |      2.06s |      0.53% |</span></div>
<div class="line"><span class="stringliteral">| compute residual                |         3 |      2.46s |      0.63% |</span></div>
<div class="line"><span class="stringliteral">| compute update                  |         3 |       129s |        33% |</span></div>
<div class="line"><span class="stringliteral">| setup system                    |         1 |      98.8s |        25% |</span></div>
<div class="line"><span class="stringliteral">| solve                           |         1 |       134s |        34% |</span></div>
<div class="line"><span class="stringliteral">+---------------------------------+-----------+------------+------------+</span></div>
</div><!-- fragment --><p>We show the solution for the two- and three-dimensional problem in the following figure.</p>
<div class="twocolumn" style="width: 80%; text-align: center;"> <div> <img src="https://www.dealii.org/images/steps/developer/step-66.solution-2d.png" alt="Solution of the two-dimensional Gelfand problem." width="100%" class="inline"/> </div> <div> <img src="https://www.dealii.org/images/steps/developer/step-66.solution-3d.png" alt="Solution of the three-dimensional Gelfand problem." width="100%" class="inline"/> </div> </div><p><a class="anchor" id="Newtonsolver"></a></p><h3>Newton solver</h3>
<p>In the program output above we find some interesting information about the Newton iterations. The terminal output in each refinement cycle presents detailed diagnostics of the Newton method, which show first of all the number of Newton steps and for each step the norm of the residual \(\|F(u_h^{n+1})\|\), the norm of the Newton update \(\|s_h^n\|\), and the number of CG iterations <code>it</code>.</p>
<p>We observe that for all cases the Newton method converges in approximately three to four steps, which shows the quadratic convergence of the Newton method with a full step length \(\alpha = 1\). However, be aware that for a badly chosen initial guess \(u_h^0\), the Newton method will also diverge quadratically. Usually if you do not have an appropriate initial guess, you try a few damped Newton steps with a reduced step length \(\alpha &lt; 1\) until the Newton step is again in the quadratic convergence domain. This damping and relaxation of the Newton step length truly requires a more sophisticated implementation of the Newton method, which we designate to you as a possible extension of the tutorial.</p>
<p>Furthermore, we see that the number of CG iterations is approximately constant with successive mesh refinements and an increasing number of DoFs. This is of course due to the geometric multigrid preconditioner and similar to the observations made in other tutorials that use this method, e.g., <a class="el" href="step_16.html">step-16</a> and <a class="el" href="step_37.html">step-37</a>. Just to give an example, in the three-dimensional case after five refinements, we have approximately 14.7 million distributed DoFs with fourth-order Lagrangian finite elements, but the number of CG iterations is still less than ten.</p>
<p>In addition, there is one more very useful optimization that we applied and that should be mentioned here. In the <code>compute_update()</code> function we explicitly reset the vector holding the Newton update before passing it as the output vector to the solver. In that case we use a starting value of zero for the CG method, which is more suitable than the previous Newton update, the actual content of the <code>newton_update</code> before resetting, and thus reduces the number of CG iterations by a few steps.</p>
<p><a class="anchor" id="Possibilitiesforextensions"></a></p><h3>Possibilities for extensions</h3>
<p>A couple of possible extensions are available concerning minor updates fo the present code as well as a deeper numerical investigation of the Gelfand problem.</p>
<p><a class="anchor" id="MoresophisticatedNewtoniteration"></a></p><h4>More sophisticated Newton iteration</h4>
<p>Beside a step size controlled version of the Newton iteration as mentioned already in <a class="el" href="step_15.html">step-15</a>, one could also implement a more flexible stopping criterion for the Newton iteration. For example one could replace the fixed tolerances for the residual <code>TOLf</code> and for the Newton updated <code>TOLx</code> and implement a mixed error control with a given absolute and relative tolerance, such that the Newton iteration exists with success as, e.g., </p><p class="formulaDsp">
\begin{align*} \|F(u_h^{n+1})\| \leq \texttt{RelTol} \|u_h^{n+1}\| + \texttt{AbsTol}. \end{align*}
</p>
<p> For more advanced applications with many nonlinear systems to solve, for example at each time step for a time-dependent problem, it turns out that it is not necessary to set up and assemble the Jacobian anew at every single Newton step or even for each time step. Instead, the existing Jacobian from a previous step can be used for the Newton iteration. The Jacobian is then only rebuilt if, for example, the Newton iteration converges too slowly. Such an idea yields a <a href="https://en.wikipedia.org/wiki/Quasi-Newton_method">quasi-Newton method</a>. Admittedly, when using the matrix-free framework, the assembly of the Jacobian is omitted anyway, but with in this way one can try to optimize the reassembly of the geometric multigrid preconditioner. Remember that each time the solution from the old Newton step must be distributed to all levels and the mutligrid preconditioner must be reinitialized.</p>
<p><a class="anchor" id="Parallelscalabilityandthreadparallelism"></a></p><h4>Parallel scalability and thread parallelism</h4>
<p>In the results section of <a class="el" href="step_37.html">step-37</a> and others, the parallel scalability of the matrix-free framework on a large number of processors has already been demonstrated very impressively. In the nonlinear case we consider here, we note that one of the bottlenecks could become the transfer and evaluation of the matrix-free Jacobi operator and its multistage operators in the previous Newton step, since we need to transfer the old solution at all stages in each step. A first parallel scalability analysis in <b>[castelli2021numerical]</b> shows quite good strong scalability when the problem size is large enough. However, a more detailed analysis needs to be performed for reliable results. Moreover, the problem has been solved only with MPI so far, without using the possibilities of shared memory parallelization with threads. Therefore, for this example, you could try hybrid parallelization with MPI and threads, such as described in <a class="el" href="step_48.html">step-48</a>.</p>
<p><a class="anchor" id="Comparisontomatrixbasedmethods"></a></p><h4>Comparison to matrix-based methods</h4>
<p>Analogously to <a class="el" href="step_50.html">step-50</a> and the mentioned possible extension of <a class="el" href="step_75.html">step-75</a>, you can convince yourself which method is faster.</p>
<p><a class="anchor" id="Eigenvalueproblem"></a></p><h4>Eigenvalue problem</h4>
<p>One can consider the corresponding eigenvalue problem, which is called Bratu problem. For example, if we define a fixed eigenvalue \(\lambda\in[0,6]\), we can compute the corresponding discrete eigenfunction. You will notice that the number of Newton steps will increase with increasing \(\lambda\). To reduce the number of Newton steps you can use the following trick: start from a certain \(\lambda\), compute the eigenfunction, increase \(\lambda=\lambda + \delta_\lambda\), and then use the previous solution as an initial guess for the Newton iteration. In the end you can plot the \(H^1(\Omega)\)-norm over the eigenvalue \(\lambda \mapsto \|u_h\|_{H^1(\Omega)}\). What do you observe for further increasing \(\lambda&gt;7\)?</p>
<p><a class="anchor" id="PlainProg"></a> </p><h1>The plain program</h1>
<div class="fragment"><div class="line"><span class="comment">/* ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2021 by the deal.II authors</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file is part of the deal.II library.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The deal.II library is free software; you can use it, redistribute</span></div>
<div class="line"><span class="comment"> * it, and/or modify it under the terms of the GNU Lesser General</span></div>
<div class="line"><span class="comment"> * Public License as published by the Free Software Foundation; either</span></div>
<div class="line"><span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><span class="comment"> * The full text of the license can be found in the file LICENSE.md at</span></div>
<div class="line"><span class="comment"> * the top level directory of deal.II.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Authors: Fabian Castelli, Karlsruhe Institute of Technology (KIT)</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2timer_8h.html">deal.II/base/timer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2vectorization_8h.html">deal.II/base/vectorization.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__accessor_8h.html">deal.II/dofs/dof_accessor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2mapping__q__generic_8h.html">deal.II/fe/mapping_q_generic.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__out_8h.html">deal.II/grid/grid_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2manifold__lib_8h.html">deal.II/grid/manifold_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria__accessor_8h.html">deal.II/grid/tria_accessor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria__iterator_8h.html">deal.II/grid/tria_iterator.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2precondition_8h.html">deal.II/lac/precondition.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2solver__cg_8h.html">deal.II/lac/solver_cg.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2vector_8h.html">deal.II/lac/vector.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_2fe__evaluation_8h.html">deal.II/matrix_free/fe_evaluation.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_2matrix__free_8h.html">deal.II/matrix_free/matrix_free.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_2operators_8h.html">deal.II/matrix_free/operators.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_2tools_8h.html">deal.II/matrix_free/tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__coarse_8h.html">deal.II/multigrid/mg_coarse.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__constrained__dofs_8h.html">deal.II/multigrid/mg_constrained_dofs.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__matrix_8h.html">deal.II/multigrid/mg_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__smoother_8h.html">deal.II/multigrid/mg_smoother.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__tools_8h.html">deal.II/multigrid/mg_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__transfer__matrix__free_8h.html">deal.II/multigrid/mg_transfer_matrix_free.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2multigrid_8h.html">deal.II/multigrid/multigrid.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceStep66.html">Step66</a></div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">  <span class="keyword">class </span>JacobianOperator</div>
<div class="line">    : <span class="keyword">public</span> <a class="code" href="namespaceMatrixFreeOperators.html">MatrixFreeOperators</a>::</div>
<div class="line">        Base&lt;dim, LinearAlgebra::distributed::Vector&lt;number&gt;&gt;</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">using</span> value_type = <a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using</span> FECellIntegrator =</div>
<div class="line">      <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, fe_degree, fe_degree + 1, 1, number&gt;</a>;</div>
<div class="line"> </div>
<div class="line">    JacobianOperator();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="table__0_8txt.html#a7f24305532768edc889062eefd4b28cf">clear</a>() <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> evaluate_newton_step(</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;newton_step);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">compute_diagonal</a>() <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="operators__0_8txt.html#a92cb2920df95b6f107c2c9a8c75b788c">apply_add</a>(</div>
<div class="line">      <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src) <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span></div>
<div class="line">    local_apply(<span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, number&gt;</a> &amp;                   <a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>,</div>
<div class="line">                <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">                <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src,</div>
<div class="line">                <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;cell_range) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> local_compute_diagonal(FECellIntegrator &amp;integrator) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;2, VectorizedArray&lt;number&gt;</a>&gt; nonlinear_values;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">  <a class="code" href="classStep66_1_1JacobianOperator.html#aaedf9c433341f7980f1145823681507f">JacobianOperator&lt;dim, fe_degree, number&gt;::JacobianOperator</a>()</div>
<div class="line">    : <a class="code" href="namespaceMatrixFreeOperators.html">MatrixFreeOperators</a>::Base&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>,</div>
<div class="line">                                <a class="code" href="namespaceLinearAlgebra.html">LinearAlgebra</a>::<a class="code" href="distributed__0_8txt.html#ad7a526c3d1317369fada16d420fcb06c">distributed</a>::<a class="code" href="namespaceLinearAlgebraDealII.html#a2165565a5e6b6679392a7dee5d01ef58">Vector</a>&lt;<a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>&gt;&gt;()</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="table__0_8txt.html#a7f24305532768edc889062eefd4b28cf">JacobianOperator&lt;dim, fe_degree, number&gt;::clear</a>()</div>
<div class="line">  {</div>
<div class="line">    nonlinear_values.reinit(0, 0);</div>
<div class="line">    <a class="code" href="classMatrixFreeOperators_1_1Base.html">MatrixFreeOperators::Base&lt;dim, LinearAlgebra::distributed::Vector&lt;number&gt;</a>&gt;<a class="code" href="table__0_8txt.html#a7f24305532768edc889062eefd4b28cf">::</a></div>
<div class="line"><a class="code" href="table__0_8txt.html#a7f24305532768edc889062eefd4b28cf">      clear</a>();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">  <span class="keywordtype">void</span> JacobianOperator&lt;dim, fe_degree, number&gt;::evaluate_newton_step(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;newton_step)</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a> = this-&gt;data-&gt;<a class="code" href="classMatrixFree.html#a8c9d964339b466bdcb661552e731e222">n_cell_batches</a>();</div>
<div class="line">    FECellIntegrator   phi(*this-&gt;data);</div>
<div class="line"> </div>
<div class="line">    nonlinear_values.reinit(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>, phi.n_q_points);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> = 0; <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> &lt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>; ++<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>)</div>
<div class="line">      {</div>
<div class="line">        phi.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line">        phi.read_dof_values_plain(newton_step);</div>
<div class="line">        phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">          {</div>
<div class="line">            nonlinear_values(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, q) = <a class="code" href="base_2vectorization_8h.html#a19f846bda83b7e3f4531daacb40c64e1">std::exp</a>(phi.get_value(q));</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">  <span class="keywordtype">void</span> JacobianOperator&lt;dim, fe_degree, number&gt;::local_apply(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, number&gt;</a> &amp;                   <a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>,</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src,</div>
<div class="line">    <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;     cell_range)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    FECellIntegrator phi(<a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> = cell_range.first; <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> &lt; cell_range.second; ++<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(nonlinear_values.size(0),</div>
<div class="line">                        phi.get_matrix_free().n_cell_batches());</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(nonlinear_values.size(1), phi.n_q_points);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        phi.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">        phi.gather_evaluate(src,</div>
<div class="line">                            <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> |</div>
<div class="line">                              <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">          {</div>
<div class="line">            phi.submit_value(-nonlinear_values(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, q) * phi.get_value(q), q);</div>
<div class="line">            phi.submit_gradient(phi.get_gradient(q), q);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        phi.integrate_scatter(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> |</div>
<div class="line">                                <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>,</div>
<div class="line">                              <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>);</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="operators__0_8txt.html#a92cb2920df95b6f107c2c9a8c75b788c">JacobianOperator&lt;dim, fe_degree, number&gt;::apply_add</a>(</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    this-&gt;data-&gt;<a class="code" href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">cell_loop</a>(&amp;JacobianOperator::local_apply, <span class="keyword">this</span>, <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>, src);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">  <span class="keywordtype">void</span> JacobianOperator&lt;dim, fe_degree, number&gt;::local_compute_diagonal(</div>
<div class="line">    FECellIntegrator &amp;phi)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(nonlinear_values.size(0),</div>
<div class="line">                    phi.get_matrix_free().n_cell_batches());</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(nonlinear_values.size(1), phi.n_q_points);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> = phi.get_current_cell_index();</div>
<div class="line"> </div>
<div class="line">    phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> | <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">      {</div>
<div class="line">        phi.submit_value(-nonlinear_values(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, q) * phi.get_value(q), q);</div>
<div class="line">        phi.submit_gradient(phi.get_gradient(q), q);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    phi.integrate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> | <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">JacobianOperator&lt;dim, fe_degree, number&gt;::compute_diagonal</a>()</div>
<div class="line">  {</div>
<div class="line">    this-&gt;inverse_diagonal_entries.reset(</div>
<div class="line">      <span class="keyword">new</span> <a class="code" href="classDiagonalMatrix.html">DiagonalMatrix</a>&lt;<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a>&gt;());</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;inverse_diagonal =</div>
<div class="line">      this-&gt;inverse_diagonal_entries-&gt;get_vector();</div>
<div class="line">    this-&gt;data-&gt;<a class="code" href="classMatrixFree.html#ab92a24942737bbaf04d7e00aceba9b57">initialize_dof_vector</a>(inverse_diagonal);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">MatrixFreeTools::compute_diagonal</a>(*this-&gt;data,</div>
<div class="line">                                      inverse_diagonal,</div>
<div class="line">                                      &amp;JacobianOperator::local_compute_diagonal,</div>
<div class="line">                                      <span class="keyword">this</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;diagonal_element : inverse_diagonal)</div>
<div class="line">      {</div>
<div class="line">        diagonal_element = (<a class="code" href="base_2vectorization_8h.html#aafbdfdd72b6cfe4eae5fa7a16385582f">std::abs</a>(diagonal_element) &gt; 1.0e-10) ?</div>
<div class="line">                             (1.0 / diagonal_element) :</div>
<div class="line">                             1.0;</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keyword">class </span><a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem</a></div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">run</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="step-2_8cc.html#ab108b7b7bca84a81aceda045aaef1961">make_grid</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> setup_system();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> evaluate_residual(</div>
<div class="line">      <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;src) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> local_evaluate_residual(</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, double&gt;</a> &amp;                   <a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>,</div>
<div class="line">      <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;src,</div>
<div class="line">      <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;     cell_range) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> assemble_rhs();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> compute_residual(<span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> compute_update();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> compute_solution_norm() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classparallel_1_1distributed_1_1Triangulation.html">parallel::distributed::Triangulation&lt;dim&gt;</a> <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classMappingQGeneric.html">MappingQGeneric&lt;dim&gt;</a>                <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a>       <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>;</div>
<div class="line">    <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> dof_handler;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>;</div>
<div class="line">    <span class="keyword">using</span> SystemMatrixType = JacobianOperator&lt;dim, fe_degree, double&gt;;</div>
<div class="line">    SystemMatrixType system_matrix;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classMGConstrainedDoFs.html">MGConstrainedDoFs</a> mg_constrained_dofs;</div>
<div class="line">    <span class="keyword">using</span> LevelMatrixType = JacobianOperator&lt;dim, fe_degree, float&gt;;</div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;LevelMatrixType&gt;</a>                           mg_matrices;</div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt; mg_solution;</div>
<div class="line">    <a class="code" href="classMGTransferMatrixFree.html">MGTransferMatrixFree&lt;dim, float&gt;</a>                         mg_transfer;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>;</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> newton_update;</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> system_rhs;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> linear_iterations;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classConditionalOStream.html">ConditionalOStream</a> pcout;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTimerOutput.html">TimerOutput</a> computing_timer;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem&lt;dim, fe_degree&gt;::GelfandProblem</a>()</div>
<div class="line">    : <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>(MPI_COMM_WORLD,</div>
<div class="line">                    <a class="code" href="classTriangulation.html">Triangulation</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;::limit_level_difference_at_vertices,</div>
<div class="line">                    <a class="code" href="namespaceparallel.html">parallel</a>::<a class="code" href="distributed__0_8txt.html#ad7a526c3d1317369fada16d420fcb06c">distributed</a>::<a class="code" href="classTriangulation.html">Triangulation</a>&lt;</div>
<div class="line">                      <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;::<a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0a3901e6a241f812109912537866771e4c">construct_multigrid_hierarchy</a>)</div>
<div class="line">    , <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>(<a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>)</div>
<div class="line">    , <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>(<a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>)</div>
<div class="line">    , dof_handler(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>)</div>
<div class="line">    , pcout(std::cout, <a class="code" href="namespaceUtilities.html">Utilities</a>::<a class="code" href="base_2partitioner__0_8txt.html#a6d2d0fa485d1660823c59c494fb0fb31">MPI</a>::<a class="code" href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">this_mpi_process</a>(MPI_COMM_WORLD) == 0)</div>
<div class="line">    , computing_timer(MPI_COMM_WORLD,</div>
<div class="line">                      pcout,</div>
<div class="line">                      <a class="code" href="classTimerOutput.html">TimerOutput</a>::never,</div>
<div class="line">                      <a class="code" href="classTimerOutput.html">TimerOutput</a>::wall_times)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="step-2_8cc.html#ab108b7b7bca84a81aceda045aaef1961">GelfandProblem&lt;dim, fe_degree&gt;::make_grid</a>()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;make grid&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSphericalManifold.html">SphericalManifold&lt;dim&gt;</a>                boundary_manifold;</div>
<div class="line">    <a class="code" href="classTransfiniteInterpolationManifold.html">TransfiniteInterpolationManifold&lt;dim&gt;</a> inner_manifold;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceGridGenerator.html#a533c4778cbc9bcbed365dcab42ca4418">GridGenerator::hyper_ball</a>(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.set_all_manifold_ids(1);</div>
<div class="line">    <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.set_all_manifold_ids_on_boundary(0);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.set_manifold(0, boundary_manifold);</div>
<div class="line"> </div>
<div class="line">    inner_manifold.<a class="code" href="classTransfiniteInterpolationManifold.html#a34326a35d9ec4b6911d90c85c21847d8">initialize</a>(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>);</div>
<div class="line">    <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.set_manifold(1, inner_manifold);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.refine_global(3 - <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem&lt;dim, fe_degree&gt;::setup_system</a>()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;setup system&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    system_matrix.clear();</div>
<div class="line">    mg_matrices.clear_elements();</div>
<div class="line"> </div>
<div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
<div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#a9aed31323cbd7619edac310c47e7a7ad">distribute_mg_dofs</a>();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classIndexSet.html">IndexSet</a> locally_relevant_dofs;</div>
<div class="line">    <a class="code" href="namespaceDoFTools.html#acad7e0841b9046eaafddc4c617ab1d9d">DoFTools::extract_locally_relevant_dofs</a>(dof_handler, locally_relevant_dofs);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#addd15bc409c61d6f795f0132c574335b">clear</a>();</div>
<div class="line">    <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#a2c9d71b5b7e8851c25a411ccf34de986">reinit</a>(locally_relevant_dofs);</div>
<div class="line">    <a class="code" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a>(dof_handler, <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>);</div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(dof_handler,</div>
<div class="line">                                             0,</div>
<div class="line">                                             <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(),</div>
<div class="line">                                             <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>);</div>
<div class="line">    <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">typename</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, double&gt;::AdditionalData</a> additional_data;</div>
<div class="line">      additional_data.tasks_parallel_scheme =</div>
<div class="line">        <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, double&gt;::AdditionalData::partition_color</a>;</div>
<div class="line">      additional_data.mapping_update_flags =</div>
<div class="line">        (<a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> |</div>
<div class="line">         <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a>);</div>
<div class="line">      <span class="keyword">auto</span> system_mf_storage = std::make_shared&lt;MatrixFree&lt;dim, double&gt;&gt;();</div>
<div class="line">      system_mf_storage-&gt;<a class="code" href="classMatrixFree.html#adb324d469b296f2a6921b41208732ddf">reinit</a>(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                dof_handler,</div>
<div class="line">                                <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>,</div>
<div class="line">                                <a class="code" href="classQGauss.html">QGauss&lt;1&gt;</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1),</div>
<div class="line">                                additional_data);</div>
<div class="line"> </div>
<div class="line">      system_matrix.initialize(system_mf_storage);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    system_matrix.initialize_dof_vector(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line">    system_matrix.initialize_dof_vector(newton_update);</div>
<div class="line">    system_matrix.initialize_dof_vector(system_rhs);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nlevels = <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels();</div>
<div class="line">    mg_matrices.resize(0, nlevels - 1);</div>
<div class="line">    mg_solution.resize(0, nlevels - 1);</div>
<div class="line"> </div>
<div class="line">    std::set&lt;types::boundary_id&gt; dirichlet_boundary;</div>
<div class="line">    dirichlet_boundary.insert(0);</div>
<div class="line">    mg_constrained_dofs.initialize(dof_handler);</div>
<div class="line">    mg_constrained_dofs.make_zero_boundary_constraints(dof_handler,</div>
<div class="line">                                                       dirichlet_boundary);</div>
<div class="line"> </div>
<div class="line">    mg_transfer.<a class="code" href="classMGTransferMatrixFree.html#a69e2b416ab209936f94db08e865cd92b">initialize_constraints</a>(mg_constrained_dofs);</div>
<div class="line">    mg_transfer.<a class="code" href="classMGTransferMatrixFree.html#a8f214ffade006cfa85e902a94902fc7b">build</a>(dof_handler);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; nlevels; ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classIndexSet.html">IndexSet</a> relevant_dofs;</div>
<div class="line">        <a class="code" href="namespaceDoFTools.html#a1fef7be07cf379b661646e39b9354e17">DoFTools::extract_locally_relevant_level_dofs</a>(dof_handler,</div>
<div class="line">                                                      <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>,</div>
<div class="line">                                                      relevant_dofs);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> level_constraints;</div>
<div class="line">        level_constraints.<a class="code" href="classAffineConstraints.html#a2c9d71b5b7e8851c25a411ccf34de986">reinit</a>(relevant_dofs);</div>
<div class="line">        level_constraints.<a class="code" href="classAffineConstraints.html#aef97b22281acb10c914d79a3881e2735">add_lines</a>(</div>
<div class="line">          mg_constrained_dofs.get_boundary_indices(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">        level_constraints.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">typename</span> <a class="code" href="structMatrixFree_1_1AdditionalData.html">MatrixFree&lt;dim, float&gt;::AdditionalData</a> additional_data;</div>
<div class="line">        additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a0bcce2facca91b925d3e1a5a00c7704b">tasks_parallel_scheme</a> =</div>
<div class="line">          <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, float&gt;::AdditionalData::partition_color</a>;</div>
<div class="line">        additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#aa5d597e6c4441d273f4100b6139a2552">mapping_update_flags</a> =</div>
<div class="line">          (<a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> |</div>
<div class="line">           <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a>);</div>
<div class="line">        additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a67c9ff01c51fb7fb3ada151b83cdd409">mg_level</a> = <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>;</div>
<div class="line">        <span class="keyword">auto</span> mg_mf_storage_level = std::make_shared&lt;MatrixFree&lt;dim, float&gt;&gt;();</div>
<div class="line">        mg_mf_storage_level-&gt;<a class="code" href="classMultigrid.html#af3c33c4008b7b0d13c69d097fda50630">reinit</a>(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                    dof_handler,</div>
<div class="line">                                    level_constraints,</div>
<div class="line">                                    <a class="code" href="classQGauss.html">QGauss&lt;1&gt;</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1),</div>
<div class="line">                                    additional_data);</div>
<div class="line"> </div>
<div class="line">        mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].initialize(mg_mf_storage_level,</div>
<div class="line">                                      mg_constrained_dofs,</div>
<div class="line">                                      <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">        mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].initialize_dof_vector(mg_solution[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>]);</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem&lt;dim, fe_degree&gt;::evaluate_residual</a>(</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;src)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keyword">auto</span> matrix_free = system_matrix.get_matrix_free();</div>
<div class="line"> </div>
<div class="line">    matrix_free-&gt;cell_loop(</div>
<div class="line">      &amp;GelfandProblem::local_evaluate_residual, <span class="keyword">this</span>, <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>, src, <span class="keyword">true</span>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem&lt;dim, fe_degree&gt;::local_evaluate_residual</a>(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, double&gt;</a> &amp;                   <a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>,</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;src,</div>
<div class="line">    <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;     cell_range)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, fe_degree, fe_degree + 1, 1, double&gt;</a> phi(<a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> = cell_range.first; <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> &lt; cell_range.second; ++<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>)</div>
<div class="line">      {</div>
<div class="line">        phi.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">        phi.read_dof_values_plain(src);</div>
<div class="line">        phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> | <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">          {</div>
<div class="line">            phi.submit_value(-std::exp(phi.get_value(q)), q);</div>
<div class="line">            phi.submit_gradient(phi.get_gradient(q), q);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        phi.integrate_scatter(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> |</div>
<div class="line">                                <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>,</div>
<div class="line">                              <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>);</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem&lt;dim, fe_degree&gt;::assemble_rhs</a>()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;assemble right hand side&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    evaluate_residual(system_rhs, <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line">    system_rhs *= -1.0;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">double</span> <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem&lt;dim, fe_degree&gt;::compute_residual</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;compute residual&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> <a class="code" href="newton__0_8txt.html#a21f536f84dd77674667ed5d2a30eb3ab">residual</a>;</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> evaluation_point;</div>
<div class="line"> </div>
<div class="line">    system_matrix.initialize_dof_vector(<a class="code" href="newton__0_8txt.html#a21f536f84dd77674667ed5d2a30eb3ab">residual</a>);</div>
<div class="line">    system_matrix.initialize_dof_vector(evaluation_point);</div>
<div class="line"> </div>
<div class="line">    evaluation_point = <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a> &gt; 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-12)</div>
<div class="line">      {</div>
<div class="line">        evaluation_point.<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html#ac029174b48a0707da587b6ce3bc25047">add</a>(<a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>, newton_update);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    evaluate_residual(<a class="code" href="newton__0_8txt.html#a21f536f84dd77674667ed5d2a30eb3ab">residual</a>, evaluation_point);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="newton__0_8txt.html#a21f536f84dd77674667ed5d2a30eb3ab">residual</a>.l2_norm();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem&lt;dim, fe_degree&gt;::compute_update</a>()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;compute update&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.update_ghost_values();</div>
<div class="line"> </div>
<div class="line">    system_matrix.evaluate_newton_step(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    mg_transfer.<a class="code" href="classMGTransferMatrixFree.html#a90aef560cc3d832589ca13a5f18e1414">interpolate_to_mg</a>(dof_handler, mg_solution, <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using</span> SmootherType =</div>
<div class="line">      <a class="code" href="classPreconditionChebyshev.html">PreconditionChebyshev</a>&lt;LevelMatrixType,</div>
<div class="line">                            <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt;;</div>
<div class="line">    <a class="code" href="classmg_1_1SmootherRelaxation.html">mg::SmootherRelaxation</a>&lt;SmootherType,</div>
<div class="line">                           <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt;</div>
<div class="line">                                                         mg_smoother;</div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;typename SmootherType::AdditionalData&gt;</a> smoother_data;</div>
<div class="line">    smoother_data.<a class="code" href="classMGLevelObject.html#a16213121f9153bd08f49652a11886259">resize</a>(0, <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels() - 1);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels();</div>
<div class="line">         ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &gt; 0)</div>
<div class="line">          {</div>
<div class="line">            smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].smoothing_range     = 15.;</div>
<div class="line">            smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].degree              = 4;</div>
<div class="line">            smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].eig_cg_n_iterations = 10;</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          {</div>
<div class="line">            smoother_data[0].smoothing_range = 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-3;</div>
<div class="line">            smoother_data[0].degree          = <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>;</div>
<div class="line">            smoother_data[0].eig_cg_n_iterations = mg_matrices[0].m();</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].evaluate_newton_step(mg_solution[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>]);</div>
<div class="line">        mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].compute_diagonal();</div>
<div class="line"> </div>
<div class="line">        smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].preconditioner =</div>
<div class="line">          mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].get_matrix_diagonal_inverse();</div>
<div class="line">      }</div>
<div class="line">    mg_smoother.initialize(mg_matrices, smoother_data);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classMGCoarseGridApplySmoother.html">MGCoarseGridApplySmoother&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt;</div>
<div class="line">      mg_coarse;</div>
<div class="line">    mg_coarse.<a class="code" href="classMGCoarseGridApplySmoother.html#a499c7364e40031332e9943a2e5f331a2">initialize</a>(mg_smoother);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt; mg_matrix(</div>
<div class="line">      mg_matrices);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;MatrixFreeOperators::MGInterfaceOperator&lt;LevelMatrixType&gt;</a>&gt;</div>
<div class="line">      mg_interface_matrices;</div>
<div class="line">    mg_interface_matrices.<a class="code" href="classMGLevelObject.html#a16213121f9153bd08f49652a11886259">resize</a>(0, <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels() - 1);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels();</div>
<div class="line">         ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">      {</div>
<div class="line">        mg_interface_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].initialize(mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>]);</div>
<div class="line">      }</div>
<div class="line">    <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt; mg_interface(</div>
<div class="line">      mg_interface_matrices);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classMultigrid.html">Multigrid&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt; <a class="code" href="namespacemg.html">mg</a>(</div>
<div class="line">      mg_matrix, mg_coarse, mg_transfer, mg_smoother, mg_smoother);</div>
<div class="line">    <a class="code" href="namespacemg.html">mg</a>.set_edge_matrices(mg_interface, mg_interface);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classPreconditionMG.html">PreconditionMG</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>,</div>
<div class="line">                   <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;float&gt;</a>,</div>
<div class="line">                   <a class="code" href="classMGTransferMatrixFree.html">MGTransferMatrixFree&lt;dim, float&gt;</a>&gt;</div>
<div class="line">      <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>(dof_handler, <a class="code" href="namespacemg.html">mg</a>, mg_transfer);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSolverControl.html">SolverControl</a> solver_control(100, 1.<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-12);</div>
<div class="line">    <a class="code" href="classSolverCG.html">SolverCG&lt;LinearAlgebra::distributed::Vector&lt;double&gt;</a>&gt; cg(solver_control);</div>
<div class="line"> </div>
<div class="line">    newton_update = 0.0;</div>
<div class="line"> </div>
<div class="line">    cg.solve(system_matrix, newton_update, system_rhs, <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">distribute</a>(newton_update);</div>
<div class="line"> </div>
<div class="line">    linear_iterations = solver_control.<a class="code" href="classSolverControl.html#a42aeae81cd6b67ce93b5fbea3328371f">last_step</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.zero_out_ghost_values();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">GelfandProblem&lt;dim, fe_degree&gt;::solve</a>()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;solve&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> itmax = 10;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>       TOLf  = 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-12;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>       TOLx  = 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-10;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTimer.html">Timer</a> solver_timer;</div>
<div class="line">    solver_timer.<a class="code" href="classTimer.html#a3a8b5272198d029779dc9302a54305a8">start</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> newton_step = 1; newton_step &lt;= itmax; ++newton_step)</div>
<div class="line">      {</div>
<div class="line">        assemble_rhs();</div>
<div class="line">        compute_update();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> ERRx = newton_update.<a class="code" href="classBlockVectorBase.html#ac718033fc083f27c45c6bfb4ac780360">l2_norm</a>();</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> ERRf = compute_residual(1.0);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.add(1.0, newton_update);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;   Nstep &quot;</span> &lt;&lt; newton_step &lt;&lt; <span class="stringliteral">&quot;, errf = &quot;</span> &lt;&lt; ERRf</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;, errx = &quot;</span> &lt;&lt; ERRx &lt;&lt; <span class="stringliteral">&quot;, it = &quot;</span> &lt;&lt; linear_iterations</div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (ERRf &lt; TOLf || ERRx &lt; TOLx)</div>
<div class="line">          {</div>
<div class="line">            solver_timer.<a class="code" href="classTimer.html#a988f79aa183d9d5473c13106f5babe48">stop</a>();</div>
<div class="line"> </div>
<div class="line">            pcout &lt;&lt; <span class="stringliteral">&quot;Convergence step &quot;</span> &lt;&lt; newton_step &lt;&lt; <span class="stringliteral">&quot; value &quot;</span> &lt;&lt; ERRf</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot; (used wall time: &quot;</span> &lt;&lt; solver_timer.<a class="code" href="classTimer.html#a6f3e76707411b51e7d7e7bfa5755cf02">wall_time</a>() &lt;&lt; <span class="stringliteral">&quot; s)&quot;</span></div>
<div class="line">                  &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (newton_step == itmax)</div>
<div class="line">          {</div>
<div class="line">            solver_timer.<a class="code" href="classTimer.html#a988f79aa183d9d5473c13106f5babe48">stop</a>();</div>
<div class="line">            pcout &lt;&lt; <span class="stringliteral">&quot;WARNING: No convergence of Newton&#39;s method after &quot;</span></div>
<div class="line">                  &lt;&lt; newton_step &lt;&lt; <span class="stringliteral">&quot; steps.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">double</span> <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem&lt;dim, fe_degree&gt;::compute_solution_norm</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.update_ghost_values();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;float&gt;</a> norm_per_cell(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells());</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#a676190d2c897ac5da68a9c460fa95832">VectorTools::integrate_difference</a>(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                      dof_handler,</div>
<div class="line">                                      <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>,</div>
<div class="line">                                      <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(),</div>
<div class="line">                                      norm_per_cell,</div>
<div class="line">                                      <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 2),</div>
<div class="line">                                      <a class="code" href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1a7c450aee1986e226cf1bd7687171d769">VectorTools::H1_seminorm</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.zero_out_ghost_values();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="namespaceVectorTools.html#a21eb62d70953182dcc2b15c4e14dd533">VectorTools::compute_global_error</a>(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>,</div>
<div class="line">                                             norm_per_cell,</div>
<div class="line">                                             <a class="code" href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1a7c450aee1986e226cf1bd7687171d769">VectorTools::H1_seminorm</a>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span></div>
<div class="line">  <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem&lt;dim, fe_degree&gt;::output_results</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_active_cells() &gt; 1e6)</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.update_ghost_values();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">attach_dof_handler</a>(dof_handler);</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, <span class="stringliteral">&quot;solution&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;float&gt;</a> <a class="code" href="index__set__0_8txt.html#a85fb0893d080862c6fc2fbcb1e57a791">subdomain</a>(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells());</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="index__set__0_8txt.html#a85fb0893d080862c6fc2fbcb1e57a791">subdomain</a>.size(); ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="index__set__0_8txt.html#a85fb0893d080862c6fc2fbcb1e57a791">subdomain</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>) = <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.locally_owned_subdomain();</div>
<div class="line">      }</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(<a class="code" href="index__set__0_8txt.html#a85fb0893d080862c6fc2fbcb1e57a791">subdomain</a>, <span class="stringliteral">&quot;subdomain&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    data_out.<a class="code" href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">build_patches</a>(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                           <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a>,</div>
<div class="line">                           <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;::curved_inner_cells</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="structDataOutBase_1_1VtkFlags.html">DataOutBase::VtkFlags</a> <a class="code" href="update__flags__0_8txt.html#ac8b7167f13d273c0000a680958db42c5">flags</a>;</div>
<div class="line">    <a class="code" href="update__flags__0_8txt.html#ac8b7167f13d273c0000a680958db42c5">flags</a>.compression_level = <a class="code" href="group__Exceptions.html#ga7ad65742b9dbfb7eeb04b511b5a08d63a3c83e26f202f837328b9f7532773be70">DataOutBase::VtkFlags::best_speed</a>;</div>
<div class="line">    data_out.<a class="code" href="classDataOutInterface.html#ac7280a24690b117454acfb0fa058299c">set_flags</a>(<a class="code" href="update__flags__0_8txt.html#ac8b7167f13d273c0000a680958db42c5">flags</a>);</div>
<div class="line">    data_out.<a class="code" href="classDataOutInterface.html#a0864e51eb173c87e2a3edc9391ea8009">write_vtu_with_pvtu_record</a>(</div>
<div class="line">      <span class="stringliteral">&quot;./&quot;</span>, <span class="stringliteral">&quot;solution_&quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>) + <span class="stringliteral">&quot;d&quot;</span>, <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>, MPI_COMM_WORLD, 3);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.zero_out_ghost_values();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">GelfandProblem&lt;dim, fe_degree&gt;::run</a>()</div>
<div class="line">  {</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_ranks =</div>
<div class="line">        <a class="code" href="namespaceUtilities_1_1MPI.html#ac26de0c059200523177bb1d92cc25d00">Utilities::MPI::n_mpi_processes</a>(MPI_COMM_WORLD);</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_vect_doubles = <a class="code" href="classVectorizedArrayBase.html#acb35404acc1693aee6e990228924cc09">VectorizedArray&lt;double&gt;::size</a>();</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_vect_bits    = 8 * <span class="keyword">sizeof</span>(<a class="code" href="hdf5__0_8txt.html#aae153b86de45d3354cd3edd5b992435e">double</a>) * n_vect_doubles;</div>
<div class="line"> </div>
<div class="line">      std::string DAT_header = <span class="stringliteral">&quot;START DATE: &quot;</span> + <a class="code" href="namespaceUtilities_1_1System.html#aff548b3b9b7a035ea112729700ef7c64">Utilities::System::get_date</a>() +</div>
<div class="line">                               <span class="stringliteral">&quot;, TIME: &quot;</span> + <a class="code" href="namespaceUtilities_1_1System.html#a76bc1cc7649cc416723f450d24fdd91d">Utilities::System::get_time</a>();</div>
<div class="line">      std::string MPI_header = <span class="stringliteral">&quot;Running with &quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(n_ranks) +</div>
<div class="line">                               <span class="stringliteral">&quot; MPI process&quot;</span> + (n_ranks &gt; 1 ? <span class="stringliteral">&quot;es&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">      std::string VEC_header =</div>
<div class="line">        <span class="stringliteral">&quot;Vectorization over &quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(n_vect_doubles) +</div>
<div class="line">        <span class="stringliteral">&quot; doubles = &quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(n_vect_bits) + <span class="stringliteral">&quot; bits (&quot;</span> +</div>
<div class="line">        <a class="code" href="namespaceUtilities_1_1System.html#ade631a789101336840371e3b2e2851e0">Utilities::System::get_current_vectorization_level</a>() +</div>
<div class="line">        <span class="stringliteral">&quot;), VECTORIZATION_LEVEL=&quot;</span> +</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(<a class="code" href="config_8h.html#a32dc208a29f23d1f031fb40b0d21e60e">DEAL_II_COMPILER_VECTORIZATION_LEVEL</a>);</div>
<div class="line">      std::string SOL_header = <span class="stringliteral">&quot;Finite element space: &quot;</span> + <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFE__Q.html#aef8e62ce116e341818549d1730343792">get_name</a>();</div>
<div class="line"> </div>
<div class="line">      pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;=&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line">      pcout &lt;&lt; DAT_header &lt;&lt; std::endl;</div>
<div class="line">      pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;-&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">      pcout &lt;&lt; MPI_header &lt;&lt; std::endl;</div>
<div class="line">      pcout &lt;&lt; VEC_header &lt;&lt; std::endl;</div>
<div class="line">      pcout &lt;&lt; SOL_header &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">      pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;=&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> = 0; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt; 9 - <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>)</div>
<div class="line">      {</div>
<div class="line">        pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;-&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;Cycle &quot;</span> &lt;&lt; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt;&lt; std::endl;</div>
<div class="line">        pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;-&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> == 0)</div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="step-2_8cc.html#ab108b7b7bca84a81aceda045aaef1961">make_grid</a>();</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.refine_global(1);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classTimer.html">Timer</a> timer;</div>
<div class="line"> </div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;Set up system...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        setup_system();</div>
<div class="line"> </div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;   Triangulation: &quot;</span> &lt;&lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_active_cells()</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot; cells&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;   DoFHandler:    &quot;</span> &lt;&lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>() &lt;&lt; <span class="stringliteral">&quot; DoFs&quot;</span></div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line">        pcout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;Solve using Newton&#39;s method...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>();</div>
<div class="line">        pcout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        timer.<a class="code" href="classTimer.html#a988f79aa183d9d5473c13106f5babe48">stop</a>();</div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;Time for setup+solve (CPU/Wall) &quot;</span> &lt;&lt; timer.<a class="code" href="classTimer.html#a4e3933a78790d7455daff5acab3f8432">cpu_time</a>() &lt;&lt; <span class="stringliteral">&quot;/&quot;</span></div>
<div class="line">              &lt;&lt; timer.<a class="code" href="classTimer.html#a6f3e76707411b51e7d7e7bfa5755cf02">wall_time</a>() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        pcout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;Output results...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="multithreading__0_8txt.html#a0759c0124e216ec36f063ad051f4dba0">norm</a> = compute_solution_norm();</div>
<div class="line">        output_results(<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>);</div>
<div class="line"> </div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;  H1 seminorm: &quot;</span> &lt;&lt; <a class="code" href="multithreading__0_8txt.html#a0759c0124e216ec36f063ad051f4dba0">norm</a> &lt;&lt; std::endl;</div>
<div class="line">        pcout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        computing_timer.print_summary();</div>
<div class="line">        computing_timer.reset();</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Step66</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">using namespace </span><a class="code" href="namespaceStep66.html">Step66</a>;</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classUtilities_1_1MPI_1_1MPI__InitFinalize.html">Utilities::MPI::MPI_InitFinalize</a> mpi_init(argc, argv, 1);</div>
<div class="line"> </div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem&lt;2, 4&gt;</a> gelfand_problem;</div>
<div class="line">        gelfand_problem.run();</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem&lt;3, 4&gt;</a> gelfand_problem;</div>
<div class="line">        gelfand_problem.run();</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (<a class="code" href="parameter__handler__0_8txt.html#ad919e2b915d8e8226aef004c2d8399a8">std::exception</a> &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p><br  />
 This tutorial depends on <a class="el" href="step_15.html">step-15</a> , <a class="el" href="step_37.html">step-37</a> .  
<table class="tutorial" width="50%">
<tr><th colspan="2"><b><small>Table of contents</small></b><b><small>Table of contents</small></b></th></tr>
<tr><td width="50%" valign="top">
<ol>
  <li> <a href="#Intro" class=bold>Introduction</a><a href="#Intro" class=bold>Introduction</a>
    <ul>
        <li><a href="#Problemformulation">Problem formulation</a><a href="#Problemformulation">Problem formulation</a>
        <li><a href="#Discretizationwithfiniteelements">Discretization with finite elements</a><a href="#Discretizationwithfiniteelements">Discretization with finite elements</a>
        <li><a href="#Numericallinearalgebra">Numerical linear algebra</a><a href="#Numericallinearalgebra">Numerical linear algebra</a>
        <li><a href="#Triangulation">Triangulation</a><a href="#Triangulation">Triangulation</a>
    </ul>
  <li> <a href="#CommProg" class=bold>The commented program</a><a href="#CommProg" class=bold>The commented program</a>
    <ul>
        <li><a href="#MatrixfreeJacobianOperator">Matrix-free JacobianOperator</a><a href="#MatrixfreeJacobianOperator">Matrix-free JacobianOperator</a>
      <ul>
        <li><a href="#EvaluationoftheoldNewtonstep">Evaluation of the old Newton step</a><a href="#EvaluationoftheoldNewtonstep">Evaluation of the old Newton step</a>
        <li><a href="#Nonlinearmatrixfreeoperatorapplication">Nonlinear matrix-free operator application</a><a href="#Nonlinearmatrixfreeoperatorapplication">Nonlinear matrix-free operator application</a>
        <li><a href="#DiagonaloftheJacobianOperator">Diagonal of the JacobianOperator</a><a href="#DiagonaloftheJacobianOperator">Diagonal of the JacobianOperator</a>
      </ul>
        <li><a href="#GelfandProblemclass">GelfandProblem class</a><a href="#GelfandProblemclass">GelfandProblem class</a>
      <ul>
        <li><a href="#GelfandProblemmake_grid">GelfandProblem::make_grid</a><a href="#GelfandProblemmake_grid">GelfandProblem::make_grid</a>
        <li><a href="#GelfandProblemsetup_system">GelfandProblem::setup_system</a><a href="#GelfandProblemsetup_system">GelfandProblem::setup_system</a>
        <li><a href="#GelfandProblemevaluate_residual">GelfandProblem::evaluate_residual</a><a href="#GelfandProblemevaluate_residual">GelfandProblem::evaluate_residual</a>
        <li><a href="#GelfandProblemlocal_evaluate_residual">GelfandProblem::local_evaluate_residual</a><a href="#GelfandProblemlocal_evaluate_residual">GelfandProblem::local_evaluate_residual</a>
        <li><a href="#GelfandProblemassemble_rhs">GelfandProblem::assemble_rhs</a><a href="#GelfandProblemassemble_rhs">GelfandProblem::assemble_rhs</a>
        <li><a href="#GelfandProblemcompute_residual">GelfandProblem::compute_residual</a><a href="#GelfandProblemcompute_residual">GelfandProblem::compute_residual</a>
        <li><a href="#GelfandProblemcompute_update">GelfandProblem::compute_update</a><a href="#GelfandProblemcompute_update">GelfandProblem::compute_update</a>
        <li><a href="#GelfandProblemsolve">GelfandProblem::solve</a><a href="#GelfandProblemsolve">GelfandProblem::solve</a>
        <li><a href="#GelfandProblemcompute_solution_norm">GelfandProblem::compute_solution_norm</a><a href="#GelfandProblemcompute_solution_norm">GelfandProblem::compute_solution_norm</a>
        <li><a href="#GelfandProblemoutput_results">GelfandProblem::output_results</a><a href="#GelfandProblemoutput_results">GelfandProblem::output_results</a>
        <li><a href="#GelfandProblemrun">GelfandProblem::run</a><a href="#GelfandProblemrun">GelfandProblem::run</a>
      </ul>
        <li><a href="#Thecodemaincodefunction">The <code>main</code> function</a><a href="#Thecodemaincodefunction">The <code>main</code> function</a>
      </ul>
</ol></td><td width="50%" valign="top"><ol>
  <li value="3"> <a href="#Results" class=bold>Results</a><a href="#Results" class=bold>Results</a>
    <ul>
        <li><a href="#Programoutput">Program output</a><a href="#Programoutput">Program output</a>
        <li><a href="#Newtonsolver">Newton solver</a><a href="#Newtonsolver">Newton solver</a>
        <li><a href="#Possibilitiesforextensions">Possibilities for extensions</a><a href="#Possibilitiesforextensions">Possibilities for extensions</a>
      <ul>
        <li><a href="#MoresophisticatedNewtoniteration">More sophisticated Newton iteration</a><a href="#MoresophisticatedNewtoniteration">More sophisticated Newton iteration</a>
        <li><a href="#Parallelscalabilityandthreadparallelism">Parallel scalability and thread parallelism</a><a href="#Parallelscalabilityandthreadparallelism">Parallel scalability and thread parallelism</a>
        <li><a href="#Comparisontomatrixbasedmethods">Comparison to matrix-based methods</a><a href="#Comparisontomatrixbasedmethods">Comparison to matrix-based methods</a>
        <li><a href="#Eigenvalueproblem">Eigenvalue problem</a><a href="#Eigenvalueproblem">Eigenvalue problem</a>
    </ul>
    </ul>
  <li> <a href="#PlainProg" class=bold>The plain program</a><a href="#PlainProg" class=bold>The plain program</a>
</ol> </td> </tr> </table>
 <br  />
 <br  />
 <em> This program was contributed by Fabian Castelli.</em></p>
<p><em>A version of this code was presented and discussed in <b>[castelli2021numerical]</b> G.F. Castelli: Numerical Investigation of Cahn-Hilliard-Type Phase-Field Models for Battery Active <a class="el" href="namespaceParticles.html">Particles</a>, PhD thesis, Karlsruhe Institute of Technology (KIT), 2021. (To be published)</em></p>
<p><em>Fabian Castelli acknowledges financial support by the German Research Foundation (DFG) through the Research Training Group 2218 SiMET</em></p>
<p><em>&ndash; Simulation of mechano-electro-thermal processes in lithium-ion batteries, project number 281041241.</em></p>
<p><em>Finally Fabian Castelli would like to thank Timo Heister for the encouragement and advice in writing this tutorial. </em></p>
<p><a class="anchor" id="Intro"></a><a class="anchor" id="Introduction"></a></p><h1>Introduction</h1>
<p>The aim of this tutorial program is to demonstrate how to solve a nonlinearproblem using Newton's method within the matrix-free framework. This tutorialcombines several techniques already introduced in <a class="el" href="step_15.html">step-15</a> , <a class="el" href="step_16.html">step-16</a> , <a class="el" href="step_37.html">step-37</a> , <a class="el" href="step_48.html">step-48</a> and others.</p>
<p><a class="anchor" id="Problemformulation"></a></p><h3>Problem formulation</h3>
<p>On the unit circle \(\Omega = \bigl\{ x \in \mathbb{R}^2 : \|x\| \leq 1 \bigr\}\) we consider the following nonlinear elliptic boundary value problem subject to ahomogeneous Dirichlet boundary condition: Find a function \(u\colon\Omega\to\mathbb{R}\) such that it holds: </p><p class="formulaDsp">
\begin{align*} - \Delta u &amp;= \exp(u) &amp; \quad &amp; \text{in } \Omega,\\ u &amp;= 0 &amp; \quad &amp; \text{on } \partial\Omega. \end{align*}
</p>
<p> This problem is also called the <em>Gelfand problem</em> and is a typical examplefor problems from combustion theory, see for example <b>[bebernes1989mathematical]</b> .</p>
<p><a class="anchor" id="Discretizationwithfiniteelements"></a></p><h3>Discretization with finite elements</h3>
<p>As usual, we first derive the weak formulation for this problem by multiplyingwith a smooth test function \(v\colon\Omega\to\mathbb{R}\) respecting theboundary condition and integrating over the domain \(\Omega\) . Integration byparts and putting the term from the right hand side to the left yields the weakformulation: Find a function \(u\colon\Omega\to\mathbb{R}\) such that for alltest functions \(v\) it holds: </p><p class="formulaDsp">
\begin{align*} \int_\Omega \nabla v \cdot \nabla u \,\mathrm{d}x - \int_\Omega v \exp(u) \,\mathrm{d}x = 0. \end{align*}
</p>
<p>Choosing the Lagrangian finite element space \(V_h \dealcoloneq \bigl\{ v \in C(\overline{\Omega}) : v|_Q \in \mathbb{Q}_p \text{ for all } Q \in \mathcal{T}_h \bigr\} \cap H_0^1(\Omega)\) , which directly incorporatesthe homogeneous Dirichlet boundary condition, we can define a basis \(\{\varphi_i\}_{i=1,\dots,N}\) and thus it suffices to test only with thosebasis functions. So the discrete problem reads as follows: Find \(u_h\in V_h\) such that for all \(i=1,\dots,N\) it holds: </p><p class="formulaDsp">
\begin{align*} F(u_h) \dealcoloneq \int_\Omega \nabla \varphi_i \cdot \nabla u_h \,\mathrm{d}x - \int_\Omega \varphi_i \exp(u_h) \,\mathrm{d}x \stackrel{!}{=} 0. \end{align*}
</p>
<p> As each finite element function is a linear combination of the basis functions \(\{\varphi_i\}_{i=1,\dots,N}\) , we can identify the finite element solution bya vector from \(\mathbb{R}^N\) consisting of the unknown values in each degree offreedom (DOF). Thus, we define the nonlinear function \(F\colon\mathbb{R}^N\to\mathbb{R}^N\) representing the discrete nonlinearproblem. To solve this nonlinear problem we use Newton's method. So given aninitial guess \(u_h^0\in V_h\) , which already fulfills the Dirichlet boundarycondition, we determine a sequence of Newton steps \(\bigl( u_h^n \bigr)_n\) bysuccessively applying the following scheme: </p><p class="formulaDsp">
\begin{align*} &amp;\text{Solve for } s_h^n\in V_h: \quad &amp; F&#39;(u_h^n)[s_h^n] &amp;= -F(u_h^n),\\ &amp;\text{Update: } &amp; u_h^{n+1} &amp;= u_h^n + s_h^n. \end{align*}
</p>
<p> So in each Newton step we have to solve a linear problem \(A\,x = b\) , where thesystem matrix \(A\) is represented by the Jacobian \(F&#39;(u_h^n)[\,\cdot\,]\colon\mathbb{R}^N\to\mathbb{R}^N\) and the right hand side \(b\) by the negative residual \(-F(u_h^n)\) . The solution vector \(x\) is in thatcase the Newton update of the \(n\) -th Newton step. Note, that we assume aninitial guess \(u_h^0\) , which already fulfills the Dirichlet boundary conditionsof the problem formulation (in fact this could also be an inhomogeneousDirichlet boundary condition) and thus the Newton updates \(s_h\) satisfy ahomogeneous Dirichlet condition. Until now we only tested with the basis functions, however, we can alsorepresent any function of \(V_h\) as linear combination of basis functions. Moremathematically this means, that every element of \(V_h\) can beidentified with a vector \(U\in\mathbb{R}^N\) via the representation formula: \(u_h = \sum_{i=1}^N U_i \varphi_i\) . So using this we can give an expression forthe discrete Jacobian and the residual: </p><p class="formulaDsp">
\begin{align*} A_{i,j} = \bigl( F&#39;(u_h^n) \bigr)_{i,j} &amp;= \int_\Omega \nabla\varphi_i \cdot \nabla \varphi_j \,\mathrm{d} x - \int_\Omega \varphi_i \, \exp( u_h ) \varphi_j \,\mathrm{d} x,\\ b_{i} = \bigl( F(u_h^n) \bigr)_{i} &amp;= \int_\Omega \nabla\varphi_i \cdot \nabla u_h^n \,\mathrm{d} x - \int_\Omega \varphi_i \, \exp( u_h^n ) \,\mathrm{d} x. \end{align*}
</p>
<p> Compared to <a class="el" href="step_15.html">step-15</a> we could also have formed the Frech{\'e}t derivative of thenonlinear function corresponding to the strong formulation of the problem anddiscretized it afterwards. However, in the end we would get the same set ofdiscrete equations.</p>
<p><a class="anchor" id="Numericallinearalgebra"></a></p><h3>Numerical linear algebra</h3>
<p>Note, how the system matrix, actually the Jacobian, depends on the previousNewton step \(A = F&#39;(u^n)\) . Hence we need to tell the function that computesthe system matrix about the solution at the last Newton step. In animplementation with a classical <code>assemble_system()</code> function wewould gather this information from the last Newton step during assembly by theuse of the member functions <a class="el" href="classFEValuesBase.html#a357b422e374f2f2207af3512093f3907">FEValuesBase::get_function_values()</a> and <a class="el" href="classFEValuesBase.html#ad1f4e0deb5d982e8172d82141c634a67">FEValuesBase::get_function_gradients()</a>. The <code>assemble_system()</code> function would then looks like: </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> GelfandProblem&lt;dim&gt;::assemble_system()</div>
<div class="line">{</div>
<div class="line">  system_matrix = 0;</div>
<div class="line">  system_rhs    = 0;</div>
<div class="line">  </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> quadrature_formula(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1);</div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>     fe_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                          quadrature_formula,</div>
<div class="line">                          <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line">  </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>    = fe_values.n_quadrature_points;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> = fe_values.dofs_per_cell;</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a>                   <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a>(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a>                       cell_rhs(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; <a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">  </div>
<div class="line">  std::vector&lt;Tensor&lt;1, dim&gt;&gt; newton_step_gradients(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line">  std::vector&lt;double&gt;         newton_step_values(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a> = 0.0;</div>
<div class="line">      cell_rhs    = 0.0;</div>
<div class="line">  </div>
<div class="line">      fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line">  </div>
<div class="line">      fe_values.get_function_values(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, newton_step_values);</div>
<div class="line">      fe_values.get_function_gradients(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, newton_step_gradients);</div>
<div class="line">  </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q)</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> nonlinearity = <a class="code" href="base_2vectorization_8h.html#a19f846bda83b7e3f4531daacb40c64e1">std::exp</a>(newton_step_values[q]);</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1a9e60516f3a44e6d7cd4ac533f6bc0209">dx</a>           = fe_values.JxW(q);</div>
<div class="line">  </div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">double</span>         phi_i      = fe_values.shape_value(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q);</div>
<div class="line">              <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> grad_phi_i = fe_values.shape_grad(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q);</div>
<div class="line">  </div>
<div class="line">              <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> = 0; <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>)</div>
<div class="line">                {</div>
<div class="line">                  <span class="keyword">const</span> <span class="keywordtype">double</span>         phi_j      = fe_values.shape_value(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q);</div>
<div class="line">                  <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> grad_phi_j = fe_values.shape_grad(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q);</div>
<div class="line">  </div>
<div class="line">                  <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>) +=</div>
<div class="line">                    (grad_phi_i grad_phi_j</div>
<div class="line">  </div>
<div class="line">- phi_i nonlinearity phi_j)</div>
<div class="line">                    <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1a9e60516f3a44e6d7cd4ac533f6bc0209">dx</a>;</div>
<div class="line">                }</div>
<div class="line">  </div>
<div class="line">              cell_rhs(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>) += (-grad_phi_i newton_step_gradients[q] +</div>
<div class="line">                              phi_i newton_step_values[q])</div>
<div class="line">                             <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1a9e60516f3a44e6d7cd4ac533f6bc0209">dx</a>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">  </div>
<div class="line">      <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;get_dof_indices(<a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>);</div>
<div class="line">  </div>
<div class="line">      <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#a373fbdacd8c486e675b8d2bff8943192">distribute_local_to_global</a>(</div>
<div class="line">        <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a>, cell_rhs, <a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>, system_matrix, system_rhs);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Since we want to solve this problem without storing a matrix, we need to tellthe matrix-free operator this information before we use it. Therefore in thederived class <code>JacobianOperator</code> we will implement a functioncalled <code>evaluate_newton_step</code> , which will process the information ofthe last Newton step prior to the usage of the matrix-vector implementation.Furthermore we want to use a geometric multigrid (GMG) preconditioner for thelinear solver, so in order to apply the multilevel operators we need to pass thelast Newton step also to these operators. This is kind of a tricky task, sincethe vector containing the last Newton step has to be interpolated to all levelsof the triangulation. In the code this task will be done by the function <a class="el" href="classMGTransferMatrixFree.html#a90aef560cc3d832589ca13a5f18e1414">MGTransferMatrixFree::interpolate_to_mg()</a>. Note, a fundamental difference tothe previous cases, where we set up and used a geometric multigridpreconditioner, is the fact, that we can reuse the <a class="el" href="classMGTransferMatrixFree.html">MGTransferMatrixFree</a> objectfor the computation of all Newton steps. So we can save some work here bydefining a class variable and using an already set up MGTransferMatrixFreeobject <code>mg_transfer</code> that was initialized in the <code>setup_system()</code> function. </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::compute_update()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;compute update&quot;</span>);</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.update_ghost_values();</div>
<div class="line">  </div>
<div class="line">  system_matrix.evaluate_newton_step(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line">  </div>
<div class="line">  mg_transfer.<a class="code" href="classMGTransferMatrixFree.html#a90aef560cc3d832589ca13a5f18e1414">interpolate_to_mg</a>(dof_handler, mg_solution, <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Set up options for the multilevel preconditioner</span></div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels(); ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">    {</div>
<div class="line">      mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].evaluate_newton_step(mg_solution[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>]);</div>
<div class="line">    }</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Define the actual preconditioner</span></div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Solve the linear system</span></div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>The function evaluating the nonlinearity works basically in the same way as thefunction <code>evaluate_coefficient</code> from <a class="el" href="step_37.html">step-37</a> evaluating a coefficientfunction. The idea is to use an <a class="el" href="classFEEvaluation.html">FEEvaluation</a> object to evaluate the Newton stepand store the expression in a table for all cells and all quadrature points: </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line"><span class="keywordtype">void</span> JacobianOperator&lt;dim, fe_degree, number&gt;::evaluate_newton_step(</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;newton_step)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a> = this-&gt;data-&gt;<a class="code" href="classMatrixFree.html#a8c9d964339b466bdcb661552e731e222">n_cell_batches</a>();</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, fe_degree, fe_degree + 1, 1, number&gt;</a> phi(*this-&gt;data);</div>
<div class="line">  </div>
<div class="line">  nonlinear_values.reinit(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>, phi.n_q_points);</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> = 0; <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> &lt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>; ++<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>)</div>
<div class="line">    {</div>
<div class="line">      phi.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line">      phi.read_dof_values_plain(newton_step);</div>
<div class="line">      phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a>);</div>
<div class="line">  </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">        {</div>
<div class="line">          nonlinear_values(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, q) = <a class="code" href="base_2vectorization_8h.html#a19f846bda83b7e3f4531daacb40c64e1">std::exp</a>(phi.get_value(q));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Triangulation"></a></p><h3><a class="el" href="classTriangulation.html">Triangulation</a></h3>
<p>As said in <a class="el" href="step_37.html">step-37</a> the matrix-free method gets more efficient if we choose ahigher order finite element space. Since we want to solve the problem on the \(d\) -dimensional unit ball, it would be good to have an appropriate boundaryapproximation to overcome convergence issues. For this reason we use anisoparametric approach with the <a class="el" href="classMappingQGeneric.html">MappingQGeneric</a> class to recover the smoothboundary as well as the mapping for inner cells. In addition, to get a goodtriangulation in total we make use of the <a class="el" href="classTransfiniteInterpolationManifold.html">TransfiniteInterpolationManifold</a>.</p>
<p><a class="anchor" id="CommProg"></a> </p><h1>The commented program</h1>
<p>First we include the typical headers of the deal.II library needed for this tutorial:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2timer_8h.html">deal.II/base/timer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2vectorization_8h.html">deal.II/base/vectorization.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__accessor_8h.html">deal.II/dofs/dof_accessor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2mapping__q__generic_8h.html">deal.II/fe/mapping_q_generic.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__out_8h.html">deal.II/grid/grid_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2manifold__lib_8h.html">deal.II/grid/manifold_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria__accessor_8h.html">deal.II/grid/tria_accessor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria__iterator_8h.html">deal.II/grid/tria_iterator.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2precondition_8h.html">deal.II/lac/precondition.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2solver__cg_8h.html">deal.II/lac/solver_cg.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2vector_8h.html">deal.II/lac/vector.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
</div><!-- fragment --><p>In particular, we need to include the headers for the matrix-free framework:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_2fe__evaluation_8h.html">deal.II/matrix_free/fe_evaluation.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_2matrix__free_8h.html">deal.II/matrix_free/matrix_free.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_2operators_8h.html">deal.II/matrix_free/operators.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_2tools_8h.html">deal.II/matrix_free/tools.h</a>&gt;</span></div>
</div><!-- fragment --><p>And since we want to use a geometric multigrid preconditioner, we need also the multilevel headers:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__coarse_8h.html">deal.II/multigrid/mg_coarse.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__constrained__dofs_8h.html">deal.II/multigrid/mg_constrained_dofs.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__matrix_8h.html">deal.II/multigrid/mg_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__smoother_8h.html">deal.II/multigrid/mg_smoother.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__tools_8h.html">deal.II/multigrid/mg_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__transfer__matrix__free_8h.html">deal.II/multigrid/mg_transfer_matrix_free.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2multigrid_8h.html">deal.II/multigrid/multigrid.h</a>&gt;</span></div>
</div><!-- fragment --><p>Finally some common C++ headers for in and output:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceStep66.html">Step66</a></div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
</div><!-- fragment --><p><a class="anchor" id="MatrixfreeJacobianOperator"></a> </p><h3>Matrix-free JacobianOperator</h3>
<p>In the beginning we define the matrix-free operator for the Jacobian. As a guideline we follow the tutorials <a class="el" href="step_37.html">step-37</a> and <a class="el" href="step_48.html">step-48</a> , where the precise interface of the <a class="el" href="classMatrixFreeOperators_1_1Base.html">MatrixFreeOperators::Base</a> class was extensively documented. <br  />
 Since we want to use the Jacobian as system matrix and pass it to the linear solver as well as to the multilevel preconditioner classes, we derive the <code>JacobianOperator</code> class from the <a class="el" href="classMatrixFreeOperators_1_1Base.html">MatrixFreeOperators::Base</a> class, such that we have already the right interface. The two functions we need to override from the base class are the <a class="el" href="classMatrixFreeOperators_1_1Base.html#abc81493aad390198580330cc99203b3c">MatrixFreeOperators::Base::apply_add()</a> and the <a class="el" href="classMatrixFreeOperators_1_1Base.html#a16d883c49c69eef468b39b2e991d8b0d">MatrixFreeOperators::Base::compute_diagonal()</a> function. To allow preconditioning with float precision we define the number type as template argument. <br  />
 As mentioned already in the introduction, we need to evaluate the Jacobian \(F&#39;\) at the last Newton step \(u_h^n\) for the computation of the Newton update \(s_h^n\) . To get the information of the last Newton step \(u_h^n\) we do pretty much the same as in <a class="el" href="step_37.html">step-37</a> , where we stored the values of a coefficient function in a table <code>nonlinear_values</code> once before we use the matrix-free operator. Instead of a function <code>evaluate_coefficient()</code> , we here implement a function <code>evaluate_newton_step()</code> . <br  />
 As additional private member functions of the <code>JacobianOperator</code> we implement the <code>local_apply()</code> and the <code>local_compute_diagonal()</code> function. The first one is the actual worker function for the matrix-vector application, which we pass to the <a class="el" href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">MatrixFree::cell_loop()</a> in the <code><a class="el" href="operators__0_8txt.html#a92cb2920df95b6f107c2c9a8c75b788c">apply_add()</a></code> function. The later one is the worker function to compute the diagonal, which we pass to the <a class="el" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">MatrixFreeTools::compute_diagonal()</a> function. <br  />
 For better readability of the source code we further define an alias for the <a class="el" href="classFEEvaluation.html">FEEvaluation</a> object.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line"><span class="keyword">class </span>JacobianOperator</div>
<div class="line">  : <span class="keyword">public</span> <a class="code" href="namespaceMatrixFreeOperators.html">MatrixFreeOperators</a>::</div>
<div class="line">      Base&lt;dim, LinearAlgebra::distributed::Vector&lt;number&gt;&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">using</span> value_type = <a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using</span> FECellIntegrator =</div>
<div class="line">    <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, fe_degree, fe_degree + 1, 1, number&gt;</a>;</div>
<div class="line"> </div>
<div class="line">  JacobianOperator();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="table__0_8txt.html#a7f24305532768edc889062eefd4b28cf">clear</a>() <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> evaluate_newton_step(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;newton_step);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">compute_diagonal</a>() <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="operators__0_8txt.html#a92cb2920df95b6f107c2c9a8c75b788c">apply_add</a>(</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src) <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span></div>
<div class="line">  local_apply(<span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, number&gt;</a> &amp;                   <a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>,</div>
<div class="line">              <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">              <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src,</div>
<div class="line">              <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;cell_range) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> local_compute_diagonal(FECellIntegrator &amp;integrator) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTable.html">Table&lt;2, VectorizedArray&lt;number&gt;</a>&gt; nonlinear_values;</div>
<div class="line">};</div>
</div><!-- fragment --><p>The constructor of the <code>JacobianOperator</code> just calls the constructor of the base class <a class="el" href="classMatrixFreeOperators_1_1Base.html">MatrixFreeOperators::Base</a>, which is itself derived from the <a class="el" href="classSubscriptor.html">Subscriptor</a> class.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">JacobianOperator&lt;dim, fe_degree, number&gt;::JacobianOperator()</div>
<div class="line">  : <a class="code" href="namespaceMatrixFreeOperators.html">MatrixFreeOperators</a>::Base&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>,</div>
<div class="line">                              <a class="code" href="namespaceLinearAlgebra.html">LinearAlgebra</a>::<a class="code" href="distributed__0_8txt.html#ad7a526c3d1317369fada16d420fcb06c">distributed</a>::<a class="code" href="classVector.html">Vector</a>&lt;<a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>&gt;&gt;()</div>
<div class="line">{}</div>
</div><!-- fragment --><p>The <code><a class="el" href="table__0_8txt.html#a7f24305532768edc889062eefd4b28cf">clear()</a></code> function resets the table holding the values for the nonlinearity and call the <code><a class="el" href="table__0_8txt.html#a7f24305532768edc889062eefd4b28cf">clear()</a></code> function of the base class.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="table__0_8txt.html#a7f24305532768edc889062eefd4b28cf">JacobianOperator&lt;dim, fe_degree, number&gt;::clear</a>()</div>
<div class="line">{</div>
<div class="line">  nonlinear_values.reinit(0, 0);</div>
<div class="line">  <a class="code" href="classMatrixFreeOperators_1_1Base.html">MatrixFreeOperators::Base&lt;dim, LinearAlgebra::distributed::Vector&lt;number&gt;</a>&gt;<a class="code" href="table__0_8txt.html#a7f24305532768edc889062eefd4b28cf">::</a></div>
<div class="line"><a class="code" href="table__0_8txt.html#a7f24305532768edc889062eefd4b28cf">    clear</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="EvaluationoftheoldNewtonstep"></a> </p><h4>Evaluation of the old Newton step</h4>
<p>The following <code>evaluate_newton_step()</code> function is based on the <code>evaluate_coefficient()</code> function from <a class="el" href="step_37.html">step-37</a> . However, it does not evaluate a function object, but evaluates a vector representing a finite element function, namely the last Newton step needed for the Jacobian. Therefore we set up a <a class="el" href="classFEEvaluation.html">FEEvaluation</a> object and evaluate the finite element function in the quadrature points with the FEEvaluation::read_dof_values_plain() and <a class="el" href="classFEEvaluation.html#a710c252e9dccc0c4ce07044cac3bdd9b">FEEvaluation::evaluate()</a> functions. We store the evaluated values of the finite element function directly in the <code>nonlinear_values</code> table. <br  />
 This will work well and in the <code>local_apply()</code> function we can use the values stored in the table to apply the matrix-vector product. However, we can also optimize the implementation of the Jacobian at this stage. We can directly evaluate the nonlinear function <code>std::exp(newton_step[q])</code> and store these values in the table. This skips all evaluations of the nonlinearity in each call of the <code><a class="el" href="linear__operator__0_8txt.html#a64f52ea7f8959e614f32da4664cdbe50">vmult()</a></code> function.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line"><span class="keywordtype">void</span> JacobianOperator&lt;dim, fe_degree, number&gt;::evaluate_newton_step(</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;newton_step)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a> = this-&gt;data-&gt;<a class="code" href="classMatrixFree.html#a8c9d964339b466bdcb661552e731e222">n_cell_batches</a>();</div>
<div class="line">  FECellIntegrator   phi(*this-&gt;data);</div>
<div class="line"> </div>
<div class="line">  nonlinear_values.reinit(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>, phi.n_q_points);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> = 0; <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> &lt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>; ++<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>)</div>
<div class="line">    {</div>
<div class="line">      phi.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line">      phi.read_dof_values_plain(newton_step);</div>
<div class="line">      phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">        {</div>
<div class="line">          nonlinear_values(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, q) = <a class="code" href="base_2vectorization_8h.html#a19f846bda83b7e3f4531daacb40c64e1">std::exp</a>(phi.get_value(q));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Nonlinearmatrixfreeoperatorapplication"></a> </p><h4>Nonlinear matrix-free operator application</h4>
<p>Now in the <code>local_apply()</code> function, which actually implements the cell wise action of the system matrix, we can use the information of the last Newton step stored in the table <code>nonlinear_values</code> . The rest of this function is basically the same as in <a class="el" href="step_37.html">step-37</a> . We set up the <a class="el" href="classFEEvaluation.html">FEEvaluation</a> object, gather and evaluate the values and gradients of the input vector <code>src</code> , submit the values and gradients according to the form of the Jacobian and finally call <a class="el" href="classFEEvaluation.html#a491779be7bd032d277e41f1dda8dc584">FEEvaluation::integrate_scatter()</a> to perform the cell integration and distribute the local contributions into the global vector <code> dst</code> .</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line"><span class="keywordtype">void</span> JacobianOperator&lt;dim, fe_degree, number&gt;::local_apply(</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, number&gt;</a> &amp;                   <a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>,</div>
<div class="line">  <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src,</div>
<div class="line">  <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;     cell_range)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  FECellIntegrator phi(<a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> = cell_range.first; <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> &lt; cell_range.second; ++<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(nonlinear_values.size(0),</div>
<div class="line">                      phi.get_matrix_free().n_cell_batches());</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(nonlinear_values.size(1), phi.n_q_points);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      phi.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">      phi.gather_evaluate(src,</div>
<div class="line">                          <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> |</div>
<div class="line">                            <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">        {</div>
<div class="line">          phi.submit_value(-nonlinear_values(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, q) phi.get_value(q), q);</div>
<div class="line">          phi.submit_gradient(phi.get_gradient(q), q);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      phi.integrate_scatter(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> |</div>
<div class="line">                              <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>,</div>
<div class="line">                            <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Next we use <a class="el" href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">MatrixFree::cell_loop()</a> to perform the actual loop over all cells computing the cell contribution to the matrix-vector product.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="operators__0_8txt.html#a92cb2920df95b6f107c2c9a8c75b788c">JacobianOperator&lt;dim, fe_degree, number&gt;::apply_add</a>(</div>
<div class="line">  <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  this-&gt;data-&gt;<a class="code" href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">cell_loop</a>(&amp;JacobianOperator::local_apply, <span class="keyword">this</span>, <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>, src);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="DiagonaloftheJacobianOperator"></a> </p><h4>Diagonal of the JacobianOperator</h4>
<p>The internal worker function <code>local_compute_diagonal()</code> for the computation of the diagonal is similar to the above worker function <code>local_apply()</code> . However, as major difference we do not read values from a input vector or distribute any local results to an output vector. Instead the only input argument is the used <a class="el" href="classFEEvaluation.html">FEEvaluation</a> object.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line"><span class="keywordtype">void</span> JacobianOperator&lt;dim, fe_degree, number&gt;::local_compute_diagonal(</div>
<div class="line">  FECellIntegrator &amp;phi)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(nonlinear_values.size(0),</div>
<div class="line">                  phi.get_matrix_free().n_cell_batches());</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(nonlinear_values.size(1), phi.n_q_points);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> = phi.get_current_cell_index();</div>
<div class="line"> </div>
<div class="line">  phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> | <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">    {</div>
<div class="line">      phi.submit_value(-nonlinear_values(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, q) phi.get_value(q), q);</div>
<div class="line">      phi.submit_gradient(phi.get_gradient(q), q);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  phi.integrate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> | <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Finally we override the <a class="el" href="classMatrixFreeOperators_1_1Base.html#a16d883c49c69eef468b39b2e991d8b0d">MatrixFreeOperators::Base::compute_diagonal()</a> function of the base class of the <code>JacobianOperator</code> . Although the name of the function suggests just the computation of the diagonal, this function does a bit more. Because we only really need the inverse of the matrix diagonal elements for the Chebyshev smoother of the multigrid preconditioner, we compute the diagonal and store the inverse elements. Therefore we first initialize the <code>inverse_diagonal_entries</code> . Then we compute the diagonal by passing the worker function <code>local_compute_diagonal()</code> to the <a class="el" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">MatrixFreeTools::compute_diagonal()</a> function. In the end we loop over the diagonal and invert the elements by hand. Note, that during this loop we catch the constrained DOFs and set them manually to one.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">JacobianOperator&lt;dim, fe_degree, number&gt;::compute_diagonal</a>()</div>
<div class="line">{</div>
<div class="line">  this-&gt;inverse_diagonal_entries.reset(</div>
<div class="line">    <span class="keyword">new</span> <a class="code" href="classDiagonalMatrix.html">DiagonalMatrix</a>&lt;<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a>&gt;());</div>
<div class="line">  <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;inverse_diagonal =</div>
<div class="line">    this-&gt;inverse_diagonal_entries-&gt;get_vector();</div>
<div class="line">  this-&gt;data-&gt;<a class="code" href="classMatrixFree.html#ab92a24942737bbaf04d7e00aceba9b57">initialize_dof_vector</a>(inverse_diagonal);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">MatrixFreeTools::compute_diagonal</a>(*this-&gt;data,</div>
<div class="line">                                    inverse_diagonal,</div>
<div class="line">                                    &amp;JacobianOperator::local_compute_diagonal,</div>
<div class="line">                                    <span class="keyword">this</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;diagonal_element : inverse_diagonal)</div>
<div class="line">    {</div>
<div class="line">      diagonal_element = (<a class="code" href="base_2vectorization_8h.html#aafbdfdd72b6cfe4eae5fa7a16385582f">std::abs</a>(diagonal_element) &gt; 1.0e-10) ?</div>
<div class="line">                           (1.0 / diagonal_element) :</div>
<div class="line">                           1.0;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemclass"></a> </p><h3>GelfandProblem class</h3>
<p>After implementing the matrix-free operators we can now define the solver class for the <em>Gelfand problem</em>. This class is based on the common structure of all previous tutorial programs, in particular it is based on <a class="el" href="step_15.html">step-15</a> , solving also a nonlinear problem. Since we are using the matrix-free framework, we no longer need an assemble_system function any more, instead the information of the matrix is rebuilt in every call of the <code><a class="el" href="linear__operator__0_8txt.html#a64f52ea7f8959e614f32da4664cdbe50">vmult()</a></code> function. However, for the application of the Newton scheme we need to assemble the right hand side of the linearized problems and compute the residuals. Therefore, we implement an additional function <code>evaluate_residual()</code> , which we later call in the <code>assemble_rhs()</code> and the <code>compute_residual()</code> function. Finally, the typical <code><a class="el" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve()</a></code> function here implements the Newton method, whereas the solution of the linearized system is computed in the function <code>compute_update()</code> . As the <a class="el" href="classMatrixFree.html">MatrixFree</a> framework handles the polynomial degree of the Lagrangian finite element method as a template parameter, we declare it also as a template parameter for the problem solver class.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keyword">class </span>GelfandProblem</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  GelfandProblem();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">run</a>();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="step-2_8cc.html#ab108b7b7bca84a81aceda045aaef1961">make_grid</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> setup_system();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> evaluate_residual(</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;src) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> local_evaluate_residual(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, double&gt;</a> &amp;                   <a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>,</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;src,</div>
<div class="line">    <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;     cell_range) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> assemble_rhs();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> compute_residual(<span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> compute_update();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> compute_solution_norm() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>) <span class="keyword">const</span>;</div>
</div><!-- fragment --><p>For the parallel computation we define a <a class="el" href="classparallel_1_1distributed_1_1Triangulation.html">parallel::distributed::Triangulation</a>. As the computational domain is a circle in 2D and a ball in 3D, we assign in addition to the <a class="el" href="classSphericalManifold.html">SphericalManifold</a> for boundary cells a <a class="el" href="classTransfiniteInterpolationManifold.html">TransfiniteInterpolationManifold</a> object for the mapping of the inner cells, which takes care of the inner cells. In this example we use an isoparametric finite element approach and thus use the <a class="el" href="classMappingQGeneric.html">MappingQGeneric</a> class. Note, that we could also create an instance of the <a class="el" href="classMappingQ.html">MappingQ</a> class and set the <code>use_mapping_q_on_all_cells</code> flags in the contructor call to <code>true</code> . For further details on the connection of <a class="el" href="classMappingQ.html">MappingQ</a> and <a class="el" href="classMappingQGeneric.html">MappingQGeneric</a> you may read the detailed description of these classes.</p>
<div class="fragment"><div class="line"><a class="code" href="classparallel_1_1distributed_1_1Triangulation.html">parallel::distributed::Triangulation&lt;dim&gt;</a> <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>;</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classMappingQGeneric.html">MappingQGeneric&lt;dim&gt;</a>                <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>;</div>
</div><!-- fragment --><p>As usual we then define the Lagrangian finite elements <a class="el" href="classFE__Q.html">FE_Q</a> and a <a class="el" href="classDoFHandler.html">DoFHandler</a>.</p>
<div class="fragment"><div class="line"><a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a>       <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>;</div>
<div class="line"><a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> dof_handler;</div>
</div><!-- fragment --><p>For the linearized discrete system we define an <a class="el" href="classAffineConstraints.html">AffineConstraints</a> objects and the <code>system_matrix</code> , which is in this example represented as a matrix-free operator.</p>
<div class="fragment"><div class="line"><a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>;</div>
<div class="line"><span class="keyword">using</span> SystemMatrixType = JacobianOperator&lt;dim, fe_degree, double&gt;;</div>
<div class="line">SystemMatrixType system_matrix;</div>
</div><!-- fragment --><p>The multilevel object is also based on the matrix-free operator for the Jacobian. Since we need to evaluate the Jacobian with the last Newton step, we also need to evaluate the level operator with the last Newton step for the preconditioner. Thus in addition to <code>mg_matrices</code> , we also need a <a class="el" href="classMGLevelObject.html">MGLevelObject</a> to store the interpolated solution vector on each level. As in <a class="el" href="step_37.html">step-37</a> we use float precision for the preconditioner. Moreover, we define the <a class="el" href="classMGTransferMatrixFree.html">MGTransferMatrixFree</a> object as a class variable, since we need to set it up only once when the triangulation has changed and can then use it again in each Newton step.</p>
<div class="fragment"><div class="line"><a class="code" href="classMGConstrainedDoFs.html">MGConstrainedDoFs</a> mg_constrained_dofs;</div>
<div class="line"><span class="keyword">using</span> LevelMatrixType = JacobianOperator&lt;dim, fe_degree, float&gt;;</div>
<div class="line"><a class="code" href="classMGLevelObject.html">MGLevelObject&lt;LevelMatrixType&gt;</a>                           mg_matrices;</div>
<div class="line"><a class="code" href="classMGLevelObject.html">MGLevelObject&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt; mg_solution;</div>
<div class="line"><a class="code" href="classMGTransferMatrixFree.html">MGTransferMatrixFree&lt;dim, float&gt;</a>                         mg_transfer;</div>
</div><!-- fragment --><p>Of course we also need vectors holding the <code>solution</code> , the <code>newton_update</code> and the <code>system_rhs</code> . In that way we can always store the last Newton step in the solution vector and just add the update to get the next Newton step.</p>
<div class="fragment"><div class="line"><a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>;</div>
<div class="line"><a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> newton_update;</div>
<div class="line"><a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> system_rhs;</div>
</div><!-- fragment --><p>Finally we have a variable for the number of iterations of the linear solver.</p>
<div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> linear_iterations;</div>
</div><!-- fragment --><p>For the output in programs running in parallel with MPI, we use the <a class="el" href="classConditionalOStream.html">ConditionalOStream</a> class to avoid multiple output of the same data by different MPI ranks.</p>
<div class="fragment"><div class="line"><a class="code" href="classConditionalOStream.html">ConditionalOStream</a> pcout;</div>
</div><!-- fragment --><p>Finally for the time measurement we use a <a class="el" href="classTimerOutput.html">TimerOutput</a> object, which prints the elapsed CPU and wall times for each function in a nicely formatted table after the program has finished.</p>
<div class="fragment"><div class="line">  <a class="code" href="classTimerOutput.html">TimerOutput</a> computing_timer;</div>
<div class="line">};</div>
</div><!-- fragment --><p>The constructor of the <code>GelfandProblem</code> initializes the class variables. In particular, we set up the multilevel support for the <a class="el" href="classparallel_1_1distributed_1_1Triangulation.html">parallel::distributed::Triangulation</a>, set the mapping degree equal to the finite element degree, initialize the <a class="el" href="classConditionalOStream.html">ConditionalOStream</a> and tell the <a class="el" href="classTimerOutput.html">TimerOutput</a> that we want to see the wall times only on demand.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">GelfandProblem&lt;dim, fe_degree&gt;::GelfandProblem()</div>
<div class="line">  : <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>(MPI_COMM_WORLD,</div>
<div class="line">                  <a class="code" href="classTriangulation.html">Triangulation</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;::limit_level_difference_at_vertices,</div>
<div class="line">                  <a class="code" href="namespaceparallel.html">parallel</a>::<a class="code" href="distributed__0_8txt.html#ad7a526c3d1317369fada16d420fcb06c">distributed</a>::<a class="code" href="classTriangulation.html">Triangulation</a>&lt;</div>
<div class="line">                    <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;::<a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0a3901e6a241f812109912537866771e4c">construct_multigrid_hierarchy</a>)</div>
<div class="line">  , <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>(<a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>)</div>
<div class="line">  , <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>(<a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>)</div>
<div class="line">  , dof_handler(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>)</div>
<div class="line">  , pcout(std::cout, <a class="code" href="namespaceUtilities.html">Utilities</a>::<a class="code" href="base_2partitioner__0_8txt.html#a6d2d0fa485d1660823c59c494fb0fb31">MPI</a>::<a class="code" href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">this_mpi_process</a>(MPI_COMM_WORLD) == 0)</div>
<div class="line">  , computing_timer(MPI_COMM_WORLD,</div>
<div class="line">                    pcout,</div>
<div class="line">                    <a class="code" href="classTimerOutput.html">TimerOutput</a>::never,</div>
<div class="line">                    <a class="code" href="classTimerOutput.html">TimerOutput</a>::wall_times)</div>
<div class="line">{}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemmake_grid"></a> </p><h4>GelfandProblem::make_grid</h4>
<p>As the computational domain we use the <code>dim</code> -dimensional unit ball. We follow the instructions for the <a class="el" href="classTransfiniteInterpolationManifold.html">TransfiniteInterpolationManifold</a> class and also assign a <a class="el" href="classSphericalManifold.html">SphericalManifold</a> for the boundary. Finally, we refine the initial mesh 3</p>
<ul>
<li><code>dim</code> times globally.</li>
</ul>
<div class="fragment"><div class="line">   <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">   <span class="keywordtype">void</span> <a class="code" href="step-2_8cc.html#ab108b7b7bca84a81aceda045aaef1961">GelfandProblem&lt;dim, fe_degree&gt;::make_grid</a>()</div>
<div class="line">   {</div>
<div class="line">     <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;make grid&quot;</span>);</div>
<div class="line">  </div>
<div class="line">     <a class="code" href="classSphericalManifold.html">SphericalManifold&lt;dim&gt;</a>                boundary_manifold;</div>
<div class="line">     <a class="code" href="classTransfiniteInterpolationManifold.html">TransfiniteInterpolationManifold&lt;dim&gt;</a> inner_manifold;</div>
<div class="line">  </div>
<div class="line">     <a class="code" href="namespaceGridGenerator.html#a533c4778cbc9bcbed365dcab42ca4418">GridGenerator::hyper_ball</a>(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>);</div>
<div class="line">  </div>
<div class="line">     <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.set_all_manifold_ids(1);</div>
<div class="line">     <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.set_all_manifold_ids_on_boundary(0);</div>
<div class="line">  </div>
<div class="line">     <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.set_manifold(0, boundary_manifold);</div>
<div class="line">  </div>
<div class="line">     inner_manifold.<a class="code" href="classTransfiniteInterpolationManifold.html#a34326a35d9ec4b6911d90c85c21847d8">initialize</a>(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>);</div>
<div class="line">     <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.set_manifold(1, inner_manifold);</div>
<div class="line">  </div>
<div class="line">     <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.refine_global(3</div>
<div class="line">  </div>
<div class="line">- <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>);</div>
<div class="line">   }</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemsetup_system"></a> </p><h4>GelfandProblem::setup_system</h4>
<p>The <code>setup_system()</code> function is quasi identical to the one in <a class="el" href="step_37.html">step-37</a> . The only differences are obviously the time measurement with only one <a class="el" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> instead of measuring each part individually, and more importantly the initialization of the <a class="el" href="classMGLevelObject.html">MGLevelObject</a> for the interpolated solution vector of the previous Newton step. Another important change is the setup of the <a class="el" href="classMGTransferMatrixFree.html">MGTransferMatrixFree</a> object, which we can reuse in each Newton step as the <code>triangulation</code> will not be not changed. <br  />
 Note how we can use the same <a class="el" href="classMatrixFree.html">MatrixFree</a> object twice, for the <code>JacobianOperator</code> and the multigrid preconditioner.</p>
<div class="fragment"><div class="line">   <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">   <span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::setup_system()</div>
<div class="line">   {</div>
<div class="line">     <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;setup system&quot;</span>);</div>
<div class="line">  </div>
<div class="line">     system_matrix.clear();</div>
<div class="line">     mg_matrices.clear_elements();</div>
<div class="line">  </div>
<div class="line">     dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
<div class="line">     dof_handler.<a class="code" href="classDoFHandler.html#a9aed31323cbd7619edac310c47e7a7ad">distribute_mg_dofs</a>();</div>
<div class="line">  </div>
<div class="line">     <a class="code" href="classIndexSet.html">IndexSet</a> locally_relevant_dofs;</div>
<div class="line">     <a class="code" href="namespaceDoFTools.html#acad7e0841b9046eaafddc4c617ab1d9d">DoFTools::extract_locally_relevant_dofs</a>(dof_handler, locally_relevant_dofs);</div>
<div class="line">  </div>
<div class="line">     <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#addd15bc409c61d6f795f0132c574335b">clear</a>();</div>
<div class="line">     <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#a2c9d71b5b7e8851c25a411ccf34de986">reinit</a>(locally_relevant_dofs);</div>
<div class="line">     <a class="code" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a>(dof_handler, <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>);</div>
<div class="line">     <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(dof_handler,</div>
<div class="line">                                              0,</div>
<div class="line">                                              <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(),</div>
<div class="line">                                              <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>);</div>
<div class="line">     <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div>
<div class="line">  </div>
<div class="line">     {</div>
<div class="line">       <span class="keyword">typename</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, double&gt;::AdditionalData</a> additional_data;</div>
<div class="line">       additional_data.tasks_parallel_scheme =</div>
<div class="line">         <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, double&gt;::AdditionalData::partition_color</a>;</div>
<div class="line">       additional_data.mapping_update_flags =</div>
<div class="line">         (<a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> |</div>
<div class="line">          <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a>);</div>
<div class="line">       <span class="keyword">auto</span> system_mf_storage = std::make_shared&lt;MatrixFree&lt;dim, double&gt;&gt;();</div>
<div class="line">       system_mf_storage-&gt;<a class="code" href="classMatrixFree.html#adb324d469b296f2a6921b41208732ddf">reinit</a>(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                 dof_handler,</div>
<div class="line">                                 <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>,</div>
<div class="line">                                 <a class="code" href="classQGauss.html">QGauss&lt;1&gt;</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1),</div>
<div class="line">                                 additional_data);</div>
<div class="line">  </div>
<div class="line">       system_matrix.initialize(system_mf_storage);</div>
<div class="line">     }</div>
<div class="line">  </div>
<div class="line">     system_matrix.initialize_dof_vector(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line">     system_matrix.initialize_dof_vector(newton_update);</div>
<div class="line">     system_matrix.initialize_dof_vector(system_rhs);</div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line">     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nlevels = <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels();</div>
<div class="line">     mg_matrices.resize(0, nlevels</div>
<div class="line">  </div>
<div class="line">- 1);</div>
<div class="line">     mg_solution.resize(0, nlevels</div>
<div class="line">  </div>
<div class="line">- 1);</div>
<div class="line">  </div>
<div class="line">     std::set&lt;types::boundary_id&gt; dirichlet_boundary;</div>
<div class="line">     dirichlet_boundary.insert(0);</div>
<div class="line">     mg_constrained_dofs.initialize(dof_handler);</div>
<div class="line">     mg_constrained_dofs.make_zero_boundary_constraints(dof_handler,</div>
<div class="line">                                                        dirichlet_boundary);</div>
<div class="line">  </div>
<div class="line">     mg_transfer.<a class="code" href="classMGTransferMatrixFree.html#a69e2b416ab209936f94db08e865cd92b">initialize_constraints</a>(mg_constrained_dofs);</div>
<div class="line">     mg_transfer.<a class="code" href="classMGTransferMatrixFree.html#a8f214ffade006cfa85e902a94902fc7b">build</a>(dof_handler);</div>
<div class="line">  </div>
<div class="line">     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; nlevels; ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">       {</div>
<div class="line">         <a class="code" href="classIndexSet.html">IndexSet</a> relevant_dofs;</div>
<div class="line">         <a class="code" href="namespaceDoFTools.html#a1fef7be07cf379b661646e39b9354e17">DoFTools::extract_locally_relevant_level_dofs</a>(dof_handler,</div>
<div class="line">                                                       <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>,</div>
<div class="line">                                                       relevant_dofs);</div>
<div class="line">  </div>
<div class="line">         <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> level_constraints;</div>
<div class="line">         level_constraints.<a class="code" href="classAffineConstraints.html#a2c9d71b5b7e8851c25a411ccf34de986">reinit</a>(relevant_dofs);</div>
<div class="line">         level_constraints.<a class="code" href="classAffineConstraints.html#aef97b22281acb10c914d79a3881e2735">add_lines</a>(</div>
<div class="line">           mg_constrained_dofs.get_boundary_indices(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">         level_constraints.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div>
<div class="line">  </div>
<div class="line">         <span class="keyword">typename</span> <a class="code" href="structMatrixFree_1_1AdditionalData.html">MatrixFree&lt;dim, float&gt;::AdditionalData</a> additional_data;</div>
<div class="line">         additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a0bcce2facca91b925d3e1a5a00c7704b">tasks_parallel_scheme</a> =</div>
<div class="line">           <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, float&gt;::AdditionalData::partition_color</a>;</div>
<div class="line">         additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#aa5d597e6c4441d273f4100b6139a2552">mapping_update_flags</a> =</div>
<div class="line">           (<a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> |</div>
<div class="line">            <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a>);</div>
<div class="line">         additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a67c9ff01c51fb7fb3ada151b83cdd409">mg_level</a> = <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>;</div>
<div class="line">         <span class="keyword">auto</span> mg_mf_storage_level = std::make_shared&lt;MatrixFree&lt;dim, float&gt;&gt;();</div>
<div class="line">         mg_mf_storage_level-&gt;<a class="code" href="classMultigrid.html#af3c33c4008b7b0d13c69d097fda50630">reinit</a>(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                     dof_handler,</div>
<div class="line">                                     level_constraints,</div>
<div class="line">                                     <a class="code" href="classQGauss.html">QGauss&lt;1&gt;</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1),</div>
<div class="line">                                     additional_data);</div>
<div class="line">  </div>
<div class="line">         mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].initialize(mg_mf_storage_level,</div>
<div class="line">                                       mg_constrained_dofs,</div>
<div class="line">                                       <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">         mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].initialize_dof_vector(mg_solution[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>]);</div>
<div class="line">       }</div>
<div class="line">   }</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemevaluate_residual"></a> </p><h4>GelfandProblem::evaluate_residual</h4>
<p>Next we implement a function which evaluates the nonlinear discrete residual for a given input vector ( \(\texttt{dst} = F(\texttt{src})\) ). This function is then used for the assembly of the right hand side of the linearized system and later for the computation of the residual of the next Newton step to check if we already reached the error tolerance. As this function should not affect any class variable we define it as a constant function. Internally we exploit the fast finite element evaluation through the <a class="el" href="classFEEvaluation.html">FEEvaluation</a> class and the <a class="el" href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">MatrixFree::cell_loop()</a>, similar to <code><a class="el" href="operators__0_8txt.html#a92cb2920df95b6f107c2c9a8c75b788c">apply_add()</a></code> function of the <code>JacobianOperator</code> . <br  />
 First we create a pointer to the <a class="el" href="classMatrixFree.html">MatrixFree</a> object, which is stored in the <code>system_matrix</code> . Then we pass the worker function <code>local_evaluate_residual()</code> for the cell wise evaluation of the residual together with the input and output vector to the <a class="el" href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">MatrixFree::cell_loop()</a>. In addition, we enable the zero out of the output vector in the loop, which is more efficient than calling <code>dst = 0.0</code> separately before. <br  />
 Note that with this approach we do not have to take care about the MPI related data exchange, since all the bookkeeping is done by the <a class="el" href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">MatrixFree::cell_loop()</a>. <br  />
</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::evaluate_residual(</div>
<div class="line">  <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;src)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keyword">auto</span> matrix_free = system_matrix.get_matrix_free();</div>
<div class="line"> </div>
<div class="line">  matrix_free-&gt;cell_loop(</div>
<div class="line">    &amp;GelfandProblem::local_evaluate_residual, <span class="keyword">this</span>, <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>, src, <span class="keyword">true</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemlocal_evaluate_residual"></a> </p><h4>GelfandProblem::local_evaluate_residual</h4>
<p>This is the internal worker function for the evaluation of the residual. Essentially it has the same structure as the <code>local_apply()</code> function of the <code>JacobianOperator</code> and evaluates the residual for the input vector <code>src</code> on the given set of cells <code>cell_range</code> . The difference to the above mentioned <code>local_apply()</code> function is, that we split the <a class="el" href="classFEEvaluation.html#ab53d5c08f460cfe6c9830ac14a427115">FEEvaluation::gather_evaluate()</a> function into FEEvaluation::read_dof_values_plain() and <a class="el" href="classFEEvaluation.html#a710c252e9dccc0c4ce07044cac3bdd9b">FEEvaluation::evaluate()</a>, since the input vector might have constrained DOFs.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::local_evaluate_residual(</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, double&gt;</a> &amp;                   <a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>,</div>
<div class="line">  <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;src,</div>
<div class="line">  <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;     cell_range)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, fe_degree, fe_degree + 1, 1, double&gt;</a> phi(<a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> = cell_range.first; <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> &lt; cell_range.second; ++<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>)</div>
<div class="line">    {</div>
<div class="line">      phi.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">      phi.read_dof_values_plain(src);</div>
<div class="line">      phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> | <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">        {</div>
<div class="line">          phi.submit_value(-std::exp(phi.get_value(q)), q);</div>
<div class="line">          phi.submit_gradient(phi.get_gradient(q), q);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      phi.integrate_scatter(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> |</div>
<div class="line">                              <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>,</div>
<div class="line">                            <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemassemble_rhs"></a> </p><h4>GelfandProblem::assemble_rhs</h4>
<p>Using the above function <code>evaluate_residual()</code> to evaluate the nonlinear residual, the assembly of the right hand side of the linearized system becomes now a very easy task. We just call the <code>evaluate_residual()</code> function and multiply the result with minus one. <br  />
 Experiences show that using the <a class="el" href="classFEEvaluation.html">FEEvaluation</a> class is much faster than a classical implementation with <a class="el" href="classFEValues.html">FEValues</a> and co.</p>
<div class="fragment"><div class="line">   <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">   <span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::assemble_rhs()</div>
<div class="line">   {</div>
<div class="line">     <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;assemble right hand side&quot;</span>);</div>
<div class="line">  </div>
<div class="line">     evaluate_residual(system_rhs, <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line">  </div>
<div class="line">     system_rhs=</div>
<div class="line">  </div>
<div class="line">-1.0;</div>
<div class="line">   }</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemcompute_residual"></a> </p><h4>GelfandProblem::compute_residual</h4>
<p>According to <a class="el" href="step_15.html">step-15</a> the following function computes the norm of the nonlinear residual for the solution \(u_h^n + \alpha s_h^n\) with the help of the <code>evaluate_residual()</code> function. The Newton step length \(\alpha\) becomes important if we would use an adaptive version of the Newton method. Then for example we would compute the residual for different step lengths and compare the residuals. However, for our problem the full Newton step with \(\alpha=1\) is the best we can do. An adaptive version of Newton's method becomes interesting if we have no good initial value. Note that in theory Newton's method converges with quadratic order, but only if we have an appropriate initial value. For unsuitable initial values the Newton method diverges even with quadratic order. A common way is then to use a damped version \(\alpha&lt;1\) until the Newton step is good enough and the full Newton step can be performed. This was also discussed in <a class="el" href="step_15.html">step-15</a> .</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">double</span> GelfandProblem&lt;dim, fe_degree&gt;::compute_residual(<span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;compute residual&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> <a class="code" href="newton__0_8txt.html#a21f536f84dd77674667ed5d2a30eb3ab">residual</a>;</div>
<div class="line">  <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> evaluation_point;</div>
<div class="line"> </div>
<div class="line">  system_matrix.initialize_dof_vector(<a class="code" href="newton__0_8txt.html#a21f536f84dd77674667ed5d2a30eb3ab">residual</a>);</div>
<div class="line">  system_matrix.initialize_dof_vector(evaluation_point);</div>
<div class="line"> </div>
<div class="line">  evaluation_point = <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>;</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a> &gt; 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-12)</div>
<div class="line">    {</div>
<div class="line">      evaluation_point.<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html#ac029174b48a0707da587b6ce3bc25047">add</a>(<a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>, newton_update);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  evaluate_residual(<a class="code" href="newton__0_8txt.html#a21f536f84dd77674667ed5d2a30eb3ab">residual</a>, evaluation_point);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="newton__0_8txt.html#a21f536f84dd77674667ed5d2a30eb3ab">residual</a>.l2_norm();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemcompute_update"></a> </p><h4>GelfandProblem::compute_update</h4>
<p>In order to compute the Newton updates in each Newton step we solve the linear system with the CG algorithm together with a geometric multigrid preconditioner. For this we first set up the <a class="el" href="classPreconditionMG.html">PreconditionMG</a> object with a Chebyshev smoother like we did in <a class="el" href="step_37.html">step-37</a> .</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::compute_update()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;compute update&quot;</span>);</div>
</div><!-- fragment --><p>We remember that the Jacobian depends on the last Newton step stored in the solution vector. So we update the ghost values of the Newton step and pass it to the <code>JacobianOperator</code> to store the information.</p>
<div class="fragment"><div class="line"><a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.update_ghost_values();</div>
<div class="line"> </div>
<div class="line">system_matrix.evaluate_newton_step(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
</div><!-- fragment --><p>Next we also have to pass the last Newton step to the multilevel operators. Therefore, we need to interpolate the Newton step to all levels of the triangulation. This is done with the <a class="el" href="classMGTransferMatrixFree.html#a90aef560cc3d832589ca13a5f18e1414">MGTransferMatrixFree::interpolate_to_mg()</a>. <br  />
</p>
<div class="fragment"><div class="line">mg_transfer.<a class="code" href="classMGTransferMatrixFree.html#a90aef560cc3d832589ca13a5f18e1414">interpolate_to_mg</a>(dof_handler, mg_solution, <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
</div><!-- fragment --><p>Now we can set up the preconditioner. We define the smoother and pass the interpolated vectors of the Newton step to the multilevel operators.</p>
<div class="fragment"><div class="line">     <span class="keyword">using</span> SmootherType =</div>
<div class="line">       <a class="code" href="classPreconditionChebyshev.html">PreconditionChebyshev</a>&lt;LevelMatrixType,</div>
<div class="line">                             <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt;;</div>
<div class="line">     <a class="code" href="classmg_1_1SmootherRelaxation.html">mg::SmootherRelaxation</a>&lt;SmootherType,</div>
<div class="line">                            <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt;</div>
<div class="line">                                                          mg_smoother;</div>
<div class="line">     <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;typename SmootherType::AdditionalData&gt;</a> smoother_data;</div>
<div class="line">     smoother_data.<a class="code" href="classMGLevelObject.html#a16213121f9153bd08f49652a11886259">resize</a>(0, <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels()</div>
<div class="line">  </div>
<div class="line">- 1);</div>
<div class="line">     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels();</div>
<div class="line">          ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">       {</div>
<div class="line">         <span class="keywordflow">if</span> (<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &gt; 0)</div>
<div class="line">           {</div>
<div class="line">             smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].smoothing_range     = 15.;</div>
<div class="line">             smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].degree              = 4;</div>
<div class="line">             smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].eig_cg_n_iterations = 10;</div>
<div class="line">           }</div>
<div class="line">         <span class="keywordflow">else</span></div>
<div class="line">           {</div>
<div class="line">             smoother_data[0].smoothing_range = 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-3;</div>
<div class="line">             smoother_data[0].degree          = <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>;</div>
<div class="line">             smoother_data[0].eig_cg_n_iterations = mg_matrices[0].m();</div>
<div class="line">           }</div>
<div class="line">  </div>
<div class="line">         mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].evaluate_newton_step(mg_solution[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>]);</div>
<div class="line">         mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].compute_diagonal();</div>
<div class="line">  </div>
<div class="line">         smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].preconditioner =</div>
<div class="line">           mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].get_matrix_diagonal_inverse();</div>
<div class="line">       }</div>
<div class="line">     mg_smoother.initialize(mg_matrices, smoother_data);</div>
<div class="line">  </div>
<div class="line">     <a class="code" href="classMGCoarseGridApplySmoother.html">MGCoarseGridApplySmoother&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt;</div>
<div class="line">       mg_coarse;</div>
<div class="line">     mg_coarse.<a class="code" href="classMGCoarseGridApplySmoother.html#a499c7364e40031332e9943a2e5f331a2">initialize</a>(mg_smoother);</div>
<div class="line">  </div>
<div class="line">     <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt; mg_matrix(</div>
<div class="line">       mg_matrices);</div>
<div class="line">  </div>
<div class="line">     <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;MatrixFreeOperators::MGInterfaceOperator&lt;LevelMatrixType&gt;</a>&gt;</div>
<div class="line">       mg_interface_matrices;</div>
<div class="line">     mg_interface_matrices.<a class="code" href="classMGLevelObject.html#a16213121f9153bd08f49652a11886259">resize</a>(0, <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels()</div>
<div class="line">  </div>
<div class="line">- 1);</div>
<div class="line">     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels();</div>
<div class="line">          ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">       {</div>
<div class="line">         mg_interface_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].initialize(mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>]);</div>
<div class="line">       }</div>
<div class="line">     <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt; mg_interface(</div>
<div class="line">       mg_interface_matrices);</div>
<div class="line">  </div>
<div class="line">     <a class="code" href="classMultigrid.html">Multigrid&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt; <a class="code" href="namespacemg.html">mg</a>(</div>
<div class="line">       mg_matrix, mg_coarse, mg_transfer, mg_smoother, mg_smoother);</div>
<div class="line">     <a class="code" href="namespacemg.html">mg</a>.set_edge_matrices(mg_interface, mg_interface);</div>
<div class="line">  </div>
<div class="line">     <a class="code" href="classPreconditionMG.html">PreconditionMG</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>,</div>
<div class="line">                    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;float&gt;</a>,</div>
<div class="line">                    <a class="code" href="classMGTransferMatrixFree.html">MGTransferMatrixFree&lt;dim, float&gt;</a>&gt;</div>
<div class="line">       <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>(dof_handler, <a class="code" href="namespacemg.html">mg</a>, mg_transfer);</div>
</div><!-- fragment --><p>Finally we set up the <a class="el" href="classSolverControl.html">SolverControl</a> and the <a class="el" href="classSolverCG.html">SolverCG</a> to solve the linearized problem for the current Newton update. An important fact of the implementation of <a class="el" href="classSolverCG.html">SolverCG</a> or also <a class="el" href="classSolverGMRES.html">SolverGMRES</a> is, that the vector holding the solution of the linear system (here <code>newton_update</code> ) can be used to pass a starting value. In order to start the iterative solver always with a zero vector we reset the <code>newton_update</code> explicitly before calling <a class="el" href="classSolverCG.html#aa52469650d9b9ef2f4cb4884caeb0723">SolverCG::solve()</a>. Afterwards we distribute the Dirichlet boundary conditions stored in <code>constraints</code> and store the number of iteration steps for the later output.</p>
<div class="fragment"><div class="line"><a class="code" href="classSolverControl.html">SolverControl</a> solver_control(100, 1.<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-12);</div>
<div class="line"><a class="code" href="classSolverCG.html">SolverCG&lt;LinearAlgebra::distributed::Vector&lt;double&gt;</a>&gt; cg(solver_control);</div>
<div class="line"> </div>
<div class="line">newton_update = 0.0;</div>
<div class="line"> </div>
<div class="line">cg.solve(system_matrix, newton_update, system_rhs, <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">distribute</a>(newton_update);</div>
<div class="line"> </div>
<div class="line">linear_iterations = solver_control.<a class="code" href="classSolverControl.html#a42aeae81cd6b67ce93b5fbea3328371f">last_step</a>();</div>
</div><!-- fragment --><p>Then for bookkeeping we zero out the ghost values.</p>
<div class="fragment"><div class="line">  <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.zero_out_ghost_values();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemsolve"></a> </p><h4>GelfandProblem::solve</h4>
<p>Now we implement the actual Newton solver for the nonlinear problem.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">GelfandProblem&lt;dim, fe_degree&gt;::solve</a>()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;solve&quot;</span>);</div>
</div><!-- fragment --><p>We define a maximal number of Newton steps and tolerances for the convergence criterion. Usually, with good starting values, the Newton method converges in three to six steps, so maximal ten steps should be totally sufficient. As tolerances we use \(\|F(u^n_h)\|&lt;\text{TOL}_f = 10^{-12}\) for the norm of the residual and \(\|s_h^n\| &lt; \text{TOL}_x = 10^{-10}\) for the norm of the Newton update. This seems a bit over the top, but we will see that, for our example, we will achieve these tolerances after a few steps.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> itmax = 10;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span>       TOLf  = 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-12;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span>       TOLx  = 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-10;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><a class="code" href="classTimer.html">Timer</a> solver_timer;</div>
<div class="line">solver_timer.<a class="code" href="classTimer.html#a3a8b5272198d029779dc9302a54305a8">start</a>();</div>
</div><!-- fragment --><p>Now we start the actual Newton iteration.</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> newton_step = 1; newton_step &lt;= itmax; ++newton_step)</div>
<div class="line">  {</div>
</div><!-- fragment --><p>We assemble the right hand side of the linearized problem and compute the Newton update.</p>
<div class="fragment"><div class="line">assemble_rhs();</div>
<div class="line">compute_update();</div>
</div><!-- fragment --><p>Then we compute the errors, namely the norm of the Newton update and the residual. Note that at this point one could incorporate a step size control for the Newton method by varying the input parameter \(\alpha\) for the compute_residual function. However, here we just use \(\alpha\) equal to one for a plain Newton iteration.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> ERRx = newton_update.<a class="code" href="classBlockVectorBase.html#ac718033fc083f27c45c6bfb4ac780360">l2_norm</a>();</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> ERRf = compute_residual(1.0);</div>
</div><!-- fragment --><p>Next we advance the Newton step by adding the Newton update to the current Newton step.</p>
<div class="fragment"><div class="line"><a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.add(1.0, newton_update);</div>
</div><!-- fragment --><p>A short output will inform us on the current Newton step.</p>
<div class="fragment"><div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;   Nstep &quot;</span> &lt;&lt; newton_step &lt;&lt; <span class="stringliteral">&quot;, errf = &quot;</span> &lt;&lt; ERRf</div>
<div class="line">      &lt;&lt; <span class="stringliteral">&quot;, errx = &quot;</span> &lt;&lt; ERRx &lt;&lt; <span class="stringliteral">&quot;, it = &quot;</span> &lt;&lt; linear_iterations</div>
<div class="line">      &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>After each Newton step we check the convergence criteria. If at least one of those is fulfilled we are done and end the loop. If we haven't found a satisfying solution after the maximal amount of Newton iterations, we inform the user about this shortcoming.</p>
<div class="fragment"><div class="line">      <span class="keywordflow">if</span> (ERRf &lt; TOLf || ERRx &lt; TOLx)</div>
<div class="line">        {</div>
<div class="line">          solver_timer.<a class="code" href="classTimer.html#a988f79aa183d9d5473c13106f5babe48">stop</a>();</div>
<div class="line"> </div>
<div class="line">          pcout &lt;&lt; <span class="stringliteral">&quot;Convergence step &quot;</span> &lt;&lt; newton_step &lt;&lt; <span class="stringliteral">&quot; value &quot;</span> &lt;&lt; ERRf</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot; (used wall time: &quot;</span> &lt;&lt; solver_timer.<a class="code" href="classTimer.html#a6f3e76707411b51e7d7e7bfa5755cf02">wall_time</a>() &lt;&lt; <span class="stringliteral">&quot; s)&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (newton_step == itmax)</div>
<div class="line">        {</div>
<div class="line">          solver_timer.<a class="code" href="classTimer.html#a988f79aa183d9d5473c13106f5babe48">stop</a>();</div>
<div class="line">          pcout &lt;&lt; <span class="stringliteral">&quot;WARNING: No convergence of Newton&#39;s method after &quot;</span></div>
<div class="line">                &lt;&lt; newton_step &lt;&lt; <span class="stringliteral">&quot; steps.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemcompute_solution_norm"></a> </p><h4>GelfandProblem::compute_solution_norm</h4>
<p>The computation of the H1-seminorm of the solution can be done in the same way as in <a class="el" href="step_59.html">step-59</a> . We update the ghost values and use the function <a class="el" href="namespaceVectorTools.html#a676190d2c897ac5da68a9c460fa95832">VectorTools::integrate_difference()</a>. In the end we gather all computations from all MPI ranks and return the norm.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">double</span> GelfandProblem&lt;dim, fe_degree&gt;::compute_solution_norm()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.update_ghost_values();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;float&gt;</a> norm_per_cell(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells());</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceVectorTools.html#a676190d2c897ac5da68a9c460fa95832">VectorTools::integrate_difference</a>(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                    dof_handler,</div>
<div class="line">                                    <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>,</div>
<div class="line">                                    <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(),</div>
<div class="line">                                    norm_per_cell,</div>
<div class="line">                                    <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 2),</div>
<div class="line">                                    <a class="code" href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1a7c450aee1986e226cf1bd7687171d769">VectorTools::H1_seminorm</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.zero_out_ghost_values();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="namespaceVectorTools.html#a21eb62d70953182dcc2b15c4e14dd533">VectorTools::compute_global_error</a>(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>,</div>
<div class="line">                                           norm_per_cell,</div>
<div class="line">                                           <a class="code" href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1a7c450aee1986e226cf1bd7687171d769">VectorTools::H1_seminorm</a>);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemoutput_results"></a> </p><h4>GelfandProblem::output_results</h4>
<p>We generate the graphical output files in vtu format together with a pvtu master file at once by calling the <a class="el" href="classDataOutInterface.html#a0864e51eb173c87e2a3edc9391ea8009">DataOut::write_vtu_with_pvtu_record()</a> function in the same way as in <a class="el" href="step_37.html">step-37</a> . In addition, as in <a class="el" href="step_40.html">step-40</a> , we query the <a class="el" href="namespacetypes.html#a34b501118128294d2bc316a1b052454f">types::subdomain_id</a> of each cell and write the distribution of the triangulation among the MPI ranks into the output file. Finally, we generate the patches of the solution by calling <a class="el" href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">DataOut::build_patches()</a>. However, since we have a computational domain with a curved boundary, we additionally pass the <code>mapping</code> and the finite element degree as number of subdivision. But this is still not enough for the correct representation of the solution, for example in ParaView, because we attached a <a class="el" href="classTransfiniteInterpolationManifold.html">TransfiniteInterpolationManifold</a> to the inner cells, which results in curved cells in the interior. Therefore we pass as third argument the <a class="el" href="classDataOut.html#a1303b5d99f10f3fae984e7d406cfeb37a7996b4e7bad0b5fe0630f3eb57d48313">DataOut::curved_inner_cells</a> option, such that also the inner cells use the corresponding manifold description to build the patches. <br  />
 Note that we could handle the higher order elements with the flag <a class="el" href="group__Exceptions.html#gaa9dd1830c0ff35a2431704c4d45453eb">DataOutBase::VtkFlags::write_higher_order_cells</a>. However, due to the limited compatibility to previous version of ParaView and the missing support by VisIt, we left this option for a future version.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">GelfandProblem&lt;dim, fe_degree&gt;::output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_active_cells() &gt; 1e6)</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.update_ghost_values();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">attach_dof_handler</a>(dof_handler);</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, <span class="stringliteral">&quot;solution&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;float&gt;</a> <a class="code" href="index__set__0_8txt.html#a85fb0893d080862c6fc2fbcb1e57a791">subdomain</a>(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells());</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="index__set__0_8txt.html#a85fb0893d080862c6fc2fbcb1e57a791">subdomain</a>.size(); ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="index__set__0_8txt.html#a85fb0893d080862c6fc2fbcb1e57a791">subdomain</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>) = <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.locally_owned_subdomain();</div>
<div class="line">    }</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(<a class="code" href="index__set__0_8txt.html#a85fb0893d080862c6fc2fbcb1e57a791">subdomain</a>, <span class="stringliteral">&quot;subdomain&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  data_out.<a class="code" href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">build_patches</a>(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                         <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a>,</div>
<div class="line">                         <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;::curved_inner_cells</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="structDataOutBase_1_1VtkFlags.html">DataOutBase::VtkFlags</a> <a class="code" href="update__flags__0_8txt.html#ac8b7167f13d273c0000a680958db42c5">flags</a>;</div>
<div class="line">  <a class="code" href="update__flags__0_8txt.html#ac8b7167f13d273c0000a680958db42c5">flags</a>.compression_level = <a class="code" href="group__Exceptions.html#ga7ad65742b9dbfb7eeb04b511b5a08d63a3c83e26f202f837328b9f7532773be70">DataOutBase::VtkFlags::best_speed</a>;</div>
<div class="line">  data_out.<a class="code" href="classDataOutInterface.html#ac7280a24690b117454acfb0fa058299c">set_flags</a>(<a class="code" href="update__flags__0_8txt.html#ac8b7167f13d273c0000a680958db42c5">flags</a>);</div>
<div class="line">  data_out.<a class="code" href="classDataOutInterface.html#a0864e51eb173c87e2a3edc9391ea8009">write_vtu_with_pvtu_record</a>(</div>
<div class="line">    <span class="stringliteral">&quot;./&quot;</span>, <span class="stringliteral">&quot;solution_&quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>) + <span class="stringliteral">&quot;d&quot;</span>, <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>, MPI_COMM_WORLD, 3);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.zero_out_ghost_values();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemrun"></a> </p><h4>GelfandProblem::run</h4>
<p>The last missing function of the solver class for the <em>Gelfand problem</em> is the run function. In the beginning we print information about the system specifications and the finite element space we use. The problem is solved several times on a successively refined mesh.</p>
<div class="fragment"><div class="line">   <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">   <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">GelfandProblem&lt;dim, fe_degree&gt;::run</a>()</div>
<div class="line">   {</div>
<div class="line">     {</div>
<div class="line">       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_ranks =</div>
<div class="line">         <a class="code" href="namespaceUtilities_1_1MPI.html#ac26de0c059200523177bb1d92cc25d00">Utilities::MPI::n_mpi_processes</a>(MPI_COMM_WORLD);</div>
<div class="line">       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_vect_doubles = <a class="code" href="classVectorizedArrayBase.html#acb35404acc1693aee6e990228924cc09">VectorizedArray&lt;double&gt;::size</a>();</div>
<div class="line">       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_vect_bits    = 8 <span class="keyword">sizeof</span>(<a class="code" href="hdf5__0_8txt.html#aae153b86de45d3354cd3edd5b992435e">double</a>) n_vect_doubles;</div>
<div class="line">  </div>
<div class="line">       std::string DAT_header = <span class="stringliteral">&quot;START DATE: &quot;</span> + <a class="code" href="namespaceUtilities_1_1System.html#aff548b3b9b7a035ea112729700ef7c64">Utilities::System::get_date</a>() +</div>
<div class="line">                                <span class="stringliteral">&quot;, TIME: &quot;</span> + <a class="code" href="namespaceUtilities_1_1System.html#a76bc1cc7649cc416723f450d24fdd91d">Utilities::System::get_time</a>();</div>
<div class="line">       std::string MPI_header = <span class="stringliteral">&quot;Running with &quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(n_ranks) +</div>
<div class="line">                                <span class="stringliteral">&quot; MPI process&quot;</span> + (n_ranks &gt; 1 ? <span class="stringliteral">&quot;es&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">       std::string VEC_header =</div>
<div class="line">         <span class="stringliteral">&quot;Vectorization over &quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(n_vect_doubles) +</div>
<div class="line">         <span class="stringliteral">&quot; doubles = &quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(n_vect_bits) + <span class="stringliteral">&quot; bits (&quot;</span> +</div>
<div class="line">         <a class="code" href="namespaceUtilities_1_1System.html#ade631a789101336840371e3b2e2851e0">Utilities::System::get_current_vectorization_level</a>() +</div>
<div class="line">         <span class="stringliteral">&quot;), VECTORIZATION_LEVEL=&quot;</span> +</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(<a class="code" href="config_8h.html#a32dc208a29f23d1f031fb40b0d21e60e">DEAL_II_COMPILER_VECTORIZATION_LEVEL</a>);</div>
<div class="line">       std::string SOL_header = <span class="stringliteral">&quot;Finite element space: &quot;</span> + <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFE__Q.html#aef8e62ce116e341818549d1730343792">get_name</a>();</div>
<div class="line">  </div>
<div class="line">       pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;=&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line">       pcout &lt;&lt; DAT_header &lt;&lt; std::endl;</div>
<div class="line">       pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;-&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line">  </div>
<div class="line">       pcout &lt;&lt; MPI_header &lt;&lt; std::endl;</div>
<div class="line">       pcout &lt;&lt; VEC_header &lt;&lt; std::endl;</div>
<div class="line">       pcout &lt;&lt; SOL_header &lt;&lt; std::endl;</div>
<div class="line">  </div>
<div class="line">       pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;=&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line">     }</div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line">     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> = 0; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt; 9</div>
<div class="line">  </div>
<div class="line">- <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>)</div>
<div class="line">       {</div>
<div class="line">         pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;-&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line">         pcout &lt;&lt; <span class="stringliteral">&quot;Cycle &quot;</span> &lt;&lt; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt;&lt; std::endl;</div>
<div class="line">         pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;-&#39;</span>) &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>The first task in actually solving the problem is to generate or refine the triangulation.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> == 0)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="step-2_8cc.html#ab108b7b7bca84a81aceda045aaef1961">make_grid</a>();</div>
<div class="line">  }</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.refine_global(1);</div>
<div class="line">  }</div>
</div><!-- fragment --><p>Now we set up the system and solve the problem. These steps are accompanied by time measurement and textual output.</p>
<div class="fragment"><div class="line"><a class="code" href="classTimer.html">Timer</a> timer;</div>
<div class="line"> </div>
<div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;Set up system...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">setup_system();</div>
<div class="line"> </div>
<div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;   Triangulation: &quot;</span> &lt;&lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_active_cells()</div>
<div class="line">      &lt;&lt; <span class="stringliteral">&quot; cells&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;   DoFHandler:    &quot;</span> &lt;&lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>() &lt;&lt; <span class="stringliteral">&quot; DoFs&quot;</span></div>
<div class="line">      &lt;&lt; std::endl;</div>
<div class="line">pcout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;Solve using Newton&#39;s method...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>();</div>
<div class="line">pcout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">timer.<a class="code" href="classTimer.html#a988f79aa183d9d5473c13106f5babe48">stop</a>();</div>
<div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;Time for setup+solve (CPU/Wall) &quot;</span> &lt;&lt; timer.<a class="code" href="classTimer.html#a4e3933a78790d7455daff5acab3f8432">cpu_time</a>() &lt;&lt; <span class="stringliteral">&quot;/&quot;</span></div>
<div class="line">      &lt;&lt; timer.<a class="code" href="classTimer.html#a6f3e76707411b51e7d7e7bfa5755cf02">wall_time</a>() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">pcout &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>After the problem was solved we compute the norm of the solution and generate the graphical output files.</p>
<div class="fragment"><div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;Output results...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="multithreading__0_8txt.html#a0759c0124e216ec36f063ad051f4dba0">norm</a> = compute_solution_norm();</div>
<div class="line">output_results(<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>);</div>
<div class="line"> </div>
<div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;  H1 seminorm: &quot;</span> &lt;&lt; <a class="code" href="multithreading__0_8txt.html#a0759c0124e216ec36f063ad051f4dba0">norm</a> &lt;&lt; std::endl;</div>
<div class="line">pcout &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>Finally after each cycle we print the timing information.</p>
<div class="fragment"><div class="line">        computing_timer.print_summary();</div>
<div class="line">        computing_timer.reset();</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Step66</span></div>
</div><!-- fragment --><p><a class="anchor" id="Thecodemaincodefunction"></a> </p><h3>The <code>main</code> function</h3>
<p>As typical for programs running in parallel with MPI we set up the MPI framework and disable shared-memory parallelization by limiting the number of threads to one. Finally to run the solver for the <em>Gelfand problem</em> we create an object of the <code>GelfandProblem</code> class and call the run function. Exemplarily we solve the problem once in 2D and once in 3D each with fourth-order Lagrangian finite elements.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(<span class="keywordtype">int</span> argc, charargv[])</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">using namespace </span><a class="code" href="namespaceStep66.html">Step66</a>;</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classUtilities_1_1MPI_1_1MPI__InitFinalize.html">Utilities::MPI::MPI_InitFinalize</a> mpi_init(argc, argv, 1);</div>
<div class="line"> </div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem&lt;2, 4&gt;</a> gelfand_problem;</div>
<div class="line">        gelfand_problem.run();</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem&lt;3, 4&gt;</a> gelfand_problem;</div>
<div class="line">        gelfand_problem.run();</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (<a class="code" href="parameter__handler__0_8txt.html#ad919e2b915d8e8226aef004c2d8399a8">std::exception</a> &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p> <a class="anchor" id="Results"></a></p><h1>Results</h1>
<p>The aim of this tutorial step was to demonstrate the solution of a nonlinearPDE with the matrix-free framework.</p>
<p><a class="anchor" id="Programoutput"></a></p><h3>Program output</h3>
<p>Running the program on two processes in release mode via </p><div class="fragment"><div class="line">cmake . &amp;&amp; make <a class="code" href="A-headers_2exceptions__0_8txt.html#a8cc3d8e2210ca7ca38c1daa0e678229d">release</a> &amp;&amp; make &amp;&amp; mpirun</div>
<div class="line">  </div>
<div class="line">-<a class="code" href="petsc__matrix__base__0_8txt.html#a5a1b8b75c93e6ea5e27829c4fe862a8e">n</a> 2 ./<a class="code" href="table__handler__0_8txt.html#a61e9964f9093088848525ca172895749">step</a>-66</div>
</div><!-- fragment --><p> gives the following output on the console </p><div class="fragment"><div class="line">================================================================================</div>
<div class="line">START DATE: 2021/5/18, TIME: 16:25:48</div>
<div class="line">  </div>
<div class="line">--------------------------------------------------------------------------------</div>
<div class="line">Running <a class="code" href="multithreading__0_8txt.html#af35ca33203cd802325d779be7b6b41e8">with</a> 2 <a class="code" href="base_2partitioner__0_8txt.html#a6d2d0fa485d1660823c59c494fb0fb31">MPI</a> <a class="code" href="scalapack__0_8txt.html#ac82ea4a38e10783662981895e0a99f43">processes</a></div>
<div class="line">Vectorization over 4 doubles = 256 bits (AVX), VECTORIZATION_LEVEL=2</div>
<div class="line">Finite <a class="code" href="distributed__0_8txt.html#ac4c845555bda24566ddc584532b7fa57">element</a> <a class="code" href="geometry__and__primitives__0_8txt.html#ad687a359ee2f71b8471c9a49cc8172ad">space</a>: <a class="code" href="classFE__Q.html">FE_Q&lt;2&gt;</a>(4)</div>
<div class="line">================================================================================</div>
<div class="line">  </div>
<div class="line">--------------------------------------------------------------------------------</div>
<div class="line">Cycle 0</div>
<div class="line">  </div>
<div class="line">--------------------------------------------------------------------------------</div>
<div class="line">Set <a class="code" href="logstream__0_8txt.html#a9767aa0a3a9a2557fff9f4cf0eab48bb">up</a> <a class="code" href="distributed__0_8txt.html#adeac996b7de9cb86911e504716172e83">system</a>...</div>
<div class="line">   <a class="code" href="dofs__0_8txt.html#ace93ab11d5f75755b09a3368db091adc">Triangulation</a>: 20 <a class="code" href="distributed__0_8txt.html#aafea668ad0c451ac7a0fae0f558c36d7">cells</a></div>
<div class="line">   <a class="code" href="group__dofs.html#ga768cd565b5c25f1ac235586e36ac94d6">DoFHandler</a>:    337 <a class="code" href="dof__renumbering__0_8txt.html#a68829910788b5388e9fb6e50b17c1876">DoFs</a></div>
<div class="line">  </div>
<div class="line">Solve <span class="keyword">using</span> <a class="code" href="newton__0_8txt.html#a7ae4bec25ec0fbd4c3968d0926b5c7c6">Newton</a><span class="stringliteral">&#39;s method...</span></div>
<div class="line"><span class="stringliteral">   Nstep 1, errf = 0.00380835, errx = 3.61904, it = 7</span></div>
<div class="line"><span class="stringliteral">   Nstep 2, errf = 3.80167e-06, errx = 0.104353, it = 6</span></div>
<div class="line"><span class="stringliteral">   Nstep 3, errf = 3.97939e-12, errx = 0.00010511, it = 4</span></div>
<div class="line"><span class="stringliteral">   Nstep 4, errf = 2.28859e-13, errx = 1.07726e-10, it = 1</span></div>
<div class="line"><span class="stringliteral">Convergence step 4 value 2.28859e-13 (used wall time: 0.0096409 s)</span></div>
<div class="line"><span class="stringliteral">  </span></div>
<div class="line"><span class="stringliteral">Time for setup+solve (CPU/Wall) 0.015617/0.0156447 s</span></div>
<div class="line"><span class="stringliteral">  </span></div>
<div class="line"><span class="stringliteral">Output results...</span></div>
<div class="line"><span class="stringliteral">  H1 seminorm: 0.773426</span></div>
<div class="line"><span class="stringliteral">  </span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">  </span></div>
<div class="line"><span class="stringliteral">  </span></div>
<div class="line"><span class="stringliteral">+---------------------------------------------+------------+------------+</span></div>
<div class="line"><span class="stringliteral">| Total wallclock time elapsed since start    |    0.0286s |            |</span></div>
<div class="line"><span class="stringliteral">|                                             |            |            |</span></div>
<div class="line"><span class="stringliteral">| Section                         | no. calls |  wall time | % of total |</span></div>
<div class="line"><span class="stringliteral">+---------------------------------+-----------+------------+------------+</span></div>
<div class="line"><span class="stringliteral">| assemble right hand side        |         4 |  9.71e-05s |      0.34% |</span></div>
<div class="line"><span class="stringliteral">| compute residual                |         4 |  0.000137s |      0.48% |</span></div>
<div class="line"><span class="stringliteral">| compute update                  |         4 |   0.00901s |        32% |</span></div>
<div class="line"><span class="stringliteral">| make grid                       |         1 |   0.00954s |        33% |</span></div>
<div class="line"><span class="stringliteral">| setup system                    |         1 |   0.00585s |        20% |</span></div>
<div class="line"><span class="stringliteral">| solve                           |         1 |   0.00966s |        34% |</span></div>
<div class="line"><span class="stringliteral">+---------------------------------+-----------+------------+------------+</span></div>
<div class="line"><span class="stringliteral">  </span></div>
<div class="line"><span class="stringliteral">.</span></div>
<div class="line"><span class="stringliteral">.</span></div>
<div class="line"><span class="stringliteral">.</span></div>
<div class="line"><span class="stringliteral">  </span></div>
<div class="line"><span class="stringliteral">--------------------------------------------------------------------------------</span></div>
<div class="line"><span class="stringliteral">Cycle 6</span></div>
<div class="line"><span class="stringliteral">  </span></div>
<div class="line"><span class="stringliteral">--------------------------------------------------------------------------------</span></div>
<div class="line"><span class="stringliteral">Set up system...</span></div>
<div class="line"><span class="stringliteral">   Triangulation: 81920 cells</span></div>
<div class="line"><span class="stringliteral">   DoFHandler:    1311745 DoFs</span></div>
<div class="line"><span class="stringliteral">  </span></div>
<div class="line"><span class="stringliteral">Solve using Newton&#39;</span><a class="code" href="vector__valued__0_8txt.html#add141cdc4d28d06d71948acb7f0c7150">s</a> <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a16cf6888fefc575ea41503c862c8e66d">method</a>...</div>
<div class="line">   Nstep 1, errf = 5.90478e-05, errx = 231.427, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#ac5d1c63883bb2a85710935e76a7dedd4">it</a> = 9</div>
<div class="line">   Nstep 2, errf = 5.89991e-08, errx = 6.67102, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#ac5d1c63883bb2a85710935e76a7dedd4">it</a> = 6</div>
<div class="line">   Nstep 3, errf = 4.28813e-13, errx = 0.0067188, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#ac5d1c63883bb2a85710935e76a7dedd4">it</a> = 4</div>
<div class="line">Convergence <a class="code" href="table__handler__0_8txt.html#a61e9964f9093088848525ca172895749">step</a> 3 <a class="code" href="functions__0_8txt.html#af9f808a82e8c618e2e7a19dd08a9eae3">value</a> 4.28813e-13 (<a class="code" href="hp__0_8txt.html#a68ab73a4ec065be1fdac93979ba49f51">used</a> wall <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a>: 4.82953 <a class="code" href="vector__valued__0_8txt.html#add141cdc4d28d06d71948acb7f0c7150">s</a>)</div>
<div class="line">  </div>
<div class="line">Time <span class="keywordflow">for</span> setup+<a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a> (CPU/Wall) 6.25094/6.37174 <a class="code" href="vector__valued__0_8txt.html#add141cdc4d28d06d71948acb7f0c7150">s</a></div>
<div class="line">  </div>
<div class="line">Output results...</div>
<div class="line">  H1 seminorm: 0.773426</div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line">+---------------------------------------------+------------+------------+</div>
<div class="line">| Total wallclock <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a> elapsed <a class="code" href="grid_2manifold__0_8txt.html#a02d8bd1db3a4d0b6d68a99a931ce1b83">since</a> <a class="code" href="timer__0_8txt.html#a48e9e3a8116df3cc4b62db810904e91f">start</a>    |      9.04s |            |</div>
<div class="line">|                                             |            |            |</div>
<div class="line">| <a class="code" href="grid_2grid__refinement__0_8txt.html#a8bdcf8330609e043ba26a394139934f2">Section</a>                         | <a class="code" href="multithreading__0_8txt.html#a4c0a7149e1927066d2fcdb356cb90f7b">no</a>. <a class="code" href="iterators__0_8txt.html#a6365596c7d2490c474cd0b7ce9722b37">calls</a> |  wall <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a> | % <a class="code" href="multithreading__0_8txt.html#a33468e75b7ea6d2e64b7e88c6ff1217a">of</a> total |</div>
<div class="line">+---------------------------------+-----------+------------+------------+</div>
<div class="line">| <a class="code" href="simple__0_8txt.html#a992b60343e16bcad1a2121a36857f2b6">assemble</a> <a class="code" href="reordering__0_8txt.html#abc892651c0b2805d80c1933e2fb51c1a">right</a> <a class="code" href="constraints__0_8txt.html#a836d12b85657b83a8978aff8d7672c23">hand</a> <a class="code" href="update__flags__0_8txt.html#a401b2012c153de7bc4c63a89c334e118">side</a>        |         3 |    0.0827s |      0.91% |</div>
<div class="line">| <a class="code" href="fe_2fe__0_8txt.html#a754f79d53a1f0ebfe04ff6b9ff4abb8a">compute</a> <a class="code" href="newton__0_8txt.html#a21f536f84dd77674667ed5d2a30eb3ab">residual</a>                |         3 |    0.0909s |         1% |</div>
<div class="line">| <a class="code" href="fe_2fe__0_8txt.html#a754f79d53a1f0ebfe04ff6b9ff4abb8a">compute</a> <a class="code" href="mpi__noncontiguous__partitioner__0_8txt.html#a4ef446c02d3d4efe2972f5e7130db5d0">update</a>                  |         3 |      4.65s |        51% |</div>
<div class="line">| setup <a class="code" href="distributed__0_8txt.html#adeac996b7de9cb86911e504716172e83">system</a>                    |         1 |      1.54s |        17% |</div>
<div class="line">| <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>                           |         1 |      4.83s |        53% |</div>
<div class="line">+---------------------------------+-----------+------------+------------+</div>
<div class="line">  </div>
<div class="line">================================================================================</div>
<div class="line">START DATE: 2021/5/18, TIME: 16:26:00</div>
<div class="line">  </div>
<div class="line">--------------------------------------------------------------------------------</div>
<div class="line">Running <a class="code" href="multithreading__0_8txt.html#af35ca33203cd802325d779be7b6b41e8">with</a> 2 <a class="code" href="base_2partitioner__0_8txt.html#a6d2d0fa485d1660823c59c494fb0fb31">MPI</a> <a class="code" href="scalapack__0_8txt.html#ac82ea4a38e10783662981895e0a99f43">processes</a></div>
<div class="line">Vectorization over 4 doubles = 256 bits (AVX), VECTORIZATION_LEVEL=2</div>
<div class="line">Finite <a class="code" href="distributed__0_8txt.html#ac4c845555bda24566ddc584532b7fa57">element</a> <a class="code" href="geometry__and__primitives__0_8txt.html#ad687a359ee2f71b8471c9a49cc8172ad">space</a>: <a class="code" href="classFE__Q.html">FE_Q&lt;3&gt;</a>(4)</div>
<div class="line">================================================================================</div>
<div class="line">  </div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line">  </div>
<div class="line">--------------------------------------------------------------------------------</div>
<div class="line">Cycle 5</div>
<div class="line">  </div>
<div class="line">--------------------------------------------------------------------------------</div>
<div class="line">Set <a class="code" href="logstream__0_8txt.html#a9767aa0a3a9a2557fff9f4cf0eab48bb">up</a> <a class="code" href="distributed__0_8txt.html#adeac996b7de9cb86911e504716172e83">system</a>...</div>
<div class="line">   <a class="code" href="dofs__0_8txt.html#ace93ab11d5f75755b09a3368db091adc">Triangulation</a>: 229376 <a class="code" href="distributed__0_8txt.html#aafea668ad0c451ac7a0fae0f558c36d7">cells</a></div>
<div class="line">   <a class="code" href="group__dofs.html#ga768cd565b5c25f1ac235586e36ac94d6">DoFHandler</a>:    14729857 <a class="code" href="dof__renumbering__0_8txt.html#a68829910788b5388e9fb6e50b17c1876">DoFs</a></div>
<div class="line">  </div>
<div class="line">Solve <span class="keyword">using</span> <a class="code" href="newton__0_8txt.html#a7ae4bec25ec0fbd4c3968d0926b5c7c6">Newton</a><span class="stringliteral">&#39;s method...</span></div>
<div class="line"><span class="stringliteral">   Nstep 1, errf = 6.30096e-06, errx = 481.74, it = 8</span></div>
<div class="line"><span class="stringliteral">   Nstep 2, errf = 4.25607e-10, errx = 4.14315, it = 6</span></div>
<div class="line"><span class="stringliteral">   Nstep 3, errf = 7.29563e-13, errx = 0.000321775, it = 2</span></div>
<div class="line"><span class="stringliteral">Convergence step 3 value 7.29563e-13 (used wall time: 133.793 s)</span></div>
<div class="line"><span class="stringliteral">  </span></div>
<div class="line"><span class="stringliteral">Time for setup+solve (CPU/Wall) 226.809/232.615 s</span></div>
<div class="line"><span class="stringliteral">  </span></div>
<div class="line"><span class="stringliteral">Output results...</span></div>
<div class="line"><span class="stringliteral">  H1 seminorm: 0.588667</span></div>
<div class="line"><span class="stringliteral">  </span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">  </span></div>
<div class="line"><span class="stringliteral">  </span></div>
<div class="line"><span class="stringliteral">+---------------------------------------------+------------+------------+</span></div>
<div class="line"><span class="stringliteral">| Total wallclock time elapsed since start    |       390s |            |</span></div>
<div class="line"><span class="stringliteral">|                                             |            |            |</span></div>
<div class="line"><span class="stringliteral">| Section                         | no. calls |  wall time | % of total |</span></div>
<div class="line"><span class="stringliteral">+---------------------------------+-----------+------------+------------+</span></div>
<div class="line"><span class="stringliteral">| assemble right hand side        |         3 |      2.06s |      0.53% |</span></div>
<div class="line"><span class="stringliteral">| compute residual                |         3 |      2.46s |      0.63% |</span></div>
<div class="line"><span class="stringliteral">| compute update                  |         3 |       129s |        33% |</span></div>
<div class="line"><span class="stringliteral">| setup system                    |         1 |      98.8s |        25% |</span></div>
<div class="line"><span class="stringliteral">| solve                           |         1 |       134s |        34% |</span></div>
<div class="line"><span class="stringliteral">+---------------------------------+-----------+------------+------------+</span></div>
</div><!-- fragment --><p>We show the solution for the two- and three-dimensional problem in thefollowing figure. </p><div class="twocolumn" style="width: 80%; text-align: center;"> <div> <img src="https://www.dealii.org/images/steps/developer/step-66.solution-2d.png" alt="Solution of the two-dimensional Gelfand problem." width="100%" class="inline"/> </div> <div> <img src="https://www.dealii.org/images/steps/developer/step-66.solution-3d.png" alt="Solution of the three-dimensional Gelfand problem." width="100%" class="inline"/> </div> </div><p> <br  />
</p>
<p><a class="anchor" id="Newtonsolver"></a></p><h3>Newton solver</h3>
<p>In the program output above we find some interesting information about theNewton iterations. The terminal output in each refinement cycle presentsdetailed diagnostics of the Newton method, which show first of all the numberof Newton steps and for each step the norm of the residual \(\|F(u_h^{n+1})\|\) ,the norm of the Newton update \(\|s_h^n\|\) , and the number of CG iterations <code>it</code> . We observe that for all cases the Newton method converges in approximatelythree to four steps, which shows the quadratic convergence of the Newton methodwith a full step length \(\alpha = 1\) . However, be aware that for a badly choseninitial guess \(u_h^0\) , the Newton method will also diverge quadratically.Usually if you do not have an appropriate initial guess, you try a few dampedNewton steps with a reduced step length \(\alpha &lt; 1\) until the Newton step isagain in the quadratic convergence domain. This damping and relaxation of theNewton step length truly requires a more sophisticated implementation of theNewton method, which we designate to you as a possible extension of thetutorial. Furthermore, we see that the number of CG iterations is approximately constantwith successive mesh refinements and an increasing number of DoFs. This is ofcourse due to the geometric multigrid preconditioner and similar to theobservations made in other tutorials that use this method, e.g., <a class="el" href="step_16.html">step-16</a> and <a class="el" href="step_37.html">step-37</a> . Just to give an example, in the three-dimensional case after fiverefinements, we have approximately 14.7 million distributed DoFs withfourth-order Lagrangian finite elements, but the number of CG iterations isstill less than ten. In addition, there is one more very useful optimization that we applied andthat should be mentioned here. In the <code>compute_update()</code> function weexplicitly reset the vector holding the Newton update before passing it as theoutput vector to the solver. In that case we use a starting value of zero forthe CG method, which is more suitable than the previous Newton update, theactual content of the <code>newton_update</code> before resetting, and thusreduces the number of CG iterations by a few steps.</p>
<p><a class="anchor" id="Possibilitiesforextensions"></a></p><h3>Possibilities for extensions</h3>
<p>A couple of possible extensions are available concerning minor updates fo thepresent code as well as a deeper numerical investigation of the Gelfand problem. <a class="anchor" id="MoresophisticatedNewtoniteration"></a></p><h4>More sophisticated Newton iteration</h4>
<p>Beside a step size controlled version of the Newton iteration as mentionedalready in <a class="el" href="step_15.html">step-15</a> , one could also implement a more flexible stopping criterionfor the Newton iteration. For example one could replace the fixed tolerancesfor the residual <code>TOLf</code> and for the Newton updated <code>TOLx</code> and implement a mixed error control with a given absolute and relativetolerance, such that the Newton iteration exists with success as, e.g., </p><p class="formulaDsp">
\begin{align*} \|F(u_h^{n+1})\| \leq \texttt{RelTol} \|u_h^{n+1}\| + \texttt{AbsTol}. \end{align*}
</p>
<p> For more advanced applications with many nonlinear systems to solve, forexample at each time step for a time-dependent problem, it turns out that it isnot necessary to set up and assemble the Jacobian anew at every single Newtonstep or even for each time step. Instead, the existing Jacobian from a previousstep can be used for the Newton iteration. The Jacobian is then only rebuiltif, for example, the Newton iteration converges too slowly. Such an idea yieldsa <a href="https://en.wikipedia.org/wiki/Quasi-Newton_method">quasi-Newton method</a>. Admittedly, when using the matrix-free framework, the assembly ofthe Jacobian is omitted anyway, but with in this way one can try to optimizethe reassembly of the geometric multigrid preconditioner. Remember that eachtime the solution from the old Newton step must be distributed to all levelsand the mutligrid preconditioner must be reinitialized. <a class="anchor" id="Parallelscalabilityandthreadparallelism"></a></p><h4>Parallel scalability and thread parallelism</h4>
<p>In the results section of <a class="el" href="step_37.html">step-37</a> and others, the parallel scalability of thematrix-free framework on a large number of processors has already beendemonstrated very impressively. In the nonlinear case we consider here, we notethat one of the bottlenecks could become the transfer and evaluation of thematrix-free Jacobi operator and its multistage operators in the previous Newtonstep, since we need to transfer the old solution at all stages in each step. Afirst parallel scalability analysis in <b>[castelli2021numerical]</b> shows quitegood strong scalability when the problem size is large enough. However, a moredetailed analysis needs to be performed for reliable results. Moreover, theproblem has been solved only with MPI so far, without using the possibilitiesof shared memory parallelization with threads. Therefore, for this example, youcould try hybrid parallelization with MPI and threads, such as described in <a class="el" href="step_48.html">step-48</a> . <a class="anchor" id="Comparisontomatrixbasedmethods"></a></p><h4>Comparison to matrix-based methods</h4>
<p>Analogously to <a class="el" href="step_50.html">step-50</a> and the mentioned possible extension of <a class="el" href="step_75.html">step-75</a> , you canconvince yourself which method is faster. <a class="anchor" id="Eigenvalueproblem"></a></p><h4>Eigenvalue problem</h4>
<p>One can consider the corresponding eigenvalue problem, which is called Bratuproblem. For example, if we define a fixed eigenvalue \(\lambda\in[0,6]\) , we cancompute the corresponding discrete eigenfunction. You will notice that thenumber of Newton steps will increase with increasing \(\lambda\) . To reduce thenumber of Newton steps you can use the following trick: start from a certain \(\lambda\) , compute the eigenfunction, increase \(\lambda=\lambda + \delta_\lambda\) , and then use the previous solution as an initial guess for theNewton iteration. In the end you can plot the \(H^1(\Omega)\) -norm over theeigenvalue \(\lambda \mapsto \|u_h\|_{H^1(\Omega)}\) . What do you observe forfurther increasing \(\lambda&gt;7\) ?</p>
<p><a class="anchor" id="PlainProg"></a></p><h1>The plain program</h1>
<div class="fragment"><div class="line"><span class="comment">/* ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2021 by the deal.II authors</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file is part of the deal.II library.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The deal.II library is free software; you can use it, redistribute</span></div>
<div class="line"><span class="comment"> * it, and/or modify it under the terms of the GNU Lesser General</span></div>
<div class="line"><span class="comment"> * Public License as published by the Free Software Foundation; either</span></div>
<div class="line"><span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><span class="comment"> * The full text of the license can be found in the file LICENSE.md at</span></div>
<div class="line"><span class="comment"> * the top level directory of deal.II.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Authors: Fabian Castelli, Karlsruhe Institute of Technology (KIT)</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2timer_8h.html">deal.II/base/timer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2vectorization_8h.html">deal.II/base/vectorization.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__accessor_8h.html">deal.II/dofs/dof_accessor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2mapping__q__generic_8h.html">deal.II/fe/mapping_q_generic.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__out_8h.html">deal.II/grid/grid_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2manifold__lib_8h.html">deal.II/grid/manifold_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria__accessor_8h.html">deal.II/grid/tria_accessor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria__iterator_8h.html">deal.II/grid/tria_iterator.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2precondition_8h.html">deal.II/lac/precondition.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2solver__cg_8h.html">deal.II/lac/solver_cg.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2vector_8h.html">deal.II/lac/vector.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_2fe__evaluation_8h.html">deal.II/matrix_free/fe_evaluation.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_2matrix__free_8h.html">deal.II/matrix_free/matrix_free.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_2operators_8h.html">deal.II/matrix_free/operators.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_2tools_8h.html">deal.II/matrix_free/tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__coarse_8h.html">deal.II/multigrid/mg_coarse.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__constrained__dofs_8h.html">deal.II/multigrid/mg_constrained_dofs.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__matrix_8h.html">deal.II/multigrid/mg_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__smoother_8h.html">deal.II/multigrid/mg_smoother.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__tools_8h.html">deal.II/multigrid/mg_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__transfer__matrix__free_8h.html">deal.II/multigrid/mg_transfer_matrix_free.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2multigrid_8h.html">deal.II/multigrid/multigrid.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceStep66.html">Step66</a></div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">  <span class="keyword">class </span>JacobianOperator</div>
<div class="line">    : <span class="keyword">public</span> <a class="code" href="namespaceMatrixFreeOperators.html">MatrixFreeOperators</a>::</div>
<div class="line">        Base&lt;dim, LinearAlgebra::distributed::Vector&lt;number&gt;&gt;</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">using</span> value_type = <a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using</span> FECellIntegrator =</div>
<div class="line">      <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, fe_degree, fe_degree + 1, 1, number&gt;</a>;</div>
<div class="line"> </div>
<div class="line">    JacobianOperator();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="table__0_8txt.html#a7f24305532768edc889062eefd4b28cf">clear</a>() <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> evaluate_newton_step(</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;newton_step);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">compute_diagonal</a>() <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="operators__0_8txt.html#a92cb2920df95b6f107c2c9a8c75b788c">apply_add</a>(</div>
<div class="line">      <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src) <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span></div>
<div class="line">    local_apply(<span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, number&gt;</a> &amp;                   <a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>,</div>
<div class="line">                <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">                <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src,</div>
<div class="line">                <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;cell_range) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> local_compute_diagonal(FECellIntegrator &amp;integrator) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;2, VectorizedArray&lt;number&gt;</a>&gt; nonlinear_values;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">  <a class="code" href="classStep66_1_1JacobianOperator.html#aaedf9c433341f7980f1145823681507f">JacobianOperator&lt;dim, fe_degree, number&gt;::JacobianOperator</a>()</div>
<div class="line">    : <a class="code" href="namespaceMatrixFreeOperators.html">MatrixFreeOperators</a>::Base&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>,</div>
<div class="line">                                <a class="code" href="namespaceLinearAlgebra.html">LinearAlgebra</a>::<a class="code" href="distributed__0_8txt.html#ad7a526c3d1317369fada16d420fcb06c">distributed</a>::<a class="code" href="namespaceLinearAlgebraDealII.html#a2165565a5e6b6679392a7dee5d01ef58">Vector</a>&lt;<a class="code" href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a>&gt;&gt;()</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="table__0_8txt.html#a7f24305532768edc889062eefd4b28cf">JacobianOperator&lt;dim, fe_degree, number&gt;::clear</a>()</div>
<div class="line">  {</div>
<div class="line">    nonlinear_values.reinit(0, 0);</div>
<div class="line">    <a class="code" href="classMatrixFreeOperators_1_1Base.html">MatrixFreeOperators::Base&lt;dim, LinearAlgebra::distributed::Vector&lt;number&gt;</a>&gt;<a class="code" href="table__0_8txt.html#a7f24305532768edc889062eefd4b28cf">::</a></div>
<div class="line"><a class="code" href="table__0_8txt.html#a7f24305532768edc889062eefd4b28cf">      clear</a>();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">  <span class="keywordtype">void</span> JacobianOperator&lt;dim, fe_degree, number&gt;::evaluate_newton_step(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;newton_step)</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a> = this-&gt;data-&gt;<a class="code" href="classMatrixFree.html#a8c9d964339b466bdcb661552e731e222">n_cell_batches</a>();</div>
<div class="line">    FECellIntegrator   phi(*this-&gt;data);</div>
<div class="line"> </div>
<div class="line">    nonlinear_values.reinit(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>, phi.n_q_points);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> = 0; <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> &lt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>; ++<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>)</div>
<div class="line">      {</div>
<div class="line">        phi.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line">        phi.read_dof_values_plain(newton_step);</div>
<div class="line">        phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">          {</div>
<div class="line">            nonlinear_values(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, q) = <a class="code" href="base_2vectorization_8h.html#a19f846bda83b7e3f4531daacb40c64e1">std::exp</a>(phi.get_value(q));</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">  <span class="keywordtype">void</span> JacobianOperator&lt;dim, fe_degree, number&gt;::local_apply(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, number&gt;</a> &amp;                   <a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>,</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src,</div>
<div class="line">    <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;     cell_range)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    FECellIntegrator phi(<a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> = cell_range.first; <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> &lt; cell_range.second; ++<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(nonlinear_values.size(0),</div>
<div class="line">                        phi.get_matrix_free().n_cell_batches());</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(nonlinear_values.size(1), phi.n_q_points);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        phi.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">        phi.gather_evaluate(src,</div>
<div class="line">                            <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> |</div>
<div class="line">                              <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">          {</div>
<div class="line">            phi.submit_value(-nonlinear_values(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, q) * phi.get_value(q), q);</div>
<div class="line">            phi.submit_gradient(phi.get_gradient(q), q);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        phi.integrate_scatter(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> |</div>
<div class="line">                                <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>,</div>
<div class="line">                              <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>);</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="operators__0_8txt.html#a92cb2920df95b6f107c2c9a8c75b788c">JacobianOperator&lt;dim, fe_degree, number&gt;::apply_add</a>(</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    this-&gt;data-&gt;<a class="code" href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">cell_loop</a>(&amp;JacobianOperator::local_apply, <span class="keyword">this</span>, <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>, src);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">  <span class="keywordtype">void</span> JacobianOperator&lt;dim, fe_degree, number&gt;::local_compute_diagonal(</div>
<div class="line">    FECellIntegrator &amp;phi)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(nonlinear_values.size(0),</div>
<div class="line">                    phi.get_matrix_free().n_cell_batches());</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(nonlinear_values.size(1), phi.n_q_points);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> = phi.get_current_cell_index();</div>
<div class="line"> </div>
<div class="line">    phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> | <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">      {</div>
<div class="line">        phi.submit_value(-nonlinear_values(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, q) * phi.get_value(q), q);</div>
<div class="line">        phi.submit_gradient(phi.get_gradient(q), q);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    phi.integrate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> | <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">JacobianOperator&lt;dim, fe_degree, number&gt;::compute_diagonal</a>()</div>
<div class="line">  {</div>
<div class="line">    this-&gt;inverse_diagonal_entries.reset(</div>
<div class="line">      <span class="keyword">new</span> <a class="code" href="classDiagonalMatrix.html">DiagonalMatrix</a>&lt;<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a>&gt;());</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;inverse_diagonal =</div>
<div class="line">      this-&gt;inverse_diagonal_entries-&gt;get_vector();</div>
<div class="line">    this-&gt;data-&gt;<a class="code" href="classMatrixFree.html#ab92a24942737bbaf04d7e00aceba9b57">initialize_dof_vector</a>(inverse_diagonal);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">MatrixFreeTools::compute_diagonal</a>(*this-&gt;data,</div>
<div class="line">                                      inverse_diagonal,</div>
<div class="line">                                      &amp;JacobianOperator::local_compute_diagonal,</div>
<div class="line">                                      <span class="keyword">this</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;diagonal_element : inverse_diagonal)</div>
<div class="line">      {</div>
<div class="line">        diagonal_element = (<a class="code" href="base_2vectorization_8h.html#aafbdfdd72b6cfe4eae5fa7a16385582f">std::abs</a>(diagonal_element) &gt; 1.0e-10) ?</div>
<div class="line">                             (1.0 / diagonal_element) :</div>
<div class="line">                             1.0;</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keyword">class </span><a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem</a></div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">run</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="step-2_8cc.html#ab108b7b7bca84a81aceda045aaef1961">make_grid</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> setup_system();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> evaluate_residual(</div>
<div class="line">      <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;src) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> local_evaluate_residual(</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, double&gt;</a> &amp;                   <a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>,</div>
<div class="line">      <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;src,</div>
<div class="line">      <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;     cell_range) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> assemble_rhs();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> compute_residual(<span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> compute_update();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> compute_solution_norm() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classparallel_1_1distributed_1_1Triangulation.html">parallel::distributed::Triangulation&lt;dim&gt;</a> <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classMappingQGeneric.html">MappingQGeneric&lt;dim&gt;</a>                <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a>       <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>;</div>
<div class="line">    <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> dof_handler;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>;</div>
<div class="line">    <span class="keyword">using</span> SystemMatrixType = JacobianOperator&lt;dim, fe_degree, double&gt;;</div>
<div class="line">    SystemMatrixType system_matrix;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classMGConstrainedDoFs.html">MGConstrainedDoFs</a> mg_constrained_dofs;</div>
<div class="line">    <span class="keyword">using</span> LevelMatrixType = JacobianOperator&lt;dim, fe_degree, float&gt;;</div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;LevelMatrixType&gt;</a>                           mg_matrices;</div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt; mg_solution;</div>
<div class="line">    <a class="code" href="classMGTransferMatrixFree.html">MGTransferMatrixFree&lt;dim, float&gt;</a>                         mg_transfer;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>;</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> newton_update;</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> system_rhs;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> linear_iterations;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classConditionalOStream.html">ConditionalOStream</a> pcout;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTimerOutput.html">TimerOutput</a> computing_timer;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem&lt;dim, fe_degree&gt;::GelfandProblem</a>()</div>
<div class="line">    : <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>(MPI_COMM_WORLD,</div>
<div class="line">                    <a class="code" href="classTriangulation.html">Triangulation</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;::limit_level_difference_at_vertices,</div>
<div class="line">                    <a class="code" href="namespaceparallel.html">parallel</a>::<a class="code" href="distributed__0_8txt.html#ad7a526c3d1317369fada16d420fcb06c">distributed</a>::<a class="code" href="classTriangulation.html">Triangulation</a>&lt;</div>
<div class="line">                      <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;::<a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0a3901e6a241f812109912537866771e4c">construct_multigrid_hierarchy</a>)</div>
<div class="line">    , <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>(<a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>)</div>
<div class="line">    , <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>(<a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>)</div>
<div class="line">    , dof_handler(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>)</div>
<div class="line">    , pcout(std::cout, <a class="code" href="namespaceUtilities.html">Utilities</a>::<a class="code" href="base_2partitioner__0_8txt.html#a6d2d0fa485d1660823c59c494fb0fb31">MPI</a>::<a class="code" href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">this_mpi_process</a>(MPI_COMM_WORLD) == 0)</div>
<div class="line">    , computing_timer(MPI_COMM_WORLD,</div>
<div class="line">                      pcout,</div>
<div class="line">                      <a class="code" href="classTimerOutput.html">TimerOutput</a>::never,</div>
<div class="line">                      <a class="code" href="classTimerOutput.html">TimerOutput</a>::wall_times)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="step-2_8cc.html#ab108b7b7bca84a81aceda045aaef1961">GelfandProblem&lt;dim, fe_degree&gt;::make_grid</a>()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;make grid&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSphericalManifold.html">SphericalManifold&lt;dim&gt;</a>                boundary_manifold;</div>
<div class="line">    <a class="code" href="classTransfiniteInterpolationManifold.html">TransfiniteInterpolationManifold&lt;dim&gt;</a> inner_manifold;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceGridGenerator.html#a533c4778cbc9bcbed365dcab42ca4418">GridGenerator::hyper_ball</a>(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.set_all_manifold_ids(1);</div>
<div class="line">    <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.set_all_manifold_ids_on_boundary(0);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.set_manifold(0, boundary_manifold);</div>
<div class="line"> </div>
<div class="line">    inner_manifold.<a class="code" href="classTransfiniteInterpolationManifold.html#a34326a35d9ec4b6911d90c85c21847d8">initialize</a>(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>);</div>
<div class="line">    <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.set_manifold(1, inner_manifold);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.refine_global(3 - <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem&lt;dim, fe_degree&gt;::setup_system</a>()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;setup system&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    system_matrix.clear();</div>
<div class="line">    mg_matrices.clear_elements();</div>
<div class="line"> </div>
<div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
<div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#a9aed31323cbd7619edac310c47e7a7ad">distribute_mg_dofs</a>();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classIndexSet.html">IndexSet</a> locally_relevant_dofs;</div>
<div class="line">    <a class="code" href="namespaceDoFTools.html#acad7e0841b9046eaafddc4c617ab1d9d">DoFTools::extract_locally_relevant_dofs</a>(dof_handler, locally_relevant_dofs);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#addd15bc409c61d6f795f0132c574335b">clear</a>();</div>
<div class="line">    <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#a2c9d71b5b7e8851c25a411ccf34de986">reinit</a>(locally_relevant_dofs);</div>
<div class="line">    <a class="code" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a>(dof_handler, <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>);</div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(dof_handler,</div>
<div class="line">                                             0,</div>
<div class="line">                                             <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(),</div>
<div class="line">                                             <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>);</div>
<div class="line">    <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">typename</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, double&gt;::AdditionalData</a> additional_data;</div>
<div class="line">      additional_data.tasks_parallel_scheme =</div>
<div class="line">        <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, double&gt;::AdditionalData::partition_color</a>;</div>
<div class="line">      additional_data.mapping_update_flags =</div>
<div class="line">        (<a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> |</div>
<div class="line">         <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a>);</div>
<div class="line">      <span class="keyword">auto</span> system_mf_storage = std::make_shared&lt;MatrixFree&lt;dim, double&gt;&gt;();</div>
<div class="line">      system_mf_storage-&gt;<a class="code" href="classMatrixFree.html#adb324d469b296f2a6921b41208732ddf">reinit</a>(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                dof_handler,</div>
<div class="line">                                <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>,</div>
<div class="line">                                <a class="code" href="classQGauss.html">QGauss&lt;1&gt;</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1),</div>
<div class="line">                                additional_data);</div>
<div class="line"> </div>
<div class="line">      system_matrix.initialize(system_mf_storage);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    system_matrix.initialize_dof_vector(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line">    system_matrix.initialize_dof_vector(newton_update);</div>
<div class="line">    system_matrix.initialize_dof_vector(system_rhs);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nlevels = <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels();</div>
<div class="line">    mg_matrices.resize(0, nlevels - 1);</div>
<div class="line">    mg_solution.resize(0, nlevels - 1);</div>
<div class="line"> </div>
<div class="line">    std::set&lt;types::boundary_id&gt; dirichlet_boundary;</div>
<div class="line">    dirichlet_boundary.insert(0);</div>
<div class="line">    mg_constrained_dofs.initialize(dof_handler);</div>
<div class="line">    mg_constrained_dofs.make_zero_boundary_constraints(dof_handler,</div>
<div class="line">                                                       dirichlet_boundary);</div>
<div class="line"> </div>
<div class="line">    mg_transfer.<a class="code" href="classMGTransferMatrixFree.html#a69e2b416ab209936f94db08e865cd92b">initialize_constraints</a>(mg_constrained_dofs);</div>
<div class="line">    mg_transfer.<a class="code" href="classMGTransferMatrixFree.html#a8f214ffade006cfa85e902a94902fc7b">build</a>(dof_handler);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; nlevels; ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classIndexSet.html">IndexSet</a> relevant_dofs;</div>
<div class="line">        <a class="code" href="namespaceDoFTools.html#a1fef7be07cf379b661646e39b9354e17">DoFTools::extract_locally_relevant_level_dofs</a>(dof_handler,</div>
<div class="line">                                                      <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>,</div>
<div class="line">                                                      relevant_dofs);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> level_constraints;</div>
<div class="line">        level_constraints.<a class="code" href="classAffineConstraints.html#a2c9d71b5b7e8851c25a411ccf34de986">reinit</a>(relevant_dofs);</div>
<div class="line">        level_constraints.<a class="code" href="classAffineConstraints.html#aef97b22281acb10c914d79a3881e2735">add_lines</a>(</div>
<div class="line">          mg_constrained_dofs.get_boundary_indices(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">        level_constraints.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">typename</span> <a class="code" href="structMatrixFree_1_1AdditionalData.html">MatrixFree&lt;dim, float&gt;::AdditionalData</a> additional_data;</div>
<div class="line">        additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a0bcce2facca91b925d3e1a5a00c7704b">tasks_parallel_scheme</a> =</div>
<div class="line">          <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, float&gt;::AdditionalData::partition_color</a>;</div>
<div class="line">        additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#aa5d597e6c4441d273f4100b6139a2552">mapping_update_flags</a> =</div>
<div class="line">          (<a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> |</div>
<div class="line">           <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a>);</div>
<div class="line">        additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a67c9ff01c51fb7fb3ada151b83cdd409">mg_level</a> = <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>;</div>
<div class="line">        <span class="keyword">auto</span> mg_mf_storage_level = std::make_shared&lt;MatrixFree&lt;dim, float&gt;&gt;();</div>
<div class="line">        mg_mf_storage_level-&gt;<a class="code" href="classMultigrid.html#af3c33c4008b7b0d13c69d097fda50630">reinit</a>(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                    dof_handler,</div>
<div class="line">                                    level_constraints,</div>
<div class="line">                                    <a class="code" href="classQGauss.html">QGauss&lt;1&gt;</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1),</div>
<div class="line">                                    additional_data);</div>
<div class="line"> </div>
<div class="line">        mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].initialize(mg_mf_storage_level,</div>
<div class="line">                                      mg_constrained_dofs,</div>
<div class="line">                                      <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">        mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].initialize_dof_vector(mg_solution[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>]);</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem&lt;dim, fe_degree&gt;::evaluate_residual</a>(</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;src)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keyword">auto</span> matrix_free = system_matrix.get_matrix_free();</div>
<div class="line"> </div>
<div class="line">    matrix_free-&gt;cell_loop(</div>
<div class="line">      &amp;GelfandProblem::local_evaluate_residual, <span class="keyword">this</span>, <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>, src, <span class="keyword">true</span>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem&lt;dim, fe_degree&gt;::local_evaluate_residual</a>(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, double&gt;</a> &amp;                   <a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>,</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;      <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;src,</div>
<div class="line">    <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;     cell_range)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, fe_degree, fe_degree + 1, 1, double&gt;</a> phi(<a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> = cell_range.first; <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> &lt; cell_range.second; ++<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>)</div>
<div class="line">      {</div>
<div class="line">        phi.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">        phi.read_dof_values_plain(src);</div>
<div class="line">        phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> | <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">          {</div>
<div class="line">            phi.submit_value(-std::exp(phi.get_value(q)), q);</div>
<div class="line">            phi.submit_gradient(phi.get_gradient(q), q);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        phi.integrate_scatter(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> |</div>
<div class="line">                                <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>,</div>
<div class="line">                              <a class="code" href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a>);</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem&lt;dim, fe_degree&gt;::assemble_rhs</a>()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;assemble right hand side&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    evaluate_residual(system_rhs, <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line">    system_rhs *= -1.0;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">double</span> <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem&lt;dim, fe_degree&gt;::compute_residual</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;compute residual&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> <a class="code" href="newton__0_8txt.html#a21f536f84dd77674667ed5d2a30eb3ab">residual</a>;</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> evaluation_point;</div>
<div class="line"> </div>
<div class="line">    system_matrix.initialize_dof_vector(<a class="code" href="newton__0_8txt.html#a21f536f84dd77674667ed5d2a30eb3ab">residual</a>);</div>
<div class="line">    system_matrix.initialize_dof_vector(evaluation_point);</div>
<div class="line"> </div>
<div class="line">    evaluation_point = <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a> &gt; 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-12)</div>
<div class="line">      {</div>
<div class="line">        evaluation_point.<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html#ac029174b48a0707da587b6ce3bc25047">add</a>(<a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>, newton_update);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    evaluate_residual(<a class="code" href="newton__0_8txt.html#a21f536f84dd77674667ed5d2a30eb3ab">residual</a>, evaluation_point);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="newton__0_8txt.html#a21f536f84dd77674667ed5d2a30eb3ab">residual</a>.l2_norm();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem&lt;dim, fe_degree&gt;::compute_update</a>()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;compute update&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.update_ghost_values();</div>
<div class="line"> </div>
<div class="line">    system_matrix.evaluate_newton_step(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    mg_transfer.<a class="code" href="classMGTransferMatrixFree.html#a90aef560cc3d832589ca13a5f18e1414">interpolate_to_mg</a>(dof_handler, mg_solution, <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using</span> SmootherType =</div>
<div class="line">      <a class="code" href="classPreconditionChebyshev.html">PreconditionChebyshev</a>&lt;LevelMatrixType,</div>
<div class="line">                            <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt;;</div>
<div class="line">    <a class="code" href="classmg_1_1SmootherRelaxation.html">mg::SmootherRelaxation</a>&lt;SmootherType,</div>
<div class="line">                           <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt;</div>
<div class="line">                                                         mg_smoother;</div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;typename SmootherType::AdditionalData&gt;</a> smoother_data;</div>
<div class="line">    smoother_data.<a class="code" href="classMGLevelObject.html#a16213121f9153bd08f49652a11886259">resize</a>(0, <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels() - 1);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels();</div>
<div class="line">         ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &gt; 0)</div>
<div class="line">          {</div>
<div class="line">            smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].smoothing_range     = 15.;</div>
<div class="line">            smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].degree              = 4;</div>
<div class="line">            smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].eig_cg_n_iterations = 10;</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          {</div>
<div class="line">            smoother_data[0].smoothing_range = 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-3;</div>
<div class="line">            smoother_data[0].degree          = <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>;</div>
<div class="line">            smoother_data[0].eig_cg_n_iterations = mg_matrices[0].m();</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].evaluate_newton_step(mg_solution[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>]);</div>
<div class="line">        mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].compute_diagonal();</div>
<div class="line"> </div>
<div class="line">        smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].preconditioner =</div>
<div class="line">          mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].get_matrix_diagonal_inverse();</div>
<div class="line">      }</div>
<div class="line">    mg_smoother.initialize(mg_matrices, smoother_data);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classMGCoarseGridApplySmoother.html">MGCoarseGridApplySmoother&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt;</div>
<div class="line">      mg_coarse;</div>
<div class="line">    mg_coarse.<a class="code" href="classMGCoarseGridApplySmoother.html#a499c7364e40031332e9943a2e5f331a2">initialize</a>(mg_smoother);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt; mg_matrix(</div>
<div class="line">      mg_matrices);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;MatrixFreeOperators::MGInterfaceOperator&lt;LevelMatrixType&gt;</a>&gt;</div>
<div class="line">      mg_interface_matrices;</div>
<div class="line">    mg_interface_matrices.<a class="code" href="classMGLevelObject.html#a16213121f9153bd08f49652a11886259">resize</a>(0, <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels() - 1);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels();</div>
<div class="line">         ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">      {</div>
<div class="line">        mg_interface_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].initialize(mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>]);</div>
<div class="line">      }</div>
<div class="line">    <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt; mg_interface(</div>
<div class="line">      mg_interface_matrices);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classMultigrid.html">Multigrid&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt; <a class="code" href="namespacemg.html">mg</a>(</div>
<div class="line">      mg_matrix, mg_coarse, mg_transfer, mg_smoother, mg_smoother);</div>
<div class="line">    <a class="code" href="namespacemg.html">mg</a>.set_edge_matrices(mg_interface, mg_interface);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classPreconditionMG.html">PreconditionMG</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>,</div>
<div class="line">                   <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;float&gt;</a>,</div>
<div class="line">                   <a class="code" href="classMGTransferMatrixFree.html">MGTransferMatrixFree&lt;dim, float&gt;</a>&gt;</div>
<div class="line">      <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>(dof_handler, <a class="code" href="namespacemg.html">mg</a>, mg_transfer);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSolverControl.html">SolverControl</a> solver_control(100, 1.<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-12);</div>
<div class="line">    <a class="code" href="classSolverCG.html">SolverCG&lt;LinearAlgebra::distributed::Vector&lt;double&gt;</a>&gt; cg(solver_control);</div>
<div class="line"> </div>
<div class="line">    newton_update = 0.0;</div>
<div class="line"> </div>
<div class="line">    cg.solve(system_matrix, newton_update, system_rhs, <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">distribute</a>(newton_update);</div>
<div class="line"> </div>
<div class="line">    linear_iterations = solver_control.<a class="code" href="classSolverControl.html#a42aeae81cd6b67ce93b5fbea3328371f">last_step</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.zero_out_ghost_values();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">GelfandProblem&lt;dim, fe_degree&gt;::solve</a>()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;solve&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> itmax = 10;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>       TOLf  = 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-12;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>       TOLx  = 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-10;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTimer.html">Timer</a> solver_timer;</div>
<div class="line">    solver_timer.<a class="code" href="classTimer.html#a3a8b5272198d029779dc9302a54305a8">start</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> newton_step = 1; newton_step &lt;= itmax; ++newton_step)</div>
<div class="line">      {</div>
<div class="line">        assemble_rhs();</div>
<div class="line">        compute_update();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> ERRx = newton_update.<a class="code" href="classBlockVectorBase.html#ac718033fc083f27c45c6bfb4ac780360">l2_norm</a>();</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> ERRf = compute_residual(1.0);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.add(1.0, newton_update);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;   Nstep &quot;</span> &lt;&lt; newton_step &lt;&lt; <span class="stringliteral">&quot;, errf = &quot;</span> &lt;&lt; ERRf</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;, errx = &quot;</span> &lt;&lt; ERRx &lt;&lt; <span class="stringliteral">&quot;, it = &quot;</span> &lt;&lt; linear_iterations</div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (ERRf &lt; TOLf || ERRx &lt; TOLx)</div>
<div class="line">          {</div>
<div class="line">            solver_timer.<a class="code" href="classTimer.html#a988f79aa183d9d5473c13106f5babe48">stop</a>();</div>
<div class="line"> </div>
<div class="line">            pcout &lt;&lt; <span class="stringliteral">&quot;Convergence step &quot;</span> &lt;&lt; newton_step &lt;&lt; <span class="stringliteral">&quot; value &quot;</span> &lt;&lt; ERRf</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot; (used wall time: &quot;</span> &lt;&lt; solver_timer.<a class="code" href="classTimer.html#a6f3e76707411b51e7d7e7bfa5755cf02">wall_time</a>() &lt;&lt; <span class="stringliteral">&quot; s)&quot;</span></div>
<div class="line">                  &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (newton_step == itmax)</div>
<div class="line">          {</div>
<div class="line">            solver_timer.<a class="code" href="classTimer.html#a988f79aa183d9d5473c13106f5babe48">stop</a>();</div>
<div class="line">            pcout &lt;&lt; <span class="stringliteral">&quot;WARNING: No convergence of Newton&#39;s method after &quot;</span></div>
<div class="line">                  &lt;&lt; newton_step &lt;&lt; <span class="stringliteral">&quot; steps.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">double</span> <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem&lt;dim, fe_degree&gt;::compute_solution_norm</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.update_ghost_values();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;float&gt;</a> norm_per_cell(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells());</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#a676190d2c897ac5da68a9c460fa95832">VectorTools::integrate_difference</a>(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                      dof_handler,</div>
<div class="line">                                      <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>,</div>
<div class="line">                                      <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(),</div>
<div class="line">                                      norm_per_cell,</div>
<div class="line">                                      <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 2),</div>
<div class="line">                                      <a class="code" href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1a7c450aee1986e226cf1bd7687171d769">VectorTools::H1_seminorm</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.zero_out_ghost_values();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="namespaceVectorTools.html#a21eb62d70953182dcc2b15c4e14dd533">VectorTools::compute_global_error</a>(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>,</div>
<div class="line">                                             norm_per_cell,</div>
<div class="line">                                             <a class="code" href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1a7c450aee1986e226cf1bd7687171d769">VectorTools::H1_seminorm</a>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span></div>
<div class="line">  <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem&lt;dim, fe_degree&gt;::output_results</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_active_cells() &gt; 1e6)</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.update_ghost_values();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">attach_dof_handler</a>(dof_handler);</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, <span class="stringliteral">&quot;solution&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;float&gt;</a> <a class="code" href="index__set__0_8txt.html#a85fb0893d080862c6fc2fbcb1e57a791">subdomain</a>(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells());</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="index__set__0_8txt.html#a85fb0893d080862c6fc2fbcb1e57a791">subdomain</a>.size(); ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="index__set__0_8txt.html#a85fb0893d080862c6fc2fbcb1e57a791">subdomain</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>) = <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.locally_owned_subdomain();</div>
<div class="line">      }</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(<a class="code" href="index__set__0_8txt.html#a85fb0893d080862c6fc2fbcb1e57a791">subdomain</a>, <span class="stringliteral">&quot;subdomain&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    data_out.<a class="code" href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">build_patches</a>(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                           <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a>,</div>
<div class="line">                           <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;::curved_inner_cells</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="structDataOutBase_1_1VtkFlags.html">DataOutBase::VtkFlags</a> <a class="code" href="update__flags__0_8txt.html#ac8b7167f13d273c0000a680958db42c5">flags</a>;</div>
<div class="line">    <a class="code" href="update__flags__0_8txt.html#ac8b7167f13d273c0000a680958db42c5">flags</a>.compression_level = <a class="code" href="group__Exceptions.html#ga7ad65742b9dbfb7eeb04b511b5a08d63a3c83e26f202f837328b9f7532773be70">DataOutBase::VtkFlags::best_speed</a>;</div>
<div class="line">    data_out.<a class="code" href="classDataOutInterface.html#ac7280a24690b117454acfb0fa058299c">set_flags</a>(<a class="code" href="update__flags__0_8txt.html#ac8b7167f13d273c0000a680958db42c5">flags</a>);</div>
<div class="line">    data_out.<a class="code" href="classDataOutInterface.html#a0864e51eb173c87e2a3edc9391ea8009">write_vtu_with_pvtu_record</a>(</div>
<div class="line">      <span class="stringliteral">&quot;./&quot;</span>, <span class="stringliteral">&quot;solution_&quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>) + <span class="stringliteral">&quot;d&quot;</span>, <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>, MPI_COMM_WORLD, 3);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.zero_out_ghost_values();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">GelfandProblem&lt;dim, fe_degree&gt;::run</a>()</div>
<div class="line">  {</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_ranks =</div>
<div class="line">        <a class="code" href="namespaceUtilities_1_1MPI.html#ac26de0c059200523177bb1d92cc25d00">Utilities::MPI::n_mpi_processes</a>(MPI_COMM_WORLD);</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_vect_doubles = <a class="code" href="classVectorizedArrayBase.html#acb35404acc1693aee6e990228924cc09">VectorizedArray&lt;double&gt;::size</a>();</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_vect_bits    = 8 * <span class="keyword">sizeof</span>(<a class="code" href="hdf5__0_8txt.html#aae153b86de45d3354cd3edd5b992435e">double</a>) * n_vect_doubles;</div>
<div class="line"> </div>
<div class="line">      std::string DAT_header = <span class="stringliteral">&quot;START DATE: &quot;</span> + <a class="code" href="namespaceUtilities_1_1System.html#aff548b3b9b7a035ea112729700ef7c64">Utilities::System::get_date</a>() +</div>
<div class="line">                               <span class="stringliteral">&quot;, TIME: &quot;</span> + <a class="code" href="namespaceUtilities_1_1System.html#a76bc1cc7649cc416723f450d24fdd91d">Utilities::System::get_time</a>();</div>
<div class="line">      std::string MPI_header = <span class="stringliteral">&quot;Running with &quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(n_ranks) +</div>
<div class="line">                               <span class="stringliteral">&quot; MPI process&quot;</span> + (n_ranks &gt; 1 ? <span class="stringliteral">&quot;es&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">      std::string VEC_header =</div>
<div class="line">        <span class="stringliteral">&quot;Vectorization over &quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(n_vect_doubles) +</div>
<div class="line">        <span class="stringliteral">&quot; doubles = &quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(n_vect_bits) + <span class="stringliteral">&quot; bits (&quot;</span> +</div>
<div class="line">        <a class="code" href="namespaceUtilities_1_1System.html#ade631a789101336840371e3b2e2851e0">Utilities::System::get_current_vectorization_level</a>() +</div>
<div class="line">        <span class="stringliteral">&quot;), VECTORIZATION_LEVEL=&quot;</span> +</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(<a class="code" href="config_8h.html#a32dc208a29f23d1f031fb40b0d21e60e">DEAL_II_COMPILER_VECTORIZATION_LEVEL</a>);</div>
<div class="line">      std::string SOL_header = <span class="stringliteral">&quot;Finite element space: &quot;</span> + <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFE__Q.html#aef8e62ce116e341818549d1730343792">get_name</a>();</div>
<div class="line"> </div>
<div class="line">      pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;=&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line">      pcout &lt;&lt; DAT_header &lt;&lt; std::endl;</div>
<div class="line">      pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;-&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">      pcout &lt;&lt; MPI_header &lt;&lt; std::endl;</div>
<div class="line">      pcout &lt;&lt; VEC_header &lt;&lt; std::endl;</div>
<div class="line">      pcout &lt;&lt; SOL_header &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">      pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;=&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> = 0; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt; 9 - <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>)</div>
<div class="line">      {</div>
<div class="line">        pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;-&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;Cycle &quot;</span> &lt;&lt; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt;&lt; std::endl;</div>
<div class="line">        pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;-&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> == 0)</div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="step-2_8cc.html#ab108b7b7bca84a81aceda045aaef1961">make_grid</a>();</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.refine_global(1);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classTimer.html">Timer</a> timer;</div>
<div class="line"> </div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;Set up system...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        setup_system();</div>
<div class="line"> </div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;   Triangulation: &quot;</span> &lt;&lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_active_cells()</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot; cells&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;   DoFHandler:    &quot;</span> &lt;&lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>() &lt;&lt; <span class="stringliteral">&quot; DoFs&quot;</span></div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line">        pcout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;Solve using Newton&#39;s method...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>();</div>
<div class="line">        pcout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        timer.<a class="code" href="classTimer.html#a988f79aa183d9d5473c13106f5babe48">stop</a>();</div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;Time for setup+solve (CPU/Wall) &quot;</span> &lt;&lt; timer.<a class="code" href="classTimer.html#a4e3933a78790d7455daff5acab3f8432">cpu_time</a>() &lt;&lt; <span class="stringliteral">&quot;/&quot;</span></div>
<div class="line">              &lt;&lt; timer.<a class="code" href="classTimer.html#a6f3e76707411b51e7d7e7bfa5755cf02">wall_time</a>() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        pcout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;Output results...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="multithreading__0_8txt.html#a0759c0124e216ec36f063ad051f4dba0">norm</a> = compute_solution_norm();</div>
<div class="line">        output_results(<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>);</div>
<div class="line"> </div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;  H1 seminorm: &quot;</span> &lt;&lt; <a class="code" href="multithreading__0_8txt.html#a0759c0124e216ec36f063ad051f4dba0">norm</a> &lt;&lt; std::endl;</div>
<div class="line">        pcout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        computing_timer.print_summary();</div>
<div class="line">        computing_timer.reset();</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Step66</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">using namespace </span><a class="code" href="namespaceStep66.html">Step66</a>;</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classUtilities_1_1MPI_1_1MPI__InitFinalize.html">Utilities::MPI::MPI_InitFinalize</a> mpi_init(argc, argv, 1);</div>
<div class="line"> </div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem&lt;2, 4&gt;</a> gelfand_problem;</div>
<div class="line">        gelfand_problem.run();</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classStep66_1_1GelfandProblem.html">GelfandProblem&lt;3, 4&gt;</a> gelfand_problem;</div>
<div class="line">        gelfand_problem.run();</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (<a class="code" href="parameter__handler__0_8txt.html#ad919e2b915d8e8226aef004c2d8399a8">std::exception</a> &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p> <br  />
 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="adistributed__0_8txt_html_adeac996b7de9cb86911e504716172e83"><div class="ttname"><a href="distributed__0_8txt.html#adeac996b7de9cb86911e504716172e83">system</a></div><div class="ttdeci">if we even only hold bytes per line in this sparsity we ll need GB for this object even if every single line is empty Of only million lines will be non for which we need MB plus whatever is necessary to store the actual column indices of nonzero entries Let s say we have a moderately complex problem with entries per for each of which we store the column index worth then we ll need bytes for each of the million lines that correspond to the degrees of freedom we for a total of GB And we ll need bytes for each of the million lines that we don t for a total of GB It is clear that this ratio doesn t become any better if we go to even higher numbers of processors *The solution to this problem is to really only use any memory at all for those parts of the linear system that we or need for some other reason For all other we must know that they but we can not set up any part of our data structure To this there exists a class called IndexSet that denotes a set of indices which we care for and for which we may have to allocate memory The data structures for sparsity patterns constraint matrices matrices and vector can be initialized with these IndexSet objects to really only care for those rows or entries that correspond to indices in the index set and not care about all others These objects will then ask how many indices exist in the set allocate memory for each one of and when you want to access data for global degree of freedom[2.x.28] you will be redirected to the result of calling[2.x.29] with index[2.x.30] instead Accessing data for elements[2.x.31] for which[2.x.32] is false will yield an error *The remaining question is how to identify the set of indices that correspond to degrees of freedom we need to worry about on each processor To this you can use the[2.x.33] function to get at all the indices a processor owns Note that this is a subset of the degrees of freedom that are defined on the locally owned one sometimes needs the set of all degrees of freedom on the locally owned subdomain as well as the adjacent ghost cells This information is provided by the[2.x.35] function ***A typical parallel application is dealing with two different kinds of parallel but there are of course different vector types that can each represent both ghosted vectors are typically used for data error input in integration This is because in these one typically needs access not only to[2.x.39] locally owned dofs but also to[2.x.40] locally active dofs and sometimes to[2.x.41] locally relevant and their values may not be stored in non ghosted vectors on the processor that needs them The operations listed above also only require read only access to and ghosted vectors are therefore usable in these contexts *On the other vectors without ghost entries are used in all other places like or any other form of manipulation These are typically write only operations and therefore need not have read access to vector elements that may be owned by another processor *You can copy between vectors with and without ghost the only class equipped to deal with the situation just explained is DynamicSparsityPattern A version of the function[2.x.45] exists that takes an IndexSet argument that indicates which lines of the sparsity pattern to allocate memory for In other it is safe to create such an object that will report as its size but in fact only stores only as many rows as the index set has elements You can then use the usual function[2.x.46] to build the sparsity pattern that results from assembling on the locally owned portion of the mesh The resulting object can be used to initialize a PETSc or Trilinos matrix which support very large object sizes through completely distributed storage The matrix can then be assembled by only looping over those cells owned by the current processor *The only thing to pay attention to is for which degrees of freedom the sparsity needs to store entries These in the ones we could possibly store values to in the matrix upon assembly It is clear that these are certainly the locally active degrees of it may also be possible to write to entries that are located on ghost cells you need to pass the index set that results from[2.x.47] upon initializing the sparsity pattern ***When creating the sparsity pattern as well as when assembling the linear system</div><div class="ttdef"><b>Definition:</b> <a href="distributed__0_8txt_source.html#l00070">distributed_0.txt:70</a></div></div>
<div class="ttc" id="asparse__vanka__0_8txt_html_a63f572a3b5d8c173a82cee16f5858977"><div class="ttname"><a href="sparse__vanka__0_8txt.html#a63f572a3b5d8c173a82cee16f5858977">dst</a></div><div class="ttdeci">this elimination is done by the modification of the right hand and in the end these degrees of freedom do not occur in the matrix and solution vector any more at all *This system is solved and the values are updated into the destination vector the matrices are built up such that the degree of freedom associated with the Lagrange multiplier is the first one usually the upper left entry in the matrix is zero It is not clear to so it must persist longer than the Vanka object The same is true for the matrix The matrix[2.x.11] which is passed here may or may not be the same matrix for which this object shall act as preconditioner In it is conceivable that the preconditioner is build up for one matrix but is used for subsequent steps in a nonlinear process as where the matrix changes in each step slightly **Destructor Delete all allocated matrices **Parameters for SparseVanka **Constructor For the parameters see below **Constructor For the parameters see below[2.x.12] The use of this constructor is deprecated **the second and third parameters are ignored **Indices of those degrees of freedom that we shall work on **If the default constructor is used then this function needs to be called before an object of this class is used as preconditioner For more detail about possible parameters see the class documentation and the documentation of the[2.x.13] class After this function is called the preconditioner is ready to be only values for allowed indices are written to[2.x.27] dst</div><div class="ttdef"><b>Definition:</b> <a href="sparse__vanka__0_8txt_source.html#l00060">sparse_vanka_0.txt:60</a></div></div>
<div class="ttc" id="aclassMatrixFree_html_ab92a24942737bbaf04d7e00aceba9b57"><div class="ttname"><a href="classMatrixFree.html#ab92a24942737bbaf04d7e00aceba9b57">MatrixFree::initialize_dof_vector</a></div><div class="ttdeci">void initialize_dof_vector(VectorType &amp;vec, const unsigned int dof_handler_index=0) const</div></div>
<div class="ttc" id="apolynomial__0_8txt_html_af1258c87f1d73d29bd17331843ac1d25"><div class="ttname"><a href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a></div><div class="ttdeci">namespace in which classes relating to the description of d polynomial spaces are declared ***Base class for all D polynomials A polynomial is represented in this class by its coefficients which are set through the constructor or by derived classes There are two paths for evaluation of polynomials One is based on the coefficients which are evaluated through the Horner scheme which is a robust general purpose scheme An alternative and more stable evaluation of high degree polynomials with roots in the unit interval is provided by a product in terms of the roots This form is available for special polynomials such as Lagrange polynomials or Legendre polynomials and used with the respective constructor To obtain this more stable evaluation form the constructor with the roots in form of a Lagrange polynomial must be used In case a manipulation is done that changes the roots the representation is switched to the coefficient form This class is a typical example of a possible template argument for the TensorProductPolynomials class **Constructor The coefficients of the polynomial are passed as and denote the i e the first element of the array denotes the constant the second the linear and so on The degree of the polynomial represented by this object is thus the number of elements in the&lt; tt &gt; coefficient&lt;/tt &gt; array minus one **Constructor creating a zero polynomial of degree *[2.x.3] *Constructor for a Lagrange polynomial and its point of evaluation The idea is to where j is the evaluation point specified as argument and the support points contain all the evaluation is based on products of the whereas the Horner scheme is used for polynomials in the coefficient form **Return the values and the derivatives of the Polynomial at point&lt; tt &gt; x&lt;/tt &gt;&lt; tt &gt; i</div><div class="ttdef"><b>Definition:</b> <a href="polynomial__0_8txt_source.html#l00024">polynomial_0.txt:24</a></div></div>
<div class="ttc" id="aclassStep66_1_1GelfandProblem_html"><div class="ttname"><a href="classStep66_1_1GelfandProblem.html">Step66::GelfandProblem</a></div><div class="ttdef"><b>Definition:</b> <a href="step-66_8cc_source.html#l00252">step-66.cc:252</a></div></div>
<div class="ttc" id="aclassDataOut__DoFData_html_a79cbe2f02f8dfb85026c71d783dbb703"><div class="ttname"><a href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">DataOut_DoFData::add_data_vector</a></div><div class="ttdeci">void add_data_vector(const VectorType &amp;data, const std::vector&lt; std::string &gt; &amp;names, const DataVectorType type=type_automatic, const std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt; &amp;data_component_interpretation=std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt;())</div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__out__dof__data_8h_source.html#l01096">data_out_dof_data.h:1096</a></div></div>
<div class="ttc" id="aclassIndexSet_html"><div class="ttname"><a href="classIndexSet.html">IndexSet</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2index__set_8h_source.html#l00068">index_set.h:68</a></div></div>
<div class="ttc" id="aclassFEValues_html_a21f914e63d588e2652a9514620653d77"><div class="ttname"><a href="classFEValues.html#a21f914e63d588e2652a9514620653d77">FEValues::reinit</a></div><div class="ttdeci">void reinit(const TriaIterator&lt; DoFCellAccessor&lt; dim, spacedim, level_dof_access &gt;&gt; &amp;cell)</div></div>
<div class="ttc" id="amultigrid_2multigrid_8h_html"><div class="ttname"><a href="multigrid_2multigrid_8h.html">multigrid.h</a></div></div>
<div class="ttc" id="anewton__0_8txt_html_af4dc1cb00f59a52e48df46a4c205a8e6"><div class="ttname"><a href="newton__0_8txt.html#af4dc1cb00f59a52e48df46a4c205a8e6">number</a></div><div class="ttdeci">*Operator class performing Newton s iteration with standard step size control and adaptive matrix generation This class performs a Newton iteration up to convergence determined by control If after an update the norm of the residual has become larger then step size control is activated and the update is subsequently divided by two until the residual actually becomes depending on the tends to be this method applies an adaptive reassembling strategy Only if the reduction factor for the residual is more than receiving the applications computing the residual and solving the linear respectively **Declare the parameters applicable to Newton s method **Read the parameters in the ParameterHandler **Initialize the pointer data_out for debugging **The actual Newton iteration The initial value is in&lt; tt &gt; which also contains the result after convergence Values in&lt; tt &gt; in&lt;/tt &gt; are not used by but will be handed down to the objects **Set the maximal residual reduction allowed without triggering assembling in the next step Return the previous value **Control object for the Newton iteration **The indicating that the matrix must be assembled anew upon start **A flag used to decide how many stepsize iteration should be made Default is the original value of Enter zero here to turn off stepsize control *Controlled by&lt; tt &gt; Stepsize iterations&lt;/tt &gt; in parameter file **Threshold for re assembling matrix If the quotient of two consecutive residuals is smaller than this the system matrix is not assembled in this step *This parameter should be adjusted to the residual gain of the inner solver The default values is resulting in reassembling in every Newton step **Print update and updated solution after each step into file&lt; tt &gt; Newton_NNN&lt;/tt &gt; **Write debug output to[2.x.3] the higher the number</div><div class="ttdef"><b>Definition:</b> <a href="newton__0_8txt_source.html#l00034">newton_0.txt:34</a></div></div>
<div class="ttc" id="aclassMatrixFree_html_a8c9d964339b466bdcb661552e731e222"><div class="ttname"><a href="classMatrixFree.html#a8c9d964339b466bdcb661552e731e222">MatrixFree::n_cell_batches</a></div><div class="ttdeci">unsigned int n_cell_batches() const</div></div>
<div class="ttc" id="afe_2fe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20"><div class="ttname"><a href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a></div><div class="ttdeci">@ update_gradients</div><div class="ttdoc">Shape function gradients.</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__update__flags_8h_source.html#l00077">fe_update_flags.h:77</a></div></div>
<div class="ttc" id="aclassMatrixFree_html_adb324d469b296f2a6921b41208732ddf"><div class="ttname"><a href="classMatrixFree.html#adb324d469b296f2a6921b41208732ddf">MatrixFree::reinit</a></div><div class="ttdeci">void reinit(const MappingType &amp;mapping, const DoFHandler&lt; dim &gt; &amp;dof_handler, const AffineConstraints&lt; number2 &gt; &amp;constraint, const QuadratureType &amp;quad, const AdditionalData &amp;additional_data=AdditionalData())</div></div>
<div class="ttc" id="anamespaceUtilities_1_1System_html_a76bc1cc7649cc416723f450d24fdd91d"><div class="ttname"><a href="namespaceUtilities_1_1System.html#a76bc1cc7649cc416723f450d24fdd91d">Utilities::System::get_time</a></div><div class="ttdeci">std::string get_time()</div><div class="ttdef"><b>Definition:</b> <a href="base_2utilities_8cc_source.html#l01019">utilities.cc:1019</a></div></div>
<div class="ttc" id="astructMatrixFree_1_1AdditionalData_html_a67c9ff01c51fb7fb3ada151b83cdd409"><div class="ttname"><a href="structMatrixFree_1_1AdditionalData.html#a67c9ff01c51fb7fb3ada151b83cdd409">MatrixFree::AdditionalData::mg_level</a></div><div class="ttdeci">unsigned int mg_level</div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_2matrix__free_8h_source.html#l00436">matrix_free.h:436</a></div></div>
<div class="ttc" id="ahdf5__0_8txt_html_aae153b86de45d3354cd3edd5b992435e"><div class="ttname"><a href="hdf5__0_8txt.html#aae153b86de45d3354cd3edd5b992435e">double</a></div><div class="ttdeci">*Namespace containing deal II s HDF5 interface whereas writing and reading raw data in a dataset can be done independently or double</div><div class="ttdef"><b>Definition:</b> <a href="hdf5__0_8txt_source.html#l00045">hdf5_0.txt:45</a></div></div>
<div class="ttc" id="amultithreading__0_8txt_html_af35ca33203cd802325d779be7b6b41e8"><div class="ttname"><a href="multithreading__0_8txt.html#af35ca33203cd802325d779be7b6b41e8">with</a></div><div class="ttdeci">namespace are implemented the way they are More information on their implementation can be found in the[2.x.72] WorkStream paper To see the WorkStream class used in practice on tasks like the ones outlined above take a look at or[2.x.78] tutorial programs *To begin with</div><div class="ttdef"><b>Definition:</b> <a href="multithreading__0_8txt_source.html#l00139">multithreading_0.txt:139</a></div></div>
<div class="ttc" id="aclassSolverCG_html"><div class="ttname"><a href="classSolverCG.html">SolverCG</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2solver__cg_8h_source.html#l00088">solver_cg.h:88</a></div></div>
<div class="ttc" id="apetsc__precondition__0_8txt_html_a41ebb2d49faa97a3d9eab4b4f13c2742"><div class="ttname"><a href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a></div><div class="ttdeci">*Base class for preconditioner classes using the PETSc functionality The classes in this hierarchy don t do a whole lot except for providing a function that sets the preconditioner and certain parameters on the preconditioning context of the solver These classes are basically here only to allow a similar interface as already used for the deal II solver and preconditioner classes Note that derived classes only provide interfaces to the relevant functionality of PETSc PETSc does not implement all preconditioners for all matrix types In particular some preconditioners are not going to work for parallel jobs such as for example the ILU preconditioner ***Constructor **Destructor **Destroys the preconditioner</div><div class="ttdef"><b>Definition:</b> <a href="petsc__precondition__0_8txt_source.html#l00002">petsc_precondition_0.txt:2</a></div></div>
<div class="ttc" id="aclassTimerOutput_1_1Scope_html"><div class="ttname"><a href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2timer_8h_source.html#l00600">timer.h:600</a></div></div>
<div class="ttc" id="aA-headers_2exceptions__0_8txt_html_a8fba07b9a84b89e6be225f5f95c3e355"><div class="ttname"><a href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">run</a></div><div class="ttdeci">the program is just and one can not intelligently work around that *It is sometimes useful to change the behavior of the[2.x.6] macro from aborting a program to throwing exceptions On the other exceptions are not allowed to propagate out of destructors of classes For this there is a variant of the called[2.x.7] that can be used in destructors These use cases are discussed further down below on this page **Dynamic such as whether an output file can be written to *These are things that shouldn t be checked because it is not guaranteed that a program for which the condition is satisfied in a debug mode run</div><div class="ttdef"><b>Definition:</b> <a href="A-headers_2exceptions__0_8txt_source.html#l00022">exceptions_0.txt:22</a></div></div>
<div class="ttc" id="areordering__0_8txt_html_abc892651c0b2805d80c1933e2fb51c1a"><div class="ttname"><a href="reordering__0_8txt.html#abc892651c0b2805d80c1933e2fb51c1a">right</a></div><div class="ttdeci">if it is not then it aborts in linear time as well *Both algorithms are described in the paper On orienting edges of unstructured two and three dimensional R M W W L ACM Transactions on Mathematical A preprint is available as *[1.x.19] **Prior to the implementation of the algorithms described we used a branch and cut algorithm initially implemented in by Wolfgang Bangerth Although it is no longer here is how it and why it doesn t always work for large meshes since its run time can be exponential in bad cases *The first observation is that although there are problems are usually local For in the second example mentioned if we had numbered the cells in a way that neighboring cells have similar cell then the amount of backtracking needed is greatly reduced in the implementation of the the first step is to renumber the cells in a Cuthill McKee and so on this represents finding zones of cells consecutively further away from the initial cells and number them in this front marching way This already greatly improves locality of problems and consequently reduced the necessary amount of backtracking *The second point is that we can use some methods to prune the which usually lead to a valid orientation of all cells very quickly *The first such method is based on the observation that if we fail to insert one cell with number then this may not be due to cell N unless N is a direct neighbor of N The reason is for the latter cannot be the case if we fail to add cell then it is not necessary to track back to cell but we can track back to the neighbor of N with the largest cell index and which has already been added this method can fail to yield a valid path through the tree if not applied with care Consider the following initially extracted from a mesh of cells generated automatically by the program BAMG(this program usually generates meshes that are quite badly balanced, often have many **- sometimes 10 or more **- neighbors of one vertex, and exposed several problems in the initial algorithm;note also that the example is in 2d where we now have the much better algorithm described above, but the same observations also apply to 3d) we will therefore find no orientation of cell in which it can be added without violation of the consistency of the triangulation According to the rule stated we track back to the neighbor with greatest which is but since its bottom line is to th right)</div><div class="ttdef"><b>Definition:</b> <a href="reordering__0_8txt_source.html#l00125">reordering_0.txt:125</a></div></div>
<div class="ttc" id="aclassFE__Q_html"><div class="ttname"><a href="classFE__Q.html">FE_Q&lt; dim &gt;</a></div></div>
<div class="ttc" id="anamespaceTriangulationDescription_html_aa1531298eb0a267d9ceca5eb46ada8e0a3901e6a241f812109912537866771e4c"><div class="ttname"><a href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0a3901e6a241f812109912537866771e4c">TriangulationDescription::construct_multigrid_hierarchy</a></div><div class="ttdeci">@ construct_multigrid_hierarchy</div><div class="ttdef"><b>Definition:</b> <a href="grid_2tria__description_8h_source.html#l00268">tria_description.h:268</a></div></div>
<div class="ttc" id="agrid_2tria__iterator_8h_html"><div class="ttname"><a href="grid_2tria__iterator_8h.html">tria_iterator.h</a></div></div>
<div class="ttc" id="anamespacedealii_html"><div class="ttname"><a href="namespacedealii.html">dealii</a></div><div class="ttdef"><b>Definition:</b> <a href="doc_2doxygen_2headers_2namespace__dealii_8h_source.html#l00026">namespace_dealii.h:26</a></div></div>
<div class="ttc" id="aclassLinearAlgebra_1_1distributed_1_1Vector_html_ac029174b48a0707da587b6ce3bc25047"><div class="ttname"><a href="classLinearAlgebra_1_1distributed_1_1Vector.html#ac029174b48a0707da587b6ce3bc25047">LinearAlgebra::distributed::Vector::add</a></div><div class="ttdeci">virtual void add(const Number a) override</div></div>
<div class="ttc" id="anamespaceLinearAlgebra_html"><div class="ttname"><a href="namespaceLinearAlgebra.html">LinearAlgebra</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2communication__pattern__base_8h_source.html#l00026">communication_pattern_base.h:26</a></div></div>
<div class="ttc" id="afe_2fe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea"><div class="ttname"><a href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a></div><div class="ttdeci">@ update_values</div><div class="ttdoc">Shape function values.</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__update__flags_8h_source.html#l00070">fe_update_flags.h:70</a></div></div>
<div class="ttc" id="aiterators__0_8txt_html_a6cf0880ba2af3a1be4aacdbbd4b90f9c"><div class="ttname"><a href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a></div><div class="ttdeci">where BaseIterator usually is one of thestandard iterators discussed above *The FilteredIterator gets an additional Predicate in its constructor and willskip all objects where this Predicate evaluates to&lt; tt &gt; false&lt;/tt &gt; Acollection of predicates already implemented can be found in the namespaceIteratorFilters ***IteratorsLoops Iterating over objects *All iterators of the same kind and iterating over thesame kind of geometrical objects traverse the mesh in the sameorder Take this code all iterators will always point to the same mesh even though&lt; tt &gt; DoFHandler&lt;/tt &gt; and&lt; tt &gt; Triangulation&lt;/tt &gt; are very different and even if the DoFHandlers are handling different finite the difference is only in the Accessor As mentioned the order in which iterators traverse the forest ofobjects is actually well but application programs should notassume any such but rather consider this an implementation detailof the library *Corresponding to above the order in which iterators traverse activeobjects is the same for all iterators in the following the difference to the previous example being that here we only consider active but theyare really rather dumb Their magic only lies in the fact that they point tosome useful in this case the Accessor For they point to anactual object that stores some data On the other the deal II when do not return a reference to an actual but returnan object that knows how to get at the data that represents cells In thisobject doesn t store itself where the vertices of a cell are or what its neighborsare it knows how to tease this sort of information from out of thearrays and tables and lists that the Triangulation class sets up to describe amesh *Accessing data that characterizes a cell is always done through the i e the expression[2.x.10] grants access to[1.x.6] attributes of this Accessor Examples of properties you can query from aniterator are ***Since dereferencing iterators yields accessor these calls are tomember etc These in turn figure out the relevant datafrom the various data structures that store this data How this is actuallydone and what data structures are used is not really of concern to authors ofapplications in deal II In by hiding the actual data structureswe are able to store data in an efficient not necessarily in a way thatmakes it easily accessible or understandable to application writers ***IteratorsTypedefs Kinds of accessors *Depending on what sort of data you want to there are different kindsof accessor and hexes that make up a triangulation</div><div class="ttdef"><b>Definition:</b> <a href="iterators__0_8txt_source.html#l00063">iterators_0.txt:63</a></div></div>
<div class="ttc" id="aclassAffineConstraints_html_aef97b22281acb10c914d79a3881e2735"><div class="ttname"><a href="classAffineConstraints.html#aef97b22281acb10c914d79a3881e2735">AffineConstraints::add_lines</a></div><div class="ttdeci">void add_lines(const std::vector&lt; bool &gt; &amp;lines)</div></div>
<div class="ttc" id="aclassMultigrid_html_af3c33c4008b7b0d13c69d097fda50630"><div class="ttname"><a href="classMultigrid.html#af3c33c4008b7b0d13c69d097fda50630">Multigrid::reinit</a></div><div class="ttdeci">void reinit(const unsigned int minlevel, const unsigned int maxlevel)</div></div>
<div class="ttc" id="aclassLinearAlgebra_1_1distributed_1_1Vector_html"><div class="ttname"><a href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2la__parallel__vector_8h_source.html#l00129">la_parallel_vector.h:129</a></div></div>
<div class="ttc" id="aclassStep66_1_1JacobianOperator_html_aaedf9c433341f7980f1145823681507f"><div class="ttname"><a href="classStep66_1_1JacobianOperator.html#aaedf9c433341f7980f1145823681507f">Step66::JacobianOperator::JacobianOperator</a></div><div class="ttdeci">JacobianOperator()</div><div class="ttdef"><b>Definition:</b> <a href="step-66_8cc_source.html#l00113">step-66.cc:113</a></div></div>
<div class="ttc" id="astep-1_8cc_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdef"><b>Definition:</b> <a href="step-1_8cc_source.html#l00086">step-1.cc:86</a></div></div>
<div class="ttc" id="anamespaceEvaluationFlags_html_a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04"><div class="ttname"><a href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a></div><div class="ttdeci">@ gradients</div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_2evaluation__flags_8h_source.html#l00060">evaluation_flags.h:60</a></div></div>
<div class="ttc" id="aclassMGConstrainedDoFs_html"><div class="ttname"><a href="classMGConstrainedDoFs.html">MGConstrainedDoFs</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_2mg__constrained__dofs_8h_source.html#l00049">mg_constrained_dofs.h:49</a></div></div>
<div class="ttc" id="aclassPreconditionChebyshev_html"><div class="ttname"><a href="classPreconditionChebyshev.html">PreconditionChebyshev</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2precondition_8h_source.html#l01035">precondition.h:1035</a></div></div>
<div class="ttc" id="amultithreading__0_8txt_html_a0759c0124e216ec36f063ad051f4dba0"><div class="ttname"><a href="multithreading__0_8txt.html#a0759c0124e216ec36f063ad051f4dba0">norm</a></div><div class="ttdeci">it should be big enough so that we don t spend more time on scheduling sub ranges to processors but small enough that processors can be efficiently load balanced A rule of thumb appears to be that a sub range is too small if it takes less than instructions to execute it *An example of how to use these functions are vector operations like the addition in[2.x.45] where all three objects are of type we used a[1.x.23] to on the a function object that takes two arguments and returns the sum of the two This is exactly what we needed when we want to add the individual elements of vectors[2.x.46] and[2.x.47] and write the sum of the two into the elements of[2.x.48] The function object that we get here is completely known to the compiler and when it expands the loop that results from[2.x.49] will be as if we had written the loop in its obvious thereby eliminating the overhead of calling an external function there are cases where it is inefficient to call some object or function within each iteration *An example for this case is sparse matrix vector multiplication If you know how data is stored in compressed row format like in the SparseMatrix then a matrix vector product function looks like we compute the dot product of a single row of the matrix with the right hand side vector[2.x.51] and write it into the corresponding element of the[2.x.52] vector The code is made more efficient by utilizing that the elements of the[1.x.28] row follow the ones of the current i e at the beginning of the loop body we do not have to re set the pointers that point to the values and column numbers of each row *Using the[2.x.53] function we could in principle write this code as leaving one argument open and thus allowing the[2.x.56] function to consider the passed function argument as unary Also note that we need to make the source and destination vectors neither of which is what we desired notice the grainsize of a minimum of rows of a matrix that should be processed by an individual CPU core *The point is that while this is it is not since now the function object to be called on each row is not a simple[1.x.32] any there is an implicit function call including argument passing in each iteration of the loop *A more efficient way is to let TBB split the original range into sub and then call a target function not on each individual element of the but on the entire range This is facilitated by the[2.x.61] we call the[2.x.62] function on sub ranges of at least elements so that the initial setup cost can amortize *A related operation is when the loops over elements each produce a result that must then be but let s assume for a moment that it is A sequential implementation would look like this for sparse each of which compute their part of the square of the norm</div><div class="ttdef"><b>Definition:</b> <a href="multithreading__0_8txt_source.html#l00124">multithreading_0.txt:124</a></div></div>
<div class="ttc" id="aclassTriangulation_html"><div class="ttname"><a href="classTriangulation.html">Triangulation</a></div><div class="ttdef"><b>Definition:</b> <a href="grid_2tria_8h_source.html#l01033">tria.h:1033</a></div></div>
<div class="ttc" id="agrid_2tria_8h_html"><div class="ttname"><a href="grid_2tria_8h.html">tria.h</a></div></div>
<div class="ttc" id="aclassDiagonalMatrix_html"><div class="ttname"><a href="classDiagonalMatrix.html">DiagonalMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2diagonal__matrix_8h_source.html#l00051">diagonal_matrix.h:51</a></div></div>
<div class="ttc" id="afe_2fe__q_8h_html"><div class="ttname"><a href="fe_2fe__q_8h.html">fe_q.h</a></div></div>
<div class="ttc" id="ampi__remote__point__evaluation__0_8txt_html_a45c57074a631760cdab557f450e880e0"><div class="ttname"><a href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a></div><div class="ttdeci">*Helper class to access values on non matching grids *The name of the fields are chosen with the method quantities are computed at specified arbitrary positioned which receive the result and resort the result according to the points **Constructor[2.x.1] tolerance Tolerance in terms of unit cell coordinates for determining all cells around a point passed to the class during it might be necessary to adjust the tolerance in order to be able to identify a cell Floating point arithmetic implies that a point in not lie exactly on a or face[2.x.2] enforce_unique_mapping Enforce unique mapping</div><div class="ttdef"><b>Definition:</b> <a href="mpi__remote__point__evaluation__0_8txt_source.html#l00005">mpi_remote_point_evaluation_0.txt:5</a></div></div>
<div class="ttc" id="aclassMGTransferMatrixFree_html_a90aef560cc3d832589ca13a5f18e1414"><div class="ttname"><a href="classMGTransferMatrixFree.html#a90aef560cc3d832589ca13a5f18e1414">MGTransferMatrixFree::interpolate_to_mg</a></div><div class="ttdeci">void interpolate_to_mg(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, MGLevelObject&lt; LinearAlgebra::distributed::Vector&lt; Number &gt;&gt; &amp;dst, const LinearAlgebra::distributed::Vector&lt; Number2 &gt; &amp;src) const</div></div>
<div class="ttc" id="aclassMappingQGeneric_html"><div class="ttname"><a href="classMappingQGeneric.html">MappingQGeneric&lt; dim &gt;</a></div></div>
<div class="ttc" id="anewton__0_8txt_html_a21f536f84dd77674667ed5d2a30eb3ab"><div class="ttname"><a href="newton__0_8txt.html#a21f536f84dd77674667ed5d2a30eb3ab">residual</a></div><div class="ttdeci">*Operator class performing Newton s iteration with standard step size control and adaptive matrix generation This class performs a Newton iteration up to convergence determined by control If after an update the norm of the residual has become larger then step size control is activated and the update is subsequently divided by two until the residual actually becomes depending on the tends to be this method applies an adaptive reassembling strategy Only if the reduction factor for the residual is more than receiving the applications computing the residual and solving the linear respectively **Declare the parameters applicable to Newton s method **Read the parameters in the ParameterHandler **Initialize the pointer data_out for debugging **The actual Newton iteration The initial value is in&lt; tt &gt; which also contains the result after convergence Values in&lt; tt &gt; in&lt;/tt &gt; are not used by but will be handed down to the objects **Set the maximal residual reduction allowed without triggering assembling in the next step Return the previous value **Control object for the Newton iteration **The indicating that the matrix must be assembled anew upon start **A flag used to decide how many stepsize iteration should be made Default is the original value of Enter zero here to turn off stepsize control *Controlled by&lt; tt &gt; Stepsize iterations&lt;/tt &gt; in parameter file **Threshold for re assembling matrix If the quotient of two consecutive residuals is smaller than this the system matrix is not assembled in this step *This parameter should be adjusted to the residual gain of the inner solver The default values is resulting in reassembling in every Newton step **Print residual</div><div class="ttdef"><b>Definition:</b> <a href="newton__0_8txt_source.html#l00032">newton_0.txt:32</a></div></div>
<div class="ttc" id="abase_2timer_8h_html"><div class="ttname"><a href="base_2timer_8h.html">timer.h</a></div></div>
<div class="ttc" id="aclassTimer_html_a988f79aa183d9d5473c13106f5babe48"><div class="ttname"><a href="classTimer.html#a988f79aa183d9d5473c13106f5babe48">Timer::stop</a></div><div class="ttdeci">double stop()</div><div class="ttdef"><b>Definition:</b> <a href="timer_8cc_source.html#l00194">timer.cc:194</a></div></div>
<div class="ttc" id="aconfig_8h_html_a32dc208a29f23d1f031fb40b0d21e60e"><div class="ttname"><a href="config_8h.html#a32dc208a29f23d1f031fb40b0d21e60e">DEAL_II_COMPILER_VECTORIZATION_LEVEL</a></div><div class="ttdeci">#define DEAL_II_COMPILER_VECTORIZATION_LEVEL</div><div class="ttdef"><b>Definition:</b> <a href="config_8h_source.html#l00133">config.h:133</a></div></div>
<div class="ttc" id="adistributed__0_8txt_html_aafea668ad0c451ac7a0fae0f558c36d7"><div class="ttname"><a href="distributed__0_8txt.html#aafea668ad0c451ac7a0fae0f558c36d7">cells</a></div><div class="ttdeci">in the area occupied by these artificial cells</div><div class="ttdef"><b>Definition:</b> <a href="distributed__0_8txt_source.html#l00037">distributed_0.txt:37</a></div></div>
<div class="ttc" id="anewton__0_8txt_html_a7ae4bec25ec0fbd4c3968d0926b5c7c6"><div class="ttname"><a href="newton__0_8txt.html#a7ae4bec25ec0fbd4c3968d0926b5c7c6">Newton</a></div><div class="ttdeci">*Operator class performing Newton s iteration with standard step size control and adaptive matrix generation This class performs a Newton iteration up to convergence determined by control If after an update the norm of the residual has become larger then step size control is activated and the update is subsequently divided by two until the residual actually becomes depending on the tends to be this method applies an adaptive reassembling strategy Only if the reduction factor for the residual is more than receiving the applications computing the residual and solving the linear respectively **Declare the parameters applicable to Newton s method **Read the parameters in the ParameterHandler **Initialize the pointer data_out for debugging **The actual Newton iteration The initial value is in&lt; tt &gt; which also contains the result after convergence Values in&lt; tt &gt; in&lt;/tt &gt; are not used by Newton</div><div class="ttdef"><b>Definition:</b> <a href="newton__0_8txt_source.html#l00012">newton_0.txt:12</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga72743302dcb1a0fb1f2f8dc5122d299e"><div class="ttname"><a href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">Patterns::Tools::to_string</a></div><div class="ttdeci">std::string to_string(const T &amp;t)</div><div class="ttdef"><b>Definition:</b> <a href="base_2patterns_8h_source.html#l02413">patterns.h:2413</a></div></div>
<div class="ttc" id="astructMatrixFree_1_1AdditionalData_html_aa5d597e6c4441d273f4100b6139a2552"><div class="ttname"><a href="structMatrixFree_1_1AdditionalData.html#aa5d597e6c4441d273f4100b6139a2552">MatrixFree::AdditionalData::mapping_update_flags</a></div><div class="ttdeci">UpdateFlags mapping_update_flags</div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_2matrix__free_8h_source.html#l00359">matrix_free.h:359</a></div></div>
<div class="ttc" id="anamespaceUtilities_1_1System_html_aff548b3b9b7a035ea112729700ef7c64"><div class="ttname"><a href="namespaceUtilities_1_1System.html#aff548b3b9b7a035ea112729700ef7c64">Utilities::System::get_date</a></div><div class="ttdeci">std::string get_date()</div><div class="ttdef"><b>Definition:</b> <a href="base_2utilities_8cc_source.html#l01035">utilities.cc:1035</a></div></div>
<div class="ttc" id="anamespaceVectorTools_html_a676190d2c897ac5da68a9c460fa95832"><div class="ttname"><a href="namespaceVectorTools.html#a676190d2c897ac5da68a9c460fa95832">VectorTools::integrate_difference</a></div><div class="ttdeci">void integrate_difference(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const InVector &amp;fe_function, const Function&lt; spacedim, typename InVector::value_type &gt; &amp;exact_solution, OutVector &amp;difference, const Quadrature&lt; dim &gt; &amp;q, const NormType &amp;norm, const Function&lt; spacedim, double &gt; *weight=nullptr, const double exponent=2.)</div></div>
<div class="ttc" id="aclassSphericalManifold_html"><div class="ttname"><a href="classSphericalManifold.html">SphericalManifold</a></div><div class="ttdef"><b>Definition:</b> <a href="grid_2manifold__lib_8h_source.html#l00214">manifold_lib.h:214</a></div></div>
<div class="ttc" id="anamespaceVectorTools_html_a21eb62d70953182dcc2b15c4e14dd533"><div class="ttname"><a href="namespaceVectorTools.html#a21eb62d70953182dcc2b15c4e14dd533">VectorTools::compute_global_error</a></div><div class="ttdeci">double compute_global_error(const Triangulation&lt; dim, spacedim &gt; &amp;tria, const InVector &amp;cellwise_error, const NormType &amp;norm, const double exponent=2.)</div></div>
<div class="ttc" id="aclassMatrixFree_html"><div class="ttname"><a href="classMatrixFree.html">MatrixFree&lt; dim, number &gt;</a></div></div>
<div class="ttc" id="afe_2mapping__q__generic_8h_html"><div class="ttname"><a href="fe_2mapping__q__generic_8h.html">mapping_q_generic.h</a></div></div>
<div class="ttc" id="aclassmg_1_1SmootherRelaxation_html"><div class="ttname"><a href="classmg_1_1SmootherRelaxation.html">mg::SmootherRelaxation</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_2mg__smoother_8h_source.html#l00194">mg_smoother.h:194</a></div></div>
<div class="ttc" id="anamespacemg_html"><div class="ttname"><a href="namespacemg.html">mg</a></div><div class="ttdef"><b>Definition:</b> <a href="doc_2doxygen_2headers_2mg_8h_source.html#l00064">mg.h:64</a></div></div>
<div class="ttc" id="aclassDataOutInterface_html_a0864e51eb173c87e2a3edc9391ea8009"><div class="ttname"><a href="classDataOutInterface.html#a0864e51eb173c87e2a3edc9391ea8009">DataOutInterface::write_vtu_with_pvtu_record</a></div><div class="ttdeci">std::string write_vtu_with_pvtu_record(const std::string &amp;directory, const std::string &amp;filename_without_extension, const unsigned int counter, const MPI_Comm &amp;mpi_communicator, const unsigned int n_digits_for_counter=numbers::invalid_unsigned_int, const unsigned int n_groups=0) const</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8cc_source.html#l07370">data_out_base.cc:7370</a></div></div>
<div class="ttc" id="alogstream__0_8txt_html_a9767aa0a3a9a2557fff9f4cf0eab48bb"><div class="ttname"><a href="logstream__0_8txt.html#a9767aa0a3a9a2557fff9f4cf0eab48bb">up</a></div><div class="ttdeci">&lt;/tt &gt; will be buffered thread locally until a[2.x.11] or[2.x.12] is which will trigger a writeout to the console if set up</div><div class="ttdef"><b>Definition:</b> <a href="logstream__0_8txt_source.html#l00005">logstream_0.txt:5</a></div></div>
<div class="ttc" id="alac_2affine__constraints_8h_html"><div class="ttname"><a href="lac_2affine__constraints_8h.html">affine_constraints.h</a></div></div>
<div class="ttc" id="aclassTransfiniteInterpolationManifold_html_a34326a35d9ec4b6911d90c85c21847d8"><div class="ttname"><a href="classTransfiniteInterpolationManifold.html#a34326a35d9ec4b6911d90c85c21847d8">TransfiniteInterpolationManifold::initialize</a></div><div class="ttdeci">void initialize(const Triangulation&lt; dim, spacedim &gt; &amp;triangulation)</div><div class="ttdef"><b>Definition:</b> <a href="grid_2manifold__lib_8cc_source.html#l01676">manifold_lib.cc:1676</a></div></div>
<div class="ttc" id="adistributed__0_8txt_html_ac2b339f054fd752a401e197097db8cfe"><div class="ttname"><a href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a></div><div class="ttdeci">********clusters ***deal II can use multiple machines connected via MPI to parallelize in addition to the parallelization within a shared memory machine discussed in the[2.x.4] module There are essentially two ways to utilize multiple but only a share of the global sparsity and solution vector is stored on each machine ****The mesh and DoF handler are also i e each processor stores only a share of the cells and degrees of freedom No processor has knowledge of the entire or solution</div><div class="ttdef"><b>Definition:</b> <a href="distributed__0_8txt_source.html#l00025">distributed_0.txt:25</a></div></div>
<div class="ttc" id="anamespaceStep66_html"><div class="ttname"><a href="namespaceStep66.html">Step66</a></div><div class="ttdef"><b>Definition:</b> <a href="step-66_8cc_source.html#l00067">step-66.cc:67</a></div></div>
<div class="ttc" id="aparameter__handler__0_8txt_html_ad919e2b915d8e8226aef004c2d8399a8"><div class="ttname"><a href="parameter__handler__0_8txt.html#ad919e2b915d8e8226aef004c2d8399a8">exception</a></div><div class="ttdeci">since default values may change in the process of program you cannot know the values of parameters not specified in the input file ****It is often convenient to have something happen as soon as a parameter value is read This could be a check that it is valid that a file that is listed in the parameter file exists **or to initiate something else in such as setting a variable outside the this action could also be initiated once all parameters are read via but it is sometimes[1.x.19] to do it right away *This is facilitated by the and can then do whatever they want with it **e save it somewhere outside the ParameterHandler in C one doesn t usually pass around the address of a but an action can be a function like object(taking a string as argument) that results from calling such as a[1.x.20] that has the form **[1.x.21] *and that is attached to a specific parameter. *A typical example of such an action would be as follows the content of the file equals the default value of the parameter the contents of files are never changed after declaration of a parameter a directory in this file system may not have a file called[2.x.20] in it In that the directory represents a subsection as declared and the directory s name will correspond to the name of the subsection It will then have no files in it at but it may have further directories in the code above will lead to a hierarchical representation of data that looks like this(the content of files is indicated at the right in a different font) this is only used when creating output for exceptions If non empty[2.x.35] is the ParameterHandler object will stop parsing lines after encountering[2.x.36] This is handy when adding extra data that shall be parsed manually If[2.x.37] the parameter handler will skip undefined sections and entries This is useful for partially parsing a parameter for example to obtain only the spatial dimension of the problem By default all entries and subsections are expected to be declared The function sets the value of all parameters it encounters in the input file to the provided value Parameters not explicitly listed in the input file are left at the value they previously which will be the default value provided to and for each parameter all associated actions that may previously have been set by or if an associated action throws an exception</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler__0_8txt_source.html#l00241">parameter_handler_0.txt:241</a></div></div>
<div class="ttc" id="aclassDataOut__DoFData_html_a6ed7c846331069f406b8c9933c37fda4"><div class="ttname"><a href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">DataOut_DoFData::attach_dof_handler</a></div><div class="ttdeci">void attach_dof_handler(const DoFHandler&lt; dim, spacedim &gt; &amp;)</div></div>
<div class="ttc" id="aclassMultigrid_html"><div class="ttname"><a href="classMultigrid.html">Multigrid</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_2multigrid_8h_source.html#l00154">multigrid.h:154</a></div></div>
<div class="ttc" id="anamespaceMatrixFreeOperators_html"><div class="ttname"><a href="namespaceMatrixFreeOperators.html">MatrixFreeOperators</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_2operators_8h_source.html#l00039">operators.h:39</a></div></div>
<div class="ttc" id="aclassDoFHandler_html"><div class="ttname"><a href="classDoFHandler.html">DoFHandler</a></div><div class="ttdef"><b>Definition:</b> <a href="dofs_2dof__handler_8h_source.html#l00266">dof_handler.h:266</a></div></div>
<div class="ttc" id="aA-headers_2exceptions__0_8txt_html_a8cc3d8e2210ca7ca38c1daa0e678229d"><div class="ttname"><a href="A-headers_2exceptions__0_8txt.html#a8cc3d8e2210ca7ca38c1daa0e678229d">release</a></div><div class="ttdeci">****This module contains classes that are used in the exception mechanism of deal II **Exceptions are used in two different not in release(or optimized, production) mode. In deal.II</div></div>
<div class="ttc" id="amg__0_8txt_html_a1f7a91126f3fe8004760adfc52fc5dbe"><div class="ttname"><a href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a></div><div class="ttdeci">which is a wrapper around Multigrid with the standard interface of deal II[2.x.9] Preconditioners PreconditionMG also uses the classes inheriting from for instance where it uses[2.x.10] and[2.x.11] which transfer between the global vector and the level vectors we have several auxiliary namely which stores an object on each level **See and[2.x.14] example programs on how to use this functionality **Using multigrid methods on adaptively refined meshes involves more infrastructure than with regular refinement in order to keep the complexity we need to decide how to do the smoothing on each level And to this we have to define what a level is in the sense of multilevel decomposition we define that a level in the multigrid sense is constituted by all cells of a certain level in the mesh hierarchy smoothing on a certain level is restricted to the subdomain which consists of cells of this level or finer This is usually referred to as smoothing The advantage of this definition that level matrices for the multigrid scheme can be assembled easily by traversing to all cells of a certain level</div><div class="ttdef"><b>Definition:</b> <a href="mg__0_8txt_source.html#l00014">mg_0.txt:14</a></div></div>
<div class="ttc" id="aclassTable_html"><div class="ttname"><a href="classTable.html">Table</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2array__view_8h_source.html#l00033">array_view.h:33</a></div></div>
<div class="ttc" id="aconstraints__0_8txt_html_a836d12b85657b83a8978aff8d7672c23"><div class="ttname"><a href="constraints__0_8txt.html#a836d12b85657b83a8978aff8d7672c23">hand</a></div><div class="ttdeci">****and the matrix is finally condensed *In the condensation we are not actually changing the number of rows or columns of the sparsity and vectors the condense functions add nonzero entries to the sparsity pattern of the rows and columns subject to constraints are distributed to the rows and columns of unconstrained nodes The constrained degrees of freedom remain in place In order not to disturb the solution these rows and columns are filled with zeros and an appropriate positive value on the main the constrained node will always get the value zero upon solution of the equation system and will not couple to other nodes any more *Keeping the entries in the matrix has the advantage over creating a new and smaller that only one matrix and sparsity pattern is needed thus less memory is required the condensation process is less since not all but only constrained values in the matrix have to be copied On the other hand</div><div class="ttdef"><b>Definition:</b> <a href="constraints__0_8txt_source.html#l00068">constraints_0.txt:68</a></div></div>
<div class="ttc" id="aclassDoFHandler_html_a553ca864aaf70330d9be86bc78f36d1e"><div class="ttname"><a href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">DoFHandler::distribute_dofs</a></div><div class="ttdeci">void distribute_dofs(const FiniteElement&lt; dim, spacedim &gt; &amp;fe)</div></div>
<div class="ttc" id="agroup__constraints_html_ga3b4ea7dfd313e388d868c4e4aa685799"><div class="ttname"><a href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a></div><div class="ttdeci">void make_hanging_node_constraints(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, AffineConstraints&lt; number &gt; &amp;constraints)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools__constraints_8cc_source.html#l01787">dof_tools_constraints.cc:1787</a></div></div>
<div class="ttc" id="aclassSolverControl_html_a42aeae81cd6b67ce93b5fbea3328371f"><div class="ttname"><a href="classSolverControl.html#a42aeae81cd6b67ce93b5fbea3328371f">SolverControl::last_step</a></div><div class="ttdeci">unsigned int last_step() const</div><div class="ttdef"><b>Definition:</b> <a href="solver__control_8cc_source.html#l00127">solver_control.cc:127</a></div></div>
<div class="ttc" id="aclassFEValues_html"><div class="ttname"><a href="classFEValues.html">FEValues&lt; dim &gt;</a></div></div>
<div class="ttc" id="afe_2fe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a"><div class="ttname"><a href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a></div><div class="ttdeci">@ update_quadrature_points</div><div class="ttdoc">Transformed quadrature points.</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__update__flags_8h_source.html#l00116">fe_update_flags.h:116</a></div></div>
<div class="ttc" id="aclassFiniteElementData_html_a2cbf5ad6b464871261dbd054bced18a8"><div class="ttname"><a href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">FiniteElementData::degree</a></div><div class="ttdeci">const unsigned int degree</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__base_8h_source.html#l00428">fe_base.h:428</a></div></div>
<div class="ttc" id="aclassTimer_html"><div class="ttname"><a href="classTimer.html">Timer</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2timer_8h_source.html#l00130">timer.h:130</a></div></div>
<div class="ttc" id="anumerics_2vector__tools_8h_html"><div class="ttname"><a href="numerics_2vector__tools_8h.html">vector_tools.h</a></div></div>
<div class="ttc" id="abase_2function_8h_html"><div class="ttname"><a href="base_2function_8h.html">function.h</a></div></div>
<div class="ttc" id="aautomatic__and__symbolic__differentiation__0_8txt_html_a16cf6888fefc575ea41503c862c8e66d"><div class="ttname"><a href="automatic__and__symbolic__differentiation__0_8txt.html#a16cf6888fefc575ea41503c862c8e66d">method</a></div><div class="ttdeci">******to automatic and symbolic differentiation *Below we provide a very brief introduction as to what automatic and symbolic differentiation what variations of these computational numerical schemes and how they are integrated within deal II s framework The purpose of all of these schemes is to automatically compute the derivative of or approximations of in cases where one does not want to compute them by hand Common examples are situations in the finite element context is where one wants to solve a nonlinear problem that is given by requiring that some residual[2.x.2] where[2.x.3] is a complicated function that needs to be differentiated to apply Newton s method</div><div class="ttdef"><b>Definition:</b> <a href="automatic__and__symbolic__differentiation__0_8txt_source.html#l00010">automatic_and_symbolic_differentiation_0.txt:10</a></div></div>
<div class="ttc" id="aclassTimerOutput_html"><div class="ttname"><a href="classTimerOutput.html">TimerOutput</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2timer_8h_source.html#l00591">timer.h:591</a></div></div>
<div class="ttc" id="abase_2vectorization_8h_html_a19f846bda83b7e3f4531daacb40c64e1"><div class="ttname"><a href="base_2vectorization_8h.html#a19f846bda83b7e3f4531daacb40c64e1">std::exp</a></div><div class="ttdeci">inline ::VectorizedArray&lt; Number, width &gt; exp(const ::VectorizedArray&lt; Number, width &gt; &amp;x)</div><div class="ttdef"><b>Definition:</b> <a href="base_2vectorization_8h_source.html#l05647">vectorization.h:5647</a></div></div>
<div class="ttc" id="amultithreading__0_8txt_html_a33468e75b7ea6d2e64b7e88c6ff1217a"><div class="ttname"><a href="multithreading__0_8txt.html#a33468e75b7ea6d2e64b7e88c6ff1217a">of</a></div><div class="ttdeci">namespace are implemented the way they are More information on their implementation can be found in the[2.x.72] WorkStream paper To see the WorkStream class used in practice on tasks like the ones outlined above take a look at or[2.x.78] tutorial programs *To begin given the brief description the way the[2.x.79] function could then be written is like this(note that this is not quite the correct syntax, as will be described below) we recycle these objects after they have been used by[2.x.101] and feed them back into another instance of[2.x.102]</div><div class="ttdef"><b>Definition:</b> <a href="multithreading__0_8txt_source.html#l00171">multithreading_0.txt:171</a></div></div>
<div class="ttc" id="ageometry__and__primitives__0_8txt_html_ad687a359ee2f71b8471c9a49cc8172ad"><div class="ttname"><a href="geometry__and__primitives__0_8txt.html#ad687a359ee2f71b8471c9a49cc8172ad">space</a></div><div class="ttdeci">as the Point class is derived from tensors of but in contrast to arbitrary tensors points have the special connotation of points in space</div><div class="ttdef"><b>Definition:</b> <a href="geometry__and__primitives__0_8txt_source.html#l00007">geometry_and_primitives_0.txt:7</a></div></div>
<div class="ttc" id="aclassTimer_html_a6f3e76707411b51e7d7e7bfa5755cf02"><div class="ttname"><a href="classTimer.html#a6f3e76707411b51e7d7e7bfa5755cf02">Timer::wall_time</a></div><div class="ttdeci">double wall_time() const</div><div class="ttdef"><b>Definition:</b> <a href="timer_8cc_source.html#l00264">timer.cc:264</a></div></div>
<div class="ttc" id="adof__renumbering__0_8txt_html_a68829910788b5388e9fb6e50b17c1876"><div class="ttname"><a href="dof__renumbering__0_8txt.html#a68829910788b5388e9fb6e50b17c1876">DoFs</a></div><div class="ttdeci">namespace compute new indices for each degree of freedom of a DoFHandler object and then call *[2.x.0] **Within this the Cuthill McKee algorithm is implemented It starts at a degree of searches the other DoFs for those which are coupled with the one we started with and numbers these in a certain way It then finds the second level of DoFs</div><div class="ttdef"><b>Definition:</b> <a href="dof__renumbering__0_8txt_source.html#l00006">dof_renumbering_0.txt:6</a></div></div>
<div class="ttc" id="aclassBlockVectorBase_html_ac718033fc083f27c45c6bfb4ac780360"><div class="ttname"><a href="classBlockVectorBase.html#ac718033fc083f27c45c6bfb4ac780360">BlockVectorBase::l2_norm</a></div><div class="ttdeci">real_type l2_norm() const</div></div>
<div class="ttc" id="aclassAffineConstraints_html_a373fbdacd8c486e675b8d2bff8943192"><div class="ttname"><a href="classAffineConstraints.html#a373fbdacd8c486e675b8d2bff8943192">AffineConstraints::distribute_local_to_global</a></div><div class="ttdeci">void distribute_local_to_global(const InVector &amp;local_vector, const std::vector&lt; size_type &gt; &amp;local_dof_indices, OutVector &amp;global_vector) const</div><div class="ttdef"><b>Definition:</b> <a href="lac_2affine__constraints_8h_source.html#l02250">affine_constraints.h:2250</a></div></div>
<div class="ttc" id="aconstraints__0_8txt_html_a5abc878123b65e2a7a16e57bba0e282e"><div class="ttname"><a href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a></div><div class="ttdeci">******This module deals with constraints on degrees of freedom The central class to deal with constraints is the AffineConstraints class *Constraints typically come from several for one usually enforces them by requiring that degrees of freedom on the boundary have particular for example[2.x.3] if the boundary condition[2.x.4] requires that the finite element solution[2.x.5] at the location of degree of freedom has the value Such constraints are generated by those versions of the[2.x.6] function that take a AffineConstraints for example no normal as happens in flow problems and is handled by the[2.x.11] function or prescribed tangential as happens in electromagnetic problems and is handled by the[2.x.13] function For the former imagine for example that we are at at vertex where the normal vector has the form[2.x.14] and that and[2.x.17] components of the flow field at this vertex are associated with degrees of and Then the no normal flux condition means that we need to have the condition[2.x.18] The prescribed tangential component leads to similar constraints though there is often something on the right hand side ****If you have hanging node constraints</div><div class="ttdef"><b>Definition:</b> <a href="constraints__0_8txt_source.html#l00020">constraints_0.txt:20</a></div></div>
<div class="ttc" id="astructMatrixFree_1_1AdditionalData_html"><div class="ttname"><a href="structMatrixFree_1_1AdditionalData.html">MatrixFree::AdditionalData</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_2matrix__free_8h_source.html#l00173">matrix_free.h:173</a></div></div>
<div class="ttc" id="aclassTransfiniteInterpolationManifold_html"><div class="ttname"><a href="classTransfiniteInterpolationManifold.html">TransfiniteInterpolationManifold</a></div><div class="ttdef"><b>Definition:</b> <a href="grid_2manifold__lib_8h_source.html#l00967">manifold_lib.h:967</a></div></div>
<div class="ttc" id="aclassMGTransferMatrixFree_html_a8f214ffade006cfa85e902a94902fc7b"><div class="ttname"><a href="classMGTransferMatrixFree.html#a8f214ffade006cfa85e902a94902fc7b">MGTransferMatrixFree::build</a></div><div class="ttdeci">void build(const DoFHandler&lt; dim, dim &gt; &amp;dof_handler, const std::vector&lt; std::shared_ptr&lt; const Utilities::MPI::Partitioner &gt;&gt; &amp;external_partitioners=std::vector&lt; std::shared_ptr&lt; const Utilities::MPI::Partitioner &gt;&gt;())</div><div class="ttdef"><b>Definition:</b> <a href="mg__transfer__matrix__free_8cc_source.html#l00097">mg_transfer_matrix_free.cc:97</a></div></div>
<div class="ttc" id="avector__tools__point__value__0_8txt_html_ac7a5c2ceb5c739d5b51cc7e0eee8100a"><div class="ttname"><a href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a></div><div class="ttdeci">*Assembling of right hand sides **Create a right hand side vector for a point source at point[2.x.1] In other it creates a vector[2.x.2] so that[2.x.3] where[2.x.4] are the shape functions described by[2.x.5] and[2.x.6] is the point at which the delta function is located Prior content of the given[2.x.7] vector is deleted This function is for the case of a scalar finite element This function is typically used in one of these two with different values for right hand sides or and then evaluate the solution at the same point every time You could do this by calling[2.x.8] after each solve</div><div class="ttdef"><b>Definition:</b> <a href="vector__tools__point__value__0_8txt_source.html#l00015">vector_tools_point_value_0.txt:15</a></div></div>
<div class="ttc" id="amatrix__free_2operators_8h_html"><div class="ttname"><a href="matrix__free_2operators_8h.html">operators.h</a></div></div>
<div class="ttc" id="anamespaceLinearAlgebraDealII_html_a2165565a5e6b6679392a7dee5d01ef58"><div class="ttname"><a href="namespaceLinearAlgebraDealII.html#a2165565a5e6b6679392a7dee5d01ef58">LinearAlgebraDealII::Vector</a></div><div class="ttdeci">Vector&lt; double &gt; Vector</div><div class="ttdef"><b>Definition:</b> <a href="lac_2generic__linear__algebra_8h_source.html#l00046">generic_linear_algebra.h:46</a></div></div>
<div class="ttc" id="ampi__noncontiguous__partitioner__0_8txt_html_a4ef446c02d3d4efe2972f5e7130db5d0"><div class="ttname"><a href="mpi__noncontiguous__partitioner__0_8txt.html#a4ef446c02d3d4efe2972f5e7130db5d0">update</a></div><div class="ttdeci">*A flexible Partitioner which does not impose restrictions regarding the order of the underlying index sets **Default constructor Requires calling one of the and which allows to access their raw data[2.x.9] The size of both vectors must be at least as large as the number of entries in the index sets passed to the constructors or the the user can provide the temporary data structures to be used[2.x.13] The size of the[2.x.14] vector has to be at least temporary_storage_size The reason for this is that this vector is used as buffer for both sending and receiving data *Any value less than is a valid value of *[2.x.16] *Start update</div><div class="ttdef"><b>Definition:</b> <a href="mpi__noncontiguous__partitioner__0_8txt_source.html#l00016">mpi_noncontiguous_partitioner_0.txt:16</a></div></div>
<div class="ttc" id="aclassTimer_html_a3a8b5272198d029779dc9302a54305a8"><div class="ttname"><a href="classTimer.html#a3a8b5272198d029779dc9302a54305a8">Timer::start</a></div><div class="ttdeci">void start()</div><div class="ttdef"><b>Definition:</b> <a href="timer_8cc_source.html#l00177">timer.cc:177</a></div></div>
<div class="ttc" id="aclassTensor_html"><div class="ttname"><a href="classTensor.html">Tensor&lt; 1, dim &gt;</a></div></div>
<div class="ttc" id="aindex__set__0_8txt_html_a85fb0893d080862c6fc2fbcb1e57a791"><div class="ttname"><a href="index__set__0_8txt.html#a85fb0893d080862c6fc2fbcb1e57a791">subdomain</a></div><div class="ttdeci">*A class that represents a subset of indices among a larger set For example it can be used to denote the set of degrees of freedom within the range[2.x.0] that belongs to a particular subdomain</div><div class="ttdef"><b>Definition:</b> <a href="index__set__0_8txt_source.html#l00002">index_set_0.txt:2</a></div></div>
<div class="ttc" id="aoperators__0_8txt_html_a92cb2920df95b6f107c2c9a8c75b788c"><div class="ttname"><a href="operators__0_8txt.html#a92cb2920df95b6f107c2c9a8c75b788c">apply_add</a></div><div class="ttdeci">*Abstract base class for matrix free operators which can be used both at the finest mesh or at a certain level in geometric multigrid A derived class has to implement apply_add() method as well as compute_diagonal() to initialize the protected member inverse_diagonal_entries and/or diagonal_entries. In case of a non-symmetric operator</div></div>
<div class="ttc" id="aclassDataOut_html_a087f63e22f0614bca326dbdca288c646"><div class="ttname"><a href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">DataOut::build_patches</a></div><div class="ttdeci">virtual void build_patches(const unsigned int n_subdivisions=0)</div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__out_8cc_source.html#l01071">data_out.cc:1071</a></div></div>
<div class="ttc" id="aclassmg_1_1Matrix_html"><div class="ttname"><a href="classmg_1_1Matrix.html">mg::Matrix</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_2mg__matrix_8h_source.html#l00045">mg_matrix.h:45</a></div></div>
<div class="ttc" id="amultigrid_2mg__smoother_8h_html"><div class="ttname"><a href="multigrid_2mg__smoother_8h.html">mg_smoother.h</a></div></div>
<div class="ttc" id="ageometry__info__0_8txt_html_a30a552b07accf65da90f851e25d14d1c"><div class="ttname"><a href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a></div><div class="ttdeci">3, where it offers following possibilities:a face(quad) being refined in x- or y-direction(in the face-intern coordinate system) separately,([2.x.79] or([2.x.80] which corresponds to([2.x.81]). Additionally, it offers the possibilities a face can have through repeated anisotropic refinement steps performed on one of the two neighboring cells. It might be possible for example, that a face(quad) is refined with[2.x.82] and afterwards the left child is again refined with[2.x.83], so that there are three active subfaces. Note, however, that only refinement cases are allowed such that each line on a face between two hexes has not more than one hanging node. Furthermore, it is not allowed that two neighboring hexes are refined such that one of the hexes refines the common face with[2.x.84] and the other hex refines that face with[2.x.85] . In fact,[2.x.86] takes care of this situation and ensures that each face of a refined cell is completely contained in a single face of neighboring cells. The following drawings explain the SubfacePossibilities and give the corresponding subface numbers:*[1.x.4] **[2.x.87] *[0.x.68] *Possible cases of faces being subdivided into subface. See documentation to the SubfacePossibilities&lt; 3 &gt; for more details on the subface possibilities. *[0.x.69] *A class that provides all possible cases a face(in the current space dimension[2.x.88] might be subdivided into subfaces. *[2.x.89] *[0.x.70] *Constructor. Take and store a value indicating a particular subface possibility in the list of possible situations specified in the base class. *[0.x.71] *Return the numeric value stored by this class. While the presence of this operator might seem dangerous, it is useful in cases where one would like to have code like&lt; code &gt;switch(subface_case)... case[2.x.90] ...&lt;/code &gt;, which can be written as&lt; code &gt;switch[2.x.91] Another application is to use an object of the current type as an index into an array dim</div><div class="ttdef"><b>Definition:</b> <a href="geometry__info__0_8txt_source.html#l00202">geometry_info_0.txt:202</a></div></div>
<div class="ttc" id="aclassVectorizedArrayBase_html_acb35404acc1693aee6e990228924cc09"><div class="ttname"><a href="classVectorizedArrayBase.html#acb35404acc1693aee6e990228924cc09">VectorizedArrayBase&lt; VectorizedArray&lt; Number, width &gt;, 1 &gt;::size</a></div><div class="ttdeci">static constexpr std::size_t size()</div><div class="ttdef"><b>Definition:</b> <a href="base_2vectorization_8h_source.html#l00272">vectorization.h:272</a></div></div>
<div class="ttc" id="aclassparallel_1_1distributed_1_1Triangulation_html"><div class="ttname"><a href="classparallel_1_1distributed_1_1Triangulation.html">parallel::distributed::Triangulation&lt; dim &gt;</a></div></div>
<div class="ttc" id="aA-headers_2exceptions__0_8txt_html_af85863b31be0cbd660acba99051e0634"><div class="ttname"><a href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a></div><div class="ttdeci">****This module contains classes that are used in the exception mechanism of deal II **Exceptions are used in two different not in static assertions are typically used to check that parameters to functions satisfy certain that internal data structures are and similar assertions For static assertions are used to make sure that two vectors that are added together have the same number of components **everything else would not make any sense anyway *Such checks are performed by the[2.x.3] macro in several thousand places within the library several tutorial programs starting with[2.x.4] show how to do this *If static a assertion is the exception mechanism generates an exception of a type that indicates what exactly goes wrong displays appropriate information including the exact location where the problem was detected and then aborts the program **if you try to add two vectors of different there is nothing that can be done within the program to cope with the you have to go fix the program code instead There is generally not even a reason to[2.x.5] an exception object using the usual C exception mechanism because there is nothing a function higher up could do in such cases to rectify the situation and deal with it in a useful way **it s not that the program received bad data</div><div class="ttdef"><b>Definition:</b> <a href="A-headers_2exceptions__0_8txt_source.html#l00015">exceptions_0.txt:15</a></div></div>
<div class="ttc" id="anamespaceVectorTools_html_ab2562d41bb26f362043f9719a8cd9b87"><div class="ttname"><a href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a></div><div class="ttdeci">void interpolate_boundary_values(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const std::map&lt; types::boundary_id, const Function&lt; spacedim, number &gt; * &gt; &amp;function_map, std::map&lt; types::global_dof_index, number &gt; &amp;boundary_values, const ComponentMask &amp;component_mask=ComponentMask())</div></div>
<div class="ttc" id="agroup__Exceptions_html_ga9442b63275c9ef3fab29bc222831c49c"><div class="ttname"><a href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a></div><div class="ttdeci">#define AssertDimension(dim1, dim2)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2exceptions_8h_source.html#l01749">exceptions.h:1749</a></div></div>
<div class="ttc" id="aautomatic__and__symbolic__differentiation__0_8txt_html_ac5d1c63883bb2a85710935e76a7dedd4"><div class="ttname"><a href="automatic__and__symbolic__differentiation__0_8txt.html#ac5d1c63883bb2a85710935e76a7dedd4">it</a></div><div class="ttdeci">******to automatic and symbolic differentiation *Below we provide a very brief introduction as to what automatic and symbolic differentiation what variations of these computational numerical schemes and how they are integrated within deal II s framework The purpose of all of these schemes is to automatically compute the derivative of or approximations of it</div><div class="ttdef"><b>Definition:</b> <a href="automatic__and__symbolic__differentiation__0_8txt_source.html#l00010">automatic_and_symbolic_differentiation_0.txt:10</a></div></div>
<div class="ttc" id="aclassMGCoarseGridApplySmoother_html_a499c7364e40031332e9943a2e5f331a2"><div class="ttname"><a href="classMGCoarseGridApplySmoother.html#a499c7364e40031332e9943a2e5f331a2">MGCoarseGridApplySmoother::initialize</a></div><div class="ttdeci">void initialize(const MGSmootherBase&lt; VectorType &gt; &amp;coarse_smooth)</div></div>
<div class="ttc" id="agroup__Exceptions_html_ga7ad65742b9dbfb7eeb04b511b5a08d63a3c83e26f202f837328b9f7532773be70"><div class="ttname"><a href="group__Exceptions.html#ga7ad65742b9dbfb7eeb04b511b5a08d63a3c83e26f202f837328b9f7532773be70">DataOutBase::VtkFlags::best_speed</a></div><div class="ttdeci">@ best_speed</div><div class="ttdef"><b>Definition:</b> <a href="base_2data__out__base_8h_source.html#l01113">data_out_base.h:1113</a></div></div>
<div class="ttc" id="anamespaceStep20_1_1PrescribedSolution_html_a6142e18d25af27882714d1787af4ee59"><div class="ttname"><a href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">Step20::PrescribedSolution::alpha</a></div><div class="ttdeci">constexpr double alpha</div><div class="ttdef"><b>Definition:</b> <a href="step-20_8cc_source.html#l00087">step-20.cc:87</a></div></div>
<div class="ttc" id="adofs_2dof__tools_8h_html"><div class="ttname"><a href="dofs_2dof__tools_8h.html">dof_tools.h</a></div></div>
<div class="ttc" id="afe_2fe__0_8txt_html_a754f79d53a1f0ebfe04ff6b9ff4abb8a"><div class="ttname"><a href="fe_2fe__0_8txt.html#a754f79d53a1f0ebfe04ff6b9ff4abb8a">compute</a></div><div class="ttdeci">we cannot already compute the gradients on a concrete cell at the time the current function is but we can at least pre compute the gradients on the reference and store it in the object returned An extensive discussion of the interaction between this function and FEValues can be found in the[2.x.376] documentation module See also the documentation of the InternalDataBase class[2.x.377] update_flags A set of UpdateFlags values that describe what kind of information the FEValues object requests the finite element to compute This set of flags may also include information that the finite element can not compute</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__0_8txt_source.html#l00547">fe_0.txt:547</a></div></div>
<div class="ttc" id="astep-2_8cc_html_ab108b7b7bca84a81aceda045aaef1961"><div class="ttname"><a href="step-2_8cc.html#ab108b7b7bca84a81aceda045aaef1961">make_grid</a></div><div class="ttdeci">void make_grid(Triangulation&lt; 2 &gt; &amp;triangulation)</div><div class="ttdef"><b>Definition:</b> <a href="step-2_8cc_source.html#l00038">step-2.cc:38</a></div></div>
<div class="ttc" id="alac_2precondition_8h_html"><div class="ttname"><a href="lac_2precondition_8h.html">precondition.h</a></div></div>
<div class="ttc" id="agrid_2grid__out_8h_html"><div class="ttname"><a href="grid_2grid__out_8h.html">grid_out.h</a></div></div>
<div class="ttc" id="avector__valued__0_8txt_html_add141cdc4d28d06d71948acb7f0c7150"><div class="ttname"><a href="vector__valued__0_8txt.html#add141cdc4d28d06d71948acb7f0c7150">s</a></div><div class="ttdeci">each of these vectors has[2.x.174] elements containing the values of the[2.x.175] velocities and the one pressure at a quadrature point *We can use these values to then construct other things like residuals the construct is a bit awkward we have a[2.x.176] s</div><div class="ttdef"><b>Definition:</b> <a href="vector__valued__0_8txt_source.html#l00155">vector_valued_0.txt:155</a></div></div>
<div class="ttc" id="aadvection__0_8txt_html_a79a3cbbb7583dd309bf1b14dc20895b6"><div class="ttname"><a href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a></div><div class="ttdeci">**its DG formulations All advection operators depend on an advection velocity denoted by[1.x.0] in the formulas below It is denoted as&lt; tt &gt; velocity&lt;/tt &gt; in the parameter lists The functions cell_matrix() and both upwind_value_matrix() are taking the equation in weak form</div></div>
<div class="ttc" id="aclassAffineConstraints_html_a2c9d71b5b7e8851c25a411ccf34de986"><div class="ttname"><a href="classAffineConstraints.html#a2c9d71b5b7e8851c25a411ccf34de986">AffineConstraints::reinit</a></div><div class="ttdeci">void reinit(const IndexSet &amp;local_constraints=IndexSet())</div></div>
<div class="ttc" id="astructDataOutBase_1_1VtkFlags_html"><div class="ttname"><a href="structDataOutBase_1_1VtkFlags.html">DataOutBase::VtkFlags</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2data__out__base_8h_source.html#l01065">data_out_base.h:1065</a></div></div>
<div class="ttc" id="adistributed__0_8txt_html_ad7a526c3d1317369fada16d420fcb06c"><div class="ttname"><a href="distributed__0_8txt.html#ad7a526c3d1317369fada16d420fcb06c">distributed</a></div><div class="ttdeci">********clusters ***deal II can use multiple machines connected via MPI to parallelize in addition to the parallelization within a shared memory machine discussed in the[2.x.4] module There are essentially two ways to utilize multiple but only a share of the global sparsity and solution vector is stored on each machine ****The mesh and DoF handler are also distributed</div><div class="ttdef"><b>Definition:</b> <a href="distributed__0_8txt_source.html#l00025">distributed_0.txt:25</a></div></div>
<div class="ttc" id="aclassQGauss_html"><div class="ttname"><a href="classQGauss.html">QGauss</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2quadrature__lib_8h_source.html#l00039">quadrature_lib.h:39</a></div></div>
<div class="ttc" id="abase_2quadrature__lib_8h_html"><div class="ttname"><a href="base_2quadrature__lib_8h.html">quadrature_lib.h</a></div></div>
<div class="ttc" id="aautomatic__and__symbolic__differentiation__0_8txt_html_a96ecfde131843f52ee49d0e0c1180134"><div class="ttname"><a href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a></div><div class="ttdeci">computing derivatives of these terms is impractical in most applications in impossible to get right Higher derivatives are even more impossible to do without computer aid Automatic or symbolic differentiation is a way out of and gets compile time</div><div class="ttdef"><b>Definition:</b> <a href="automatic__and__symbolic__differentiation__0_8txt_source.html#l00012">automatic_and_symbolic_differentiation_0.txt:12</a></div></div>
<div class="ttc" id="anamespaceEvaluationFlags_html_a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f"><div class="ttname"><a href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a></div><div class="ttdeci">@ values</div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_2evaluation__flags_8h_source.html#l00055">evaluation_flags.h:55</a></div></div>
<div class="ttc" id="agrid_2manifold__lib_8h_html"><div class="ttname"><a href="grid_2manifold__lib_8h.html">manifold_lib.h</a></div></div>
<div class="ttc" id="aclassMGLevelObject_html_a16213121f9153bd08f49652a11886259"><div class="ttname"><a href="classMGLevelObject.html#a16213121f9153bd08f49652a11886259">MGLevelObject::resize</a></div><div class="ttdeci">void resize(const unsigned int new_minlevel, const unsigned int new_maxlevel, Args &amp;&amp;... args)</div><div class="ttdef"><b>Definition:</b> <a href="base_2mg__level__object_8h_source.html#l00225">mg_level_object.h:225</a></div></div>
<div class="ttc" id="agrid_2tria__accessor_8h_html"><div class="ttname"><a href="grid_2tria__accessor_8h.html">tria_accessor.h</a></div></div>
<div class="ttc" id="anamespaceGridGenerator_html_a533c4778cbc9bcbed365dcab42ca4418"><div class="ttname"><a href="namespaceGridGenerator.html#a533c4778cbc9bcbed365dcab42ca4418">GridGenerator::hyper_ball</a></div><div class="ttdeci">void hyper_ball(Triangulation&lt; dim &gt; &amp;tria, const Point&lt; dim &gt; &amp;center=Point&lt; dim &gt;(), const double radius=1., const bool attach_spherical_manifold_on_boundary_cells=false)</div></div>
<div class="ttc" id="amultigrid_2mg__tools_8h_html"><div class="ttname"><a href="multigrid_2mg__tools_8h.html">mg_tools.h</a></div></div>
<div class="ttc" id="afe__evaluation__0_8txt_html_a8f384576a64c89a6fa8352847523e340"><div class="ttname"><a href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a></div><div class="ttdeci">FE_Q with hanging node constraints connects to more neighbors than a FE_DGQ for and cells which need data exchange are put in different positions inside the cell loop Of if the exact same and then the order is going to be the same because the algorithm is deterministic *dim Dimension in which this class is to be used *fe_degree Degree of the tensor product finite element with fe_degree degrees of freedom per coordinate direction Can be set to **if the degree is not known at compile but performance will usually be worse by a factor of *n_q_points_1d Number of points in the quadrature formula defaults to fe_degree *n_components Number of vector components when solving a system of PDEs If the same operation is applied to several components of a they can be applied simultaneously with one usually[2.x.339] or[2.x.340] Defaults to[2.x.341] double ******An alias to the base class **An underlying number type specified as template argument **The type of function e g VectorizedArrayType for e g Tensor&lt; 1, dim, VectorizedArrayType &gt; for n_q_points</div><div class="ttdef"><b>Definition:</b> <a href="fe__evaluation__0_8txt_source.html#l00537">fe_evaluation_0.txt:537</a></div></div>
<div class="ttc" id="adistributed__0_8txt_html_ac4c845555bda24566ddc584532b7fa57"><div class="ttname"><a href="distributed__0_8txt.html#ac4c845555bda24566ddc584532b7fa57">element</a></div><div class="ttdeci">see C J T ***The DoFHandler class builds on the Triangulation class but it can detect whenever we actually use an object of type[2.x.22] as triangulation In that it assigns global numbers for all degrees of freedom that given a finite element</div><div class="ttdef"><b>Definition:</b> <a href="distributed__0_8txt_source.html#l00046">distributed_0.txt:46</a></div></div>
<div class="ttc" id="aclassAffineConstraints_html"><div class="ttname"><a href="classAffineConstraints.html">AffineConstraints&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassAffineConstraints_html_a7b3d3f295bb56d6cd6856bdc6cbe8a01"><div class="ttname"><a href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">AffineConstraints::distribute</a></div><div class="ttdeci">void distribute(VectorType &amp;vec) const</div></div>
<div class="ttc" id="ahp__0_8txt_html_a68ab73a4ec065be1fdac93979ba49f51"><div class="ttname"><a href="hp__0_8txt.html#a68ab73a4ec065be1fdac93979ba49f51">used</a></div><div class="ttdeci">namespace implements the algorithms and data structures used for the hp framework in deal II An overview over the details of how these algorithms work and what data structures are used is given in the[2.x.3] hp paper ******In the implementation of the hp finite element each cell might have a different finite element associated with it To handle the[2.x.5] must have a whole set of finite element classes associated with it This concept is represented by the[2.x.6] we then only store an index for each cell that identifies the finite element object within the collection that should be used by this cell The DoFHandler object associated with the given cell can then assign degrees of freedom to each cell in accordance with the finite element used for it *A similar situation arises when integrating terms on a on cells where we use a Q1 a but on another cell where a Q3 element is used</div><div class="ttdef"><b>Definition:</b> <a href="hp__0_8txt_source.html#l00016">hp_0.txt:16</a></div></div>
<div class="ttc" id="aclassAffineConstraints_html_addd15bc409c61d6f795f0132c574335b"><div class="ttname"><a href="classAffineConstraints.html#addd15bc409c61d6f795f0132c574335b">AffineConstraints::clear</a></div><div class="ttdeci">void clear()</div></div>
<div class="ttc" id="asimple__0_8txt_html_a992b60343e16bcad1a2121a36857f2b6"><div class="ttname"><a href="simple__0_8txt.html#a992b60343e16bcad1a2121a36857f2b6">assemble</a></div><div class="ttdeci">The header containing the classes[2.x.0][2.x.1][2.x.2] and *[2.x.3] **Assemble residuals without block structure The data structure for this Assembler class is a simple vector on each cell with entries from zero to[2.x.4] and a simple global vector with entries numbered from zero to[2.x.5] No BlockInfo is required and the global vector may be any type of vector having element access through&lt; tt &gt; or else to an interior or boundary face **Assemble the residuals into the global residuals Values are added to the previous contents If constraints are is used **Assemble both residuals into the global residuals **The global residual vectors filled by assemble(). *[0.x.8] *A pointer to the object containing const raints. *[0.x.9] *Assemble local matrices into a single global matrix or several global matrices associated with the same DoFHandler. If these global matrix have a block structure</div></div>
<div class="ttc" id="afe_2fe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85"><div class="ttname"><a href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a></div><div class="ttdeci">@ update_JxW_values</div><div class="ttdoc">Transformed quadrature weights.</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__update__flags_8h_source.html#l00124">fe_update_flags.h:124</a></div></div>
<div class="ttc" id="amultigrid_2mg__matrix_8h_html"><div class="ttname"><a href="multigrid_2mg__matrix_8h.html">mg_matrix.h</a></div></div>
<div class="ttc" id="aclassTimer_html_a4e3933a78790d7455daff5acab3f8432"><div class="ttname"><a href="classTimer.html#a4e3933a78790d7455daff5acab3f8432">Timer::cpu_time</a></div><div class="ttdeci">double cpu_time() const</div><div class="ttdef"><b>Definition:</b> <a href="timer_8cc_source.html#l00236">timer.cc:236</a></div></div>
<div class="ttc" id="aclassPreconditionMG_html"><div class="ttname"><a href="classPreconditionMG.html">PreconditionMG</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_2multigrid_8h_source.html#l00492">multigrid.h:492</a></div></div>
<div class="ttc" id="anamespaceUtilities_1_1MPI_html_a895dcd8223a0ee6f0e6a80b80e2d5982"><div class="ttname"><a href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">Utilities::MPI::this_mpi_process</a></div><div class="ttdeci">unsigned int this_mpi_process(const MPI_Comm &amp;mpi_communicator)</div><div class="ttdef"><b>Definition:</b> <a href="mpi_8cc_source.html#l00128">mpi.cc:128</a></div></div>
<div class="ttc" id="amatrix__free_2matrix__free_8h_html"><div class="ttname"><a href="matrix__free_2matrix__free_8h.html">matrix_free.h</a></div></div>
<div class="ttc" id="alac_2solver__cg_8h_html"><div class="ttname"><a href="lac_2solver__cg_8h.html">solver_cg.h</a></div></div>
<div class="ttc" id="aclassMGLevelObject_html"><div class="ttname"><a href="classMGLevelObject.html">MGLevelObject</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2mg__level__object_8h_source.html#l00051">mg_level_object.h:51</a></div></div>
<div class="ttc" id="atable__0_8txt_html_a7f24305532768edc889062eefd4b28cf"><div class="ttname"><a href="table__0_8txt.html#a7f24305532768edc889062eefd4b28cf">clear</a></div><div class="ttdeci">examples are data tables that are loaded at start up time and then used over the course of the run time of the program In such the start up cost of running this function can be amortized over and the potential memory savings from not having to store the table on each process may be substantial on machines with large core counts on which many MPI processes run on the same machine *This function only makes sense if the data type T is self i all of its information is stored in its member and if none of the member variables are pointers to other parts of the memory This is because if a type T does have pointers to other parts of then moving T into a shared memory space does not result in the other processes having access to data that the object points to with its member variable and are typically in memory areas not accessible to the other processes As a the usual use case for this function is to share arrays of simple objects such as double s or int s *After calling this objects on different MPI processes share a common state That means that certain operations become i they must be called on all participating processors at the same time In you can no longer call or clear() on one MPI process **- you have to do so on all processes at the same time</div></div>
<div class="ttc" id="agroup__Exceptions_html_gaa3cbced9f1d4ae661f13018f4c980aa1a9e60516f3a44e6d7cd4ac533f6bc0209"><div class="ttname"><a href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1a9e60516f3a44e6d7cd4ac533f6bc0209">DataOutBase::dx</a></div><div class="ttdeci">@ dx</div><div class="ttdef"><b>Definition:</b> <a href="base_2data__out__base_8h_source.html#l01574">data_out_base.h:1574</a></div></div>
<div class="ttc" id="aupdate__flags__0_8txt_html_a401b2012c153de7bc4c63a89c334e118"><div class="ttname"><a href="update__flags__0_8txt.html#a401b2012c153de7bc4c63a89c334e118">side</a></div><div class="ttdeci">*****In order to compute contributions of an individual cell to the global matrix and right hand side</div><div class="ttdef"><b>Definition:</b> <a href="update__flags__0_8txt_source.html#l00007">update_flags_0.txt:7</a></div></div>
<div class="ttc" id="astructMatrixFree_1_1AdditionalData_html_a0bcce2facca91b925d3e1a5a00c7704b"><div class="ttname"><a href="structMatrixFree_1_1AdditionalData.html#a0bcce2facca91b925d3e1a5a00c7704b">MatrixFree::AdditionalData::tasks_parallel_scheme</a></div><div class="ttdeci">TasksParallelScheme tasks_parallel_scheme</div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_2matrix__free_8h_source.html#l00333">matrix_free.h:333</a></div></div>
<div class="ttc" id="adofs_2dof__handler_8h_html"><div class="ttname"><a href="dofs_2dof__handler_8h.html">dof_handler.h</a></div></div>
<div class="ttc" id="aupdate__flags__0_8txt_html_ac8b7167f13d273c0000a680958db42c5"><div class="ttname"><a href="update__flags__0_8txt.html#ac8b7167f13d273c0000a680958db42c5">flags</a></div><div class="ttdeci">this property does not hold for the shape functions of Raviart Thomas which must be rotated with the cell This allows further optimization of the computations underlying assembly ***Let s say you want to compute the Laplace matrix as shown above In that you need to specify the[2.x.20] the finite element requires the computation of the inverse of the full Jacobian and not just the determinant of the and to compute the inverse of the it is also necessary to compute the Jacobian matrix first *Since these are requirements that are not important to the it is not necessary to specify this in user code given a set of update flags</div><div class="ttdef"><b>Definition:</b> <a href="update__flags__0_8txt_source.html#l00026">update_flags_0.txt:26</a></div></div>
<div class="ttc" id="anamespaceUtilities_1_1MPI_html_ac26de0c059200523177bb1d92cc25d00"><div class="ttname"><a href="namespaceUtilities_1_1MPI.html#ac26de0c059200523177bb1d92cc25d00">Utilities::MPI::n_mpi_processes</a></div><div class="ttdeci">unsigned int n_mpi_processes(const MPI_Comm &amp;mpi_communicator)</div><div class="ttdef"><b>Definition:</b> <a href="mpi_8cc_source.html#l00117">mpi.cc:117</a></div></div>
<div class="ttc" id="abase_2vectorization_8h_html"><div class="ttname"><a href="base_2vectorization_8h.html">vectorization.h</a></div></div>
<div class="ttc" id="aiterators__0_8txt_html_a6365596c7d2490c474cd0b7ce9722b37"><div class="ttname"><a href="iterators__0_8txt.html#a6365596c7d2490c474cd0b7ce9722b37">calls</a></div><div class="ttdeci">it does so for both DoFHandler and[2.x.14] objects Note that the DoFAccessor class is derived from either TriaAccessor or the DoFAccessor class comes in two flavors one accessing degrees of freedom on the level of a cell and the other accessing the active dofs of an active cell **The DoFCellAccessor class has the same purpose and relation to DoFCellAccessor as the CellAccessor has to TriaAccessor *Except to look up member you will not usually have to deal withthe actual class names listed above Rather one uses the typedefs provided bythe mesh classes Triangulation DoFHandler and[2.x.15] as wellas the function that generate such buta hexahedron there are corresponding types and calls like[2.x.34] that act on thedimension independent geometric objects and hex These calls</div><div class="ttdef"><b>Definition:</b> <a href="iterators__0_8txt_source.html#l00076">iterators_0.txt:76</a></div></div>
<div class="ttc" id="amatrix__free_2fe__evaluation_8h_html"><div class="ttname"><a href="matrix__free_2fe__evaluation_8h.html">fe_evaluation.h</a></div></div>
<div class="ttc" id="aclassConditionalOStream_html"><div class="ttname"><a href="classConditionalOStream.html">ConditionalOStream</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2conditional__ostream_8h_source.html#l00083">conditional_ostream.h:83</a></div></div>
<div class="ttc" id="anamespacenumbers_html_a8ae36952c7e0cc778b47b5371b3aeff1"><div class="ttname"><a href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a></div><div class="ttdeci">static const unsigned int invalid_unsigned_int</div><div class="ttdef"><b>Definition:</b> <a href="base_2types_8h_source.html#l00179">types.h:179</a></div></div>
<div class="ttc" id="ascalapack__0_8txt_html_ac82ea4a38e10783662981895e0a99f43"><div class="ttname"><a href="scalapack__0_8txt.html#ac82ea4a38e10783662981895e0a99f43">processes</a></div><div class="ttdeci">*A wrapper class around ScaLAPACK parallel dense linear algebra *ScaLAPACK assumes that matrices are distributed according to the block cyclic decomposition scheme An[2.x.0] by[2.x.1] matrix is first decomposed into[2.x.2] by[2.x.3] blocks which are then uniformly distributed across the process grid with[2.x.4] processes</div><div class="ttdef"><b>Definition:</b> <a href="scalapack__0_8txt_source.html#l00002">scalapack_0.txt:2</a></div></div>
<div class="ttc" id="astep-69_8cc_html_a66a64d07b4db87c87b639bdcf7b18c82"><div class="ttname"><a href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a></div><div class="ttdeci">std::vector&lt; types::global_dof_index &gt; local_dof_indices</div><div class="ttdef"><b>Definition:</b> <a href="step-69_8cc_source.html#l00534">step-69.cc:534</a></div></div>
<div class="ttc" id="alac_2vector_8h_html"><div class="ttname"><a href="lac_2vector_8h.html">vector.h</a></div></div>
<div class="ttc" id="adofs_2dof__accessor_8h_html"><div class="ttname"><a href="dofs_2dof__accessor_8h.html">dof_accessor.h</a></div></div>
<div class="ttc" id="anamespaceUtilities_1_1System_html_ade631a789101336840371e3b2e2851e0"><div class="ttname"><a href="namespaceUtilities_1_1System.html#ade631a789101336840371e3b2e2851e0">Utilities::System::get_current_vectorization_level</a></div><div class="ttdeci">const std::string get_current_vectorization_level()</div><div class="ttdef"><b>Definition:</b> <a href="base_2utilities_8cc_source.html#l00944">utilities.cc:944</a></div></div>
<div class="ttc" id="aclassFunctions_1_1ZeroFunction_html"><div class="ttname"><a href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2function_8h_source.html#l00516">function.h:516</a></div></div>
<div class="ttc" id="atimer__0_8txt_html_a48e9e3a8116df3cc4b62db810904e91f"><div class="ttname"><a href="timer__0_8txt.html#a48e9e3a8116df3cc4b62db810904e91f">start</a></div><div class="ttdeci">*A compatible with the[2.x.0] notion of a whose by in multiples of of a second and POSIX uses so go with microseconds for uniformity **Signed integral type used to store the value returned by this requires platform specific so this function returns on platforms that are neither Windows nor POSIX **The Timer class provides a way to measure both the amount of wall or[2.x.1] as well as the total time elapsed over all laps Here is an you can also restart the timer instead of resetting it The times between successive calls to start() and stop()(i.e.</div></div>
<div class="ttc" id="afe__evaluation__0_8txt_html_ad3b9cdeadeb3bcdb52af5db70c041a6e"><div class="ttname"><a href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a></div><div class="ttdeci">FE_Q with hanging node constraints connects to more neighbors than a FE_DGQ for and cells which need data exchange are put in different positions inside the cell loop Of if the exact same and then the order is going to be the same because the algorithm is deterministic *dim Dimension in which this class is to be used *fe_degree Degree of the tensor product finite element with fe_degree degrees of freedom per coordinate direction Can be set to **if the degree is not known at compile but performance will usually be worse by a factor of *n_q_points_1d Number of points in the quadrature formula defaults to fe_degree *n_components Number of vector components when solving a system of PDEs If the same operation is applied to several components of a they can be applied simultaneously with one usually[2.x.339] or[2.x.340] Defaults to[2.x.341] double ******An alias to the base class **An underlying number type specified as template argument **The type of function e g VectorizedArrayType for e g Tensor&lt; 1, dim, VectorizedArrayType &gt; for can be different if such as FE_DGP **static The number of degrees of freedom of all components determined from the given template argument fe_degree Note that the actual number of degrees of freedom dofs_per_cell can be different if such as FE_DGP **static The number of degrees of freedom of all components determined from the given template argument fe_degree Note that the actual number of degrees of freedom dofs_per_cell can be different if such as FE_DGP **Constructor Takes all data stored in MatrixFree If applied to problems with more than one finite element or more than one quadrature formula selected during construction of[2.x.343] the appropriate component can be selected by the optional arguments[2.x.344] matrix_free Data object that contains all data[2.x.345] dof_no If matrix_free was set up with multiple DoFHandler this parameter selects to which DoFHandler AffineConstraints pair the given evaluator should be attached to[2.x.346] quad_no If matrix_free was set up with multiple Quadrature this parameter selects the appropriate number of the quadrature formula[2.x.347] first_selected_component If the dof_handler selected by dof_no uses an FESystem consisting of more than one this parameter allows for selecting the component where the current evaluation routine should start Note that one evaluator does not support combining different shape functions in different components In other the same base element of a FESystem needs to be set for the components between[2.x.348] and[2.x.349][2.x.350] active_fe_index If matrix_free was set up with DoFHandler objects with[2.x.351] this parameter selects to which DoFHandler AffineConstraints pair the given evaluator should be attached to[2.x.352] active_quad_index If matrix_free was set up with[2.x.353] this parameter selects the appropriate number of the quadrature formula **Constructor Takes all data stored in MatrixFree for a given cell which allows to automatically identify the active_fe_index and active_quad_index in case of a p adaptive strategy The rest of the arguments are the same as in the constructor above **Constructor that comes with reduced functionality and works similar as FEValues The arguments are similar to the ones passed to the constructor of with the notable difference that FEEvaluation expects a one dimensional quadrature instead of a[2.x.354] dimensional one The finite element can be both scalar or vector but this method always only selects a scalar base element at a the optional argument[2.x.356] allows to specify the index of the base element to be used for evaluation Note that the internal data structures always assume that the base element is non primitive are not supported currently As known from a call to the reinit method with a[2.x.357] is necessary to make the geometry and degrees of freedom of the current class known::If the iterator includes DoFHandler the initialization allows to also read from or write to vectors in the standard way for[2.x.359] types for one cell at a time this approach is much slower than the path with MatrixFree with MPI since index translation has to be done As only one cell at a time is this method does not vectorize over several but only possibly within the element if the evaluate integrate routines are combined inside user an object of type i the underlying mapping and quadrature points do only need to be evaluated once Make sure to not pass an optional object around when you intend to use the FEEvaluation object in parallel to the given one because otherwise the intended sharing may create race conditions **Copy constructor If FEEvaluationBase was constructed from a fe</div><div class="ttdef"><b>Definition:</b> <a href="fe__evaluation__0_8txt_source.html#l00555">fe_evaluation_0.txt:555</a></div></div>
<div class="ttc" id="anamespaceMatrixFreeTools_html_a523190adf5671e317d745fed4b1d357f"><div class="ttname"><a href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">MatrixFreeTools::compute_diagonal</a></div><div class="ttdeci">void compute_diagonal(const MatrixFree&lt; dim, Number, VectorizedArrayType &gt; &amp;matrix_free, LinearAlgebra::distributed::Vector&lt; Number &gt; &amp;diagonal_global, const std::function&lt; void(FEEvaluation&lt; dim, fe_degree, n_q_points_1d, n_components, Number, VectorizedArrayType &gt; &amp;)&gt; &amp;local_vmult, const unsigned int dof_no=0, const unsigned int quad_no=0, const unsigned int first_selected_component=0)</div></div>
<div class="ttc" id="atable__handler__0_8txt_html_a61e9964f9093088848525ca172895749"><div class="ttname"><a href="table__handler__0_8txt.html#a61e9964f9093088848525ca172895749">step</a></div><div class="ttdeci">the ConvergenceTable class does something like this *To support both the TableHandler class has a property called[1.x.4] By auto fill mode is but it can be enabled by calling set_auto_fill_mode(). If auto-fill mode is enabled we use the following algorithm call it *[2.x.18] ***If[2.x.19] then we add[2.x.20] copies of the object[2.x.21] to this column is the data type of the given[2.x.23] is a numeric then[2.x.24] is[2.x.25] is the empty string *[2.x.26] ***Add the given value to this column *Padding the column with default elements makes sure that after the addition the column has as many entries as the longest other column In other if we have skipped previous invocations of then the padding will enter default values into this column *The algorithm as described will fail if you try to skip adding values for a key if adding an element for this key is the first thing you want to do for a given iteration or time step</div><div class="ttdef"><b>Definition:</b> <a href="table__handler__0_8txt_source.html#l00070">table_handler_0.txt:70</a></div></div>
<div class="ttc" id="aclassDoFHandler_html_a9aed31323cbd7619edac310c47e7a7ad"><div class="ttname"><a href="classDoFHandler.html#a9aed31323cbd7619edac310c47e7a7ad">DoFHandler::distribute_mg_dofs</a></div><div class="ttdeci">void distribute_mg_dofs()</div></div>
<div class="ttc" id="anamespaceDoFTools_html_acad7e0841b9046eaafddc4c617ab1d9d"><div class="ttname"><a href="namespaceDoFTools.html#acad7e0841b9046eaafddc4c617ab1d9d">DoFTools::extract_locally_relevant_dofs</a></div><div class="ttdeci">void extract_locally_relevant_dofs(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, IndexSet &amp;dof_set)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools_8cc_source.html#l01133">dof_tools.cc:1133</a></div></div>
<div class="ttc" id="aclassFullMatrix_html"><div class="ttname"><a href="classFullMatrix.html">FullMatrix&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassFEEvaluation_html"><div class="ttname"><a href="classFEEvaluation.html">FEEvaluation</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_2fe__evaluation_8h_source.html#l00070">fe_evaluation.h:70</a></div></div>
<div class="ttc" id="amultigrid_2mg__constrained__dofs_8h_html"><div class="ttname"><a href="multigrid_2mg__constrained__dofs_8h.html">mg_constrained_dofs.h</a></div></div>
<div class="ttc" id="acoding__conventions__0_8txt_html_ac639e1db0b03fc797eca55e266afa976"><div class="ttname"><a href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a></div><div class="ttdeci">functions which clear bits or flags should be named[2.x.15] use[2.x.18] instead of *[2.x.19] In the implementation after each three empty lines are expected to enable better readability One empty line occurs in functions to group blocks of since two empty lines are not enough to visibly distinguish sufficiently that the code belongs to two different functions *[2.x.21] Whenever an integer variable can only assume nonnegative it is marked as unsigned The same applies to functions that can only return positive or zero values it should be marked even if passed by value we mark input parameters as const This aids as an additional documentation tool to clarify the intent of a which is often either involuntarily or poor style *[2.x.25] Whenever a function does not change any of the member variable of the embedding class it should be marked as const  *[2.x.27] Function and variable names may not consist of only one or two unless the variable is a pure counting index *[2.x.29] Type the number of children per cell</div><div class="ttdef"><b>Definition:</b> <a href="coding__conventions__0_8txt_source.html#l00027">coding_conventions_0.txt:27</a></div></div>
<div class="ttc" id="aclassSolverControl_html"><div class="ttname"><a href="classSolverControl.html">SolverControl</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2solver__control_8h_source.html#l00052">solver_control.h:52</a></div></div>
<div class="ttc" id="abase_2partitioner__0_8txt_html_a6d2d0fa485d1660823c59c494fb0fb31"><div class="ttname"><a href="base_2partitioner__0_8txt.html#a6d2d0fa485d1660823c59c494fb0fb31">MPI</a></div><div class="ttdeci">*This class defines a model for the partitioning of a it includes a structure for the point to point communication patterns It allows the inclusion of ghost it also stores the other processors ghost indices belonging to the current which are the indices where other processors might require information from In a these import indices form the dual of the ghost indices This information is gathered once when constructing the which obviates subsequent global communication steps when exchanging data The figure below gives an example of index space[2.x.2] being split into four parts that are each owned by one MPI the next four lines indicate which elements of the overall array each processor wants to know about **this is generally a superset of the locally owned with the difference being what are called ghost elements To understand the remaining pieces of the remember that in MPI</div><div class="ttdef"><b>Definition:</b> <a href="base_2partitioner__0_8txt_source.html#l00004">partitioner_0.txt:4</a></div></div>
<div class="ttc" id="agroup__CPP11_html_gaace8c98aca00e7e48a619bb5e08084aa"><div class="ttname"><a href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">DoFHandler::active_cell_iterators</a></div><div class="ttdeci">IteratorRange&lt; active_cell_iterator &gt; active_cell_iterators() const</div></div>
<div class="ttc" id="anamespaceinternal_1_1TriangulationImplementation_html_a9f815604be9b560fea00beef8d720480"><div class="ttname"><a href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">internal::TriangulationImplementation::n_cells</a></div><div class="ttdeci">unsigned int n_cells(const internal::TriangulationImplementation::NumberCache&lt; 1 &gt; &amp;c)</div><div class="ttdef"><b>Definition:</b> <a href="grid_2tria_8cc_source.html#l12588">tria.cc:12588</a></div></div>
<div class="ttc" id="apolynomial__space__0_8txt_html_ac00ea19562c135512a6ff275a3cf0d8f"><div class="ttname"><a href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a></div><div class="ttdeci">*Representation of the space of polynomials of degree at most n in higher dimensions *Given a vector of[1.x.0] one dimensional polynomials[1.x.1] where[1.x.3] has this class generates all dim dimensional polynomials of the where the sum and[1.x.8] is less than or equal *[1.x.9] The i e for each dim dimensional polynomial in the polynomial space it gives the indices j</div><div class="ttdef"><b>Definition:</b> <a href="polynomial__space__0_8txt_source.html#l00004">polynomial_space_0.txt:4</a></div></div>
<div class="ttc" id="amg__0_8txt_html_a1dadc108ee1520717957789de4b76416"><div class="ttname"><a href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a></div><div class="ttdeci">****Classes that have to do with multigrid algorithms *The main class with implementation of the multigrid scheme is Multigrid with its function[2.x.1] It uses the abstract following classes in order to perform the multigrid cycle</div><div class="ttdef"><b>Definition:</b> <a href="mg__0_8txt_source.html#l00007">mg_0.txt:7</a></div></div>
<div class="ttc" id="anamespaceDoFTools_html_a1fef7be07cf379b661646e39b9354e17"><div class="ttname"><a href="namespaceDoFTools.html#a1fef7be07cf379b661646e39b9354e17">DoFTools::extract_locally_relevant_level_dofs</a></div><div class="ttdeci">void extract_locally_relevant_level_dofs(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, const unsigned int level, IndexSet &amp;dof_set)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools_8cc_source.html#l01175">dof_tools.cc:1175</a></div></div>
<div class="ttc" id="abase_2vectorization_8h_html_aafbdfdd72b6cfe4eae5fa7a16385582f"><div class="ttname"><a href="base_2vectorization_8h.html#aafbdfdd72b6cfe4eae5fa7a16385582f">std::abs</a></div><div class="ttdeci">inline ::VectorizedArray&lt; Number, width &gt; abs(const ::VectorizedArray&lt; Number, width &gt; &amp;x)</div><div class="ttdef"><b>Definition:</b> <a href="base_2vectorization_8h_source.html#l05750">vectorization.h:5750</a></div></div>
<div class="ttc" id="amultigrid_2mg__transfer__matrix__free_8h_html"><div class="ttname"><a href="multigrid_2mg__transfer__matrix__free_8h.html">mg_transfer_matrix_free.h</a></div></div>
<div class="ttc" id="aclassFE__Q_html_aef8e62ce116e341818549d1730343792"><div class="ttname"><a href="classFE__Q.html#aef8e62ce116e341818549d1730343792">FE_Q::get_name</a></div><div class="ttdeci">virtual std::string get_name() const override</div><div class="ttdef"><b>Definition:</b> <a href="fe__q_8cc_source.html#l00095">fe_q.cc:95</a></div></div>
<div class="ttc" id="anumerics_2data__out_8h_html"><div class="ttname"><a href="numerics_2data__out_8h.html">data_out.h</a></div></div>
<div class="ttc" id="aclassDataOut_html"><div class="ttname"><a href="classDataOut.html">DataOut&lt; dim &gt;</a></div></div>
<div class="ttc" id="afe__evaluation__0_8txt_html_a66b432045b82ed9b1c850f6407d4b1ca"><div class="ttname"><a href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a></div><div class="ttdeci">FE_Q with hanging node constraints connects to more neighbors than a FE_DGQ for and cells which need data exchange are put in different positions inside the cell loop Of if the exact same and then the order is going to be the same because the algorithm is deterministic *dim Dimension in which this class is to be used *fe_degree Degree of the tensor product finite element with fe_degree degrees of freedom per coordinate direction Can be set to **if the degree is not known at compile but performance will usually be worse by a factor of *n_q_points_1d Number of points in the quadrature formula defaults to fe_degree *n_components Number of vector components when solving a system of PDEs If the same operation is applied to several components of a they can be applied simultaneously with one usually[2.x.339] or[2.x.340] Defaults to[2.x.341] double ******An alias to the base class **An underlying number type specified as template argument **The type of function e g VectorizedArrayType for e g Tensor&lt; 1, dim, VectorizedArrayType &gt; for can be different if fe_degree</div><div class="ttdef"><b>Definition:</b> <a href="fe__evaluation__0_8txt_source.html#l00537">fe_evaluation_0.txt:537</a></div></div>
<div class="ttc" id="afunctions__0_8txt_html_af9f808a82e8c618e2e7a19dd08a9eae3"><div class="ttname"><a href="functions__0_8txt.html#af9f808a82e8c618e2e7a19dd08a9eae3">value</a></div><div class="ttdeci">****Functions are used in various places in deal for example to describe boundary coefficients in forcing or exact solutions Since closed form expressions for equations are often hard to pass along as function deal II uses the Function base class to describe these objects Essentially the interface of this base class requires derived classes to implement the ability to return the value of a function at one or a list of particular locations and function objects can then be used by algorithms like[2.x.1][2.x.2] and other functions *Some functions are needed again and and are therefore already provided in deal II This includes a function with a constant value</div><div class="ttdef"><b>Definition:</b> <a href="functions__0_8txt_source.html#l00007">functions_0.txt:7</a></div></div>
<div class="ttc" id="aclassVector_html"><div class="ttname"><a href="classVector.html">Vector&lt; double &gt;</a></div></div>
<div class="ttc" id="adofs__0_8txt_html_ace93ab11d5f75755b09a3368db091adc"><div class="ttname"><a href="dofs__0_8txt.html#ace93ab11d5f75755b09a3368db091adc">Triangulation</a></div><div class="ttdeci">and the DoF handler object provides an enumeration of the i it is provides a concrete structure of the space so that we can describe functions in this finite dimensional space by vectors of coefficients *DoFHandlers extend Triangulation offer iterators that run over all or other geometric objects that make up a triangulation These iterators are derived from the triangulation iterators and therefore offer the same but they also offer additional functions For they allow to query the indices of the degrees of freedom associated with the present cell Note that DoFHandler classes are[1.x.1] from Triangulation</div><div class="ttdef"><b>Definition:</b> <a href="dofs__0_8txt_source.html#l00008">dofs_0.txt:8</a></div></div>
<div class="ttc" id="aclassDataOutInterface_html_ac7280a24690b117454acfb0fa058299c"><div class="ttname"><a href="classDataOutInterface.html#ac7280a24690b117454acfb0fa058299c">DataOutInterface::set_flags</a></div><div class="ttdeci">void set_flags(const FlagType &amp;flags)</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8cc_source.html#l08210">data_out_base.cc:8210</a></div></div>
<div class="ttc" id="aclassAffineConstraints_html_a1611aa37f754086388ca76bcd421cce5"><div class="ttname"><a href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">AffineConstraints::close</a></div><div class="ttdeci">void close()</div></div>
<div class="ttc" id="agrid_2manifold__0_8txt_html_a02d8bd1db3a4d0b6d68a99a931ce1b83"><div class="ttname"><a href="grid_2manifold__0_8txt.html#a02d8bd1db3a4d0b6d68a99a931ce1b83">since</a></div><div class="ttdeci">*We collect here some helper functions used in the Manifold&lt; dim, spacedim &gt; classes ***A[2.x.0] helper function that returns the number of default points for the structure type pointed to by the given[2.x.1] See the documentation of[2.x.2] for more information **Given a general mesh construct arrays of quadrature points and weights that contain the following then the quadrature points are the two vertices of the line This results in a point vector with two points ********If the iterator points to a then the quadrature points are the vertices and line mid points This results in a point vector with then the quadrature points are the the line mid and the face mid points This results in a points vector which computes a new point on a manifold based on a weighted average of surrounding points represented by the quadrature points and weights stored in the returned pair of vectors This function creates such an object based on the points that surround a or and weights are chosen in a way appropriate for computing the new mid point of the object pointed to An example of where this is necessary is for mesh and then a new cell point[2.x.8] iterator A mesh iterator that points to either a or hex[2.x.9] with_interpolation Whether or not to compute the quadrature weights from transfinite as discussed above[2.x.10] MeshIteratorType An iterator type that corresponds to then no periodicity is assumed in that direction Whenever a function that tries to compute averages is an exception will be thrown if one of the points which you are using for the average lies outside the periodicity box The return points are guaranteed to lie in the periodicity box plus or minus tolerance *periodicity and then calls internally the function is to allow lazy programmers to implement only the the middle point of a cell is close to true middle point of the and a projection may suffice For most simple it is possible to get reasonable results by deriving your own Manifold class from FlatManifold and write a new interface only for the project_to_manifold function You will have good approximations also with large deformations as long as in the coarsest mesh size you are trying to refine the middle point is not too far from the manifold mid point i e as long as the coarse mesh size is small enough **Compute a new set of points that interpolate between the given points[2.x.108] surrounding_points[2.x.109] is a table with as many columns as[2.x.110] surrounding_points the interpolation of the[2.x.113] according to the[2.x.114] is simply performed in Cartesian space **Project to FlatManifold This is the identity function for Euclidean spaces Note however that this function can be overloaded by derived which will then benefit from the logic behind the is tangential to the geodesic that connects two points[2.x.116] For the current we assume that the manifold is so the geodesic is the straight line between the two and we return[2.x.117] The normalization of the vector is chosen so that it fits the convention described in *[2.x.118] If you use this class as a stepping stone to build a manifold that only slightly deviates from a flat manifold by overloading the and the one at which the direction is to be evaluated[2.x.121] x2 The second point that describes the geodesic[2.x.122] A direction vector tangential to the geodesic this possibly modified by the periodicity of the domain as set in the to use the shortest connection between the points through the periodic boundary as necessary **Return the normal vector to the given face at point p taking into account that quadrilateral faces of hexahedral cells in may not be planar In those the face is assumed to have a geometry described by a bilinear and the normal vector is computed by embedding this bilinear form into a Cartesian space with a flat metric **Compute the normal vectors to the boundary at each vertex of the given face taking into account that quadrilateral faces of hexahedral cells in may not be planar In those the face is assumed to have a geometry described by a bilinear and the normal vector is computed by embedding this bilinear form into a Cartesian space with a flat metric **Return the periodicity of this Manifold **The periodicity of this Manifold Periodicity affects the way a middle point is computed It is assumed that if two points are more than half period then the distance should be computed by crossing the periodicity i the average is computed by adding a full period to the sum of the two For if along direction we have *pi then the average but since</div><div class="ttdef"><b>Definition:</b> <a href="grid_2manifold__0_8txt_source.html#l00147">manifold_0.txt:147</a></div></div>
<div class="ttc" id="amultithreading__0_8txt_html_a4c0a7149e1927066d2fcdb356cb90f7b"><div class="ttname"><a href="multithreading__0_8txt.html#a4c0a7149e1927066d2fcdb356cb90f7b">no</a></div><div class="ttdeci">in this it often pays off to use rather than in a program *deal II does not implement scheduling tasks to threads itself For we use the[1.x.10] for which we provide simple wrappers TBB abstracts the details of how to start or stop start tasks on individual and provides interfaces that are portable across many different systems ***MTUsing *[1.x.11] the syntax to start would be something like this for the example we would like to indicate the fact that the function call should be run on a separate task by simply prefixing the call with a as it is here *Since C does not support the creation of new we have to be a bit more creative The way chosen is to introduce a function[2.x.24] that takes as arguments the function to call as well as the arguments to the call The[2.x.25] function is overloaded to accommodate starting tasks with functions that take no</div><div class="ttdef"><b>Definition:</b> <a href="multithreading__0_8txt_source.html#l00045">multithreading_0.txt:45</a></div></div>
<div class="ttc" id="agrid_2grid__refinement__0_8txt_html_a8bdcf8330609e043ba26a394139934f2"><div class="ttname"><a href="grid_2grid__refinement__0_8txt.html#a8bdcf8330609e043ba26a394139934f2">Section</a></div><div class="ttdeci">and W R the function uses the observation that the error behaves like[2.x.65] with some constant[2.x.66] that depends on the dimension and the finite element degree It should **given optimal mesh refinement **not depend so much on the regularity of the as it is based on the that all singularities can be resolved by refinement Mesh refinement is then based on the idea that we want to make[2.x.67] small This corresponds to the functional[2.x.68] above *This function was originally implemented by Thomas Richter It follows a strategy described in T Parallel Multigrid Method for Adaptive Finite Elements with Application to Flow PhD University of See in particular Section</div><div class="ttdef"><b>Definition:</b> <a href="grid_2grid__refinement__0_8txt_source.html#l00029">grid_refinement_0.txt:29</a></div></div>
<div class="ttc" id="anamespaceparallel_html"><div class="ttname"><a href="namespaceparallel.html">parallel</a></div><div class="ttdef"><b>Definition:</b> <a href="doc_2doxygen_2headers_2distributed_8h_source.html#l00313">distributed.h:313</a></div></div>
<div class="ttc" id="afe_2fe__values__0_8txt_html_a15ff2e0c168966d6ae13c4faabcec165"><div class="ttname"><a href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a></div><div class="ttdeci">we have to work a bit harder to compute this information **Default constructor Creates an invalid object **Constructor for an object that represents a single scalar component of a FEValuesBase for the shape function and quadrature point selected by the arguments[2.x.27] shape_function Number of the shape function to be evaluated Note that this number runs from zero to dofs_per_cell</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values__0_8txt_source.html#l00073">fe_values_0.txt:73</a></div></div>
<div class="ttc" id="anamespaceVectorTools_html_a69967cb7a148a7169963126249213db1a7c450aee1986e226cf1bd7687171d769"><div class="ttname"><a href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1a7c450aee1986e226cf1bd7687171d769">VectorTools::H1_seminorm</a></div><div class="ttdeci">@ H1_seminorm</div><div class="ttdef"><b>Definition:</b> <a href="numerics_2vector__tools__common_8h_source.html#l00123">vector_tools_common.h:123</a></div></div>
<div class="ttc" id="anamespaceUtilities_html"><div class="ttname"><a href="namespaceUtilities.html">Utilities</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2communication__pattern__base_8h_source.html#l00030">communication_pattern_base.h:30</a></div></div>
<div class="ttc" id="aclassMGTransferMatrixFree_html_a69e2b416ab209936f94db08e865cd92b"><div class="ttname"><a href="classMGTransferMatrixFree.html#a69e2b416ab209936f94db08e865cd92b">MGTransferMatrixFree::initialize_constraints</a></div><div class="ttdeci">void initialize_constraints(const MGConstrainedDoFs &amp;mg_constrained_dofs)</div><div class="ttdef"><b>Definition:</b> <a href="mg__transfer__matrix__free_8cc_source.html#l00067">mg_transfer_matrix_free.cc:67</a></div></div>
<div class="ttc" id="aclassMatrixFreeOperators_1_1Base_html"><div class="ttname"><a href="classMatrixFreeOperators_1_1Base.html">MatrixFreeOperators::Base</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_2operators_8h_source.html#l00184">operators.h:184</a></div></div>
<div class="ttc" id="amatrix__free_2tools_8h_html"><div class="ttname"><a href="matrix__free_2tools_8h.html">tools.h</a></div></div>
<div class="ttc" id="agrid_2grid__generator_8h_html"><div class="ttname"><a href="grid_2grid__generator_8h.html">grid_generator.h</a></div></div>
<div class="ttc" id="aclassMatrixFree_html_abc204ec41ead1b5060f47ef3a5a066d7"><div class="ttname"><a href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">MatrixFree::cell_loop</a></div><div class="ttdeci">void cell_loop(const std::function&lt; void(const MatrixFree&lt; dim, Number, VectorizedArrayType &gt; &amp;, OutVector &amp;, const InVector &amp;, const std::pair&lt; unsigned int, unsigned int &gt; &amp;)&gt; &amp;cell_operation, OutVector &amp;dst, const InVector &amp;src, const bool zero_dst_vector=false) const</div></div>
<div class="ttc" id="aclassDoFHandler_html_aa5b8d3c4b9deb0774dde5c2851e07e1e"><div class="ttname"><a href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">DoFHandler::n_dofs</a></div><div class="ttdeci">types::global_dof_index n_dofs() const</div></div>
<div class="ttc" id="aclassUtilities_1_1MPI_1_1MPI__InitFinalize_html"><div class="ttname"><a href="classUtilities_1_1MPI_1_1MPI__InitFinalize.html">Utilities::MPI::MPI_InitFinalize</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2mpi_8h_source.html#l00836">mpi.h:836</a></div></div>
<div class="ttc" id="apetsc__matrix__base__0_8txt_html_a5a1b8b75c93e6ea5e27829c4fe862a8e"><div class="ttname"><a href="petsc__matrix__base__0_8txt.html#a5a1b8b75c93e6ea5e27829c4fe862a8e">n</a></div><div class="ttdeci">local_size()&lt;/tt &gt;. *[0.x.57] *Return whether[2.x.13] is in the local range or not, see also local_range(). *[0.x.58] *Return a reference to the MPI communicator object in use with this matrix. This function has to be implemented in derived classes. *[0.x.59] *Return the number of nonzero elements of this matrix. Actually, it returns the number of entries in the sparsity pattern n</div><div class="ttdef"><b>Definition:</b> <a href="petsc__matrix__base__0_8txt_source.html#l00127">petsc_matrix_base_0.txt:127</a></div></div>
<div class="ttc" id="aclassMGTransferMatrixFree_html"><div class="ttname"><a href="classMGTransferMatrixFree.html">MGTransferMatrixFree&lt; dim, float &gt;</a></div></div>
<div class="ttc" id="aclassMGCoarseGridApplySmoother_html"><div class="ttname"><a href="classMGCoarseGridApplySmoother.html">MGCoarseGridApplySmoother</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_2mg__coarse_8h_source.html#l00040">mg_coarse.h:40</a></div></div>
<div class="ttc" id="acoding__conventions__0_8txt_html_a02f5aa616d7b0799c538fe77d6c6c795"><div class="ttname"><a href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a></div><div class="ttdeci">i e</div><div class="ttdef"><b>Definition:</b> <a href="coding__conventions__0_8txt_source.html#l00028">coding_conventions_0.txt:28</a></div></div>
<div class="ttc" id="amultigrid_2mg__coarse_8h_html"><div class="ttname"><a href="multigrid_2mg__coarse_8h.html">mg_coarse.h</a></div></div>
<div class="ttc" id="agroup__dofs_html_ga768cd565b5c25f1ac235586e36ac94d6"><div class="ttname"><a href="group__dofs.html#ga768cd565b5c25f1ac235586e36ac94d6">hp::DoFHandler</a></div><div class="ttdeci">::DoFHandler&lt; dim, spacedim &gt; DoFHandler</div><div class="ttdef"><b>Definition:</b> <a href="hp_2dof__handler_8h_source.html#l00066">dof_handler.h:66</a></div></div>
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
