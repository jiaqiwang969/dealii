<!-- HTML header for doxygen 1.8.17-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="canonical" href="https://www.dealii.org/current/doxygen/deal.II/step_66.html" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The deal.II Library: The step-66 tutorial program</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link rel="SHORTCUT ICON" href="deal.ico"></link>
<script type="text/javascript" src="custom.js"></script>
<meta name="author" content="The deal.II Authors <authors@dealii.org>"></meta>
<meta name="copyright" content="Copyright (C) 1998 - 2021 by the deal.II authors"></meta>
<meta name="deal.II-version" content="10.0.0-pre"></meta>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo200.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Reference documentation for deal.II version 10.0.0-pre</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!--Extra macros for MathJax:-->
<div style="display:none">
\(\newcommand{\dealvcentcolon}{\mathrel{\mathop{:}}}\)
\(\newcommand{\dealcoloneq}{\dealvcentcolon\mathrel{\mkern-1.2mu}=}\)
\(\newcommand{\jump}[1]{\left[\!\left[ #1 \right]\!\right]}\)
\(\newcommand{\average}[1]{\left\{\!\left\{ #1 \right\}\!\right\}}\)
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">The step-66 tutorial program </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial depends on <a class="el" href="step_15.html">step-15</a>, <a class="el" href="step_37.html">step-37</a>.</p>
<p> 
<table class="tutorial" width="50%">
<tr><th colspan="2"><b><small>Table of contents</small></b></th></tr>
<tr><td width="50%" valign="top">
<ol>
  <li> <a href="#Intro" class=bold>Introduction</a>
    <ul>
        <li><a href="#Problemformulation">Problem formulation</a>
        <li><a href="#Discretizationwithfiniteelements">Discretization with finite elements</a>
        <li><a href="#Numericallinearalgebra">Numerical linear algebra</a>
        <li><a href="#Triangulation">Triangulation</a>
    </ul>
  <li> <a href="#CommProg" class=bold>The commented program</a>
    <ul>
        <li><a href="#MatrixfreeJacobianOperator">Matrix-free JacobianOperator</a>
      <ul>
        <li><a href="#EvaluationoftheoldNewtonstep">Evaluation of the old Newton step</a>
        <li><a href="#Nonlinearmatrixfreeoperatorapplication">Nonlinear matrix-free operator application</a>
        <li><a href="#DiagonaloftheJacobianOperator">Diagonal of the JacobianOperator</a>
      </ul>
        <li><a href="#GelfandProblemclass">GelfandProblem class</a>
      <ul>
        <li><a href="#GelfandProblemmake_grid">GelfandProblem::make_grid</a>
        <li><a href="#GelfandProblemsetup_system">GelfandProblem::setup_system</a>
        <li><a href="#GelfandProblemevaluate_residual">GelfandProblem::evaluate_residual</a>
        <li><a href="#GelfandProblemlocal_evaluate_residual">GelfandProblem::local_evaluate_residual</a>
        <li><a href="#GelfandProblemassemble_rhs">GelfandProblem::assemble_rhs</a>
        <li><a href="#GelfandProblemcompute_residual">GelfandProblem::compute_residual</a>
        <li><a href="#GelfandProblemcompute_update">GelfandProblem::compute_update</a>
        <li><a href="#GelfandProblemsolve">GelfandProblem::solve</a>
        <li><a href="#GelfandProblemcompute_solution_norm">GelfandProblem::compute_solution_norm</a>
        <li><a href="#GelfandProblemoutput_results">GelfandProblem::output_results</a>
        <li><a href="#GelfandProblemrun">GelfandProblem::run</a>
      </ul>
        <li><a href="#Thecodemaincodefunction">The <code>main</code> function</a>
      </ul>
</ol></td><td width="50%" valign="top"><ol>
  <li value="3"> <a href="#Results" class=bold>Results</a>
    <ul>
        <li><a href="#Programoutput">Program output</a>
        <li><a href="#Newtonsolver">Newton solver</a>
        <li><a href="#Possibilitiesforextensions">Possibilities for extensions</a>
      <ul>
        <li><a href="#MoresophisticatedNewtoniteration">More sophisticated Newton iteration</a>
        <li><a href="#Parallelscalabilityandthreadparallelism">Parallel scalability and thread parallelism</a>
        <li><a href="#Comparisontomatrixbasedmethods">Comparison to matrix-based methods</a>
        <li><a href="#Eigenvalueproblem">Eigenvalue problem</a>
    </ul>
    </ul>
  <li> <a href="#PlainProg" class=bold>The plain program</a>
</ol> </td> </tr> </table>
 <br  />
</p>
<p><em> This program was contributed by Fabian Castelli.</em></p>
<p><em>A version of this code was presented and discussed in <b>[castelli2021numerical]</b> G.F. Castelli: Numerical Investigation of Cahn-Hilliard-Type Phase-Field Models for Battery Active <a class="el" href="namespaceParticles.html">Particles</a>, PhD thesis, Karlsruhe Institute of Technology (KIT), 2021. (To be published)</em></p>
<p><em>Fabian Castelli acknowledges financial support by the German Research Foundation (DFG) through the Research Training Group 2218 SiMET &ndash; Simulation of mechano-electro-thermal processes in lithium-ion batteries, project number 281041241.</em></p>
<p><em>Finally Fabian Castelli would like to thank Timo Heister for the encouragement and advice in writing this tutorial. </em></p>
<p><a class="anchor" id="Intro"></a> <a class="anchor" id="Introduction"></a></p><h1>Introduction</h1>
<p>The aim of this tutorial program is to demonstrate how to solve a nonlinear problem using Newton's method within the matrix-free framework. This tutorial combines several techniques already introduced in <a class="el" href="step_15.html">step-15</a>, <a class="el" href="step_16.html">step-16</a>, <a class="el" href="step_37.html">step-37</a>, <a class="el" href="step_48.html">step-48</a> and others.</p>
<p><a class="anchor" id="Problemformulation"></a></p><h3>Problem formulation</h3>
<p>On the unit circle \(\Omega = \bigl\{ x \in \mathbb{R}^2 : \|x\| \leq 1 \bigr\}\) we consider the following nonlinear elliptic boundary value problem subject to a homogeneous Dirichlet boundary condition: Find a function \(u\colon\Omega\to\mathbb{R}\) such that it holds: </p><p class="formulaDsp">
\begin{align*} - \Delta u &amp;= \exp(u) &amp; \quad &amp; \text{in } \Omega,\\ u &amp;= 0 &amp; \quad &amp; \text{on } \partial\Omega. \end{align*}
</p>
<p> This problem is also called the <em>Gelfand problem</em> and is a typical example for problems from combustion theory, see for example <b>[bebernes1989mathematical]</b>.</p>
<p><a class="anchor" id="Discretizationwithfiniteelements"></a></p><h3>Discretization with finite elements</h3>
<p>As usual, we first derive the weak formulation for this problem by multiplying with a smooth test function \(v\colon\Omega\to\mathbb{R}\) respecting the boundary condition and integrating over the domain \(\Omega\). Integration by parts and putting the term from the right hand side to the left yields the weak formulation: Find a function \(u\colon\Omega\to\mathbb{R}\) such that for all test functions \(v\) it holds: </p><p class="formulaDsp">
\begin{align*} \int_\Omega \nabla v \cdot \nabla u \,\mathrm{d}x - \int_\Omega v \exp(u) \,\mathrm{d}x = 0. \end{align*}
</p>
<p>Choosing the Lagrangian finite element space \(V_h \dealcoloneq \bigl\{ v \in C(\overline{\Omega}) : v|_Q \in \mathbb{Q}_p \text{ for all } Q \in \mathcal{T}_h \bigr\} \cap H_0^1(\Omega)\), which directly incorporates the homogeneous Dirichlet boundary condition, we can define a basis \(\{\varphi_i\}_{i=1,\dots,N}\) and thus it suffices to test only with those basis functions. So the discrete problem reads as follows: Find \(u_h\in V_h\) such that for all \(i=1,\dots,N\) it holds: </p><p class="formulaDsp">
\begin{align*} F(u_h) \dealcoloneq \int_\Omega \nabla \varphi_i \cdot \nabla u_h \,\mathrm{d}x - \int_\Omega \varphi_i \exp(u_h) \,\mathrm{d}x \stackrel{!}{=} 0. \end{align*}
</p>
<p> As each finite element function is a linear combination of the basis functions \(\{\varphi_i\}_{i=1,\dots,N}\), we can identify the finite element solution by a vector from \(\mathbb{R}^N\) consisting of the unknown values in each degree of freedom (DOF). Thus, we define the nonlinear function \(F\colon\mathbb{R}^N\to\mathbb{R}^N\) representing the discrete nonlinear problem.</p>
<p>To solve this nonlinear problem we use Newton's method. So given an initial guess \(u_h^0\in V_h\), which already fulfills the Dirichlet boundary condition, we determine a sequence of Newton steps \(\bigl( u_h^n \bigr)_n\) by successively applying the following scheme: </p><p class="formulaDsp">
\begin{align*} &amp;\text{Solve for } s_h^n\in V_h: \quad &amp; F&#39;(u_h^n)[s_h^n] &amp;= -F(u_h^n),\\ &amp;\text{Update: } &amp; u_h^{n+1} &amp;= u_h^n + s_h^n. \end{align*}
</p>
<p> So in each Newton step we have to solve a linear problem \(A\,x = b\), where the system matrix \(A\) is represented by the Jacobian \(F&#39;(u_h^n)[\,\cdot\,]\colon\mathbb{R}^N\to\mathbb{R}^N\) and the right hand side \(b\) by the negative residual \(-F(u_h^n)\). The solution vector \(x\) is in that case the Newton update of the \(n\)-th Newton step. Note, that we assume an initial guess \(u_h^0\), which already fulfills the Dirichlet boundary conditions of the problem formulation (in fact this could also be an inhomogeneous Dirichlet boundary condition) and thus the Newton updates \(s_h\) satisfy a homogeneous Dirichlet condition.</p>
<p>Until now we only tested with the basis functions, however, we can also represent any function of \(V_h\) as linear combination of basis functions. More mathematically this means, that every element of \(V_h\) can be identified with a vector \(U\in\mathbb{R}^N\) via the representation formula: \(u_h = \sum_{i=1}^N U_i \varphi_i\). So using this we can give an expression for the discrete Jacobian and the residual: </p><p class="formulaDsp">
\begin{align*} A_{i,j} = \bigl( F&#39;(u_h^n) \bigr)_{i,j} &amp;= \int_\Omega \nabla\varphi_i \cdot \nabla \varphi_j \,\mathrm{d} x - \int_\Omega \varphi_i \, \exp( u_h ) \varphi_j \,\mathrm{d} x,\\ b_{i} = \bigl( F(u_h^n) \bigr)_{i} &amp;= \int_\Omega \nabla\varphi_i \cdot \nabla u_h^n \,\mathrm{d} x - \int_\Omega \varphi_i \, \exp( u_h^n ) \,\mathrm{d} x. \end{align*}
</p>
<p> Compared to <a class="el" href="step_15.html">step-15</a> we could also have formed the Frech{\'e}t derivative of the nonlinear function corresponding to the strong formulation of the problem and discretized it afterwards. However, in the end we would get the same set of discrete equations.</p>
<p><a class="anchor" id="Numericallinearalgebra"></a></p><h3>Numerical linear algebra</h3>
<p>Note, how the system matrix, actually the Jacobian, depends on the previous Newton step \(A = F&#39;(u^n)\). Hence we need to tell the function that computes the system matrix about the solution at the last Newton step. In an implementation with a classical <code>assemble_system()</code> function we would gather this information from the last Newton step during assembly by the use of the member functions <a class="el" href="classFEValuesBase.html#a357b422e374f2f2207af3512093f3907">FEValuesBase::get_function_values()</a> and <a class="el" href="classFEValuesBase.html#ad1f4e0deb5d982e8172d82141c634a67">FEValuesBase::get_function_gradients()</a>. The <code>assemble_system()</code> function would then looks like: </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> GelfandProblem&lt;dim&gt;::assemble_system()</div>
<div class="line">{</div>
<div class="line">  system_matrix = 0;</div>
<div class="line">  system_rhs    = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> quadrature_formula(fe.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1);</div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>     fe_values(fe,</div>
<div class="line">                          quadrature_formula,</div>
<div class="line">                          <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points    = fe_values.n_quadrature_points;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell = fe_values.dofs_per_cell;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a>                   <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(dofs_per_cell);</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a>                       cell_rhs(dofs_per_cell);</div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; local_dof_indices(dofs_per_cell);</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;Tensor&lt;1, dim&gt;&gt; newton_step_gradients(n_q_points);</div>
<div class="line">  std::vector&lt;double&gt;         newton_step_values(n_q_points);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : dof_handler.<a class="code" href="group__CPP11.html#gacdb6d3adec96a13a7079f6c893e1d3ff">active_cell_iterators</a>())</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a> = 0.0;</div>
<div class="line">      cell_rhs    = 0.0;</div>
<div class="line"> </div>
<div class="line">      fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(cell);</div>
<div class="line"> </div>
<div class="line">      fe_values.get_function_values(solution, newton_step_values);</div>
<div class="line">      fe_values.get_function_gradients(solution, newton_step_gradients);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_q_points; ++q)</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> nonlinearity = <a class="code" href="base_2vectorization_8h.html#a19f846bda83b7e3f4531daacb40c64e1">std::exp</a>(newton_step_values[q]);</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1a9e60516f3a44e6d7cd4ac533f6bc0209">dx</a>           = fe_values.JxW(q);</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">double</span>         phi_i      = fe_values.shape_value(i, q);</div>
<div class="line">              <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> grad_phi_i = fe_values.shape_grad(i, q);</div>
<div class="line"> </div>
<div class="line">              <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; dofs_per_cell; ++j)</div>
<div class="line">                {</div>
<div class="line">                  <span class="keyword">const</span> <span class="keywordtype">double</span>         phi_j      = fe_values.shape_value(j, q);</div>
<div class="line">                  <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> grad_phi_j = fe_values.shape_grad(j, q);</div>
<div class="line"> </div>
<div class="line">                  <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(i, j) +=</div>
<div class="line">                    (grad_phi_i * grad_phi_j - phi_i * nonlinearity * phi_j) *</div>
<div class="line">                    <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1a9e60516f3a44e6d7cd4ac533f6bc0209">dx</a>;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">              cell_rhs(i) += (-grad_phi_i * newton_step_gradients[q] +</div>
<div class="line">                              phi_i * newton_step_values[q]) *</div>
<div class="line">                             <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1a9e60516f3a44e6d7cd4ac533f6bc0209">dx</a>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      cell-&gt;get_dof_indices(local_dof_indices);</div>
<div class="line"> </div>
<div class="line">      constraints.<a class="code" href="classAffineConstraints.html#a373fbdacd8c486e675b8d2bff8943192">distribute_local_to_global</a>(</div>
<div class="line">        <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>, cell_rhs, local_dof_indices, system_matrix, system_rhs);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Since we want to solve this problem without storing a matrix, we need to tell the matrix-free operator this information before we use it. Therefore in the derived class <code>JacobianOperator</code> we will implement a function called <code>evaluate_newton_step</code>, which will process the information of the last Newton step prior to the usage of the matrix-vector implementation. Furthermore we want to use a geometric multigrid (GMG) preconditioner for the linear solver, so in order to apply the multilevel operators we need to pass the last Newton step also to these operators. This is kind of a tricky task, since the vector containing the last Newton step has to be interpolated to all levels of the triangulation. In the code this task will be done by the function <a class="el" href="classMGTransferMatrixFree.html#a90aef560cc3d832589ca13a5f18e1414">MGTransferMatrixFree::interpolate_to_mg()</a>. Note, a fundamental difference to the previous cases, where we set up and used a geometric multigrid preconditioner, is the fact, that we can reuse the <a class="el" href="classMGTransferMatrixFree.html">MGTransferMatrixFree</a> object for the computation of all Newton steps. So we can save some work here by defining a class variable and using an already set up <a class="el" href="classMGTransferMatrixFree.html">MGTransferMatrixFree</a> object <code>mg_transfer</code> that was initialized in the <code>setup_system()</code> function. </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::compute_update()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;compute update&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  solution.update_ghost_values();</div>
<div class="line"> </div>
<div class="line">  system_matrix.evaluate_newton_step(solution);</div>
<div class="line"> </div>
<div class="line">  mg_transfer.<a class="code" href="classMGTransferMatrixFree.html#a90aef560cc3d832589ca13a5f18e1414">interpolate_to_mg</a>(dof_handler, mg_solution, solution);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Set up options for the multilevel preconditioner</span></div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.n_global_levels(); ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">    {</div>
<div class="line">      mg_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].evaluate_newton_step(mg_solution[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>]);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Define the actual preconditioner</span></div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Solve the linear system</span></div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>The function evaluating the nonlinearity works basically in the same way as the function <code>evaluate_coefficient</code> from <a class="el" href="step_37.html">step-37</a> evaluating a coefficient function. The idea is to use an <a class="el" href="classFEEvaluation.html">FEEvaluation</a> object to evaluate the Newton step and store the expression in a table for all cells and all quadrature points: </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line"><span class="keywordtype">void</span> JacobianOperator&lt;dim, fe_degree, number&gt;::evaluate_newton_step(</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;newton_step)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a> = this-&gt;data-&gt;n_cell_batches();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, fe_degree, fe_degree + 1, 1, number&gt;</a> phi(*this-&gt;data);</div>
<div class="line"> </div>
<div class="line">  nonlinear_values.reinit(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>, phi.n_q_points);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = 0; cell &lt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>; ++cell)</div>
<div class="line">    {</div>
<div class="line">      phi.reinit(cell);</div>
<div class="line">      phi.read_dof_values_plain(newton_step);</div>
<div class="line">      phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">        {</div>
<div class="line">          nonlinear_values(cell, q) = <a class="code" href="base_2vectorization_8h.html#a19f846bda83b7e3f4531daacb40c64e1">std::exp</a>(phi.get_value(q));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Triangulation"></a></p><h3><a class="el" href="classTriangulation.html">Triangulation</a></h3>
<p>As said in <a class="el" href="step_37.html">step-37</a> the matrix-free method gets more efficient if we choose a higher order finite element space. Since we want to solve the problem on the \(d\)-dimensional unit ball, it would be good to have an appropriate boundary approximation to overcome convergence issues. For this reason we use an isoparametric approach with the <a class="el" href="classMappingQGeneric.html">MappingQGeneric</a> class to recover the smooth boundary as well as the mapping for inner cells. In addition, to get a good triangulation in total we make use of the <a class="el" href="classTransfiniteInterpolationManifold.html">TransfiniteInterpolationManifold</a>.</p>
<p><a class="anchor" id="CommProg"></a> </p><h1>The commented program</h1>
<p>First we include the typical headers of the deal.II library needed for this tutorial:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2timer_8h.html">deal.II/base/timer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2vectorization_8h.html">deal.II/base/vectorization.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__accessor_8h.html">deal.II/dofs/dof_accessor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2mapping__q__generic_8h.html">deal.II/fe/mapping_q_generic.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__out_8h.html">deal.II/grid/grid_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2manifold__lib_8h.html">deal.II/grid/manifold_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria__accessor_8h.html">deal.II/grid/tria_accessor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria__iterator_8h.html">deal.II/grid/tria_iterator.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2precondition_8h.html">deal.II/lac/precondition.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2solver__cg_8h.html">deal.II/lac/solver_cg.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2vector_8h.html">deal.II/lac/vector.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
</div><!-- fragment --><p>In particular, we need to include the headers for the matrix-free framework:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_2fe__evaluation_8h.html">deal.II/matrix_free/fe_evaluation.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_2matrix__free_8h.html">deal.II/matrix_free/matrix_free.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_2operators_8h.html">deal.II/matrix_free/operators.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_2tools_8h.html">deal.II/matrix_free/tools.h</a>&gt;</span></div>
</div><!-- fragment --><p>And since we want to use a geometric multigrid preconditioner, we need also the multilevel headers:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__coarse_8h.html">deal.II/multigrid/mg_coarse.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__constrained__dofs_8h.html">deal.II/multigrid/mg_constrained_dofs.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__matrix_8h.html">deal.II/multigrid/mg_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__smoother_8h.html">deal.II/multigrid/mg_smoother.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__tools_8h.html">deal.II/multigrid/mg_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__transfer__matrix__free_8h.html">deal.II/multigrid/mg_transfer_matrix_free.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2multigrid_8h.html">deal.II/multigrid/multigrid.h</a>&gt;</span></div>
</div><!-- fragment --><p>Finally some common C++ headers for in and output:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>Step66</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
</div><!-- fragment --><p><a class="anchor" id="MatrixfreeJacobianOperator"></a> </p><h3>Matrix-free JacobianOperator</h3>
<p>In the beginning we define the matrix-free operator for the Jacobian. As a guideline we follow the tutorials <a class="el" href="step_37.html">step-37</a> and <a class="el" href="step_48.html">step-48</a>, where the precise interface of the <a class="el" href="classMatrixFreeOperators_1_1Base.html">MatrixFreeOperators::Base</a> class was extensively documented.</p>
<p>Since we want to use the Jacobian as system matrix and pass it to the linear solver as well as to the multilevel preconditioner classes, we derive the <code>JacobianOperator</code> class from the <a class="el" href="classMatrixFreeOperators_1_1Base.html">MatrixFreeOperators::Base</a> class, such that we have already the right interface. The two functions we need to override from the base class are the <a class="el" href="classMatrixFreeOperators_1_1Base.html#abc81493aad390198580330cc99203b3c">MatrixFreeOperators::Base::apply_add()</a> and the <a class="el" href="classMatrixFreeOperators_1_1Base.html#a16d883c49c69eef468b39b2e991d8b0d">MatrixFreeOperators::Base::compute_diagonal()</a> function. To allow preconditioning with float precision we define the number type as template argument.</p>
<p>As mentioned already in the introduction, we need to evaluate the Jacobian \(F&#39;\) at the last Newton step \(u_h^n\) for the computation of the Newton update \(s_h^n\). To get the information of the last Newton step \(u_h^n\) we do pretty much the same as in <a class="el" href="step_37.html">step-37</a>, where we stored the values of a coefficient function in a table <code>nonlinear_values</code> once before we use the matrix-free operator. Instead of a function <code>evaluate_coefficient()</code>, we here implement a function <code>evaluate_newton_step()</code>.</p>
<p>As additional private member functions of the <code>JacobianOperator</code> we implement the <code>local_apply()</code> and the <code>local_compute_diagonal()</code> function. The first one is the actual worker function for the matrix-vector application, which we pass to the <a class="el" href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">MatrixFree::cell_loop()</a> in the <code>apply_add()</code> function. The later one is the worker function to compute the diagonal, which we pass to the <a class="el" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">MatrixFreeTools::compute_diagonal()</a> function.</p>
<p>For better readability of the source code we further define an alias for the <a class="el" href="classFEEvaluation.html">FEEvaluation</a> object.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line"><span class="keyword">class </span>JacobianOperator</div>
<div class="line">  : <span class="keyword">public</span> <a class="code" href="namespaceMatrixFreeOperators.html">MatrixFreeOperators</a>::</div>
<div class="line">      Base&lt;dim, LinearAlgebra::distributed::Vector&lt;number&gt;&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">using</span> <a class="code" href="classtypename_01MatrixType_1_1value__type.html">value_type</a> = number;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using</span> FECellIntegrator =</div>
<div class="line">    <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, fe_degree, fe_degree + 1, 1, number&gt;</a>;</div>
<div class="line"> </div>
<div class="line">  JacobianOperator();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">void</span> clear() <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> evaluate_newton_step(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;newton_step);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">compute_diagonal</a>() <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">void</span> apply_add(</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      dst,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src) <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span></div>
<div class="line">  local_apply(<span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, number&gt;</a> &amp;                   data,</div>
<div class="line">              <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      dst,</div>
<div class="line">              <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src,</div>
<div class="line">              <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;cell_range) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> local_compute_diagonal(FECellIntegrator &amp;integrator) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTable.html">Table&lt;2, VectorizedArray&lt;number&gt;</a>&gt; nonlinear_values;</div>
<div class="line">};</div>
</div><!-- fragment --><p>The constructor of the <code>JacobianOperator</code> just calls the constructor of the base class <a class="el" href="classMatrixFreeOperators_1_1Base.html">MatrixFreeOperators::Base</a>, which is itself derived from the <a class="el" href="classSubscriptor.html">Subscriptor</a> class.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">JacobianOperator&lt;dim, fe_degree, number&gt;::JacobianOperator()</div>
<div class="line">  : <a class="code" href="namespaceMatrixFreeOperators.html">MatrixFreeOperators</a>::Base&lt;dim,</div>
<div class="line">                              <a class="code" href="namespaceLinearAlgebra.html">LinearAlgebra</a>::distributed::<a class="code" href="classVector.html">Vector</a>&lt;number&gt;&gt;()</div>
<div class="line">{}</div>
</div><!-- fragment --><p>The <code>clear()</code> function resets the table holding the values for the nonlinearity and call the <code>clear()</code> function of the base class.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line"><span class="keywordtype">void</span> JacobianOperator&lt;dim, fe_degree, number&gt;::clear()</div>
<div class="line">{</div>
<div class="line">  nonlinear_values.reinit(0, 0);</div>
<div class="line">  <a class="code" href="classMatrixFreeOperators_1_1Base.html">MatrixFreeOperators::Base&lt;dim, LinearAlgebra::distributed::Vector&lt;number&gt;</a>&gt;::</div>
<div class="line">    clear();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="EvaluationoftheoldNewtonstep"></a> </p><h4>Evaluation of the old Newton step</h4>
<p>The following <code>evaluate_newton_step()</code> function is based on the <code>evaluate_coefficient()</code> function from <a class="el" href="step_37.html">step-37</a>. However, it does not evaluate a function object, but evaluates a vector representing a finite element function, namely the last Newton step needed for the Jacobian. Therefore we set up a <a class="el" href="classFEEvaluation.html">FEEvaluation</a> object and evaluate the finite element function in the quadrature points with the FEEvaluation::read_dof_values_plain() and <a class="el" href="classFEEvaluation.html#a710c252e9dccc0c4ce07044cac3bdd9b">FEEvaluation::evaluate()</a> functions. We store the evaluated values of the finite element function directly in the <code>nonlinear_values</code> table.</p>
<p>This will work well and in the <code>local_apply()</code> function we can use the values stored in the table to apply the matrix-vector product. However, we can also optimize the implementation of the Jacobian at this stage. We can directly evaluate the nonlinear function <code>std::exp(newton_step[q])</code> and store these values in the table. This skips all evaluations of the nonlinearity in each call of the <code>vmult()</code> function.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line"><span class="keywordtype">void</span> JacobianOperator&lt;dim, fe_degree, number&gt;::evaluate_newton_step(</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;newton_step)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a> = this-&gt;data-&gt;n_cell_batches();</div>
<div class="line">  FECellIntegrator   phi(*this-&gt;data);</div>
<div class="line"> </div>
<div class="line">  nonlinear_values.reinit(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>, phi.n_q_points);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = 0; cell &lt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>; ++cell)</div>
<div class="line">    {</div>
<div class="line">      phi.reinit(cell);</div>
<div class="line">      phi.read_dof_values_plain(newton_step);</div>
<div class="line">      phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">        {</div>
<div class="line">          nonlinear_values(cell, q) = <a class="code" href="base_2vectorization_8h.html#a19f846bda83b7e3f4531daacb40c64e1">std::exp</a>(phi.get_value(q));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Nonlinearmatrixfreeoperatorapplication"></a> </p><h4>Nonlinear matrix-free operator application</h4>
<p>Now in the <code>local_apply()</code> function, which actually implements the cell wise action of the system matrix, we can use the information of the last Newton step stored in the table <code>nonlinear_values</code>. The rest of this function is basically the same as in <a class="el" href="step_37.html">step-37</a>. We set up the <a class="el" href="classFEEvaluation.html">FEEvaluation</a> object, gather and evaluate the values and gradients of the input vector <code>src</code>, submit the values and gradients according to the form of the Jacobian and finally call <a class="el" href="classFEEvaluation.html#a491779be7bd032d277e41f1dda8dc584">FEEvaluation::integrate_scatter()</a> to perform the cell integration and distribute the local contributions into the global vector <code> dst</code>.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line"><span class="keywordtype">void</span> JacobianOperator&lt;dim, fe_degree, number&gt;::local_apply(</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, number&gt;</a> &amp;                   data,</div>
<div class="line">  <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      dst,</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src,</div>
<div class="line">  <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;     cell_range)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  FECellIntegrator phi(data);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = cell_range.first; cell &lt; cell_range.second; ++cell)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(nonlinear_values.size(0),</div>
<div class="line">                      phi.get_matrix_free().n_cell_batches());</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(nonlinear_values.size(1), phi.n_q_points);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      phi.reinit(cell);</div>
<div class="line"> </div>
<div class="line">      phi.gather_evaluate(src,</div>
<div class="line">                          <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> |</div>
<div class="line">                            <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">        {</div>
<div class="line">          phi.submit_value(-nonlinear_values(cell, q) * phi.get_value(q), q);</div>
<div class="line">          phi.submit_gradient(phi.get_gradient(q), q);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      phi.integrate_scatter(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> |</div>
<div class="line">                              <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>,</div>
<div class="line">                            dst);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Next we use <a class="el" href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">MatrixFree::cell_loop()</a> to perform the actual loop over all cells computing the cell contribution to the matrix-vector product.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line"><span class="keywordtype">void</span> JacobianOperator&lt;dim, fe_degree, number&gt;::apply_add(</div>
<div class="line">  <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      dst,</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  this-&gt;data-&gt;<a class="code" href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">cell_loop</a>(&amp;JacobianOperator::local_apply, <span class="keyword">this</span>, dst, src);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="DiagonaloftheJacobianOperator"></a> </p><h4>Diagonal of the JacobianOperator</h4>
<p>The internal worker function <code>local_compute_diagonal()</code> for the computation of the diagonal is similar to the above worker function <code>local_apply()</code>. However, as major difference we do not read values from a input vector or distribute any local results to an output vector. Instead the only input argument is the used <a class="el" href="classFEEvaluation.html">FEEvaluation</a> object.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line"><span class="keywordtype">void</span> JacobianOperator&lt;dim, fe_degree, number&gt;::local_compute_diagonal(</div>
<div class="line">  FECellIntegrator &amp;phi)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(nonlinear_values.size(0),</div>
<div class="line">                  phi.get_matrix_free().n_cell_batches());</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(nonlinear_values.size(1), phi.n_q_points);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = phi.get_current_cell_index();</div>
<div class="line"> </div>
<div class="line">  phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> | <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">    {</div>
<div class="line">      phi.submit_value(-nonlinear_values(cell, q) * phi.get_value(q), q);</div>
<div class="line">      phi.submit_gradient(phi.get_gradient(q), q);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  phi.integrate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> | <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Finally we override the <a class="el" href="classMatrixFreeOperators_1_1Base.html#a16d883c49c69eef468b39b2e991d8b0d">MatrixFreeOperators::Base::compute_diagonal()</a> function of the base class of the <code>JacobianOperator</code>. Although the name of the function suggests just the computation of the diagonal, this function does a bit more. Because we only really need the inverse of the matrix diagonal elements for the Chebyshev smoother of the multigrid preconditioner, we compute the diagonal and store the inverse elements. Therefore we first initialize the <code>inverse_diagonal_entries</code>. Then we compute the diagonal by passing the worker function <code>local_compute_diagonal()</code> to the <a class="el" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">MatrixFreeTools::compute_diagonal()</a> function. In the end we loop over the diagonal and invert the elements by hand. Note, that during this loop we catch the constrained DOFs and set them manually to one.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">JacobianOperator&lt;dim, fe_degree, number&gt;::compute_diagonal</a>()</div>
<div class="line">{</div>
<div class="line">  this-&gt;inverse_diagonal_entries.reset(</div>
<div class="line">    <span class="keyword">new</span> <a class="code" href="classDiagonalMatrix.html">DiagonalMatrix</a>&lt;<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a>&gt;());</div>
<div class="line">  <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;inverse_diagonal =</div>
<div class="line">    this-&gt;inverse_diagonal_entries-&gt;get_vector();</div>
<div class="line">  this-&gt;data-&gt;<a class="code" href="classMatrixFree.html#ab92a24942737bbaf04d7e00aceba9b57">initialize_dof_vector</a>(inverse_diagonal);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">MatrixFreeTools::compute_diagonal</a>(*this-&gt;data,</div>
<div class="line">                                    inverse_diagonal,</div>
<div class="line">                                    &amp;JacobianOperator::local_compute_diagonal,</div>
<div class="line">                                    <span class="keyword">this</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;diagonal_element : inverse_diagonal)</div>
<div class="line">    {</div>
<div class="line">      diagonal_element = (<a class="code" href="base_2vectorization_8h.html#aafbdfdd72b6cfe4eae5fa7a16385582f">std::abs</a>(diagonal_element) &gt; 1.0e-10) ?</div>
<div class="line">                           (1.0 / diagonal_element) :</div>
<div class="line">                           1.0;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemclass"></a> </p><h3>GelfandProblem class</h3>
<p>After implementing the matrix-free operators we can now define the solver class for the <em>Gelfand problem</em>. This class is based on the common structure of all previous tutorial programs, in particular it is based on <a class="el" href="step_15.html">step-15</a>, solving also a nonlinear problem. Since we are using the matrix-free framework, we no longer need an assemble_system function any more, instead the information of the matrix is rebuilt in every call of the <code>vmult()</code> function. However, for the application of the Newton scheme we need to assemble the right hand side of the linearized problems and compute the residuals. Therefore, we implement an additional function <code>evaluate_residual()</code>, which we later call in the <code>assemble_rhs()</code> and the <code>compute_residual()</code> function. Finally, the typical <code>solve()</code> function here implements the Newton method, whereas the solution of the linearized system is computed in the function <code>compute_update()</code>. As the <a class="el" href="classMatrixFree.html">MatrixFree</a> framework handles the polynomial degree of the Lagrangian finite element method as a template parameter, we declare it also as a template parameter for the problem solver class.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keyword">class </span>GelfandProblem</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  GelfandProblem();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a>();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keywordtype">void</span> make_grid();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> setup_system();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> evaluate_residual(</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;      dst,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;src) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> local_evaluate_residual(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, double&gt;</a> &amp;                   data,</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;      dst,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;src,</div>
<div class="line">    <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;     cell_range) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> assemble_rhs();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> compute_residual(<span class="keyword">const</span> <span class="keywordtype">double</span> alpha);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> compute_update();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> solve();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> compute_solution_norm() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cycle) <span class="keyword">const</span>;</div>
</div><!-- fragment --><p>For the parallel computation we define a <a class="el" href="classparallel_1_1distributed_1_1Triangulation.html">parallel::distributed::Triangulation</a>. As the computational domain is a circle in 2D and a ball in 3D, we assign in addition to the <a class="el" href="classSphericalManifold.html">SphericalManifold</a> for boundary cells a <a class="el" href="classTransfiniteInterpolationManifold.html">TransfiniteInterpolationManifold</a> object for the mapping of the inner cells, which takes care of the inner cells. In this example we use an isoparametric finite element approach and thus use the <a class="el" href="classMappingQGeneric.html">MappingQGeneric</a> class. Note, that we could also create an instance of the <a class="el" href="classMappingQ.html">MappingQ</a> class and set the <code>use_mapping_q_on_all_cells</code> flags in the contructor call to <code>true</code>. For further details on the connection of <a class="el" href="classMappingQ.html">MappingQ</a> and <a class="el" href="classMappingQGeneric.html">MappingQGeneric</a> you may read the detailed description of these classes.</p>
<div class="fragment"><div class="line"><a class="code" href="classparallel_1_1distributed_1_1Triangulation.html">parallel::distributed::Triangulation&lt;dim&gt;</a> <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>;</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classMappingQGeneric.html">MappingQGeneric&lt;dim&gt;</a>                mapping;</div>
</div><!-- fragment --><p>As usual we then define the Lagrangian finite elements <a class="el" href="classFE__Q.html">FE_Q</a> and a <a class="el" href="classDoFHandler.html">DoFHandler</a>.</p>
<div class="fragment"><div class="line"><a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a>       fe;</div>
<div class="line"><a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> dof_handler;</div>
</div><!-- fragment --><p>For the linearized discrete system we define an <a class="el" href="classAffineConstraints.html">AffineConstraints</a> objects and the <code>system_matrix</code>, which is in this example represented as a matrix-free operator.</p>
<div class="fragment"><div class="line"><a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> constraints;</div>
<div class="line"><span class="keyword">using</span> SystemMatrixType = JacobianOperator&lt;dim, fe_degree, double&gt;;</div>
<div class="line">SystemMatrixType system_matrix;</div>
</div><!-- fragment --><p>The multilevel object is also based on the matrix-free operator for the Jacobian. Since we need to evaluate the Jacobian with the last Newton step, we also need to evaluate the level operator with the last Newton step for the preconditioner. Thus in addition to <code>mg_matrices</code>, we also need a <a class="el" href="classMGLevelObject.html">MGLevelObject</a> to store the interpolated solution vector on each level. As in <a class="el" href="step_37.html">step-37</a> we use float precision for the preconditioner. Moreover, we define the <a class="el" href="classMGTransferMatrixFree.html">MGTransferMatrixFree</a> object as a class variable, since we need to set it up only once when the triangulation has changed and can then use it again in each Newton step.</p>
<div class="fragment"><div class="line"><a class="code" href="classMGConstrainedDoFs.html">MGConstrainedDoFs</a> mg_constrained_dofs;</div>
<div class="line"><span class="keyword">using</span> LevelMatrixType = JacobianOperator&lt;dim, fe_degree, float&gt;;</div>
<div class="line"><a class="code" href="classMGLevelObject.html">MGLevelObject&lt;LevelMatrixType&gt;</a>                           mg_matrices;</div>
<div class="line"><a class="code" href="classMGLevelObject.html">MGLevelObject&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt; mg_solution;</div>
<div class="line"><a class="code" href="classMGTransferMatrixFree.html">MGTransferMatrixFree&lt;dim, float&gt;</a>                         mg_transfer;</div>
</div><!-- fragment --><p>Of course we also need vectors holding the <code>solution</code>, the <code>newton_update</code> and the <code>system_rhs</code>. In that way we can always store the last Newton step in the solution vector and just add the update to get the next Newton step.</p>
<div class="fragment"><div class="line"><a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> solution;</div>
<div class="line"><a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> newton_update;</div>
<div class="line"><a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> system_rhs;</div>
</div><!-- fragment --><p>Finally we have a variable for the number of iterations of the linear solver.</p>
<div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> linear_iterations;</div>
</div><!-- fragment --><p>For the output in programs running in parallel with MPI, we use the <a class="el" href="classConditionalOStream.html">ConditionalOStream</a> class to avoid multiple output of the same data by different MPI ranks.</p>
<div class="fragment"><div class="line"><a class="code" href="classConditionalOStream.html">ConditionalOStream</a> pcout;</div>
</div><!-- fragment --><p>Finally for the time measurement we use a <a class="el" href="classTimerOutput.html">TimerOutput</a> object, which prints the elapsed CPU and wall times for each function in a nicely formatted table after the program has finished.</p>
<div class="fragment"><div class="line">  <a class="code" href="classTimerOutput.html">TimerOutput</a> computing_timer;</div>
<div class="line">};</div>
</div><!-- fragment --><p>The constructor of the <code>GelfandProblem</code> initializes the class variables. In particular, we set up the multilevel support for the <a class="el" href="classparallel_1_1distributed_1_1Triangulation.html">parallel::distributed::Triangulation</a>, set the mapping degree equal to the finite element degree, initialize the <a class="el" href="classConditionalOStream.html">ConditionalOStream</a> and tell the <a class="el" href="classTimerOutput.html">TimerOutput</a> that we want to see the wall times only on demand.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">GelfandProblem&lt;dim, fe_degree&gt;::GelfandProblem()</div>
<div class="line">  : <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>(MPI_COMM_WORLD,</div>
<div class="line">                  <a class="code" href="classTriangulation.html">Triangulation</a>&lt;dim&gt;::limit_level_difference_at_vertices,</div>
<div class="line">                  <a class="code" href="namespaceparallel.html">parallel</a>::distributed::<a class="code" href="classTriangulation.html">Triangulation</a>&lt;</div>
<div class="line">                    dim&gt;::<a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0a3901e6a241f812109912537866771e4c">construct_multigrid_hierarchy</a>)</div>
<div class="line">  , mapping(fe_degree)</div>
<div class="line">  , fe(fe_degree)</div>
<div class="line">  , dof_handler(<a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>)</div>
<div class="line">  , pcout(std::cout, <a class="code" href="namespaceUtilities.html">Utilities</a>::MPI::<a class="code" href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">this_mpi_process</a>(MPI_COMM_WORLD) == 0)</div>
<div class="line">  , computing_timer(MPI_COMM_WORLD,</div>
<div class="line">                    pcout,</div>
<div class="line">                    <a class="code" href="classTimerOutput.html">TimerOutput</a>::never,</div>
<div class="line">                    <a class="code" href="classTimerOutput.html">TimerOutput</a>::wall_times)</div>
<div class="line">{}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemmake_grid"></a> </p><h4>GelfandProblem::make_grid</h4>
<p>As the computational domain we use the <code>dim</code>-dimensional unit ball. We follow the instructions for the <a class="el" href="classTransfiniteInterpolationManifold.html">TransfiniteInterpolationManifold</a> class and also assign a <a class="el" href="classSphericalManifold.html">SphericalManifold</a> for the boundary. Finally, we refine the initial mesh 3 - <code>dim</code> times globally.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::make_grid()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;make grid&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classSphericalManifold.html">SphericalManifold&lt;dim&gt;</a>                boundary_manifold;</div>
<div class="line">  <a class="code" href="classTransfiniteInterpolationManifold.html">TransfiniteInterpolationManifold&lt;dim&gt;</a> inner_manifold;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceGridGenerator.html#a533c4778cbc9bcbed365dcab42ca4418">GridGenerator::hyper_ball</a>(<a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.set_all_manifold_ids(1);</div>
<div class="line">  <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.set_all_manifold_ids_on_boundary(0);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.set_manifold(0, boundary_manifold);</div>
<div class="line"> </div>
<div class="line">  inner_manifold.<a class="code" href="classTransfiniteInterpolationManifold.html#a34326a35d9ec4b6911d90c85c21847d8">initialize</a>(<a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>);</div>
<div class="line">  <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.set_manifold(1, inner_manifold);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.refine_global(3 - dim);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemsetup_system"></a> </p><h4>GelfandProblem::setup_system</h4>
<p>The <code>setup_system()</code> function is quasi identical to the one in <a class="el" href="step_37.html">step-37</a>. The only differences are obviously the time measurement with only one <a class="el" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> instead of measuring each part individually, and more importantly the initialization of the <a class="el" href="classMGLevelObject.html">MGLevelObject</a> for the interpolated solution vector of the previous Newton step. Another important change is the setup of the <a class="el" href="classMGTransferMatrixFree.html">MGTransferMatrixFree</a> object, which we can reuse in each Newton step as the <code>triangulation</code> will not be not changed.</p>
<p>Note how we can use the same <a class="el" href="classMatrixFree.html">MatrixFree</a> object twice, for the <code>JacobianOperator</code> and the multigrid preconditioner.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::setup_system()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;setup system&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  system_matrix.clear();</div>
<div class="line">  mg_matrices.clear_elements();</div>
<div class="line"> </div>
<div class="line">  dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(fe);</div>
<div class="line">  dof_handler.<a class="code" href="classDoFHandler.html#a9aed31323cbd7619edac310c47e7a7ad">distribute_mg_dofs</a>();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classIndexSet.html">IndexSet</a> locally_relevant_dofs;</div>
<div class="line">  <a class="code" href="namespaceDoFTools.html#acad7e0841b9046eaafddc4c617ab1d9d">DoFTools::extract_locally_relevant_dofs</a>(dof_handler, locally_relevant_dofs);</div>
<div class="line"> </div>
<div class="line">  constraints.<a class="code" href="classAffineConstraints.html#addd15bc409c61d6f795f0132c574335b">clear</a>();</div>
<div class="line">  constraints.<a class="code" href="classAffineConstraints.html#a2c9d71b5b7e8851c25a411ccf34de986">reinit</a>(locally_relevant_dofs);</div>
<div class="line">  <a class="code" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a>(dof_handler, constraints);</div>
<div class="line">  <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(dof_handler,</div>
<div class="line">                                           0,</div>
<div class="line">                                           <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(),</div>
<div class="line">                                           constraints);</div>
<div class="line">  constraints.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div>
<div class="line"> </div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">typename</span> <a class="code" href="structMatrixFree_1_1AdditionalData.html">MatrixFree&lt;dim, double&gt;::AdditionalData</a> additional_data;</div>
<div class="line">    additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a0bcce2facca91b925d3e1a5a00c7704b">tasks_parallel_scheme</a> =</div>
<div class="line">      <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, double&gt;::AdditionalData::partition_color</a>;</div>
<div class="line">    additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#aa5d597e6c4441d273f4100b6139a2552">mapping_update_flags</a> =</div>
<div class="line">      (<a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> |</div>
<div class="line">       <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a>);</div>
<div class="line">    <span class="keyword">auto</span> system_mf_storage = std::make_shared&lt;MatrixFree&lt;dim, double&gt;&gt;();</div>
<div class="line">    system_mf_storage-&gt;reinit(mapping,</div>
<div class="line">                              dof_handler,</div>
<div class="line">                              constraints,</div>
<div class="line">                              <a class="code" href="classQGauss.html">QGauss&lt;1&gt;</a>(fe.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1),</div>
<div class="line">                              additional_data);</div>
<div class="line"> </div>
<div class="line">    system_matrix.initialize(system_mf_storage);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  system_matrix.initialize_dof_vector(solution);</div>
<div class="line">  system_matrix.initialize_dof_vector(newton_update);</div>
<div class="line">  system_matrix.initialize_dof_vector(system_rhs);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nlevels = <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.n_global_levels();</div>
<div class="line">  mg_matrices.resize(0, nlevels - 1);</div>
<div class="line">  mg_solution.resize(0, nlevels - 1);</div>
<div class="line"> </div>
<div class="line">  std::set&lt;types::boundary_id&gt; dirichlet_boundary;</div>
<div class="line">  dirichlet_boundary.insert(0);</div>
<div class="line">  mg_constrained_dofs.initialize(dof_handler);</div>
<div class="line">  mg_constrained_dofs.make_zero_boundary_constraints(dof_handler,</div>
<div class="line">                                                     dirichlet_boundary);</div>
<div class="line"> </div>
<div class="line">  mg_transfer.<a class="code" href="classMGTransferMatrixFree.html#a69e2b416ab209936f94db08e865cd92b">initialize_constraints</a>(mg_constrained_dofs);</div>
<div class="line">  mg_transfer.<a class="code" href="classMGTransferMatrixFree.html#a8f214ffade006cfa85e902a94902fc7b">build</a>(dof_handler);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; nlevels; ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classIndexSet.html">IndexSet</a> relevant_dofs;</div>
<div class="line">      <a class="code" href="namespaceDoFTools.html#a1fef7be07cf379b661646e39b9354e17">DoFTools::extract_locally_relevant_level_dofs</a>(dof_handler,</div>
<div class="line">                                                    <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>,</div>
<div class="line">                                                    relevant_dofs);</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> level_constraints;</div>
<div class="line">      level_constraints.<a class="code" href="classAffineConstraints.html#a2c9d71b5b7e8851c25a411ccf34de986">reinit</a>(relevant_dofs);</div>
<div class="line">      level_constraints.<a class="code" href="classAffineConstraints.html#aef97b22281acb10c914d79a3881e2735">add_lines</a>(</div>
<div class="line">        mg_constrained_dofs.get_boundary_indices(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line">      level_constraints.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">typename</span> <a class="code" href="structMatrixFree_1_1AdditionalData.html">MatrixFree&lt;dim, float&gt;::AdditionalData</a> additional_data;</div>
<div class="line">      additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a0bcce2facca91b925d3e1a5a00c7704b">tasks_parallel_scheme</a> =</div>
<div class="line">        <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, float&gt;::AdditionalData::partition_color</a>;</div>
<div class="line">      additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#aa5d597e6c4441d273f4100b6139a2552">mapping_update_flags</a> =</div>
<div class="line">        (<a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> |</div>
<div class="line">         <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a>);</div>
<div class="line">      additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a67c9ff01c51fb7fb3ada151b83cdd409">mg_level</a> = <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>;</div>
<div class="line">      <span class="keyword">auto</span> mg_mf_storage_level = std::make_shared&lt;MatrixFree&lt;dim, float&gt;&gt;();</div>
<div class="line">      mg_mf_storage_level-&gt;reinit(mapping,</div>
<div class="line">                                  dof_handler,</div>
<div class="line">                                  level_constraints,</div>
<div class="line">                                  <a class="code" href="classQGauss.html">QGauss&lt;1&gt;</a>(fe.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1),</div>
<div class="line">                                  additional_data);</div>
<div class="line"> </div>
<div class="line">      mg_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].initialize(mg_mf_storage_level,</div>
<div class="line">                                    mg_constrained_dofs,</div>
<div class="line">                                    <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line">      mg_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].initialize_dof_vector(mg_solution[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>]);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemevaluate_residual"></a> </p><h4>GelfandProblem::evaluate_residual</h4>
<p>Next we implement a function which evaluates the nonlinear discrete residual for a given input vector ( \(\texttt{dst} = F(\texttt{src})\)). This function is then used for the assembly of the right hand side of the linearized system and later for the computation of the residual of the next Newton step to check if we already reached the error tolerance. As this function should not affect any class variable we define it as a constant function. Internally we exploit the fast finite element evaluation through the <a class="el" href="classFEEvaluation.html">FEEvaluation</a> class and the <a class="el" href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">MatrixFree::cell_loop()</a>, similar to <code>apply_add()</code> function of the <code>JacobianOperator</code>.</p>
<p>First we create a pointer to the <a class="el" href="classMatrixFree.html">MatrixFree</a> object, which is stored in the <code>system_matrix</code>. Then we pass the worker function <code>local_evaluate_residual()</code> for the cell wise evaluation of the residual together with the input and output vector to the <a class="el" href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">MatrixFree::cell_loop()</a>. In addition, we enable the zero out of the output vector in the loop, which is more efficient than calling <code>dst = 0.0</code> separately before.</p>
<p>Note that with this approach we do not have to take care about the MPI related data exchange, since all the bookkeeping is done by the <a class="el" href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">MatrixFree::cell_loop()</a>.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::evaluate_residual(</div>
<div class="line">  <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;      dst,</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;src)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keyword">auto</span> matrix_free = system_matrix.get_matrix_free();</div>
<div class="line"> </div>
<div class="line">  matrix_free-&gt;cell_loop(</div>
<div class="line">    &amp;GelfandProblem::local_evaluate_residual, <span class="keyword">this</span>, dst, src, <span class="keyword">true</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemlocal_evaluate_residual"></a> </p><h4>GelfandProblem::local_evaluate_residual</h4>
<p>This is the internal worker function for the evaluation of the residual. Essentially it has the same structure as the <code>local_apply()</code> function of the <code>JacobianOperator</code> and evaluates the residual for the input vector <code>src</code> on the given set of cells <code>cell_range</code>. The difference to the above mentioned <code>local_apply()</code> function is, that we split the <a class="el" href="classFEEvaluation.html#ab53d5c08f460cfe6c9830ac14a427115">FEEvaluation::gather_evaluate()</a> function into FEEvaluation::read_dof_values_plain() and <a class="el" href="classFEEvaluation.html#a710c252e9dccc0c4ce07044cac3bdd9b">FEEvaluation::evaluate()</a>, since the input vector might have constrained DOFs.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::local_evaluate_residual(</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, double&gt;</a> &amp;                   data,</div>
<div class="line">  <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;      dst,</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;src,</div>
<div class="line">  <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;     cell_range)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, fe_degree, fe_degree + 1, 1, double&gt;</a> phi(data);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = cell_range.first; cell &lt; cell_range.second; ++cell)</div>
<div class="line">    {</div>
<div class="line">      phi.reinit(cell);</div>
<div class="line"> </div>
<div class="line">      phi.read_dof_values_plain(src);</div>
<div class="line">      phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> | <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">        {</div>
<div class="line">          phi.submit_value(-std::exp(phi.get_value(q)), q);</div>
<div class="line">          phi.submit_gradient(phi.get_gradient(q), q);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      phi.integrate_scatter(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> |</div>
<div class="line">                              <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>,</div>
<div class="line">                            dst);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemassemble_rhs"></a> </p><h4>GelfandProblem::assemble_rhs</h4>
<p>Using the above function <code>evaluate_residual()</code> to evaluate the nonlinear residual, the assembly of the right hand side of the linearized system becomes now a very easy task. We just call the <code>evaluate_residual()</code> function and multiply the result with minus one.</p>
<p>Experiences show that using the <a class="el" href="classFEEvaluation.html">FEEvaluation</a> class is much faster than a classical implementation with <a class="el" href="classFEValues.html">FEValues</a> and co.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::assemble_rhs()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;assemble right hand side&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  evaluate_residual(system_rhs, solution);</div>
<div class="line"> </div>
<div class="line">  system_rhs *= -1.0;</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemcompute_residual"></a> </p><h4>GelfandProblem::compute_residual</h4>
<p>According to <a class="el" href="step_15.html">step-15</a> the following function computes the norm of the nonlinear residual for the solution \(u_h^n + \alpha s_h^n\) with the help of the <code>evaluate_residual()</code> function. The Newton step length \(\alpha\) becomes important if we would use an adaptive version of the Newton method. Then for example we would compute the residual for different step lengths and compare the residuals. However, for our problem the full Newton step with \(\alpha=1\) is the best we can do. An adaptive version of Newton's method becomes interesting if we have no good initial value. Note that in theory Newton's method converges with quadratic order, but only if we have an appropriate initial value. For unsuitable initial values the Newton method diverges even with quadratic order. A common way is then to use a damped version \(\alpha&lt;1\) until the Newton step is good enough and the full Newton step can be performed. This was also discussed in <a class="el" href="step_15.html">step-15</a>.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">double</span> GelfandProblem&lt;dim, fe_degree&gt;::compute_residual(<span class="keyword">const</span> <span class="keywordtype">double</span> alpha)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;compute residual&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> residual;</div>
<div class="line">  <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> evaluation_point;</div>
<div class="line"> </div>
<div class="line">  system_matrix.initialize_dof_vector(residual);</div>
<div class="line">  system_matrix.initialize_dof_vector(evaluation_point);</div>
<div class="line"> </div>
<div class="line">  evaluation_point = solution;</div>
<div class="line">  <span class="keywordflow">if</span> (alpha &gt; 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a496b854daac5cca870bc8008f562daad">e</a>-12)</div>
<div class="line">    {</div>
<div class="line">      evaluation_point.<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html#ac029174b48a0707da587b6ce3bc25047">add</a>(alpha, newton_update);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  evaluate_residual(residual, evaluation_point);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> residual.<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html#af355599021a687026ab9818efd57e82d">l2_norm</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemcompute_update"></a> </p><h4>GelfandProblem::compute_update</h4>
<p>In order to compute the Newton updates in each Newton step we solve the linear system with the CG algorithm together with a geometric multigrid preconditioner. For this we first set up the <a class="el" href="classPreconditionMG.html">PreconditionMG</a> object with a Chebyshev smoother like we did in <a class="el" href="step_37.html">step-37</a>.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::compute_update()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;compute update&quot;</span>);</div>
</div><!-- fragment --><p>We remember that the Jacobian depends on the last Newton step stored in the solution vector. So we update the ghost values of the Newton step and pass it to the <code>JacobianOperator</code> to store the information.</p>
<div class="fragment"><div class="line">solution.update_ghost_values();</div>
<div class="line"> </div>
<div class="line">system_matrix.evaluate_newton_step(solution);</div>
</div><!-- fragment --><p>Next we also have to pass the last Newton step to the multilevel operators. Therefore, we need to interpolate the Newton step to all levels of the triangulation. This is done with the <a class="el" href="classMGTransferMatrixFree.html#a90aef560cc3d832589ca13a5f18e1414">MGTransferMatrixFree::interpolate_to_mg()</a>.</p>
<div class="fragment"><div class="line">mg_transfer.<a class="code" href="classMGTransferMatrixFree.html#a90aef560cc3d832589ca13a5f18e1414">interpolate_to_mg</a>(dof_handler, mg_solution, solution);</div>
</div><!-- fragment --><p>Now we can set up the preconditioner. We define the smoother and pass the interpolated vectors of the Newton step to the multilevel operators.</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> SmootherType =</div>
<div class="line">  <a class="code" href="classPreconditionChebyshev.html">PreconditionChebyshev</a>&lt;LevelMatrixType,</div>
<div class="line">                        <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt;;</div>
<div class="line"><a class="code" href="classmg_1_1SmootherRelaxation.html">mg::SmootherRelaxation</a>&lt;SmootherType,</div>
<div class="line">                       <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt;</div>
<div class="line">                                                     mg_smoother;</div>
<div class="line"><a class="code" href="classMGLevelObject.html">MGLevelObject&lt;typename SmootherType::AdditionalData&gt;</a> smoother_data;</div>
<div class="line">smoother_data.<a class="code" href="classMGLevelObject.html#a16213121f9153bd08f49652a11886259">resize</a>(0, <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.n_global_levels() - 1);</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.n_global_levels();</div>
<div class="line">     ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &gt; 0)</div>
<div class="line">      {</div>
<div class="line">        smoother_data[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].smoothing_range     = 15.;</div>
<div class="line">        smoother_data[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].degree              = 4;</div>
<div class="line">        smoother_data[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].eig_cg_n_iterations = 10;</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        smoother_data[0].smoothing_range = 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a496b854daac5cca870bc8008f562daad">e</a>-3;</div>
<div class="line">        smoother_data[0].degree          = <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>;</div>
<div class="line">        smoother_data[0].eig_cg_n_iterations = mg_matrices[0].m();</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    mg_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].evaluate_newton_step(mg_solution[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>]);</div>
<div class="line">    mg_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].compute_diagonal();</div>
<div class="line"> </div>
<div class="line">    smoother_data[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].preconditioner =</div>
<div class="line">      mg_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].get_matrix_diagonal_inverse();</div>
<div class="line">  }</div>
<div class="line">mg_smoother.initialize(mg_matrices, smoother_data);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classMGCoarseGridApplySmoother.html">MGCoarseGridApplySmoother&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt;</div>
<div class="line">  mg_coarse;</div>
<div class="line">mg_coarse.<a class="code" href="classMGCoarseGridApplySmoother.html#a499c7364e40031332e9943a2e5f331a2">initialize</a>(mg_smoother);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt; mg_matrix(</div>
<div class="line">  mg_matrices);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classMGLevelObject.html">MGLevelObject&lt;MatrixFreeOperators::MGInterfaceOperator&lt;LevelMatrixType&gt;</a>&gt;</div>
<div class="line">  mg_interface_matrices;</div>
<div class="line">mg_interface_matrices.<a class="code" href="classMGLevelObject.html#a16213121f9153bd08f49652a11886259">resize</a>(0, <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.n_global_levels() - 1);</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.n_global_levels();</div>
<div class="line">     ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">  {</div>
<div class="line">    mg_interface_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].initialize(mg_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>]);</div>
<div class="line">  }</div>
<div class="line"><a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt; mg_interface(</div>
<div class="line">  mg_interface_matrices);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classMultigrid.html">Multigrid&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt; <a class="code" href="namespacemg.html">mg</a>(</div>
<div class="line">  mg_matrix, mg_coarse, mg_transfer, mg_smoother, mg_smoother);</div>
<div class="line"><a class="code" href="namespacemg.html">mg</a>.set_edge_matrices(mg_interface, mg_interface);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classPreconditionMG.html">PreconditionMG</a>&lt;dim,</div>
<div class="line">               <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;float&gt;</a>,</div>
<div class="line">               <a class="code" href="classMGTransferMatrixFree.html">MGTransferMatrixFree&lt;dim, float&gt;</a>&gt;</div>
<div class="line">  preconditioner(dof_handler, <a class="code" href="namespacemg.html">mg</a>, mg_transfer);</div>
</div><!-- fragment --><p>Finally we set up the <a class="el" href="classSolverControl.html">SolverControl</a> and the <a class="el" href="classSolverCG.html">SolverCG</a> to solve the linearized problem for the current Newton update. An important fact of the implementation of <a class="el" href="classSolverCG.html">SolverCG</a> or also <a class="el" href="classSolverGMRES.html">SolverGMRES</a> is, that the vector holding the solution of the linear system (here <code>newton_update</code>) can be used to pass a starting value. In order to start the iterative solver always with a zero vector we reset the <code>newton_update</code> explicitly before calling <a class="el" href="classSolverCG.html#aa52469650d9b9ef2f4cb4884caeb0723">SolverCG::solve()</a>. Afterwards we distribute the Dirichlet boundary conditions stored in <code>constraints</code> and store the number of iteration steps for the later output.</p>
<div class="fragment"><div class="line"><a class="code" href="classSolverControl.html">SolverControl</a> solver_control(100, 1.<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a496b854daac5cca870bc8008f562daad">e</a>-12);</div>
<div class="line"><a class="code" href="classSolverCG.html">SolverCG&lt;LinearAlgebra::distributed::Vector&lt;double&gt;</a>&gt; cg(solver_control);</div>
<div class="line"> </div>
<div class="line">newton_update = 0.0;</div>
<div class="line"> </div>
<div class="line">cg.solve(system_matrix, newton_update, system_rhs, preconditioner);</div>
<div class="line"> </div>
<div class="line">constraints.<a class="code" href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">distribute</a>(newton_update);</div>
<div class="line"> </div>
<div class="line">linear_iterations = solver_control.<a class="code" href="classSolverControl.html#a42aeae81cd6b67ce93b5fbea3328371f">last_step</a>();</div>
</div><!-- fragment --><p>Then for bookkeeping we zero out the ghost values.</p>
<div class="fragment"><div class="line">  solution.zero_out_ghost_values();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemsolve"></a> </p><h4>GelfandProblem::solve</h4>
<p>Now we implement the actual Newton solver for the nonlinear problem.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::solve()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;solve&quot;</span>);</div>
</div><!-- fragment --><p>We define a maximal number of Newton steps and tolerances for the convergence criterion. Usually, with good starting values, the Newton method converges in three to six steps, so maximal ten steps should be totally sufficient. As tolerances we use \(\|F(u^n_h)\|&lt;\text{TOL}_f = 10^{-12}\) for the norm of the residual and \(\|s_h^n\| &lt; \text{TOL}_x = 10^{-10}\) for the norm of the Newton update. This seems a bit over the top, but we will see that, for our example, we will achieve these tolerances after a few steps.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> itmax = 10;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span>       TOLf  = 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a496b854daac5cca870bc8008f562daad">e</a>-12;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span>       TOLx  = 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a496b854daac5cca870bc8008f562daad">e</a>-10;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><a class="code" href="classTimer.html">Timer</a> solver_timer;</div>
<div class="line">solver_timer.<a class="code" href="classTimer.html#a3a8b5272198d029779dc9302a54305a8">start</a>();</div>
</div><!-- fragment --><p>Now we start the actual Newton iteration.</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> newton_step = 1; newton_step &lt;= itmax; ++newton_step)</div>
<div class="line">  {</div>
</div><!-- fragment --><p>We assemble the right hand side of the linearized problem and compute the Newton update.</p>
<div class="fragment"><div class="line">assemble_rhs();</div>
<div class="line">compute_update();</div>
</div><!-- fragment --><p>Then we compute the errors, namely the norm of the Newton update and the residual. Note that at this point one could incorporate a step size control for the Newton method by varying the input parameter \(\alpha\) for the compute_residual function. However, here we just use \(\alpha\) equal to one for a plain Newton iteration.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> ERRx = newton_update.<a class="code" href="classBlockVectorBase.html#ac718033fc083f27c45c6bfb4ac780360">l2_norm</a>();</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> ERRf = compute_residual(1.0);</div>
</div><!-- fragment --><p>Next we advance the Newton step by adding the Newton update to the current Newton step.</p>
<div class="fragment"><div class="line">solution.add(1.0, newton_update);</div>
</div><!-- fragment --><p>A short output will inform us on the current Newton step.</p>
<div class="fragment"><div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;   Nstep &quot;</span> &lt;&lt; newton_step &lt;&lt; <span class="stringliteral">&quot;, errf = &quot;</span> &lt;&lt; ERRf</div>
<div class="line">      &lt;&lt; <span class="stringliteral">&quot;, errx = &quot;</span> &lt;&lt; ERRx &lt;&lt; <span class="stringliteral">&quot;, it = &quot;</span> &lt;&lt; linear_iterations</div>
<div class="line">      &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>After each Newton step we check the convergence criteria. If at least one of those is fulfilled we are done and end the loop. If we haven't found a satisfying solution after the maximal amount of Newton iterations, we inform the user about this shortcoming.</p>
<div class="fragment"><div class="line">      <span class="keywordflow">if</span> (ERRf &lt; TOLf || ERRx &lt; TOLx)</div>
<div class="line">        {</div>
<div class="line">          solver_timer.<a class="code" href="classTimer.html#a988f79aa183d9d5473c13106f5babe48">stop</a>();</div>
<div class="line"> </div>
<div class="line">          pcout &lt;&lt; <span class="stringliteral">&quot;Convergence step &quot;</span> &lt;&lt; newton_step &lt;&lt; <span class="stringliteral">&quot; value &quot;</span> &lt;&lt; ERRf</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot; (used wall time: &quot;</span> &lt;&lt; solver_timer.<a class="code" href="classTimer.html#a6f3e76707411b51e7d7e7bfa5755cf02">wall_time</a>() &lt;&lt; <span class="stringliteral">&quot; s)&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (newton_step == itmax)</div>
<div class="line">        {</div>
<div class="line">          solver_timer.<a class="code" href="classTimer.html#a988f79aa183d9d5473c13106f5babe48">stop</a>();</div>
<div class="line">          pcout &lt;&lt; <span class="stringliteral">&quot;WARNING: No convergence of Newton&#39;s method after &quot;</span></div>
<div class="line">                &lt;&lt; newton_step &lt;&lt; <span class="stringliteral">&quot; steps.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemcompute_solution_norm"></a> </p><h4>GelfandProblem::compute_solution_norm</h4>
<p>The computation of the H1-seminorm of the solution can be done in the same way as in <a class="el" href="step_59.html">step-59</a>. We update the ghost values and use the function <a class="el" href="namespaceVectorTools.html#a676190d2c897ac5da68a9c460fa95832">VectorTools::integrate_difference()</a>. In the end we gather all computations from all MPI ranks and return the norm.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">double</span> GelfandProblem&lt;dim, fe_degree&gt;::compute_solution_norm()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  solution.update_ghost_values();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;float&gt;</a> norm_per_cell(<a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.n_active_cells());</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceVectorTools.html#a676190d2c897ac5da68a9c460fa95832">VectorTools::integrate_difference</a>(mapping,</div>
<div class="line">                                    dof_handler,</div>
<div class="line">                                    solution,</div>
<div class="line">                                    <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(),</div>
<div class="line">                                    norm_per_cell,</div>
<div class="line">                                    <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(fe.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 2),</div>
<div class="line">                                    <a class="code" href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1a7c450aee1986e226cf1bd7687171d769">VectorTools::H1_seminorm</a>);</div>
<div class="line"> </div>
<div class="line">  solution.zero_out_ghost_values();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="namespaceVectorTools.html#a21eb62d70953182dcc2b15c4e14dd533">VectorTools::compute_global_error</a>(<a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>,</div>
<div class="line">                                           norm_per_cell,</div>
<div class="line">                                           <a class="code" href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1a7c450aee1986e226cf1bd7687171d769">VectorTools::H1_seminorm</a>);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemoutput_results"></a> </p><h4>GelfandProblem::output_results</h4>
<p>We generate the graphical output files in vtu format together with a pvtu master file at once by calling the <a class="el" href="classDataOutInterface.html#a0864e51eb173c87e2a3edc9391ea8009">DataOut::write_vtu_with_pvtu_record()</a> function in the same way as in <a class="el" href="step_37.html">step-37</a>. In addition, as in <a class="el" href="step_40.html">step-40</a>, we query the <a class="el" href="namespacetypes.html#a34b501118128294d2bc316a1b052454f">types::subdomain_id</a> of each cell and write the distribution of the triangulation among the MPI ranks into the output file. Finally, we generate the patches of the solution by calling <a class="el" href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">DataOut::build_patches()</a>. However, since we have a computational domain with a curved boundary, we additionally pass the <code>mapping</code> and the finite element degree as number of subdivision. But this is still not enough for the correct representation of the solution, for example in ParaView, because we attached a <a class="el" href="classTransfiniteInterpolationManifold.html">TransfiniteInterpolationManifold</a> to the inner cells, which results in curved cells in the interior. Therefore we pass as third argument the <a class="el" href="classDataOut.html#a1303b5d99f10f3fae984e7d406cfeb37a7996b4e7bad0b5fe0630f3eb57d48313">DataOut::curved_inner_cells</a> option, such that also the inner cells use the corresponding manifold description to build the patches.</p>
<p>Note that we could handle the higher order elements with the flag <a class="el" href="group__Exceptions.html#gaa9dd1830c0ff35a2431704c4d45453eb">DataOutBase::VtkFlags::write_higher_order_cells</a>. However, due to the limited compatibility to previous version of ParaView and the missing support by VisIt, we left this option for a future version.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">GelfandProblem&lt;dim, fe_degree&gt;::output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cycle)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.n_global_active_cells() &gt; 1e6)</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">  solution.update_ghost_values();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">attach_dof_handler</a>(dof_handler);</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(solution, <span class="stringliteral">&quot;solution&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;float&gt;</a> subdomain(<a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.n_active_cells());</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; subdomain.size(); ++i)</div>
<div class="line">    {</div>
<div class="line">      subdomain(i) = <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.locally_owned_subdomain();</div>
<div class="line">    }</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(subdomain, <span class="stringliteral">&quot;subdomain&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  data_out.<a class="code" href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">build_patches</a>(mapping,</div>
<div class="line">                         fe.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a>,</div>
<div class="line">                         <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;::curved_inner_cells</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="structDataOutBase_1_1VtkFlags.html">DataOutBase::VtkFlags</a> flags;</div>
<div class="line">  flags.<a class="code" href="group__Exceptions.html#ga3be0d6de1c92b770e8664bce2fc7c107">compression_level</a> = <a class="code" href="group__Exceptions.html#ga7ad65742b9dbfb7eeb04b511b5a08d63a3c83e26f202f837328b9f7532773be70">DataOutBase::VtkFlags::best_speed</a>;</div>
<div class="line">  data_out.<a class="code" href="classDataOutInterface.html#ac7280a24690b117454acfb0fa058299c">set_flags</a>(flags);</div>
<div class="line">  data_out.<a class="code" href="classDataOutInterface.html#a0864e51eb173c87e2a3edc9391ea8009">write_vtu_with_pvtu_record</a>(</div>
<div class="line">    <span class="stringliteral">&quot;./&quot;</span>, <span class="stringliteral">&quot;solution_&quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(dim) + <span class="stringliteral">&quot;d&quot;</span>, cycle, MPI_COMM_WORLD, 3);</div>
<div class="line"> </div>
<div class="line">  solution.zero_out_ghost_values();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="GelfandProblemrun"></a> </p><h4>GelfandProblem::run</h4>
<p>The last missing function of the solver class for the <em>Gelfand problem</em> is the run function. In the beginning we print information about the system specifications and the finite element space we use. The problem is solved several times on a successively refined mesh.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">GelfandProblem&lt;dim, fe_degree&gt;::run</a>()</div>
<div class="line">{</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_ranks =</div>
<div class="line">      <a class="code" href="namespaceUtilities_1_1MPI.html#ac26de0c059200523177bb1d92cc25d00">Utilities::MPI::n_mpi_processes</a>(MPI_COMM_WORLD);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_vect_doubles = <a class="code" href="classVectorizedArrayBase.html#acb35404acc1693aee6e990228924cc09">VectorizedArray&lt;double&gt;::size</a>();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_vect_bits    = 8 * <span class="keyword">sizeof</span>(<a class="code" href="classdouble.html">double</a>) * n_vect_doubles;</div>
<div class="line"> </div>
<div class="line">    std::string DAT_header = <span class="stringliteral">&quot;START DATE: &quot;</span> + <a class="code" href="namespaceUtilities_1_1System.html#aff548b3b9b7a035ea112729700ef7c64">Utilities::System::get_date</a>() +</div>
<div class="line">                             <span class="stringliteral">&quot;, TIME: &quot;</span> + <a class="code" href="namespaceUtilities_1_1System.html#a76bc1cc7649cc416723f450d24fdd91d">Utilities::System::get_time</a>();</div>
<div class="line">    std::string MPI_header = <span class="stringliteral">&quot;Running with &quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(n_ranks) +</div>
<div class="line">                             <span class="stringliteral">&quot; MPI process&quot;</span> + (n_ranks &gt; 1 ? <span class="stringliteral">&quot;es&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">    std::string VEC_header =</div>
<div class="line">      <span class="stringliteral">&quot;Vectorization over &quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(n_vect_doubles) +</div>
<div class="line">      <span class="stringliteral">&quot; doubles = &quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(n_vect_bits) + <span class="stringliteral">&quot; bits (&quot;</span> +</div>
<div class="line">      <a class="code" href="namespaceUtilities_1_1System.html#ade631a789101336840371e3b2e2851e0">Utilities::System::get_current_vectorization_level</a>() +</div>
<div class="line">      <span class="stringliteral">&quot;), VECTORIZATION_LEVEL=&quot;</span> +</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(<a class="code" href="config_8h.html#a32dc208a29f23d1f031fb40b0d21e60e">DEAL_II_COMPILER_VECTORIZATION_LEVEL</a>);</div>
<div class="line">    std::string SOL_header = <span class="stringliteral">&quot;Finite element space: &quot;</span> + fe.<a class="code" href="classFiniteElement.html#a09655d1d2555af8dcd48caebd4039d29">get_name</a>();</div>
<div class="line"> </div>
<div class="line">    pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;=&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line">    pcout &lt;&lt; DAT_header &lt;&lt; std::endl;</div>
<div class="line">    pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;-&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    pcout &lt;&lt; MPI_header &lt;&lt; std::endl;</div>
<div class="line">    pcout &lt;&lt; VEC_header &lt;&lt; std::endl;</div>
<div class="line">    pcout &lt;&lt; SOL_header &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;=&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cycle = 0; cycle &lt; 9 - dim; ++cycle)</div>
<div class="line">    {</div>
<div class="line">      pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;-&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line">      pcout &lt;&lt; <span class="stringliteral">&quot;Cycle &quot;</span> &lt;&lt; cycle &lt;&lt; std::endl;</div>
<div class="line">      pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;-&#39;</span>) &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>The first task in actually solving the problem is to generate or refine the triangulation.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (cycle == 0)</div>
<div class="line">  {</div>
<div class="line">    make_grid();</div>
<div class="line">  }</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.refine_global(1);</div>
<div class="line">  }</div>
</div><!-- fragment --><p>Now we set up the system and solve the problem. These steps are accompanied by time measurement and textual output.</p>
<div class="fragment"><div class="line"><a class="code" href="classTimer.html">Timer</a> timer;</div>
<div class="line"> </div>
<div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;Set up system...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">setup_system();</div>
<div class="line"> </div>
<div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;   Triangulation: &quot;</span> &lt;&lt; <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.n_global_active_cells()</div>
<div class="line">      &lt;&lt; <span class="stringliteral">&quot; cells&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;   DoFHandler:    &quot;</span> &lt;&lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>() &lt;&lt; <span class="stringliteral">&quot; DoFs&quot;</span></div>
<div class="line">      &lt;&lt; std::endl;</div>
<div class="line">pcout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;Solve using Newton&#39;s method...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">solve();</div>
<div class="line">pcout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">timer.<a class="code" href="classTimer.html#a988f79aa183d9d5473c13106f5babe48">stop</a>();</div>
<div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;Time for setup+solve (CPU/Wall) &quot;</span> &lt;&lt; timer.<a class="code" href="classTimer.html#a4e3933a78790d7455daff5acab3f8432">cpu_time</a>() &lt;&lt; <span class="stringliteral">&quot;/&quot;</span></div>
<div class="line">      &lt;&lt; timer.<a class="code" href="classTimer.html#a6f3e76707411b51e7d7e7bfa5755cf02">wall_time</a>() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">pcout &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>After the problem was solved we compute the norm of the solution and generate the graphical output files.</p>
<div class="fragment"><div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;Output results...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespaceLocalIntegrators_1_1Divergence.html#a8bcfc37d2a2be8faa18628a601ecf112">norm</a> = compute_solution_norm();</div>
<div class="line">output_results(cycle);</div>
<div class="line"> </div>
<div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;  H1 seminorm: &quot;</span> &lt;&lt; <a class="code" href="namespaceLocalIntegrators_1_1Divergence.html#a8bcfc37d2a2be8faa18628a601ecf112">norm</a> &lt;&lt; std::endl;</div>
<div class="line">pcout &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>Finally after each cycle we print the timing information.</p>
<div class="fragment"><div class="line">        computing_timer.print_summary();</div>
<div class="line">        computing_timer.reset();</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Step66</span></div>
</div><!-- fragment --><p><a class="anchor" id="Thecodemaincodefunction"></a> </p><h3>The <code>main</code> function</h3>
<p>As typical for programs running in parallel with MPI we set up the MPI framework and disable shared-memory parallelization by limiting the number of threads to one. Finally to run the solver for the <em>Gelfand problem</em> we create an object of the <code>GelfandProblem</code> class and call the run function. Exemplarily we solve the problem once in 2D and once in 3D each with fourth-order Lagrangian finite elements.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">using namespace </span>Step66;</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classUtilities_1_1MPI_1_1MPI__InitFinalize.html">Utilities::MPI::MPI_InitFinalize</a> mpi_init(argc, argv, 1);</div>
<div class="line"> </div>
<div class="line">      {</div>
<div class="line">        GelfandProblem&lt;2, 4&gt; gelfand_problem;</div>
<div class="line">        gelfand_problem.run();</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      {</div>
<div class="line">        GelfandProblem&lt;3, 4&gt; gelfand_problem;</div>
<div class="line">        gelfand_problem.run();</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (std::exception &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p> <a class="anchor" id="Results"></a></p><h1>Results</h1>
<p>The aim of this tutorial step was to demonstrate the solution of a nonlinear PDE with the matrix-free framework.</p>
<p><a class="anchor" id="Programoutput"></a></p><h3>Program output</h3>
<p>Running the program on two processes in release mode via </p><div class="fragment"><div class="line">cmake . &amp;&amp; make release &amp;&amp; make &amp;&amp; mpirun -n 2 ./step-66</div>
</div><!-- fragment --><p> gives the following output on the console </p><div class="fragment"><div class="line">================================================================================</div>
<div class="line">START DATE: 2021/5/18, TIME: 16:25:48</div>
<div class="line">--------------------------------------------------------------------------------</div>
<div class="line">Running with 2 MPI processes</div>
<div class="line">Vectorization over 4 doubles = 256 bits (AVX), VECTORIZATION_LEVEL=2</div>
<div class="line">Finite element space: <a class="code" href="classFE__Q.html">FE_Q&lt;2&gt;</a>(4)</div>
<div class="line">================================================================================</div>
<div class="line">--------------------------------------------------------------------------------</div>
<div class="line">Cycle 0</div>
<div class="line">--------------------------------------------------------------------------------</div>
<div class="line">Set up system...</div>
<div class="line">   <a class="code" href="classTriangulation.html">Triangulation</a>: 20 cells</div>
<div class="line">   <a class="code" href="group__dofs.html#ga768cd565b5c25f1ac235586e36ac94d6">DoFHandler</a>:    337 DoFs</div>
<div class="line"> </div>
<div class="line">Solve <span class="keyword">using</span> Newton<span class="stringliteral">&#39;s method...</span></div>
<div class="line"><span class="stringliteral">   Nstep 1, errf = 0.00380835, errx = 3.61904, it = 7</span></div>
<div class="line"><span class="stringliteral">   Nstep 2, errf = 3.80167e-06, errx = 0.104353, it = 6</span></div>
<div class="line"><span class="stringliteral">   Nstep 3, errf = 3.97939e-12, errx = 0.00010511, it = 4</span></div>
<div class="line"><span class="stringliteral">   Nstep 4, errf = 2.28859e-13, errx = 1.07726e-10, it = 1</span></div>
<div class="line"><span class="stringliteral">Convergence step 4 value 2.28859e-13 (used wall time: 0.0096409 s)</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">Time for setup+solve (CPU/Wall) 0.015617/0.0156447 s</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">Output results...</span></div>
<div class="line"><span class="stringliteral">  H1 seminorm: 0.773426</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">+---------------------------------------------+------------+------------+</span></div>
<div class="line"><span class="stringliteral">| Total wallclock time elapsed since start    |    0.0286s |            |</span></div>
<div class="line"><span class="stringliteral">|                                             |            |            |</span></div>
<div class="line"><span class="stringliteral">| Section                         | no. calls |  wall time | % of total |</span></div>
<div class="line"><span class="stringliteral">+---------------------------------+-----------+------------+------------+</span></div>
<div class="line"><span class="stringliteral">| assemble right hand side        |         4 |  9.71e-05s |      0.34% |</span></div>
<div class="line"><span class="stringliteral">| compute residual                |         4 |  0.000137s |      0.48% |</span></div>
<div class="line"><span class="stringliteral">| compute update                  |         4 |   0.00901s |        32% |</span></div>
<div class="line"><span class="stringliteral">| make grid                       |         1 |   0.00954s |        33% |</span></div>
<div class="line"><span class="stringliteral">| setup system                    |         1 |   0.00585s |        20% |</span></div>
<div class="line"><span class="stringliteral">| solve                           |         1 |   0.00966s |        34% |</span></div>
<div class="line"><span class="stringliteral">+---------------------------------+-----------+------------+------------+</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">.</span></div>
<div class="line"><span class="stringliteral">.</span></div>
<div class="line"><span class="stringliteral">.</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">--------------------------------------------------------------------------------</span></div>
<div class="line"><span class="stringliteral">Cycle 6</span></div>
<div class="line"><span class="stringliteral">--------------------------------------------------------------------------------</span></div>
<div class="line"><span class="stringliteral">Set up system...</span></div>
<div class="line"><span class="stringliteral">   Triangulation: 81920 cells</span></div>
<div class="line"><span class="stringliteral">   DoFHandler:    1311745 DoFs</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">Solve using Newton&#39;</span>s method...</div>
<div class="line">   Nstep 1, errf = 5.90478e-05, errx = 231.427, it = 9</div>
<div class="line">   Nstep 2, errf = 5.89991e-08, errx = 6.67102, it = 6</div>
<div class="line">   Nstep 3, errf = 4.28813e-13, errx = 0.0067188, it = 4</div>
<div class="line">Convergence step 3 <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a> 4.28813e-13 (used wall time: 4.82953 s)</div>
<div class="line"> </div>
<div class="line">Time <span class="keywordflow">for</span> setup+solve (CPU/Wall) 6.25094/6.37174 s</div>
<div class="line"> </div>
<div class="line">Output results...</div>
<div class="line">  H1 seminorm: 0.773426</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">+---------------------------------------------+------------+------------+</div>
<div class="line">| Total wallclock time elapsed since start    |      9.04s |            |</div>
<div class="line">|                                             |            |            |</div>
<div class="line">| Section                         | no. calls |  wall time | % of total |</div>
<div class="line">+---------------------------------+-----------+------------+------------+</div>
<div class="line">| <a class="code" href="namespaceinternal.html#a2b3d48efdf7c94da455dc6a3553bab79">assemble</a> right hand side        |         3 |    0.0827s |      0.91% |</div>
<div class="line">| compute residual                |         3 |    0.0909s |         1% |</div>
<div class="line">| compute update                  |         3 |      4.65s |        51% |</div>
<div class="line">| setup system                    |         1 |      1.54s |        17% |</div>
<div class="line">| solve                           |         1 |      4.83s |        53% |</div>
<div class="line">+---------------------------------+-----------+------------+------------+</div>
<div class="line"> </div>
<div class="line">================================================================================</div>
<div class="line">START DATE: 2021/5/18, TIME: 16:26:00</div>
<div class="line">--------------------------------------------------------------------------------</div>
<div class="line">Running with 2 MPI processes</div>
<div class="line">Vectorization over 4 doubles = 256 bits (AVX), VECTORIZATION_LEVEL=2</div>
<div class="line">Finite element space: <a class="code" href="classFE__Q.html">FE_Q&lt;3&gt;</a>(4)</div>
<div class="line">================================================================================</div>
<div class="line"> </div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line"> </div>
<div class="line">--------------------------------------------------------------------------------</div>
<div class="line">Cycle 5</div>
<div class="line">--------------------------------------------------------------------------------</div>
<div class="line">Set up system...</div>
<div class="line">   <a class="code" href="classTriangulation.html">Triangulation</a>: 229376 cells</div>
<div class="line">   <a class="code" href="group__dofs.html#ga768cd565b5c25f1ac235586e36ac94d6">DoFHandler</a>:    14729857 DoFs</div>
<div class="line"> </div>
<div class="line">Solve <span class="keyword">using</span> Newton<span class="stringliteral">&#39;s method...</span></div>
<div class="line"><span class="stringliteral">   Nstep 1, errf = 6.30096e-06, errx = 481.74, it = 8</span></div>
<div class="line"><span class="stringliteral">   Nstep 2, errf = 4.25607e-10, errx = 4.14315, it = 6</span></div>
<div class="line"><span class="stringliteral">   Nstep 3, errf = 7.29563e-13, errx = 0.000321775, it = 2</span></div>
<div class="line"><span class="stringliteral">Convergence step 3 value 7.29563e-13 (used wall time: 133.793 s)</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">Time for setup+solve (CPU/Wall) 226.809/232.615 s</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">Output results...</span></div>
<div class="line"><span class="stringliteral">  H1 seminorm: 0.588667</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">+---------------------------------------------+------------+------------+</span></div>
<div class="line"><span class="stringliteral">| Total wallclock time elapsed since start    |       390s |            |</span></div>
<div class="line"><span class="stringliteral">|                                             |            |            |</span></div>
<div class="line"><span class="stringliteral">| Section                         | no. calls |  wall time | % of total |</span></div>
<div class="line"><span class="stringliteral">+---------------------------------+-----------+------------+------------+</span></div>
<div class="line"><span class="stringliteral">| assemble right hand side        |         3 |      2.06s |      0.53% |</span></div>
<div class="line"><span class="stringliteral">| compute residual                |         3 |      2.46s |      0.63% |</span></div>
<div class="line"><span class="stringliteral">| compute update                  |         3 |       129s |        33% |</span></div>
<div class="line"><span class="stringliteral">| setup system                    |         1 |      98.8s |        25% |</span></div>
<div class="line"><span class="stringliteral">| solve                           |         1 |       134s |        34% |</span></div>
<div class="line"><span class="stringliteral">+---------------------------------+-----------+------------+------------+</span></div>
</div><!-- fragment --><p>We show the solution for the two- and three-dimensional problem in the following figure.</p>
<div class="twocolumn" style="width: 80%; text-align: center;"> <div> <img src="https://www.dealii.org/images/steps/developer/step-66.solution-2d.png" alt="Solution of the two-dimensional Gelfand problem." width="100%" class="inline"/> </div> <div> <img src="https://www.dealii.org/images/steps/developer/step-66.solution-3d.png" alt="Solution of the three-dimensional Gelfand problem." width="100%" class="inline"/> </div> </div><p><a class="anchor" id="Newtonsolver"></a></p><h3>Newton solver</h3>
<p>In the program output above we find some interesting information about the Newton iterations. The terminal output in each refinement cycle presents detailed diagnostics of the Newton method, which show first of all the number of Newton steps and for each step the norm of the residual \(\|F(u_h^{n+1})\|\), the norm of the Newton update \(\|s_h^n\|\), and the number of CG iterations <code>it</code>.</p>
<p>We observe that for all cases the Newton method converges in approximately three to four steps, which shows the quadratic convergence of the Newton method with a full step length \(\alpha = 1\). However, be aware that for a badly chosen initial guess \(u_h^0\), the Newton method will also diverge quadratically. Usually if you do not have an appropriate initial guess, you try a few damped Newton steps with a reduced step length \(\alpha &lt; 1\) until the Newton step is again in the quadratic convergence domain. This damping and relaxation of the Newton step length truly requires a more sophisticated implementation of the Newton method, which we designate to you as a possible extension of the tutorial.</p>
<p>Furthermore, we see that the number of CG iterations is approximately constant with successive mesh refinements and an increasing number of DoFs. This is of course due to the geometric multigrid preconditioner and similar to the observations made in other tutorials that use this method, e.g., <a class="el" href="step_16.html">step-16</a> and <a class="el" href="step_37.html">step-37</a>. Just to give an example, in the three-dimensional case after five refinements, we have approximately 14.7 million distributed DoFs with fourth-order Lagrangian finite elements, but the number of CG iterations is still less than ten.</p>
<p>In addition, there is one more very useful optimization that we applied and that should be mentioned here. In the <code>compute_update()</code> function we explicitly reset the vector holding the Newton update before passing it as the output vector to the solver. In that case we use a starting value of zero for the CG method, which is more suitable than the previous Newton update, the actual content of the <code>newton_update</code> before resetting, and thus reduces the number of CG iterations by a few steps.</p>
<p><a class="anchor" id="Possibilitiesforextensions"></a></p><h3>Possibilities for extensions</h3>
<p>A couple of possible extensions are available concerning minor updates fo the present code as well as a deeper numerical investigation of the Gelfand problem.</p>
<p><a class="anchor" id="MoresophisticatedNewtoniteration"></a></p><h4>More sophisticated Newton iteration</h4>
<p>Beside a step size controlled version of the Newton iteration as mentioned already in <a class="el" href="step_15.html">step-15</a>, one could also implement a more flexible stopping criterion for the Newton iteration. For example one could replace the fixed tolerances for the residual <code>TOLf</code> and for the Newton updated <code>TOLx</code> and implement a mixed error control with a given absolute and relative tolerance, such that the Newton iteration exists with success as, e.g., </p><p class="formulaDsp">
\begin{align*} \|F(u_h^{n+1})\| \leq \texttt{RelTol} \|u_h^{n+1}\| + \texttt{AbsTol}. \end{align*}
</p>
<p> For more advanced applications with many nonlinear systems to solve, for example at each time step for a time-dependent problem, it turns out that it is not necessary to set up and assemble the Jacobian anew at every single Newton step or even for each time step. Instead, the existing Jacobian from a previous step can be used for the Newton iteration. The Jacobian is then only rebuilt if, for example, the Newton iteration converges too slowly. Such an idea yields a <a href="https://en.wikipedia.org/wiki/Quasi-Newton_method">quasi-Newton method</a>. Admittedly, when using the matrix-free framework, the assembly of the Jacobian is omitted anyway, but with in this way one can try to optimize the reassembly of the geometric multigrid preconditioner. Remember that each time the solution from the old Newton step must be distributed to all levels and the mutligrid preconditioner must be reinitialized.</p>
<p><a class="anchor" id="Parallelscalabilityandthreadparallelism"></a></p><h4>Parallel scalability and thread parallelism</h4>
<p>In the results section of <a class="el" href="step_37.html">step-37</a> and others, the parallel scalability of the matrix-free framework on a large number of processors has already been demonstrated very impressively. In the nonlinear case we consider here, we note that one of the bottlenecks could become the transfer and evaluation of the matrix-free Jacobi operator and its multistage operators in the previous Newton step, since we need to transfer the old solution at all stages in each step. A first parallel scalability analysis in <b>[castelli2021numerical]</b> shows quite good strong scalability when the problem size is large enough. However, a more detailed analysis needs to be performed for reliable results. Moreover, the problem has been solved only with MPI so far, without using the possibilities of shared memory parallelization with threads. Therefore, for this example, you could try hybrid parallelization with MPI and threads, such as described in <a class="el" href="step_48.html">step-48</a>.</p>
<p><a class="anchor" id="Comparisontomatrixbasedmethods"></a></p><h4>Comparison to matrix-based methods</h4>
<p>Analogously to <a class="el" href="step_50.html">step-50</a> and the mentioned possible extension of <a class="el" href="step_75.html">step-75</a>, you can convince yourself which method is faster.</p>
<p><a class="anchor" id="Eigenvalueproblem"></a></p><h4>Eigenvalue problem</h4>
<p>One can consider the corresponding eigenvalue problem, which is called Bratu problem. For example, if we define a fixed eigenvalue \(\lambda\in[0,6]\), we can compute the corresponding discrete eigenfunction. You will notice that the number of Newton steps will increase with increasing \(\lambda\). To reduce the number of Newton steps you can use the following trick: start from a certain \(\lambda\), compute the eigenfunction, increase \(\lambda=\lambda + \delta_\lambda\), and then use the previous solution as an initial guess for the Newton iteration. In the end you can plot the \(H^1(\Omega)\)-norm over the eigenvalue \(\lambda \mapsto \|u_h\|_{H^1(\Omega)}\). What do you observe for further increasing \(\lambda&gt;7\)?</p>
<p><a class="anchor" id="PlainProg"></a> </p><h1>The plain program</h1>
<div class="fragment"><div class="line"><span class="comment">/* ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2021 by the deal.II authors</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file is part of the deal.II library.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The deal.II library is free software; you can use it, redistribute</span></div>
<div class="line"><span class="comment"> * it, and/or modify it under the terms of the GNU Lesser General</span></div>
<div class="line"><span class="comment"> * Public License as published by the Free Software Foundation; either</span></div>
<div class="line"><span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><span class="comment"> * The full text of the license can be found in the file LICENSE.md at</span></div>
<div class="line"><span class="comment"> * the top level directory of deal.II.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Authors: Fabian Castelli, Karlsruhe Institute of Technology (KIT)</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2timer_8h.html">deal.II/base/timer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2vectorization_8h.html">deal.II/base/vectorization.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__accessor_8h.html">deal.II/dofs/dof_accessor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2mapping__q__generic_8h.html">deal.II/fe/mapping_q_generic.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__out_8h.html">deal.II/grid/grid_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2manifold__lib_8h.html">deal.II/grid/manifold_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria__accessor_8h.html">deal.II/grid/tria_accessor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria__iterator_8h.html">deal.II/grid/tria_iterator.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2precondition_8h.html">deal.II/lac/precondition.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2solver__cg_8h.html">deal.II/lac/solver_cg.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2vector_8h.html">deal.II/lac/vector.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_2fe__evaluation_8h.html">deal.II/matrix_free/fe_evaluation.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_2matrix__free_8h.html">deal.II/matrix_free/matrix_free.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_2operators_8h.html">deal.II/matrix_free/operators.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_2tools_8h.html">deal.II/matrix_free/tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__coarse_8h.html">deal.II/multigrid/mg_coarse.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__constrained__dofs_8h.html">deal.II/multigrid/mg_constrained_dofs.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__matrix_8h.html">deal.II/multigrid/mg_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__smoother_8h.html">deal.II/multigrid/mg_smoother.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__tools_8h.html">deal.II/multigrid/mg_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__transfer__matrix__free_8h.html">deal.II/multigrid/mg_transfer_matrix_free.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2multigrid_8h.html">deal.II/multigrid/multigrid.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>Step66</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">  <span class="keyword">class </span>JacobianOperator</div>
<div class="line">    : <span class="keyword">public</span> <a class="code" href="namespaceMatrixFreeOperators.html">MatrixFreeOperators</a>::</div>
<div class="line">        Base&lt;dim, LinearAlgebra::distributed::Vector&lt;number&gt;&gt;</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">using</span> value_type = number;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using</span> FECellIntegrator =</div>
<div class="line">      <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, fe_degree, fe_degree + 1, 1, number&gt;</a>;</div>
<div class="line"> </div>
<div class="line">    JacobianOperator();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> clear() <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> evaluate_newton_step(</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;newton_step);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">compute_diagonal</a>() <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> apply_add(</div>
<div class="line">      <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      dst,</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src) <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span></div>
<div class="line">    local_apply(<span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, number&gt;</a> &amp;                   data,</div>
<div class="line">                <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      dst,</div>
<div class="line">                <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src,</div>
<div class="line">                <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;cell_range) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> local_compute_diagonal(FECellIntegrator &amp;integrator) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;2, VectorizedArray&lt;number&gt;</a>&gt; nonlinear_values;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">  JacobianOperator&lt;dim, fe_degree, number&gt;::JacobianOperator()</div>
<div class="line">    : <a class="code" href="namespaceMatrixFreeOperators.html">MatrixFreeOperators</a>::Base&lt;dim,</div>
<div class="line">                                <a class="code" href="namespaceLinearAlgebra.html">LinearAlgebra</a>::distributed::<a class="code" href="namespaceLinearAlgebraDealII.html#a2165565a5e6b6679392a7dee5d01ef58">Vector</a>&lt;number&gt;&gt;()</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">  <span class="keywordtype">void</span> JacobianOperator&lt;dim, fe_degree, number&gt;::clear()</div>
<div class="line">  {</div>
<div class="line">    nonlinear_values.<a class="code" href="classVector.html#ac4a4dbef7dd65ef8ad35ae56b57d7c05">reinit</a>(0, 0);</div>
<div class="line">    <a class="code" href="classMatrixFreeOperators_1_1Base.html">MatrixFreeOperators::Base&lt;dim, LinearAlgebra::distributed::Vector&lt;number&gt;</a>&gt;::</div>
<div class="line">      clear();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">  <span class="keywordtype">void</span> JacobianOperator&lt;dim, fe_degree, number&gt;::evaluate_newton_step(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;newton_step)</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a> = this-&gt;data-&gt;<a class="code" href="classMatrixFree.html#a8c9d964339b466bdcb661552e731e222">n_cell_batches</a>();</div>
<div class="line">    FECellIntegrator   phi(*this-&gt;data);</div>
<div class="line"> </div>
<div class="line">    nonlinear_values.reinit(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>, phi.n_q_points);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = 0; cell &lt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>; ++cell)</div>
<div class="line">      {</div>
<div class="line">        phi.reinit(cell);</div>
<div class="line">        phi.read_dof_values_plain(newton_step);</div>
<div class="line">        phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">          {</div>
<div class="line">            nonlinear_values(cell, q) = <a class="code" href="base_2vectorization_8h.html#a19f846bda83b7e3f4531daacb40c64e1">std::exp</a>(phi.get_value(q));</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">  <span class="keywordtype">void</span> JacobianOperator&lt;dim, fe_degree, number&gt;::local_apply(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, number&gt;</a> &amp;                   data,</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      dst,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src,</div>
<div class="line">    <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;     cell_range)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    FECellIntegrator phi(data);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = cell_range.first; cell &lt; cell_range.second; ++cell)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(nonlinear_values.size(0),</div>
<div class="line">                        phi.get_matrix_free().n_cell_batches());</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(nonlinear_values.size(1), phi.n_q_points);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        phi.reinit(cell);</div>
<div class="line"> </div>
<div class="line">        phi.gather_evaluate(src,</div>
<div class="line">                            <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> |</div>
<div class="line">                              <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">          {</div>
<div class="line">            phi.submit_value(-nonlinear_values(cell, q) * phi.get_value(q), q);</div>
<div class="line">            phi.submit_gradient(phi.get_gradient(q), q);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        phi.integrate_scatter(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> |</div>
<div class="line">                                <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>,</div>
<div class="line">                              dst);</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">  <span class="keywordtype">void</span> JacobianOperator&lt;dim, fe_degree, number&gt;::apply_add(</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;      dst,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;src)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    this-&gt;data-&gt;<a class="code" href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">cell_loop</a>(&amp;JacobianOperator::local_apply, <span class="keyword">this</span>, dst, src);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">  <span class="keywordtype">void</span> JacobianOperator&lt;dim, fe_degree, number&gt;::local_compute_diagonal(</div>
<div class="line">    FECellIntegrator &amp;phi)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(nonlinear_values.size(0),</div>
<div class="line">                    phi.get_matrix_free().n_cell_batches());</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(nonlinear_values.size(1), phi.n_q_points);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = phi.get_current_cell_index();</div>
<div class="line"> </div>
<div class="line">    phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> | <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">      {</div>
<div class="line">        phi.submit_value(-nonlinear_values(cell, q) * phi.get_value(q), q);</div>
<div class="line">        phi.submit_gradient(phi.get_gradient(q), q);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    phi.integrate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> | <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree, <span class="keyword">typename</span> number&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">JacobianOperator&lt;dim, fe_degree, number&gt;::compute_diagonal</a>()</div>
<div class="line">  {</div>
<div class="line">    this-&gt;inverse_diagonal_entries.reset(</div>
<div class="line">      <span class="keyword">new</span> <a class="code" href="classDiagonalMatrix.html">DiagonalMatrix</a>&lt;<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a>&gt;());</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;inverse_diagonal =</div>
<div class="line">      this-&gt;inverse_diagonal_entries-&gt;get_vector();</div>
<div class="line">    this-&gt;data-&gt;<a class="code" href="classMatrixFree.html#ab92a24942737bbaf04d7e00aceba9b57">initialize_dof_vector</a>(inverse_diagonal);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">MatrixFreeTools::compute_diagonal</a>(*this-&gt;data,</div>
<div class="line">                                      inverse_diagonal,</div>
<div class="line">                                      &amp;JacobianOperator::local_compute_diagonal,</div>
<div class="line">                                      <span class="keyword">this</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;diagonal_element : inverse_diagonal)</div>
<div class="line">      {</div>
<div class="line">        diagonal_element = (<a class="code" href="base_2vectorization_8h.html#aafbdfdd72b6cfe4eae5fa7a16385582f">std::abs</a>(diagonal_element) &gt; 1.0e-10) ?</div>
<div class="line">                             (1.0 / diagonal_element) :</div>
<div class="line">                             1.0;</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keyword">class </span>GelfandProblem</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    GelfandProblem();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">void</span> make_grid();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> setup_system();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> evaluate_residual(</div>
<div class="line">      <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;      dst,</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;src) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> local_evaluate_residual(</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, double&gt;</a> &amp;                   data,</div>
<div class="line">      <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;      dst,</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;src,</div>
<div class="line">      <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;     cell_range) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> assemble_rhs();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> compute_residual(<span class="keyword">const</span> <span class="keywordtype">double</span> alpha);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> compute_update();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> solve();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> compute_solution_norm() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cycle) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classparallel_1_1distributed_1_1Triangulation.html">parallel::distributed::Triangulation&lt;dim&gt;</a> <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classMappingQGeneric.html">MappingQGeneric&lt;dim&gt;</a>                mapping;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a>       fe;</div>
<div class="line">    <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> dof_handler;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> constraints;</div>
<div class="line">    <span class="keyword">using</span> SystemMatrixType = JacobianOperator&lt;dim, fe_degree, double&gt;;</div>
<div class="line">    SystemMatrixType system_matrix;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classMGConstrainedDoFs.html">MGConstrainedDoFs</a> mg_constrained_dofs;</div>
<div class="line">    <span class="keyword">using</span> LevelMatrixType = JacobianOperator&lt;dim, fe_degree, float&gt;;</div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;LevelMatrixType&gt;</a>                           mg_matrices;</div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt; mg_solution;</div>
<div class="line">    <a class="code" href="classMGTransferMatrixFree.html">MGTransferMatrixFree&lt;dim, float&gt;</a>                         mg_transfer;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> solution;</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> newton_update;</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> system_rhs;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> linear_iterations;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classConditionalOStream.html">ConditionalOStream</a> pcout;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTimerOutput.html">TimerOutput</a> computing_timer;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  GelfandProblem&lt;dim, fe_degree&gt;::GelfandProblem()</div>
<div class="line">    : <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>(MPI_COMM_WORLD,</div>
<div class="line">                    <a class="code" href="classTriangulation.html">Triangulation</a>&lt;dim&gt;::limit_level_difference_at_vertices,</div>
<div class="line">                    <a class="code" href="namespaceparallel.html">parallel</a>::distributed::<a class="code" href="classTriangulation.html">Triangulation</a>&lt;</div>
<div class="line">                      dim&gt;::<a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0a3901e6a241f812109912537866771e4c">construct_multigrid_hierarchy</a>)</div>
<div class="line">    , mapping(fe_degree)</div>
<div class="line">    , fe(fe_degree)</div>
<div class="line">    , dof_handler(<a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>)</div>
<div class="line">    , pcout(std::cout, <a class="code" href="namespaceUtilities.html">Utilities</a>::MPI::<a class="code" href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">this_mpi_process</a>(MPI_COMM_WORLD) == 0)</div>
<div class="line">    , computing_timer(MPI_COMM_WORLD,</div>
<div class="line">                      pcout,</div>
<div class="line">                      <a class="code" href="classTimerOutput.html">TimerOutput</a>::never,</div>
<div class="line">                      <a class="code" href="classTimerOutput.html">TimerOutput</a>::wall_times)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::make_grid()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;make grid&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSphericalManifold.html">SphericalManifold&lt;dim&gt;</a>                boundary_manifold;</div>
<div class="line">    <a class="code" href="classTransfiniteInterpolationManifold.html">TransfiniteInterpolationManifold&lt;dim&gt;</a> inner_manifold;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceGridGenerator.html#a533c4778cbc9bcbed365dcab42ca4418">GridGenerator::hyper_ball</a>(<a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.set_all_manifold_ids(1);</div>
<div class="line">    <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.set_all_manifold_ids_on_boundary(0);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.set_manifold(0, boundary_manifold);</div>
<div class="line"> </div>
<div class="line">    inner_manifold.<a class="code" href="classTransfiniteInterpolationManifold.html#a34326a35d9ec4b6911d90c85c21847d8">initialize</a>(<a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>);</div>
<div class="line">    <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.set_manifold(1, inner_manifold);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.refine_global(3 - dim);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::setup_system()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;setup system&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    system_matrix.clear();</div>
<div class="line">    mg_matrices.clear_elements();</div>
<div class="line"> </div>
<div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(fe);</div>
<div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#a9aed31323cbd7619edac310c47e7a7ad">distribute_mg_dofs</a>();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classIndexSet.html">IndexSet</a> locally_relevant_dofs;</div>
<div class="line">    <a class="code" href="namespaceDoFTools.html#acad7e0841b9046eaafddc4c617ab1d9d">DoFTools::extract_locally_relevant_dofs</a>(dof_handler, locally_relevant_dofs);</div>
<div class="line"> </div>
<div class="line">    constraints.<a class="code" href="classAffineConstraints.html#addd15bc409c61d6f795f0132c574335b">clear</a>();</div>
<div class="line">    constraints.<a class="code" href="classAffineConstraints.html#a2c9d71b5b7e8851c25a411ccf34de986">reinit</a>(locally_relevant_dofs);</div>
<div class="line">    <a class="code" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a>(dof_handler, constraints);</div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(dof_handler,</div>
<div class="line">                                             0,</div>
<div class="line">                                             <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(),</div>
<div class="line">                                             constraints);</div>
<div class="line">    constraints.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">typename</span> <a class="code" href="structMatrixFree_1_1AdditionalData.html">MatrixFree&lt;dim, double&gt;::AdditionalData</a> additional_data;</div>
<div class="line">      additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a0bcce2facca91b925d3e1a5a00c7704b">tasks_parallel_scheme</a> =</div>
<div class="line">        <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, double&gt;::AdditionalData::partition_color</a>;</div>
<div class="line">      additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#aa5d597e6c4441d273f4100b6139a2552">mapping_update_flags</a> =</div>
<div class="line">        (<a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> |</div>
<div class="line">         <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a>);</div>
<div class="line">      <span class="keyword">auto</span> system_mf_storage = std::make_shared&lt;MatrixFree&lt;dim, double&gt;&gt;();</div>
<div class="line">      system_mf_storage-&gt;reinit(mapping,</div>
<div class="line">                                dof_handler,</div>
<div class="line">                                constraints,</div>
<div class="line">                                <a class="code" href="classQGauss.html">QGauss&lt;1&gt;</a>(fe.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1),</div>
<div class="line">                                additional_data);</div>
<div class="line"> </div>
<div class="line">      system_matrix.initialize(system_mf_storage);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    system_matrix.initialize_dof_vector(solution);</div>
<div class="line">    system_matrix.initialize_dof_vector(newton_update);</div>
<div class="line">    system_matrix.initialize_dof_vector(system_rhs);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nlevels = <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.n_global_levels();</div>
<div class="line">    mg_matrices.resize(0, nlevels - 1);</div>
<div class="line">    mg_solution.resize(0, nlevels - 1);</div>
<div class="line"> </div>
<div class="line">    std::set&lt;types::boundary_id&gt; dirichlet_boundary;</div>
<div class="line">    dirichlet_boundary.insert(0);</div>
<div class="line">    mg_constrained_dofs.initialize(dof_handler);</div>
<div class="line">    mg_constrained_dofs.make_zero_boundary_constraints(dof_handler,</div>
<div class="line">                                                       dirichlet_boundary);</div>
<div class="line"> </div>
<div class="line">    mg_transfer.<a class="code" href="classMGTransferMatrixFree.html#a69e2b416ab209936f94db08e865cd92b">initialize_constraints</a>(mg_constrained_dofs);</div>
<div class="line">    mg_transfer.<a class="code" href="classMGTransferMatrixFree.html#a8f214ffade006cfa85e902a94902fc7b">build</a>(dof_handler);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; nlevels; ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classIndexSet.html">IndexSet</a> relevant_dofs;</div>
<div class="line">        <a class="code" href="namespaceDoFTools.html#a1fef7be07cf379b661646e39b9354e17">DoFTools::extract_locally_relevant_level_dofs</a>(dof_handler,</div>
<div class="line">                                                      <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>,</div>
<div class="line">                                                      relevant_dofs);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> level_constraints;</div>
<div class="line">        level_constraints.<a class="code" href="classAffineConstraints.html#a2c9d71b5b7e8851c25a411ccf34de986">reinit</a>(relevant_dofs);</div>
<div class="line">        level_constraints.<a class="code" href="classAffineConstraints.html#aef97b22281acb10c914d79a3881e2735">add_lines</a>(</div>
<div class="line">          mg_constrained_dofs.get_boundary_indices(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line">        level_constraints.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">typename</span> <a class="code" href="structMatrixFree_1_1AdditionalData.html">MatrixFree&lt;dim, float&gt;::AdditionalData</a> additional_data;</div>
<div class="line">        additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a0bcce2facca91b925d3e1a5a00c7704b">tasks_parallel_scheme</a> =</div>
<div class="line">          <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, float&gt;::AdditionalData::partition_color</a>;</div>
<div class="line">        additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#aa5d597e6c4441d273f4100b6139a2552">mapping_update_flags</a> =</div>
<div class="line">          (<a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> |</div>
<div class="line">           <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a>);</div>
<div class="line">        additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a67c9ff01c51fb7fb3ada151b83cdd409">mg_level</a> = <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>;</div>
<div class="line">        <span class="keyword">auto</span> mg_mf_storage_level = std::make_shared&lt;MatrixFree&lt;dim, float&gt;&gt;();</div>
<div class="line">        mg_mf_storage_level-&gt;reinit(mapping,</div>
<div class="line">                                    dof_handler,</div>
<div class="line">                                    level_constraints,</div>
<div class="line">                                    <a class="code" href="classQGauss.html">QGauss&lt;1&gt;</a>(fe.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1),</div>
<div class="line">                                    additional_data);</div>
<div class="line"> </div>
<div class="line">        mg_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].initialize(mg_mf_storage_level,</div>
<div class="line">                                      mg_constrained_dofs,</div>
<div class="line">                                      <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line">        mg_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].initialize_dof_vector(mg_solution[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>]);</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::evaluate_residual(</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;      dst,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;src)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keyword">auto</span> matrix_free = system_matrix.get_matrix_free();</div>
<div class="line"> </div>
<div class="line">    matrix_free-&gt;cell_loop(</div>
<div class="line">      &amp;GelfandProblem::local_evaluate_residual, <span class="keyword">this</span>, dst, src, <span class="keyword">true</span>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::local_evaluate_residual(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, double&gt;</a> &amp;                   data,</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;      dst,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> &amp;src,</div>
<div class="line">    <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;     cell_range)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, fe_degree, fe_degree + 1, 1, double&gt;</a> phi(data);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = cell_range.first; cell &lt; cell_range.second; ++cell)</div>
<div class="line">      {</div>
<div class="line">        phi.reinit(cell);</div>
<div class="line"> </div>
<div class="line">        phi.read_dof_values_plain(src);</div>
<div class="line">        phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> | <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">          {</div>
<div class="line">            phi.submit_value(-std::exp(phi.get_value(q)), q);</div>
<div class="line">            phi.submit_gradient(phi.get_gradient(q), q);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        phi.integrate_scatter(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a> |</div>
<div class="line">                                <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a>,</div>
<div class="line">                              dst);</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::assemble_rhs()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;assemble right hand side&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    evaluate_residual(system_rhs, solution);</div>
<div class="line"> </div>
<div class="line">    system_rhs *= -1.0;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">double</span> GelfandProblem&lt;dim, fe_degree&gt;::compute_residual(<span class="keyword">const</span> <span class="keywordtype">double</span> alpha)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;compute residual&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> residual;</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a> evaluation_point;</div>
<div class="line"> </div>
<div class="line">    system_matrix.initialize_dof_vector(residual);</div>
<div class="line">    system_matrix.initialize_dof_vector(evaluation_point);</div>
<div class="line"> </div>
<div class="line">    evaluation_point = solution;</div>
<div class="line">    <span class="keywordflow">if</span> (alpha &gt; 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a496b854daac5cca870bc8008f562daad">e</a>-12)</div>
<div class="line">      {</div>
<div class="line">        evaluation_point.<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html#ac029174b48a0707da587b6ce3bc25047">add</a>(alpha, newton_update);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    evaluate_residual(residual, evaluation_point);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> residual.<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html#af355599021a687026ab9818efd57e82d">l2_norm</a>();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::compute_update()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;compute update&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    solution.update_ghost_values();</div>
<div class="line"> </div>
<div class="line">    system_matrix.evaluate_newton_step(solution);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    mg_transfer.<a class="code" href="classMGTransferMatrixFree.html#a90aef560cc3d832589ca13a5f18e1414">interpolate_to_mg</a>(dof_handler, mg_solution, solution);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using</span> SmootherType =</div>
<div class="line">      <a class="code" href="classPreconditionChebyshev.html">PreconditionChebyshev</a>&lt;LevelMatrixType,</div>
<div class="line">                            <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt;;</div>
<div class="line">    <a class="code" href="classmg_1_1SmootherRelaxation.html">mg::SmootherRelaxation</a>&lt;SmootherType,</div>
<div class="line">                           <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt;</div>
<div class="line">                                                         mg_smoother;</div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;typename SmootherType::AdditionalData&gt;</a> smoother_data;</div>
<div class="line">    smoother_data.<a class="code" href="classMGLevelObject.html#a16213121f9153bd08f49652a11886259">resize</a>(0, <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.n_global_levels() - 1);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.n_global_levels();</div>
<div class="line">         ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &gt; 0)</div>
<div class="line">          {</div>
<div class="line">            smoother_data[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].smoothing_range     = 15.;</div>
<div class="line">            smoother_data[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].degree              = 4;</div>
<div class="line">            smoother_data[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].eig_cg_n_iterations = 10;</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          {</div>
<div class="line">            smoother_data[0].smoothing_range = 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a496b854daac5cca870bc8008f562daad">e</a>-3;</div>
<div class="line">            smoother_data[0].degree          = <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>;</div>
<div class="line">            smoother_data[0].eig_cg_n_iterations = mg_matrices[0].m();</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        mg_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].evaluate_newton_step(mg_solution[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>]);</div>
<div class="line">        mg_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].compute_diagonal();</div>
<div class="line"> </div>
<div class="line">        smoother_data[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].preconditioner =</div>
<div class="line">          mg_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].get_matrix_diagonal_inverse();</div>
<div class="line">      }</div>
<div class="line">    mg_smoother.initialize(mg_matrices, smoother_data);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classMGCoarseGridApplySmoother.html">MGCoarseGridApplySmoother&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt;</div>
<div class="line">      mg_coarse;</div>
<div class="line">    mg_coarse.<a class="code" href="classMGCoarseGridApplySmoother.html#a499c7364e40031332e9943a2e5f331a2">initialize</a>(mg_smoother);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt; mg_matrix(</div>
<div class="line">      mg_matrices);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;MatrixFreeOperators::MGInterfaceOperator&lt;LevelMatrixType&gt;</a>&gt;</div>
<div class="line">      mg_interface_matrices;</div>
<div class="line">    mg_interface_matrices.<a class="code" href="classMGLevelObject.html#a16213121f9153bd08f49652a11886259">resize</a>(0, <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.n_global_levels() - 1);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.n_global_levels();</div>
<div class="line">         ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">      {</div>
<div class="line">        mg_interface_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].initialize(mg_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>]);</div>
<div class="line">      }</div>
<div class="line">    <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt; mg_interface(</div>
<div class="line">      mg_interface_matrices);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classMultigrid.html">Multigrid&lt;LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt; <a class="code" href="namespacemg.html">mg</a>(</div>
<div class="line">      mg_matrix, mg_coarse, mg_transfer, mg_smoother, mg_smoother);</div>
<div class="line">    <a class="code" href="namespacemg.html">mg</a>.set_edge_matrices(mg_interface, mg_interface);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classPreconditionMG.html">PreconditionMG</a>&lt;dim,</div>
<div class="line">                   <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;float&gt;</a>,</div>
<div class="line">                   <a class="code" href="classMGTransferMatrixFree.html">MGTransferMatrixFree&lt;dim, float&gt;</a>&gt;</div>
<div class="line">      preconditioner(dof_handler, <a class="code" href="namespacemg.html">mg</a>, mg_transfer);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSolverControl.html">SolverControl</a> solver_control(100, 1.<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a496b854daac5cca870bc8008f562daad">e</a>-12);</div>
<div class="line">    <a class="code" href="classSolverCG.html">SolverCG&lt;LinearAlgebra::distributed::Vector&lt;double&gt;</a>&gt; cg(solver_control);</div>
<div class="line"> </div>
<div class="line">    newton_update = 0.0;</div>
<div class="line"> </div>
<div class="line">    cg.solve(system_matrix, newton_update, system_rhs, preconditioner);</div>
<div class="line"> </div>
<div class="line">    constraints.<a class="code" href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">distribute</a>(newton_update);</div>
<div class="line"> </div>
<div class="line">    linear_iterations = solver_control.<a class="code" href="classSolverControl.html#a42aeae81cd6b67ce93b5fbea3328371f">last_step</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    solution.zero_out_ghost_values();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span> GelfandProblem&lt;dim, fe_degree&gt;::solve()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(computing_timer, <span class="stringliteral">&quot;solve&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> itmax = 10;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>       TOLf  = 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a496b854daac5cca870bc8008f562daad">e</a>-12;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>       TOLx  = 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a496b854daac5cca870bc8008f562daad">e</a>-10;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTimer.html">Timer</a> solver_timer;</div>
<div class="line">    solver_timer.<a class="code" href="classTimer.html#a3a8b5272198d029779dc9302a54305a8">start</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> newton_step = 1; newton_step &lt;= itmax; ++newton_step)</div>
<div class="line">      {</div>
<div class="line">        assemble_rhs();</div>
<div class="line">        compute_update();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> ERRx = newton_update.<a class="code" href="classBlockVectorBase.html#ac718033fc083f27c45c6bfb4ac780360">l2_norm</a>();</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> ERRf = compute_residual(1.0);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        solution.add(1.0, newton_update);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;   Nstep &quot;</span> &lt;&lt; newton_step &lt;&lt; <span class="stringliteral">&quot;, errf = &quot;</span> &lt;&lt; ERRf</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;, errx = &quot;</span> &lt;&lt; ERRx &lt;&lt; <span class="stringliteral">&quot;, it = &quot;</span> &lt;&lt; linear_iterations</div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (ERRf &lt; TOLf || ERRx &lt; TOLx)</div>
<div class="line">          {</div>
<div class="line">            solver_timer.<a class="code" href="classTimer.html#a988f79aa183d9d5473c13106f5babe48">stop</a>();</div>
<div class="line"> </div>
<div class="line">            pcout &lt;&lt; <span class="stringliteral">&quot;Convergence step &quot;</span> &lt;&lt; newton_step &lt;&lt; <span class="stringliteral">&quot; value &quot;</span> &lt;&lt; ERRf</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot; (used wall time: &quot;</span> &lt;&lt; solver_timer.<a class="code" href="classTimer.html#a6f3e76707411b51e7d7e7bfa5755cf02">wall_time</a>() &lt;&lt; <span class="stringliteral">&quot; s)&quot;</span></div>
<div class="line">                  &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (newton_step == itmax)</div>
<div class="line">          {</div>
<div class="line">            solver_timer.<a class="code" href="classTimer.html#a988f79aa183d9d5473c13106f5babe48">stop</a>();</div>
<div class="line">            pcout &lt;&lt; <span class="stringliteral">&quot;WARNING: No convergence of Newton&#39;s method after &quot;</span></div>
<div class="line">                  &lt;&lt; newton_step &lt;&lt; <span class="stringliteral">&quot; steps.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">double</span> GelfandProblem&lt;dim, fe_degree&gt;::compute_solution_norm()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    solution.<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html#a2a6cb7d50e02022283af53c2ae14f878">update_ghost_values</a>();</div>
<div class="line"> </div>
<div class="line">    Vector&lt;float&gt; norm_per_cell(<a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.n_active_cells());</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#a676190d2c897ac5da68a9c460fa95832">VectorTools::integrate_difference</a>(mapping,</div>
<div class="line">                                      dof_handler,</div>
<div class="line">                                      solution,</div>
<div class="line">                                      <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(),</div>
<div class="line">                                      norm_per_cell,</div>
<div class="line">                                      <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(fe.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 2),</div>
<div class="line">                                      <a class="code" href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1a7c450aee1986e226cf1bd7687171d769">VectorTools::H1_seminorm</a>);</div>
<div class="line"> </div>
<div class="line">    solution.zero_out_ghost_values();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="namespaceVectorTools.html#a21eb62d70953182dcc2b15c4e14dd533">VectorTools::compute_global_error</a>(<a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>,</div>
<div class="line">                                             norm_per_cell,</div>
<div class="line">                                             <a class="code" href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1a7c450aee1986e226cf1bd7687171d769">VectorTools::H1_seminorm</a>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span></div>
<div class="line">  GelfandProblem&lt;dim, fe_degree&gt;::output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cycle)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.n_global_active_cells() &gt; 1e6)</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">    solution.update_ghost_values();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">attach_dof_handler</a>(dof_handler);</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(solution, <span class="stringliteral">&quot;solution&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    Vector&lt;float&gt; subdomain(<a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.n_active_cells());</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; subdomain.size(); ++i)</div>
<div class="line">      {</div>
<div class="line">        subdomain(i) = <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.locally_owned_subdomain();</div>
<div class="line">      }</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(subdomain, <span class="stringliteral">&quot;subdomain&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    data_out.<a class="code" href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">build_patches</a>(mapping,</div>
<div class="line">                           fe.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a>,</div>
<div class="line">                           <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;::curved_inner_cells</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="structDataOutBase_1_1VtkFlags.html">DataOutBase::VtkFlags</a> flags;</div>
<div class="line">    flags.<a class="code" href="group__Exceptions.html#ga3be0d6de1c92b770e8664bce2fc7c107">compression_level</a> = <a class="code" href="group__Exceptions.html#ga7ad65742b9dbfb7eeb04b511b5a08d63a3c83e26f202f837328b9f7532773be70">DataOutBase::VtkFlags::best_speed</a>;</div>
<div class="line">    data_out.<a class="code" href="classDataOutInterface.html#ac7280a24690b117454acfb0fa058299c">set_flags</a>(flags);</div>
<div class="line">    data_out.<a class="code" href="classDataOutInterface.html#a0864e51eb173c87e2a3edc9391ea8009">write_vtu_with_pvtu_record</a>(</div>
<div class="line">      <span class="stringliteral">&quot;./&quot;</span>, <span class="stringliteral">&quot;solution_&quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(dim) + <span class="stringliteral">&quot;d&quot;</span>, cycle, MPI_COMM_WORLD, 3);</div>
<div class="line"> </div>
<div class="line">    solution.zero_out_ghost_values();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> fe_degree&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">GelfandProblem&lt;dim, fe_degree&gt;::run</a>()</div>
<div class="line">  {</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_ranks =</div>
<div class="line">        <a class="code" href="namespaceUtilities_1_1MPI.html#ac26de0c059200523177bb1d92cc25d00">Utilities::MPI::n_mpi_processes</a>(MPI_COMM_WORLD);</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_vect_doubles = <a class="code" href="classVectorizedArrayBase.html#acb35404acc1693aee6e990228924cc09">VectorizedArray&lt;double&gt;::size</a>();</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_vect_bits    = 8 * <span class="keyword">sizeof</span>(<a class="code" href="classdouble.html">double</a>) * n_vect_doubles;</div>
<div class="line"> </div>
<div class="line">      std::string DAT_header = <span class="stringliteral">&quot;START DATE: &quot;</span> + <a class="code" href="namespaceUtilities_1_1System.html#aff548b3b9b7a035ea112729700ef7c64">Utilities::System::get_date</a>() +</div>
<div class="line">                               <span class="stringliteral">&quot;, TIME: &quot;</span> + <a class="code" href="namespaceUtilities_1_1System.html#a76bc1cc7649cc416723f450d24fdd91d">Utilities::System::get_time</a>();</div>
<div class="line">      std::string MPI_header = <span class="stringliteral">&quot;Running with &quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(n_ranks) +</div>
<div class="line">                               <span class="stringliteral">&quot; MPI process&quot;</span> + (n_ranks &gt; 1 ? <span class="stringliteral">&quot;es&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">      std::string VEC_header =</div>
<div class="line">        <span class="stringliteral">&quot;Vectorization over &quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(n_vect_doubles) +</div>
<div class="line">        <span class="stringliteral">&quot; doubles = &quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(n_vect_bits) + <span class="stringliteral">&quot; bits (&quot;</span> +</div>
<div class="line">        <a class="code" href="namespaceUtilities_1_1System.html#ade631a789101336840371e3b2e2851e0">Utilities::System::get_current_vectorization_level</a>() +</div>
<div class="line">        <span class="stringliteral">&quot;), VECTORIZATION_LEVEL=&quot;</span> +</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(<a class="code" href="config_8h.html#a32dc208a29f23d1f031fb40b0d21e60e">DEAL_II_COMPILER_VECTORIZATION_LEVEL</a>);</div>
<div class="line">      std::string SOL_header = <span class="stringliteral">&quot;Finite element space: &quot;</span> + fe.<a class="code" href="classFiniteElement.html#a09655d1d2555af8dcd48caebd4039d29">get_name</a>();</div>
<div class="line"> </div>
<div class="line">      pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;=&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line">      pcout &lt;&lt; DAT_header &lt;&lt; std::endl;</div>
<div class="line">      pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;-&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">      pcout &lt;&lt; MPI_header &lt;&lt; std::endl;</div>
<div class="line">      pcout &lt;&lt; VEC_header &lt;&lt; std::endl;</div>
<div class="line">      pcout &lt;&lt; SOL_header &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">      pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;=&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cycle = 0; cycle &lt; 9 - dim; ++cycle)</div>
<div class="line">      {</div>
<div class="line">        pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;-&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;Cycle &quot;</span> &lt;&lt; cycle &lt;&lt; std::endl;</div>
<div class="line">        pcout &lt;&lt; std::string(80, <span class="charliteral">&#39;-&#39;</span>) &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (cycle == 0)</div>
<div class="line">          {</div>
<div class="line">            make_grid();</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.refine_global(1);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classTimer.html">Timer</a> timer;</div>
<div class="line"> </div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;Set up system...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        setup_system();</div>
<div class="line"> </div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;   Triangulation: &quot;</span> &lt;&lt; <a class="code" href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a>.n_global_active_cells()</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot; cells&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;   DoFHandler:    &quot;</span> &lt;&lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>() &lt;&lt; <span class="stringliteral">&quot; DoFs&quot;</span></div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line">        pcout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;Solve using Newton&#39;s method...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        solve();</div>
<div class="line">        pcout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        timer.<a class="code" href="classTimer.html#a988f79aa183d9d5473c13106f5babe48">stop</a>();</div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;Time for setup+solve (CPU/Wall) &quot;</span> &lt;&lt; timer.<a class="code" href="classTimer.html#a4e3933a78790d7455daff5acab3f8432">cpu_time</a>() &lt;&lt; <span class="stringliteral">&quot;/&quot;</span></div>
<div class="line">              &lt;&lt; timer.<a class="code" href="classTimer.html#a6f3e76707411b51e7d7e7bfa5755cf02">wall_time</a>() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        pcout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;Output results...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespaceLocalIntegrators_1_1Divergence.html#a8bcfc37d2a2be8faa18628a601ecf112">norm</a> = compute_solution_norm();</div>
<div class="line">        output_results(cycle);</div>
<div class="line"> </div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot;  H1 seminorm: &quot;</span> &lt;&lt; <a class="code" href="namespaceLocalIntegrators_1_1Divergence.html#a8bcfc37d2a2be8faa18628a601ecf112">norm</a> &lt;&lt; std::endl;</div>
<div class="line">        pcout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        computing_timer.print_summary();</div>
<div class="line">        computing_timer.reset();</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Step66</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">using namespace </span>Step66;</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classUtilities_1_1MPI_1_1MPI__InitFinalize.html">Utilities::MPI::MPI_InitFinalize</a> mpi_init(argc, argv, 1);</div>
<div class="line"> </div>
<div class="line">      {</div>
<div class="line">        GelfandProblem&lt;2, 4&gt; gelfand_problem;</div>
<div class="line">        gelfand_problem.run();</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      {</div>
<div class="line">        GelfandProblem&lt;3, 4&gt; gelfand_problem;</div>
<div class="line">        gelfand_problem.run();</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (std::exception &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="aclassMatrixFree_html_ab92a24942737bbaf04d7e00aceba9b57"><div class="ttname"><a href="classMatrixFree.html#ab92a24942737bbaf04d7e00aceba9b57">MatrixFree::initialize_dof_vector</a></div><div class="ttdeci">void initialize_dof_vector(VectorType &amp;vec, const unsigned int dof_handler_index=0) const</div></div>
<div class="ttc" id="aclassDataOut__DoFData_html_a79cbe2f02f8dfb85026c71d783dbb703"><div class="ttname"><a href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">DataOut_DoFData::add_data_vector</a></div><div class="ttdeci">void add_data_vector(const VectorType &amp;data, const std::vector&lt; std::string &gt; &amp;names, const DataVectorType type=type_automatic, const std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt; &amp;data_component_interpretation=std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt;())</div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__out__dof__data_8h_source.html#l01096">data_out_dof_data.h:1096</a></div></div>
<div class="ttc" id="anamespaceWorkStream_1_1internal_1_1tbb__no__coloring_html_a8673698a405bf47aa24002aeb6d76d70"><div class="ttname"><a href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">WorkStream::internal::tbb_no_coloring::run</a></div><div class="ttdeci">void run(const Iterator &amp;begin, const typename identity&lt; Iterator &gt;::type &amp;end, Worker worker, Copier copier, const ScratchData &amp;sample_scratch_data, const CopyData &amp;sample_copy_data, const unsigned int queue_length, const unsigned int chunk_size)</div><div class="ttdef"><b>Definition:</b> <a href="base_2work__stream_8h_source.html#l00692">work_stream.h:692</a></div></div>
<div class="ttc" id="aclassIndexSet_html"><div class="ttname"><a href="classIndexSet.html">IndexSet</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2index__set_8h_source.html#l00068">index_set.h:68</a></div></div>
<div class="ttc" id="aclassFEValues_html_a21f914e63d588e2652a9514620653d77"><div class="ttname"><a href="classFEValues.html#a21f914e63d588e2652a9514620653d77">FEValues::reinit</a></div><div class="ttdeci">void reinit(const TriaIterator&lt; DoFCellAccessor&lt; dim, spacedim, level_dof_access &gt;&gt; &amp;cell)</div></div>
<div class="ttc" id="amultigrid_2multigrid_8h_html"><div class="ttname"><a href="multigrid_2multigrid_8h.html">multigrid.h</a></div></div>
<div class="ttc" id="aclassMatrixFree_html_a8c9d964339b466bdcb661552e731e222"><div class="ttname"><a href="classMatrixFree.html#a8c9d964339b466bdcb661552e731e222">MatrixFree::n_cell_batches</a></div><div class="ttdeci">unsigned int n_cell_batches() const</div></div>
<div class="ttc" id="afe_2fe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20"><div class="ttname"><a href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a></div><div class="ttdeci">@ update_gradients</div><div class="ttdoc">Shape function gradients.</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__update__flags_8h_source.html#l00077">fe_update_flags.h:77</a></div></div>
<div class="ttc" id="anamespaceUtilities_1_1System_html_a76bc1cc7649cc416723f450d24fdd91d"><div class="ttname"><a href="namespaceUtilities_1_1System.html#a76bc1cc7649cc416723f450d24fdd91d">Utilities::System::get_time</a></div><div class="ttdeci">std::string get_time()</div><div class="ttdef"><b>Definition:</b> <a href="base_2utilities_8cc_source.html#l01019">utilities.cc:1019</a></div></div>
<div class="ttc" id="aclasstypename_01MatrixType_1_1value__type_html"><div class="ttname"><a href="classtypename_01MatrixType_1_1value__type.html">value_type</a></div></div>
<div class="ttc" id="astructMatrixFree_1_1AdditionalData_html_a67c9ff01c51fb7fb3ada151b83cdd409"><div class="ttname"><a href="structMatrixFree_1_1AdditionalData.html#a67c9ff01c51fb7fb3ada151b83cdd409">MatrixFree::AdditionalData::mg_level</a></div><div class="ttdeci">unsigned int mg_level</div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_2matrix__free_8h_source.html#l00436">matrix_free.h:436</a></div></div>
<div class="ttc" id="aclassSolverCG_html"><div class="ttname"><a href="classSolverCG.html">SolverCG</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2solver__cg_8h_source.html#l00088">solver_cg.h:88</a></div></div>
<div class="ttc" id="aclassTimerOutput_1_1Scope_html"><div class="ttname"><a href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2timer_8h_source.html#l00600">timer.h:600</a></div></div>
<div class="ttc" id="aclassFE__Q_html"><div class="ttname"><a href="classFE__Q.html">FE_Q</a></div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__q_8h_source.html#l00587">fe_q.h:587</a></div></div>
<div class="ttc" id="anamespaceTriangulationDescription_html_aa1531298eb0a267d9ceca5eb46ada8e0a3901e6a241f812109912537866771e4c"><div class="ttname"><a href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0a3901e6a241f812109912537866771e4c">TriangulationDescription::construct_multigrid_hierarchy</a></div><div class="ttdeci">@ construct_multigrid_hierarchy</div><div class="ttdef"><b>Definition:</b> <a href="grid_2tria__description_8h_source.html#l00268">tria_description.h:268</a></div></div>
<div class="ttc" id="agrid_2tria__iterator_8h_html"><div class="ttname"><a href="grid_2tria__iterator_8h.html">tria_iterator.h</a></div></div>
<div class="ttc" id="anamespacedealii_html"><div class="ttname"><a href="namespacedealii.html">dealii</a></div><div class="ttdef"><b>Definition:</b> <a href="doc_2doxygen_2headers_2namespace__dealii_8h_source.html#l00025">namespace_dealii.h:25</a></div></div>
<div class="ttc" id="aclassLinearAlgebra_1_1distributed_1_1Vector_html_ac029174b48a0707da587b6ce3bc25047"><div class="ttname"><a href="classLinearAlgebra_1_1distributed_1_1Vector.html#ac029174b48a0707da587b6ce3bc25047">LinearAlgebra::distributed::Vector::add</a></div><div class="ttdeci">virtual void add(const Number a) override</div></div>
<div class="ttc" id="anamespaceLinearAlgebra_html"><div class="ttname"><a href="namespaceLinearAlgebra.html">LinearAlgebra</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2communication__pattern__base_8h_source.html#l00026">communication_pattern_base.h:26</a></div></div>
<div class="ttc" id="afe_2fe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea"><div class="ttname"><a href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a></div><div class="ttdeci">@ update_values</div><div class="ttdoc">Shape function values.</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__update__flags_8h_source.html#l00070">fe_update_flags.h:70</a></div></div>
<div class="ttc" id="aclassAffineConstraints_html_aef97b22281acb10c914d79a3881e2735"><div class="ttname"><a href="classAffineConstraints.html#aef97b22281acb10c914d79a3881e2735">AffineConstraints::add_lines</a></div><div class="ttdeci">void add_lines(const std::vector&lt; bool &gt; &amp;lines)</div></div>
<div class="ttc" id="aclassLinearAlgebra_1_1distributed_1_1Vector_html"><div class="ttname"><a href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2la__parallel__vector_8h_source.html#l00129">la_parallel_vector.h:129</a></div></div>
<div class="ttc" id="anamespaceEvaluationFlags_html_a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04"><div class="ttname"><a href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeadde91684ebb2c6ec5c5c5293123f6a04">EvaluationFlags::gradients</a></div><div class="ttdeci">@ gradients</div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_2evaluation__flags_8h_source.html#l00060">evaluation_flags.h:60</a></div></div>
<div class="ttc" id="anamespacePhysics_1_1Elasticity_1_1Kinematics_html_a496b854daac5cca870bc8008f562daad"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a496b854daac5cca870bc8008f562daad">Physics::Elasticity::Kinematics::e</a></div><div class="ttdeci">SymmetricTensor&lt; 2, dim, Number &gt; e(const Tensor&lt; 2, dim, Number &gt; &amp;F)</div></div>
<div class="ttc" id="aclassMGConstrainedDoFs_html"><div class="ttname"><a href="classMGConstrainedDoFs.html">MGConstrainedDoFs</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_2mg__constrained__dofs_8h_source.html#l00049">mg_constrained_dofs.h:49</a></div></div>
<div class="ttc" id="aclassPreconditionChebyshev_html"><div class="ttname"><a href="classPreconditionChebyshev.html">PreconditionChebyshev</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2precondition_8h_source.html#l01035">precondition.h:1035</a></div></div>
<div class="ttc" id="aclassTriangulation_html"><div class="ttname"><a href="classTriangulation.html">Triangulation</a></div><div class="ttdef"><b>Definition:</b> <a href="grid_2tria_8h_source.html#l01033">tria.h:1033</a></div></div>
<div class="ttc" id="agrid_2tria_8h_html"><div class="ttname"><a href="grid_2tria_8h.html">tria.h</a></div></div>
<div class="ttc" id="aclassDiagonalMatrix_html"><div class="ttname"><a href="classDiagonalMatrix.html">DiagonalMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2diagonal__matrix_8h_source.html#l00051">diagonal_matrix.h:51</a></div></div>
<div class="ttc" id="afe_2fe__q_8h_html"><div class="ttname"><a href="fe_2fe__q_8h.html">fe_q.h</a></div></div>
<div class="ttc" id="aclassMGTransferMatrixFree_html_a90aef560cc3d832589ca13a5f18e1414"><div class="ttname"><a href="classMGTransferMatrixFree.html#a90aef560cc3d832589ca13a5f18e1414">MGTransferMatrixFree::interpolate_to_mg</a></div><div class="ttdeci">void interpolate_to_mg(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, MGLevelObject&lt; LinearAlgebra::distributed::Vector&lt; Number &gt;&gt; &amp;dst, const LinearAlgebra::distributed::Vector&lt; Number2 &gt; &amp;src) const</div></div>
<div class="ttc" id="aclassMappingQGeneric_html"><div class="ttname"><a href="classMappingQGeneric.html">MappingQGeneric</a></div><div class="ttdef"><b>Definition:</b> <a href="fe_2mapping__q__generic_8h_source.html#l00124">mapping_q_generic.h:124</a></div></div>
<div class="ttc" id="abase_2timer_8h_html"><div class="ttname"><a href="base_2timer_8h.html">timer.h</a></div></div>
<div class="ttc" id="aclassTimer_html_a988f79aa183d9d5473c13106f5babe48"><div class="ttname"><a href="classTimer.html#a988f79aa183d9d5473c13106f5babe48">Timer::stop</a></div><div class="ttdeci">double stop()</div><div class="ttdef"><b>Definition:</b> <a href="timer_8cc_source.html#l00194">timer.cc:194</a></div></div>
<div class="ttc" id="aconfig_8h_html_a32dc208a29f23d1f031fb40b0d21e60e"><div class="ttname"><a href="config_8h.html#a32dc208a29f23d1f031fb40b0d21e60e">DEAL_II_COMPILER_VECTORIZATION_LEVEL</a></div><div class="ttdeci">#define DEAL_II_COMPILER_VECTORIZATION_LEVEL</div><div class="ttdef"><b>Definition:</b> <a href="config_8h_source.html#l00133">config.h:133</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga72743302dcb1a0fb1f2f8dc5122d299e"><div class="ttname"><a href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">Patterns::Tools::to_string</a></div><div class="ttdeci">std::string to_string(const T &amp;t)</div><div class="ttdef"><b>Definition:</b> <a href="base_2patterns_8h_source.html#l02413">patterns.h:2413</a></div></div>
<div class="ttc" id="astructMatrixFree_1_1AdditionalData_html_aa5d597e6c4441d273f4100b6139a2552"><div class="ttname"><a href="structMatrixFree_1_1AdditionalData.html#aa5d597e6c4441d273f4100b6139a2552">MatrixFree::AdditionalData::mapping_update_flags</a></div><div class="ttdeci">UpdateFlags mapping_update_flags</div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_2matrix__free_8h_source.html#l00359">matrix_free.h:359</a></div></div>
<div class="ttc" id="anamespaceUtilities_1_1System_html_aff548b3b9b7a035ea112729700ef7c64"><div class="ttname"><a href="namespaceUtilities_1_1System.html#aff548b3b9b7a035ea112729700ef7c64">Utilities::System::get_date</a></div><div class="ttdeci">std::string get_date()</div><div class="ttdef"><b>Definition:</b> <a href="base_2utilities_8cc_source.html#l01035">utilities.cc:1035</a></div></div>
<div class="ttc" id="anamespaceVectorTools_html_a676190d2c897ac5da68a9c460fa95832"><div class="ttname"><a href="namespaceVectorTools.html#a676190d2c897ac5da68a9c460fa95832">VectorTools::integrate_difference</a></div><div class="ttdeci">void integrate_difference(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const InVector &amp;fe_function, const Function&lt; spacedim, typename InVector::value_type &gt; &amp;exact_solution, OutVector &amp;difference, const Quadrature&lt; dim &gt; &amp;q, const NormType &amp;norm, const Function&lt; spacedim, double &gt; *weight=nullptr, const double exponent=2.)</div></div>
<div class="ttc" id="aclassSphericalManifold_html"><div class="ttname"><a href="classSphericalManifold.html">SphericalManifold</a></div><div class="ttdef"><b>Definition:</b> <a href="grid_2manifold__lib_8h_source.html#l00214">manifold_lib.h:214</a></div></div>
<div class="ttc" id="anamespaceVectorTools_html_a21eb62d70953182dcc2b15c4e14dd533"><div class="ttname"><a href="namespaceVectorTools.html#a21eb62d70953182dcc2b15c4e14dd533">VectorTools::compute_global_error</a></div><div class="ttdeci">double compute_global_error(const Triangulation&lt; dim, spacedim &gt; &amp;tria, const InVector &amp;cellwise_error, const NormType &amp;norm, const double exponent=2.)</div></div>
<div class="ttc" id="aclassMatrixFree_html"><div class="ttname"><a href="classMatrixFree.html">MatrixFree</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_2matrix__free_8h_source.html#l00110">matrix_free.h:110</a></div></div>
<div class="ttc" id="afe_2mapping__q__generic_8h_html"><div class="ttname"><a href="fe_2mapping__q__generic_8h.html">mapping_q_generic.h</a></div></div>
<div class="ttc" id="aclassmg_1_1SmootherRelaxation_html"><div class="ttname"><a href="classmg_1_1SmootherRelaxation.html">mg::SmootherRelaxation</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_2mg__smoother_8h_source.html#l00194">mg_smoother.h:194</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga3be0d6de1c92b770e8664bce2fc7c107"><div class="ttname"><a href="group__Exceptions.html#ga3be0d6de1c92b770e8664bce2fc7c107">DataOutBase::VtkFlags::compression_level</a></div><div class="ttdeci">ZlibCompressionLevel compression_level</div><div class="ttdef"><b>Definition:</b> <a href="base_2data__out__base_8h_source.html#l01133">data_out_base.h:1133</a></div></div>
<div class="ttc" id="anamespacemg_html"><div class="ttname"><a href="namespacemg.html">mg</a></div><div class="ttdef"><b>Definition:</b> <a href="doc_2doxygen_2headers_2mg_8h_source.html#l00081">mg.h:81</a></div></div>
<div class="ttc" id="aclassDataOutInterface_html_a0864e51eb173c87e2a3edc9391ea8009"><div class="ttname"><a href="classDataOutInterface.html#a0864e51eb173c87e2a3edc9391ea8009">DataOutInterface::write_vtu_with_pvtu_record</a></div><div class="ttdeci">std::string write_vtu_with_pvtu_record(const std::string &amp;directory, const std::string &amp;filename_without_extension, const unsigned int counter, const MPI_Comm &amp;mpi_communicator, const unsigned int n_digits_for_counter=numbers::invalid_unsigned_int, const unsigned int n_groups=0) const</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8cc_source.html#l07370">data_out_base.cc:7370</a></div></div>
<div class="ttc" id="anamespaceLocalIntegrators_1_1Advection_html_a8bc7b8136646134f73a4193adefe15f8"><div class="ttname"><a href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">LocalIntegrators::Advection::cell_matrix</a></div><div class="ttdeci">void cell_matrix(FullMatrix&lt; double &gt; &amp;M, const FEValuesBase&lt; dim &gt; &amp;fe, const FEValuesBase&lt; dim &gt; &amp;fetest, const ArrayView&lt; const std::vector&lt; double &gt;&gt; &amp;velocity, const double factor=1.)</div><div class="ttdef"><b>Definition:</b> <a href="integrators_2advection_8h_source.html#l00068">advection.h:68</a></div></div>
<div class="ttc" id="alac_2affine__constraints_8h_html"><div class="ttname"><a href="lac_2affine__constraints_8h.html">affine_constraints.h</a></div></div>
<div class="ttc" id="aclassTransfiniteInterpolationManifold_html_a34326a35d9ec4b6911d90c85c21847d8"><div class="ttname"><a href="classTransfiniteInterpolationManifold.html#a34326a35d9ec4b6911d90c85c21847d8">TransfiniteInterpolationManifold::initialize</a></div><div class="ttdeci">void initialize(const Triangulation&lt; dim, spacedim &gt; &amp;triangulation)</div><div class="ttdef"><b>Definition:</b> <a href="grid_2manifold__lib_8cc_source.html#l01676">manifold_lib.cc:1676</a></div></div>
<div class="ttc" id="aclassDataOut__DoFData_html_a6ed7c846331069f406b8c9933c37fda4"><div class="ttname"><a href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">DataOut_DoFData::attach_dof_handler</a></div><div class="ttdeci">void attach_dof_handler(const DoFHandler&lt; dim, spacedim &gt; &amp;)</div></div>
<div class="ttc" id="aclassMultigrid_html"><div class="ttname"><a href="classMultigrid.html">Multigrid</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_2multigrid_8h_source.html#l00154">multigrid.h:154</a></div></div>
<div class="ttc" id="anamespaceMatrixFreeOperators_html"><div class="ttname"><a href="namespaceMatrixFreeOperators.html">MatrixFreeOperators</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_2operators_8h_source.html#l00039">operators.h:39</a></div></div>
<div class="ttc" id="aclassDoFHandler_html"><div class="ttname"><a href="classDoFHandler.html">DoFHandler&lt; dim &gt;</a></div></div>
<div class="ttc" id="aclassTable_html"><div class="ttname"><a href="classTable.html">Table</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2array__view_8h_source.html#l00033">array_view.h:33</a></div></div>
<div class="ttc" id="aclassDoFHandler_html_a553ca864aaf70330d9be86bc78f36d1e"><div class="ttname"><a href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">DoFHandler::distribute_dofs</a></div><div class="ttdeci">void distribute_dofs(const FiniteElement&lt; dim, spacedim &gt; &amp;fe)</div><div class="ttdef"><b>Definition:</b> <a href="dof__handler_8cc_source.html#l02608">dof_handler.cc:2608</a></div></div>
<div class="ttc" id="agroup__constraints_html_ga3b4ea7dfd313e388d868c4e4aa685799"><div class="ttname"><a href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a></div><div class="ttdeci">void make_hanging_node_constraints(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, AffineConstraints&lt; number &gt; &amp;constraints)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools__constraints_8cc_source.html#l01787">dof_tools_constraints.cc:1787</a></div></div>
<div class="ttc" id="aclassSolverControl_html_a42aeae81cd6b67ce93b5fbea3328371f"><div class="ttname"><a href="classSolverControl.html#a42aeae81cd6b67ce93b5fbea3328371f">SolverControl::last_step</a></div><div class="ttdeci">unsigned int last_step() const</div><div class="ttdef"><b>Definition:</b> <a href="solver__control_8cc_source.html#l00127">solver_control.cc:127</a></div></div>
<div class="ttc" id="aclassFEValues_html"><div class="ttname"><a href="classFEValues.html">FEValues&lt; dim &gt;</a></div></div>
<div class="ttc" id="aclassLinearAlgebra_1_1distributed_1_1Vector_html_a2a6cb7d50e02022283af53c2ae14f878"><div class="ttname"><a href="classLinearAlgebra_1_1distributed_1_1Vector.html#a2a6cb7d50e02022283af53c2ae14f878">LinearAlgebra::distributed::Vector::update_ghost_values</a></div><div class="ttdeci">void update_ghost_values() const</div></div>
<div class="ttc" id="afe_2fe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a"><div class="ttname"><a href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a></div><div class="ttdeci">@ update_quadrature_points</div><div class="ttdoc">Transformed quadrature points.</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__update__flags_8h_source.html#l00116">fe_update_flags.h:116</a></div></div>
<div class="ttc" id="aclassFiniteElementData_html_a2cbf5ad6b464871261dbd054bced18a8"><div class="ttname"><a href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">FiniteElementData::degree</a></div><div class="ttdeci">const unsigned int degree</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__base_8h_source.html#l00428">fe_base.h:428</a></div></div>
<div class="ttc" id="aclassTimer_html"><div class="ttname"><a href="classTimer.html">Timer</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2timer_8h_source.html#l00130">timer.h:130</a></div></div>
<div class="ttc" id="agrid__out_8cc_html_a9082f945c1d289684d0bcd51ee08e11e"><div class="ttname"><a href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a></div><div class="ttdeci">unsigned int level</div><div class="ttdef"><b>Definition:</b> <a href="grid__out_8cc_source.html#l04590">grid_out.cc:4590</a></div></div>
<div class="ttc" id="anumerics_2vector__tools_8h_html"><div class="ttname"><a href="numerics_2vector__tools_8h.html">vector_tools.h</a></div></div>
<div class="ttc" id="abase_2function_8h_html"><div class="ttname"><a href="base_2function_8h.html">function.h</a></div></div>
<div class="ttc" id="aclassTimerOutput_html"><div class="ttname"><a href="classTimerOutput.html">TimerOutput</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2timer_8h_source.html#l00591">timer.h:591</a></div></div>
<div class="ttc" id="aclassVector_html_ac4a4dbef7dd65ef8ad35ae56b57d7c05"><div class="ttname"><a href="classVector.html#ac4a4dbef7dd65ef8ad35ae56b57d7c05">Vector::reinit</a></div><div class="ttdeci">virtual void reinit(const size_type N, const bool omit_zeroing_entries=false)</div></div>
<div class="ttc" id="abase_2vectorization_8h_html_a19f846bda83b7e3f4531daacb40c64e1"><div class="ttname"><a href="base_2vectorization_8h.html#a19f846bda83b7e3f4531daacb40c64e1">std::exp</a></div><div class="ttdeci">inline ::VectorizedArray&lt; Number, width &gt; exp(const ::VectorizedArray&lt; Number, width &gt; &amp;x)</div><div class="ttdef"><b>Definition:</b> <a href="base_2vectorization_8h_source.html#l05647">vectorization.h:5647</a></div></div>
<div class="ttc" id="agroup__CPP11_html_gacdb6d3adec96a13a7079f6c893e1d3ff"><div class="ttname"><a href="group__CPP11.html#gacdb6d3adec96a13a7079f6c893e1d3ff">DoFHandler::active_cell_iterators</a></div><div class="ttdeci">IteratorRange&lt; active_cell_iterator &gt; active_cell_iterators() const</div><div class="ttdef"><b>Definition:</b> <a href="dof__handler_8cc_source.html#l02327">dof_handler.cc:2327</a></div></div>
<div class="ttc" id="aclassTimer_html_a6f3e76707411b51e7d7e7bfa5755cf02"><div class="ttname"><a href="classTimer.html#a6f3e76707411b51e7d7e7bfa5755cf02">Timer::wall_time</a></div><div class="ttdeci">double wall_time() const</div><div class="ttdef"><b>Definition:</b> <a href="timer_8cc_source.html#l00264">timer.cc:264</a></div></div>
<div class="ttc" id="aclassBlockVectorBase_html_ac718033fc083f27c45c6bfb4ac780360"><div class="ttname"><a href="classBlockVectorBase.html#ac718033fc083f27c45c6bfb4ac780360">BlockVectorBase::l2_norm</a></div><div class="ttdeci">real_type l2_norm() const</div></div>
<div class="ttc" id="aclassAffineConstraints_html_a373fbdacd8c486e675b8d2bff8943192"><div class="ttname"><a href="classAffineConstraints.html#a373fbdacd8c486e675b8d2bff8943192">AffineConstraints::distribute_local_to_global</a></div><div class="ttdeci">void distribute_local_to_global(const InVector &amp;local_vector, const std::vector&lt; size_type &gt; &amp;local_dof_indices, OutVector &amp;global_vector) const</div><div class="ttdef"><b>Definition:</b> <a href="lac_2affine__constraints_8h_source.html#l02250">affine_constraints.h:2250</a></div></div>
<div class="ttc" id="astructMatrixFree_1_1AdditionalData_html"><div class="ttname"><a href="structMatrixFree_1_1AdditionalData.html">MatrixFree::AdditionalData</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_2matrix__free_8h_source.html#l00173">matrix_free.h:173</a></div></div>
<div class="ttc" id="aclassTransfiniteInterpolationManifold_html"><div class="ttname"><a href="classTransfiniteInterpolationManifold.html">TransfiniteInterpolationManifold</a></div><div class="ttdef"><b>Definition:</b> <a href="grid_2manifold__lib_8h_source.html#l00967">manifold_lib.h:967</a></div></div>
<div class="ttc" id="aclassMGTransferMatrixFree_html_a8f214ffade006cfa85e902a94902fc7b"><div class="ttname"><a href="classMGTransferMatrixFree.html#a8f214ffade006cfa85e902a94902fc7b">MGTransferMatrixFree::build</a></div><div class="ttdeci">void build(const DoFHandler&lt; dim, dim &gt; &amp;dof_handler, const std::vector&lt; std::shared_ptr&lt; const Utilities::MPI::Partitioner &gt;&gt; &amp;external_partitioners=std::vector&lt; std::shared_ptr&lt; const Utilities::MPI::Partitioner &gt;&gt;())</div><div class="ttdef"><b>Definition:</b> <a href="mg__transfer__matrix__free_8cc_source.html#l00097">mg_transfer_matrix_free.cc:97</a></div></div>
<div class="ttc" id="amatrix__free_2operators_8h_html"><div class="ttname"><a href="matrix__free_2operators_8h.html">operators.h</a></div></div>
<div class="ttc" id="anamespaceLinearAlgebraDealII_html_a2165565a5e6b6679392a7dee5d01ef58"><div class="ttname"><a href="namespaceLinearAlgebraDealII.html#a2165565a5e6b6679392a7dee5d01ef58">LinearAlgebraDealII::Vector</a></div><div class="ttdeci">Vector&lt; double &gt; Vector</div><div class="ttdef"><b>Definition:</b> <a href="lac_2generic__linear__algebra_8h_source.html#l00046">generic_linear_algebra.h:46</a></div></div>
<div class="ttc" id="aclassdouble_html"><div class="ttname"><a href="classdouble.html">double</a></div></div>
<div class="ttc" id="aclassTimer_html_a3a8b5272198d029779dc9302a54305a8"><div class="ttname"><a href="classTimer.html#a3a8b5272198d029779dc9302a54305a8">Timer::start</a></div><div class="ttdeci">void start()</div><div class="ttdef"><b>Definition:</b> <a href="timer_8cc_source.html#l00177">timer.cc:177</a></div></div>
<div class="ttc" id="aclassTensor_html"><div class="ttname"><a href="classTensor.html">Tensor&lt; 1, dim &gt;</a></div></div>
<div class="ttc" id="anamespaceLocalIntegrators_1_1Divergence_html_a8bcfc37d2a2be8faa18628a601ecf112"><div class="ttname"><a href="namespaceLocalIntegrators_1_1Divergence.html#a8bcfc37d2a2be8faa18628a601ecf112">LocalIntegrators::Divergence::norm</a></div><div class="ttdeci">double norm(const FEValuesBase&lt; dim &gt; &amp;fe, const ArrayView&lt; const std::vector&lt; Tensor&lt; 1, dim &gt;&gt;&gt; &amp;Du)</div><div class="ttdef"><b>Definition:</b> <a href="integrators_2divergence_8h_source.html#l00472">divergence.h:472</a></div></div>
<div class="ttc" id="aclassDataOut_html_a087f63e22f0614bca326dbdca288c646"><div class="ttname"><a href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">DataOut::build_patches</a></div><div class="ttdeci">virtual void build_patches(const unsigned int n_subdivisions=0)</div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__out_8cc_source.html#l01071">data_out.cc:1071</a></div></div>
<div class="ttc" id="aclassmg_1_1Matrix_html"><div class="ttname"><a href="classmg_1_1Matrix.html">mg::Matrix</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_2mg__matrix_8h_source.html#l00045">mg_matrix.h:45</a></div></div>
<div class="ttc" id="amultigrid_2mg__smoother_8h_html"><div class="ttname"><a href="multigrid_2mg__smoother_8h.html">mg_smoother.h</a></div></div>
<div class="ttc" id="anamespaceinternal_html_aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804"><div class="ttname"><a href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">internal::EvaluatorQuantity::value</a></div><div class="ttdeci">@ value</div></div>
<div class="ttc" id="aclassVectorizedArrayBase_html_acb35404acc1693aee6e990228924cc09"><div class="ttname"><a href="classVectorizedArrayBase.html#acb35404acc1693aee6e990228924cc09">VectorizedArrayBase&lt; VectorizedArray&lt; Number, width &gt;, 1 &gt;::size</a></div><div class="ttdeci">static constexpr std::size_t size()</div><div class="ttdef"><b>Definition:</b> <a href="base_2vectorization_8h_source.html#l00272">vectorization.h:272</a></div></div>
<div class="ttc" id="aclassparallel_1_1distributed_1_1Triangulation_html"><div class="ttname"><a href="classparallel_1_1distributed_1_1Triangulation.html">parallel::distributed::Triangulation&lt; dim &gt;</a></div></div>
<div class="ttc" id="anamespaceVectorTools_html_ab2562d41bb26f362043f9719a8cd9b87"><div class="ttname"><a href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a></div><div class="ttdeci">void interpolate_boundary_values(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const std::map&lt; types::boundary_id, const Function&lt; spacedim, number &gt; * &gt; &amp;function_map, std::map&lt; types::global_dof_index, number &gt; &amp;boundary_values, const ComponentMask &amp;component_mask=ComponentMask())</div></div>
<div class="ttc" id="agroup__Exceptions_html_ga9442b63275c9ef3fab29bc222831c49c"><div class="ttname"><a href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a></div><div class="ttdeci">#define AssertDimension(dim1, dim2)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2exceptions_8h_source.html#l01749">exceptions.h:1749</a></div></div>
<div class="ttc" id="aclassMGCoarseGridApplySmoother_html_a499c7364e40031332e9943a2e5f331a2"><div class="ttname"><a href="classMGCoarseGridApplySmoother.html#a499c7364e40031332e9943a2e5f331a2">MGCoarseGridApplySmoother::initialize</a></div><div class="ttdeci">void initialize(const MGSmootherBase&lt; VectorType &gt; &amp;coarse_smooth)</div></div>
<div class="ttc" id="agroup__Exceptions_html_ga7ad65742b9dbfb7eeb04b511b5a08d63a3c83e26f202f837328b9f7532773be70"><div class="ttname"><a href="group__Exceptions.html#ga7ad65742b9dbfb7eeb04b511b5a08d63a3c83e26f202f837328b9f7532773be70">DataOutBase::VtkFlags::best_speed</a></div><div class="ttdeci">@ best_speed</div><div class="ttdef"><b>Definition:</b> <a href="base_2data__out__base_8h_source.html#l01113">data_out_base.h:1113</a></div></div>
<div class="ttc" id="adofs_2dof__tools_8h_html"><div class="ttname"><a href="dofs_2dof__tools_8h.html">dof_tools.h</a></div></div>
<div class="ttc" id="alac_2precondition_8h_html"><div class="ttname"><a href="lac_2precondition_8h.html">precondition.h</a></div></div>
<div class="ttc" id="agrid_2grid__out_8h_html"><div class="ttname"><a href="grid_2grid__out_8h.html">grid_out.h</a></div></div>
<div class="ttc" id="aclassAffineConstraints_html_a2c9d71b5b7e8851c25a411ccf34de986"><div class="ttname"><a href="classAffineConstraints.html#a2c9d71b5b7e8851c25a411ccf34de986">AffineConstraints::reinit</a></div><div class="ttdeci">void reinit(const IndexSet &amp;local_constraints=IndexSet())</div></div>
<div class="ttc" id="aclassLinearAlgebra_1_1distributed_1_1Vector_html_af355599021a687026ab9818efd57e82d"><div class="ttname"><a href="classLinearAlgebra_1_1distributed_1_1Vector.html#af355599021a687026ab9818efd57e82d">LinearAlgebra::distributed::Vector::l2_norm</a></div><div class="ttdeci">virtual real_type l2_norm() const override</div></div>
<div class="ttc" id="astructDataOutBase_1_1VtkFlags_html"><div class="ttname"><a href="structDataOutBase_1_1VtkFlags.html">DataOutBase::VtkFlags</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2data__out__base_8h_source.html#l01065">data_out_base.h:1065</a></div></div>
<div class="ttc" id="aclassQGauss_html"><div class="ttname"><a href="classQGauss.html">QGauss</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2quadrature__lib_8h_source.html#l00039">quadrature_lib.h:39</a></div></div>
<div class="ttc" id="abase_2quadrature__lib_8h_html"><div class="ttname"><a href="base_2quadrature__lib_8h.html">quadrature_lib.h</a></div></div>
<div class="ttc" id="anamespaceEvaluationFlags_html_a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f"><div class="ttname"><a href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a></div><div class="ttdeci">@ values</div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_2evaluation__flags_8h_source.html#l00055">evaluation_flags.h:55</a></div></div>
<div class="ttc" id="agrid_2manifold__lib_8h_html"><div class="ttname"><a href="grid_2manifold__lib_8h.html">manifold_lib.h</a></div></div>
<div class="ttc" id="aclassMGLevelObject_html_a16213121f9153bd08f49652a11886259"><div class="ttname"><a href="classMGLevelObject.html#a16213121f9153bd08f49652a11886259">MGLevelObject::resize</a></div><div class="ttdeci">void resize(const unsigned int new_minlevel, const unsigned int new_maxlevel, Args &amp;&amp;... args)</div><div class="ttdef"><b>Definition:</b> <a href="base_2mg__level__object_8h_source.html#l00225">mg_level_object.h:225</a></div></div>
<div class="ttc" id="agrid_2tria__accessor_8h_html"><div class="ttname"><a href="grid_2tria__accessor_8h.html">tria_accessor.h</a></div></div>
<div class="ttc" id="anamespaceGridGenerator_html_a533c4778cbc9bcbed365dcab42ca4418"><div class="ttname"><a href="namespaceGridGenerator.html#a533c4778cbc9bcbed365dcab42ca4418">GridGenerator::hyper_ball</a></div><div class="ttdeci">void hyper_ball(Triangulation&lt; dim &gt; &amp;tria, const Point&lt; dim &gt; &amp;center=Point&lt; dim &gt;(), const double radius=1., const bool attach_spherical_manifold_on_boundary_cells=false)</div></div>
<div class="ttc" id="amultigrid_2mg__tools_8h_html"><div class="ttname"><a href="multigrid_2mg__tools_8h.html">mg_tools.h</a></div></div>
<div class="ttc" id="aclassAffineConstraints_html"><div class="ttname"><a href="classAffineConstraints.html">AffineConstraints&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassAffineConstraints_html_a7b3d3f295bb56d6cd6856bdc6cbe8a01"><div class="ttname"><a href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">AffineConstraints::distribute</a></div><div class="ttdeci">void distribute(VectorType &amp;vec) const</div></div>
<div class="ttc" id="aclassAffineConstraints_html_addd15bc409c61d6f795f0132c574335b"><div class="ttname"><a href="classAffineConstraints.html#addd15bc409c61d6f795f0132c574335b">AffineConstraints::clear</a></div><div class="ttdeci">void clear()</div></div>
<div class="ttc" id="afe_2fe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85"><div class="ttname"><a href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a></div><div class="ttdeci">@ update_JxW_values</div><div class="ttdoc">Transformed quadrature weights.</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__update__flags_8h_source.html#l00124">fe_update_flags.h:124</a></div></div>
<div class="ttc" id="amultigrid_2mg__matrix_8h_html"><div class="ttname"><a href="multigrid_2mg__matrix_8h.html">mg_matrix.h</a></div></div>
<div class="ttc" id="aclassTimer_html_a4e3933a78790d7455daff5acab3f8432"><div class="ttname"><a href="classTimer.html#a4e3933a78790d7455daff5acab3f8432">Timer::cpu_time</a></div><div class="ttdeci">double cpu_time() const</div><div class="ttdef"><b>Definition:</b> <a href="timer_8cc_source.html#l00236">timer.cc:236</a></div></div>
<div class="ttc" id="aclassPreconditionMG_html"><div class="ttname"><a href="classPreconditionMG.html">PreconditionMG</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_2multigrid_8h_source.html#l00492">multigrid.h:492</a></div></div>
<div class="ttc" id="anamespaceUtilities_1_1MPI_html_a895dcd8223a0ee6f0e6a80b80e2d5982"><div class="ttname"><a href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">Utilities::MPI::this_mpi_process</a></div><div class="ttdeci">unsigned int this_mpi_process(const MPI_Comm &amp;mpi_communicator)</div><div class="ttdef"><b>Definition:</b> <a href="mpi_8cc_source.html#l00128">mpi.cc:128</a></div></div>
<div class="ttc" id="amatrix__free_2matrix__free_8h_html"><div class="ttname"><a href="matrix__free_2matrix__free_8h.html">matrix_free.h</a></div></div>
<div class="ttc" id="anamespaceinternal_html_a2b3d48efdf7c94da455dc6a3553bab79"><div class="ttname"><a href="namespaceinternal.html#a2b3d48efdf7c94da455dc6a3553bab79">internal::assemble</a></div><div class="ttdeci">void assemble(const MeshWorker::DoFInfoBox&lt; dim, DOFINFO &gt; &amp;dinfo, A *assembler)</div><div class="ttdef"><b>Definition:</b> <a href="meshworker_2loop_8h_source.html#l00072">loop.h:72</a></div></div>
<div class="ttc" id="alac_2solver__cg_8h_html"><div class="ttname"><a href="lac_2solver__cg_8h.html">solver_cg.h</a></div></div>
<div class="ttc" id="aclassMGLevelObject_html"><div class="ttname"><a href="classMGLevelObject.html">MGLevelObject</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2mg__level__object_8h_source.html#l00051">mg_level_object.h:51</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_gaa3cbced9f1d4ae661f13018f4c980aa1a9e60516f3a44e6d7cd4ac533f6bc0209"><div class="ttname"><a href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1a9e60516f3a44e6d7cd4ac533f6bc0209">DataOutBase::dx</a></div><div class="ttdeci">@ dx</div><div class="ttdef"><b>Definition:</b> <a href="base_2data__out__base_8h_source.html#l01574">data_out_base.h:1574</a></div></div>
<div class="ttc" id="astructMatrixFree_1_1AdditionalData_html_a0bcce2facca91b925d3e1a5a00c7704b"><div class="ttname"><a href="structMatrixFree_1_1AdditionalData.html#a0bcce2facca91b925d3e1a5a00c7704b">MatrixFree::AdditionalData::tasks_parallel_scheme</a></div><div class="ttdeci">TasksParallelScheme tasks_parallel_scheme</div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_2matrix__free_8h_source.html#l00333">matrix_free.h:333</a></div></div>
<div class="ttc" id="adofs_2dof__handler_8h_html"><div class="ttname"><a href="dofs_2dof__handler_8h.html">dof_handler.h</a></div></div>
<div class="ttc" id="anamespaceUtilities_1_1MPI_html_ac26de0c059200523177bb1d92cc25d00"><div class="ttname"><a href="namespaceUtilities_1_1MPI.html#ac26de0c059200523177bb1d92cc25d00">Utilities::MPI::n_mpi_processes</a></div><div class="ttdeci">unsigned int n_mpi_processes(const MPI_Comm &amp;mpi_communicator)</div><div class="ttdef"><b>Definition:</b> <a href="mpi_8cc_source.html#l00117">mpi.cc:117</a></div></div>
<div class="ttc" id="abase_2vectorization_8h_html"><div class="ttname"><a href="base_2vectorization_8h.html">vectorization.h</a></div></div>
<div class="ttc" id="amatrix__free_2fe__evaluation_8h_html"><div class="ttname"><a href="matrix__free_2fe__evaluation_8h.html">fe_evaluation.h</a></div></div>
<div class="ttc" id="aclassConditionalOStream_html"><div class="ttname"><a href="classConditionalOStream.html">ConditionalOStream</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2conditional__ostream_8h_source.html#l00083">conditional_ostream.h:83</a></div></div>
<div class="ttc" id="anamespacenumbers_html_a8ae36952c7e0cc778b47b5371b3aeff1"><div class="ttname"><a href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a></div><div class="ttdeci">static const unsigned int invalid_unsigned_int</div><div class="ttdef"><b>Definition:</b> <a href="base_2types_8h_source.html#l00179">types.h:179</a></div></div>
<div class="ttc" id="alac_2vector_8h_html"><div class="ttname"><a href="lac_2vector_8h.html">vector.h</a></div></div>
<div class="ttc" id="adofs_2dof__accessor_8h_html"><div class="ttname"><a href="dofs_2dof__accessor_8h.html">dof_accessor.h</a></div></div>
<div class="ttc" id="aclassFiniteElement_html_a09655d1d2555af8dcd48caebd4039d29"><div class="ttname"><a href="classFiniteElement.html#a09655d1d2555af8dcd48caebd4039d29">FiniteElement::get_name</a></div><div class="ttdeci">virtual std::string get_name() const =0</div></div>
<div class="ttc" id="anamespaceUtilities_1_1System_html_ade631a789101336840371e3b2e2851e0"><div class="ttname"><a href="namespaceUtilities_1_1System.html#ade631a789101336840371e3b2e2851e0">Utilities::System::get_current_vectorization_level</a></div><div class="ttdeci">const std::string get_current_vectorization_level()</div><div class="ttdef"><b>Definition:</b> <a href="base_2utilities_8cc_source.html#l00944">utilities.cc:944</a></div></div>
<div class="ttc" id="aclassFunctions_1_1ZeroFunction_html"><div class="ttname"><a href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2function_8h_source.html#l00516">function.h:516</a></div></div>
<div class="ttc" id="anamespaceMatrixFreeTools_html_a523190adf5671e317d745fed4b1d357f"><div class="ttname"><a href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">MatrixFreeTools::compute_diagonal</a></div><div class="ttdeci">void compute_diagonal(const MatrixFree&lt; dim, Number, VectorizedArrayType &gt; &amp;matrix_free, LinearAlgebra::distributed::Vector&lt; Number &gt; &amp;diagonal_global, const std::function&lt; void(FEEvaluation&lt; dim, fe_degree, n_q_points_1d, n_components, Number, VectorizedArrayType &gt; &amp;)&gt; &amp;local_vmult, const unsigned int dof_no=0, const unsigned int quad_no=0, const unsigned int first_selected_component=0)</div></div>
<div class="ttc" id="aclassDoFHandler_html_a9aed31323cbd7619edac310c47e7a7ad"><div class="ttname"><a href="classDoFHandler.html#a9aed31323cbd7619edac310c47e7a7ad">DoFHandler::distribute_mg_dofs</a></div><div class="ttdeci">void distribute_mg_dofs()</div><div class="ttdef"><b>Definition:</b> <a href="dof__handler_8cc_source.html#l02749">dof_handler.cc:2749</a></div></div>
<div class="ttc" id="anamespaceDoFTools_html_acad7e0841b9046eaafddc4c617ab1d9d"><div class="ttname"><a href="namespaceDoFTools.html#acad7e0841b9046eaafddc4c617ab1d9d">DoFTools::extract_locally_relevant_dofs</a></div><div class="ttdeci">void extract_locally_relevant_dofs(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, IndexSet &amp;dof_set)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools_8cc_source.html#l01133">dof_tools.cc:1133</a></div></div>
<div class="ttc" id="aclassFullMatrix_html"><div class="ttname"><a href="classFullMatrix.html">FullMatrix&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassFEEvaluation_html"><div class="ttname"><a href="classFEEvaluation.html">FEEvaluation</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_2fe__evaluation_8h_source.html#l00070">fe_evaluation.h:70</a></div></div>
<div class="ttc" id="amultigrid_2mg__constrained__dofs_8h_html"><div class="ttname"><a href="multigrid_2mg__constrained__dofs_8h.html">mg_constrained_dofs.h</a></div></div>
<div class="ttc" id="ap4est__wrappers_8cc_html_aa78f707e9416892e3e018027ffab1c80"><div class="ttname"><a href="p4est__wrappers_8cc.html#aa78f707e9416892e3e018027ffab1c80">triangulation</a></div><div class="ttdeci">const typename ::parallel::distributed::Triangulation&lt; dim, spacedim &gt; * triangulation</div><div class="ttdef"><b>Definition:</b> <a href="p4est__wrappers_8cc_source.html#l00069">p4est_wrappers.cc:69</a></div></div>
<div class="ttc" id="aclassSolverControl_html"><div class="ttname"><a href="classSolverControl.html">SolverControl</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2solver__control_8h_source.html#l00052">solver_control.h:52</a></div></div>
<div class="ttc" id="anamespaceinternal_1_1TriangulationImplementation_html_a9f815604be9b560fea00beef8d720480"><div class="ttname"><a href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">internal::TriangulationImplementation::n_cells</a></div><div class="ttdeci">unsigned int n_cells(const internal::TriangulationImplementation::NumberCache&lt; 1 &gt; &amp;c)</div><div class="ttdef"><b>Definition:</b> <a href="grid_2tria_8cc_source.html#l12588">tria.cc:12588</a></div></div>
<div class="ttc" id="anamespaceDoFTools_html_a1fef7be07cf379b661646e39b9354e17"><div class="ttname"><a href="namespaceDoFTools.html#a1fef7be07cf379b661646e39b9354e17">DoFTools::extract_locally_relevant_level_dofs</a></div><div class="ttdeci">void extract_locally_relevant_level_dofs(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, const unsigned int level, IndexSet &amp;dof_set)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools_8cc_source.html#l01175">dof_tools.cc:1175</a></div></div>
<div class="ttc" id="abase_2vectorization_8h_html_aafbdfdd72b6cfe4eae5fa7a16385582f"><div class="ttname"><a href="base_2vectorization_8h.html#aafbdfdd72b6cfe4eae5fa7a16385582f">std::abs</a></div><div class="ttdeci">inline ::VectorizedArray&lt; Number, width &gt; abs(const ::VectorizedArray&lt; Number, width &gt; &amp;x)</div><div class="ttdef"><b>Definition:</b> <a href="base_2vectorization_8h_source.html#l05750">vectorization.h:5750</a></div></div>
<div class="ttc" id="amultigrid_2mg__transfer__matrix__free_8h_html"><div class="ttname"><a href="multigrid_2mg__transfer__matrix__free_8h.html">mg_transfer_matrix_free.h</a></div></div>
<div class="ttc" id="anumerics_2data__out_8h_html"><div class="ttname"><a href="numerics_2data__out_8h.html">data_out.h</a></div></div>
<div class="ttc" id="aclassDataOut_html"><div class="ttname"><a href="classDataOut.html">DataOut&lt; dim &gt;</a></div></div>
<div class="ttc" id="aclassVector_html"><div class="ttname"><a href="classVector.html">Vector&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassDataOutInterface_html_ac7280a24690b117454acfb0fa058299c"><div class="ttname"><a href="classDataOutInterface.html#ac7280a24690b117454acfb0fa058299c">DataOutInterface::set_flags</a></div><div class="ttdeci">void set_flags(const FlagType &amp;flags)</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8cc_source.html#l08210">data_out_base.cc:8210</a></div></div>
<div class="ttc" id="aclassAffineConstraints_html_a1611aa37f754086388ca76bcd421cce5"><div class="ttname"><a href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">AffineConstraints::close</a></div><div class="ttdeci">void close()</div></div>
<div class="ttc" id="anamespaceparallel_html"><div class="ttname"><a href="namespaceparallel.html">parallel</a></div><div class="ttdef"><b>Definition:</b> <a href="doc_2doxygen_2headers_2distributed_8h_source.html#l00416">distributed.h:416</a></div></div>
<div class="ttc" id="anamespaceVectorTools_html_a69967cb7a148a7169963126249213db1a7c450aee1986e226cf1bd7687171d769"><div class="ttname"><a href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1a7c450aee1986e226cf1bd7687171d769">VectorTools::H1_seminorm</a></div><div class="ttdeci">@ H1_seminorm</div><div class="ttdef"><b>Definition:</b> <a href="numerics_2vector__tools__common_8h_source.html#l00123">vector_tools_common.h:123</a></div></div>
<div class="ttc" id="anamespaceUtilities_html"><div class="ttname"><a href="namespaceUtilities.html">Utilities</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2communication__pattern__base_8h_source.html#l00030">communication_pattern_base.h:30</a></div></div>
<div class="ttc" id="aclassMGTransferMatrixFree_html_a69e2b416ab209936f94db08e865cd92b"><div class="ttname"><a href="classMGTransferMatrixFree.html#a69e2b416ab209936f94db08e865cd92b">MGTransferMatrixFree::initialize_constraints</a></div><div class="ttdeci">void initialize_constraints(const MGConstrainedDoFs &amp;mg_constrained_dofs)</div><div class="ttdef"><b>Definition:</b> <a href="mg__transfer__matrix__free_8cc_source.html#l00067">mg_transfer_matrix_free.cc:67</a></div></div>
<div class="ttc" id="aclassMatrixFreeOperators_1_1Base_html"><div class="ttname"><a href="classMatrixFreeOperators_1_1Base.html">MatrixFreeOperators::Base</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_2operators_8h_source.html#l00184">operators.h:184</a></div></div>
<div class="ttc" id="amatrix__free_2tools_8h_html"><div class="ttname"><a href="matrix__free_2tools_8h.html">tools.h</a></div></div>
<div class="ttc" id="agrid_2grid__generator_8h_html"><div class="ttname"><a href="grid_2grid__generator_8h.html">grid_generator.h</a></div></div>
<div class="ttc" id="aclassMatrixFree_html_abc204ec41ead1b5060f47ef3a5a066d7"><div class="ttname"><a href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">MatrixFree::cell_loop</a></div><div class="ttdeci">void cell_loop(const std::function&lt; void(const MatrixFree&lt; dim, Number, VectorizedArrayType &gt; &amp;, OutVector &amp;, const InVector &amp;, const std::pair&lt; unsigned int, unsigned int &gt; &amp;)&gt; &amp;cell_operation, OutVector &amp;dst, const InVector &amp;src, const bool zero_dst_vector=false) const</div></div>
<div class="ttc" id="aclassDoFHandler_html_aa5b8d3c4b9deb0774dde5c2851e07e1e"><div class="ttname"><a href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">DoFHandler::n_dofs</a></div><div class="ttdeci">types::global_dof_index n_dofs() const</div></div>
<div class="ttc" id="aclassUtilities_1_1MPI_1_1MPI__InitFinalize_html"><div class="ttname"><a href="classUtilities_1_1MPI_1_1MPI__InitFinalize.html">Utilities::MPI::MPI_InitFinalize</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2mpi_8h_source.html#l00836">mpi.h:836</a></div></div>
<div class="ttc" id="aclassMGTransferMatrixFree_html"><div class="ttname"><a href="classMGTransferMatrixFree.html">MGTransferMatrixFree</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_2mg__transfer__matrix__free_8h_source.html#l00054">mg_transfer_matrix_free.h:54</a></div></div>
<div class="ttc" id="aclassMGCoarseGridApplySmoother_html"><div class="ttname"><a href="classMGCoarseGridApplySmoother.html">MGCoarseGridApplySmoother</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_2mg__coarse_8h_source.html#l00040">mg_coarse.h:40</a></div></div>
<div class="ttc" id="amultigrid_2mg__coarse_8h_html"><div class="ttname"><a href="multigrid_2mg__coarse_8h.html">mg_coarse.h</a></div></div>
<div class="ttc" id="agroup__dofs_html_ga768cd565b5c25f1ac235586e36ac94d6"><div class="ttname"><a href="group__dofs.html#ga768cd565b5c25f1ac235586e36ac94d6">hp::DoFHandler</a></div><div class="ttdeci">::DoFHandler&lt; dim, spacedim &gt; DoFHandler</div><div class="ttdef"><b>Definition:</b> <a href="hp_2dof__handler_8h_source.html#l00066">dof_handler.h:66</a></div></div>
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
