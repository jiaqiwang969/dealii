<!-- HTML header for doxygen 1.8.17-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="canonical" href="https://www.dealii.org/current/doxygen/deal.II/step_63.html" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The deal.II Library: The step-63 tutorial program</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link rel="SHORTCUT ICON" href="deal.ico"></link>
<script type="text/javascript" src="custom.js"></script>
<meta name="author" content="The deal.II Authors <authors@dealii.org>"></meta>
<meta name="copyright" content="Copyright (C) 1998 - 2021 by the deal.II authors"></meta>
<meta name="deal.II-version" content="10.0.0-pre"></meta>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo200.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Reference documentation for deal.II version 10.0.0-pre</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!--Extra macros for MathJax:-->
<div style="display:none">
\(\newcommand{\dealvcentcolon}{\mathrel{\mathop{:}}}\)
\(\newcommand{\dealcoloneq}{\dealvcentcolon\mathrel{\mkern-1.2mu}=}\)
\(\newcommand{\jump}[1]{\left[\!\left[ #1 \right]\!\right]}\)
\(\newcommand{\average}[1]{\left\{\!\left\{ #1 \right\}\!\right\}}\)
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">The step-63 tutorial program </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial depends on <a class="el" href="step_16.html">step-16</a>.</p>
<p> 
<table class="tutorial" width="50%">
<tr><th colspan="2"><b><small>Table of contents</small></b></th></tr>
<tr><td width="50%" valign="top">
<ol>
  <li> <a href="#Intro" class=bold>Introduction</a>
    <ul>
        <li><a href="#Equation">Equation</a>
      <ul>
        <li><a href="#Streamlinediffusion">Streamline diffusion</a>
      </ul>
        <li><a href="#Smoothers">Smoothers</a>
        <li><a href="#Testproblem">Test problem</a>
    </ul>
  <li> <a href="#CommProg" class=bold>The commented program</a>
    <ul>
        <li><a href="#Includefiles">Include files</a>
        <li><a href="#MeshWorkerdata">MeshWorker data</a>
        <li><a href="#Problemparameters">Problem parameters</a>
        <li><a href="#Cellpermutations">Cell permutations</a>
        <li><a href="#Righthandsideandboundaryvalues">Right-hand side and boundary values</a>
        <li><a href="#Streamlinediffusionimplementation">Streamline diffusion implementation</a>
        <li><a href="#codeAdvectionProlemcodeclass"><code>AdvectionProlem</code> class</a>
      <ul>
        <li><a href="#codeAdvectionProblemsetup_systemcode"><code>AdvectionProblem::setup_system()</code></a>
        <li><a href="#codeAdvectionProblemassemble_cellcode"><code>AdvectionProblem::assemble_cell()</code></a>
        <li><a href="#codeAdvectionProblemassemble_system_and_multigridcode"><code>AdvectionProblem::assemble_system_and_multigrid()</code></a>
        <li><a href="#codeAdvectionProblemsetup_smoothercode"><code>AdvectionProblem::setup_smoother()</code></a>
        <li><a href="#codeAdvectionProblemsolvecode"><code>AdvectionProblem::solve()</code></a>
        <li><a href="#codeAdvectionProblemoutput_resultscode"><code>AdvectionProblem::output_results()</code></a>
        <li><a href="#codeAdvectionProblemruncode"><code>AdvectionProblem::run()</code></a>
      </ul>
        <li><a href="#Thecodemaincodefunction">The <code>main</code> function</a>
      </ul>
</ol></td><td width="50%" valign="top"><ol>
  <li value="3"> <a href="#Results" class=bold>Results</a>
    <ul>
        <li><a href="#GMRESIterationNumbers"> GMRES Iteration Numbers </a>
      <ul>
        <li><a href="#DoFCellRenumbering"> DoF/Cell Renumbering </a>
        <li><a href="#Pointvsblocksmoothers"> Point vs. block smoothers </a>
      </ul>
        <li><a href="#Cost"> Cost </a>
        <li><a href="#Additionalpoints"> Additional points </a>
        <li><a href="#Possibilitiesforextensions"> Possibilities for extensions </a>
      <ul>
        <li><a href="#ConstantiterationsforQsub5sub"> Constant iterations for Q<sub>5</sub> </a>
        <li><a href="#Effectivenessofrenumberingforchangingepsilon"> Effectiveness of renumbering for changing epsilon </a>
        <li><a href="#Meshadaptivity"> Mesh adaptivity </a>
    </ul>
    </ul>
  <li> <a href="#PlainProg" class=bold>The plain program</a>
</ol> </td> </tr> </table>
 <br  />
</p>
<p><em>This program was contributed by Thomas C. Clevenger and Timo Heister.</em></p>
<p><em>The creation of this tutorial was partially supported by NSF Award DMS-1522191, DMS-1901529, OAC-1835452, by the Computational Infrastructure in Geodynamics initiative (CIG), through the NSF under Award EAR-0949446 and EAR-1550901 and The University of California - Davis. </em></p>
<dl class="section note"><dt>Note</dt><dd>If you use this program as a basis for your own work, please consider citing it in your list of references. The initial version of this work was contributed to the deal.II project by the authors listed in the following citation: <a href="https://doi.org/10.5281/zenodo.3382899"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.3382899.svg" alt="10.5281/zenodo.3382899"/></a> </dd></dl>
<p><a class="anchor" id="Intro"></a> <a class="anchor" id="Introduction"></a></p><h1>Introduction</h1>
<p>This program solves an advection-diffusion problem using a geometric multigrid (GMG) preconditioner. The basics of this preconditioner are discussed in <a class="el" href="step_16.html">step-16</a>; here we discuss the necessary changes needed for a non-symmetric PDE. Additionally, we introduce the idea of block smoothing (as compared to point smoothing in <a class="el" href="step_16.html">step-16</a>), and examine the effects of DoF renumbering for additive and multiplicative smoothers.</p>
<p><a class="anchor" id="Equation"></a></p><h3>Equation</h3>
<p>The advection-diffusion equation is given by </p><p class="formulaDsp">
\begin{align*} -\varepsilon \Delta u + \boldsymbol{\beta}\cdot \nabla u &amp; = f &amp; \text{ in } \Omega\\ u &amp;= g &amp; \text{ on } \partial\Omega \end{align*}
</p>
<p> where \(\varepsilon&gt;0\), \(\boldsymbol{\beta}\) is the <em>advection direction</em>, and \(f\) is a source. A few notes:</p>
<ol type="1">
<li>If \(\boldsymbol{\beta}=\boldsymbol{0}\), this is the Laplace equation solved in <a class="el" href="step_16.html">step-16</a> (and many other places).</li>
<li>If \(\varepsilon=0\) then this is the stationary advection equation solved in <a class="el" href="step_9.html">step-9</a>.</li>
<li>One can define a dimensionless number for this problem, called the <em>Peclet number</em>: \(\mathcal{P} \dealcoloneq \frac{\|\boldsymbol{\beta}\| L}{\varepsilon}\), where \(L\) is the length scale of the domain. It characterizes the kind of equation we are considering: If \(\mathcal{P}&gt;1\), we say the problem is <em>advection-dominated</em>, else if \(\mathcal{P}&lt;1\) we will say the problem is <em>diffusion-dominated</em>.</li>
</ol>
<p>For the discussion in this tutorial we will be concerned with advection-dominated flow. This is the complicated case: We know that for diffusion-dominated problems, the standard Galerkin method works just fine, and we also know that simple multigrid methods such as those defined in <a class="el" href="step_16.html">step-16</a> are very efficient. On the other hand, for advection-dominated problems, the standard Galerkin approach leads to oscillatory and unstable discretizations, and simple solvers are often not very efficient. This tutorial program is therefore intended to address both of these issues.</p>
<p><a class="anchor" id="Streamlinediffusion"></a></p><h4>Streamline diffusion</h4>
<p>Using the standard Galerkin finite element method, for suitable test functions \(v_h\), a discrete weak form of the PDE would read </p><p class="formulaDsp">
\begin{align*} a(u_h,v_h) = F(v_h) \end{align*}
</p>
<p> where </p><p class="formulaDsp">
\begin{align*} a(u_h,v_h) &amp;= (\varepsilon \nabla v_h,\, \nabla u_h) + (v_h,\,\boldsymbol{\beta}\cdot \nabla u_h),\\ F(v_h) &amp;= (v_h,\,f). \end{align*}
</p>
<p>Unfortunately, one typically gets oscillatory solutions with this approach. Indeed, the following error estimate can be shown for this formulation: </p><p class="formulaDsp">
\begin{align*} \|\nabla (u-u_h)\| \leq (1+\mathcal{P}) \inf_{v_h} \|\nabla (u-v_h)\|. \end{align*}
</p>
<p> The infimum on the right can be estimated as follows if the exact solution is sufficiently smooth: </p><p class="formulaDsp">
\begin{align*} \inf_{v_h} \|\nabla (u-v_h)\|. \le \|\nabla (u-I_h u)\| \le h^k C \|\nabla^k u)\| \end{align*}
</p>
<p> where \(k\) is the polynomial degree of the finite elements used. As a consequence, we obtain the estimate </p><p class="formulaDsp">
\begin{align*} \|\nabla (u-u_h)\| \leq (1+\mathcal{P}) C h^k \|\nabla^k u)\|. \end{align*}
</p>
<p> In other words, the numerical solution will converge. On the other hand, given the definition of \(\mathcal{P}\) above, we have to expect poor numerical solutions with a large error when \(\varepsilon \ll \|\boldsymbol{\beta}\| L\), i.e., if the problem has only a small amount of diffusion.</p>
<p>To combat this, we will consider the new weak form </p><p class="formulaDsp">
\begin{align*} a(u_h,\,v_h) + \sum_K (-\varepsilon \Delta u_h + \boldsymbol{\beta}\cdot \nabla u_h-f,\,\delta_K \boldsymbol{\beta}\cdot \nabla v_h)_K = F(v_h) \end{align*}
</p>
<p> where the sum is done over all cells \(K\) with the inner product taken for each cell, and \(\delta_K\) is a cell-wise constant stabilization parameter defined in <b>[john2006discontinuity]</b>.</p>
<p>Essentially, adding in the discrete strong form residual enhances the coercivity of the bilinear form \(a(\cdot,\cdot)\) which increases the stability of the discrete solution. This method is commonly referred to as <em>streamline diffusion</em> or <em>SUPG</em> (streamline upwind/Petrov-Galerkin).</p>
<p><a class="anchor" id="Smoothers"></a></p><h3>Smoothers</h3>
<p>One of the goals of this tutorial is to expand from using a simple (point-wise) Gauss-Seidel (SOR) smoother that is used in <a class="el" href="step_16.html">step-16</a> (class <a class="el" href="classPreconditionSOR.html">PreconditionSOR</a>) on each level of the multigrid hierarchy. The term "point-wise" is traditionally used in solvers to indicate that one solves at one "grid point" at a time; for scalar problems, this means to use a solver that updates one unknown of the linear system at a time, keeping all of the others fixed; one would then iterate over all unknowns in the problem and, once done, start over again from the first unknown until these "sweeps" converge. Jacobi, Gauss-Seidel, and SOR iterations can all be interpreted in this way. In the context of multigrid, one does not think of these methods as "solvers", but as "smoothers". As such, one is not interested in actually solving the linear system. It is enough to remove the high-frequency part of the residual for the multigrid method to work, because that allows restricting the solution to a coarser mesh. Therefore, one only does a few, fixed number of "sweeps" over all unknowns. In the code in this tutorial this is controlled by the "Smoothing steps" parameter.</p>
<p>But these methods are known to converge rather slowly when used as solvers. While as multigrid smoothers, they are surprisingly good, they can also be improved upon. In particular, we consider "cell-based" smoothers here as well. These methods solve for all unknowns on a cell at once, keeping all other unknowns fixed; they then move on to the next cell, and so on and so forth. One can think of them as "block" versions of Jacobi, Gauss-Seidel, or SOR, but because degrees of freedom are shared among multiple cells, these blocks overlap and the methods are in fact best be explained within the framework of additive and multiplicative Schwarz methods.</p>
<p>In contrast to <a class="el" href="step_16.html">step-16</a>, our test problem contains an advective term. Especially with a small diffusion constant \(\varepsilon\), information is transported along streamlines in the given advection direction. This means that smoothers are likely to be more effective if they allow information to travel in downstream direction within a single smoother application. If we want to solve one unknown (or block of unknowns) at a time in the order in which these unknowns (or blocks) are enumerated, then this information propagation property requires reordering degrees of freedom or cells (for the cell-based smoothers) accordingly so that the ones further upstream are treated earlier (have lower indices) and those further downstream are treated later (have larger indices). The influence of the ordering will be visible in the results section.</p>
<p>Let us now briefly define the smoothers used in this tutorial. For a more detailed introduction, we refer to <b>[KanschatNotesIterative]</b> and the books <b>[smith2004domain]</b> and <b>[toselli2006domain]</b>. A Schwarz preconditioner requires a decomposition </p><p class="formulaDsp">
\begin{align*} V = \sum_{j=1}^J V_j \end{align*}
</p>
<p> of our finite element space \(V\). Each subproblem \(V_j\) also has a Ritz projection \(P_j: V \rightarrow V_j\) based on the bilinear form \(a(\cdot,\cdot)\). This projection induces a local operator \(A_j\) for each subproblem \(V_j\). If \(\Pi_j:V\rightarrow V_j\) is the orthogonal projector onto \(V_j\), one can show \(A_jP_j=\Pi_j^TA\).</p>
<p>With this we can define an <em>additive Schwarz preconditioner</em> for the operator \(A\) as </p><p class="formulaDsp">
\begin{align*} B^{-1} = \sum_{j=1}^J P_j A^{-1} = \sum_{j=1}^J A_j^{-1} \Pi_j^T. \end{align*}
</p>
<p> In other words, we project our solution into each subproblem, apply the inverse of the subproblem \(A_j\), and sum the contributions up over all \(j\).</p>
<p>Note that one can interpret the point-wise (one unknown at a time) Jacobi method as an additive Schwarz method by defining a subproblem \(V_j\) for each degree of freedom. Then, \(A_j^{-1}\) becomes a multiplication with the inverse of a diagonal entry of \(A\).</p>
<p>For the "Block Jacobi" method used in this tutorial, we define a subproblem \(V_j\) for each cell of the mesh on the current level. Note that we use a continuous finite element, so these blocks are overlapping, as degrees of freedom on an interface between two cells belong to both subproblems. The logic for the Schwarz operator operating on the subproblems (in deal.II they are called "blocks") is implemented in the class <a class="el" href="classRelaxationBlock.html">RelaxationBlock</a>. The "Block
Jacobi" method is implemented in the class <a class="el" href="classRelaxationBlockJacobi.html">RelaxationBlockJacobi</a>. Many aspects of the class (for example how the blocks are defined and how to invert the local subproblems \(A_j\)) can be configured in the smoother data, see <a class="el" href="classRelaxationBlock_1_1AdditionalData.html">RelaxationBlock::AdditionalData</a> and <a class="el" href="namespaceDoFTools.html#a43ee44769769065bc594d1730477a4b9">DoFTools::make_cell_patches()</a> for details.</p>
<p>So far, we discussed additive smoothers where the updates can be applied independently and there is no information flowing within a single smoother application. A <em>multiplicative Schwarz preconditioner</em> addresses this and is defined by </p><p class="formulaDsp">
\begin{align*} B^{-1} = \left( I- \prod_{j=1}^J \left(I-P_j\right) \right) A^{-1}. \end{align*}
</p>
<p> In contrast to above, the updates on the subproblems \(V_j\) are applied sequentially. This means that the update obtained when inverting the subproblem \(A_j\) is immediately used in \(A_{j+1}\). This becomes visible when writing out the project: </p><p class="formulaDsp">
\begin{align*} B^{-1} = \left( I - \left(I-P_1\right)\left(I-P_2\right)\cdots\left(I-P_J\right) \right) A^{-1} = A^{-1} - \left[ \left(I-P_1\right) \left[ \left(I-P_2\right)\cdots \left[\left(I-P_J\right) A^{-1}\right] \cdots \right] \right] \end{align*}
</p>
<p>When defining the sub-spaces \(V_j\) as whole blocks of degrees of freedom, this method is implemented in the class <a class="el" href="classRelaxationBlockSOR.html">RelaxationBlockSOR</a> and used when you select "Block SOR" in this tutorial. The class <a class="el" href="classRelaxationBlockSOR.html">RelaxationBlockSOR</a> is also derived from <a class="el" href="classRelaxationBlock.html">RelaxationBlock</a>. As such, both additive and multiplicative Schwarz methods are implemented in a unified framework.</p>
<p>Finally, let us note that the standard Gauss-Seidel (or SOR) method can be seen as a multiplicative Schwarz method with a subproblem for each DoF.</p>
<p><a class="anchor" id="Testproblem"></a></p><h3>Test problem</h3>
<p>We will be considering the following test problem: \(\Omega = [-1,\,1]\times[-1,\,1]\backslash B_{0.3}(0)\), i.e., a square with a circle of radius 0.3 centered at the origin removed. In addition, we use \(\varepsilon=0.005\), \(\boldsymbol{\beta} = [-\sin(\pi/6),\,\cos(\pi/6)]\), \(f=0\), and Dirichlet boundary values </p><p class="formulaDsp">
\begin{align*} g = \left\{\begin{array}{ll} 1 &amp; \text{if } x=-1 \text{ or } y=-1,\,x\geq 0.5 \\ 0 &amp; \text{otherwise} \end{array}\right. \end{align*}
</p>
<p>The following figures depict the solutions with (left) and without (right) streamline diffusion. Without streamline diffusion we see large oscillations around the boundary layer, demonstrating the instability of the standard Galerkin finite element method for this problem.</p>
<table width="60%" align="center">
<tr>
<td align="center"><img src="https://www.dealii.org/images/steps/developer/step-63-solution.png" alt="" class="inline"/>  </td><td align="center"><img src="https://www.dealii.org/images/steps/developer/step-63-solution-no-sd.png" alt="" class="inline"/>   </td></tr>
</table>
<p><a class="anchor" id="CommProg"></a> </p><h1>The commented program</h1>
<p><a class="anchor" id="Includefiles"></a> </p><h3>Include files</h3>
<p>Typical files needed for standard deal.II:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2tensor__function_8h.html">deal.II/base/tensor_function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2timer_8h.html">deal.II/base/timer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2parameter__handler_8h.html">deal.II/base/parameter_handler.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2vector_8h.html">deal.II/lac/vector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2full__matrix_8h.html">deal.II/lac/full_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2sparse__matrix_8h.html">deal.II/lac/sparse_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2solver__gmres_8h.html">deal.II/lac/solver_gmres.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2precondition_8h.html">deal.II/lac/precondition.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2relaxation__block_8h.html">deal.II/lac/relaxation_block.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__refinement_8h.html">deal.II/grid/grid_refinement.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2manifold__lib_8h.html">deal.II/grid/manifold_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__out_8h.html">deal.II/grid/grid_out.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__renumbering_8h.html">deal.II/dofs/dof_renumbering.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2mapping__q_8h.html">deal.II/fe/mapping_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__values_8h.html">deal.II/fe/fe_values.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2matrix__tools_8h.html">deal.II/numerics/matrix_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
</div><!-- fragment --><p>Include all relevant multilevel files:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__constrained__dofs_8h.html">deal.II/multigrid/mg_constrained_dofs.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2multigrid_8h.html">deal.II/multigrid/multigrid.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__transfer_8h.html">deal.II/multigrid/mg_transfer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__tools_8h.html">deal.II/multigrid/mg_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__coarse_8h.html">deal.II/multigrid/mg_coarse.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__smoother_8h.html">deal.II/multigrid/mg_smoother.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__matrix_8h.html">deal.II/multigrid/mg_matrix.h</a>&gt;</span></div>
</div><!-- fragment --><p>C++:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;random&gt;</span></div>
</div><!-- fragment --><p>We will be using <a class="el" href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop</a> functionality for assembling matrices:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="meshworker_2mesh__loop_8h.html">deal.II/meshworker/mesh_loop.h</a>&gt;</span></div>
</div><!-- fragment --><p><a class="anchor" id="MeshWorkerdata"></a> </p><h3><a class="el" href="namespaceMeshWorker.html">MeshWorker</a> data</h3>
<p>As always, we will be putting everything related to this program into a namespace of its own.</p>
<p>Since we will be using the <a class="el" href="namespaceMeshWorker.html">MeshWorker</a> framework, the first step is to define the following structures needed by the assemble_cell() function used by <a class="el" href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop()</a>: <code><a class="el" href="structScratchData.html">ScratchData</a></code> contains an <a class="el" href="classFEValues.html">FEValues</a> object which is needed for assembling a cell's local contribution, while <code><a class="el" href="structCopyData.html">CopyData</a></code> contains the output from a cell's local contribution and necessary information to copy that to the global system. (Their purpose is also explained in the documentation of the <a class="el" href="namespaceWorkStream.html">WorkStream</a> class.)</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceStep63.html">Step63</a></div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">struct </span><a class="code" href="structScratchData.html">ScratchData</a></div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="work__stream__0_8txt.html#a8f80058531659e3e5ae0f7e91a963519">ScratchData</a>(<span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        quadrature_degree)</div>
<div class="line">      : fe_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                  <a class="code" href="classQGauss.html">QGauss</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;(quadrature_degree),</div>
<div class="line">                  <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa378cbcddbdf54fb3f9f0acf47b1c4719">update_hessians</a> |</div>
<div class="line">                    <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="work__stream__0_8txt.html#a8f80058531659e3e5ae0f7e91a963519">ScratchData</a>(<span class="keyword">const</span> <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a> &amp;scratch_data)</div>
<div class="line">      : fe_values(scratch_data.fe_values.get_fe(),</div>
<div class="line">                  scratch_data.fe_values.get_quadrature(),</div>
<div class="line">                  <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa378cbcddbdf54fb3f9f0acf47b1c4719">update_hessians</a> |</div>
<div class="line">                    <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">struct </span><a class="code" href="structCopyData.html">CopyData</a></div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="structCopyData.html">CopyData</a>() = <span class="keywordflow">default</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a>                   <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a>;</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a>                       cell_rhs;</div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; <a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>;</div>
<div class="line">  };</div>
</div><!-- fragment --><p><a class="anchor" id="Problemparameters"></a> </p><h3>Problem parameters</h3>
<p>The second step is to define the classes that deal with run-time parameters to be read from an input file.</p>
<p>We will use <a class="el" href="classParameterHandler.html">ParameterHandler</a> to pass in parameters at runtime. The structure <code><a class="el" href="structSettings.html">Settings</a></code> parses and stores the parameters to be queried throughout the program.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="structSettings.html">Settings</a></div>
<div class="line">{</div>
<div class="line">  <span class="keyword">enum</span> DoFRenumberingStrategy</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1acc6b05c836e9f74fb7ab9390ffc26f1c">none</a>,</div>
<div class="line">    <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">downstream</a>,</div>
<div class="line">    upstream,</div>
<div class="line">    <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">random</a></div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> get_parameters(<span class="keyword">const</span> std::string &amp;prm_filename);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span>                 <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa6fff35c961658bfea21e8a3ae468cec">epsilon</a>;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>           <a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>;</div>
<div class="line">  std::string            smoother_type;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>           smoothing_steps;</div>
<div class="line">  DoFRenumberingStrategy dof_renumbering;</div>
<div class="line">  <span class="keywordtype">bool</span>                   with_streamline_diffusion;</div>
<div class="line">  <span class="keywordtype">bool</span>                   <a class="code" href="structSettings.html#a4594afbef1241352404073ba65f20a97">output</a>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Settings::get_parameters(<span class="keyword">const</span> std::string &amp;prm_filename)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">/* First declare the parameters... */</span></div>
<div class="line">  <a class="code" href="classParameterHandler.html">ParameterHandler</a> prm;</div>
<div class="line"> </div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Epsilon&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;0.005&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0),</div>
<div class="line">                    <span class="stringliteral">&quot;Diffusion parameter&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Fe degree&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;1&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(1),</div>
<div class="line">                    <span class="stringliteral">&quot;Finite Element degree&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Smoother type&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;block SOR&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;SOR|Jacobi|block SOR|block Jacobi&quot;</span>),</div>
<div class="line">                    <span class="stringliteral">&quot;Select smoother: SOR|Jacobi|block SOR|block Jacobi&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Smoothing steps&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(1),</div>
<div class="line">                    <span class="stringliteral">&quot;Number of smoothing steps&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(</div>
<div class="line">    <span class="stringliteral">&quot;DoF renumbering&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;downstream&quot;</span>,</div>
<div class="line">    <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;none|downstream|upstream|random&quot;</span>),</div>
<div class="line">    <span class="stringliteral">&quot;Select DoF renumbering: none|downstream|upstream|random&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;With streamline diffusion&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                    <span class="stringliteral">&quot;Enable streamline diffusion stabilization: true|false&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Output&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                    <span class="stringliteral">&quot;Generate graphical output: true|false&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* ...and then try to read their values from the input file: */</span></div>
<div class="line">  <span class="keywordflow">if</span> (prm_filename.empty())</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a4ac3a8b19ade16e96e8ea25906daf23a">print_parameters</a>(std::cout, <a class="code" href="group__Exceptions.html#ga8364dda711b93753c6809eefe2a8e827a3a1480568c2713f53dcb21319bb28093">ParameterHandler::Text</a>);</div>
<div class="line">      <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(</div>
<div class="line">        <span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;Please pass a .prm file as the first argument!&quot;</span>));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">parse_input</a>(prm_filename);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa6fff35c961658bfea21e8a3ae468cec">epsilon</a>         = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Epsilon&quot;</span>);</div>
<div class="line">  <a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>       = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Fe degree&quot;</span>);</div>
<div class="line">  smoother_type   = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;Smoother type&quot;</span>);</div>
<div class="line">  smoothing_steps = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Smoothing steps&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> std::string <a class="code" href="fe__q__base__0_8txt.html#ac01155b6a1d9bf8e09c14f9a454cdfea">renumbering</a> = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;DoF renumbering&quot;</span>);</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="fe__q__base__0_8txt.html#ac01155b6a1d9bf8e09c14f9a454cdfea">renumbering</a> == <span class="stringliteral">&quot;none&quot;</span>)</div>
<div class="line">    dof_renumbering = <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1acc6b05c836e9f74fb7ab9390ffc26f1c">DoFRenumberingStrategy::none</a>;</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="fe__q__base__0_8txt.html#ac01155b6a1d9bf8e09c14f9a454cdfea">renumbering</a> == <span class="stringliteral">&quot;downstream&quot;</span>)</div>
<div class="line">    dof_renumbering = <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">DoFRenumberingStrategy::downstream</a>;</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="fe__q__base__0_8txt.html#ac01155b6a1d9bf8e09c14f9a454cdfea">renumbering</a> == <span class="stringliteral">&quot;upstream&quot;</span>)</div>
<div class="line">    dof_renumbering = DoFRenumberingStrategy::upstream;</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="fe__q__base__0_8txt.html#ac01155b6a1d9bf8e09c14f9a454cdfea">renumbering</a> == <span class="stringliteral">&quot;random&quot;</span>)</div>
<div class="line">    dof_renumbering = <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">DoFRenumberingStrategy::random</a>;</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>,</div>
<div class="line">                <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;The &lt;DoF renumbering&gt; parameter has &quot;</span></div>
<div class="line">                           <span class="stringliteral">&quot;an invalid value.&quot;</span>));</div>
<div class="line"> </div>
<div class="line">  with_streamline_diffusion = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;With streamline diffusion&quot;</span>);</div>
<div class="line">  <a class="code" href="structSettings.html#a4594afbef1241352404073ba65f20a97">output</a>                    = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;Output&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Cellpermutations"></a> </p><h3>Cell permutations</h3>
<p>The ordering in which cells and degrees of freedom are traversed will play a role in the speed of convergence for multiplicative methods. Here we define functions which return a specific ordering of cells to be used by the block smoothers.</p>
<p>For each type of cell ordering, we define a function for the active mesh and one for a level mesh (i.e., for the cells at one level of a multigrid hierarchy). While the only reordering necessary for solving the system will be on the level meshes, we include the active reordering for visualization purposes in output_results().</p>
<p>For the two downstream ordering functions, we first create an array with all of the relevant cells that we then sort in downstream direction using a "comparator" object. The output of the functions is then simply an array of the indices of the cells in the just computed order.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">std::vector&lt;unsigned int&gt;</div>
<div class="line"><a class="code" href="namespaceStep63.html#a679f6c35915713a90230f261b38f041e">create_downstream_cell_ordering</a>(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div>
<div class="line">                                <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a>   <a class="code" href="dofs__0_8txt.html#ae704d52abb496c815f42849c4de0f458">direction</a>,</div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>     <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">{</div>
<div class="line">  std::vector&lt;typename DoFHandler&lt;dim&gt;::level_cell_iterator&gt; ordered_cells;</div>
<div class="line">  ordered_cells.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().<a class="code" href="classTriangulation.html#abea687f123f3f5a8b09d7485cf03be72">n_cells</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#ga8c046284df67198c2d82c25950ea1ea3">cell_iterators_on_level</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>))</div>
<div class="line">    ordered_cells.push_back(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> DoFRenumbering::</div>
<div class="line">    CompareDownstream&lt;typename DoFHandler&lt;dim&gt;::level_cell_iterator, <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;</div>
<div class="line">      comparator(<a class="code" href="dofs__0_8txt.html#ae704d52abb496c815f42849c4de0f458">direction</a>);</div>
<div class="line">  std::sort(ordered_cells.begin(), ordered_cells.end(), comparator);</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;unsigned&gt; ordered_indices;</div>
<div class="line">  ordered_indices.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().<a class="code" href="classTriangulation.html#abea687f123f3f5a8b09d7485cf03be72">n_cells</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : ordered_cells)</div>
<div class="line">    ordered_indices.push_back(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;index());</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> ordered_indices;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">std::vector&lt;unsigned int&gt;</div>
<div class="line"><a class="code" href="namespaceStep63.html#a679f6c35915713a90230f261b38f041e">create_downstream_cell_ordering</a>(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div>
<div class="line">                                <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a>   <a class="code" href="dofs__0_8txt.html#ae704d52abb496c815f42849c4de0f458">direction</a>)</div>
<div class="line">{</div>
<div class="line">  std::vector&lt;typename DoFHandler&lt;dim&gt;::active_cell_iterator&gt; ordered_cells;</div>
<div class="line">  ordered_cells.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().<a class="code" href="classTriangulation.html#a5ea5c9957dbb566a562bbe2c0f3971e9">n_active_cells</a>());</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">    ordered_cells.push_back(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> DoFRenumbering::</div>
<div class="line">    CompareDownstream&lt;typename DoFHandler&lt;dim&gt;::active_cell_iterator, <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;</div>
<div class="line">      comparator(<a class="code" href="dofs__0_8txt.html#ae704d52abb496c815f42849c4de0f458">direction</a>);</div>
<div class="line">  std::sort(ordered_cells.begin(), ordered_cells.end(), comparator);</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;unsigned int&gt; ordered_indices;</div>
<div class="line">  ordered_indices.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().<a class="code" href="classTriangulation.html#a5ea5c9957dbb566a562bbe2c0f3971e9">n_active_cells</a>());</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : ordered_cells)</div>
<div class="line">    ordered_indices.push_back(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;index());</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> ordered_indices;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The functions that produce a random ordering are similar in spirit in that they first put information about all cells into an array. But then, instead of sorting them, they shuffle the elements randomly using the facilities C++ offers to generate random numbers. The way this is done is by iterating over all elements of the array, drawing a random number for another element before that, and then exchanging these elements. The result is a random shuffle of the elements of the array.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">std::vector&lt;unsigned int&gt;</div>
<div class="line"><a class="code" href="namespaceStep63.html#a5bcdd1e04c358777541a2922f8803db4">create_random_cell_ordering</a>(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>     <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">{</div>
<div class="line">  std::vector&lt;unsigned int&gt; ordered_cells;</div>
<div class="line">  ordered_cells.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().<a class="code" href="classTriangulation.html#abea687f123f3f5a8b09d7485cf03be72">n_cells</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#ga8c046284df67198c2d82c25950ea1ea3">cell_iterators_on_level</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>))</div>
<div class="line">    ordered_cells.push_back(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;index());</div>
<div class="line"> </div>
<div class="line">  std::mt19937 random_number_generator;</div>
<div class="line">  std::shuffle(ordered_cells.begin(),</div>
<div class="line">               ordered_cells.end(),</div>
<div class="line">               random_number_generator);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> ordered_cells;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">std::vector&lt;unsigned int&gt;</div>
<div class="line"><a class="code" href="namespaceStep63.html#a5bcdd1e04c358777541a2922f8803db4">create_random_cell_ordering</a>(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler)</div>
<div class="line">{</div>
<div class="line">  std::vector&lt;unsigned int&gt; ordered_cells;</div>
<div class="line">  ordered_cells.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().<a class="code" href="classTriangulation.html#a5ea5c9957dbb566a562bbe2c0f3971e9">n_active_cells</a>());</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">    ordered_cells.push_back(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;index());</div>
<div class="line"> </div>
<div class="line">  std::mt19937 random_number_generator;</div>
<div class="line">  std::shuffle(ordered_cells.begin(),</div>
<div class="line">               ordered_cells.end(),</div>
<div class="line">               random_number_generator);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> ordered_cells;</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Righthandsideandboundaryvalues"></a> </p><h3>Right-hand side and boundary values</h3>
<p>The problem solved in this tutorial is an adaptation of Ex. 3.1.3 found on pg. 118 of <a href="https://global.oup.com/academic/product/finite-elements-and-fast-iterative-solvers-9780199678808">Finite Elements and Fast Iterative Solvers: with Applications in Incompressible Fluid Dynamics by Elman, Silvester, and Wathen</a>. The main difference being that we add a hole in the center of our domain with zero Dirichlet boundary conditions.</p>
<p>For a complete description, we need classes that implement the zero right-hand side first (we could of course have just used <a class="el" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction</a>):</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span><a class="code" href="classRightHandSide.html">RightHandSide</a> : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="classRightHandSide.html#a07b87d7025c7c5feca044c5c7d4296ef">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; <a class="code" href="parsed__convergence__table__0_8txt.html#a8a90f5ba57a42a3fd4c067e00f8b8aea">p</a>,</div>
<div class="line">                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a> = 0) <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classFunction.html#a562fc1114e95e702e6696721f71528db">value_list</a>(<span class="keyword">const</span> <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;<a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>,</div>
<div class="line">                          std::vector&lt;double&gt; &amp;          <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>,</div>
<div class="line">                          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a> = 0) <span class="keyword">const override</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">double</span> <a class="code" href="classRightHandSide.html#a07b87d7025c7c5feca044c5c7d4296ef">RightHandSide&lt;dim&gt;::value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp;,</div>
<div class="line">                                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a> == 0, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>, 0, 1));</div>
<div class="line">  (void)<a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0.0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classFunction.html#a562fc1114e95e702e6696721f71528db">RightHandSide&lt;dim&gt;::value_list</a>(<span class="keyword">const</span> <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;<a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>,</div>
<div class="line">                                    std::vector&lt;double&gt; &amp;          <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>,</div>
<div class="line">                                    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>.size() == <a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>.size(),</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga6060b2304b8600f5efa0d31eeda0207d">ExcDimensionMismatch</a>(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>.size(), <a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>.size()));</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>.size(); ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">    <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] = <a class="code" href="classRightHandSide.html">RightHandSide&lt;dim&gt;::value</a>(<a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>], <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>We also have Dirichlet boundary conditions. On a connected portion of the outer, square boundary we set the value to 1, and we set the value to 0 everywhere else (including the inner, circular boundary):</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span><a class="code" href="classBoundaryValues.html">BoundaryValues</a> : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="classBoundaryValues.html#a45af33d412a06517009ba6f342340256">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; <a class="code" href="parsed__convergence__table__0_8txt.html#a8a90f5ba57a42a3fd4c067e00f8b8aea">p</a>,</div>
<div class="line">                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a> = 0) <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classFunction.html#a562fc1114e95e702e6696721f71528db">value_list</a>(<span class="keyword">const</span> <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;<a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>,</div>
<div class="line">                          std::vector&lt;double&gt; &amp;          <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>,</div>
<div class="line">                          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a> = 0) <span class="keyword">const override</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">double</span> <a class="code" href="classBoundaryValues.html#a45af33d412a06517009ba6f342340256">BoundaryValues&lt;dim&gt;::value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; <a class="code" href="parsed__convergence__table__0_8txt.html#a8a90f5ba57a42a3fd4c067e00f8b8aea">p</a>,</div>
<div class="line">                                  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a> == 0, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>, 0, 1));</div>
<div class="line">  (void)<a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>;</div>
</div><!-- fragment --><p>Set boundary to 1 if \(x=1\), or if \(x&gt;0.5\) and \(y=-1\).</p>
<div class="fragment"><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(<a class="code" href="parsed__convergence__table__0_8txt.html#a8a90f5ba57a42a3fd4c067e00f8b8aea">p</a>[0] - 1) &lt; 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-8 ||</div>
<div class="line">      (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(<a class="code" href="parsed__convergence__table__0_8txt.html#a8a90f5ba57a42a3fd4c067e00f8b8aea">p</a>[1] + 1) &lt; 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-8 &amp;&amp; <a class="code" href="parsed__convergence__table__0_8txt.html#a8a90f5ba57a42a3fd4c067e00f8b8aea">p</a>[0] &gt;= 0.5))</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">return</span> 1.0;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">return</span> 0.0;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classFunction.html#a562fc1114e95e702e6696721f71528db">BoundaryValues&lt;dim&gt;::value_list</a>(<span class="keyword">const</span> <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;<a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>,</div>
<div class="line">                                     std::vector&lt;double&gt; &amp;          <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>,</div>
<div class="line">                                     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>.size() == <a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>.size(),</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga6060b2304b8600f5efa0d31eeda0207d">ExcDimensionMismatch</a>(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>.size(), <a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>.size()));</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>.size(); ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">    <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] = <a class="code" href="classBoundaryValues.html">BoundaryValues&lt;dim&gt;::value</a>(<a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>], <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Streamlinediffusionimplementation"></a> </p><h3>Streamline diffusion implementation</h3>
<p>The streamline diffusion method has a stabilization constant that we need to be able to compute. The choice of how this parameter is computed is taken from <a href="https://link.springer.com/chapter/10.1007/978-3-540-34288-5_27">On Discontinuity-Capturing Methods for Convection-Diffusion Equations by Volker John and Petr Knobloch</a>.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">double</span> <a class="code" href="namespaceStep63.html#abe37f2d8c4bdc6c9dc4255f0a778aeec">compute_stabilization_delta</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>         hk,</div>
<div class="line">                                   <span class="keyword">const</span> <span class="keywordtype">double</span>         <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1ab87bd17d3acf6932f7bb6927f58fe3cd">eps</a>,</div>
<div class="line">                                   <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> dir,</div>
<div class="line">                                   <span class="keyword">const</span> <span class="keywordtype">double</span>         pk)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> Peclet = dir.<a class="code" href="classTensor.html#afd0934b4edd71063f66a9c67540e79fc">norm</a>() * hk / (2.0 * <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1ab87bd17d3acf6932f7bb6927f58fe3cd">eps</a> * pk);</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespaceDifferentiation_1_1SD.html#a66e76f1c4fdb9a31f4fabef8abee5f28">coth</a> =</div>
<div class="line">    (1.0 + <a class="code" href="base_2vectorization_8h.html#a19f846bda83b7e3f4531daacb40c64e1">std::exp</a>(-2.0 * Peclet)) / (1.0 - std::exp(-2.0 * Peclet));</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> hk / (2.0 * dir.<a class="code" href="classTensor.html#afd0934b4edd71063f66a9c67540e79fc">norm</a>() * pk) * (<a class="code" href="namespaceDifferentiation_1_1SD.html#a66e76f1c4fdb9a31f4fabef8abee5f28">coth</a> - 1.0 / Peclet);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeAdvectionProlemcodeclass"></a> </p><h3><code>AdvectionProlem</code> class</h3>
<p>This is the main class of the program, and should look very similar to <a class="el" href="step_16.html">step-16</a>. The major difference is that, since we are defining our multigrid smoother at runtime, we choose to define a function <code>create_smoother()</code> and a class object <code>mg_smoother</code> which is a <code>std::unique_ptr</code> to a smoother that is derived from <a class="el" href="classMGSmoother.html">MGSmoother</a>. Note that for smoothers derived from <a class="el" href="classRelaxationBlock.html">RelaxationBlock</a>, we must include a <code>smoother_data</code> object for each level. This will contain information about the cell ordering and the method of inverting cell matrices.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>AdvectionProblem</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  AdvectionProblem(<span class="keyword">const</span> <a class="code" href="structSettings.html">Settings</a> &amp;<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>);</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">run</a>();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keywordtype">void</span> setup_system();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">class</span> IteratorType&gt;</div>
<div class="line">  <span class="keywordtype">void</span> assemble_cell(<span class="keyword">const</span> IteratorType &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>,</div>
<div class="line">                     <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a> &amp;  scratch_data,</div>
<div class="line">                     <a class="code" href="structCopyData.html">CopyData</a> &amp;          copy_data);</div>
<div class="line">  <span class="keywordtype">void</span> assemble_system_and_multigrid();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> setup_smoother();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>();</div>
<div class="line">  <span class="keywordtype">void</span> refine_grid();</div>
<div class="line">  <span class="keywordtype">void</span> output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>;</div>
<div class="line">  <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>    dof_handler;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a>     <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>;</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classMappingQ.html">MappingQ&lt;dim&gt;</a> <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classSparsityPattern.html">SparsityPattern</a>      <a class="code" href="trilinos__sparse__matrix__0_8txt.html#ab4e34663c28496ee1b07f40fd5d00fa1">sparsity_pattern</a>;</div>
<div class="line">  <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> system_matrix;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>;</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> system_rhs;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparsityPattern&gt;</a> mg_sparsity_patterns;</div>
<div class="line">  <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparsityPattern&gt;</a> mg_interface_sparsity_patterns;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparseMatrix&lt;double&gt;</a>&gt; mg_matrices;</div>
<div class="line">  <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparseMatrix&lt;double&gt;</a>&gt; mg_interface_in;</div>
<div class="line">  <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparseMatrix&lt;double&gt;</a>&gt; mg_interface_out;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;Vector&lt;double&gt;</a>&gt; mg_matrix;</div>
<div class="line">  <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;Vector&lt;double&gt;</a>&gt; mg_interface_matrix_in;</div>
<div class="line">  <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;Vector&lt;double&gt;</a>&gt; mg_interface_matrix_out;</div>
<div class="line"> </div>
<div class="line">  std::unique_ptr&lt;MGSmoother&lt;Vector&lt;double&gt;&gt;&gt; mg_smoother;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using</span> SmootherType =</div>
<div class="line">    <a class="code" href="classRelaxationBlock.html">RelaxationBlock&lt;SparseMatrix&lt;double&gt;</a>, <a class="code" href="hdf5__0_8txt.html#aae153b86de45d3354cd3edd5b992435e">double</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;;</div>
<div class="line">  <span class="keyword">using</span> SmootherAdditionalDataType = <a class="code" href="relaxation__block__0_8txt.html#a2076fd56276055e74e230fad6edac013">SmootherType::AdditionalData</a>;</div>
<div class="line">  <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SmootherAdditionalDataType&gt;</a> smoother_data;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classMGConstrainedDoFs.html">MGConstrainedDoFs</a> mg_constrained_dofs;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> advection_direction;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="structSettings.html">Settings</a> <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">AdvectionProblem&lt;dim&gt;::AdvectionProblem(<span class="keyword">const</span> <a class="code" href="structSettings.html">Settings</a> &amp;<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>)</div>
<div class="line">  : <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>(<a class="code" href="classTriangulation.html">Triangulation</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;::limit_level_difference_at_vertices)</div>
<div class="line">  , dof_handler(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>)</div>
<div class="line">  , <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.<a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>)</div>
<div class="line">  , <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.<a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>)</div>
<div class="line">  , <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>)</div>
<div class="line">{</div>
<div class="line">  advection_direction[0] = -<a class="code" href="function__time__0_8txt.html#aec9d63e7b1c02618470be701525a5211">std::sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a> / 6.0);</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> &gt;= 2)</div>
<div class="line">    advection_direction[1] = <a class="code" href="base_2vectorization_8h.html#a11c48f86a4f2adf21555e64049ecde8c">std::cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a> / 6.0);</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> &gt;= 3)</div>
<div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeAdvectionProblemsetup_systemcode"></a> </p><h4><code>AdvectionProblem::setup_system()</code></h4>
<p>Here we first set up the <a class="el" href="classDoFHandler.html">DoFHandler</a>, <a class="el" href="classAffineConstraints.html">AffineConstraints</a>, and <a class="el" href="classSparsityPattern.html">SparsityPattern</a> objects for both active and multigrid level meshes.</p>
<p>We could renumber the active DoFs with the <a class="el" href="namespaceDoFRenumbering.html">DoFRenumbering</a> class, but the smoothers only act on multigrid levels and as such, this would not matter for the computations. Instead, we will renumber the DoFs on each multigrid level below.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::setup_system()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a> = <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_levels();</div>
<div class="line"> </div>
<div class="line">  dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">  system_rhs.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#addd15bc409c61d6f795f0132c574335b">clear</a>();</div>
<div class="line">  <a class="code" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a>(dof_handler, <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">    <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>, dof_handler, 0, <a class="code" href="classBoundaryValues.html">BoundaryValues&lt;dim&gt;</a>(), <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>);</div>
<div class="line">  <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">    <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>, dof_handler, 1, <a class="code" href="classBoundaryValues.html">BoundaryValues&lt;dim&gt;</a>(), <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>);</div>
<div class="line">  <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">  <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler,</div>
<div class="line">                                  dsp,</div>
<div class="line">                                  <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>,</div>
<div class="line">                                  <span class="comment">/*keep_constrained_dofs = */</span> <span class="keyword">false</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="trilinos__sparse__matrix__0_8txt.html#ab4e34663c28496ee1b07f40fd5d00fa1">sparsity_pattern</a>.copy_from(dsp);</div>
<div class="line">  system_matrix.reinit(<a class="code" href="trilinos__sparse__matrix__0_8txt.html#ab4e34663c28496ee1b07f40fd5d00fa1">sparsity_pattern</a>);</div>
<div class="line"> </div>
<div class="line">  dof_handler.<a class="code" href="classDoFHandler.html#a9aed31323cbd7619edac310c47e7a7ad">distribute_mg_dofs</a>();</div>
</div><!-- fragment --><p>Having enumerated the global degrees of freedom as well as (in the last line above) the level degrees of freedom, let us renumber the level degrees of freedom to get a better smoother as explained in the introduction. The first block below renumbers DoFs on each level in downstream or upstream direction if needed. This is only necessary for point smoothers (SOR and Jacobi) as the block smoothers operate on cells (see <code>create_smoother()</code>). The blocks below then also implement random numbering.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;SOR&quot;</span> || <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;Jacobi&quot;</span>)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.dof_renumbering ==</div>
<div class="line">          <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">Settings::DoFRenumberingStrategy::downstream</a> ||</div>
<div class="line">        <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.dof_renumbering ==</div>
<div class="line">          Settings::DoFRenumberingStrategy::upstream)</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> <a class="code" href="dofs__0_8txt.html#ae704d52abb496c815f42849c4de0f458">direction</a> =</div>
<div class="line">          (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.dof_renumbering ==</div>
<div class="line">               Settings::DoFRenumberingStrategy::upstream ?</div>
<div class="line">             -1.0 :</div>
<div class="line">             1.0) *</div>
<div class="line">          advection_direction;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a>; ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">          <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">DoFRenumbering::downstream</a>(dof_handler,</div>
<div class="line">                                     <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>,</div>
<div class="line">                                     <a class="code" href="dofs__0_8txt.html#ae704d52abb496c815f42849c4de0f458">direction</a>,</div>
<div class="line">                                     <span class="comment">/*dof_wise_renumbering = */</span> <span class="keyword">true</span>);</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.dof_renumbering ==</div>
<div class="line">             <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">Settings::DoFRenumberingStrategy::random</a>)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a>; ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">          <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">DoFRenumbering::random</a>(dof_handler, <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">  }</div>
</div><!-- fragment --><p>The rest of the function just sets up data structures. The last lines of the code below is unlike the other GMG tutorials, as it sets up both the interface in and out matrices. We need this since our problem is non-symmetric.</p>
<div class="fragment"><div class="line">  mg_constrained_dofs.clear();</div>
<div class="line">  mg_constrained_dofs.initialize(dof_handler);</div>
<div class="line"> </div>
<div class="line">  mg_constrained_dofs.make_zero_boundary_constraints(dof_handler, {0, 1});</div>
<div class="line"> </div>
<div class="line">  mg_matrices.resize(0, <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a> - 1);</div>
<div class="line">  mg_matrices.clear_elements();</div>
<div class="line">  mg_interface_in.resize(0, <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a> - 1);</div>
<div class="line">  mg_interface_in.clear_elements();</div>
<div class="line">  mg_interface_out.resize(0, <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a> - 1);</div>
<div class="line">  mg_interface_out.clear_elements();</div>
<div class="line">  mg_sparsity_patterns.resize(0, <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a> - 1);</div>
<div class="line">  mg_interface_sparsity_patterns.resize(0, <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a> - 1);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a>; ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">    {</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>),</div>
<div class="line">                                   dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">        <a class="code" href="namespaceMGTools.html#a19ba9ee4a2b65235c8bb3fb65ea8f4e0">MGTools::make_sparsity_pattern</a>(dof_handler, dsp, <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">        mg_sparsity_patterns[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].copy_from(dsp);</div>
<div class="line">        mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].reinit(mg_sparsity_patterns[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>]);</div>
<div class="line">      }</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>),</div>
<div class="line">                                   dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">        <a class="code" href="namespaceMGTools.html#a8c677f65f8f1d21fb1f4c55cb90079e0">MGTools::make_interface_sparsity_pattern</a>(dof_handler,</div>
<div class="line">                                                 mg_constrained_dofs,</div>
<div class="line">                                                 dsp,</div>
<div class="line">                                                 <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">        mg_interface_sparsity_patterns[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].copy_from(dsp);</div>
<div class="line"> </div>
<div class="line">        mg_interface_in[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].reinit(mg_interface_sparsity_patterns[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>]);</div>
<div class="line">        mg_interface_out[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].reinit(mg_interface_sparsity_patterns[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>]);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeAdvectionProblemassemble_cellcode"></a> </p><h4><code>AdvectionProblem::assemble_cell()</code></h4>
<p>Here we define the assembly of the linear system on each cell to be used by the <a class="el" href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">mesh_loop()</a> function below. This one function assembles the cell matrix for either an active or a level cell (whatever it is passed as its first argument), and only assembles a right-hand side if called with an active cell.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> IteratorType&gt;</div>
<div class="line"><span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::assemble_cell(<span class="keyword">const</span> IteratorType &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>,</div>
<div class="line">                                          <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a> &amp;  scratch_data,</div>
<div class="line">                                          <a class="code" href="structCopyData.html">CopyData</a> &amp;          copy_data)</div>
<div class="line">{</div>
<div class="line">  copy_data.level = <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;level();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> =</div>
<div class="line">    scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.get_fe().n_dofs_per_cell();</div>
<div class="line">  copy_data.dofs_per_cell = <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>;</div>
<div class="line">  copy_data.cell_matrix.reinit(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>, <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a> =</div>
<div class="line">    scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.<a class="code" href="classFEValues.html#ae053b49309f1dce22268c6bc8fe50cb2">get_quadrature</a>().size();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;is_level_cell() == <span class="keyword">false</span>)</div>
<div class="line">    copy_data.cell_rhs.reinit(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">  copy_data.local_dof_indices.resize(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">  <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;get_active_or_mg_dof_indices(copy_data.local_dof_indices);</div>
<div class="line"> </div>
<div class="line">  scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classRightHandSide.html">RightHandSide&lt;dim&gt;</a>  <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>;</div>
<div class="line">  std::vector&lt;double&gt; rhs_values(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>.value_list(scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.get_quadrature_points(),</div>
<div class="line">                             rhs_values);</div>
</div><!-- fragment --><p>If we are using streamline diffusion we must add its contribution to both the cell matrix and the cell right-hand side. If we are not using streamline diffusion, setting \(\delta=0\) negates this contribution below and we are left with the standard, Galerkin finite element assembly.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> delta = (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.with_streamline_diffusion ?</div>
<div class="line">                        <a class="code" href="namespaceStep63.html#abe37f2d8c4bdc6c9dc4255f0a778aeec">compute_stabilization_delta</a>(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;diameter(),</div>
<div class="line">                                                    <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.epsilon,</div>
<div class="line">                                                    advection_direction,</div>
<div class="line">                                                    <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.fe_degree) :</div>
<div class="line">                        0.0);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q_point)</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> = 0; <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>)</div>
<div class="line">        {</div>
</div><!-- fragment --><p>The assembly of the local matrix has two parts. First the Galerkin contribution:</p>
<div class="fragment"><div class="line">copy_data.cell_matrix(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>) +=</div>
<div class="line">  (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.epsilon *</div>
<div class="line">   scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) *</div>
<div class="line">   scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point) *</div>
<div class="line">   scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.JxW(q_point)) +</div>
<div class="line">  (scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_value(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) *</div>
<div class="line">   (advection_direction *</div>
<div class="line">    scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point)) *</div>
<div class="line">   scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.JxW(q_point))</div>
</div><!-- fragment --><p>and then the streamline diffusion contribution:</p>
<div class="fragment"><div class="line">      + delta *</div>
<div class="line">          (advection_direction *</div>
<div class="line">           scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point)) *</div>
<div class="line">          (advection_direction *</div>
<div class="line">           scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point)) *</div>
<div class="line">          scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.JxW(q_point) -</div>
<div class="line">      delta * <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.epsilon *</div>
<div class="line">        <a class="code" href="classSymmetricTensor.html#a9137b6052702150e8e5b1188d1971906">trace</a>(scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_hessian(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point)) *</div>
<div class="line">        (advection_direction *</div>
<div class="line">         scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point)) *</div>
<div class="line">        scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.JxW(q_point);</div>
<div class="line">  }</div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;is_level_cell() == <span class="keyword">false</span>)</div>
<div class="line">  {</div>
</div><!-- fragment --><p>The same applies to the right hand side. First the Galerkin contribution:</p>
<div class="fragment"><div class="line">copy_data.cell_rhs(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>) +=</div>
<div class="line">  scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_value(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) *</div>
<div class="line">    rhs_values[q_point] * scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.JxW(q_point)</div>
</div><!-- fragment --><p>and then the streamline diffusion contribution:</p>
<div class="fragment"><div class="line">              + delta * rhs_values[q_point] * advection_direction *</div>
<div class="line">                  scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) *</div>
<div class="line">                  scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.JxW(q_point);</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeAdvectionProblemassemble_system_and_multigridcode"></a> </p><h4><code>AdvectionProblem::assemble_system_and_multigrid()</code></h4>
<p>Here we employ <a class="el" href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop()</a> to go over cells and assemble the system_matrix, system_rhs, and all mg_matrices for us.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::assemble_system_and_multigrid()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> cell_worker_active =</div>
<div class="line">    [&amp;](<span class="keyword">const</span> decltype(dof_handler.<a class="code" href="classDoFHandler.html#a9a3bef554c6d22abe312e10e9475eecf">begin_active</a>()) &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>,</div>
<div class="line">        <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a> &amp;                          scratch_data,</div>
<div class="line">        <a class="code" href="structCopyData.html">CopyData</a> &amp;                                  copy_data) {</div>
<div class="line">      this-&gt;assemble_cell(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, scratch_data, copy_data);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> copier_active = [&amp;](<span class="keyword">const</span> <a class="code" href="structCopyData.html">CopyData</a> &amp;copy_data) {</div>
<div class="line">    <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#a373fbdacd8c486e675b8d2bff8943192">distribute_local_to_global</a>(copy_data.cell_matrix,</div>
<div class="line">                                           copy_data.cell_rhs,</div>
<div class="line">                                           copy_data.local_dof_indices,</div>
<div class="line">                                           system_matrix,</div>
<div class="line">                                           system_rhs);</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop</a>(dof_handler.<a class="code" href="classDoFHandler.html#a9a3bef554c6d22abe312e10e9475eecf">begin_active</a>(),</div>
<div class="line">                        dof_handler.<a class="code" href="classDoFHandler.html#a042c4bf0f59fef5e72dbcfbdd56b2782">end</a>(),</div>
<div class="line">                        cell_worker_active,</div>
<div class="line">                        copier_active,</div>
<div class="line">                        <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>, <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1),</div>
<div class="line">                        <a class="code" href="structCopyData.html">CopyData</a>(),</div>
<div class="line">                        <a class="code" href="namespaceMeshWorker.html#ac7a9db8b34d398d7d398d1e8809874aaacb8627085561cee8b7af9d74320696eb">MeshWorker::assemble_own_cells</a>);</div>
</div><!-- fragment --><p>Unlike the constraints for the active level, we choose to create constraint objects for each multigrid level local to this function since they are never needed elsewhere in the program.</p>
<div class="fragment"><div class="line">std::vector&lt;AffineConstraints&lt;double&gt;&gt; boundary_constraints(</div>
<div class="line">  <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels());</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels();</div>
<div class="line">     ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classIndexSet.html">IndexSet</a> locally_owned_level_dof_indices;</div>
<div class="line">    <a class="code" href="namespaceDoFTools.html#a1fef7be07cf379b661646e39b9354e17">DoFTools::extract_locally_relevant_level_dofs</a>(</div>
<div class="line">      dof_handler, <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>, locally_owned_level_dof_indices);</div>
<div class="line">    boundary_constraints[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].reinit(locally_owned_level_dof_indices);</div>
<div class="line">    boundary_constraints[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].add_lines(</div>
<div class="line">      mg_constrained_dofs.get_refinement_edge_indices(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">    boundary_constraints[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].add_lines(</div>
<div class="line">      mg_constrained_dofs.get_boundary_indices(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">    boundary_constraints[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].close();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> cell_worker_mg =</div>
<div class="line">  [&amp;](<span class="keyword">const</span> decltype(dof_handler.<a class="code" href="classDoFHandler.html#a52af463de3283318bd4c651df7d35d24">begin_mg</a>()) &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>,</div>
<div class="line">      <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a> &amp;                      scratch_data,</div>
<div class="line">      <a class="code" href="structCopyData.html">CopyData</a> &amp;                              copy_data) {</div>
<div class="line">    this-&gt;assemble_cell(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, scratch_data, copy_data);</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> copier_mg = [&amp;](<span class="keyword">const</span> <a class="code" href="structCopyData.html">CopyData</a> &amp;copy_data) {</div>
<div class="line">  boundary_constraints[copy_data.level].distribute_local_to_global(</div>
<div class="line">    copy_data.cell_matrix,</div>
<div class="line">    copy_data.local_dof_indices,</div>
<div class="line">    mg_matrices[copy_data.level]);</div>
</div><!-- fragment --><p>If \((i,j)\) is an <code>interface_out</code> dof pair, then \((j,i)\) is an <code>interface_in</code> dof pair. Note: For <code>interface_in</code>, we load the transpose of the interface entries, i.e., the entry for dof pair \((j,i)\) is stored in <code>interface_in(i,j)</code>. This is an optimization for the symmetric case which allows only one matrix to be used when setting the edge_matrices in <a class="el" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve()</a>. Here, however, since our problem is non-symmetric, we must store both <code>interface_in</code> and <code>interface_out</code> matrices.</p>
<div class="fragment"><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; copy_data.dofs_per_cell; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> = 0; <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> &lt; copy_data.dofs_per_cell; ++<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>)</div>
<div class="line">        <span class="keywordflow">if</span> (mg_constrained_dofs.is_interface_matrix_entry(</div>
<div class="line">              copy_data.level,</div>
<div class="line">              copy_data.local_dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>],</div>
<div class="line">              copy_data.local_dof_indices[<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>]))</div>
<div class="line">          {</div>
<div class="line">            mg_interface_out[copy_data.level].add(</div>
<div class="line">              copy_data.local_dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>],</div>
<div class="line">              copy_data.local_dof_indices[<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>],</div>
<div class="line">              copy_data.cell_matrix(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>));</div>
<div class="line">            mg_interface_in[copy_data.level].add(</div>
<div class="line">              copy_data.local_dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>],</div>
<div class="line">              copy_data.local_dof_indices[<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>],</div>
<div class="line">              copy_data.cell_matrix(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>));</div>
<div class="line">          }</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop</a>(dof_handler.<a class="code" href="classDoFHandler.html#a52af463de3283318bd4c651df7d35d24">begin_mg</a>(),</div>
<div class="line">                        dof_handler.<a class="code" href="classDoFHandler.html#aaa2300cc9a5f93532400af2752d948f6">end_mg</a>(),</div>
<div class="line">                        cell_worker_mg,</div>
<div class="line">                        copier_mg,</div>
<div class="line">                        <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>, <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1),</div>
<div class="line">                        <a class="code" href="structCopyData.html">CopyData</a>(),</div>
<div class="line">                        <a class="code" href="namespaceMeshWorker.html#ac7a9db8b34d398d7d398d1e8809874aaacb8627085561cee8b7af9d74320696eb">MeshWorker::assemble_own_cells</a>);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeAdvectionProblemsetup_smoothercode"></a> </p><h4><code>AdvectionProblem::setup_smoother()</code></h4>
<p>Next, we set up the smoother based on the settings in the <code>.prm</code> file. The two options that are of significance is the number of pre- and post-smoothing steps on each level of the multigrid v-cycle and the relaxation parameter.</p>
<p>Since multiplicative methods tend to be more powerful than additive method, fewer smoothing steps are required to see convergence independent of mesh size. The same holds for block smoothers over point smoothers. This is reflected in the choice for the number of smoothing steps for each type of smoother below.</p>
<p>The relaxation parameter for point smoothers is chosen based on trial and error, and reflects values necessary to keep the iteration counts in the GMRES solve constant (or as close as possible) as we refine the mesh. The two values given for both "Jacobi" and "SOR" in the <code>.prm</code> files are for degree 1 and degree 3 finite elements. If the user wants to change to another degree, they may need to adjust these numbers. For block smoothers, this parameter has a more straightforward interpretation, namely that for additive methods in 2D, a DoF can have a repeated contribution from up to 4 cells, therefore we must relax these methods by 0.25 to compensate. This is not an issue for multiplicative methods as each cell's inverse application carries new information to all its DoFs.</p>
<p>Finally, as mentioned above, the point smoothers only operate on DoFs, and the block smoothers on cells, so only the block smoothers need to be given information regarding cell orderings. DoF ordering for point smoothers has already been taken care of in <code>setup_system()</code>.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::setup_smoother()</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;SOR&quot;</span>)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">using</span> Smoother = <a class="code" href="classPreconditionSOR.html">PreconditionSOR&lt;SparseMatrix&lt;double&gt;</a>&gt;;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">auto</span> smoother =</div>
<div class="line">        std::make_unique&lt;MGSmootherPrecondition&lt;SparseMatrix&lt;double&gt;,</div>
<div class="line">                                                Smoother,</div>
<div class="line">                                                <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;&gt;();</div>
<div class="line">      smoother-&gt;<a class="code" href="classMGSmootherPrecondition.html#a3cb789b815bf6719eee79e2137c9bd84">initialize</a>(mg_matrices,</div>
<div class="line">                           <a class="code" href="relaxation__block__0_8txt.html#a2076fd56276055e74e230fad6edac013">Smoother::AdditionalData</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> == 1 ? 1.0 :</div>
<div class="line">                                                                     0.62));</div>
<div class="line">      smoother-&gt;<a class="code" href="classMGSmoother.html#a9976182b6b272aac7800a8fbf18c8ab9">set_steps</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoothing_steps);</div>
<div class="line">      mg_smoother = std::move(smoother);</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;Jacobi&quot;</span>)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">using</span> Smoother = <a class="code" href="classPreconditionJacobi.html">PreconditionJacobi&lt;SparseMatrix&lt;double&gt;</a>&gt;;</div>
<div class="line">      <span class="keyword">auto</span> smoother =</div>
<div class="line">        std::make_unique&lt;MGSmootherPrecondition&lt;SparseMatrix&lt;double&gt;,</div>
<div class="line">                                                Smoother,</div>
<div class="line">                                                <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;&gt;();</div>
<div class="line">      smoother-&gt;<a class="code" href="classMGSmootherPrecondition.html#a3cb789b815bf6719eee79e2137c9bd84">initialize</a>(mg_matrices,</div>
<div class="line">                           <a class="code" href="relaxation__block__0_8txt.html#a2076fd56276055e74e230fad6edac013">Smoother::AdditionalData</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> == 1 ? 0.6667 :</div>
<div class="line">                                                                     0.47));</div>
<div class="line">      smoother-&gt;<a class="code" href="classMGSmoother.html#a9976182b6b272aac7800a8fbf18c8ab9">set_steps</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoothing_steps);</div>
<div class="line">      mg_smoother = std::move(smoother);</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;block SOR&quot;</span> ||</div>
<div class="line">           <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;block Jacobi&quot;</span>)</div>
<div class="line">    {</div>
<div class="line">      smoother_data.<a class="code" href="classMGLevelObject.html#a16213121f9153bd08f49652a11886259">resize</a>(0, <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_levels() - 1);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_levels(); ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">        {</div>
<div class="line">          <a class="code" href="namespaceDoFTools.html#a43ee44769769065bc594d1730477a4b9">DoFTools::make_cell_patches</a>(smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].block_list,</div>
<div class="line">                                      dof_handler,</div>
<div class="line">                                      <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line"> </div>
<div class="line">          smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].relaxation =</div>
<div class="line">            (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;block SOR&quot;</span> ? 1.0 : 0.25);</div>
<div class="line">          smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].inversion = <a class="code" href="classPreconditionBlockBase.html">PreconditionBlockBase&lt;double&gt;::svd</a>;</div>
<div class="line"> </div>
<div class="line">          std::vector&lt;unsigned int&gt; ordered_indices;</div>
<div class="line">          <span class="keywordflow">switch</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.dof_renumbering)</div>
<div class="line">            {</div>
<div class="line">              <span class="keywordflow">case</span> <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">Settings::DoFRenumberingStrategy::downstream</a>:</div>
<div class="line">                ordered_indices =</div>
<div class="line">                  <a class="code" href="namespaceStep63.html#a679f6c35915713a90230f261b38f041e">create_downstream_cell_ordering</a>(dof_handler,</div>
<div class="line">                                                  advection_direction,</div>
<div class="line">                                                  <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">              <span class="keywordflow">case</span> Settings::DoFRenumberingStrategy::upstream:</div>
<div class="line">                ordered_indices =</div>
<div class="line">                  <a class="code" href="namespaceStep63.html#a679f6c35915713a90230f261b38f041e">create_downstream_cell_ordering</a>(dof_handler,</div>
<div class="line">                                                  -1.0 * advection_direction,</div>
<div class="line">                                                  <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">              <span class="keywordflow">case</span> <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">Settings::DoFRenumberingStrategy::random</a>:</div>
<div class="line">                ordered_indices =</div>
<div class="line">                  <a class="code" href="namespaceStep63.html#a5bcdd1e04c358777541a2922f8803db4">create_random_cell_ordering</a>(dof_handler, <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">              <span class="keywordflow">case</span> <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1acc6b05c836e9f74fb7ab9390ffc26f1c">Settings::DoFRenumberingStrategy::none</a>:</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">              <span class="keywordflow">default</span>:</div>
<div class="line">                <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">          smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].order =</div>
<div class="line">            std::vector&lt;std::vector&lt;unsigned int&gt;&gt;(1, ordered_indices);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;block SOR&quot;</span>)</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">auto</span> smoother = std::make_unique&lt;<a class="code" href="classMGSmootherPrecondition.html">MGSmootherPrecondition</a>&lt;</div>
<div class="line">            <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a>,</div>
<div class="line">            <a class="code" href="classRelaxationBlockSOR.html">RelaxationBlockSOR&lt;SparseMatrix&lt;double&gt;</a>, <a class="code" href="hdf5__0_8txt.html#aae153b86de45d3354cd3edd5b992435e">double</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;,</div>
<div class="line">            <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;&gt;();</div>
<div class="line">          smoother-&gt;<a class="code" href="classMGSmootherPrecondition.html#a3cb789b815bf6719eee79e2137c9bd84">initialize</a>(mg_matrices, smoother_data);</div>
<div class="line">          smoother-&gt;<a class="code" href="classMGSmoother.html#a9976182b6b272aac7800a8fbf18c8ab9">set_steps</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoothing_steps);</div>
<div class="line">          mg_smoother = std::move(smoother);</div>
<div class="line">        }</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;block Jacobi&quot;</span>)</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">auto</span> smoother = std::make_unique&lt;</div>
<div class="line">            <a class="code" href="classMGSmootherPrecondition.html">MGSmootherPrecondition&lt;SparseMatrix&lt;double&gt;</a>,</div>
<div class="line">                                   <a class="code" href="classRelaxationBlockJacobi.html">RelaxationBlockJacobi&lt;SparseMatrix&lt;double&gt;</a>,</div>
<div class="line">                                                         <a class="code" href="hdf5__0_8txt.html#aae153b86de45d3354cd3edd5b992435e">double</a>,</div>
<div class="line">                                                         <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;,</div>
<div class="line">                                   <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;&gt;();</div>
<div class="line">          smoother-&gt;<a class="code" href="classMGSmootherPrecondition.html#a3cb789b815bf6719eee79e2137c9bd84">initialize</a>(mg_matrices, smoother_data);</div>
<div class="line">          smoother-&gt;<a class="code" href="classMGSmoother.html#a9976182b6b272aac7800a8fbf18c8ab9">set_steps</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoothing_steps);</div>
<div class="line">          mg_smoother = std::move(smoother);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeAdvectionProblemsolvecode"></a> </p><h4><code>AdvectionProblem::solve()</code></h4>
<p>Before we can solve the system, we must first set up the multigrid preconditioner. This requires the setup of the transfer between levels, the coarse matrix solver, and the smoother. This setup follows almost identically to <a class="el" href="step_16.html">step-16</a>, the main difference being the various smoothers defined above and the fact that we need different interface edge matrices for in and out since our problem is non-symmetric. (In reality, for this tutorial these interface matrices are empty since we are only using global refinement, and thus have no refinement edges. However, we have still included both here since if one made the simple switch to an adaptively refined method, the program would still run correctly.)</p>
<p>The last thing to note is that since our problem is non-symmetric, we must use an appropriate Krylov subspace method. We choose here to use GMRES since it offers the guarantee of residual reduction in each iteration. The major disavantage of GMRES is that, for each iteration, the number of stored temporary vectors increases by one, and one also needs to compute a scalar product with all previously stored vectors. This is rather expensive. This requirement is relaxed by using the restarted GMRES method which puts a cap on the number of vectors we are required to store at any one time (here we restart after 50 temporary vectors, or 48 iterations). This then has the disadvantage that we lose information we have gathered throughout the iteration and therefore we could see slower convergence. As a consequence, where to restart is a question of balancing memory consumption, CPU effort, and convergence speed. However, the goal of this tutorial is to have very low iteration counts by using a powerful GMG preconditioner, so we have picked the restart length such that all of the results shown below converge prior to restart happening, and thus we have a standard GMRES method. If the user is interested, another suitable method offered in deal.II would be BiCGStab.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">AdvectionProblem&lt;dim&gt;::solve</a>()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_iters       = 200;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span>       solve_tolerance = 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-8 * system_rhs.l2_norm();</div>
<div class="line">  <a class="code" href="classSolverControl.html">SolverControl</a>      solver_control(max_iters, solve_tolerance, <span class="keyword">true</span>, <span class="keyword">true</span>);</div>
<div class="line">  solver_control.<a class="code" href="classSolverControl.html#a6d99741765243ccb65da4ff66558cf41">enable_history_data</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using</span> Transfer = <a class="code" href="classMGTransferPrebuilt.html">MGTransferPrebuilt&lt;Vector&lt;double&gt;</a>&gt;;</div>
<div class="line">  Transfer mg_transfer(mg_constrained_dofs);</div>
<div class="line">  mg_transfer.<a class="code" href="classMGTransferMatrixFree.html#a8f214ffade006cfa85e902a94902fc7b">build</a>(dof_handler);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> coarse_matrix;</div>
<div class="line">  coarse_matrix.<a class="code" href="classFullMatrix.html#ae9e8fbf00e15c7b66d527a5de4b31404">copy_from</a>(mg_matrices[0]);</div>
<div class="line">  <a class="code" href="classMGCoarseGridHouseholder.html">MGCoarseGridHouseholder&lt;double, Vector&lt;double&gt;</a>&gt; coarse_grid_solver;</div>
<div class="line">  coarse_grid_solver.<a class="code" href="classMGCoarseGridHouseholder.html#a07bd76dc7f6f66cb22d3e7951a558f50">initialize</a>(coarse_matrix);</div>
<div class="line"> </div>
<div class="line">  setup_smoother();</div>
<div class="line"> </div>
<div class="line">  mg_matrix.initialize(mg_matrices);</div>
<div class="line">  mg_interface_matrix_in.initialize(mg_interface_in);</div>
<div class="line">  mg_interface_matrix_out.initialize(mg_interface_out);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classMultigrid.html">Multigrid&lt;Vector&lt;double&gt;</a>&gt; <a class="code" href="namespacemg.html">mg</a>(</div>
<div class="line">    mg_matrix, coarse_grid_solver, mg_transfer, *mg_smoother, *mg_smoother);</div>
<div class="line">  <a class="code" href="namespacemg.html">mg</a>.set_edge_matrices(mg_interface_matrix_out, mg_interface_matrix_in);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classPreconditionMG.html">PreconditionMG&lt;dim, Vector&lt;double&gt;</a>, Transfer&gt; <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>(dof_handler,</div>
<div class="line">                                                               <a class="code" href="namespacemg.html">mg</a>,</div>
<div class="line">                                                               mg_transfer);</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;     Solving with GMRES to tol &quot;</span> &lt;&lt; solve_tolerance &lt;&lt; <span class="stringliteral">&quot;...&quot;</span></div>
<div class="line">            &lt;&lt; std::endl;</div>
<div class="line">  <a class="code" href="classSolverGMRES.html">SolverGMRES&lt;Vector&lt;double&gt;</a>&gt; <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>(</div>
<div class="line">    solver_control, <a class="code" href="classSolverGMRES.html">SolverGMRES</a>&lt;<a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;::<a class="code" href="relaxation__block__0_8txt.html#a2076fd56276055e74e230fad6edac013">AdditionalData</a>(50, <span class="keyword">true</span>));</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTimer.html">Timer</a> <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a>;</div>
<div class="line">  <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a>.start();</div>
<div class="line">  <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.solve(system_matrix, <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, system_rhs, <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>);</div>
<div class="line">  <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a>.stop();</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;          converged in &quot;</span> &lt;&lt; solver_control.<a class="code" href="classSolverControl.html#a42aeae81cd6b67ce93b5fbea3328371f">last_step</a>()</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot; iterations&quot;</span></div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot; in &quot;</span> &lt;&lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a>.last_wall_time() &lt;&lt; <span class="stringliteral">&quot; seconds &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">distribute</a>(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line">  mg_smoother.release();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeAdvectionProblemoutput_resultscode"></a> </p><h4><code>AdvectionProblem::output_results()</code></h4>
<p>The final function of interest generates graphical output. Here we output the solution and cell ordering in a .vtu format.</p>
<p>At the top of the function, we generate an index for each cell to visualize the ordering used by the smoothers. Note that we do this only for the active cells instead of the levels, where the smoothers are actually used. For the point smoothers we renumber DoFs instead of cells, so this is only an approximation of what happens in reality. Finally, the random ordering is not the random ordering we actually use (see <code>create_smoother()</code> for that).</p>
<p>The (integer) ordering of cells is then copied into a (floating point) vector for graphical output.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a> = <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells();</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a>     cell_indices(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>);</div>
<div class="line">  {</div>
<div class="line">    std::vector&lt;unsigned int&gt; ordered_indices;</div>
<div class="line">    <span class="keywordflow">switch</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.dof_renumbering)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">Settings::DoFRenumberingStrategy::downstream</a>:</div>
<div class="line">          ordered_indices =</div>
<div class="line">            <a class="code" href="namespaceStep63.html#a679f6c35915713a90230f261b38f041e">create_downstream_cell_ordering</a>(dof_handler, advection_direction);</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> Settings::DoFRenumberingStrategy::upstream:</div>
<div class="line">          ordered_indices =</div>
<div class="line">            <a class="code" href="namespaceStep63.html#a679f6c35915713a90230f261b38f041e">create_downstream_cell_ordering</a>(dof_handler,</div>
<div class="line">                                            -1.0 * advection_direction);</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">Settings::DoFRenumberingStrategy::random</a>:</div>
<div class="line">          ordered_indices = <a class="code" href="namespaceStep63.html#a5bcdd1e04c358777541a2922f8803db4">create_random_cell_ordering</a>(dof_handler);</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1acc6b05c836e9f74fb7ab9390ffc26f1c">Settings::DoFRenumberingStrategy::none</a>:</div>
<div class="line">          ordered_indices.resize(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>);</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">            ordered_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] = <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>;</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">          <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">      cell_indices(ordered_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>);</div>
<div class="line">  }</div>
</div><!-- fragment --><p>The remainder of the function is then straightforward, given previous tutorial programs:</p>
<div class="fragment"><div class="line">  <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">attach_dof_handler</a>(dof_handler);</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, <span class="stringliteral">&quot;solution&quot;</span>);</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(cell_indices, <span class="stringliteral">&quot;cell_index&quot;</span>);</div>
<div class="line">  data_out.<a class="code" href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">build_patches</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> std::string filename =</div>
<div class="line">    <span class="stringliteral">&quot;solution-&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>) + <span class="stringliteral">&quot;.vtu&quot;</span>;</div>
<div class="line">  std::ofstream <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>(filename.c_str());</div>
<div class="line">  data_out.<a class="code" href="classDataOutInterface.html#a93c780f93105e0daaa76c6c43694b4ae">write_vtu</a>(<a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeAdvectionProblemruncode"></a> </p><h4><code>AdvectionProblem::run()</code></h4>
<p>As in most tutorials, this function creates/refines the mesh and calls the various functions defined above to set up, assemble, solve, and output the results.</p>
<p>In cycle zero, we generate the mesh for the on the square <code>[-1,1]^dim</code> with a hole of radius 3/10 units centered at the origin. For objects with <code>manifold_id</code> equal to one (namely, the faces adjacent to the hole), we assign a spherical manifold.</p>
<div class="fragment"><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">AdvectionProblem&lt;dim&gt;::run</a>()</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> = 0; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt; (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.fe_degree == 1 ? 7 : 5);</div>
<div class="line">         ++<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>)</div>
<div class="line">      {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;  Cycle &quot;</span> &lt;&lt; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> == 0)</div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="namespaceGridGenerator.html#add14cab546d033c1eaacc9234c64ebcd">GridGenerator::hyper_cube_with_cylindrical_hole</a>(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>,</div>
<div class="line">                                                            0.3,</div>
<div class="line">                                                            1.0);</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classSphericalManifold.html">SphericalManifold&lt;dim&gt;</a> manifold_description(<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>(0, 0));</div>
<div class="line">            <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.set_manifold(1, manifold_description);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.refine_global();</div>
<div class="line"> </div>
<div class="line">        setup_system();</div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;     Number of active cells:       &quot;</span></div>
<div class="line">                  &lt;&lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells() &lt;&lt; <span class="stringliteral">&quot; (&quot;</span></div>
<div class="line">                  &lt;&lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_levels() &lt;&lt; <span class="stringliteral">&quot; levels)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;     Number of degrees of freedom: &quot;</span></div>
<div class="line">                  &lt;&lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>() &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        assemble_system_and_multigrid();</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.output)</div>
<div class="line">          output_results(<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>);</div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; std::endl;</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Step63</span></div>
</div><!-- fragment --><p><a class="anchor" id="Thecodemaincodefunction"></a> </p><h3>The <code>main</code> function</h3>
<p>Finally, the main function is like most tutorials. The only interesting bit is that we require the user to pass a <code>.prm</code> file as a sole command line argument. If no parameter file is given, the program will output the contents of a sample parameter file with all default values to the screen that the user can then copy and paste into their own <code>.prm</code> file.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="structStep63_1_1Settings.html">Step63::Settings</a> <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>;</div>
<div class="line">      <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.get_parameters((argc &gt; 1) ? (argv[1]) : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classStep63_1_1AdvectionProblem.html">Step63::AdvectionProblem&lt;2&gt;</a> advection_problem_2d(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>);</div>
<div class="line">      advection_problem_2d.run();</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (<a class="code" href="parameter__handler__0_8txt.html#ad919e2b915d8e8226aef004c2d8399a8">std::exception</a> &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p> <a class="anchor" id="Results"></a></p><h1>Results</h1>
<p><a class="anchor" id="GMRESIterationNumbers"></a></p><h3>GMRES Iteration Numbers </h3>
<p>The major advantage for GMG is that it is an \(\mathcal{O}(n)\) method, that is, the complexity of the problem increases linearly with the problem size. To show then that the linear solver presented in this tutorial is in fact \(\mathcal{O}(n)\), all one needs to do is show that the iteration counts for the GMRES solve stay roughly constant as we refine the mesh.</p>
<p>Each of the following tables gives the GMRES iteration counts to reduce the initial residual by a factor of \(10^8\). We selected a sufficient number of smoothing steps (based on the method) to get iteration numbers independent of mesh size. As can be seen from the tables below, the method is indeed \(\mathcal{O}(n)\).</p>
<p><a class="anchor" id="DoFCellRenumbering"></a></p><h4>DoF/Cell Renumbering </h4>
<p>The point-wise smoothers ("Jacobi" and "SOR") get applied in the order the DoFs are numbered on each level. We can influence this using the <a class="el" href="namespaceDoFRenumbering.html">DoFRenumbering</a> namespace. The block smoothers are applied based on the ordering we set in <code>setup_smoother()</code>. We can visualize this numbering. The following pictures show the cell numbering of the active cells in downstream, random, and upstream numbering (left to right):</p>
<p><img src="https://www.dealii.org/images/steps/developer/step-63-cell-order.png" alt="" class="inline"/></p>
<p>Let us start with the additive smoothers. The following table shows the number of iterations necessary to obtain convergence from GMRES:</p>
<table align="center" class="doxtable">
<tr>
<th></th><th></th><th colspan="1">\(Q_1\) </th><th colspan="7">Smoother (smoothing steps)  </th></tr>
<tr>
<th></th><th></th><th></th><th colspan="3">Jacobi (6) </th><th></th><th colspan="3">Block Jacobi (3)  </th></tr>
<tr>
<th></th><th></th><th></th><th colspan="3">Renumbering Strategy </th><th></th><th colspan="3">Renumbering Strategy  </th></tr>
<tr>
<th>Cells </th><th></th><th>DoFs </th><th>Downstream </th><th>Random </th><th>Upstream </th><th></th><th>Downstream </th><th>Random </th><th>Upstream  </th></tr>
<tr>
<th>32 </th><th></th><th>48 </th><td>3 </td><td>3 </td><td>3 </td><th></th><td>3 </td><td>3 </td><td>3  </td></tr>
<tr>
<th>128 </th><th></th><th>160 </th><td>6 </td><td>6 </td><td>6 </td><th></th><td>6 </td><td>6 </td><td>6  </td></tr>
<tr>
<th>512 </th><th></th><th>576 </th><td>11 </td><td>11 </td><td>11 </td><th></th><td>9 </td><td>9 </td><td>9  </td></tr>
<tr>
<th>2048 </th><th></th><th>2176 </th><td>15 </td><td>15 </td><td>15 </td><th></th><td>13 </td><td>13 </td><td>13  </td></tr>
<tr>
<th>8192 </th><th></th><th>8448 </th><td>18 </td><td>18 </td><td>18 </td><th></th><td>15 </td><td>15 </td><td>15  </td></tr>
<tr>
<th>32768 </th><th></th><th>33280 </th><td>20 </td><td>20 </td><td>20 </td><th></th><td>16 </td><td>16 </td><td>16  </td></tr>
<tr>
<th>131072 </th><th></th><th>132096 </th><td>20 </td><td>20 </td><td>20 </td><th></th><td>16 </td><td>16 </td><td>16  </td></tr>
</table>
<p>We see that renumbering the DoFs/cells has no effect on convergence speed. This is because these smoothers compute operations on each DoF (point-smoother) or cell (block-smoother) independently and add up the results. Since we can define these smoothers as an application of a sum of matrices, and matrix addition is commutative, the order at which we sum the different components will not affect the end result.</p>
<p>On the other hand, the situation is different for multiplicative smoothers:</p>
<table align="center" class="doxtable">
<tr>
<th></th><th></th><th colspan="1">\(Q_1\) </th><th colspan="7">Smoother (smoothing steps)  </th></tr>
<tr>
<th></th><th></th><th></th><th colspan="3">SOR (3) </th><th></th><th colspan="3">Block SOR (1)  </th></tr>
<tr>
<th></th><th></th><th></th><th colspan="3">Renumbering Strategy </th><th></th><th colspan="3">Renumbering Strategy  </th></tr>
<tr>
<th>Cells </th><th></th><th>DoFs </th><th>Downstream </th><th>Random </th><th>Upstream </th><th></th><th>Downstream </th><th>Random </th><th>Upstream  </th></tr>
<tr>
<th>32 </th><th></th><th>48 </th><td>2 </td><td>2 </td><td>3 </td><th></th><td>2 </td><td>2 </td><td>3  </td></tr>
<tr>
<th>128 </th><th></th><th>160 </th><td>5 </td><td>5 </td><td>7 </td><th></th><td>5 </td><td>5 </td><td>7  </td></tr>
<tr>
<th>512 </th><th></th><th>576 </th><td>7 </td><td>9 </td><td>11 </td><th></th><td>7 </td><td>7 </td><td>12  </td></tr>
<tr>
<th>2048 </th><th></th><th>2176 </th><td>10 </td><td>12 </td><td>15 </td><th></th><td>8 </td><td>10 </td><td>17  </td></tr>
<tr>
<th>8192 </th><th></th><th>8448 </th><td>11 </td><td>15 </td><td>19 </td><th></th><td>10 </td><td>11 </td><td>20  </td></tr>
<tr>
<th>32768 </th><th></th><th>33280 </th><td>12 </td><td>16 </td><td>20 </td><th></th><td>10 </td><td>12 </td><td>21  </td></tr>
<tr>
<th>131072 </th><th></th><th>132096 </th><td>12 </td><td>16 </td><td>19 </td><th></th><td>11 </td><td>12 </td><td>21  </td></tr>
</table>
<p>Here, we can speed up convergence by renumbering the DoFs/cells in the advection direction, and similarly, we can slow down convergence if we do the renumbering in the opposite direction. This is because advection-dominated problems have a directional flow of information (in the advection direction) which, given the right renumbering of DoFs/cells, multiplicative methods are able to capture.</p>
<p>This feature of multiplicative methods is, however, dependent on the value of \(\varepsilon\). As we increase \(\varepsilon\) and the problem becomes more diffusion-dominated, we have a more uniform propagation of information over the mesh and there is a diminished advantage for renumbering in the advection direction. On the opposite end, in the extreme case of \(\varepsilon=0\) (advection-only), we have a 1st-order PDE and multiplicative methods with the right renumbering become effective solvers: A correct downstream numbering may lead to methods that require only a single iteration because information can be propagated from the inflow boundary downstream, with no information transport in the opposite direction. (Note, however, that in the case of \(\varepsilon=0\), special care must be taken for the boundary conditions in this case).</p>
<p><a class="anchor" id="Pointvsblocksmoothers"></a></p><h4>Point vs. block smoothers </h4>
<p>We will limit the results to runs using the downstream renumbering. Here is a cross comparison of all four smoothers for both \(Q_1\) and \(Q_3\) elements:</p>
<table align="center" class="doxtable">
<tr>
<th></th><td></td><th colspan="1">\(Q_1\) </th><th colspan="4">Smoother (smoothing steps) </th><th></th><th colspan="1">\(Q_3\) </th><th colspan="4">Smoother (smoothing steps)  </th></tr>
<tr>
<th colspan="1">Cells </th><td></td><th colspan="1">DoFs </th><th colspan="1">Jacobi (6) </th><th colspan="1">Block Jacobi (3) </th><th colspan="1">SOR (3) </th><th colspan="1">Block SOR (1) </th><th></th><th colspan="1">DoFs </th><th colspan="1">Jacobi (6) </th><th colspan="1">Block Jacobi (3) </th><th colspan="1">SOR (3) </th><th colspan="1">Block SOR (1)  </th></tr>
<tr>
<th>32 </th><td></td><th>48 </th><td>3 </td><td>3 </td><td>2 </td><td>2 </td><td></td><th>336 </th><td>15 </td><td>14 </td><td>15 </td><td>6  </td></tr>
<tr>
<th>128 </th><td></td><th>160 </th><td>6 </td><td>6 </td><td>5 </td><td>5 </td><td></td><th>1248 </th><td>23 </td><td>18 </td><td>21 </td><td>9  </td></tr>
<tr>
<th>512 </th><td></td><th>576 </th><td>11 </td><td>9 </td><td>7 </td><td>7 </td><td></td><th>4800 </th><td>29 </td><td>21 </td><td>28 </td><td>9  </td></tr>
<tr>
<th>2048 </th><td></td><th>2176 </th><td>15 </td><td>13 </td><td>10 </td><td>8 </td><td></td><th>18816 </th><td>33 </td><td>22 </td><td>32 </td><td>9  </td></tr>
<tr>
<th>8192 </th><td></td><th>8448 </th><td>18 </td><td>15 </td><td>11 </td><td>10 </td><td></td><th>74496 </th><td>35 </td><td>22 </td><td>34 </td><td>10  </td></tr>
<tr>
<th>32768 </th><td></td><th>33280 </th><td>20 </td><td>16 </td><td>12 </td><td>10 </td><td></td></tr>
<tr>
<th>131072 </th><td></td><th>132096 </th><td>20 </td><td>16 </td><td>12 </td><td>11 </td><td></td></tr>
</table>
<p>We see that for \(Q_1\), both multiplicative smoothers require a smaller combination of smoothing steps and iteration counts than either additive smoother. However, when we increase the degree to a \(Q_3\) element, there is a clear advantage for the block smoothers in terms of the number of smoothing steps and iterations required to solve. Specifically, the block SOR smoother gives constant iteration counts over the degree, and the block Jacobi smoother only sees about a 38% increase in iterations compared to 75% and 183% for Jacobi and SOR respectively.</p>
<p><a class="anchor" id="Cost"></a></p><h3>Cost </h3>
<p>Iteration counts do not tell the full story in the optimality of a one smoother over another. Obviously we must examine the cost of an iteration. Block smoothers here are at a disadvantage as they are having to construct and invert a cell matrix for each cell. Here is a comparison of solve times for a \(Q_3\) element with 74,496 DoFs:</p>
<table align="center" class="doxtable">
<tr>
<th colspan="1">\(Q_3\) </th><th colspan="4">Smoother (smoothing steps)  </th></tr>
<tr>
<th colspan="1">DoFs </th><th colspan="1">Jacobi (6) </th><th colspan="1">Block Jacobi (3) </th><th colspan="1">SOR (3) </th><th colspan="1">Block SOR (1)  </th></tr>
<tr>
<th>74496 </th><td>0.68s </td><td>5.82s </td><td>1.18s </td><td>1.02s  </td></tr>
</table>
<p>The smoother that requires the most iterations (Jacobi) actually takes the shortest time (roughly 2/3 the time of the next fastest method). This is because all that is required to apply a Jacobi smoothing step is multiplication by a diagonal matrix which is very cheap. On the other hand, while SOR requires over 3x more iterations (each with 3x more smoothing steps) than block SOR, the times are roughly equivalent, implying that a smoothing step of block SOR is roughly 9x slower than a smoothing step of SOR. Lastly, block Jacobi is almost 6x more expensive than block SOR, which intuitively makes sense from the fact that 1 step of each method has the same cost (inverting the cell matrices and either adding or multiply them together), and block Jacobi has 3 times the number of smoothing steps per iteration with 2 times the iterations.</p>
<p><a class="anchor" id="Additionalpoints"></a></p><h3>Additional points </h3>
<p>There are a few more important points to mention:</p>
<ol>
<li>
<p class="startli">For a mesh distributed in parallel, multiplicative methods cannot be executed over the entire domain. This is because they operate one cell at a time, and downstream cells can only be handled once upstream cells have already been done. This is fine on a single processor: The processor just goes through the list of cells one after the other. However, in parallel, it would imply that some processors are idle because upstream processors have not finished doing the work on cells upstream from the ones owned by the current processor. Once the upstream processors are done, the downstream ones can start, but by that time the upstream processors have no work left. In other words, most of the time during these smoother steps, most processors are in fact idle. This is not how one obtains good parallel scalability!</p>
<p class="interli">One can use a hybrid method where a multiplicative smoother is applied on each subdomain, but as you increase the number of subdomains, the method approaches the behavior of an additive method. This is a major disadvantage to these methods. </p>
<p class="endli"></p>
</li>
<li>
Current research into block smoothers suggest that soon we will be able to compute the inverse of the cell matrices much cheaper than what is currently being done inside deal.II. This research is based on the fast diagonalization method (dating back to the 1960s) and has been used in the spectral community for around 20 years (see, e.g., <a href="https://doi.org/10.1007/s10915-004-4787-3">Hybrid Multigrid/Schwarz Algorithms for the Spectral Element Method by Lottes and Fischer</a>). There are currently efforts to generalize these methods to DG and make them more robust. Also, it seems that one should be able to take advantage of matrix-free implementations and the fact that, in the interior of the domain, cell matrices tend to look very similar, allowing fewer matrix inverse computations.  </li>
</ol>
<p>Combining 1. and 2. gives a good reason for expecting that a method like block Jacobi could become very powerful in the future, even though currently for these examples it is quite slow.</p>
<p><a class="anchor" id="Possibilitiesforextensions"></a></p><h3>Possibilities for extensions </h3>
<p><a class="anchor" id="ConstantiterationsforQsub5sub"></a></p><h4>Constant iterations for Q<sub>5</sub> </h4>
<p>Change the number of smoothing steps and the smoother relaxation parameter (set in <code>Smoother::AdditionalData()</code> inside <code>create_smoother()</code>, only necessary for point smoothers) so that we maintain a constant number of iterations for a \(Q_5\) element.</p>
<p><a class="anchor" id="Effectivenessofrenumberingforchangingepsilon"></a></p><h4>Effectiveness of renumbering for changing epsilon </h4>
<p>Increase/decrease the parameter "Epsilon" in the <code>.prm</code> files of the multiplicative methods and observe for which values renumbering no longer influences convergence speed.</p>
<p><a class="anchor" id="Meshadaptivity"></a></p><h4>Mesh adaptivity </h4>
<p>The code is set up to work correctly with an adaptively refined mesh (the interface matrices are created and set). Devise a suitable refinement criterium or try the <a class="el" href="classKellyErrorEstimator.html">KellyErrorEstimator</a> class.</p>
<p><a class="anchor" id="PlainProg"></a> </p><h1>The plain program</h1>
<div class="fragment"><div class="line"><span class="comment">/* ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2018 - 2021 by the deal.II authors</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file is part of the deal.II library.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The deal.II library is free software; you can use it, redistribute</span></div>
<div class="line"><span class="comment"> * it, and/or modify it under the terms of the GNU Lesser General</span></div>
<div class="line"><span class="comment"> * Public License as published by the Free Software Foundation; either</span></div>
<div class="line"><span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><span class="comment"> * The full text of the license can be found in the file LICENSE.md at</span></div>
<div class="line"><span class="comment"> * the top level directory of deal.II.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Authors: Thomas C. Clevenger, Clemson University</span></div>
<div class="line"><span class="comment"> *          Timo Heister, Clemson University and University of Utah</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2tensor__function_8h.html">deal.II/base/tensor_function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2timer_8h.html">deal.II/base/timer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2parameter__handler_8h.html">deal.II/base/parameter_handler.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2vector_8h.html">deal.II/lac/vector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2full__matrix_8h.html">deal.II/lac/full_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2sparse__matrix_8h.html">deal.II/lac/sparse_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2solver__gmres_8h.html">deal.II/lac/solver_gmres.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2precondition_8h.html">deal.II/lac/precondition.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2relaxation__block_8h.html">deal.II/lac/relaxation_block.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__refinement_8h.html">deal.II/grid/grid_refinement.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2manifold__lib_8h.html">deal.II/grid/manifold_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__out_8h.html">deal.II/grid/grid_out.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__renumbering_8h.html">deal.II/dofs/dof_renumbering.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2mapping__q_8h.html">deal.II/fe/mapping_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__values_8h.html">deal.II/fe/fe_values.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2matrix__tools_8h.html">deal.II/numerics/matrix_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__constrained__dofs_8h.html">deal.II/multigrid/mg_constrained_dofs.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2multigrid_8h.html">deal.II/multigrid/multigrid.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__transfer_8h.html">deal.II/multigrid/mg_transfer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__tools_8h.html">deal.II/multigrid/mg_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__coarse_8h.html">deal.II/multigrid/mg_coarse.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__smoother_8h.html">deal.II/multigrid/mg_smoother.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__matrix_8h.html">deal.II/multigrid/mg_matrix.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;random&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="meshworker_2mesh__loop_8h.html">deal.II/meshworker/mesh_loop.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceStep63.html">Step63</a></div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">struct </span><a class="code" href="structScratchData.html">ScratchData</a></div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="work__stream__0_8txt.html#a8f80058531659e3e5ae0f7e91a963519">ScratchData</a>(<span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        quadrature_degree)</div>
<div class="line">      : fe_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                  <a class="code" href="classQGauss.html">QGauss</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;(quadrature_degree),</div>
<div class="line">                  <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa378cbcddbdf54fb3f9f0acf47b1c4719">update_hessians</a> |</div>
<div class="line">                    <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="work__stream__0_8txt.html#a8f80058531659e3e5ae0f7e91a963519">ScratchData</a>(<span class="keyword">const</span> <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a> &amp;scratch_data)</div>
<div class="line">      : fe_values(scratch_data.fe_values.get_fe(),</div>
<div class="line">                  scratch_data.fe_values.get_quadrature(),</div>
<div class="line">                  <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa378cbcddbdf54fb3f9f0acf47b1c4719">update_hessians</a> |</div>
<div class="line">                    <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">struct </span><a class="code" href="structCopyData.html">CopyData</a></div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="structCopyData.html">CopyData</a>() = <span class="keywordflow">default</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a>                   <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a>;</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a>                       cell_rhs;</div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; <a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">struct </span><a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a></div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">enum</span> DoFRenumberingStrategy</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1acc6b05c836e9f74fb7ab9390ffc26f1c">none</a>,</div>
<div class="line">      <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">downstream</a>,</div>
<div class="line">      upstream,</div>
<div class="line">      <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">random</a></div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> get_parameters(<span class="keyword">const</span> std::string &amp;prm_filename);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span>                 <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa6fff35c961658bfea21e8a3ae468cec">epsilon</a>;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>           <a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>;</div>
<div class="line">    std::string            smoother_type;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>           smoothing_steps;</div>
<div class="line">    DoFRenumberingStrategy dof_renumbering;</div>
<div class="line">    <span class="keywordtype">bool</span>                   with_streamline_diffusion;</div>
<div class="line">    <span class="keywordtype">bool</span>                   <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="structStep63_1_1Settings.html#ac81d04517ae8edec21f699e62fa47fd8">Settings::get_parameters</a>(<span class="keyword">const</span> std::string &amp;prm_filename)</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">/* First declare the parameters... */</span></div>
<div class="line">    <a class="code" href="classParameterHandler.html">ParameterHandler</a> prm;</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Epsilon&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;0.005&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0),</div>
<div class="line">                      <span class="stringliteral">&quot;Diffusion parameter&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Fe degree&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(1),</div>
<div class="line">                      <span class="stringliteral">&quot;Finite Element degree&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Smoother type&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;block SOR&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;SOR|Jacobi|block SOR|block Jacobi&quot;</span>),</div>
<div class="line">                      <span class="stringliteral">&quot;Select smoother: SOR|Jacobi|block SOR|block Jacobi&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Smoothing steps&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(1),</div>
<div class="line">                      <span class="stringliteral">&quot;Number of smoothing steps&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(</div>
<div class="line">      <span class="stringliteral">&quot;DoF renumbering&quot;</span>,</div>
<div class="line">      <span class="stringliteral">&quot;downstream&quot;</span>,</div>
<div class="line">      <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;none|downstream|upstream|random&quot;</span>),</div>
<div class="line">      <span class="stringliteral">&quot;Select DoF renumbering: none|downstream|upstream|random&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;With streamline diffusion&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Enable streamline diffusion stabilization: true|false&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Output&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Generate graphical output: true|false&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* ...and then try to read their values from the input file: */</span></div>
<div class="line">    <span class="keywordflow">if</span> (prm_filename.empty())</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a4ac3a8b19ade16e96e8ea25906daf23a">print_parameters</a>(std::cout, <a class="code" href="group__Exceptions.html#ga8364dda711b93753c6809eefe2a8e827a3a1480568c2713f53dcb21319bb28093">ParameterHandler::Text</a>);</div>
<div class="line">        <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(</div>
<div class="line">          <span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;Please pass a .prm file as the first argument!&quot;</span>));</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">parse_input</a>(prm_filename);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa6fff35c961658bfea21e8a3ae468cec">epsilon</a>         = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Epsilon&quot;</span>);</div>
<div class="line">    <a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>       = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Fe degree&quot;</span>);</div>
<div class="line">    smoother_type   = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;Smoother type&quot;</span>);</div>
<div class="line">    smoothing_steps = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Smoothing steps&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> std::string <a class="code" href="fe__q__base__0_8txt.html#ac01155b6a1d9bf8e09c14f9a454cdfea">renumbering</a> = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;DoF renumbering&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="fe__q__base__0_8txt.html#ac01155b6a1d9bf8e09c14f9a454cdfea">renumbering</a> == <span class="stringliteral">&quot;none&quot;</span>)</div>
<div class="line">      dof_renumbering = <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1acc6b05c836e9f74fb7ab9390ffc26f1c">DoFRenumberingStrategy::none</a>;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="fe__q__base__0_8txt.html#ac01155b6a1d9bf8e09c14f9a454cdfea">renumbering</a> == <span class="stringliteral">&quot;downstream&quot;</span>)</div>
<div class="line">      dof_renumbering = <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">DoFRenumberingStrategy::downstream</a>;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="fe__q__base__0_8txt.html#ac01155b6a1d9bf8e09c14f9a454cdfea">renumbering</a> == <span class="stringliteral">&quot;upstream&quot;</span>)</div>
<div class="line">      dof_renumbering = DoFRenumberingStrategy::upstream;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="fe__q__base__0_8txt.html#ac01155b6a1d9bf8e09c14f9a454cdfea">renumbering</a> == <span class="stringliteral">&quot;random&quot;</span>)</div>
<div class="line">      dof_renumbering = <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">DoFRenumberingStrategy::random</a>;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>,</div>
<div class="line">                  <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;The &lt;DoF renumbering&gt; parameter has &quot;</span></div>
<div class="line">                             <span class="stringliteral">&quot;an invalid value.&quot;</span>));</div>
<div class="line"> </div>
<div class="line">    with_streamline_diffusion = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;With streamline diffusion&quot;</span>);</div>
<div class="line">    <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>                    = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;Output&quot;</span>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  std::vector&lt;unsigned int&gt;</div>
<div class="line">  <a class="code" href="namespaceStep63.html#a679f6c35915713a90230f261b38f041e">create_downstream_cell_ordering</a>(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div>
<div class="line">                                  <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a>   <a class="code" href="dofs__0_8txt.html#ae704d52abb496c815f42849c4de0f458">direction</a>,</div>
<div class="line">                                  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>     <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">  {</div>
<div class="line">    std::vector&lt;typename DoFHandler&lt;dim&gt;::level_cell_iterator&gt; ordered_cells;</div>
<div class="line">    ordered_cells.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().n_cells(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#ga8c046284df67198c2d82c25950ea1ea3">cell_iterators_on_level</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>))</div>
<div class="line">      ordered_cells.push_back(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> DoFRenumbering::</div>
<div class="line">      CompareDownstream&lt;typename DoFHandler&lt;dim&gt;::level_cell_iterator, <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;</div>
<div class="line">        comparator(<a class="code" href="dofs__0_8txt.html#ae704d52abb496c815f42849c4de0f458">direction</a>);</div>
<div class="line">    std::sort(ordered_cells.begin(), ordered_cells.end(), comparator);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;unsigned&gt; ordered_indices;</div>
<div class="line">    ordered_indices.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().n_cells(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : ordered_cells)</div>
<div class="line">      ordered_indices.push_back(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;index());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ordered_indices;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  std::vector&lt;unsigned int&gt;</div>
<div class="line">  <a class="code" href="namespaceStep63.html#a679f6c35915713a90230f261b38f041e">create_downstream_cell_ordering</a>(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div>
<div class="line">                                  <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a>   <a class="code" href="dofs__0_8txt.html#ae704d52abb496c815f42849c4de0f458">direction</a>)</div>
<div class="line">  {</div>
<div class="line">    std::vector&lt;typename DoFHandler&lt;dim&gt;::active_cell_iterator&gt; ordered_cells;</div>
<div class="line">    ordered_cells.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().n_active_cells());</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">      ordered_cells.push_back(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> DoFRenumbering::</div>
<div class="line">      CompareDownstream&lt;typename DoFHandler&lt;dim&gt;::active_cell_iterator, <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;</div>
<div class="line">        comparator(<a class="code" href="dofs__0_8txt.html#ae704d52abb496c815f42849c4de0f458">direction</a>);</div>
<div class="line">    std::sort(ordered_cells.begin(), ordered_cells.end(), comparator);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;unsigned int&gt; ordered_indices;</div>
<div class="line">    ordered_indices.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().n_active_cells());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : ordered_cells)</div>
<div class="line">      ordered_indices.push_back(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;index());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ordered_indices;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  std::vector&lt;unsigned int&gt;</div>
<div class="line">  <a class="code" href="namespaceStep63.html#a5bcdd1e04c358777541a2922f8803db4">create_random_cell_ordering</a>(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div>
<div class="line">                              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>     <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">  {</div>
<div class="line">    std::vector&lt;unsigned int&gt; ordered_cells;</div>
<div class="line">    ordered_cells.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().n_cells(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#ga8c046284df67198c2d82c25950ea1ea3">cell_iterators_on_level</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>))</div>
<div class="line">      ordered_cells.push_back(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;index());</div>
<div class="line"> </div>
<div class="line">    std::mt19937 random_number_generator;</div>
<div class="line">    std::shuffle(ordered_cells.begin(),</div>
<div class="line">                 ordered_cells.end(),</div>
<div class="line">                 random_number_generator);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ordered_cells;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  std::vector&lt;unsigned int&gt;</div>
<div class="line">  <a class="code" href="namespaceStep63.html#a5bcdd1e04c358777541a2922f8803db4">create_random_cell_ordering</a>(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler)</div>
<div class="line">  {</div>
<div class="line">    std::vector&lt;unsigned int&gt; ordered_cells;</div>
<div class="line">    ordered_cells.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().n_active_cells());</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">      ordered_cells.push_back(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;index());</div>
<div class="line"> </div>
<div class="line">    std::mt19937 random_number_generator;</div>
<div class="line">    std::shuffle(ordered_cells.begin(),</div>
<div class="line">                 ordered_cells.end(),</div>
<div class="line">                 random_number_generator);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ordered_cells;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span><a class="code" href="classRightHandSide.html">RightHandSide</a> : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="functions__0_8txt.html#af9f808a82e8c618e2e7a19dd08a9eae3">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; <a class="code" href="parsed__convergence__table__0_8txt.html#a8a90f5ba57a42a3fd4c067e00f8b8aea">p</a>,</div>
<div class="line">                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a> = 0) <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="auto__derivative__function__0_8txt.html#a53f941360577ad71fbd6bc110ec4f4de">value_list</a>(<span class="keyword">const</span> <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;<a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>,</div>
<div class="line">                            std::vector&lt;double&gt; &amp;          <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>,</div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a> = 0) <span class="keyword">const override</span>;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">double</span> <a class="code" href="classStep63_1_1RightHandSide.html#a07b87d7025c7c5feca044c5c7d4296ef">RightHandSide&lt;dim&gt;::value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp;,</div>
<div class="line">                                   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a> == 0, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>, 0, 1));</div>
<div class="line">    (void)<a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0.0;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep63_1_1RightHandSide.html#a3c01155ebc56cbf683d19c7da2a27004">RightHandSide&lt;dim&gt;::value_list</a>(<span class="keyword">const</span> <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;<a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>,</div>
<div class="line">                                      std::vector&lt;double&gt; &amp;          <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>,</div>
<div class="line">                                      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>.size() == <a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>.size(),</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga6060b2304b8600f5efa0d31eeda0207d">ExcDimensionMismatch</a>(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>.size(), <a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>.size()));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>.size(); ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">      <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] = <a class="code" href="classRightHandSide.html">RightHandSide&lt;dim&gt;::value</a>(<a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>], <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span><a class="code" href="classBoundaryValues.html">BoundaryValues</a> : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="functions__0_8txt.html#af9f808a82e8c618e2e7a19dd08a9eae3">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; <a class="code" href="parsed__convergence__table__0_8txt.html#a8a90f5ba57a42a3fd4c067e00f8b8aea">p</a>,</div>
<div class="line">                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a> = 0) <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="auto__derivative__function__0_8txt.html#a53f941360577ad71fbd6bc110ec4f4de">value_list</a>(<span class="keyword">const</span> <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;<a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>,</div>
<div class="line">                            std::vector&lt;double&gt; &amp;          <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>,</div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a> = 0) <span class="keyword">const override</span>;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">double</span> <a class="code" href="classStep63_1_1BoundaryValues.html#a45af33d412a06517009ba6f342340256">BoundaryValues&lt;dim&gt;::value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; <a class="code" href="parsed__convergence__table__0_8txt.html#a8a90f5ba57a42a3fd4c067e00f8b8aea">p</a>,</div>
<div class="line">                                    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a> == 0, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>, 0, 1));</div>
<div class="line">    (void)<a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(<a class="code" href="parsed__convergence__table__0_8txt.html#a8a90f5ba57a42a3fd4c067e00f8b8aea">p</a>[0] - 1) &lt; 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-8 ||</div>
<div class="line">        (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(<a class="code" href="parsed__convergence__table__0_8txt.html#a8a90f5ba57a42a3fd4c067e00f8b8aea">p</a>[1] + 1) &lt; 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-8 &amp;&amp; <a class="code" href="parsed__convergence__table__0_8txt.html#a8a90f5ba57a42a3fd4c067e00f8b8aea">p</a>[0] &gt;= 0.5))</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">return</span> 1.0;</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">return</span> 0.0;</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep63_1_1BoundaryValues.html#abaf128aa6e5fbe6772fa6d4d8be5002c">BoundaryValues&lt;dim&gt;::value_list</a>(<span class="keyword">const</span> <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;<a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>,</div>
<div class="line">                                       std::vector&lt;double&gt; &amp;          <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>,</div>
<div class="line">                                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>.size() == <a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>.size(),</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga6060b2304b8600f5efa0d31eeda0207d">ExcDimensionMismatch</a>(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>.size(), <a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>.size()));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>.size(); ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">      <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] = <a class="code" href="classBoundaryValues.html">BoundaryValues&lt;dim&gt;::value</a>(<a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>], <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">double</span> <a class="code" href="namespaceStep63.html#abe37f2d8c4bdc6c9dc4255f0a778aeec">compute_stabilization_delta</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>         hk,</div>
<div class="line">                                     <span class="keyword">const</span> <span class="keywordtype">double</span>         <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1ab87bd17d3acf6932f7bb6927f58fe3cd">eps</a>,</div>
<div class="line">                                     <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> dir,</div>
<div class="line">                                     <span class="keyword">const</span> <span class="keywordtype">double</span>         pk)</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> Peclet = dir.<a class="code" href="classTensor.html#afd0934b4edd71063f66a9c67540e79fc">norm</a>() * hk / (2.0 * <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1ab87bd17d3acf6932f7bb6927f58fe3cd">eps</a> * pk);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespaceDifferentiation_1_1SD.html#a66e76f1c4fdb9a31f4fabef8abee5f28">coth</a> =</div>
<div class="line">      (1.0 + <a class="code" href="base_2vectorization_8h.html#a19f846bda83b7e3f4531daacb40c64e1">std::exp</a>(-2.0 * Peclet)) / (1.0 - std::exp(-2.0 * Peclet));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> hk / (2.0 * dir.<a class="code" href="classTensor.html#afd0934b4edd71063f66a9c67540e79fc">norm</a>() * pk) * (<a class="code" href="namespaceDifferentiation_1_1SD.html#a66e76f1c4fdb9a31f4fabef8abee5f28">coth</a> - 1.0 / Peclet);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span>AdvectionProblem</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    AdvectionProblem(<span class="keyword">const</span> <a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a> &amp;<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>);</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">run</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">void</span> setup_system();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> IteratorType&gt;</div>
<div class="line">    <span class="keywordtype">void</span> assemble_cell(<span class="keyword">const</span> IteratorType &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>,</div>
<div class="line">                       <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a> &amp;  scratch_data,</div>
<div class="line">                       <a class="code" href="structCopyData.html">CopyData</a> &amp;          copy_data);</div>
<div class="line">    <span class="keywordtype">void</span> assemble_system_and_multigrid();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> setup_smoother();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>();</div>
<div class="line">    <span class="keywordtype">void</span> refine_grid();</div>
<div class="line">    <span class="keywordtype">void</span> output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>;</div>
<div class="line">    <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>    dof_handler;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a>     <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classMappingQ.html">MappingQ&lt;dim&gt;</a> <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSparsityPattern.html">SparsityPattern</a>      <a class="code" href="trilinos__sparse__matrix__0_8txt.html#ab4e34663c28496ee1b07f40fd5d00fa1">sparsity_pattern</a>;</div>
<div class="line">    <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> system_matrix;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>;</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> system_rhs;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparsityPattern&gt;</a> mg_sparsity_patterns;</div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparsityPattern&gt;</a> mg_interface_sparsity_patterns;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparseMatrix&lt;double&gt;</a>&gt; mg_matrices;</div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparseMatrix&lt;double&gt;</a>&gt; mg_interface_in;</div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparseMatrix&lt;double&gt;</a>&gt; mg_interface_out;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;Vector&lt;double&gt;</a>&gt; mg_matrix;</div>
<div class="line">    <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;Vector&lt;double&gt;</a>&gt; mg_interface_matrix_in;</div>
<div class="line">    <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;Vector&lt;double&gt;</a>&gt; mg_interface_matrix_out;</div>
<div class="line"> </div>
<div class="line">    std::unique_ptr&lt;MGSmoother&lt;Vector&lt;double&gt;&gt;&gt; mg_smoother;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using</span> SmootherType =</div>
<div class="line">      <a class="code" href="classRelaxationBlock.html">RelaxationBlock&lt;SparseMatrix&lt;double&gt;</a>, <a class="code" href="hdf5__0_8txt.html#aae153b86de45d3354cd3edd5b992435e">double</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;;</div>
<div class="line">    <span class="keyword">using</span> SmootherAdditionalDataType = <a class="code" href="relaxation__block__0_8txt.html#a2076fd56276055e74e230fad6edac013">SmootherType::AdditionalData</a>;</div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SmootherAdditionalDataType&gt;</a> smoother_data;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classMGConstrainedDoFs.html">MGConstrainedDoFs</a> mg_constrained_dofs;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> advection_direction;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a> <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <a class="code" href="classStep63_1_1AdvectionProblem.html#a20cff1646814eaae513b4a304d4dde33">AdvectionProblem&lt;dim&gt;::AdvectionProblem</a>(<span class="keyword">const</span> <a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a> &amp;<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>)</div>
<div class="line">    : <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>(<a class="code" href="classTriangulation.html">Triangulation</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;::limit_level_difference_at_vertices)</div>
<div class="line">    , dof_handler(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>)</div>
<div class="line">    , <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.<a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>)</div>
<div class="line">    , <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.<a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>)</div>
<div class="line">    , <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>)</div>
<div class="line">  {</div>
<div class="line">    advection_direction[0] = -<a class="code" href="function__time__0_8txt.html#aec9d63e7b1c02618470be701525a5211">std::sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a> / 6.0);</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> &gt;= 2)</div>
<div class="line">      advection_direction[1] = <a class="code" href="base_2vectorization_8h.html#a11c48f86a4f2adf21555e64049ecde8c">std::cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a> / 6.0);</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> &gt;= 3)</div>
<div class="line">      <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::setup_system()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a> = <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_levels();</div>
<div class="line"> </div>
<div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    system_rhs.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#addd15bc409c61d6f795f0132c574335b">clear</a>();</div>
<div class="line">    <a class="code" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a>(dof_handler, <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">      <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>, dof_handler, 0, <a class="code" href="classBoundaryValues.html">BoundaryValues&lt;dim&gt;</a>(), <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>);</div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">      <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>, dof_handler, 1, <a class="code" href="classBoundaryValues.html">BoundaryValues&lt;dim&gt;</a>(), <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>);</div>
<div class="line">    <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler,</div>
<div class="line">                                    dsp,</div>
<div class="line">                                    <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>,</div>
<div class="line">                                    <span class="comment">/*keep_constrained_dofs = */</span> <span class="keyword">false</span>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="trilinos__sparse__matrix__0_8txt.html#ab4e34663c28496ee1b07f40fd5d00fa1">sparsity_pattern</a>.copy_from(dsp);</div>
<div class="line">    system_matrix.reinit(<a class="code" href="trilinos__sparse__matrix__0_8txt.html#ab4e34663c28496ee1b07f40fd5d00fa1">sparsity_pattern</a>);</div>
<div class="line"> </div>
<div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#a9aed31323cbd7619edac310c47e7a7ad">distribute_mg_dofs</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;SOR&quot;</span> || <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;Jacobi&quot;</span>)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.dof_renumbering ==</div>
<div class="line">              <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">Settings::DoFRenumberingStrategy::downstream</a> ||</div>
<div class="line">            <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.dof_renumbering ==</div>
<div class="line">              Settings::DoFRenumberingStrategy::upstream)</div>
<div class="line">          {</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> <a class="code" href="dofs__0_8txt.html#ae704d52abb496c815f42849c4de0f458">direction</a> =</div>
<div class="line">              (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.dof_renumbering ==</div>
<div class="line">                   Settings::DoFRenumberingStrategy::upstream ?</div>
<div class="line">                 -1.0 :</div>
<div class="line">                 1.0) *</div>
<div class="line">              advection_direction;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a>; ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">              <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">DoFRenumbering::downstream</a>(dof_handler,</div>
<div class="line">                                         <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>,</div>
<div class="line">                                         <a class="code" href="dofs__0_8txt.html#ae704d52abb496c815f42849c4de0f458">direction</a>,</div>
<div class="line">                                         <span class="comment">/*dof_wise_renumbering = */</span> <span class="keyword">true</span>);</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.dof_renumbering ==</div>
<div class="line">                 <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">Settings::DoFRenumberingStrategy::random</a>)</div>
<div class="line">          {</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a>; ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">              <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">DoFRenumbering::random</a>(dof_handler, <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    mg_constrained_dofs.clear();</div>
<div class="line">    mg_constrained_dofs.initialize(dof_handler);</div>
<div class="line"> </div>
<div class="line">    mg_constrained_dofs.make_zero_boundary_constraints(dof_handler, {0, 1});</div>
<div class="line"> </div>
<div class="line">    mg_matrices.resize(0, <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a> - 1);</div>
<div class="line">    mg_matrices.clear_elements();</div>
<div class="line">    mg_interface_in.resize(0, <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a> - 1);</div>
<div class="line">    mg_interface_in.clear_elements();</div>
<div class="line">    mg_interface_out.resize(0, <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a> - 1);</div>
<div class="line">    mg_interface_out.clear_elements();</div>
<div class="line">    mg_sparsity_patterns.resize(0, <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a> - 1);</div>
<div class="line">    mg_interface_sparsity_patterns.resize(0, <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a> - 1);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a>; ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">      {</div>
<div class="line">        {</div>
<div class="line">          <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>),</div>
<div class="line">                                     dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">          <a class="code" href="namespaceMGTools.html#a19ba9ee4a2b65235c8bb3fb65ea8f4e0">MGTools::make_sparsity_pattern</a>(dof_handler, dsp, <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">          mg_sparsity_patterns[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].copy_from(dsp);</div>
<div class="line">          mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].reinit(mg_sparsity_patterns[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>]);</div>
<div class="line">        }</div>
<div class="line">        {</div>
<div class="line">          <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>),</div>
<div class="line">                                     dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">          <a class="code" href="namespaceMGTools.html#a8c677f65f8f1d21fb1f4c55cb90079e0">MGTools::make_interface_sparsity_pattern</a>(dof_handler,</div>
<div class="line">                                                   mg_constrained_dofs,</div>
<div class="line">                                                   dsp,</div>
<div class="line">                                                   <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">          mg_interface_sparsity_patterns[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].copy_from(dsp);</div>
<div class="line"> </div>
<div class="line">          mg_interface_in[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].reinit(mg_interface_sparsity_patterns[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>]);</div>
<div class="line">          mg_interface_out[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].reinit(mg_interface_sparsity_patterns[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>]);</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">class</span> IteratorType&gt;</div>
<div class="line">  <span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::assemble_cell(<span class="keyword">const</span> IteratorType &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>,</div>
<div class="line">                                            <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a> &amp;  scratch_data,</div>
<div class="line">                                            <a class="code" href="structCopyData.html">CopyData</a> &amp;          copy_data)</div>
<div class="line">  {</div>
<div class="line">    copy_data.level = <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;level();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> =</div>
<div class="line">      scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.get_fe().n_dofs_per_cell();</div>
<div class="line">    copy_data.dofs_per_cell = <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>;</div>
<div class="line">    copy_data.cell_matrix.reinit(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>, <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a> =</div>
<div class="line">      scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.<a class="code" href="classFEValues.html#ae053b49309f1dce22268c6bc8fe50cb2">get_quadrature</a>().size();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;is_level_cell() == <span class="keyword">false</span>)</div>
<div class="line">      copy_data.cell_rhs.reinit(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">    copy_data.local_dof_indices.resize(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">    <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;get_active_or_mg_dof_indices(copy_data.local_dof_indices);</div>
<div class="line"> </div>
<div class="line">    scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classRightHandSide.html">RightHandSide&lt;dim&gt;</a>  <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>;</div>
<div class="line">    std::vector&lt;double&gt; rhs_values(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>.value_list(scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.get_quadrature_points(),</div>
<div class="line">                               rhs_values);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> delta = (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.with_streamline_diffusion ?</div>
<div class="line">                            <a class="code" href="namespaceStep63.html#abe37f2d8c4bdc6c9dc4255f0a778aeec">compute_stabilization_delta</a>(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;diameter(),</div>
<div class="line">                                                        <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.epsilon,</div>
<div class="line">                                                        advection_direction,</div>
<div class="line">                                                        <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.fe_degree) :</div>
<div class="line">                            0.0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q_point)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">        {</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> = 0; <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>)</div>
<div class="line">            {</div>
<div class="line">              copy_data.cell_matrix(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>) +=</div>
<div class="line">                (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.epsilon *</div>
<div class="line">                 scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) *</div>
<div class="line">                 scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point) *</div>
<div class="line">                 scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.JxW(q_point)) +</div>
<div class="line">                (scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_value(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) *</div>
<div class="line">                 (advection_direction *</div>
<div class="line">                  scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point)) *</div>
<div class="line">                 scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.JxW(q_point))</div>
<div class="line">                + delta *</div>
<div class="line">                    (advection_direction *</div>
<div class="line">                     scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point)) *</div>
<div class="line">                    (advection_direction *</div>
<div class="line">                     scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point)) *</div>
<div class="line">                    scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.JxW(q_point) -</div>
<div class="line">                delta * <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.epsilon *</div>
<div class="line">                  <a class="code" href="base_2symmetric__tensor_8h.html#a4248760c880275bab1f288fc80f27039">trace</a>(scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_hessian(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point)) *</div>
<div class="line">                  (advection_direction *</div>
<div class="line">                   scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point)) *</div>
<div class="line">                  scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.JxW(q_point);</div>
<div class="line">            }</div>
<div class="line">          <span class="keywordflow">if</span> (<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;is_level_cell() == <span class="keyword">false</span>)</div>
<div class="line">            {</div>
<div class="line">              copy_data.cell_rhs(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>) +=</div>
<div class="line">                scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_value(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) *</div>
<div class="line">                  rhs_values[q_point] * scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.JxW(q_point)</div>
<div class="line">                + delta * rhs_values[q_point] * advection_direction *</div>
<div class="line">                    scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) *</div>
<div class="line">                    scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.JxW(q_point);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::assemble_system_and_multigrid()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> cell_worker_active =</div>
<div class="line">      [&amp;](<span class="keyword">const</span> decltype(dof_handler.<a class="code" href="classDoFHandler.html#a9a3bef554c6d22abe312e10e9475eecf">begin_active</a>()) &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>,</div>
<div class="line">          <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a> &amp;                          scratch_data,</div>
<div class="line">          <a class="code" href="structCopyData.html">CopyData</a> &amp;                                  copy_data) {</div>
<div class="line">        this-&gt;assemble_cell(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, scratch_data, copy_data);</div>
<div class="line">      };</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> copier_active = [&amp;](<span class="keyword">const</span> <a class="code" href="structCopyData.html">CopyData</a> &amp;copy_data) {</div>
<div class="line">      <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#a373fbdacd8c486e675b8d2bff8943192">distribute_local_to_global</a>(copy_data.cell_matrix,</div>
<div class="line">                                             copy_data.cell_rhs,</div>
<div class="line">                                             copy_data.local_dof_indices,</div>
<div class="line">                                             system_matrix,</div>
<div class="line">                                             system_rhs);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop</a>(dof_handler.<a class="code" href="classDoFHandler.html#a9a3bef554c6d22abe312e10e9475eecf">begin_active</a>(),</div>
<div class="line">                          dof_handler.<a class="code" href="classDoFHandler.html#a042c4bf0f59fef5e72dbcfbdd56b2782">end</a>(),</div>
<div class="line">                          cell_worker_active,</div>
<div class="line">                          copier_active,</div>
<div class="line">                          <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>, <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1),</div>
<div class="line">                          <a class="code" href="structCopyData.html">CopyData</a>(),</div>
<div class="line">                          <a class="code" href="namespaceMeshWorker.html#ac7a9db8b34d398d7d398d1e8809874aaacb8627085561cee8b7af9d74320696eb">MeshWorker::assemble_own_cells</a>);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;AffineConstraints&lt;double&gt;&gt; boundary_constraints(</div>
<div class="line">      <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels());</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels();</div>
<div class="line">         ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classIndexSet.html">IndexSet</a> locally_owned_level_dof_indices;</div>
<div class="line">        <a class="code" href="namespaceDoFTools.html#a1fef7be07cf379b661646e39b9354e17">DoFTools::extract_locally_relevant_level_dofs</a>(</div>
<div class="line">          dof_handler, <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>, locally_owned_level_dof_indices);</div>
<div class="line">        boundary_constraints[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].reinit(locally_owned_level_dof_indices);</div>
<div class="line">        boundary_constraints[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].add_lines(</div>
<div class="line">          mg_constrained_dofs.get_refinement_edge_indices(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">        boundary_constraints[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].add_lines(</div>
<div class="line">          mg_constrained_dofs.get_boundary_indices(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">        boundary_constraints[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].close();</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> cell_worker_mg =</div>
<div class="line">      [&amp;](<span class="keyword">const</span> decltype(dof_handler.<a class="code" href="classDoFHandler.html#a52af463de3283318bd4c651df7d35d24">begin_mg</a>()) &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>,</div>
<div class="line">          <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a> &amp;                      scratch_data,</div>
<div class="line">          <a class="code" href="structCopyData.html">CopyData</a> &amp;                              copy_data) {</div>
<div class="line">        this-&gt;assemble_cell(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, scratch_data, copy_data);</div>
<div class="line">      };</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> copier_mg = [&amp;](<span class="keyword">const</span> <a class="code" href="structCopyData.html">CopyData</a> &amp;copy_data) {</div>
<div class="line">      boundary_constraints[copy_data.level].distribute_local_to_global(</div>
<div class="line">        copy_data.cell_matrix,</div>
<div class="line">        copy_data.local_dof_indices,</div>
<div class="line">        mg_matrices[copy_data.level]);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; copy_data.dofs_per_cell; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> = 0; <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> &lt; copy_data.dofs_per_cell; ++<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>)</div>
<div class="line">          <span class="keywordflow">if</span> (mg_constrained_dofs.is_interface_matrix_entry(</div>
<div class="line">                copy_data.level,</div>
<div class="line">                copy_data.local_dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>],</div>
<div class="line">                copy_data.local_dof_indices[<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>]))</div>
<div class="line">            {</div>
<div class="line">              mg_interface_out[copy_data.level].add(</div>
<div class="line">                copy_data.local_dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>],</div>
<div class="line">                copy_data.local_dof_indices[<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>],</div>
<div class="line">                copy_data.cell_matrix(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>));</div>
<div class="line">              mg_interface_in[copy_data.level].add(</div>
<div class="line">                copy_data.local_dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>],</div>
<div class="line">                copy_data.local_dof_indices[<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>],</div>
<div class="line">                copy_data.cell_matrix(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>));</div>
<div class="line">            }</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop</a>(dof_handler.<a class="code" href="classDoFHandler.html#a52af463de3283318bd4c651df7d35d24">begin_mg</a>(),</div>
<div class="line">                          dof_handler.<a class="code" href="classDoFHandler.html#aaa2300cc9a5f93532400af2752d948f6">end_mg</a>(),</div>
<div class="line">                          cell_worker_mg,</div>
<div class="line">                          copier_mg,</div>
<div class="line">                          <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>, <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1),</div>
<div class="line">                          <a class="code" href="structCopyData.html">CopyData</a>(),</div>
<div class="line">                          <a class="code" href="namespaceMeshWorker.html#ac7a9db8b34d398d7d398d1e8809874aaacb8627085561cee8b7af9d74320696eb">MeshWorker::assemble_own_cells</a>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::setup_smoother()</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;SOR&quot;</span>)</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">using</span> Smoother = <a class="code" href="classPreconditionSOR.html">PreconditionSOR&lt;SparseMatrix&lt;double&gt;</a>&gt;;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> smoother =</div>
<div class="line">          std::make_unique&lt;MGSmootherPrecondition&lt;SparseMatrix&lt;double&gt;,</div>
<div class="line">                                                  Smoother,</div>
<div class="line">                                                  <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;&gt;();</div>
<div class="line">        smoother-&gt;<a class="code" href="classMGSmootherPrecondition.html#a3cb789b815bf6719eee79e2137c9bd84">initialize</a>(mg_matrices,</div>
<div class="line">                             <a class="code" href="relaxation__block__0_8txt.html#a2076fd56276055e74e230fad6edac013">Smoother::AdditionalData</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> == 1 ? 1.0 :</div>
<div class="line">                                                                       0.62));</div>
<div class="line">        smoother-&gt;<a class="code" href="classMGSmoother.html#a9976182b6b272aac7800a8fbf18c8ab9">set_steps</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoothing_steps);</div>
<div class="line">        mg_smoother = std::move(smoother);</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;Jacobi&quot;</span>)</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">using</span> Smoother = <a class="code" href="classPreconditionJacobi.html">PreconditionJacobi&lt;SparseMatrix&lt;double&gt;</a>&gt;;</div>
<div class="line">        <span class="keyword">auto</span> smoother =</div>
<div class="line">          std::make_unique&lt;MGSmootherPrecondition&lt;SparseMatrix&lt;double&gt;,</div>
<div class="line">                                                  Smoother,</div>
<div class="line">                                                  <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;&gt;();</div>
<div class="line">        smoother-&gt;<a class="code" href="classMGSmootherPrecondition.html#a3cb789b815bf6719eee79e2137c9bd84">initialize</a>(mg_matrices,</div>
<div class="line">                             <a class="code" href="relaxation__block__0_8txt.html#a2076fd56276055e74e230fad6edac013">Smoother::AdditionalData</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> == 1 ? 0.6667 :</div>
<div class="line">                                                                       0.47));</div>
<div class="line">        smoother-&gt;<a class="code" href="classMGSmoother.html#a9976182b6b272aac7800a8fbf18c8ab9">set_steps</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoothing_steps);</div>
<div class="line">        mg_smoother = std::move(smoother);</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;block SOR&quot;</span> ||</div>
<div class="line">             <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;block Jacobi&quot;</span>)</div>
<div class="line">      {</div>
<div class="line">        smoother_data.<a class="code" href="classMGLevelObject.html#a16213121f9153bd08f49652a11886259">resize</a>(0, <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_levels() - 1);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_levels(); ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="namespaceDoFTools.html#a43ee44769769065bc594d1730477a4b9">DoFTools::make_cell_patches</a>(smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].block_list,</div>
<div class="line">                                        dof_handler,</div>
<div class="line">                                        <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line"> </div>
<div class="line">            smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].relaxation =</div>
<div class="line">              (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;block SOR&quot;</span> ? 1.0 : 0.25);</div>
<div class="line">            smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].inversion = <a class="code" href="classPreconditionBlockBase.html">PreconditionBlockBase&lt;double&gt;::svd</a>;</div>
<div class="line"> </div>
<div class="line">            std::vector&lt;unsigned int&gt; ordered_indices;</div>
<div class="line">            <span class="keywordflow">switch</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.dof_renumbering)</div>
<div class="line">              {</div>
<div class="line">                <span class="keywordflow">case</span> <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">Settings::DoFRenumberingStrategy::downstream</a>:</div>
<div class="line">                  ordered_indices =</div>
<div class="line">                    <a class="code" href="namespaceStep63.html#a679f6c35915713a90230f261b38f041e">create_downstream_cell_ordering</a>(dof_handler,</div>
<div class="line">                                                    advection_direction,</div>
<div class="line">                                                    <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">                  <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> Settings::DoFRenumberingStrategy::upstream:</div>
<div class="line">                  ordered_indices =</div>
<div class="line">                    <a class="code" href="namespaceStep63.html#a679f6c35915713a90230f261b38f041e">create_downstream_cell_ordering</a>(dof_handler,</div>
<div class="line">                                                    -1.0 * advection_direction,</div>
<div class="line">                                                    <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">                  <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">Settings::DoFRenumberingStrategy::random</a>:</div>
<div class="line">                  ordered_indices =</div>
<div class="line">                    <a class="code" href="namespaceStep63.html#a5bcdd1e04c358777541a2922f8803db4">create_random_cell_ordering</a>(dof_handler, <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">                  <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1acc6b05c836e9f74fb7ab9390ffc26f1c">Settings::DoFRenumberingStrategy::none</a>:</div>
<div class="line">                  <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">default</span>:</div>
<div class="line">                  <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">                  <span class="keywordflow">break</span>;</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].order =</div>
<div class="line">              std::vector&lt;std::vector&lt;unsigned int&gt;&gt;(1, ordered_indices);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;block SOR&quot;</span>)</div>
<div class="line">          {</div>
<div class="line">            <span class="keyword">auto</span> smoother = std::make_unique&lt;<a class="code" href="classMGSmootherPrecondition.html">MGSmootherPrecondition</a>&lt;</div>
<div class="line">              <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a>,</div>
<div class="line">              <a class="code" href="classRelaxationBlockSOR.html">RelaxationBlockSOR&lt;SparseMatrix&lt;double&gt;</a>, <a class="code" href="hdf5__0_8txt.html#aae153b86de45d3354cd3edd5b992435e">double</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;,</div>
<div class="line">              <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;&gt;();</div>
<div class="line">            smoother-&gt;<a class="code" href="classMGSmootherPrecondition.html#a3cb789b815bf6719eee79e2137c9bd84">initialize</a>(mg_matrices, smoother_data);</div>
<div class="line">            smoother-&gt;<a class="code" href="classMGSmoother.html#a9976182b6b272aac7800a8fbf18c8ab9">set_steps</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoothing_steps);</div>
<div class="line">            mg_smoother = std::move(smoother);</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;block Jacobi&quot;</span>)</div>
<div class="line">          {</div>
<div class="line">            <span class="keyword">auto</span> smoother = std::make_unique&lt;</div>
<div class="line">              <a class="code" href="classMGSmootherPrecondition.html">MGSmootherPrecondition&lt;SparseMatrix&lt;double&gt;</a>,</div>
<div class="line">                                     <a class="code" href="classRelaxationBlockJacobi.html">RelaxationBlockJacobi&lt;SparseMatrix&lt;double&gt;</a>,</div>
<div class="line">                                                           <a class="code" href="hdf5__0_8txt.html#aae153b86de45d3354cd3edd5b992435e">double</a>,</div>
<div class="line">                                                           <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;,</div>
<div class="line">                                     <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;&gt;();</div>
<div class="line">            smoother-&gt;<a class="code" href="classMGSmootherPrecondition.html#a3cb789b815bf6719eee79e2137c9bd84">initialize</a>(mg_matrices, smoother_data);</div>
<div class="line">            smoother-&gt;<a class="code" href="classMGSmoother.html#a9976182b6b272aac7800a8fbf18c8ab9">set_steps</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoothing_steps);</div>
<div class="line">            mg_smoother = std::move(smoother);</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">AdvectionProblem&lt;dim&gt;::solve</a>()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_iters       = 200;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>       solve_tolerance = 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-8 * system_rhs.l2_norm();</div>
<div class="line">    <a class="code" href="classSolverControl.html">SolverControl</a>      solver_control(max_iters, solve_tolerance, <span class="keyword">true</span>, <span class="keyword">true</span>);</div>
<div class="line">    solver_control.<a class="code" href="classSolverControl.html#a6d99741765243ccb65da4ff66558cf41">enable_history_data</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using</span> Transfer = <a class="code" href="classMGTransferPrebuilt.html">MGTransferPrebuilt&lt;Vector&lt;double&gt;</a>&gt;;</div>
<div class="line">    Transfer mg_transfer(mg_constrained_dofs);</div>
<div class="line">    mg_transfer.<a class="code" href="classMGTransferMatrixFree.html#a8f214ffade006cfa85e902a94902fc7b">build</a>(dof_handler);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> coarse_matrix;</div>
<div class="line">    coarse_matrix.<a class="code" href="classFullMatrix.html#ae9e8fbf00e15c7b66d527a5de4b31404">copy_from</a>(mg_matrices[0]);</div>
<div class="line">    <a class="code" href="classMGCoarseGridHouseholder.html">MGCoarseGridHouseholder&lt;double, Vector&lt;double&gt;</a>&gt; coarse_grid_solver;</div>
<div class="line">    coarse_grid_solver.<a class="code" href="classMGCoarseGridHouseholder.html#a07bd76dc7f6f66cb22d3e7951a558f50">initialize</a>(coarse_matrix);</div>
<div class="line"> </div>
<div class="line">    setup_smoother();</div>
<div class="line"> </div>
<div class="line">    mg_matrix.initialize(mg_matrices);</div>
<div class="line">    mg_interface_matrix_in.initialize(mg_interface_in);</div>
<div class="line">    mg_interface_matrix_out.initialize(mg_interface_out);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classMultigrid.html">Multigrid&lt;Vector&lt;double&gt;</a>&gt; <a class="code" href="namespacemg.html">mg</a>(</div>
<div class="line">      mg_matrix, coarse_grid_solver, mg_transfer, *mg_smoother, *mg_smoother);</div>
<div class="line">    <a class="code" href="namespacemg.html">mg</a>.set_edge_matrices(mg_interface_matrix_out, mg_interface_matrix_in);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classPreconditionMG.html">PreconditionMG&lt;dim, Vector&lt;double&gt;</a>, Transfer&gt; <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>(dof_handler,</div>
<div class="line">                                                                 <a class="code" href="namespacemg.html">mg</a>,</div>
<div class="line">                                                                 mg_transfer);</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;     Solving with GMRES to tol &quot;</span> &lt;&lt; solve_tolerance &lt;&lt; <span class="stringliteral">&quot;...&quot;</span></div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line">    <a class="code" href="classSolverGMRES.html">SolverGMRES&lt;Vector&lt;double&gt;</a>&gt; <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>(</div>
<div class="line">      solver_control, <a class="code" href="classSolverGMRES.html">SolverGMRES</a>&lt;<a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;::<a class="code" href="relaxation__block__0_8txt.html#a2076fd56276055e74e230fad6edac013">AdditionalData</a>(50, <span class="keyword">true</span>));</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTimer.html">Timer</a> <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a>;</div>
<div class="line">    <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a>.start();</div>
<div class="line">    <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.solve(system_matrix, <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, system_rhs, <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>);</div>
<div class="line">    <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a>.stop();</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;          converged in &quot;</span> &lt;&lt; solver_control.<a class="code" href="classSolverControl.html#a42aeae81cd6b67ce93b5fbea3328371f">last_step</a>()</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot; iterations&quot;</span></div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot; in &quot;</span> &lt;&lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a>.last_wall_time() &lt;&lt; <span class="stringliteral">&quot; seconds &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">distribute</a>(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line">    mg_smoother.release();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a> = <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells();</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a>     cell_indices(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>);</div>
<div class="line">    {</div>
<div class="line">      std::vector&lt;unsigned int&gt; ordered_indices;</div>
<div class="line">      <span class="keywordflow">switch</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.dof_renumbering)</div>
<div class="line">        {</div>
<div class="line">          <span class="keywordflow">case</span> <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">Settings::DoFRenumberingStrategy::downstream</a>:</div>
<div class="line">            ordered_indices =</div>
<div class="line">              <a class="code" href="namespaceStep63.html#a679f6c35915713a90230f261b38f041e">create_downstream_cell_ordering</a>(dof_handler, advection_direction);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">case</span> Settings::DoFRenumberingStrategy::upstream:</div>
<div class="line">            ordered_indices =</div>
<div class="line">              <a class="code" href="namespaceStep63.html#a679f6c35915713a90230f261b38f041e">create_downstream_cell_ordering</a>(dof_handler,</div>
<div class="line">                                              -1.0 * advection_direction);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">case</span> <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">Settings::DoFRenumberingStrategy::random</a>:</div>
<div class="line">            ordered_indices = <a class="code" href="namespaceStep63.html#a5bcdd1e04c358777541a2922f8803db4">create_random_cell_ordering</a>(dof_handler);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">case</span> <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1acc6b05c836e9f74fb7ab9390ffc26f1c">Settings::DoFRenumberingStrategy::none</a>:</div>
<div class="line">            ordered_indices.resize(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>);</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">              ordered_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] = <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">default</span>:</div>
<div class="line">            <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">        cell_indices(ordered_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">attach_dof_handler</a>(dof_handler);</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, <span class="stringliteral">&quot;solution&quot;</span>);</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(cell_indices, <span class="stringliteral">&quot;cell_index&quot;</span>);</div>
<div class="line">    data_out.<a class="code" href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">build_patches</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> std::string filename =</div>
<div class="line">      <span class="stringliteral">&quot;solution-&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>) + <span class="stringliteral">&quot;.vtu&quot;</span>;</div>
<div class="line">    std::ofstream <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>(filename.c_str());</div>
<div class="line">    data_out.<a class="code" href="classDataOutInterface.html#a93c780f93105e0daaa76c6c43694b4ae">write_vtu</a>(<a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">AdvectionProblem&lt;dim&gt;::run</a>()</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> = 0; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt; (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.fe_degree == 1 ? 7 : 5);</div>
<div class="line">         ++<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>)</div>
<div class="line">      {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;  Cycle &quot;</span> &lt;&lt; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> == 0)</div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="namespaceGridGenerator.html#add14cab546d033c1eaacc9234c64ebcd">GridGenerator::hyper_cube_with_cylindrical_hole</a>(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>,</div>
<div class="line">                                                            0.3,</div>
<div class="line">                                                            1.0);</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classSphericalManifold.html">SphericalManifold&lt;dim&gt;</a> manifold_description(<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>(0, 0));</div>
<div class="line">            <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.set_manifold(1, manifold_description);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.refine_global();</div>
<div class="line"> </div>
<div class="line">        setup_system();</div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;     Number of active cells:       &quot;</span></div>
<div class="line">                  &lt;&lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells() &lt;&lt; <span class="stringliteral">&quot; (&quot;</span></div>
<div class="line">                  &lt;&lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_levels() &lt;&lt; <span class="stringliteral">&quot; levels)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;     Number of degrees of freedom: &quot;</span></div>
<div class="line">                  &lt;&lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>() &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        assemble_system_and_multigrid();</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.output)</div>
<div class="line">          output_results(<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>);</div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; std::endl;</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Step63</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="structStep63_1_1Settings.html">Step63::Settings</a> <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>;</div>
<div class="line">      <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.get_parameters((argc &gt; 1) ? (argv[1]) : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classStep63_1_1AdvectionProblem.html">Step63::AdvectionProblem&lt;2&gt;</a> advection_problem_2d(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>);</div>
<div class="line">      advection_problem_2d.run();</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (<a class="code" href="parameter__handler__0_8txt.html#ad919e2b915d8e8226aef004c2d8399a8">std::exception</a> &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p><br  />
 This tutorial depends on <a class="el" href="step_16.html">step-16</a> .  
<table class="tutorial" width="50%">
<tr><th colspan="2"><b><small>Table of contents</small></b><b><small>Table of contents</small></b></th></tr>
<tr><td width="50%" valign="top">
<ol>
  <li> <a href="#Intro" class=bold>Introduction</a><a href="#Intro" class=bold>Introduction</a>
    <ul>
        <li><a href="#Equation">Equation</a><a href="#Equation">Equation</a>
      <ul>
        <li><a href="#Streamlinediffusion">Streamline diffusion</a><a href="#Streamlinediffusion">Streamline diffusion</a>
      </ul>
        <li><a href="#Smoothers">Smoothers</a><a href="#Smoothers">Smoothers</a>
        <li><a href="#Testproblem">Test problem</a><a href="#Testproblem">Test problem</a>
    </ul>
  <li> <a href="#CommProg" class=bold>The commented program</a><a href="#CommProg" class=bold>The commented program</a>
    <ul>
        <li><a href="#Includefiles">Include files</a><a href="#Includefiles">Include files</a>
        <li><a href="#MeshWorkerdata">MeshWorker data</a><a href="#MeshWorkerdata">MeshWorker data</a>
        <li><a href="#Problemparameters">Problem parameters</a><a href="#Problemparameters">Problem parameters</a>
        <li><a href="#Cellpermutations">Cell permutations</a><a href="#Cellpermutations">Cell permutations</a>
        <li><a href="#Righthandsideandboundaryvalues">Right-hand side and boundary values</a><a href="#Righthandsideandboundaryvalues">Right-hand side and boundary values</a>
        <li><a href="#Streamlinediffusionimplementation">Streamline diffusion implementation</a><a href="#Streamlinediffusionimplementation">Streamline diffusion implementation</a>
        <li><a href="#codeAdvectionProlemcodeclass"><code>AdvectionProlem</code> class</a><a href="#codeAdvectionProlemcodeclass"><code>AdvectionProlem</code> class</a>
      <ul>
        <li><a href="#codeAdvectionProblemsetup_systemcode"><code>AdvectionProblem::setup_system()</code></a><a href="#codeAdvectionProblemsetup_systemcode"><code>AdvectionProblem::setup_system()</code></a>
        <li><a href="#codeAdvectionProblemassemble_cellcode"><code>AdvectionProblem::assemble_cell()</code></a><a href="#codeAdvectionProblemassemble_cellcode"><code>AdvectionProblem::assemble_cell()</code></a>
        <li><a href="#codeAdvectionProblemassemble_system_and_multigridcode"><code>AdvectionProblem::assemble_system_and_multigrid()</code></a><a href="#codeAdvectionProblemassemble_system_and_multigridcode"><code>AdvectionProblem::assemble_system_and_multigrid()</code></a>
        <li><a href="#codeAdvectionProblemsetup_smoothercode"><code>AdvectionProblem::setup_smoother()</code></a><a href="#codeAdvectionProblemsetup_smoothercode"><code>AdvectionProblem::setup_smoother()</code></a>
        <li><a href="#codeAdvectionProblemsolvecode"><code>AdvectionProblem::solve()</code></a><a href="#codeAdvectionProblemsolvecode"><code>AdvectionProblem::solve()</code></a>
        <li><a href="#codeAdvectionProblemoutput_resultscode"><code>AdvectionProblem::output_results()</code></a><a href="#codeAdvectionProblemoutput_resultscode"><code>AdvectionProblem::output_results()</code></a>
        <li><a href="#codeAdvectionProblemruncode"><code>AdvectionProblem::run()</code></a><a href="#codeAdvectionProblemruncode"><code>AdvectionProblem::run()</code></a>
      </ul>
        <li><a href="#Thecodemaincodefunction">The <code>main</code> function</a><a href="#Thecodemaincodefunction">The <code>main</code> function</a>
      </ul>
</ol></td><td width="50%" valign="top"><ol>
  <li value="3"> <a href="#Results" class=bold>Results</a><a href="#Results" class=bold>Results</a>
    <ul>
        <li><a href="#GMRESIterationNumbers"> GMRES Iteration Numbers </a><a href="#GMRESIterationNumbers"> GMRES Iteration Numbers </a>
      <ul>
        <li><a href="#DoFCellRenumbering"> DoF/Cell Renumbering </a><a href="#DoFCellRenumbering"> DoF/Cell Renumbering </a>
        <li><a href="#Pointvsblocksmoothers"> Point vs. block smoothers </a><a href="#Pointvsblocksmoothers"> Point vs. block smoothers </a>
      </ul>
        <li><a href="#Cost"> Cost </a><a href="#Cost"> Cost </a>
        <li><a href="#Additionalpoints"> Additional points </a><a href="#Additionalpoints"> Additional points </a>
        <li><a href="#Possibilitiesforextensions"> Possibilities for extensions </a><a href="#Possibilitiesforextensions"> Possibilities for extensions </a>
      <ul>
        <li><a href="#ConstantiterationsforQsub5sub"> Constant iterations for Q<sub>5</sub> </a><a href="#ConstantiterationsforQsub5sub"> Constant iterations for Q<sub>5</sub> </a>
        <li><a href="#Effectivenessofrenumberingforchangingepsilon"> Effectiveness of renumbering for changing epsilon </a><a href="#Effectivenessofrenumberingforchangingepsilon"> Effectiveness of renumbering for changing epsilon </a>
        <li><a href="#Meshadaptivity"> Mesh adaptivity </a><a href="#Meshadaptivity"> Mesh adaptivity </a>
    </ul>
    </ul>
  <li> <a href="#PlainProg" class=bold>The plain program</a><a href="#PlainProg" class=bold>The plain program</a>
</ol> </td> </tr> </table>
 <br  />
 <br  />
 <em>This program was contributed by Thomas C. Clevenger and Timo Heister.</em></p>
<p><em>The creation of this tutorial was partially supported by NSF Award DMS-1522191, DMS-1901529, OAC-1835452, by the Computational Infrastructure in Geodynamics initiative (CIG), through the NSF under Award EAR-0949446 and EAR-1550901 and The University of California</em></p>
<p><em></p><ul>
<li><p class="startli">Davis.  </p><dl class="section note"><dt>Note</dt><dd>If you use this program as a basis for your own work, please consider citing it in your list of references. The initial version of this work was contributed to the deal.II project by the authors listed in the following citation: <a href="https://doi.org/10.5281/zenodo.3382899"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.3382899.svg" alt="10.5281/zenodo.3382899"/></a>  <br  />
 <a class="anchor" id="Intro"></a><a class="anchor" id="Introduction"></a><h1>Introduction</h1>
</dd></dl>
<p class="startli">This program solves an advection-diffusion problem using a geometric multigrid(GMG) preconditioner. The basics of this preconditioner are discussed in <a class="el" href="step_16.html">step-16</a> ;here we discuss the necessary changes needed for a non-symmetricPDE. Additionally, we introduce the idea of block smoothing (as compared topoint smoothing in <a class="el" href="step_16.html">step-16</a> ), and examine the effects of DoF renumbering foradditive and multiplicative smoothers. <a class="anchor" id="Equation"></a></p><h3>Equation</h3>
<p class="startli">The advection-diffusion equation is given by </p><p class="formulaDsp">
\begin{align*} -\varepsilon \Delta u + \boldsymbol{\beta}\cdot \nabla u &amp; = f &amp; \text{ in } \Omega\\ u &amp;= g &amp; \text{ on } \partial\Omega \end{align*}
</p>
<p> where \(\varepsilon&gt;0\) , \(\boldsymbol{\beta}\) is the <em>advection direction</em>, and \(f\) is a source. A few notes:</p><ol type="1">
<li>If \(\boldsymbol{\beta}=\boldsymbol{0}\) , this is the Laplace equation solved in <a class="el" href="step_16.html">step-16</a> (and many other places).</li>
<li>If \(\varepsilon=0\) then this is the stationary advection equation solved in <a class="el" href="step_9.html">step-9</a> .</li>
<li>One can define a dimensionless number for this problem, called the<em>Peclet number</em>: \(\mathcal{P} \dealcoloneq \frac{\|\boldsymbol{\beta}\| L}{\varepsilon}\) , where \(L\) is the length scale of the domain. Itcharacterizes the kind of equation we areconsidering: If \(\mathcal{P}&gt;1\) , we say the problem is<em>advection-dominated</em>, else if \(\mathcal{P}&lt;1\) we will say the problem is<em>diffusion-dominated</em>. For the discussion in this tutorial we will be concerned withadvection-dominated flow. This is the complicated case: We know thatfor diffusion-dominated problems, the standard Galerkin method worksjust fine, and we also know that simple multigrid methods such asthose defined in <a class="el" href="step_16.html">step-16</a> are very efficient. On the other hand, foradvection-dominated problems, the standard Galerkin approach leads tooscillatory and unstable discretizations, and simple solvers are oftennot very efficient. This tutorial program is therefore intended toaddress both of these issues.</li>
</ol>
<p class="startli"><a class="anchor" id="Streamlinediffusion"></a></p><h4>Streamline diffusion</h4>
<p class="startli">Using the standard Galerkin finite element method, for suitable testfunctions \(v_h\) , a discrete weak form of the PDE would read </p><p class="formulaDsp">
\begin{align*} a(u_h,v_h) = F(v_h) \end{align*}
</p>
<p> where </p><p class="formulaDsp">
\begin{align*} a(u_h,v_h) &amp;= (\varepsilon \nabla v_h,\, \nabla u_h) + (v_h,\,\boldsymbol{\beta}\cdot \nabla u_h),\\ F(v_h) &amp;= (v_h,\,f). \end{align*}
</p>
<p class="startli">Unfortunately, one typically gets oscillatory solutions with thisapproach. Indeed, the following error estimate can be shown for thisformulation: </p><p class="formulaDsp">
\begin{align*} \|\nabla (u-u_h)\| \leq (1+\mathcal{P}) \inf_{v_h} \|\nabla (u-v_h)\|. \end{align*}
</p>
<p> The infimum on the right can be estimated as follows if the exactsolution is sufficiently smooth: </p><p class="formulaDsp">
\begin{align*} \inf_{v_h} \|\nabla (u-v_h)\|. \le \|\nabla (u-I_h u)\| \le h^k C \|\nabla^k u)\| \end{align*}
</p>
<p> where \(k\) is the polynomial degree of the finite elements used. As aconsequence, we obtain the estimate </p><p class="formulaDsp">
\begin{align*} \|\nabla (u-u_h)\| \leq (1+\mathcal{P}) C h^k \|\nabla^k u)\|. \end{align*}
</p>
<p> In other words, the numerical solution will converge. On the other hand,given the definition of \(\mathcal{P}\) above, we have to expect poornumerical solutions with a large error when \(\varepsilon \ll \|\boldsymbol{\beta}\| L\) , i.e., if the problem has only a smallamount of diffusion. To combat this, we will consider the new weak form </p><p class="formulaDsp">
\begin{align*} a(u_h,\,v_h) + \sum_K (-\varepsilon \Delta u_h + \boldsymbol{\beta}\cdot \nabla u_h-f,\,\delta_K \boldsymbol{\beta}\cdot \nabla v_h)_K = F(v_h) \end{align*}
</p>
<p> where the sum is done over all cells \(K\) with the inner product takenfor each cell, and \(\delta_K\) is a cell-wise constantstabilization parameter defined in <b>[john2006discontinuity]</b> . Essentially, adding in thediscrete strong form residual enhances the coercivity of the bilinearform \(a(\cdot,\cdot)\) which increases the stability of the discretesolution. This method is commonly referred to as <em>streamline diffusion</em> or <em>SUPG</em> (streamline upwind/Petrov-Galerkin).</p>
<p class="startli"><a class="anchor" id="Smoothers"></a></p><h3>Smoothers</h3>
<p class="startli">One of the goals of this tutorial is to expand from using a simple(point-wise) Gauss-Seidel (SOR) smoother that is used in <a class="el" href="step_16.html">step-16</a> (class <a class="el" href="classPreconditionSOR.html">PreconditionSOR</a>) on each level of the multigrid hierarchy.The term "point-wise" is traditionally used in solvers to indicate that onesolves at one "grid point" at a time; for scalar problems, this meansto use a solver that updates one unknown of the linearsystem at a time, keeping all of the others fixed; one would theniterate over all unknowns in the problem and, once done, start over againfrom the first unknown until these "sweeps" converge. Jacobi,Gauss-Seidel, and SOR iterations can all be interpreted in this way.In the context of multigrid, one does not think of these methods as"solvers", but as "smoothers". As such, one is not interested inactually solving the linear system. It is enough to remove the high-frequencypart of the residual for the multigrid method to work, because that allowsrestricting the solution to a coarser mesh. Therefore, one only does a few,fixed number of "sweeps" over all unknowns. In the code in thistutorial this is controlled by the "Smoothing steps" parameter. But these methods are known to converge rather slowly when used assolvers. While as multigrid smoothers, they are surprisingly good,they can also be improved upon. In particular, we consider"cell-based" smoothers here as well. These methods solve for allunknowns on a cell at once, keeping all other unknowns fixed; theythen move on to the next cell, and so on and so forth. One can thinkof them as "block" versions of Jacobi, Gauss-Seidel, or SOR, butbecause degrees of freedom are shared among multiple cells, theseblocks overlap and the methods are in factbest be explained within the framework of additive and multiplicativeSchwarz methods. In contrast to <a class="el" href="step_16.html">step-16</a> , our test problem contains an advectiveterm. Especially with a small diffusion constant \(\varepsilon\) , information istransported along streamlines in the given advection direction. This meansthat smoothers are likely to be more effective if they allow information totravel in downstream direction within a single smootherapplication. If we want to solve one unknown (or block of unknowns) ata time in the order in which these unknowns (or blocks) areenumerated, then this information propagation propertyrequires reordering degrees of freedom or cells (for the cell-based smoothers)accordingly so that the ones further upstream are treated earlier(have lower indices) and those further downstream are treated later(have larger indices). The influence of the ordering will be visiblein the results section. Let us now briefly define the smoothers used in this tutorial.For a more detailed introduction, we refer to <b>[KanschatNotesIterative]</b> and the books <b>[smith2004domain]</b> and <b>[toselli2006domain]</b> .A Schwarzpreconditioner requires a decomposition </p><p class="formulaDsp">
\begin{align*} V = \sum_{j=1}^J V_j \end{align*}
</p>
<p> of our finite element space \(V\) . Each subproblem \(V_j\) also has a Ritzprojection \(P_j: V \rightarrow V_j\) based on the bilinear form \(a(\cdot,\cdot)\) . This projection induces a local operator \(A_j\) for eachsubproblem \(V_j\) . If \(\Pi_j:V\rightarrow V_j\) is the orthogonal projector onto \(V_j\) , one can show \(A_jP_j=\Pi_j^TA\) . With this we can define an <em>additive Schwarz preconditioner</em> for theoperator \(A\) as </p><p class="formulaDsp">
\begin{align*} B^{-1} = \sum_{j=1}^J P_j A^{-1} = \sum_{j=1}^J A_j^{-1} \Pi_j^T. \end{align*}
</p>
<p> In other words, we project our solution into each subproblem, apply theinverse of the subproblem \(A_j\) , and sum the contributions up over all \(j\) . Note that one can interpret the point-wise (one unknown at a time)Jacobi method as an additiveSchwarz method by defining a subproblem \(V_j\) for each degree offreedom. Then, \(A_j^{-1}\) becomes a multiplication with the inverse of adiagonal entry of \(A\) . For the "Block Jacobi" method used in this tutorial, we define a subproblem \(V_j\) for each cell of the mesh on the current level. Note that we use acontinuous finite element, so these blocks are overlapping, as degrees offreedom on an interface between two cells belong to both subproblems. Thelogic for the Schwarz operator operating on the subproblems (in deal.II theyare called "blocks") is implemented in the class <a class="el" href="classRelaxationBlock.html">RelaxationBlock</a>. The "BlockJacobi" method is implemented in the class <a class="el" href="classRelaxationBlockJacobi.html">RelaxationBlockJacobi</a>. Manyaspects of the class (for example how the blocks are defined and how to invertthe local subproblems \(A_j\) ) can be configured in the smoother data, see <a class="el" href="classRelaxationBlock_1_1AdditionalData.html">RelaxationBlock::AdditionalData</a> and <a class="el" href="namespaceDoFTools.html#a43ee44769769065bc594d1730477a4b9">DoFTools::make_cell_patches()</a> for details. So far, we discussed additive smoothers where the updates can be appliedindependently and there is no information flowing within a single smootherapplication. A <em>multiplicative Schwarz preconditioner</em> addresses thisand is defined by </p><p class="formulaDsp">
\begin{align*} B^{-1} = \left( I- \prod_{j=1}^J \left(I-P_j\right) \right) A^{-1}. \end{align*}
</p>
<p> In contrast to above, the updates on the subproblems \(V_j\) are appliedsequentially. This means that the update obtained when inverting thesubproblem \(A_j\) is immediately used in \(A_{j+1}\) . This becomesvisible when writing out the project: </p><p class="formulaDsp">
\begin{align*} B^{-1} = \left( I - \left(I-P_1\right)\left(I-P_2\right)\cdots\left(I-P_J\right) \right) A^{-1} = A^{-1} - \left[ \left(I-P_1\right) \left[ \left(I-P_2\right)\cdots \left[\left(I-P_J\right) A^{-1}\right] \cdots \right] \right] \end{align*}
</p>
<p class="startli">When defining the sub-spaces \(V_j\) as whole blocks of degrees offreedom, this method is implemented in the class <a class="el" href="classRelaxationBlockSOR.html">RelaxationBlockSOR</a> and used when youselect "Block SOR" in this tutorial. The class <a class="el" href="classRelaxationBlockSOR.html">RelaxationBlockSOR</a> is alsoderived from <a class="el" href="classRelaxationBlock.html">RelaxationBlock</a>. As such, both additive and multiplicativeSchwarz methods are implemented in a unified framework. Finally, let us note that the standard Gauss-Seidel (or SOR) method can beseen as a multiplicative Schwarz method with a subproblem for each DoF.</p>
<p class="startli"><a class="anchor" id="Testproblem"></a></p><h3>Test problem</h3>
<p class="startli">We will be considering the following test problem: \(\Omega = [-1,\,1]\times[-1,\,1]\backslash B_{0.3}(0)\) , i.e., a squarewith a circle of radius 0.3 centered at theorigin removed. In addition, we use \(\varepsilon=0.005\) , \(\boldsymbol{\beta} = [-\sin(\pi/6),\,\cos(\pi/6)]\) , \(f=0\) , and Dirichlet boundary values </p><p class="formulaDsp">
\begin{align*} g = \left\{\begin{array}{ll} 1 &amp; \text{if } x=-1 \text{ or } y=-1,\,x\geq 0.5 \\ 0 &amp; \text{otherwise} \end{array}\right. \end{align*}
</p>
<p class="startli">The following figures depict the solutions with (left) and without(right) streamline diffusion. Without streamline diffusion we see largeoscillations around the boundary layer, demonstrating the instabilityof the standard Galerkin finite element method for this problem. </p><table width="60%" align="center">
<tr>
<td align="center"><img src="https://www.dealii.org/images/steps/developer/step-63-solution.png" alt="" class="inline"/>  </td><td align="center"><img src="https://www.dealii.org/images/steps/developer/step-63-solution-no-sd.png" alt="" class="inline"/>   </td></tr>
</table>
<p><br  />
</p>
<p class="startli"><a class="anchor" id="CommProg"></a> </p><h1>The commented program</h1>
<p class="startli"><a class="anchor" id="Includefiles"></a> </p><h3>Include files</h3>
<p class="startli">Typical files needed for standard deal.II:</p>
</li>
</ul>
<p></em></p>
<p><em></p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2tensor__function_8h.html">deal.II/base/tensor_function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2timer_8h.html">deal.II/base/timer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2parameter__handler_8h.html">deal.II/base/parameter_handler.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2vector_8h.html">deal.II/lac/vector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2full__matrix_8h.html">deal.II/lac/full_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2sparse__matrix_8h.html">deal.II/lac/sparse_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2solver__gmres_8h.html">deal.II/lac/solver_gmres.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2precondition_8h.html">deal.II/lac/precondition.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2relaxation__block_8h.html">deal.II/lac/relaxation_block.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__refinement_8h.html">deal.II/grid/grid_refinement.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2manifold__lib_8h.html">deal.II/grid/manifold_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__out_8h.html">deal.II/grid/grid_out.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__renumbering_8h.html">deal.II/dofs/dof_renumbering.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2mapping__q_8h.html">deal.II/fe/mapping_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__values_8h.html">deal.II/fe/fe_values.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2matrix__tools_8h.html">deal.II/numerics/matrix_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
</div><!-- fragment --><p></em></p>
<p><em> Include all relevant multilevel files:</em></p>
<p><em></p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__constrained__dofs_8h.html">deal.II/multigrid/mg_constrained_dofs.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2multigrid_8h.html">deal.II/multigrid/multigrid.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__transfer_8h.html">deal.II/multigrid/mg_transfer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__tools_8h.html">deal.II/multigrid/mg_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__coarse_8h.html">deal.II/multigrid/mg_coarse.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__smoother_8h.html">deal.II/multigrid/mg_smoother.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__matrix_8h.html">deal.II/multigrid/mg_matrix.h</a>&gt;</span></div>
</div><!-- fragment --><p></em></p>
<p><em> C++:</em></p>
<p><em></p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;random&gt;</span></div>
</div><!-- fragment --><p></em></p>
<p><em> We will be using <a class="el" href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop</a> functionality for assembling matrices:</em></p>
<p><em></p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="meshworker_2mesh__loop_8h.html">deal.II/meshworker/mesh_loop.h</a>&gt;</span></div>
</div><!-- fragment --><p></em></p>
<p><em> <a class="anchor" id="MeshWorkerdata"></a> </p><h3><a class="el" href="namespaceMeshWorker.html">MeshWorker</a> data</h3>
<p></em></p>
<p><em></em></p>
<p><em> As always, we will be putting everything related to this program into a namespace of its own.</em></p>
<p><em> Since we will be using the <a class="el" href="namespaceMeshWorker.html">MeshWorker</a> framework, the first step is to define the following structures needed by the assemble_cell() function used by <a class="el" href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop()</a>: <code><a class="el" href="structScratchData.html">ScratchData</a></code> contains an <a class="el" href="classFEValues.html">FEValues</a> object which is needed for assembling a cell's local contribution, while <code><a class="el" href="structCopyData.html">CopyData</a></code> contains the output from a cell's local contribution and necessary information to copy that to the global system. (Their purpose is also explained in the documentation of the <a class="el" href="namespaceWorkStream.html">WorkStream</a> class.)</em></p>
<p><em></p><div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceStep63.html">Step63</a></div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">struct </span><a class="code" href="structScratchData.html">ScratchData</a></div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="work__stream__0_8txt.html#a8f80058531659e3e5ae0f7e91a963519">ScratchData</a>(<span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        quadrature_degree)</div>
<div class="line">      : fe_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                  <a class="code" href="classQGauss.html">QGauss</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;(quadrature_degree),</div>
<div class="line">                  <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa378cbcddbdf54fb3f9f0acf47b1c4719">update_hessians</a> |</div>
<div class="line">                    <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="work__stream__0_8txt.html#a8f80058531659e3e5ae0f7e91a963519">ScratchData</a>(<span class="keyword">const</span> <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a> &amp;scratch_data)</div>
<div class="line">      : fe_values(scratch_data.fe_values.get_fe(),</div>
<div class="line">                  scratch_data.fe_values.get_quadrature(),</div>
<div class="line">                  <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa378cbcddbdf54fb3f9f0acf47b1c4719">update_hessians</a> |</div>
<div class="line">                    <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">struct </span><a class="code" href="structCopyData.html">CopyData</a></div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="structCopyData.html">CopyData</a>() = <span class="keywordflow">default</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a>                   <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a>;</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a>                       cell_rhs;</div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; <a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>;</div>
<div class="line">  };</div>
</div><!-- fragment --><p></em></p>
<p><em> <a class="anchor" id="Problemparameters"></a> </p><h3>Problem parameters</h3>
<p></em></p>
<p><em></em></p>
<p><em> The second step is to define the classes that deal with run-time parameters to be read from an input file. <br  />
 We will use <a class="el" href="classParameterHandler.html">ParameterHandler</a> to pass in parameters at runtime. The structure <code><a class="el" href="structSettings.html">Settings</a></code> parses and stores the parameters to be queried throughout the program.</em></p>
<p><em></p><div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="structSettings.html">Settings</a></div>
<div class="line">{</div>
<div class="line">  <span class="keyword">enum</span> DoFRenumberingStrategy</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1acc6b05c836e9f74fb7ab9390ffc26f1c">none</a>,</div>
<div class="line">    <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">downstream</a>,</div>
<div class="line">    upstream,</div>
<div class="line">    <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">random</a></div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> get_parameters(<span class="keyword">const</span> std::string &amp;prm_filename);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span>                 <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa6fff35c961658bfea21e8a3ae468cec">epsilon</a>;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>           <a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>;</div>
<div class="line">  std::string            smoother_type;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>           smoothing_steps;</div>
<div class="line">  DoFRenumberingStrategy dof_renumbering;</div>
<div class="line">  <span class="keywordtype">bool</span>                   with_streamline_diffusion;</div>
<div class="line">  <span class="keywordtype">bool</span>                   <a class="code" href="structSettings.html#a4594afbef1241352404073ba65f20a97">output</a>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Settings::get_parameters(<span class="keyword">const</span> std::string &amp;prm_filename)</div>
<div class="line">{</div>
<div class="line">   <span class="comment">/* First declare the parameters... */</span> </div>
<div class="line">  <a class="code" href="classParameterHandler.html">ParameterHandler</a> prm;</div>
<div class="line"> </div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Epsilon&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;0.005&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0),</div>
<div class="line">                    <span class="stringliteral">&quot;Diffusion parameter&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Fe degree&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;1&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(1),</div>
<div class="line">                    <span class="stringliteral">&quot;Finite Element degree&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Smoother type&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;block SOR&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;SOR|Jacobi|block SOR|block Jacobi&quot;</span>),</div>
<div class="line">                    <span class="stringliteral">&quot;Select smoother: SOR|Jacobi|block SOR|block Jacobi&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Smoothing steps&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(1),</div>
<div class="line">                    <span class="stringliteral">&quot;Number of smoothing steps&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(</div>
<div class="line">    <span class="stringliteral">&quot;DoF renumbering&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;downstream&quot;</span>,</div>
<div class="line">    <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;none|downstream|upstream|random&quot;</span>),</div>
<div class="line">    <span class="stringliteral">&quot;Select DoF renumbering: none|downstream|upstream|random&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;With streamline diffusion&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                    <span class="stringliteral">&quot;Enable streamline diffusion stabilization: true|false&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Output&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                    <span class="stringliteral">&quot;Generate graphical output: true|false&quot;</span>);</div>
<div class="line"> </div>
<div class="line">   <span class="comment">/* ...and then try to read their values from the input file: */</span> </div>
<div class="line">  <span class="keywordflow">if</span> (prm_filename.empty())</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a4ac3a8b19ade16e96e8ea25906daf23a">print_parameters</a>(std::cout, <a class="code" href="group__Exceptions.html#ga8364dda711b93753c6809eefe2a8e827a3a1480568c2713f53dcb21319bb28093">ParameterHandler::Text</a>);</div>
<div class="line">      <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(</div>
<div class="line">        <span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;Please pass a .prm file as the first argument!&quot;</span>));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">parse_input</a>(prm_filename);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa6fff35c961658bfea21e8a3ae468cec">epsilon</a>         = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Epsilon&quot;</span>);</div>
<div class="line">  <a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>       = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Fe degree&quot;</span>);</div>
<div class="line">  smoother_type   = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;Smoother type&quot;</span>);</div>
<div class="line">  smoothing_steps = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Smoothing steps&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> std::string <a class="code" href="fe__q__base__0_8txt.html#ac01155b6a1d9bf8e09c14f9a454cdfea">renumbering</a> = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;DoF renumbering&quot;</span>);</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="fe__q__base__0_8txt.html#ac01155b6a1d9bf8e09c14f9a454cdfea">renumbering</a> == <span class="stringliteral">&quot;none&quot;</span>)</div>
<div class="line">    dof_renumbering = <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1acc6b05c836e9f74fb7ab9390ffc26f1c">DoFRenumberingStrategy::none</a>;</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="fe__q__base__0_8txt.html#ac01155b6a1d9bf8e09c14f9a454cdfea">renumbering</a> == <span class="stringliteral">&quot;downstream&quot;</span>)</div>
<div class="line">    dof_renumbering = <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">DoFRenumberingStrategy::downstream</a>;</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="fe__q__base__0_8txt.html#ac01155b6a1d9bf8e09c14f9a454cdfea">renumbering</a> == <span class="stringliteral">&quot;upstream&quot;</span>)</div>
<div class="line">    dof_renumbering = DoFRenumberingStrategy::upstream;</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="fe__q__base__0_8txt.html#ac01155b6a1d9bf8e09c14f9a454cdfea">renumbering</a> == <span class="stringliteral">&quot;random&quot;</span>)</div>
<div class="line">    dof_renumbering = <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">DoFRenumberingStrategy::random</a>;</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>,</div>
<div class="line">                <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;The &lt;DoF renumbering&gt; parameter has &quot;</span></div>
<div class="line">                           <span class="stringliteral">&quot;an invalid value.&quot;</span>));</div>
<div class="line"> </div>
<div class="line">  with_streamline_diffusion = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;With streamline diffusion&quot;</span>);</div>
<div class="line">  <a class="code" href="structSettings.html#a4594afbef1241352404073ba65f20a97">output</a>                    = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;Output&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p></em></p>
<p><em> <a class="anchor" id="Cellpermutations"></a> </p><h3>Cell permutations</h3>
<p></em></p>
<p><em> <br  />
 The ordering in which cells and degrees of freedom are traversed will play a role in the speed of convergence for multiplicative methods. Here we define functions which return a specific ordering of cells to be used by the block smoothers. <br  />
 For each type of cell ordering, we define a function for the active mesh and one for a level mesh (i.e., for the cells at one level of a multigrid hierarchy). While the only reordering necessary for solving the system will be on the level meshes, we include the active reordering for visualization purposes in output_results(). <br  />
 For the two downstream ordering functions, we first create an array with all of the relevant cells that we then sort in downstream direction using a "comparator" object. The output of the functions is then simply an array of the indices of the cells in the just computed order.</em></p>
<p><em></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">std::vector&lt;unsigned int&gt;</div>
<div class="line"><a class="code" href="namespaceStep63.html#a679f6c35915713a90230f261b38f041e">create_downstream_cell_ordering</a>(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div>
<div class="line">                                <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a>   <a class="code" href="dofs__0_8txt.html#ae704d52abb496c815f42849c4de0f458">direction</a>,</div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>     <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">{</div>
<div class="line">  std::vector&lt;typename DoFHandler&lt;dim&gt;::level_cell_iterator&gt; ordered_cells;</div>
<div class="line">  ordered_cells.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().<a class="code" href="classTriangulation.html#abea687f123f3f5a8b09d7485cf03be72">n_cells</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#ga8c046284df67198c2d82c25950ea1ea3">cell_iterators_on_level</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>))</div>
<div class="line">    ordered_cells.push_back(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> DoFRenumbering::</div>
<div class="line">    CompareDownstream&lt;typename DoFHandler&lt;dim&gt;::level_cell_iterator, <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;</div>
<div class="line">      comparator(<a class="code" href="dofs__0_8txt.html#ae704d52abb496c815f42849c4de0f458">direction</a>);</div>
<div class="line">  std::sort(ordered_cells.begin(), ordered_cells.end(), comparator);</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;unsigned&gt; ordered_indices;</div>
<div class="line">  ordered_indices.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().<a class="code" href="classTriangulation.html#abea687f123f3f5a8b09d7485cf03be72">n_cells</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : ordered_cells)</div>
<div class="line">    ordered_indices.push_back(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;index());</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> ordered_indices;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">std::vector&lt;unsigned int&gt;</div>
<div class="line"><a class="code" href="namespaceStep63.html#a679f6c35915713a90230f261b38f041e">create_downstream_cell_ordering</a>(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div>
<div class="line">                                <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a>   <a class="code" href="dofs__0_8txt.html#ae704d52abb496c815f42849c4de0f458">direction</a>)</div>
<div class="line">{</div>
<div class="line">  std::vector&lt;typename DoFHandler&lt;dim&gt;::active_cell_iterator&gt; ordered_cells;</div>
<div class="line">  ordered_cells.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().<a class="code" href="classTriangulation.html#a5ea5c9957dbb566a562bbe2c0f3971e9">n_active_cells</a>());</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">    ordered_cells.push_back(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> DoFRenumbering::</div>
<div class="line">    CompareDownstream&lt;typename DoFHandler&lt;dim&gt;::active_cell_iterator, <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;</div>
<div class="line">      comparator(<a class="code" href="dofs__0_8txt.html#ae704d52abb496c815f42849c4de0f458">direction</a>);</div>
<div class="line">  std::sort(ordered_cells.begin(), ordered_cells.end(), comparator);</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;unsigned int&gt; ordered_indices;</div>
<div class="line">  ordered_indices.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().<a class="code" href="classTriangulation.html#a5ea5c9957dbb566a562bbe2c0f3971e9">n_active_cells</a>());</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : ordered_cells)</div>
<div class="line">    ordered_indices.push_back(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;index());</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> ordered_indices;</div>
<div class="line">}</div>
</div><!-- fragment --><p></em></p>
<p><em> The functions that produce a random ordering are similar in spirit in that they first put information about all cells into an array. But then, instead of sorting them, they shuffle the elements randomly using the facilities C++ offers to generate random numbers. The way this is done is by iterating over all elements of the array, drawing a random number for another element before that, and then exchanging these elements. The result is a random shuffle of the elements of the array.</em></p>
<p><em></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">std::vector&lt;unsigned int&gt;</div>
<div class="line"><a class="code" href="namespaceStep63.html#a5bcdd1e04c358777541a2922f8803db4">create_random_cell_ordering</a>(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>     <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">{</div>
<div class="line">  std::vector&lt;unsigned int&gt; ordered_cells;</div>
<div class="line">  ordered_cells.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().<a class="code" href="classTriangulation.html#abea687f123f3f5a8b09d7485cf03be72">n_cells</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#ga8c046284df67198c2d82c25950ea1ea3">cell_iterators_on_level</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>))</div>
<div class="line">    ordered_cells.push_back(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;index());</div>
<div class="line"> </div>
<div class="line">  std::mt19937 random_number_generator;</div>
<div class="line">  std::shuffle(ordered_cells.begin(),</div>
<div class="line">               ordered_cells.end(),</div>
<div class="line">               random_number_generator);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> ordered_cells;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">std::vector&lt;unsigned int&gt;</div>
<div class="line"><a class="code" href="namespaceStep63.html#a5bcdd1e04c358777541a2922f8803db4">create_random_cell_ordering</a>(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler)</div>
<div class="line">{</div>
<div class="line">  std::vector&lt;unsigned int&gt; ordered_cells;</div>
<div class="line">  ordered_cells.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().<a class="code" href="classTriangulation.html#a5ea5c9957dbb566a562bbe2c0f3971e9">n_active_cells</a>());</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">    ordered_cells.push_back(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;index());</div>
<div class="line"> </div>
<div class="line">  std::mt19937 random_number_generator;</div>
<div class="line">  std::shuffle(ordered_cells.begin(),</div>
<div class="line">               ordered_cells.end(),</div>
<div class="line">               random_number_generator);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> ordered_cells;</div>
<div class="line">}</div>
</div><!-- fragment --><p></em></p>
<p><em> <a class="anchor" id="Righthandsideandboundaryvalues"></a> </p><h3>Right-hand side and boundary values</h3>
<p></em></p>
<p><em></em></p>
<p><em> The problem solved in this tutorial is an adaptation of Ex. 3.1.3 found on pg. 118 of <a href="https://global.oup.com/academic/product/finite-elements-and-fast-iterative-solvers-9780199678808">Finite Elements and Fast Iterative Solvers: with Applications in Incompressible Fluid Dynamics by Elman, Silvester, and Wathen</a>. The main difference being that we add a hole in the center of our domain with zero Dirichlet boundary conditions. <br  />
 For a complete description, we need classes that implement the zero right-hand side first (we could of course have just used <a class="el" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction</a>): <br  />
</em></p>
<p><em></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span><a class="code" href="classRightHandSide.html">RightHandSide</a> : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="classRightHandSide.html#a07b87d7025c7c5feca044c5c7d4296ef">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; <a class="code" href="parsed__convergence__table__0_8txt.html#a8a90f5ba57a42a3fd4c067e00f8b8aea">p</a>,</div>
<div class="line">                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a> = 0) <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classFunction.html#a562fc1114e95e702e6696721f71528db">value_list</a>(<span class="keyword">const</span> <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;<a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>,</div>
<div class="line">                          std::vector&lt;double&gt; &amp;          <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>,</div>
<div class="line">                          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a> = 0) <span class="keyword">const override</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">double</span> <a class="code" href="classRightHandSide.html#a07b87d7025c7c5feca044c5c7d4296ef">RightHandSide&lt;dim&gt;::value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp;,</div>
<div class="line">                                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a> == 0, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>, 0, 1));</div>
<div class="line">  (void)<a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0.0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classFunction.html#a562fc1114e95e702e6696721f71528db">RightHandSide&lt;dim&gt;::value_list</a>(<span class="keyword">const</span> <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;<a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>,</div>
<div class="line">                                    std::vector&lt;double&gt; &amp;          <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>,</div>
<div class="line">                                    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>.size() == <a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>.size(),</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga6060b2304b8600f5efa0d31eeda0207d">ExcDimensionMismatch</a>(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>.size(), <a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>.size()));</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>.size(); ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">    <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] = <a class="code" href="classRightHandSide.html">RightHandSide&lt;dim&gt;::value</a>(<a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>], <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>);</div>
<div class="line">}</div>
</div><!-- fragment --><p></em></p>
<p><em> We also have Dirichlet boundary conditions. On a connected portion of the outer, square boundary we set the value to 1, and we set the value to 0 everywhere else (including the inner, circular boundary):</em></p>
<p><em></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span><a class="code" href="classBoundaryValues.html">BoundaryValues</a> : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="classBoundaryValues.html#a45af33d412a06517009ba6f342340256">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; <a class="code" href="parsed__convergence__table__0_8txt.html#a8a90f5ba57a42a3fd4c067e00f8b8aea">p</a>,</div>
<div class="line">                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a> = 0) <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classFunction.html#a562fc1114e95e702e6696721f71528db">value_list</a>(<span class="keyword">const</span> <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;<a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>,</div>
<div class="line">                          std::vector&lt;double&gt; &amp;          <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>,</div>
<div class="line">                          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a> = 0) <span class="keyword">const override</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">double</span> <a class="code" href="classBoundaryValues.html#a45af33d412a06517009ba6f342340256">BoundaryValues&lt;dim&gt;::value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; <a class="code" href="parsed__convergence__table__0_8txt.html#a8a90f5ba57a42a3fd4c067e00f8b8aea">p</a>,</div>
<div class="line">                                  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a> == 0, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>, 0, 1));</div>
<div class="line">  (void)<a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>;</div>
</div><!-- fragment --><p></em></p>
<p><em> Set boundary to 1 if \(x=1\) , or if \(x&gt;0.5\) and \(y=-1\) .</em></p>
<p><em></p><div class="fragment"><div class="line">     <span class="keywordflow">if</span> (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(<a class="code" href="parsed__convergence__table__0_8txt.html#a8a90f5ba57a42a3fd4c067e00f8b8aea">p</a>[0]</div>
<div class="line">  </div>
<div class="line">- 1) &lt; 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-8 ||</div>
<div class="line">         (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(<a class="code" href="parsed__convergence__table__0_8txt.html#a8a90f5ba57a42a3fd4c067e00f8b8aea">p</a>[1] + 1) &lt; 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-8 &amp;&amp; <a class="code" href="parsed__convergence__table__0_8txt.html#a8a90f5ba57a42a3fd4c067e00f8b8aea">p</a>[0] &gt;= 0.5))</div>
<div class="line">       {</div>
<div class="line">         <span class="keywordflow">return</span> 1.0;</div>
<div class="line">       }</div>
<div class="line">     <span class="keywordflow">else</span></div>
<div class="line">       {</div>
<div class="line">         <span class="keywordflow">return</span> 0.0;</div>
<div class="line">       }</div>
<div class="line">   }</div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">   <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">   <span class="keywordtype">void</span> <a class="code" href="classFunction.html#a562fc1114e95e702e6696721f71528db">BoundaryValues&lt;dim&gt;::value_list</a>(<span class="keyword">const</span> <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;<a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>,</div>
<div class="line">                                        std::vector&lt;double&gt; &amp;          <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>,</div>
<div class="line">                                        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">   </span>{</div>
<div class="line">     <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>.size() == <a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>.size(),</div>
<div class="line">            <a class="code" href="group__Exceptions.html#ga6060b2304b8600f5efa0d31eeda0207d">ExcDimensionMismatch</a>(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>.size(), <a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>.size()));</div>
<div class="line">  </div>
<div class="line">     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>.size(); ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">       <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] = <a class="code" href="classBoundaryValues.html">BoundaryValues&lt;dim&gt;::value</a>(<a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>], <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>);</div>
<div class="line">   }</div>
</div><!-- fragment --><p></em></p>
<p><em> <a class="anchor" id="Streamlinediffusionimplementation"></a> </p><h3>Streamline diffusion implementation</h3>
<p></em></p>
<p><em></em></p>
<p><em> The streamline diffusion method has a stabilization constant that we need to be able to compute. The choice of how this parameter is computed is taken from <a href="https://link.springer.com/chapter/10.1007/978-3-540-34288-5_27">On Discontinuity-Capturing Methods for Convection-Diffusion Equations by Volker John and Petr Knobloch</a>.</em></p>
<p><em></p><div class="fragment"><div class="line">   <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">   <span class="keywordtype">double</span> <a class="code" href="namespaceStep63.html#abe37f2d8c4bdc6c9dc4255f0a778aeec">compute_stabilization_delta</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>         hk,</div>
<div class="line">                                      <span class="keyword">const</span> <span class="keywordtype">double</span>         <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1ab87bd17d3acf6932f7bb6927f58fe3cd">eps</a>,</div>
<div class="line">                                      <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> dir,</div>
<div class="line">                                      <span class="keyword">const</span> <span class="keywordtype">double</span>         pk)</div>
<div class="line">   {</div>
<div class="line">     <span class="keyword">const</span> <span class="keywordtype">double</span> Peclet = dir.<a class="code" href="classTensor.html#afd0934b4edd71063f66a9c67540e79fc">norm</a>() hk / (2.0 <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1ab87bd17d3acf6932f7bb6927f58fe3cd">eps</a> pk);</div>
<div class="line">     <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespaceDifferentiation_1_1SD.html#a66e76f1c4fdb9a31f4fabef8abee5f28">coth</a> =</div>
<div class="line">       (1.0 + <a class="code" href="base_2vectorization_8h.html#a19f846bda83b7e3f4531daacb40c64e1">std::exp</a>(-2.0 Peclet)) / (1.0</div>
<div class="line">  </div>
<div class="line">- std::exp(-2.0 Peclet));</div>
<div class="line">  </div>
<div class="line">     <span class="keywordflow">return</span> hk / (2.0 dir.<a class="code" href="classTensor.html#afd0934b4edd71063f66a9c67540e79fc">norm</a>() pk) (<a class="code" href="namespaceDifferentiation_1_1SD.html#a66e76f1c4fdb9a31f4fabef8abee5f28">coth</a></div>
<div class="line">  </div>
<div class="line">- 1.0 / Peclet);</div>
<div class="line">   }</div>
</div><!-- fragment --><p></em></p>
<p><em> <a class="anchor" id="codeAdvectionProlemcodeclass"></a> </p><h3><code>AdvectionProlem</code> class</h3>
<p></em></p>
<p><em></em></p>
<p><em> This is the main class of the program, and should look very similar to <a class="el" href="step_16.html">step-16</a> . The major difference is that, since we are defining our multigrid smoother at runtime, we choose to define a function <code>create_smoother()</code> and a class object <code>mg_smoother</code> which is a <code>std::unique_ptr</code> to a smoother that is derived from <a class="el" href="classMGSmoother.html">MGSmoother</a>. Note that for smoothers derived from <a class="el" href="classRelaxationBlock.html">RelaxationBlock</a>, we must include a <code>smoother_data</code> object for each level. This will contain information about the cell ordering and the method of inverting cell matrices.</em></p>
<p><em></p><div class="fragment"><div class="line">   <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">   <span class="keyword">class </span>AdvectionProblem</div>
<div class="line">   {</div>
<div class="line">   <span class="keyword">public</span>:</div>
<div class="line">     AdvectionProblem(<span class="keyword">const</span> <a class="code" href="structSettings.html">Settings</a> &amp;<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>);</div>
<div class="line">     <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">run</a>();</div>
<div class="line">  </div>
<div class="line">   <span class="keyword">private</span>:</div>
<div class="line">     <span class="keywordtype">void</span> setup_system();</div>
<div class="line">  </div>
<div class="line">     <span class="keyword">template</span> &lt;<span class="keyword">class</span> IteratorType&gt;</div>
<div class="line">     <span class="keywordtype">void</span> assemble_cell(<span class="keyword">const</span> IteratorType &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>,</div>
<div class="line">                        <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a> &amp;  scratch_data,</div>
<div class="line">                        <a class="code" href="structCopyData.html">CopyData</a> &amp;          copy_data);</div>
<div class="line">     <span class="keywordtype">void</span> assemble_system_and_multigrid();</div>
<div class="line">  </div>
<div class="line">     <span class="keywordtype">void</span> setup_smoother();</div>
<div class="line">  </div>
<div class="line">     <span class="keywordtype">void</span> <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>();</div>
<div class="line">     <span class="keywordtype">void</span> refine_grid();</div>
<div class="line">     <span class="keywordtype">void</span> output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>) <span class="keyword">const</span>;</div>
<div class="line">  </div>
<div class="line">     <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>;</div>
<div class="line">     <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>    dof_handler;</div>
<div class="line">  </div>
<div class="line">     <span class="keyword">const</span> <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a>     <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>;</div>
<div class="line">     <span class="keyword">const</span> <a class="code" href="classMappingQ.html">MappingQ&lt;dim&gt;</a> <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>;</div>
<div class="line">  </div>
<div class="line">     <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>;</div>
<div class="line">  </div>
<div class="line">     <a class="code" href="classSparsityPattern.html">SparsityPattern</a>      <a class="code" href="trilinos__sparse__matrix__0_8txt.html#ab4e34663c28496ee1b07f40fd5d00fa1">sparsity_pattern</a>;</div>
<div class="line">     <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> system_matrix;</div>
<div class="line">  </div>
<div class="line">     <a class="code" href="classVector.html">Vector&lt;double&gt;</a> <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>;</div>
<div class="line">     <a class="code" href="classVector.html">Vector&lt;double&gt;</a> system_rhs;</div>
<div class="line">  </div>
<div class="line">     <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparsityPattern&gt;</a> mg_sparsity_patterns;</div>
<div class="line">     <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparsityPattern&gt;</a> mg_interface_sparsity_patterns;</div>
<div class="line">  </div>
<div class="line">     <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparseMatrix&lt;double&gt;</a>&gt; mg_matrices;</div>
<div class="line">     <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparseMatrix&lt;double&gt;</a>&gt; mg_interface_in;</div>
<div class="line">     <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparseMatrix&lt;double&gt;</a>&gt; mg_interface_out;</div>
<div class="line">  </div>
<div class="line">     <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;Vector&lt;double&gt;</a>&gt; mg_matrix;</div>
<div class="line">     <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;Vector&lt;double&gt;</a>&gt; mg_interface_matrix_in;</div>
<div class="line">     <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;Vector&lt;double&gt;</a>&gt; mg_interface_matrix_out;</div>
<div class="line">  </div>
<div class="line">     std::unique_ptr&lt;MGSmoother&lt;Vector&lt;double&gt;&gt;&gt; mg_smoother;</div>
<div class="line">  </div>
<div class="line">     <span class="keyword">using</span> SmootherType =</div>
<div class="line">       <a class="code" href="classRelaxationBlock.html">RelaxationBlock&lt;SparseMatrix&lt;double&gt;</a>, <a class="code" href="hdf5__0_8txt.html#aae153b86de45d3354cd3edd5b992435e">double</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;;</div>
<div class="line">     <span class="keyword">using</span> SmootherAdditionalDataType = <a class="code" href="relaxation__block__0_8txt.html#a2076fd56276055e74e230fad6edac013">SmootherType::AdditionalData</a>;</div>
<div class="line">     <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SmootherAdditionalDataType&gt;</a> smoother_data;</div>
<div class="line">  </div>
<div class="line">     <a class="code" href="classMGConstrainedDoFs.html">MGConstrainedDoFs</a> mg_constrained_dofs;</div>
<div class="line">  </div>
<div class="line">     <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> advection_direction;</div>
<div class="line">  </div>
<div class="line">     <span class="keyword">const</span> <a class="code" href="structSettings.html">Settings</a> <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>;</div>
<div class="line">   };</div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">   <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">   AdvectionProblem&lt;dim&gt;::AdvectionProblem(<span class="keyword">const</span> <a class="code" href="structSettings.html">Settings</a> &amp;<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>)</div>
<div class="line">     : <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>(<a class="code" href="classTriangulation.html">Triangulation</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;::limit_level_difference_at_vertices)</div>
<div class="line">     , dof_handler(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>)</div>
<div class="line">     , <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.<a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>)</div>
<div class="line">     , <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.<a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>)</div>
<div class="line">     , <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>)</div>
<div class="line">   {</div>
<div class="line">     advection_direction[0] =</div>
<div class="line">  </div>
<div class="line">-<a class="code" href="function__time__0_8txt.html#aec9d63e7b1c02618470be701525a5211">std::sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a> / 6.0);</div>
<div class="line">     <span class="keywordflow">if</span> (<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> &gt;= 2)</div>
<div class="line">       advection_direction[1] = <a class="code" href="base_2vectorization_8h.html#a11c48f86a4f2adf21555e64049ecde8c">std::cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a> / 6.0);</div>
<div class="line">     <span class="keywordflow">if</span> (<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> &gt;= 3)</div>
<div class="line">       <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">   }</div>
</div><!-- fragment --><p></em></p>
<p><em> <a class="anchor" id="codeAdvectionProblemsetup_systemcode"></a> </p><h4><code>AdvectionProblem::setup_system()</code></h4>
<p></em></p>
<p><em></em></p>
<p><em> Here we first set up the <a class="el" href="classDoFHandler.html">DoFHandler</a>, <a class="el" href="classAffineConstraints.html">AffineConstraints</a>, and <a class="el" href="classSparsityPattern.html">SparsityPattern</a> objects for both active and multigrid level meshes. <br  />
 We could renumber the active DoFs with the <a class="el" href="namespaceDoFRenumbering.html">DoFRenumbering</a> class, but the smoothers only act on multigrid levels and as such, this would not matter for the computations. Instead, we will renumber the DoFs on each multigrid level below.</em></p>
<p><em></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::setup_system()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a> = <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_levels();</div>
<div class="line"> </div>
<div class="line">  dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">  system_rhs.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#addd15bc409c61d6f795f0132c574335b">clear</a>();</div>
<div class="line">  <a class="code" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a>(dof_handler, <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">    <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>, dof_handler, 0, <a class="code" href="classBoundaryValues.html">BoundaryValues&lt;dim&gt;</a>(), <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>);</div>
<div class="line">  <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">    <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>, dof_handler, 1, <a class="code" href="classBoundaryValues.html">BoundaryValues&lt;dim&gt;</a>(), <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>);</div>
<div class="line">  <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">  <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler,</div>
<div class="line">                                  dsp,</div>
<div class="line">                                  <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>,</div>
<div class="line">                                   <span class="comment">/*keep_constrained_dofs = */</span>  <span class="keyword">false</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="trilinos__sparse__matrix__0_8txt.html#ab4e34663c28496ee1b07f40fd5d00fa1">sparsity_pattern</a>.copy_from(dsp);</div>
<div class="line">  system_matrix.reinit(<a class="code" href="trilinos__sparse__matrix__0_8txt.html#ab4e34663c28496ee1b07f40fd5d00fa1">sparsity_pattern</a>);</div>
<div class="line"> </div>
<div class="line">  dof_handler.<a class="code" href="classDoFHandler.html#a9aed31323cbd7619edac310c47e7a7ad">distribute_mg_dofs</a>();</div>
</div><!-- fragment --><p></em></p>
<p><em> Having enumerated the global degrees of freedom as well as (in the last line above) the level degrees of freedom, let us renumber the level degrees of freedom to get a better smoother as explained in the introduction. The first block below renumbers DoFs on each level in downstream or upstream direction if needed. This is only necessary for point smoothers (SOR and Jacobi) as the block smoothers operate on cells (see <code>create_smoother()</code>). The blocks below then also implement random numbering.</em></p>
<p><em></p><div class="fragment"><div class="line">     <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;SOR&quot;</span> || <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;Jacobi&quot;</span>)</div>
<div class="line">       {</div>
<div class="line">         <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.dof_renumbering ==</div>
<div class="line">               <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">Settings::DoFRenumberingStrategy::downstream</a> ||</div>
<div class="line">             <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.dof_renumbering ==</div>
<div class="line">               Settings::DoFRenumberingStrategy::upstream)</div>
<div class="line">           {</div>
<div class="line">             <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> <a class="code" href="dofs__0_8txt.html#ae704d52abb496c815f42849c4de0f458">direction</a> =</div>
<div class="line">               (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.dof_renumbering ==</div>
<div class="line">                    Settings::DoFRenumberingStrategy::upstream ?</div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line">-1.0 :</div>
<div class="line">                  1.0)</div>
<div class="line">               advection_direction;</div>
<div class="line">  </div>
<div class="line">             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a>; ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">               <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">DoFRenumbering::downstream</a>(dof_handler,</div>
<div class="line">                                          <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>,</div>
<div class="line">                                          <a class="code" href="dofs__0_8txt.html#ae704d52abb496c815f42849c4de0f458">direction</a>,</div>
<div class="line">                                           <span class="comment">/*dof_wise_renumbering = */</span>  <span class="keyword">true</span>);</div>
<div class="line">           }</div>
<div class="line">         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.dof_renumbering ==</div>
<div class="line">                  <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">Settings::DoFRenumberingStrategy::random</a>)</div>
<div class="line">           {</div>
<div class="line">             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a>; ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">               <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">DoFRenumbering::random</a>(dof_handler, <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">           }</div>
<div class="line">         <span class="keywordflow">else</span></div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">       }</div>
</div><!-- fragment --><p></em></p>
<p><em> The rest of the function just sets up data structures. The last lines of the code below is unlike the other GMG tutorials, as it sets up both the interface in and out matrices. We need this since our problem is non-symmetric.</em></p>
<p><em></p><div class="fragment"><div class="line">     mg_constrained_dofs.clear();</div>
<div class="line">     mg_constrained_dofs.initialize(dof_handler);</div>
<div class="line">  </div>
<div class="line">     mg_constrained_dofs.make_zero_boundary_constraints(dof_handler, {0, 1});</div>
<div class="line">  </div>
<div class="line">     mg_matrices.resize(0, <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a></div>
<div class="line">  </div>
<div class="line">- 1);</div>
<div class="line">     mg_matrices.clear_elements();</div>
<div class="line">     mg_interface_in.resize(0, <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a></div>
<div class="line">  </div>
<div class="line">- 1);</div>
<div class="line">     mg_interface_in.clear_elements();</div>
<div class="line">     mg_interface_out.resize(0, <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a></div>
<div class="line">  </div>
<div class="line">- 1);</div>
<div class="line">     mg_interface_out.clear_elements();</div>
<div class="line">     mg_sparsity_patterns.resize(0, <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a></div>
<div class="line">  </div>
<div class="line">- 1);</div>
<div class="line">     mg_interface_sparsity_patterns.resize(0, <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a></div>
<div class="line">  </div>
<div class="line">- 1);</div>
<div class="line">  </div>
<div class="line">     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a>; ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">       {</div>
<div class="line">         {</div>
<div class="line">           <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>),</div>
<div class="line">                                      dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">           <a class="code" href="namespaceMGTools.html#a19ba9ee4a2b65235c8bb3fb65ea8f4e0">MGTools::make_sparsity_pattern</a>(dof_handler, dsp, <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">           mg_sparsity_patterns[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].copy_from(dsp);</div>
<div class="line">           mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].reinit(mg_sparsity_patterns[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>]);</div>
<div class="line">         }</div>
<div class="line">         {</div>
<div class="line">           <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>),</div>
<div class="line">                                      dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">           <a class="code" href="namespaceMGTools.html#a8c677f65f8f1d21fb1f4c55cb90079e0">MGTools::make_interface_sparsity_pattern</a>(dof_handler,</div>
<div class="line">                                                    mg_constrained_dofs,</div>
<div class="line">                                                    dsp,</div>
<div class="line">                                                    <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">           mg_interface_sparsity_patterns[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].copy_from(dsp);</div>
<div class="line">  </div>
<div class="line">           mg_interface_in[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].reinit(mg_interface_sparsity_patterns[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>]);</div>
<div class="line">           mg_interface_out[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].reinit(mg_interface_sparsity_patterns[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>]);</div>
<div class="line">         }</div>
<div class="line">       }</div>
<div class="line">   }</div>
</div><!-- fragment --><p></em></p>
<p><em> <a class="anchor" id="codeAdvectionProblemassemble_cellcode"></a> </p><h4><code>AdvectionProblem::assemble_cell()</code></h4>
<p></em></p>
<p><em></em></p>
<p><em> Here we define the assembly of the linear system on each cell to be used by the <a class="el" href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">mesh_loop()</a> function below. This one function assembles the cell matrix for either an active or a level cell (whatever it is passed as its first argument), and only assembles a right-hand side if called with an active cell.</em></p>
<p><em></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> IteratorType&gt;</div>
<div class="line"><span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::assemble_cell(<span class="keyword">const</span> IteratorType &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>,</div>
<div class="line">                                          <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a> &amp;  scratch_data,</div>
<div class="line">                                          <a class="code" href="structCopyData.html">CopyData</a> &amp;          copy_data)</div>
<div class="line">{</div>
<div class="line">  copy_data.level = <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;level();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> =</div>
<div class="line">    scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.get_fe().n_dofs_per_cell();</div>
<div class="line">  copy_data.dofs_per_cell = <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>;</div>
<div class="line">  copy_data.cell_matrix.reinit(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>, <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a> =</div>
<div class="line">    scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.<a class="code" href="classFEValues.html#ae053b49309f1dce22268c6bc8fe50cb2">get_quadrature</a>().size();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;is_level_cell() == <span class="keyword">false</span>)</div>
<div class="line">    copy_data.cell_rhs.reinit(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">  copy_data.local_dof_indices.resize(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">  <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;get_active_or_mg_dof_indices(copy_data.local_dof_indices);</div>
<div class="line"> </div>
<div class="line">  scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classRightHandSide.html">RightHandSide&lt;dim&gt;</a>  <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>;</div>
<div class="line">  std::vector&lt;double&gt; rhs_values(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>.value_list(scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.get_quadrature_points(),</div>
<div class="line">                             rhs_values);</div>
</div><!-- fragment --><p></em></p>
<p><em> If we are using streamline diffusion we must add its contribution to both the cell matrix and the cell right-hand side. If we are not using streamline diffusion, setting \(\delta=0\) negates this contribution below and we are left with the standard, Galerkin finite element assembly.</em></p>
<p><em></p><div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> delta = (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.with_streamline_diffusion ?</div>
<div class="line">                        <a class="code" href="namespaceStep63.html#abe37f2d8c4bdc6c9dc4255f0a778aeec">compute_stabilization_delta</a>(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;diameter(),</div>
<div class="line">                                                    <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.epsilon,</div>
<div class="line">                                                    advection_direction,</div>
<div class="line">                                                    <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.fe_degree) :</div>
<div class="line">                        0.0);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q_point)</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> = 0; <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>)</div>
<div class="line">        {</div>
</div><!-- fragment --><p></em></p>
<p><em> The assembly of the local matrix has two parts. First the Galerkin contribution:</em></p>
<p><em></p><div class="fragment"><div class="line">copy_data.cell_matrix(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>) +=</div>
<div class="line">  (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.epsilon</div>
<div class="line">   scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point)</div>
<div class="line">   scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point)</div>
<div class="line">   scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.JxW(q_point)) +</div>
<div class="line">  (scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_value(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point)</div>
<div class="line">   (advection_direction</div>
<div class="line">    scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point))</div>
<div class="line">   scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.JxW(q_point))</div>
</div><!-- fragment --><p></em></p>
<p><em> and then the streamline diffusion contribution:</em></p>
<p><em></p><div class="fragment"><div class="line">                 + delta</div>
<div class="line">                     (advection_direction</div>
<div class="line">                      scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point))</div>
<div class="line">                     (advection_direction</div>
<div class="line">                      scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point))</div>
<div class="line">                     scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.JxW(q_point)</div>
<div class="line">  </div>
<div class="line">-</div>
<div class="line">                 delta <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.epsilon</div>
<div class="line">                   <a class="code" href="classSymmetricTensor.html#a9137b6052702150e8e5b1188d1971906">trace</a>(scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_hessian(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point))</div>
<div class="line">                   (advection_direction</div>
<div class="line">                    scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point))</div>
<div class="line">                   scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.JxW(q_point);</div>
<div class="line">             }</div>
<div class="line">           <span class="keywordflow">if</span> (<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;is_level_cell() == <span class="keyword">false</span>)</div>
<div class="line">             {</div>
</div><!-- fragment --><p></em></p>
<p><em> The same applies to the right hand side. First the Galerkin contribution:</em></p>
<p><em></p><div class="fragment"><div class="line">copy_data.cell_rhs(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>) +=</div>
<div class="line">  scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_value(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point)</div>
<div class="line">    rhs_values[q_point] scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.JxW(q_point)</div>
</div><!-- fragment --><p></em></p>
<p><em> and then the streamline diffusion contribution:</em></p>
<p><em></p><div class="fragment"><div class="line">              + delta rhs_values[q_point] advection_direction</div>
<div class="line">                  scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point)</div>
<div class="line">                  scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.JxW(q_point);</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">}</div>
</div><!-- fragment --><p></em></p>
<p><em> <a class="anchor" id="codeAdvectionProblemassemble_system_and_multigridcode"></a> </p><h4><code>AdvectionProblem::assemble_system_and_multigrid()</code></h4>
<p></em></p>
<p><em></em></p>
<p><em> Here we employ <a class="el" href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop()</a> to go over cells and assemble the system_matrix, system_rhs, and all mg_matrices for us.</em></p>
<p><em></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::assemble_system_and_multigrid()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> cell_worker_active =</div>
<div class="line">    [&amp;](<span class="keyword">const</span> decltype(dof_handler.<a class="code" href="classDoFHandler.html#a9a3bef554c6d22abe312e10e9475eecf">begin_active</a>()) &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>,</div>
<div class="line">        <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a> &amp;                          scratch_data,</div>
<div class="line">        <a class="code" href="structCopyData.html">CopyData</a> &amp;                                  copy_data) {</div>
<div class="line">      this-&gt;assemble_cell(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, scratch_data, copy_data);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> copier_active = [&amp;](<span class="keyword">const</span> <a class="code" href="structCopyData.html">CopyData</a> &amp;copy_data) {</div>
<div class="line">    <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#a373fbdacd8c486e675b8d2bff8943192">distribute_local_to_global</a>(copy_data.cell_matrix,</div>
<div class="line">                                           copy_data.cell_rhs,</div>
<div class="line">                                           copy_data.local_dof_indices,</div>
<div class="line">                                           system_matrix,</div>
<div class="line">                                           system_rhs);</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop</a>(dof_handler.<a class="code" href="classDoFHandler.html#a9a3bef554c6d22abe312e10e9475eecf">begin_active</a>(),</div>
<div class="line">                        dof_handler.<a class="code" href="classDoFHandler.html#a042c4bf0f59fef5e72dbcfbdd56b2782">end</a>(),</div>
<div class="line">                        cell_worker_active,</div>
<div class="line">                        copier_active,</div>
<div class="line">                        <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>, <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1),</div>
<div class="line">                        <a class="code" href="structCopyData.html">CopyData</a>(),</div>
<div class="line">                        <a class="code" href="namespaceMeshWorker.html#ac7a9db8b34d398d7d398d1e8809874aaacb8627085561cee8b7af9d74320696eb">MeshWorker::assemble_own_cells</a>);</div>
</div><!-- fragment --><p></em></p>
<p><em> Unlike the constraints for the active level, we choose to create constraint objects for each multigrid level local to this function since they are never needed elsewhere in the program.</em></p>
<p><em></p><div class="fragment"><div class="line">std::vector&lt;AffineConstraints&lt;double&gt;&gt; boundary_constraints(</div>
<div class="line">  <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels());</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels();</div>
<div class="line">     ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classIndexSet.html">IndexSet</a> locally_owned_level_dof_indices;</div>
<div class="line">    <a class="code" href="namespaceDoFTools.html#a1fef7be07cf379b661646e39b9354e17">DoFTools::extract_locally_relevant_level_dofs</a>(</div>
<div class="line">      dof_handler, <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>, locally_owned_level_dof_indices);</div>
<div class="line">    boundary_constraints[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].reinit(locally_owned_level_dof_indices);</div>
<div class="line">    boundary_constraints[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].add_lines(</div>
<div class="line">      mg_constrained_dofs.get_refinement_edge_indices(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">    boundary_constraints[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].add_lines(</div>
<div class="line">      mg_constrained_dofs.get_boundary_indices(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">    boundary_constraints[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].close();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> cell_worker_mg =</div>
<div class="line">  [&amp;](<span class="keyword">const</span> decltype(dof_handler.<a class="code" href="classDoFHandler.html#a52af463de3283318bd4c651df7d35d24">begin_mg</a>()) &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>,</div>
<div class="line">      <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a> &amp;                      scratch_data,</div>
<div class="line">      <a class="code" href="structCopyData.html">CopyData</a> &amp;                              copy_data) {</div>
<div class="line">    this-&gt;assemble_cell(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, scratch_data, copy_data);</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> copier_mg = [&amp;](<span class="keyword">const</span> <a class="code" href="structCopyData.html">CopyData</a> &amp;copy_data) {</div>
<div class="line">  boundary_constraints[copy_data.level].distribute_local_to_global(</div>
<div class="line">    copy_data.cell_matrix,</div>
<div class="line">    copy_data.local_dof_indices,</div>
<div class="line">    mg_matrices[copy_data.level]);</div>
</div><!-- fragment --><p></em></p>
<p><em> If \((i,j)\) is an <code>interface_out</code> dof pair, then \((j,i)\) is an <code>interface_in</code> dof pair. Note: For <code>interface_in</code>, we load the transpose of the interface entries, i.e., the entry for dof pair \((j,i)\) is stored in <code>interface_in(i,j)</code>. This is an optimization for the symmetric case which allows only one matrix to be used when setting the edge_matrices in <a class="el" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve()</a>. Here, however, since our problem is non-symmetric, we must store both <code>interface_in</code> and <code>interface_out</code> matrices.</em></p>
<p><em></p><div class="fragment"><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; copy_data.dofs_per_cell; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> = 0; <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> &lt; copy_data.dofs_per_cell; ++<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>)</div>
<div class="line">        <span class="keywordflow">if</span> (mg_constrained_dofs.is_interface_matrix_entry(</div>
<div class="line">              copy_data.level,</div>
<div class="line">              copy_data.local_dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>],</div>
<div class="line">              copy_data.local_dof_indices[<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>]))</div>
<div class="line">          {</div>
<div class="line">            mg_interface_out[copy_data.level].add(</div>
<div class="line">              copy_data.local_dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>],</div>
<div class="line">              copy_data.local_dof_indices[<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>],</div>
<div class="line">              copy_data.cell_matrix(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>));</div>
<div class="line">            mg_interface_in[copy_data.level].add(</div>
<div class="line">              copy_data.local_dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>],</div>
<div class="line">              copy_data.local_dof_indices[<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>],</div>
<div class="line">              copy_data.cell_matrix(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>));</div>
<div class="line">          }</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop</a>(dof_handler.<a class="code" href="classDoFHandler.html#a52af463de3283318bd4c651df7d35d24">begin_mg</a>(),</div>
<div class="line">                        dof_handler.<a class="code" href="classDoFHandler.html#aaa2300cc9a5f93532400af2752d948f6">end_mg</a>(),</div>
<div class="line">                        cell_worker_mg,</div>
<div class="line">                        copier_mg,</div>
<div class="line">                        <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>, <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1),</div>
<div class="line">                        <a class="code" href="structCopyData.html">CopyData</a>(),</div>
<div class="line">                        <a class="code" href="namespaceMeshWorker.html#ac7a9db8b34d398d7d398d1e8809874aaacb8627085561cee8b7af9d74320696eb">MeshWorker::assemble_own_cells</a>);</div>
<div class="line">}</div>
</div><!-- fragment --><p></em></p>
<p><em> <a class="anchor" id="codeAdvectionProblemsetup_smoothercode"></a> </p><h4><code>AdvectionProblem::setup_smoother()</code></h4>
<p></em></p>
<p><em></em></p>
<p><em> Next, we set up the smoother based on the settings in the <code>.prm</code> file. The two options that are of significance is the number of pre- and post-smoothing steps on each level of the multigrid v-cycle and the relaxation parameter.</em></p>
<p><em> Since multiplicative methods tend to be more powerful than additive method, fewer smoothing steps are required to see convergence independent of mesh size. The same holds for block smoothers over point smoothers. This is reflected in the choice for the number of smoothing steps for each type of smoother below.</em></p>
<p><em> The relaxation parameter for point smoothers is chosen based on trial and error, and reflects values necessary to keep the iteration counts in the GMRES solve constant (or as close as possible) as we refine the mesh. The two values given for both "Jacobi" and "SOR" in the <code>.prm</code> files are for degree 1 and degree 3 finite elements. If the user wants to change to another degree, they may need to adjust these numbers. For block smoothers, this parameter has a more straightforward interpretation, namely that for additive methods in 2D, a DoF can have a repeated contribution from up to 4 cells, therefore we must relax these methods by 0.25 to compensate. This is not an issue for multiplicative methods as each cell's inverse application carries new information to all its DoFs.</em></p>
<p><em> Finally, as mentioned above, the point smoothers only operate on DoFs, and the block smoothers on cells, so only the block smoothers need to be given information regarding cell orderings. DoF ordering for point smoothers has already been taken care of in <code>setup_system()</code>.</em></p>
<p><em></p><div class="fragment"><div class="line">   <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">   <span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::setup_smoother()</div>
<div class="line">   {</div>
<div class="line">     <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;SOR&quot;</span>)</div>
<div class="line">       {</div>
<div class="line">         <span class="keyword">using</span> Smoother = <a class="code" href="classPreconditionSOR.html">PreconditionSOR&lt;SparseMatrix&lt;double&gt;</a>&gt;;</div>
<div class="line">  </div>
<div class="line">         <span class="keyword">auto</span> smoother =</div>
<div class="line">           std::make_unique&lt;MGSmootherPrecondition&lt;SparseMatrix&lt;double&gt;,</div>
<div class="line">                                                   Smoother,</div>
<div class="line">                                                   <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;&gt;();</div>
<div class="line">         smoother-&gt;<a class="code" href="classMGSmootherPrecondition.html#a3cb789b815bf6719eee79e2137c9bd84">initialize</a>(mg_matrices,</div>
<div class="line">                              <a class="code" href="relaxation__block__0_8txt.html#a2076fd56276055e74e230fad6edac013">Smoother::AdditionalData</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> == 1 ? 1.0 :</div>
<div class="line">                                                                        0.62));</div>
<div class="line">         smoother-&gt;<a class="code" href="classMGSmoother.html#a9976182b6b272aac7800a8fbf18c8ab9">set_steps</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoothing_steps);</div>
<div class="line">         mg_smoother = std::move(smoother);</div>
<div class="line">       }</div>
<div class="line">     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;Jacobi&quot;</span>)</div>
<div class="line">       {</div>
<div class="line">         <span class="keyword">using</span> Smoother = <a class="code" href="classPreconditionJacobi.html">PreconditionJacobi&lt;SparseMatrix&lt;double&gt;</a>&gt;;</div>
<div class="line">         <span class="keyword">auto</span> smoother =</div>
<div class="line">           std::make_unique&lt;MGSmootherPrecondition&lt;SparseMatrix&lt;double&gt;,</div>
<div class="line">                                                   Smoother,</div>
<div class="line">                                                   <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;&gt;();</div>
<div class="line">         smoother-&gt;<a class="code" href="classMGSmootherPrecondition.html#a3cb789b815bf6719eee79e2137c9bd84">initialize</a>(mg_matrices,</div>
<div class="line">                              <a class="code" href="relaxation__block__0_8txt.html#a2076fd56276055e74e230fad6edac013">Smoother::AdditionalData</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> == 1 ? 0.6667 :</div>
<div class="line">                                                                        0.47));</div>
<div class="line">         smoother-&gt;<a class="code" href="classMGSmoother.html#a9976182b6b272aac7800a8fbf18c8ab9">set_steps</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoothing_steps);</div>
<div class="line">         mg_smoother = std::move(smoother);</div>
<div class="line">       }</div>
<div class="line">     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;block SOR&quot;</span> ||</div>
<div class="line">              <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;block Jacobi&quot;</span>)</div>
<div class="line">       {</div>
<div class="line">         smoother_data.<a class="code" href="classMGLevelObject.html#a16213121f9153bd08f49652a11886259">resize</a>(0, <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_levels()</div>
<div class="line">  </div>
<div class="line">- 1);</div>
<div class="line">  </div>
<div class="line">         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_levels(); ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">           {</div>
<div class="line">             <a class="code" href="namespaceDoFTools.html#a43ee44769769065bc594d1730477a4b9">DoFTools::make_cell_patches</a>(smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].block_list,</div>
<div class="line">                                         dof_handler,</div>
<div class="line">                                         <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">  </div>
<div class="line">             smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].relaxation =</div>
<div class="line">               (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;block SOR&quot;</span> ? 1.0 : 0.25);</div>
<div class="line">             smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].inversion = <a class="code" href="classPreconditionBlockBase.html">PreconditionBlockBase&lt;double&gt;::svd</a>;</div>
<div class="line">  </div>
<div class="line">             std::vector&lt;unsigned int&gt; ordered_indices;</div>
<div class="line">             <span class="keywordflow">switch</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.dof_renumbering)</div>
<div class="line">               {</div>
<div class="line">                 <span class="keywordflow">case</span> <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">Settings::DoFRenumberingStrategy::downstream</a>:</div>
<div class="line">                   ordered_indices =</div>
<div class="line">                     <a class="code" href="namespaceStep63.html#a679f6c35915713a90230f261b38f041e">create_downstream_cell_ordering</a>(dof_handler,</div>
<div class="line">                                                     advection_direction,</div>
<div class="line">                                                     <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">                   <span class="keywordflow">break</span>;</div>
<div class="line">  </div>
<div class="line">                 <span class="keywordflow">case</span> Settings::DoFRenumberingStrategy::upstream:</div>
<div class="line">                   ordered_indices =</div>
<div class="line">                     <a class="code" href="namespaceStep63.html#a679f6c35915713a90230f261b38f041e">create_downstream_cell_ordering</a>(dof_handler,</div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line">-1.0 advection_direction,</div>
<div class="line">                                                     <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">                   <span class="keywordflow">break</span>;</div>
<div class="line">  </div>
<div class="line">                 <span class="keywordflow">case</span> <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">Settings::DoFRenumberingStrategy::random</a>:</div>
<div class="line">                   ordered_indices =</div>
<div class="line">                     <a class="code" href="namespaceStep63.html#a5bcdd1e04c358777541a2922f8803db4">create_random_cell_ordering</a>(dof_handler, <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">                   <span class="keywordflow">break</span>;</div>
<div class="line">  </div>
<div class="line">                 <span class="keywordflow">case</span> <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1acc6b05c836e9f74fb7ab9390ffc26f1c">Settings::DoFRenumberingStrategy::none</a>:</div>
<div class="line">                   <span class="keywordflow">break</span>;</div>
<div class="line">  </div>
<div class="line">                 <span class="keywordflow">default</span>:</div>
<div class="line">                   <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">                   <span class="keywordflow">break</span>;</div>
<div class="line">               }</div>
<div class="line">  </div>
<div class="line">             smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].order =</div>
<div class="line">               std::vector&lt;std::vector&lt;unsigned int&gt;&gt;(1, ordered_indices);</div>
<div class="line">           }</div>
<div class="line">  </div>
<div class="line">         <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;block SOR&quot;</span>)</div>
<div class="line">           {</div>
<div class="line">             <span class="keyword">auto</span> smoother = std::make_unique&lt;<a class="code" href="classMGSmootherPrecondition.html">MGSmootherPrecondition</a>&lt;</div>
<div class="line">               <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a>,</div>
<div class="line">               <a class="code" href="classRelaxationBlockSOR.html">RelaxationBlockSOR&lt;SparseMatrix&lt;double&gt;</a>, <a class="code" href="hdf5__0_8txt.html#aae153b86de45d3354cd3edd5b992435e">double</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;,</div>
<div class="line">               <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;&gt;();</div>
<div class="line">             smoother-&gt;<a class="code" href="classMGSmootherPrecondition.html#a3cb789b815bf6719eee79e2137c9bd84">initialize</a>(mg_matrices, smoother_data);</div>
<div class="line">             smoother-&gt;<a class="code" href="classMGSmoother.html#a9976182b6b272aac7800a8fbf18c8ab9">set_steps</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoothing_steps);</div>
<div class="line">             mg_smoother = std::move(smoother);</div>
<div class="line">           }</div>
<div class="line">         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;block Jacobi&quot;</span>)</div>
<div class="line">           {</div>
<div class="line">             <span class="keyword">auto</span> smoother = std::make_unique&lt;</div>
<div class="line">               <a class="code" href="classMGSmootherPrecondition.html">MGSmootherPrecondition&lt;SparseMatrix&lt;double&gt;</a>,</div>
<div class="line">                                      <a class="code" href="classRelaxationBlockJacobi.html">RelaxationBlockJacobi&lt;SparseMatrix&lt;double&gt;</a>,</div>
<div class="line">                                                            <a class="code" href="hdf5__0_8txt.html#aae153b86de45d3354cd3edd5b992435e">double</a>,</div>
<div class="line">                                                            <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;,</div>
<div class="line">                                      <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;&gt;();</div>
<div class="line">             smoother-&gt;<a class="code" href="classMGSmootherPrecondition.html#a3cb789b815bf6719eee79e2137c9bd84">initialize</a>(mg_matrices, smoother_data);</div>
<div class="line">             smoother-&gt;<a class="code" href="classMGSmoother.html#a9976182b6b272aac7800a8fbf18c8ab9">set_steps</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoothing_steps);</div>
<div class="line">             mg_smoother = std::move(smoother);</div>
<div class="line">           }</div>
<div class="line">       }</div>
<div class="line">     <span class="keywordflow">else</span></div>
<div class="line">       <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">   }</div>
</div><!-- fragment --><p></em></p>
<p><em> <a class="anchor" id="codeAdvectionProblemsolvecode"></a> </p><h4><code>AdvectionProblem::solve()</code></h4>
<p></em></p>
<p><em></em></p>
<p><em> Before we can solve the system, we must first set up the multigrid preconditioner. This requires the setup of the transfer between levels, the coarse matrix solver, and the smoother. This setup follows almost identically to <a class="el" href="step_16.html">step-16</a> , the main difference being the various smoothers defined above and the fact that we need different interface edge matrices for in and out since our problem is non-symmetric. (In reality, for this tutorial these interface matrices are empty since we are only using global refinement, and thus have no refinement edges. However, we have still included both here since if one made the simple switch to an adaptively refined method, the program would still run correctly.)</em></p>
<p><em> The last thing to note is that since our problem is non-symmetric, we must use an appropriate Krylov subspace method. We choose here to use GMRES since it offers the guarantee of residual reduction in each iteration. The major disavantage of GMRES is that, for each iteration, the number of stored temporary vectors increases by one, and one also needs to compute a scalar product with all previously stored vectors. This is rather expensive. This requirement is relaxed by using the restarted GMRES method which puts a cap on the number of vectors we are required to store at any one time (here we restart after 50 temporary vectors, or 48 iterations). This then has the disadvantage that we lose information we have gathered throughout the iteration and therefore we could see slower convergence. As a consequence, where to restart is a question of balancing memory consumption, CPU effort, and convergence speed. However, the goal of this tutorial is to have very low iteration counts by using a powerful GMG preconditioner, so we have picked the restart length such that all of the results shown below converge prior to restart happening, and thus we have a standard GMRES method. If the user is interested, another suitable method offered in deal.II would be BiCGStab.</em></p>
<p><em></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">AdvectionProblem&lt;dim&gt;::solve</a>()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_iters       = 200;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span>       solve_tolerance = 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-8 system_rhs.l2_norm();</div>
<div class="line">  <a class="code" href="classSolverControl.html">SolverControl</a>      solver_control(max_iters, solve_tolerance, <span class="keyword">true</span>, <span class="keyword">true</span>);</div>
<div class="line">  solver_control.<a class="code" href="classSolverControl.html#a6d99741765243ccb65da4ff66558cf41">enable_history_data</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using</span> Transfer = <a class="code" href="classMGTransferPrebuilt.html">MGTransferPrebuilt&lt;Vector&lt;double&gt;</a>&gt;;</div>
<div class="line">  Transfer mg_transfer(mg_constrained_dofs);</div>
<div class="line">  mg_transfer.<a class="code" href="classMGTransferMatrixFree.html#a8f214ffade006cfa85e902a94902fc7b">build</a>(dof_handler);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> coarse_matrix;</div>
<div class="line">  coarse_matrix.<a class="code" href="classFullMatrix.html#ae9e8fbf00e15c7b66d527a5de4b31404">copy_from</a>(mg_matrices[0]);</div>
<div class="line">  <a class="code" href="classMGCoarseGridHouseholder.html">MGCoarseGridHouseholder&lt;double, Vector&lt;double&gt;</a>&gt; coarse_grid_solver;</div>
<div class="line">  coarse_grid_solver.<a class="code" href="classMGCoarseGridHouseholder.html#a07bd76dc7f6f66cb22d3e7951a558f50">initialize</a>(coarse_matrix);</div>
<div class="line"> </div>
<div class="line">  setup_smoother();</div>
<div class="line"> </div>
<div class="line">  mg_matrix.initialize(mg_matrices);</div>
<div class="line">  mg_interface_matrix_in.initialize(mg_interface_in);</div>
<div class="line">  mg_interface_matrix_out.initialize(mg_interface_out);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classMultigrid.html">Multigrid&lt;Vector&lt;double&gt;</a>&gt; <a class="code" href="namespacemg.html">mg</a>(</div>
<div class="line">    mg_matrix, coarse_grid_solver, mg_transfer,mg_smoother,mg_smoother);</div>
<div class="line">  <a class="code" href="namespacemg.html">mg</a>.set_edge_matrices(mg_interface_matrix_out, mg_interface_matrix_in);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classPreconditionMG.html">PreconditionMG&lt;dim, Vector&lt;double&gt;</a>, Transfer&gt; <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>(dof_handler,</div>
<div class="line">                                                               <a class="code" href="namespacemg.html">mg</a>,</div>
<div class="line">                                                               mg_transfer);</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;     Solving with GMRES to tol &quot;</span> &lt;&lt; solve_tolerance &lt;&lt; <span class="stringliteral">&quot;...&quot;</span></div>
<div class="line">            &lt;&lt; std::endl;</div>
<div class="line">  <a class="code" href="classSolverGMRES.html">SolverGMRES&lt;Vector&lt;double&gt;</a>&gt; <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>(</div>
<div class="line">    solver_control, <a class="code" href="classSolverGMRES.html">SolverGMRES</a>&lt;<a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;::<a class="code" href="relaxation__block__0_8txt.html#a2076fd56276055e74e230fad6edac013">AdditionalData</a>(50, <span class="keyword">true</span>));</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTimer.html">Timer</a> <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a>;</div>
<div class="line">  <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a>.start();</div>
<div class="line">  <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.solve(system_matrix, <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, system_rhs, <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>);</div>
<div class="line">  <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a>.stop();</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;          converged in &quot;</span> &lt;&lt; solver_control.<a class="code" href="classSolverControl.html#a42aeae81cd6b67ce93b5fbea3328371f">last_step</a>()</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot; iterations&quot;</span></div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot; in &quot;</span> &lt;&lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a>.last_wall_time() &lt;&lt; <span class="stringliteral">&quot; seconds &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">distribute</a>(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line">  mg_smoother.release();</div>
<div class="line">}</div>
</div><!-- fragment --><p></em></p>
<p><em> <a class="anchor" id="codeAdvectionProblemoutput_resultscode"></a> </p><h4><code>AdvectionProblem::output_results()</code></h4>
<p></em></p>
<p><em></em></p>
<p><em> The final function of interest generates graphical output. Here we output the solution and cell ordering in a .vtu format.</em></p>
<p><em> At the top of the function, we generate an index for each cell to visualize the ordering used by the smoothers. Note that we do this only for the active cells instead of the levels, where the smoothers are actually used. For the point smoothers we renumber DoFs instead of cells, so this is only an approximation of what happens in reality. Finally, the random ordering is not the random ordering we actually use (see <code>create_smoother()</code> for that). <br  />
 The (integer) ordering of cells is then copied into a (floating point) vector for graphical output.</em></p>
<p><em></p><div class="fragment"><div class="line">   <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">   <span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">   </span>{</div>
<div class="line">     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a> = <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells();</div>
<div class="line">     <a class="code" href="classVector.html">Vector&lt;double&gt;</a>     cell_indices(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>);</div>
<div class="line">     {</div>
<div class="line">       std::vector&lt;unsigned int&gt; ordered_indices;</div>
<div class="line">       <span class="keywordflow">switch</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.dof_renumbering)</div>
<div class="line">         {</div>
<div class="line">           <span class="keywordflow">case</span> <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">Settings::DoFRenumberingStrategy::downstream</a>:</div>
<div class="line">             ordered_indices =</div>
<div class="line">               <a class="code" href="namespaceStep63.html#a679f6c35915713a90230f261b38f041e">create_downstream_cell_ordering</a>(dof_handler, advection_direction);</div>
<div class="line">             <span class="keywordflow">break</span>;</div>
<div class="line">  </div>
<div class="line">           <span class="keywordflow">case</span> Settings::DoFRenumberingStrategy::upstream:</div>
<div class="line">             ordered_indices =</div>
<div class="line">               <a class="code" href="namespaceStep63.html#a679f6c35915713a90230f261b38f041e">create_downstream_cell_ordering</a>(dof_handler,</div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line">-1.0 advection_direction);</div>
<div class="line">             <span class="keywordflow">break</span>;</div>
<div class="line">  </div>
<div class="line">           <span class="keywordflow">case</span> <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">Settings::DoFRenumberingStrategy::random</a>:</div>
<div class="line">             ordered_indices = <a class="code" href="namespaceStep63.html#a5bcdd1e04c358777541a2922f8803db4">create_random_cell_ordering</a>(dof_handler);</div>
<div class="line">             <span class="keywordflow">break</span>;</div>
<div class="line">  </div>
<div class="line">           <span class="keywordflow">case</span> <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1acc6b05c836e9f74fb7ab9390ffc26f1c">Settings::DoFRenumberingStrategy::none</a>:</div>
<div class="line">             ordered_indices.resize(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>);</div>
<div class="line">             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">               ordered_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] = <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>;</div>
<div class="line">             <span class="keywordflow">break</span>;</div>
<div class="line">  </div>
<div class="line">           <span class="keywordflow">default</span>:</div>
<div class="line">             <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">             <span class="keywordflow">break</span>;</div>
<div class="line">         }</div>
<div class="line">  </div>
<div class="line">       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">         cell_indices(ordered_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>);</div>
<div class="line">     }</div>
</div><!-- fragment --><p></em></p>
<p><em> The remainder of the function is then straightforward, given previous tutorial programs:</em></p>
<p><em></p><div class="fragment"><div class="line">  <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">attach_dof_handler</a>(dof_handler);</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, <span class="stringliteral">&quot;solution&quot;</span>);</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(cell_indices, <span class="stringliteral">&quot;cell_index&quot;</span>);</div>
<div class="line">  data_out.<a class="code" href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">build_patches</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> std::string filename =</div>
<div class="line">    <span class="stringliteral">&quot;solution-&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>) + <span class="stringliteral">&quot;.vtu&quot;</span>;</div>
<div class="line">  std::ofstream <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>(filename.c_str());</div>
<div class="line">  data_out.<a class="code" href="classDataOutInterface.html#a93c780f93105e0daaa76c6c43694b4ae">write_vtu</a>(<a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>);</div>
<div class="line">}</div>
</div><!-- fragment --><p></em></p>
<p><em> <a class="anchor" id="codeAdvectionProblemruncode"></a> </p><h4><code>AdvectionProblem::run()</code></h4>
<p></em></p>
<p><em></em></p>
<p><em> As in most tutorials, this function creates/refines the mesh and calls the various functions defined above to set up, assemble, solve, and output the results.</em></p>
<p><em> In cycle zero, we generate the mesh for the on the square <code>[-1,1]^dim</code> with a hole of radius 3/10 units centered at the origin. For objects with <code>manifold_id</code> equal to one (namely, the faces adjacent to the hole), we assign a spherical manifold.</em></p>
<p><em></p><div class="fragment"><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">AdvectionProblem&lt;dim&gt;::run</a>()</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> = 0; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt; (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.fe_degree == 1 ? 7 : 5);</div>
<div class="line">         ++<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>)</div>
<div class="line">      {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;  Cycle &quot;</span> &lt;&lt; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> == 0)</div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="namespaceGridGenerator.html#add14cab546d033c1eaacc9234c64ebcd">GridGenerator::hyper_cube_with_cylindrical_hole</a>(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>,</div>
<div class="line">                                                            0.3,</div>
<div class="line">                                                            1.0);</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classSphericalManifold.html">SphericalManifold&lt;dim&gt;</a> manifold_description(<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>(0, 0));</div>
<div class="line">            <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.set_manifold(1, manifold_description);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.refine_global();</div>
<div class="line"> </div>
<div class="line">        setup_system();</div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;     Number of active cells:       &quot;</span></div>
<div class="line">                  &lt;&lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells() &lt;&lt; <span class="stringliteral">&quot; (&quot;</span></div>
<div class="line">                  &lt;&lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_levels() &lt;&lt; <span class="stringliteral">&quot; levels)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;     Number of degrees of freedom: &quot;</span></div>
<div class="line">                  &lt;&lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>() &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        assemble_system_and_multigrid();</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.output)</div>
<div class="line">          output_results(<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>);</div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; std::endl;</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Step63</span></div>
</div><!-- fragment --><p></em></p>
<p><em> <a class="anchor" id="Thecodemaincodefunction"></a> </p><h3>The <code>main</code> function</h3>
<p></em></p>
<p><em></em></p>
<p><em> Finally, the main function is like most tutorials. The only interesting bit is that we require the user to pass a <code>.prm</code> file as a sole command line argument. If no parameter file is given, the program will output the contents of a sample parameter file with all default values to the screen that the user can then copy and paste into their own <code>.prm</code> file.</em></p>
<p><em></p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(<span class="keywordtype">int</span> argc, charargv[])</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="structStep63_1_1Settings.html">Step63::Settings</a> <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>;</div>
<div class="line">      <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.get_parameters((argc &gt; 1) ? (argv[1]) : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classStep63_1_1AdvectionProblem.html">Step63::AdvectionProblem&lt;2&gt;</a> advection_problem_2d(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>);</div>
<div class="line">      advection_problem_2d.run();</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (<a class="code" href="parameter__handler__0_8txt.html#ad919e2b915d8e8226aef004c2d8399a8">std::exception</a> &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p> <a class="anchor" id="Results"></a></p><h1>Results</h1>
<p></em></p>
<p><em></em></p>
<p><em> <a class="anchor" id="GMRESIterationNumbers"></a></p><h3>GMRES Iteration Numbers </h3>
<p></em></p>
<p><em></em></p>
<p><em> The major advantage for GMG is that it is an \(\mathcal{O}(n)\) method,that is, the complexity of the problem increases linearly with theproblem size. To show then that the linear solver presented in thistutorial is in fact \(\mathcal{O}(n)\) , all one needs to do is show thatthe iteration counts for the GMRES solve stay roughly constant as werefine the mesh. Each of the following tables gives the GMRES iteration counts to reduce theinitial residual by a factor of \(10^8\) . We selected a sufficient number of smoothing steps(based on the method) to get iteration numbers independent of mesh size. Ascan be seen from the tables below, the method is indeed \(\mathcal{O}(n)\) . <a class="anchor" id="DoFCellRenumbering"></a></p><h4>DoF/Cell Renumbering </h4>
<p></em></p>
<p><em></em></p>
<p><em> The point-wise smoothers ("Jacobi" and "SOR") get applied in the order theDoFs are numbered on each level. We can influence this using theDoFRenumbering namespace. The block smoothers are applied based on theordering we set in <code>setup_smoother()</code>. We can visualize this numbering. Thefollowing pictures show the cell numbering of the active cells in downstream,random, and upstream numbering (left to right): <img src="https://www.dealii.org/images/steps/developer/step-63-cell-order.png" alt="" class="inline"/> <br  />
 Let us start with the additive smoothers. The following table showsthe number of iterations necessary to obtain convergence from GMRES: </p><table align="center" class="doxtable">
<tr>
<th></th><th></th><th colspan="1">\(Q_1\) </th><th colspan="7">Smoother (smoothing steps)  </th></tr>
<tr>
<th></th><th></th><th></th><th colspan="3">Jacobi (6) </th><th></th><th colspan="3">Block Jacobi (3)  </th></tr>
<tr>
<th></th><th></th><th></th><th colspan="3">Renumbering Strategy </th><th></th><th colspan="3">Renumbering Strategy  </th></tr>
<tr>
<th>Cells </th><th></th><th>DoFs </th><th>Downstream </th><th>Random </th><th>Upstream </th><th></th><th>Downstream </th><th>Random </th><th>Upstream  </th></tr>
<tr>
<th>32 </th><th></th><th>48 </th><td>3 </td><td>3 </td><td>3 </td><th></th><td>3 </td><td>3 </td><td>3  </td></tr>
<tr>
<th>128 </th><th></th><th>160 </th><td>6 </td><td>6 </td><td>6 </td><th></th><td>6 </td><td>6 </td><td>6  </td></tr>
<tr>
<th>512 </th><th></th><th>576 </th><td>11 </td><td>11 </td><td>11 </td><th></th><td>9 </td><td>9 </td><td>9  </td></tr>
<tr>
<th>2048 </th><th></th><th>2176 </th><td>15 </td><td>15 </td><td>15 </td><th></th><td>13 </td><td>13 </td><td>13  </td></tr>
<tr>
<th>8192 </th><th></th><th>8448 </th><td>18 </td><td>18 </td><td>18 </td><th></th><td>15 </td><td>15 </td><td>15  </td></tr>
<tr>
<th>32768 </th><th></th><th>33280 </th><td>20 </td><td>20 </td><td>20 </td><th></th><td>16 </td><td>16 </td><td>16  </td></tr>
<tr>
<th>131072 </th><th></th><th>132096 </th><td>20 </td><td>20 </td><td>20 </td><th></th><td>16 </td><td>16 </td><td>16  </td></tr>
</table>
<p><br  />
 We see that renumbering theDoFs/cells has no effect on convergence speed. This is because thesesmoothers compute operations on each DoF (point-smoother) or cell(block-smoother) independently and add up the results. Since we candefine these smoothers as an application of a sum of matrices, andmatrix addition is commutative, the order at which we sum thedifferent components will not affect the end result. On the other hand, the situation is different for multiplicative smoothers: </p><table align="center" class="doxtable">
<tr>
<th></th><th></th><th colspan="1">\(Q_1\) </th><th colspan="7">Smoother (smoothing steps)  </th></tr>
<tr>
<th></th><th></th><th></th><th colspan="3">SOR (3) </th><th></th><th colspan="3">Block SOR (1)  </th></tr>
<tr>
<th></th><th></th><th></th><th colspan="3">Renumbering Strategy </th><th></th><th colspan="3">Renumbering Strategy  </th></tr>
<tr>
<th>Cells </th><th></th><th>DoFs </th><th>Downstream </th><th>Random </th><th>Upstream </th><th></th><th>Downstream </th><th>Random </th><th>Upstream  </th></tr>
<tr>
<th>32 </th><th></th><th>48 </th><td>2 </td><td>2 </td><td>3 </td><th></th><td>2 </td><td>2 </td><td>3  </td></tr>
<tr>
<th>128 </th><th></th><th>160 </th><td>5 </td><td>5 </td><td>7 </td><th></th><td>5 </td><td>5 </td><td>7  </td></tr>
<tr>
<th>512 </th><th></th><th>576 </th><td>7 </td><td>9 </td><td>11 </td><th></th><td>7 </td><td>7 </td><td>12  </td></tr>
<tr>
<th>2048 </th><th></th><th>2176 </th><td>10 </td><td>12 </td><td>15 </td><th></th><td>8 </td><td>10 </td><td>17  </td></tr>
<tr>
<th>8192 </th><th></th><th>8448 </th><td>11 </td><td>15 </td><td>19 </td><th></th><td>10 </td><td>11 </td><td>20  </td></tr>
<tr>
<th>32768 </th><th></th><th>33280 </th><td>12 </td><td>16 </td><td>20 </td><th></th><td>10 </td><td>12 </td><td>21  </td></tr>
<tr>
<th>131072 </th><th></th><th>132096 </th><td>12 </td><td>16 </td><td>19 </td><th></th><td>11 </td><td>12 </td><td>21  </td></tr>
</table>
<p><br  />
 Here, we can speed upconvergence by renumbering the DoFs/cells in the advection direction,and similarly, we can slow down convergence if we do the renumberingin the opposite direction. This is because advection-dominatedproblems have a directional flow of information (in the advectiondirection) which, given the right renumbering of DoFs/cells,multiplicative methods are able to capture. This feature of multiplicative methods is, however, dependent on thevalue of \(\varepsilon\) . As we increase \(\varepsilon\) and the problembecomes more diffusion-dominated, we have a more uniform propagationof information over the mesh and there is a diminished advantage forrenumbering in the advection direction. On the opposite end, in theextreme case of \(\varepsilon=0\) (advection-only), we have a 1st-orderPDE and multiplicative methods with the right renumbering becomeeffective solvers: A correct downstream numbering may lead to methodsthat require only a single iteration because information can bepropagated from the inflow boundary downstream, with no informationtransport in the opposite direction. (Note, however, that in the caseof \(\varepsilon=0\) , special care must be taken for the boundaryconditions in this case).</em></p>
<p><em> <a class="anchor" id="Pointvsblocksmoothers"></a></p><h4>Point vs. block smoothers </h4>
<p></em></p>
<p><em></em></p>
<p><em> We will limit the results to runs using the downstreamrenumbering. Here is a cross comparison of all four smoothers for both \(Q_1\) and \(Q_3\) elements: </p><table align="center" class="doxtable">
<tr>
<th></th><td></td><th colspan="1">\(Q_1\) </th><th colspan="4">Smoother (smoothing steps) </th><th></th><th colspan="1">\(Q_3\) </th><th colspan="4">Smoother (smoothing steps)  </th></tr>
<tr>
<th colspan="1">Cells </th><td></td><th colspan="1">DoFs </th><th colspan="1">Jacobi (6) </th><th colspan="1">Block Jacobi (3) </th><th colspan="1">SOR (3) </th><th colspan="1">Block SOR (1) </th><th></th><th colspan="1">DoFs </th><th colspan="1">Jacobi (6) </th><th colspan="1">Block Jacobi (3) </th><th colspan="1">SOR (3) </th><th colspan="1">Block SOR (1)  </th></tr>
<tr>
<th>32 </th><td></td><th>48 </th><td>3 </td><td>3 </td><td>2 </td><td>2 </td><td></td><th>336 </th><td>15 </td><td>14 </td><td>15 </td><td>6  </td></tr>
<tr>
<th>128 </th><td></td><th>160 </th><td>6 </td><td>6 </td><td>5 </td><td>5 </td><td></td><th>1248 </th><td>23 </td><td>18 </td><td>21 </td><td>9  </td></tr>
<tr>
<th>512 </th><td></td><th>576 </th><td>11 </td><td>9 </td><td>7 </td><td>7 </td><td></td><th>4800 </th><td>29 </td><td>21 </td><td>28 </td><td>9  </td></tr>
<tr>
<th>2048 </th><td></td><th>2176 </th><td>15 </td><td>13 </td><td>10 </td><td>8 </td><td></td><th>18816 </th><td>33 </td><td>22 </td><td>32 </td><td>9  </td></tr>
<tr>
<th>8192 </th><td></td><th>8448 </th><td>18 </td><td>15 </td><td>11 </td><td>10 </td><td></td><th>74496 </th><td>35 </td><td>22 </td><td>34 </td><td>10  </td></tr>
<tr>
<th>32768 </th><td></td><th>33280 </th><td>20 </td><td>16 </td><td>12 </td><td>10 </td><td></td></tr>
<tr>
<th>131072 </th><td></td><th>132096 </th><td>20 </td><td>16 </td><td>12 </td><td>11 </td><td></td></tr>
</table>
<p><br  />
 We see that for \(Q_1\) , both multiplicative smoothers require a smallercombination of smoothing steps and iteration counts than eitheradditive smoother. However, when we increase the degree to a \(Q_3\) element, there is a clear advantage for the block smoothers in termsof the number of smoothing steps and iterations required tosolve. Specifically, the block SOR smoother gives constant iterationcounts over the degree, and the block Jacobi smoother only sees abouta 38% increase in iterations compared to 75% and 183% for Jacobi andSOR respectively. <a class="anchor" id="Cost"></a></p><h3>Cost </h3>
<p></em></p>
<p><em></em></p>
<p><em> Iteration counts do not tell the full story in the optimality of a onesmoother over another. Obviously we must examine the cost of aniteration. Block smoothers here are at a disadvantage as they arehaving to construct and invert a cell matrix for each cell. Here is acomparison of solve times for a \(Q_3\) element with 74,496 DoFs: </p><table align="center" class="doxtable">
<tr>
<th colspan="1">\(Q_3\) </th><th colspan="4">Smoother (smoothing steps)  </th></tr>
<tr>
<th colspan="1">DoFs </th><th colspan="1">Jacobi (6) </th><th colspan="1">Block Jacobi (3) </th><th colspan="1">SOR (3) </th><th colspan="1">Block SOR (1)  </th></tr>
<tr>
<th>74496 </th><td>0.68s </td><td>5.82s </td><td>1.18s </td><td>1.02s  </td></tr>
</table>
<p><br  />
 The smoother that requires the most iterations (Jacobi) actually takesthe shortest time (roughly 2/3 the time of the next fastestmethod). This is because all that is required to apply a Jacobismoothing step is multiplication by a diagonal matrix which is verycheap. On the other hand, while SOR requires over 3x more iterations(each with 3x more smoothing steps) than block SOR, the times areroughly equivalent, implying that a smoothing step of block SOR isroughly 9x slower than a smoothing step of SOR. Lastly, block Jacobiis almost 6x more expensive than block SOR, which intuitively makessense from the fact that 1 step of each method has the same cost(inverting the cell matrices and either adding or multiply themtogether), and block Jacobi has 3 times the number of smoothing steps periteration with 2 times the iterations.</em></p>
<p><em> <a class="anchor" id="Additionalpoints"></a></p><h3>Additional points </h3>
<p></em></p>
<p><em></em></p>
<p><em> There are a few more important points to mention: </p><ol>
<li>
For a mesh distributed in parallel, multiplicative methods cannotbe executed over the entire domain. This is because they operate onecell at a time, and downstream cells can only be handled once upstreamcells have already been done. This is fine on a single processor: Theprocessor just goes through the list of cells one after theother. However, in parallel, it would imply that some processors areidle because upstream processors have not finished doing the work oncells upstream from the ones owned by the current processor. Once theupstream processors are done, the downstream ones can start, but bythat time the upstream processors have no work left. In other words,most of the time during these smoother steps, most processors are infact idle. This is not how one obtains good parallel scalability! One can use a hybrid method wherea multiplicative smoother is applied on each subdomain, but as youincrease the number of subdomains, the method approaches the behaviorof an additive method. This is a major disadvantage to these methods.  <br  />
 </li>
<li>
Current research into block smoothers suggest that soon we will beable to compute the inverse of the cell matrices much cheaper thanwhat is currently being done inside deal.II. This research is based onthe fast diagonalization method (dating back to the 1960s) and hasbeen used in the spectral community for around 20 years (see, e.g., <a href="https://doi.org/10.1007/s10915-004-4787-3">Hybrid Multigrid/Schwarz Algorithms for the Spectral Element Method by Lottes and Fischer</a>). There are currently efforts to generalize thesemethods to DG and make them more robust. Also, it seems that oneshould be able to take advantage of matrix-free implementations andthe fact that, in the interior of the domain, cell matrices tend tolook very similar, allowing fewer matrix inverse computations.  </li>
</ol>
<p><br  />
 Combining 1. and 2. gives a good reason for expecting that a methodlike block Jacobi could become very powerful in the future, eventhough currently for these examples it is quite slow.</em></p>
<p><em> <a class="anchor" id="Possibilitiesforextensions"></a></p><h3>Possibilities for extensions </h3>
<p></em></p>
<p><em></em></p>
<p><em> <a class="anchor" id="ConstantiterationsforQsub5sub"></a></p><h4>Constant iterations for Q<sub>5</sub> </h4>
<p></em></p>
<p><em></em></p>
<p><em> Change the number of smoothing steps and the smoother relaxationparameter (set in <code>Smoother::AdditionalData()</code> inside <code>create_smoother()</code> , only necessary for point smoothers) sothat we maintain a constant number of iterations for a \(Q_5\) element. <a class="anchor" id="Effectivenessofrenumberingforchangingepsilon"></a></p><h4>Effectiveness of renumbering for changing epsilon </h4>
<p></em></p>
<p><em></em></p>
<p><em> Increase/decrease the parameter "Epsilon" in the <code>.prm</code> files of themultiplicative methods and observe for which values renumbering nolonger influences convergence speed. <a class="anchor" id="Meshadaptivity"></a></p><h4>Mesh adaptivity </h4>
<p></em></p>
<p><em></em></p>
<p><em> The code is set up to work correctly with an adaptively refined mesh (theinterface matrices are created and set). Devise a suitable refinementcriterium or try the <a class="el" href="classKellyErrorEstimator.html">KellyErrorEstimator</a> class.</em></p>
<p><em> <a class="anchor" id="PlainProg"></a></p><h1>The plain program</h1>
<p></em></p>
<p><em> </p><div class="fragment"><div class="line"><span class="comment">/* ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2018 - 2021 by the deal.II authors</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file is part of the deal.II library.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The deal.II library is free software; you can use it, redistribute</span></div>
<div class="line"><span class="comment"> * it, and/or modify it under the terms of the GNU Lesser General</span></div>
<div class="line"><span class="comment"> * Public License as published by the Free Software Foundation; either</span></div>
<div class="line"><span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><span class="comment"> * The full text of the license can be found in the file LICENSE.md at</span></div>
<div class="line"><span class="comment"> * the top level directory of deal.II.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Authors: Thomas C. Clevenger, Clemson University</span></div>
<div class="line"><span class="comment"> *          Timo Heister, Clemson University and University of Utah</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2tensor__function_8h.html">deal.II/base/tensor_function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2timer_8h.html">deal.II/base/timer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2parameter__handler_8h.html">deal.II/base/parameter_handler.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2vector_8h.html">deal.II/lac/vector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2full__matrix_8h.html">deal.II/lac/full_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2sparse__matrix_8h.html">deal.II/lac/sparse_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2solver__gmres_8h.html">deal.II/lac/solver_gmres.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2precondition_8h.html">deal.II/lac/precondition.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2relaxation__block_8h.html">deal.II/lac/relaxation_block.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__refinement_8h.html">deal.II/grid/grid_refinement.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2manifold__lib_8h.html">deal.II/grid/manifold_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__out_8h.html">deal.II/grid/grid_out.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__renumbering_8h.html">deal.II/dofs/dof_renumbering.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2mapping__q_8h.html">deal.II/fe/mapping_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__values_8h.html">deal.II/fe/fe_values.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2matrix__tools_8h.html">deal.II/numerics/matrix_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__constrained__dofs_8h.html">deal.II/multigrid/mg_constrained_dofs.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2multigrid_8h.html">deal.II/multigrid/multigrid.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__transfer_8h.html">deal.II/multigrid/mg_transfer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__tools_8h.html">deal.II/multigrid/mg_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__coarse_8h.html">deal.II/multigrid/mg_coarse.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__smoother_8h.html">deal.II/multigrid/mg_smoother.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_2mg__matrix_8h.html">deal.II/multigrid/mg_matrix.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;random&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="meshworker_2mesh__loop_8h.html">deal.II/meshworker/mesh_loop.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceStep63.html">Step63</a></div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">struct </span><a class="code" href="structScratchData.html">ScratchData</a></div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="work__stream__0_8txt.html#a8f80058531659e3e5ae0f7e91a963519">ScratchData</a>(<span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        quadrature_degree)</div>
<div class="line">      : fe_values(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                  <a class="code" href="classQGauss.html">QGauss</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;(quadrature_degree),</div>
<div class="line">                  <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa378cbcddbdf54fb3f9f0acf47b1c4719">update_hessians</a> |</div>
<div class="line">                    <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="work__stream__0_8txt.html#a8f80058531659e3e5ae0f7e91a963519">ScratchData</a>(<span class="keyword">const</span> <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a> &amp;scratch_data)</div>
<div class="line">      : fe_values(scratch_data.fe_values.get_fe(),</div>
<div class="line">                  scratch_data.fe_values.get_quadrature(),</div>
<div class="line">                  <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa378cbcddbdf54fb3f9f0acf47b1c4719">update_hessians</a> |</div>
<div class="line">                    <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">struct </span><a class="code" href="structCopyData.html">CopyData</a></div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="structCopyData.html">CopyData</a>() = <span class="keywordflow">default</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a>                   <a class="code" href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a>;</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a>                       cell_rhs;</div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; <a class="code" href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a>;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">struct </span><a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a></div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">enum</span> DoFRenumberingStrategy</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1acc6b05c836e9f74fb7ab9390ffc26f1c">none</a>,</div>
<div class="line">      <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">downstream</a>,</div>
<div class="line">      upstream,</div>
<div class="line">      <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">random</a></div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> get_parameters(<span class="keyword">const</span> std::string &amp;prm_filename);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span>                 <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa6fff35c961658bfea21e8a3ae468cec">epsilon</a>;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>           <a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>;</div>
<div class="line">    std::string            smoother_type;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>           smoothing_steps;</div>
<div class="line">    DoFRenumberingStrategy dof_renumbering;</div>
<div class="line">    <span class="keywordtype">bool</span>                   with_streamline_diffusion;</div>
<div class="line">    <span class="keywordtype">bool</span>                   <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="structStep63_1_1Settings.html#ac81d04517ae8edec21f699e62fa47fd8">Settings::get_parameters</a>(<span class="keyword">const</span> std::string &amp;prm_filename)</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">/* First declare the parameters... */</span></div>
<div class="line">    <a class="code" href="classParameterHandler.html">ParameterHandler</a> prm;</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Epsilon&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;0.005&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0),</div>
<div class="line">                      <span class="stringliteral">&quot;Diffusion parameter&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Fe degree&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(1),</div>
<div class="line">                      <span class="stringliteral">&quot;Finite Element degree&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Smoother type&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;block SOR&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;SOR|Jacobi|block SOR|block Jacobi&quot;</span>),</div>
<div class="line">                      <span class="stringliteral">&quot;Select smoother: SOR|Jacobi|block SOR|block Jacobi&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Smoothing steps&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(1),</div>
<div class="line">                      <span class="stringliteral">&quot;Number of smoothing steps&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(</div>
<div class="line">      <span class="stringliteral">&quot;DoF renumbering&quot;</span>,</div>
<div class="line">      <span class="stringliteral">&quot;downstream&quot;</span>,</div>
<div class="line">      <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;none|downstream|upstream|random&quot;</span>),</div>
<div class="line">      <span class="stringliteral">&quot;Select DoF renumbering: none|downstream|upstream|random&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;With streamline diffusion&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Enable streamline diffusion stabilization: true|false&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Output&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Generate graphical output: true|false&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* ...and then try to read their values from the input file: */</span></div>
<div class="line">    <span class="keywordflow">if</span> (prm_filename.empty())</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a4ac3a8b19ade16e96e8ea25906daf23a">print_parameters</a>(std::cout, <a class="code" href="group__Exceptions.html#ga8364dda711b93753c6809eefe2a8e827a3a1480568c2713f53dcb21319bb28093">ParameterHandler::Text</a>);</div>
<div class="line">        <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(</div>
<div class="line">          <span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;Please pass a .prm file as the first argument!&quot;</span>));</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">parse_input</a>(prm_filename);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa6fff35c961658bfea21e8a3ae468cec">epsilon</a>         = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Epsilon&quot;</span>);</div>
<div class="line">    <a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>       = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Fe degree&quot;</span>);</div>
<div class="line">    smoother_type   = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;Smoother type&quot;</span>);</div>
<div class="line">    smoothing_steps = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Smoothing steps&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> std::string <a class="code" href="fe__q__base__0_8txt.html#ac01155b6a1d9bf8e09c14f9a454cdfea">renumbering</a> = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;DoF renumbering&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="fe__q__base__0_8txt.html#ac01155b6a1d9bf8e09c14f9a454cdfea">renumbering</a> == <span class="stringliteral">&quot;none&quot;</span>)</div>
<div class="line">      dof_renumbering = <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1acc6b05c836e9f74fb7ab9390ffc26f1c">DoFRenumberingStrategy::none</a>;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="fe__q__base__0_8txt.html#ac01155b6a1d9bf8e09c14f9a454cdfea">renumbering</a> == <span class="stringliteral">&quot;downstream&quot;</span>)</div>
<div class="line">      dof_renumbering = <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">DoFRenumberingStrategy::downstream</a>;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="fe__q__base__0_8txt.html#ac01155b6a1d9bf8e09c14f9a454cdfea">renumbering</a> == <span class="stringliteral">&quot;upstream&quot;</span>)</div>
<div class="line">      dof_renumbering = DoFRenumberingStrategy::upstream;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="fe__q__base__0_8txt.html#ac01155b6a1d9bf8e09c14f9a454cdfea">renumbering</a> == <span class="stringliteral">&quot;random&quot;</span>)</div>
<div class="line">      dof_renumbering = <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">DoFRenumberingStrategy::random</a>;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>,</div>
<div class="line">                  <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;The &lt;DoF renumbering&gt; parameter has &quot;</span></div>
<div class="line">                             <span class="stringliteral">&quot;an invalid value.&quot;</span>));</div>
<div class="line"> </div>
<div class="line">    with_streamline_diffusion = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;With streamline diffusion&quot;</span>);</div>
<div class="line">    <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>                    = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;Output&quot;</span>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  std::vector&lt;unsigned int&gt;</div>
<div class="line">  <a class="code" href="namespaceStep63.html#a679f6c35915713a90230f261b38f041e">create_downstream_cell_ordering</a>(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div>
<div class="line">                                  <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a>   <a class="code" href="dofs__0_8txt.html#ae704d52abb496c815f42849c4de0f458">direction</a>,</div>
<div class="line">                                  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>     <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">  {</div>
<div class="line">    std::vector&lt;typename DoFHandler&lt;dim&gt;::level_cell_iterator&gt; ordered_cells;</div>
<div class="line">    ordered_cells.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().n_cells(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#ga8c046284df67198c2d82c25950ea1ea3">cell_iterators_on_level</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>))</div>
<div class="line">      ordered_cells.push_back(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> DoFRenumbering::</div>
<div class="line">      CompareDownstream&lt;typename DoFHandler&lt;dim&gt;::level_cell_iterator, <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;</div>
<div class="line">        comparator(<a class="code" href="dofs__0_8txt.html#ae704d52abb496c815f42849c4de0f458">direction</a>);</div>
<div class="line">    std::sort(ordered_cells.begin(), ordered_cells.end(), comparator);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;unsigned&gt; ordered_indices;</div>
<div class="line">    ordered_indices.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().n_cells(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : ordered_cells)</div>
<div class="line">      ordered_indices.push_back(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;index());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ordered_indices;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  std::vector&lt;unsigned int&gt;</div>
<div class="line">  <a class="code" href="namespaceStep63.html#a679f6c35915713a90230f261b38f041e">create_downstream_cell_ordering</a>(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div>
<div class="line">                                  <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a>   <a class="code" href="dofs__0_8txt.html#ae704d52abb496c815f42849c4de0f458">direction</a>)</div>
<div class="line">  {</div>
<div class="line">    std::vector&lt;typename DoFHandler&lt;dim&gt;::active_cell_iterator&gt; ordered_cells;</div>
<div class="line">    ordered_cells.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().n_active_cells());</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">      ordered_cells.push_back(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> DoFRenumbering::</div>
<div class="line">      CompareDownstream&lt;typename DoFHandler&lt;dim&gt;::active_cell_iterator, <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;</div>
<div class="line">        comparator(<a class="code" href="dofs__0_8txt.html#ae704d52abb496c815f42849c4de0f458">direction</a>);</div>
<div class="line">    std::sort(ordered_cells.begin(), ordered_cells.end(), comparator);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;unsigned int&gt; ordered_indices;</div>
<div class="line">    ordered_indices.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().n_active_cells());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : ordered_cells)</div>
<div class="line">      ordered_indices.push_back(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;index());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ordered_indices;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  std::vector&lt;unsigned int&gt;</div>
<div class="line">  <a class="code" href="namespaceStep63.html#a5bcdd1e04c358777541a2922f8803db4">create_random_cell_ordering</a>(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div>
<div class="line">                              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>     <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">  {</div>
<div class="line">    std::vector&lt;unsigned int&gt; ordered_cells;</div>
<div class="line">    ordered_cells.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().n_cells(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#ga8c046284df67198c2d82c25950ea1ea3">cell_iterators_on_level</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>))</div>
<div class="line">      ordered_cells.push_back(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;index());</div>
<div class="line"> </div>
<div class="line">    std::mt19937 random_number_generator;</div>
<div class="line">    std::shuffle(ordered_cells.begin(),</div>
<div class="line">                 ordered_cells.end(),</div>
<div class="line">                 random_number_generator);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ordered_cells;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  std::vector&lt;unsigned int&gt;</div>
<div class="line">  <a class="code" href="namespaceStep63.html#a5bcdd1e04c358777541a2922f8803db4">create_random_cell_ordering</a>(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler)</div>
<div class="line">  {</div>
<div class="line">    std::vector&lt;unsigned int&gt; ordered_cells;</div>
<div class="line">    ordered_cells.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().n_active_cells());</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">      ordered_cells.push_back(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;index());</div>
<div class="line"> </div>
<div class="line">    std::mt19937 random_number_generator;</div>
<div class="line">    std::shuffle(ordered_cells.begin(),</div>
<div class="line">                 ordered_cells.end(),</div>
<div class="line">                 random_number_generator);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ordered_cells;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span><a class="code" href="classRightHandSide.html">RightHandSide</a> : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="functions__0_8txt.html#af9f808a82e8c618e2e7a19dd08a9eae3">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; <a class="code" href="parsed__convergence__table__0_8txt.html#a8a90f5ba57a42a3fd4c067e00f8b8aea">p</a>,</div>
<div class="line">                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a> = 0) <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="auto__derivative__function__0_8txt.html#a53f941360577ad71fbd6bc110ec4f4de">value_list</a>(<span class="keyword">const</span> <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;<a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>,</div>
<div class="line">                            std::vector&lt;double&gt; &amp;          <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>,</div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a> = 0) <span class="keyword">const override</span>;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">double</span> <a class="code" href="classStep63_1_1RightHandSide.html#a07b87d7025c7c5feca044c5c7d4296ef">RightHandSide&lt;dim&gt;::value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp;,</div>
<div class="line">                                   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a> == 0, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>, 0, 1));</div>
<div class="line">    (void)<a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0.0;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep63_1_1RightHandSide.html#a3c01155ebc56cbf683d19c7da2a27004">RightHandSide&lt;dim&gt;::value_list</a>(<span class="keyword">const</span> <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;<a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>,</div>
<div class="line">                                      std::vector&lt;double&gt; &amp;          <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>,</div>
<div class="line">                                      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>.size() == <a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>.size(),</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga6060b2304b8600f5efa0d31eeda0207d">ExcDimensionMismatch</a>(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>.size(), <a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>.size()));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>.size(); ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">      <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] = <a class="code" href="classRightHandSide.html">RightHandSide&lt;dim&gt;::value</a>(<a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>], <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span><a class="code" href="classBoundaryValues.html">BoundaryValues</a> : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="functions__0_8txt.html#af9f808a82e8c618e2e7a19dd08a9eae3">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; <a class="code" href="parsed__convergence__table__0_8txt.html#a8a90f5ba57a42a3fd4c067e00f8b8aea">p</a>,</div>
<div class="line">                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a> = 0) <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="auto__derivative__function__0_8txt.html#a53f941360577ad71fbd6bc110ec4f4de">value_list</a>(<span class="keyword">const</span> <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;<a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>,</div>
<div class="line">                            std::vector&lt;double&gt; &amp;          <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>,</div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a> = 0) <span class="keyword">const override</span>;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">double</span> <a class="code" href="classStep63_1_1BoundaryValues.html#a45af33d412a06517009ba6f342340256">BoundaryValues&lt;dim&gt;::value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; <a class="code" href="parsed__convergence__table__0_8txt.html#a8a90f5ba57a42a3fd4c067e00f8b8aea">p</a>,</div>
<div class="line">                                    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a> == 0, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>, 0, 1));</div>
<div class="line">    (void)<a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(<a class="code" href="parsed__convergence__table__0_8txt.html#a8a90f5ba57a42a3fd4c067e00f8b8aea">p</a>[0] - 1) &lt; 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-8 ||</div>
<div class="line">        (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(<a class="code" href="parsed__convergence__table__0_8txt.html#a8a90f5ba57a42a3fd4c067e00f8b8aea">p</a>[1] + 1) &lt; 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-8 &amp;&amp; <a class="code" href="parsed__convergence__table__0_8txt.html#a8a90f5ba57a42a3fd4c067e00f8b8aea">p</a>[0] &gt;= 0.5))</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">return</span> 1.0;</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">return</span> 0.0;</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep63_1_1BoundaryValues.html#abaf128aa6e5fbe6772fa6d4d8be5002c">BoundaryValues&lt;dim&gt;::value_list</a>(<span class="keyword">const</span> <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;<a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>,</div>
<div class="line">                                       std::vector&lt;double&gt; &amp;          <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>,</div>
<div class="line">                                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>.size() == <a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>.size(),</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga6060b2304b8600f5efa0d31eeda0207d">ExcDimensionMismatch</a>(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>.size(), <a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>.size()));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>.size(); ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">      <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] = <a class="code" href="classBoundaryValues.html">BoundaryValues&lt;dim&gt;::value</a>(<a class="code" href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a>[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>], <a class="code" href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">double</span> <a class="code" href="namespaceStep63.html#abe37f2d8c4bdc6c9dc4255f0a778aeec">compute_stabilization_delta</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>         hk,</div>
<div class="line">                                     <span class="keyword">const</span> <span class="keywordtype">double</span>         <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1ab87bd17d3acf6932f7bb6927f58fe3cd">eps</a>,</div>
<div class="line">                                     <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> dir,</div>
<div class="line">                                     <span class="keyword">const</span> <span class="keywordtype">double</span>         pk)</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> Peclet = dir.<a class="code" href="classTensor.html#afd0934b4edd71063f66a9c67540e79fc">norm</a>() * hk / (2.0 * <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1ab87bd17d3acf6932f7bb6927f58fe3cd">eps</a> * pk);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespaceDifferentiation_1_1SD.html#a66e76f1c4fdb9a31f4fabef8abee5f28">coth</a> =</div>
<div class="line">      (1.0 + <a class="code" href="base_2vectorization_8h.html#a19f846bda83b7e3f4531daacb40c64e1">std::exp</a>(-2.0 * Peclet)) / (1.0 - std::exp(-2.0 * Peclet));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> hk / (2.0 * dir.<a class="code" href="classTensor.html#afd0934b4edd71063f66a9c67540e79fc">norm</a>() * pk) * (<a class="code" href="namespaceDifferentiation_1_1SD.html#a66e76f1c4fdb9a31f4fabef8abee5f28">coth</a> - 1.0 / Peclet);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span>AdvectionProblem</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    AdvectionProblem(<span class="keyword">const</span> <a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a> &amp;<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>);</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">run</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">void</span> setup_system();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> IteratorType&gt;</div>
<div class="line">    <span class="keywordtype">void</span> assemble_cell(<span class="keyword">const</span> IteratorType &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>,</div>
<div class="line">                       <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a> &amp;  scratch_data,</div>
<div class="line">                       <a class="code" href="structCopyData.html">CopyData</a> &amp;          copy_data);</div>
<div class="line">    <span class="keywordtype">void</span> assemble_system_and_multigrid();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> setup_smoother();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>();</div>
<div class="line">    <span class="keywordtype">void</span> refine_grid();</div>
<div class="line">    <span class="keywordtype">void</span> output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>;</div>
<div class="line">    <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>    dof_handler;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a>     <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classMappingQ.html">MappingQ&lt;dim&gt;</a> <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSparsityPattern.html">SparsityPattern</a>      <a class="code" href="trilinos__sparse__matrix__0_8txt.html#ab4e34663c28496ee1b07f40fd5d00fa1">sparsity_pattern</a>;</div>
<div class="line">    <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> system_matrix;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>;</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> system_rhs;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparsityPattern&gt;</a> mg_sparsity_patterns;</div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparsityPattern&gt;</a> mg_interface_sparsity_patterns;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparseMatrix&lt;double&gt;</a>&gt; mg_matrices;</div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparseMatrix&lt;double&gt;</a>&gt; mg_interface_in;</div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparseMatrix&lt;double&gt;</a>&gt; mg_interface_out;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;Vector&lt;double&gt;</a>&gt; mg_matrix;</div>
<div class="line">    <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;Vector&lt;double&gt;</a>&gt; mg_interface_matrix_in;</div>
<div class="line">    <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;Vector&lt;double&gt;</a>&gt; mg_interface_matrix_out;</div>
<div class="line"> </div>
<div class="line">    std::unique_ptr&lt;MGSmoother&lt;Vector&lt;double&gt;&gt;&gt; mg_smoother;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using</span> SmootherType =</div>
<div class="line">      <a class="code" href="classRelaxationBlock.html">RelaxationBlock&lt;SparseMatrix&lt;double&gt;</a>, <a class="code" href="hdf5__0_8txt.html#aae153b86de45d3354cd3edd5b992435e">double</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;;</div>
<div class="line">    <span class="keyword">using</span> SmootherAdditionalDataType = <a class="code" href="relaxation__block__0_8txt.html#a2076fd56276055e74e230fad6edac013">SmootherType::AdditionalData</a>;</div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SmootherAdditionalDataType&gt;</a> smoother_data;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classMGConstrainedDoFs.html">MGConstrainedDoFs</a> mg_constrained_dofs;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> advection_direction;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a> <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <a class="code" href="classStep63_1_1AdvectionProblem.html#a20cff1646814eaae513b4a304d4dde33">AdvectionProblem&lt;dim&gt;::AdvectionProblem</a>(<span class="keyword">const</span> <a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a> &amp;<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>)</div>
<div class="line">    : <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>(<a class="code" href="classTriangulation.html">Triangulation</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;::limit_level_difference_at_vertices)</div>
<div class="line">    , dof_handler(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>)</div>
<div class="line">    , <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.<a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>)</div>
<div class="line">    , <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.<a class="code" href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a>)</div>
<div class="line">    , <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>)</div>
<div class="line">  {</div>
<div class="line">    advection_direction[0] = -<a class="code" href="function__time__0_8txt.html#aec9d63e7b1c02618470be701525a5211">std::sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a> / 6.0);</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> &gt;= 2)</div>
<div class="line">      advection_direction[1] = <a class="code" href="base_2vectorization_8h.html#a11c48f86a4f2adf21555e64049ecde8c">std::cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a> / 6.0);</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> &gt;= 3)</div>
<div class="line">      <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::setup_system()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a> = <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_levels();</div>
<div class="line"> </div>
<div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    system_rhs.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#addd15bc409c61d6f795f0132c574335b">clear</a>();</div>
<div class="line">    <a class="code" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a>(dof_handler, <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">      <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>, dof_handler, 0, <a class="code" href="classBoundaryValues.html">BoundaryValues&lt;dim&gt;</a>(), <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>);</div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">      <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>, dof_handler, 1, <a class="code" href="classBoundaryValues.html">BoundaryValues&lt;dim&gt;</a>(), <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>);</div>
<div class="line">    <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler,</div>
<div class="line">                                    dsp,</div>
<div class="line">                                    <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>,</div>
<div class="line">                                    <span class="comment">/*keep_constrained_dofs = */</span> <span class="keyword">false</span>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="trilinos__sparse__matrix__0_8txt.html#ab4e34663c28496ee1b07f40fd5d00fa1">sparsity_pattern</a>.copy_from(dsp);</div>
<div class="line">    system_matrix.reinit(<a class="code" href="trilinos__sparse__matrix__0_8txt.html#ab4e34663c28496ee1b07f40fd5d00fa1">sparsity_pattern</a>);</div>
<div class="line"> </div>
<div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#a9aed31323cbd7619edac310c47e7a7ad">distribute_mg_dofs</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;SOR&quot;</span> || <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;Jacobi&quot;</span>)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.dof_renumbering ==</div>
<div class="line">              <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">Settings::DoFRenumberingStrategy::downstream</a> ||</div>
<div class="line">            <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.dof_renumbering ==</div>
<div class="line">              Settings::DoFRenumberingStrategy::upstream)</div>
<div class="line">          {</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> <a class="code" href="dofs__0_8txt.html#ae704d52abb496c815f42849c4de0f458">direction</a> =</div>
<div class="line">              (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.dof_renumbering ==</div>
<div class="line">                   Settings::DoFRenumberingStrategy::upstream ?</div>
<div class="line">                 -1.0 :</div>
<div class="line">                 1.0) *</div>
<div class="line">              advection_direction;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a>; ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">              <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">DoFRenumbering::downstream</a>(dof_handler,</div>
<div class="line">                                         <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>,</div>
<div class="line">                                         <a class="code" href="dofs__0_8txt.html#ae704d52abb496c815f42849c4de0f458">direction</a>,</div>
<div class="line">                                         <span class="comment">/*dof_wise_renumbering = */</span> <span class="keyword">true</span>);</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.dof_renumbering ==</div>
<div class="line">                 <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">Settings::DoFRenumberingStrategy::random</a>)</div>
<div class="line">          {</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a>; ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">              <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">DoFRenumbering::random</a>(dof_handler, <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    mg_constrained_dofs.clear();</div>
<div class="line">    mg_constrained_dofs.initialize(dof_handler);</div>
<div class="line"> </div>
<div class="line">    mg_constrained_dofs.make_zero_boundary_constraints(dof_handler, {0, 1});</div>
<div class="line"> </div>
<div class="line">    mg_matrices.resize(0, <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a> - 1);</div>
<div class="line">    mg_matrices.clear_elements();</div>
<div class="line">    mg_interface_in.resize(0, <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a> - 1);</div>
<div class="line">    mg_interface_in.clear_elements();</div>
<div class="line">    mg_interface_out.resize(0, <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a> - 1);</div>
<div class="line">    mg_interface_out.clear_elements();</div>
<div class="line">    mg_sparsity_patterns.resize(0, <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a> - 1);</div>
<div class="line">    mg_interface_sparsity_patterns.resize(0, <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a> - 1);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a>; ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">      {</div>
<div class="line">        {</div>
<div class="line">          <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>),</div>
<div class="line">                                     dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">          <a class="code" href="namespaceMGTools.html#a19ba9ee4a2b65235c8bb3fb65ea8f4e0">MGTools::make_sparsity_pattern</a>(dof_handler, dsp, <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">          mg_sparsity_patterns[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].copy_from(dsp);</div>
<div class="line">          mg_matrices[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].reinit(mg_sparsity_patterns[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>]);</div>
<div class="line">        }</div>
<div class="line">        {</div>
<div class="line">          <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>),</div>
<div class="line">                                     dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">          <a class="code" href="namespaceMGTools.html#a8c677f65f8f1d21fb1f4c55cb90079e0">MGTools::make_interface_sparsity_pattern</a>(dof_handler,</div>
<div class="line">                                                   mg_constrained_dofs,</div>
<div class="line">                                                   dsp,</div>
<div class="line">                                                   <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">          mg_interface_sparsity_patterns[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].copy_from(dsp);</div>
<div class="line"> </div>
<div class="line">          mg_interface_in[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].reinit(mg_interface_sparsity_patterns[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>]);</div>
<div class="line">          mg_interface_out[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].reinit(mg_interface_sparsity_patterns[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>]);</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">class</span> IteratorType&gt;</div>
<div class="line">  <span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::assemble_cell(<span class="keyword">const</span> IteratorType &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>,</div>
<div class="line">                                            <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a> &amp;  scratch_data,</div>
<div class="line">                                            <a class="code" href="structCopyData.html">CopyData</a> &amp;          copy_data)</div>
<div class="line">  {</div>
<div class="line">    copy_data.level = <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;level();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> =</div>
<div class="line">      scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.get_fe().n_dofs_per_cell();</div>
<div class="line">    copy_data.dofs_per_cell = <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>;</div>
<div class="line">    copy_data.cell_matrix.reinit(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>, <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a> =</div>
<div class="line">      scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.<a class="code" href="classFEValues.html#ae053b49309f1dce22268c6bc8fe50cb2">get_quadrature</a>().size();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;is_level_cell() == <span class="keyword">false</span>)</div>
<div class="line">      copy_data.cell_rhs.reinit(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">    copy_data.local_dof_indices.resize(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">    <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;get_active_or_mg_dof_indices(copy_data.local_dof_indices);</div>
<div class="line"> </div>
<div class="line">    scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classRightHandSide.html">RightHandSide&lt;dim&gt;</a>  <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>;</div>
<div class="line">    std::vector&lt;double&gt; rhs_values(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>.value_list(scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.get_quadrature_points(),</div>
<div class="line">                               rhs_values);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> delta = (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.with_streamline_diffusion ?</div>
<div class="line">                            <a class="code" href="namespaceStep63.html#abe37f2d8c4bdc6c9dc4255f0a778aeec">compute_stabilization_delta</a>(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;diameter(),</div>
<div class="line">                                                        <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.epsilon,</div>
<div class="line">                                                        advection_direction,</div>
<div class="line">                                                        <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.fe_degree) :</div>
<div class="line">                            0.0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q_point)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">        {</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> = 0; <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>)</div>
<div class="line">            {</div>
<div class="line">              copy_data.cell_matrix(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>) +=</div>
<div class="line">                (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.epsilon *</div>
<div class="line">                 scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) *</div>
<div class="line">                 scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point) *</div>
<div class="line">                 scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.JxW(q_point)) +</div>
<div class="line">                (scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_value(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) *</div>
<div class="line">                 (advection_direction *</div>
<div class="line">                  scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point)) *</div>
<div class="line">                 scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.JxW(q_point))</div>
<div class="line">                + delta *</div>
<div class="line">                    (advection_direction *</div>
<div class="line">                     scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point)) *</div>
<div class="line">                    (advection_direction *</div>
<div class="line">                     scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point)) *</div>
<div class="line">                    scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.JxW(q_point) -</div>
<div class="line">                delta * <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.epsilon *</div>
<div class="line">                  <a class="code" href="base_2symmetric__tensor_8h.html#a4248760c880275bab1f288fc80f27039">trace</a>(scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_hessian(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, q_point)) *</div>
<div class="line">                  (advection_direction *</div>
<div class="line">                   scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point)) *</div>
<div class="line">                  scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.JxW(q_point);</div>
<div class="line">            }</div>
<div class="line">          <span class="keywordflow">if</span> (<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;is_level_cell() == <span class="keyword">false</span>)</div>
<div class="line">            {</div>
<div class="line">              copy_data.cell_rhs(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>) +=</div>
<div class="line">                scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_value(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) *</div>
<div class="line">                  rhs_values[q_point] * scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.JxW(q_point)</div>
<div class="line">                + delta * rhs_values[q_point] * advection_direction *</div>
<div class="line">                    scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.shape_grad(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q_point) *</div>
<div class="line">                    scratch_data.<a class="code" href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">fe_values</a>.JxW(q_point);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::assemble_system_and_multigrid()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> cell_worker_active =</div>
<div class="line">      [&amp;](<span class="keyword">const</span> decltype(dof_handler.<a class="code" href="classDoFHandler.html#a9a3bef554c6d22abe312e10e9475eecf">begin_active</a>()) &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>,</div>
<div class="line">          <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a> &amp;                          scratch_data,</div>
<div class="line">          <a class="code" href="structCopyData.html">CopyData</a> &amp;                                  copy_data) {</div>
<div class="line">        this-&gt;assemble_cell(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, scratch_data, copy_data);</div>
<div class="line">      };</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> copier_active = [&amp;](<span class="keyword">const</span> <a class="code" href="structCopyData.html">CopyData</a> &amp;copy_data) {</div>
<div class="line">      <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#a373fbdacd8c486e675b8d2bff8943192">distribute_local_to_global</a>(copy_data.cell_matrix,</div>
<div class="line">                                             copy_data.cell_rhs,</div>
<div class="line">                                             copy_data.local_dof_indices,</div>
<div class="line">                                             system_matrix,</div>
<div class="line">                                             system_rhs);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop</a>(dof_handler.<a class="code" href="classDoFHandler.html#a9a3bef554c6d22abe312e10e9475eecf">begin_active</a>(),</div>
<div class="line">                          dof_handler.<a class="code" href="classDoFHandler.html#a042c4bf0f59fef5e72dbcfbdd56b2782">end</a>(),</div>
<div class="line">                          cell_worker_active,</div>
<div class="line">                          copier_active,</div>
<div class="line">                          <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>, <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1),</div>
<div class="line">                          <a class="code" href="structCopyData.html">CopyData</a>(),</div>
<div class="line">                          <a class="code" href="namespaceMeshWorker.html#ac7a9db8b34d398d7d398d1e8809874aaacb8627085561cee8b7af9d74320696eb">MeshWorker::assemble_own_cells</a>);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;AffineConstraints&lt;double&gt;&gt; boundary_constraints(</div>
<div class="line">      <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels());</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_global_levels();</div>
<div class="line">         ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classIndexSet.html">IndexSet</a> locally_owned_level_dof_indices;</div>
<div class="line">        <a class="code" href="namespaceDoFTools.html#a1fef7be07cf379b661646e39b9354e17">DoFTools::extract_locally_relevant_level_dofs</a>(</div>
<div class="line">          dof_handler, <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>, locally_owned_level_dof_indices);</div>
<div class="line">        boundary_constraints[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].reinit(locally_owned_level_dof_indices);</div>
<div class="line">        boundary_constraints[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].add_lines(</div>
<div class="line">          mg_constrained_dofs.get_refinement_edge_indices(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">        boundary_constraints[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].add_lines(</div>
<div class="line">          mg_constrained_dofs.get_boundary_indices(<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>));</div>
<div class="line">        boundary_constraints[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].close();</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> cell_worker_mg =</div>
<div class="line">      [&amp;](<span class="keyword">const</span> decltype(dof_handler.<a class="code" href="classDoFHandler.html#a52af463de3283318bd4c651df7d35d24">begin_mg</a>()) &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>,</div>
<div class="line">          <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a> &amp;                      scratch_data,</div>
<div class="line">          <a class="code" href="structCopyData.html">CopyData</a> &amp;                              copy_data) {</div>
<div class="line">        this-&gt;assemble_cell(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, scratch_data, copy_data);</div>
<div class="line">      };</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> copier_mg = [&amp;](<span class="keyword">const</span> <a class="code" href="structCopyData.html">CopyData</a> &amp;copy_data) {</div>
<div class="line">      boundary_constraints[copy_data.level].distribute_local_to_global(</div>
<div class="line">        copy_data.cell_matrix,</div>
<div class="line">        copy_data.local_dof_indices,</div>
<div class="line">        mg_matrices[copy_data.level]);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; copy_data.dofs_per_cell; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> = 0; <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a> &lt; copy_data.dofs_per_cell; ++<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>)</div>
<div class="line">          <span class="keywordflow">if</span> (mg_constrained_dofs.is_interface_matrix_entry(</div>
<div class="line">                copy_data.level,</div>
<div class="line">                copy_data.local_dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>],</div>
<div class="line">                copy_data.local_dof_indices[<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>]))</div>
<div class="line">            {</div>
<div class="line">              mg_interface_out[copy_data.level].add(</div>
<div class="line">                copy_data.local_dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>],</div>
<div class="line">                copy_data.local_dof_indices[<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>],</div>
<div class="line">                copy_data.cell_matrix(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>));</div>
<div class="line">              mg_interface_in[copy_data.level].add(</div>
<div class="line">                copy_data.local_dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>],</div>
<div class="line">                copy_data.local_dof_indices[<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>],</div>
<div class="line">                copy_data.cell_matrix(<a class="code" href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a>, <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>));</div>
<div class="line">            }</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop</a>(dof_handler.<a class="code" href="classDoFHandler.html#a52af463de3283318bd4c651df7d35d24">begin_mg</a>(),</div>
<div class="line">                          dof_handler.<a class="code" href="classDoFHandler.html#aaa2300cc9a5f93532400af2752d948f6">end_mg</a>(),</div>
<div class="line">                          cell_worker_mg,</div>
<div class="line">                          copier_mg,</div>
<div class="line">                          <a class="code" href="structScratchData.html">ScratchData&lt;dim&gt;</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>, <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> + 1),</div>
<div class="line">                          <a class="code" href="structCopyData.html">CopyData</a>(),</div>
<div class="line">                          <a class="code" href="namespaceMeshWorker.html#ac7a9db8b34d398d7d398d1e8809874aaacb8627085561cee8b7af9d74320696eb">MeshWorker::assemble_own_cells</a>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::setup_smoother()</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;SOR&quot;</span>)</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">using</span> Smoother = <a class="code" href="classPreconditionSOR.html">PreconditionSOR&lt;SparseMatrix&lt;double&gt;</a>&gt;;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> smoother =</div>
<div class="line">          std::make_unique&lt;MGSmootherPrecondition&lt;SparseMatrix&lt;double&gt;,</div>
<div class="line">                                                  Smoother,</div>
<div class="line">                                                  <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;&gt;();</div>
<div class="line">        smoother-&gt;<a class="code" href="classMGSmootherPrecondition.html#a3cb789b815bf6719eee79e2137c9bd84">initialize</a>(mg_matrices,</div>
<div class="line">                             <a class="code" href="relaxation__block__0_8txt.html#a2076fd56276055e74e230fad6edac013">Smoother::AdditionalData</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> == 1 ? 1.0 :</div>
<div class="line">                                                                       0.62));</div>
<div class="line">        smoother-&gt;<a class="code" href="classMGSmoother.html#a9976182b6b272aac7800a8fbf18c8ab9">set_steps</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoothing_steps);</div>
<div class="line">        mg_smoother = std::move(smoother);</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;Jacobi&quot;</span>)</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">using</span> Smoother = <a class="code" href="classPreconditionJacobi.html">PreconditionJacobi&lt;SparseMatrix&lt;double&gt;</a>&gt;;</div>
<div class="line">        <span class="keyword">auto</span> smoother =</div>
<div class="line">          std::make_unique&lt;MGSmootherPrecondition&lt;SparseMatrix&lt;double&gt;,</div>
<div class="line">                                                  Smoother,</div>
<div class="line">                                                  <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;&gt;();</div>
<div class="line">        smoother-&gt;<a class="code" href="classMGSmootherPrecondition.html#a3cb789b815bf6719eee79e2137c9bd84">initialize</a>(mg_matrices,</div>
<div class="line">                             <a class="code" href="relaxation__block__0_8txt.html#a2076fd56276055e74e230fad6edac013">Smoother::AdditionalData</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">degree</a> == 1 ? 0.6667 :</div>
<div class="line">                                                                       0.47));</div>
<div class="line">        smoother-&gt;<a class="code" href="classMGSmoother.html#a9976182b6b272aac7800a8fbf18c8ab9">set_steps</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoothing_steps);</div>
<div class="line">        mg_smoother = std::move(smoother);</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;block SOR&quot;</span> ||</div>
<div class="line">             <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;block Jacobi&quot;</span>)</div>
<div class="line">      {</div>
<div class="line">        smoother_data.<a class="code" href="classMGLevelObject.html#a16213121f9153bd08f49652a11886259">resize</a>(0, <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_levels() - 1);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> = 0; <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a> &lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_levels(); ++<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>)</div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="namespaceDoFTools.html#a43ee44769769065bc594d1730477a4b9">DoFTools::make_cell_patches</a>(smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].block_list,</div>
<div class="line">                                        dof_handler,</div>
<div class="line">                                        <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line"> </div>
<div class="line">            smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].relaxation =</div>
<div class="line">              (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;block SOR&quot;</span> ? 1.0 : 0.25);</div>
<div class="line">            smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].inversion = <a class="code" href="classPreconditionBlockBase.html">PreconditionBlockBase&lt;double&gt;::svd</a>;</div>
<div class="line"> </div>
<div class="line">            std::vector&lt;unsigned int&gt; ordered_indices;</div>
<div class="line">            <span class="keywordflow">switch</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.dof_renumbering)</div>
<div class="line">              {</div>
<div class="line">                <span class="keywordflow">case</span> <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">Settings::DoFRenumberingStrategy::downstream</a>:</div>
<div class="line">                  ordered_indices =</div>
<div class="line">                    <a class="code" href="namespaceStep63.html#a679f6c35915713a90230f261b38f041e">create_downstream_cell_ordering</a>(dof_handler,</div>
<div class="line">                                                    advection_direction,</div>
<div class="line">                                                    <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">                  <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> Settings::DoFRenumberingStrategy::upstream:</div>
<div class="line">                  ordered_indices =</div>
<div class="line">                    <a class="code" href="namespaceStep63.html#a679f6c35915713a90230f261b38f041e">create_downstream_cell_ordering</a>(dof_handler,</div>
<div class="line">                                                    -1.0 * advection_direction,</div>
<div class="line">                                                    <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">                  <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">Settings::DoFRenumberingStrategy::random</a>:</div>
<div class="line">                  ordered_indices =</div>
<div class="line">                    <a class="code" href="namespaceStep63.html#a5bcdd1e04c358777541a2922f8803db4">create_random_cell_ordering</a>(dof_handler, <a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>);</div>
<div class="line">                  <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1acc6b05c836e9f74fb7ab9390ffc26f1c">Settings::DoFRenumberingStrategy::none</a>:</div>
<div class="line">                  <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">default</span>:</div>
<div class="line">                  <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">                  <span class="keywordflow">break</span>;</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            smoother_data[<a class="code" href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a>].order =</div>
<div class="line">              std::vector&lt;std::vector&lt;unsigned int&gt;&gt;(1, ordered_indices);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;block SOR&quot;</span>)</div>
<div class="line">          {</div>
<div class="line">            <span class="keyword">auto</span> smoother = std::make_unique&lt;<a class="code" href="classMGSmootherPrecondition.html">MGSmootherPrecondition</a>&lt;</div>
<div class="line">              <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a>,</div>
<div class="line">              <a class="code" href="classRelaxationBlockSOR.html">RelaxationBlockSOR&lt;SparseMatrix&lt;double&gt;</a>, <a class="code" href="hdf5__0_8txt.html#aae153b86de45d3354cd3edd5b992435e">double</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;,</div>
<div class="line">              <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;&gt;();</div>
<div class="line">            smoother-&gt;<a class="code" href="classMGSmootherPrecondition.html#a3cb789b815bf6719eee79e2137c9bd84">initialize</a>(mg_matrices, smoother_data);</div>
<div class="line">            smoother-&gt;<a class="code" href="classMGSmoother.html#a9976182b6b272aac7800a8fbf18c8ab9">set_steps</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoothing_steps);</div>
<div class="line">            mg_smoother = std::move(smoother);</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoother_type == <span class="stringliteral">&quot;block Jacobi&quot;</span>)</div>
<div class="line">          {</div>
<div class="line">            <span class="keyword">auto</span> smoother = std::make_unique&lt;</div>
<div class="line">              <a class="code" href="classMGSmootherPrecondition.html">MGSmootherPrecondition&lt;SparseMatrix&lt;double&gt;</a>,</div>
<div class="line">                                     <a class="code" href="classRelaxationBlockJacobi.html">RelaxationBlockJacobi&lt;SparseMatrix&lt;double&gt;</a>,</div>
<div class="line">                                                           <a class="code" href="hdf5__0_8txt.html#aae153b86de45d3354cd3edd5b992435e">double</a>,</div>
<div class="line">                                                           <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;,</div>
<div class="line">                                     <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;&gt;();</div>
<div class="line">            smoother-&gt;<a class="code" href="classMGSmootherPrecondition.html#a3cb789b815bf6719eee79e2137c9bd84">initialize</a>(mg_matrices, smoother_data);</div>
<div class="line">            smoother-&gt;<a class="code" href="classMGSmoother.html#a9976182b6b272aac7800a8fbf18c8ab9">set_steps</a>(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.smoothing_steps);</div>
<div class="line">            mg_smoother = std::move(smoother);</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">AdvectionProblem&lt;dim&gt;::solve</a>()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_iters       = 200;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>       solve_tolerance = 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-8 * system_rhs.l2_norm();</div>
<div class="line">    <a class="code" href="classSolverControl.html">SolverControl</a>      solver_control(max_iters, solve_tolerance, <span class="keyword">true</span>, <span class="keyword">true</span>);</div>
<div class="line">    solver_control.<a class="code" href="classSolverControl.html#a6d99741765243ccb65da4ff66558cf41">enable_history_data</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using</span> Transfer = <a class="code" href="classMGTransferPrebuilt.html">MGTransferPrebuilt&lt;Vector&lt;double&gt;</a>&gt;;</div>
<div class="line">    Transfer mg_transfer(mg_constrained_dofs);</div>
<div class="line">    mg_transfer.<a class="code" href="classMGTransferMatrixFree.html#a8f214ffade006cfa85e902a94902fc7b">build</a>(dof_handler);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> coarse_matrix;</div>
<div class="line">    coarse_matrix.<a class="code" href="classFullMatrix.html#ae9e8fbf00e15c7b66d527a5de4b31404">copy_from</a>(mg_matrices[0]);</div>
<div class="line">    <a class="code" href="classMGCoarseGridHouseholder.html">MGCoarseGridHouseholder&lt;double, Vector&lt;double&gt;</a>&gt; coarse_grid_solver;</div>
<div class="line">    coarse_grid_solver.<a class="code" href="classMGCoarseGridHouseholder.html#a07bd76dc7f6f66cb22d3e7951a558f50">initialize</a>(coarse_matrix);</div>
<div class="line"> </div>
<div class="line">    setup_smoother();</div>
<div class="line"> </div>
<div class="line">    mg_matrix.initialize(mg_matrices);</div>
<div class="line">    mg_interface_matrix_in.initialize(mg_interface_in);</div>
<div class="line">    mg_interface_matrix_out.initialize(mg_interface_out);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classMultigrid.html">Multigrid&lt;Vector&lt;double&gt;</a>&gt; <a class="code" href="namespacemg.html">mg</a>(</div>
<div class="line">      mg_matrix, coarse_grid_solver, mg_transfer, *mg_smoother, *mg_smoother);</div>
<div class="line">    <a class="code" href="namespacemg.html">mg</a>.set_edge_matrices(mg_interface_matrix_out, mg_interface_matrix_in);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classPreconditionMG.html">PreconditionMG&lt;dim, Vector&lt;double&gt;</a>, Transfer&gt; <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>(dof_handler,</div>
<div class="line">                                                                 <a class="code" href="namespacemg.html">mg</a>,</div>
<div class="line">                                                                 mg_transfer);</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;     Solving with GMRES to tol &quot;</span> &lt;&lt; solve_tolerance &lt;&lt; <span class="stringliteral">&quot;...&quot;</span></div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line">    <a class="code" href="classSolverGMRES.html">SolverGMRES&lt;Vector&lt;double&gt;</a>&gt; <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>(</div>
<div class="line">      solver_control, <a class="code" href="classSolverGMRES.html">SolverGMRES</a>&lt;<a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;::<a class="code" href="relaxation__block__0_8txt.html#a2076fd56276055e74e230fad6edac013">AdditionalData</a>(50, <span class="keyword">true</span>));</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTimer.html">Timer</a> <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a>;</div>
<div class="line">    <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a>.start();</div>
<div class="line">    <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.solve(system_matrix, <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, system_rhs, <a class="code" href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a>);</div>
<div class="line">    <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a>.stop();</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;          converged in &quot;</span> &lt;&lt; solver_control.<a class="code" href="classSolverControl.html#a42aeae81cd6b67ce93b5fbea3328371f">last_step</a>()</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot; iterations&quot;</span></div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot; in &quot;</span> &lt;&lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a>.last_wall_time() &lt;&lt; <span class="stringliteral">&quot; seconds &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a>.<a class="code" href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">distribute</a>(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line">    mg_smoother.release();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a> = <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells();</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a>     cell_indices(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>);</div>
<div class="line">    {</div>
<div class="line">      std::vector&lt;unsigned int&gt; ordered_indices;</div>
<div class="line">      <span class="keywordflow">switch</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.dof_renumbering)</div>
<div class="line">        {</div>
<div class="line">          <span class="keywordflow">case</span> <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">Settings::DoFRenumberingStrategy::downstream</a>:</div>
<div class="line">            ordered_indices =</div>
<div class="line">              <a class="code" href="namespaceStep63.html#a679f6c35915713a90230f261b38f041e">create_downstream_cell_ordering</a>(dof_handler, advection_direction);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">case</span> Settings::DoFRenumberingStrategy::upstream:</div>
<div class="line">            ordered_indices =</div>
<div class="line">              <a class="code" href="namespaceStep63.html#a679f6c35915713a90230f261b38f041e">create_downstream_cell_ordering</a>(dof_handler,</div>
<div class="line">                                              -1.0 * advection_direction);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">case</span> <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">Settings::DoFRenumberingStrategy::random</a>:</div>
<div class="line">            ordered_indices = <a class="code" href="namespaceStep63.html#a5bcdd1e04c358777541a2922f8803db4">create_random_cell_ordering</a>(dof_handler);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">case</span> <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1acc6b05c836e9f74fb7ab9390ffc26f1c">Settings::DoFRenumberingStrategy::none</a>:</div>
<div class="line">            ordered_indices.resize(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>);</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">              ordered_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] = <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">default</span>:</div>
<div class="line">            <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">        cell_indices(ordered_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">attach_dof_handler</a>(dof_handler);</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, <span class="stringliteral">&quot;solution&quot;</span>);</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(cell_indices, <span class="stringliteral">&quot;cell_index&quot;</span>);</div>
<div class="line">    data_out.<a class="code" href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">build_patches</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> std::string filename =</div>
<div class="line">      <span class="stringliteral">&quot;solution-&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>) + <span class="stringliteral">&quot;.vtu&quot;</span>;</div>
<div class="line">    std::ofstream <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>(filename.c_str());</div>
<div class="line">    data_out.<a class="code" href="classDataOutInterface.html#a93c780f93105e0daaa76c6c43694b4ae">write_vtu</a>(<a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">AdvectionProblem&lt;dim&gt;::run</a>()</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> = 0; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt; (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.fe_degree == 1 ? 7 : 5);</div>
<div class="line">         ++<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>)</div>
<div class="line">      {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;  Cycle &quot;</span> &lt;&lt; <a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a> == 0)</div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="namespaceGridGenerator.html#add14cab546d033c1eaacc9234c64ebcd">GridGenerator::hyper_cube_with_cylindrical_hole</a>(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>,</div>
<div class="line">                                                            0.3,</div>
<div class="line">                                                            1.0);</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classSphericalManifold.html">SphericalManifold&lt;dim&gt;</a> manifold_description(<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>(0, 0));</div>
<div class="line">            <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.set_manifold(1, manifold_description);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.refine_global();</div>
<div class="line"> </div>
<div class="line">        setup_system();</div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;     Number of active cells:       &quot;</span></div>
<div class="line">                  &lt;&lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells() &lt;&lt; <span class="stringliteral">&quot; (&quot;</span></div>
<div class="line">                  &lt;&lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_levels() &lt;&lt; <span class="stringliteral">&quot; levels)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;     Number of degrees of freedom: &quot;</span></div>
<div class="line">                  &lt;&lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>() &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        assemble_system_and_multigrid();</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.output)</div>
<div class="line">          output_results(<a class="code" href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a>);</div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; std::endl;</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Step63</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="structStep63_1_1Settings.html">Step63::Settings</a> <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>;</div>
<div class="line">      <a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>.get_parameters((argc &gt; 1) ? (argv[1]) : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classStep63_1_1AdvectionProblem.html">Step63::AdvectionProblem&lt;2&gt;</a> advection_problem_2d(<a class="code" href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a>);</div>
<div class="line">      advection_problem_2d.run();</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (<a class="code" href="parameter__handler__0_8txt.html#ad919e2b915d8e8226aef004c2d8399a8">std::exception</a> &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p> <br  />
 </em></p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="aclassSymmetricTensor_html_a9137b6052702150e8e5b1188d1971906"><div class="ttname"><a href="classSymmetricTensor.html#a9137b6052702150e8e5b1188d1971906">SymmetricTensor::trace</a></div><div class="ttdeci">constexpr Number trace(const SymmetricTensor&lt; 2, dim, Number &gt; &amp;d)</div><div class="ttdef"><b>Definition:</b> <a href="base_2symmetric__tensor_8h_source.html#l02722">symmetric_tensor.h:2722</a></div></div>
<div class="ttc" id="anamespaceStep63_html_a5bcdd1e04c358777541a2922f8803db4"><div class="ttname"><a href="namespaceStep63.html#a5bcdd1e04c358777541a2922f8803db4">Step63::create_random_cell_ordering</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; create_random_cell_ordering(const DoFHandler&lt; dim &gt; &amp;dof_handler, const unsigned int level)</div><div class="ttdef"><b>Definition:</b> <a href="step-63_8cc_source.html#l00260">step-63.cc:260</a></div></div>
<div class="ttc" id="amultigrid_2mg__transfer_8h_html"><div class="ttname"><a href="multigrid_2mg__transfer_8h.html">mg_transfer.h</a></div></div>
<div class="ttc" id="apolynomial__0_8txt_html_af1258c87f1d73d29bd17331843ac1d25"><div class="ttname"><a href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a></div><div class="ttdeci">namespace in which classes relating to the description of d polynomial spaces are declared ***Base class for all D polynomials A polynomial is represented in this class by its coefficients which are set through the constructor or by derived classes There are two paths for evaluation of polynomials One is based on the coefficients which are evaluated through the Horner scheme which is a robust general purpose scheme An alternative and more stable evaluation of high degree polynomials with roots in the unit interval is provided by a product in terms of the roots This form is available for special polynomials such as Lagrange polynomials or Legendre polynomials and used with the respective constructor To obtain this more stable evaluation form the constructor with the roots in form of a Lagrange polynomial must be used In case a manipulation is done that changes the roots the representation is switched to the coefficient form This class is a typical example of a possible template argument for the TensorProductPolynomials class **Constructor The coefficients of the polynomial are passed as and denote the i e the first element of the array denotes the constant the second the linear and so on The degree of the polynomial represented by this object is thus the number of elements in the&lt; tt &gt; coefficient&lt;/tt &gt; array minus one **Constructor creating a zero polynomial of degree *[2.x.3] *Constructor for a Lagrange polynomial and its point of evaluation The idea is to where j is the evaluation point specified as argument and the support points contain all the evaluation is based on products of the whereas the Horner scheme is used for polynomials in the coefficient form **Return the values and the derivatives of the Polynomial at point&lt; tt &gt; x&lt;/tt &gt;&lt; tt &gt; i</div><div class="ttdef"><b>Definition:</b> <a href="polynomial__0_8txt_source.html#l00024">polynomial_0.txt:24</a></div></div>
<div class="ttc" id="alac_2solver__gmres_8h_html"><div class="ttname"><a href="lac_2solver__gmres_8h.html">solver_gmres.h</a></div></div>
<div class="ttc" id="aclassDataOut__DoFData_html_a79cbe2f02f8dfb85026c71d783dbb703"><div class="ttname"><a href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">DataOut_DoFData::add_data_vector</a></div><div class="ttdeci">void add_data_vector(const VectorType &amp;data, const std::vector&lt; std::string &gt; &amp;names, const DataVectorType type=type_automatic, const std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt; &amp;data_component_interpretation=std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt;())</div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__out__dof__data_8h_source.html#l01096">data_out_dof_data.h:1096</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a91cfbaca954f444047302446a4e87125"><div class="ttname"><a href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">ParameterHandler::get</a></div><div class="ttdeci">std::string get(const std::string &amp;entry_string) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00987">parameter_handler.cc:987</a></div></div>
<div class="ttc" id="aclassIndexSet_html"><div class="ttname"><a href="classIndexSet.html">IndexSet</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2index__set_8h_source.html#l00068">index_set.h:68</a></div></div>
<div class="ttc" id="aclassFEValues_html_a21f914e63d588e2652a9514620653d77"><div class="ttname"><a href="classFEValues.html#a21f914e63d588e2652a9514620653d77">FEValues::reinit</a></div><div class="ttdeci">void reinit(const TriaIterator&lt; DoFCellAccessor&lt; dim, spacedim, level_dof_access &gt;&gt; &amp;cell)</div></div>
<div class="ttc" id="amultigrid_2multigrid_8h_html"><div class="ttname"><a href="multigrid_2multigrid_8h.html">multigrid.h</a></div></div>
<div class="ttc" id="afe_2fe__values_8h_html"><div class="ttname"><a href="fe_2fe__values_8h.html">fe_values.h</a></div></div>
<div class="ttc" id="anamespacePhysics_1_1Elasticity_1_1Kinematics_html_aa6fff35c961658bfea21e8a3ae468cec"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa6fff35c961658bfea21e8a3ae468cec">Physics::Elasticity::Kinematics::epsilon</a></div><div class="ttdeci">SymmetricTensor&lt; 2, dim, Number &gt; epsilon(const Tensor&lt; 2, dim, Number &gt; &amp;Grad_u)</div></div>
<div class="ttc" id="afe_2fe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20"><div class="ttname"><a href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a></div><div class="ttdeci">@ update_gradients</div><div class="ttdoc">Shape function gradients.</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__update__flags_8h_source.html#l00077">fe_update_flags.h:77</a></div></div>
<div class="ttc" id="aclassMappingQ_html"><div class="ttname"><a href="classMappingQ.html">MappingQ&lt; dim &gt;</a></div></div>
<div class="ttc" id="adistributed__0_8txt_html_afec1b694405cadb2d251275096ad3563"><div class="ttname"><a href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a></div><div class="ttdeci">if we even only hold bytes per line in this sparsity we ll need GB for this object even if every single line is empty Of only million lines will be non for which we need MB plus whatever is necessary to store the actual column indices of nonzero entries Let s say we have a moderately complex problem with entries per for each of which we store the column index worth then we ll need bytes for each of the million lines that correspond to the degrees of freedom we for a total of GB And we ll need bytes for each of the million lines that we don t for a total of GB It is clear that this ratio doesn t become any better if we go to even higher numbers of processors *The solution to this problem is to really only use any memory at all for those parts of the linear system that we or need for some other reason For all other we must know that they but we can not set up any part of our data structure To this there exists a class called IndexSet that denotes a set of indices which we care for and for which we may have to allocate memory The data structures for sparsity patterns constraint matrices matrices and vector can be initialized with these IndexSet objects to really only care for those rows or entries that correspond to indices in the index set and not care about all others These objects will then ask how many indices exist in the set allocate memory for each one of and when you want to access data for global degree of freedom[2.x.28] you will be redirected to the result of calling[2.x.29] with index[2.x.30] instead Accessing data for elements[2.x.31] for which[2.x.32] is false will yield an error *The remaining question is how to identify the set of indices that correspond to degrees of freedom we need to worry about on each processor To this you can use the[2.x.33] function to get at all the indices a processor owns Note that this is a subset of the degrees of freedom that are defined on the locally owned one sometimes needs the set of all degrees of freedom on the locally owned subdomain as well as the adjacent ghost cells This information is provided by the[2.x.35] function ***A typical parallel application is dealing with two different kinds of parallel but there are of course different vector types that can each represent both ghosted vectors are typically used for data output</div><div class="ttdef"><b>Definition:</b> <a href="distributed__0_8txt_source.html#l00059">distributed_0.txt:59</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_aeaf3c7846747695b1f327677e3716ec5"><div class="ttname"><a href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">ParameterHandler::get_double</a></div><div class="ttdeci">double get_double(const std::string &amp;entry_name) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l01068">parameter_handler.cc:1068</a></div></div>
<div class="ttc" id="anamespaceGridGenerator_html_add14cab546d033c1eaacc9234c64ebcd"><div class="ttname"><a href="namespaceGridGenerator.html#add14cab546d033c1eaacc9234c64ebcd">GridGenerator::hyper_cube_with_cylindrical_hole</a></div><div class="ttdeci">void hyper_cube_with_cylindrical_hole(Triangulation&lt; dim &gt; &amp;triangulation, const double inner_radius=.25, const double outer_radius=.5, const double L=.5, const unsigned int repetitions=1, const bool colorize=false)</div></div>
<div class="ttc" id="aclassStep63_1_1AdvectionProblem_html"><div class="ttname"><a href="classStep63_1_1AdvectionProblem.html">Step63::AdvectionProblem</a></div><div class="ttdef"><b>Definition:</b> <a href="step-63_8cc_source.html#l00402">step-63.cc:402</a></div></div>
<div class="ttc" id="ahdf5__0_8txt_html_aae153b86de45d3354cd3edd5b992435e"><div class="ttname"><a href="hdf5__0_8txt.html#aae153b86de45d3354cd3edd5b992435e">double</a></div><div class="ttdeci">*Namespace containing deal II s HDF5 interface whereas writing and reading raw data in a dataset can be done independently or double</div><div class="ttdef"><b>Definition:</b> <a href="hdf5__0_8txt_source.html#l00045">hdf5_0.txt:45</a></div></div>
<div class="ttc" id="apetsc__precondition__0_8txt_html_a41ebb2d49faa97a3d9eab4b4f13c2742"><div class="ttname"><a href="petsc__precondition__0_8txt.html#a41ebb2d49faa97a3d9eab4b4f13c2742">preconditioner</a></div><div class="ttdeci">*Base class for preconditioner classes using the PETSc functionality The classes in this hierarchy don t do a whole lot except for providing a function that sets the preconditioner and certain parameters on the preconditioning context of the solver These classes are basically here only to allow a similar interface as already used for the deal II solver and preconditioner classes Note that derived classes only provide interfaces to the relevant functionality of PETSc PETSc does not implement all preconditioners for all matrix types In particular some preconditioners are not going to work for parallel jobs such as for example the ILU preconditioner ***Constructor **Destructor **Destroys the preconditioner</div><div class="ttdef"><b>Definition:</b> <a href="petsc__precondition__0_8txt_source.html#l00002">petsc_precondition_0.txt:2</a></div></div>
<div class="ttc" id="aclassFullMatrix_html_ae9e8fbf00e15c7b66d527a5de4b31404"><div class="ttname"><a href="classFullMatrix.html#ae9e8fbf00e15c7b66d527a5de4b31404">FullMatrix::copy_from</a></div><div class="ttdeci">void copy_from(const MatrixType &amp;)</div></div>
<div class="ttc" id="aA-headers_2exceptions__0_8txt_html_a8fba07b9a84b89e6be225f5f95c3e355"><div class="ttname"><a href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">run</a></div><div class="ttdeci">the program is just and one can not intelligently work around that *It is sometimes useful to change the behavior of the[2.x.6] macro from aborting a program to throwing exceptions On the other exceptions are not allowed to propagate out of destructors of classes For this there is a variant of the called[2.x.7] that can be used in destructors These use cases are discussed further down below on this page **Dynamic such as whether an output file can be written to *These are things that shouldn t be checked because it is not guaranteed that a program for which the condition is satisfied in a debug mode run</div><div class="ttdef"><b>Definition:</b> <a href="A-headers_2exceptions__0_8txt_source.html#l00022">exceptions_0.txt:22</a></div></div>
<div class="ttc" id="aclassFE__Q_html"><div class="ttname"><a href="classFE__Q.html">FE_Q&lt; dim &gt;</a></div></div>
<div class="ttc" id="anamespaceDifferentiation_1_1SD_html_a66e76f1c4fdb9a31f4fabef8abee5f28"><div class="ttname"><a href="namespaceDifferentiation_1_1SD.html#a66e76f1c4fdb9a31f4fabef8abee5f28">Differentiation::SD::coth</a></div><div class="ttdeci">Expression coth(const Expression &amp;x)</div><div class="ttdef"><b>Definition:</b> <a href="symengine__math_8cc_source.html#l00217">symengine_math.cc:217</a></div></div>
<div class="ttc" id="abase_2tensor__function_8h_html"><div class="ttname"><a href="base_2tensor__function_8h.html">tensor_function.h</a></div></div>
<div class="ttc" id="anamespaceUtilities_html_a6195c5f009ea8c7c536c6ffdf108c32f"><div class="ttname"><a href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a></div><div class="ttdeci">std::string int_to_string(const unsigned int value, const unsigned int digits=numbers::invalid_unsigned_int)</div><div class="ttdef"><b>Definition:</b> <a href="base_2utilities_8cc_source.html#l00473">utilities.cc:473</a></div></div>
<div class="ttc" id="anamespacedealii_html"><div class="ttname"><a href="namespacedealii.html">dealii</a></div><div class="ttdef"><b>Definition:</b> <a href="doc_2doxygen_2headers_2namespace__dealii_8h_source.html#l00026">namespace_dealii.h:26</a></div></div>
<div class="ttc" id="afe_2fe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea"><div class="ttname"><a href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a></div><div class="ttdeci">@ update_values</div><div class="ttdoc">Shape function values.</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__update__flags_8h_source.html#l00070">fe_update_flags.h:70</a></div></div>
<div class="ttc" id="agroup__CPP11_html_ga8c046284df67198c2d82c25950ea1ea3"><div class="ttname"><a href="group__CPP11.html#ga8c046284df67198c2d82c25950ea1ea3">DoFHandler::cell_iterators_on_level</a></div><div class="ttdeci">IteratorRange&lt; cell_iterator &gt; cell_iterators_on_level(const unsigned int level) const</div></div>
<div class="ttc" id="aiterators__0_8txt_html_a6cf0880ba2af3a1be4aacdbbd4b90f9c"><div class="ttname"><a href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a></div><div class="ttdeci">where BaseIterator usually is one of thestandard iterators discussed above *The FilteredIterator gets an additional Predicate in its constructor and willskip all objects where this Predicate evaluates to&lt; tt &gt; false&lt;/tt &gt; Acollection of predicates already implemented can be found in the namespaceIteratorFilters ***IteratorsLoops Iterating over objects *All iterators of the same kind and iterating over thesame kind of geometrical objects traverse the mesh in the sameorder Take this code all iterators will always point to the same mesh even though&lt; tt &gt; DoFHandler&lt;/tt &gt; and&lt; tt &gt; Triangulation&lt;/tt &gt; are very different and even if the DoFHandlers are handling different finite the difference is only in the Accessor As mentioned the order in which iterators traverse the forest ofobjects is actually well but application programs should notassume any such but rather consider this an implementation detailof the library *Corresponding to above the order in which iterators traverse activeobjects is the same for all iterators in the following the difference to the previous example being that here we only consider active but theyare really rather dumb Their magic only lies in the fact that they point tosome useful in this case the Accessor For they point to anactual object that stores some data On the other the deal II when do not return a reference to an actual but returnan object that knows how to get at the data that represents cells In thisobject doesn t store itself where the vertices of a cell are or what its neighborsare it knows how to tease this sort of information from out of thearrays and tables and lists that the Triangulation class sets up to describe amesh *Accessing data that characterizes a cell is always done through the i e the expression[2.x.10] grants access to[1.x.6] attributes of this Accessor Examples of properties you can query from aniterator are ***Since dereferencing iterators yields accessor these calls are tomember etc These in turn figure out the relevant datafrom the various data structures that store this data How this is actuallydone and what data structures are used is not really of concern to authors ofapplications in deal II In by hiding the actual data structureswe are able to store data in an efficient not necessarily in a way thatmakes it easily accessible or understandable to application writers ***IteratorsTypedefs Kinds of accessors *Depending on what sort of data you want to there are different kindsof accessor and hexes that make up a triangulation</div><div class="ttdef"><b>Definition:</b> <a href="iterators__0_8txt_source.html#l00063">iterators_0.txt:63</a></div></div>
<div class="ttc" id="ageodynamics__0_8txt_html_a47b3a2cd492d04754f4796002e14ed13"><div class="ttname"><a href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a></div><div class="ttdeci">all others have started as modifications of one of the tutorial programs *The tutorial programs we propose to write will provide students and researchers with a reference implementation of current numerical technology such as higher order sophisticated linear and nonlinear stabilization etc Providing these as starting points for further development by others will also serve the goal of training a new generation of geodynamicists in modern numerical algorithms *In deal it is fairly simple to extend a set of equations by another for example an additional advected quantity that enters the existing equations as a right hand side or in one of the coefficients Since applications typically use blocked matrices rather than the one big matrix for everything it is also not complicated to find suitable linear solvers for augmented equations deal II is a good tool for trying out more complex formulations of or more complete models and their effects on the accuracy of solutions *deal II provides many interchangeable components that allow rapid prototyping of finite element kinds and stabilization or linear solvers For typically only a few lines of code have to be changed to replace low order by high order elements Through it becomes relatively simple to try out higher order a different block elimination solver</div><div class="ttdef"><b>Definition:</b> <a href="geodynamics__0_8txt_source.html#l00033">geodynamics_0.txt:33</a></div></div>
<div class="ttc" id="astep-1_8cc_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdef"><b>Definition:</b> <a href="step-1_8cc_source.html#l00086">step-1.cc:86</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a6bb45dc67787e3fab7882461929b5fbe"><div class="ttname"><a href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">ParameterHandler::get_bool</a></div><div class="ttdeci">bool get_bool(const std::string &amp;entry_name) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l01113">parameter_handler.cc:1113</a></div></div>
<div class="ttc" id="aclassMGConstrainedDoFs_html"><div class="ttname"><a href="classMGConstrainedDoFs.html">MGConstrainedDoFs</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_2mg__constrained__dofs_8h_source.html#l00049">mg_constrained_dofs.h:49</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga7b52b286796c23ef9ff178faf7a4b68f"><div class="ttname"><a href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">StandardExceptions::ExcNotImplemented</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcNotImplemented()</div></div>
<div class="ttc" id="afe__q__base__0_8txt_html_ac01155b6a1d9bf8e09c14f9a454cdfea"><div class="ttname"><a href="fe__q__base__0_8txt.html#ac01155b6a1d9bf8e09c14f9a454cdfea">renumbering</a></div><div class="ttdeci">*This class collects the basic methods used in FE_Q FE_Q_DG0 and FE_Q_Bubbles There is no public constructor for this class as it is not functional as a stand alone The completion of definitions is left to the derived classes ***Constructor **Return the matrix interpolating from the given finite element to the present one The size of the matrix is then[2.x.0] times&lt; tt &gt; source an exception of type[2.x.2] is thrown **Return the matrix interpolating from a face of one element to the face of the neighboring element The size of the matrix is then&lt; tt &gt; source dofs_per_face&lt;/tt &gt; times&lt; tt &gt; this dofs_per_face&lt;/tt &gt; The FE_Q element family only provides interpolation matrices for elements of the same type and FE_Nothing For all other an exception of type[2.x.3] is thrown **Return the matrix interpolating from a face of one element to the face of the neighboring element The size of the matrix is then&lt; tt &gt; source dofs_per_face&lt;/tt &gt; times&lt; tt &gt; this dofs_per_face&lt;/tt &gt; The FE_Q element family only provides interpolation matrices for elements of the same type and FE_Nothing For all other an exception of type[2.x.4] is thrown **This function returns[2.x.5] if the shape function[2.x.6] has non zero function values somewhere on the face *[2.x.7] *Projection from a fine grid space onto a coarse grid space Overrides the respective method in implementing lazy depending on the **Embedding matrix between grids Overrides the respective method in implementing lazy not the sum of the cell matrices[2.x.15] P_i That if the same non zero entry&lt; tt &gt; k&lt;/tt &gt; exists in two different child matrices[2.x.16] the value should be the same in both matrices and it is copied into the matrix[2.x.17] only once Row and column indices are related to fine grid and coarse grid consistent with the definition of the associated return the index of the same degree of freedom on the cell To explain the consider the case where we would like to know whether a degree of freedom on a for example as part of an FESystem is primitive the so we would need to find the cell index of the shape function that corresponds to the present face index This function does that Code implementing this would then look like or can be etc[2.x.18] face_dof_index The index of the degree of freedom on a face This index must be between zero and dofs_per_face[2.x.19] face The number of the face this degree of freedom lives on This number must be between zero and[2.x.20][2.x.21] face_orientation One part of the description of the orientation of the face See[2.x.22][2.x.23] face_flip One part of the description of the orientation of the face See[2.x.24][2.x.25] face_rotation One part of the description of the orientation of the face See[2.x.26][2.x.27] The index of this degree of freedom within the set of degrees of freedom on the entire cell The returned value will be between zero and dofs_per_cell **Return a list of constant modes of the element For this the list consists of true arguments for all components **Functions to support hp *[2.x.29] *Return whether this element implements its hanging node constraints in the new which has to be used to make elements hp compatible For the FE_Q class the result is always as it implements the complete set of functions necessary for hp capability on a several finite elements are the hp code first assigns the degrees of freedom of each of these FEs different global indices It then calls this function to find out which of them should get identical and consequently can receive the same global DoF index This function therefore returns a list of identities between DoFs of the present finite element object with the DoFs of[2.x.30] which is a reference to a finite element object representing one of the other finite elements active on this particular vertex The function computes which of the degrees of freedom of the two finite element objects are both numbered between zero and the corresponding value of whereas the second is the corresponding index of the other finite element **Same as except that the function treats degrees of freedom on lines **Same as except that the function treats degrees of freedom on quads **Attempt to construct an FE_Q object of degree ***Only for internal use Its full name is[2.x.32] function and it creates the[2.x.33] vector that is needed within the constructor to be passed to the constructor of[2.x.34] FiniteElementData **Perform the initialization of the element based on support i sets renumbering</div><div class="ttdef"><b>Definition:</b> <a href="fe__q__base__0_8txt_source.html#l00041">fe_q_base_0.txt:41</a></div></div>
<div class="ttc" id="aclassTriangulation_html"><div class="ttname"><a href="classTriangulation.html">Triangulation&lt; dim &gt;</a></div></div>
<div class="ttc" id="agrid_2tria_8h_html"><div class="ttname"><a href="grid_2tria_8h.html">tria.h</a></div></div>
<div class="ttc" id="astructCopyData_html"><div class="ttname"><a href="structCopyData.html">CopyData</a></div><div class="ttdef"><b>Definition:</b> <a href="step-50_8cc_source.html#l01104">step-50.cc:1104</a></div></div>
<div class="ttc" id="abase_2parameter__handler_8h_html"><div class="ttname"><a href="base_2parameter__handler_8h.html">parameter_handler.h</a></div></div>
<div class="ttc" id="afe_2fe__q_8h_html"><div class="ttname"><a href="fe_2fe__q_8h.html">fe_q.h</a></div></div>
<div class="ttc" id="ampi__remote__point__evaluation__0_8txt_html_a45c57074a631760cdab557f450e880e0"><div class="ttname"><a href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a></div><div class="ttdeci">*Helper class to access values on non matching grids *The name of the fields are chosen with the method quantities are computed at specified arbitrary positioned which receive the result and resort the result according to the points **Constructor[2.x.1] tolerance Tolerance in terms of unit cell coordinates for determining all cells around a point passed to the class during it might be necessary to adjust the tolerance in order to be able to identify a cell Floating point arithmetic implies that a point in not lie exactly on a or face[2.x.2] enforce_unique_mapping Enforce unique mapping</div><div class="ttdef"><b>Definition:</b> <a href="mpi__remote__point__evaluation__0_8txt_source.html#l00005">mpi_remote_point_evaluation_0.txt:5</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a6d65f458be69e23a348221cb67fc411d"><div class="ttname"><a href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">ParameterHandler::declare_entry</a></div><div class="ttdeci">void declare_entry(const std::string &amp;entry, const std::string &amp;default_value, const Patterns::PatternBase &amp;pattern=Patterns::Anything(), const std::string &amp;documentation=&quot;&quot;, const bool has_to_be_set=false)</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00796">parameter_handler.cc:796</a></div></div>
<div class="ttc" id="aclassDoFHandler_html_a042c4bf0f59fef5e72dbcfbdd56b2782"><div class="ttname"><a href="classDoFHandler.html#a042c4bf0f59fef5e72dbcfbdd56b2782">DoFHandler::end</a></div><div class="ttdeci">cell_iterator end() const</div></div>
<div class="ttc" id="aclassDoFHandler_html_a52af463de3283318bd4c651df7d35d24"><div class="ttname"><a href="classDoFHandler.html#a52af463de3283318bd4c651df7d35d24">DoFHandler::begin_mg</a></div><div class="ttdeci">level_cell_iterator begin_mg(const unsigned int level=0) const</div></div>
<div class="ttc" id="adofs__0_8txt_html_ae704d52abb496c815f42849c4de0f458"><div class="ttname"><a href="dofs__0_8txt.html#ae704d52abb496c815f42849c4de0f458">direction</a></div><div class="ttdeci">among its functions are ones that sort degrees of freedom in downstream direction</div><div class="ttdef"><b>Definition:</b> <a href="dofs__0_8txt_source.html#l00009">dofs_0.txt:9</a></div></div>
<div class="ttc" id="aclassSolverControl_html_a6d99741765243ccb65da4ff66558cf41"><div class="ttname"><a href="classSolverControl.html#a6d99741765243ccb65da4ff66558cf41">SolverControl::enable_history_data</a></div><div class="ttdeci">void enable_history_data()</div><div class="ttdef"><b>Definition:</b> <a href="solver__control_8cc_source.html#l00145">solver_control.cc:145</a></div></div>
<div class="ttc" id="astructScratchData_html_ac6933fda9b1f83d6f7a70316d7f1f86a"><div class="ttname"><a href="structScratchData.html#ac6933fda9b1f83d6f7a70316d7f1f86a">ScratchData::fe_values</a></div><div class="ttdeci">FEValues&lt; dim &gt; fe_values</div><div class="ttdef"><b>Definition:</b> <a href="step-50_8cc_source.html#l01098">step-50.cc:1098</a></div></div>
<div class="ttc" id="aclassDoFHandler_html_a9a3bef554c6d22abe312e10e9475eecf"><div class="ttname"><a href="classDoFHandler.html#a9a3bef554c6d22abe312e10e9475eecf">DoFHandler::begin_active</a></div><div class="ttdeci">active_cell_iterator begin_active(const unsigned int level=0) const</div></div>
<div class="ttc" id="abase_2timer_8h_html"><div class="ttname"><a href="base_2timer_8h.html">timer.h</a></div></div>
<div class="ttc" id="aclassSparseMatrix_html"><div class="ttname"><a href="classSparseMatrix.html">SparseMatrix&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassStep63_1_1BoundaryValues_html_a45af33d412a06517009ba6f342340256"><div class="ttname"><a href="classStep63_1_1BoundaryValues.html#a45af33d412a06517009ba6f342340256">Step63::BoundaryValues::value</a></div><div class="ttdeci">virtual double value(const Point&lt; dim &gt; &amp;p, const unsigned int component=0) const override</div><div class="ttdef"><b>Definition:</b> <a href="step-63_8cc_source.html#l00351">step-63.cc:351</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Bool_html"><div class="ttname"><a href="classPatterns_1_1Bool.html">Patterns::Bool</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2patterns_8h_source.html#l01054">patterns.h:1054</a></div></div>
<div class="ttc" id="aclassRelaxationBlockSOR_html"><div class="ttname"><a href="classRelaxationBlockSOR.html">RelaxationBlockSOR</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2relaxation__block_8h_source.html#l00393">relaxation_block.h:393</a></div></div>
<div class="ttc" id="aclassFunction_html_a562fc1114e95e702e6696721f71528db"><div class="ttname"><a href="classFunction.html#a562fc1114e95e702e6696721f71528db">Function&lt; dim &gt;::value_list</a></div><div class="ttdeci">virtual void value_list(const std::vector&lt; Point&lt; dim &gt;&gt; &amp;points, std::vector&lt; double &gt; &amp;values, const unsigned int component=0) const</div></div>
<div class="ttc" id="aclassDoFHandler_html_aaa2300cc9a5f93532400af2752d948f6"><div class="ttname"><a href="classDoFHandler.html#aaa2300cc9a5f93532400af2752d948f6">DoFHandler::end_mg</a></div><div class="ttdeci">level_cell_iterator end_mg(const unsigned int level) const</div></div>
<div class="ttc" id="aclassRelaxationBlockJacobi_html"><div class="ttname"><a href="classRelaxationBlockJacobi.html">RelaxationBlockJacobi</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2relaxation__block_8h_source.html#l00282">relaxation_block.h:282</a></div></div>
<div class="ttc" id="aclassSphericalManifold_html"><div class="ttname"><a href="classSphericalManifold.html">SphericalManifold</a></div><div class="ttdef"><b>Definition:</b> <a href="grid_2manifold__lib_8h_source.html#l00214">manifold_lib.h:214</a></div></div>
<div class="ttc" id="aclassDataOutInterface_html_a93c780f93105e0daaa76c6c43694b4ae"><div class="ttname"><a href="classDataOutInterface.html#a93c780f93105e0daaa76c6c43694b4ae">DataOutInterface::write_vtu</a></div><div class="ttdeci">void write_vtu(std::ostream &amp;out) const</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8cc_source.html#l07232">data_out_base.cc:7232</a></div></div>
<div class="ttc" id="anamespaceDoFRenumbering_html_a59c1a183ef6288e6bb061eb738b84380"><div class="ttname"><a href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">DoFRenumbering::downstream</a></div><div class="ttdeci">void downstream(DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, const Tensor&lt; 1, spacedim &gt; &amp;direction, const bool dof_wise_renumbering=false)</div><div class="ttdef"><b>Definition:</b> <a href="dof__renumbering_8cc_source.html#l01741">dof_renumbering.cc:1741</a></div></div>
<div class="ttc" id="abase_2symmetric__tensor_8h_html_a4248760c880275bab1f288fc80f27039"><div class="ttname"><a href="base_2symmetric__tensor_8h.html#a4248760c880275bab1f288fc80f27039">trace</a></div><div class="ttdeci">constexpr Number trace(const SymmetricTensor&lt; 2, dim2, Number &gt; &amp;)</div></div>
<div class="ttc" id="anamespacemg_html"><div class="ttname"><a href="namespacemg.html">mg</a></div><div class="ttdef"><b>Definition:</b> <a href="doc_2doxygen_2headers_2mg_8h_source.html#l00064">mg.h:64</a></div></div>
<div class="ttc" id="aclassStep63_1_1RightHandSide_html_a07b87d7025c7c5feca044c5c7d4296ef"><div class="ttname"><a href="classStep63_1_1RightHandSide.html#a07b87d7025c7c5feca044c5c7d4296ef">Step63::RightHandSide::value</a></div><div class="ttdeci">virtual double value(const Point&lt; dim &gt; &amp;p, const unsigned int component=0) const override</div><div class="ttdef"><b>Definition:</b> <a href="step-63_8cc_source.html#l00312">step-63.cc:312</a></div></div>
<div class="ttc" id="alac_2affine__constraints_8h_html"><div class="ttname"><a href="lac_2affine__constraints_8h.html">affine_constraints.h</a></div></div>
<div class="ttc" id="adistributed__0_8txt_html_ac2b339f054fd752a401e197097db8cfe"><div class="ttname"><a href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a></div><div class="ttdeci">********clusters ***deal II can use multiple machines connected via MPI to parallelize in addition to the parallelization within a shared memory machine discussed in the[2.x.4] module There are essentially two ways to utilize multiple but only a share of the global sparsity and solution vector is stored on each machine ****The mesh and DoF handler are also i e each processor stores only a share of the cells and degrees of freedom No processor has knowledge of the entire or solution</div><div class="ttdef"><b>Definition:</b> <a href="distributed__0_8txt_source.html#l00025">distributed_0.txt:25</a></div></div>
<div class="ttc" id="afe_2fe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa378cbcddbdf54fb3f9f0acf47b1c4719"><div class="ttname"><a href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa378cbcddbdf54fb3f9f0acf47b1c4719">update_hessians</a></div><div class="ttdeci">@ update_hessians</div><div class="ttdoc">Second derivatives of shape functions.</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__update__flags_8h_source.html#l00084">fe_update_flags.h:84</a></div></div>
<div class="ttc" id="aparameter__handler__0_8txt_html_ad919e2b915d8e8226aef004c2d8399a8"><div class="ttname"><a href="parameter__handler__0_8txt.html#ad919e2b915d8e8226aef004c2d8399a8">exception</a></div><div class="ttdeci">since default values may change in the process of program you cannot know the values of parameters not specified in the input file ****It is often convenient to have something happen as soon as a parameter value is read This could be a check that it is valid that a file that is listed in the parameter file exists **or to initiate something else in such as setting a variable outside the this action could also be initiated once all parameters are read via but it is sometimes[1.x.19] to do it right away *This is facilitated by the and can then do whatever they want with it **e save it somewhere outside the ParameterHandler in C one doesn t usually pass around the address of a but an action can be a function like object(taking a string as argument) that results from calling such as a[1.x.20] that has the form **[1.x.21] *and that is attached to a specific parameter. *A typical example of such an action would be as follows the content of the file equals the default value of the parameter the contents of files are never changed after declaration of a parameter a directory in this file system may not have a file called[2.x.20] in it In that the directory represents a subsection as declared and the directory s name will correspond to the name of the subsection It will then have no files in it at but it may have further directories in the code above will lead to a hierarchical representation of data that looks like this(the content of files is indicated at the right in a different font) this is only used when creating output for exceptions If non empty[2.x.35] is the ParameterHandler object will stop parsing lines after encountering[2.x.36] This is handy when adding extra data that shall be parsed manually If[2.x.37] the parameter handler will skip undefined sections and entries This is useful for partially parsing a parameter for example to obtain only the spatial dimension of the problem By default all entries and subsections are expected to be declared The function sets the value of all parameters it encounters in the input file to the provided value Parameters not explicitly listed in the input file are left at the value they previously which will be the default value provided to and for each parameter all associated actions that may previously have been set by or if an associated action throws an exception</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler__0_8txt_source.html#l00241">parameter_handler_0.txt:241</a></div></div>
<div class="ttc" id="aclassDataOut__DoFData_html_a6ed7c846331069f406b8c9933c37fda4"><div class="ttname"><a href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">DataOut_DoFData::attach_dof_handler</a></div><div class="ttdeci">void attach_dof_handler(const DoFHandler&lt; dim, spacedim &gt; &amp;)</div></div>
<div class="ttc" id="aclassMultigrid_html"><div class="ttname"><a href="classMultigrid.html">Multigrid</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_2multigrid_8h_source.html#l00154">multigrid.h:154</a></div></div>
<div class="ttc" id="aclassDoFHandler_html"><div class="ttname"><a href="classDoFHandler.html">DoFHandler</a></div><div class="ttdef"><b>Definition:</b> <a href="dofs_2dof__handler_8h_source.html#l00266">dof_handler.h:266</a></div></div>
<div class="ttc" id="amg__0_8txt_html_a1f7a91126f3fe8004760adfc52fc5dbe"><div class="ttname"><a href="mg__0_8txt.html#a1f7a91126f3fe8004760adfc52fc5dbe">level</a></div><div class="ttdeci">which is a wrapper around Multigrid with the standard interface of deal II[2.x.9] Preconditioners PreconditionMG also uses the classes inheriting from for instance where it uses[2.x.10] and[2.x.11] which transfer between the global vector and the level vectors we have several auxiliary namely which stores an object on each level **See and[2.x.14] example programs on how to use this functionality **Using multigrid methods on adaptively refined meshes involves more infrastructure than with regular refinement in order to keep the complexity we need to decide how to do the smoothing on each level And to this we have to define what a level is in the sense of multilevel decomposition we define that a level in the multigrid sense is constituted by all cells of a certain level in the mesh hierarchy smoothing on a certain level is restricted to the subdomain which consists of cells of this level or finer This is usually referred to as smoothing The advantage of this definition that level matrices for the multigrid scheme can be assembled easily by traversing to all cells of a certain level</div><div class="ttdef"><b>Definition:</b> <a href="mg__0_8txt_source.html#l00014">mg_0.txt:14</a></div></div>
<div class="ttc" id="aclassDoFHandler_html_a553ca864aaf70330d9be86bc78f36d1e"><div class="ttname"><a href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">DoFHandler::distribute_dofs</a></div><div class="ttdeci">void distribute_dofs(const FiniteElement&lt; dim, spacedim &gt; &amp;fe)</div></div>
<div class="ttc" id="agroup__constraints_html_ga3b4ea7dfd313e388d868c4e4aa685799"><div class="ttname"><a href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a></div><div class="ttdeci">void make_hanging_node_constraints(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, AffineConstraints&lt; number &gt; &amp;constraints)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools__constraints_8cc_source.html#l01787">dof_tools_constraints.cc:1787</a></div></div>
<div class="ttc" id="aclassSolverControl_html_a42aeae81cd6b67ce93b5fbea3328371f"><div class="ttname"><a href="classSolverControl.html#a42aeae81cd6b67ce93b5fbea3328371f">SolverControl::last_step</a></div><div class="ttdeci">unsigned int last_step() const</div><div class="ttdef"><b>Definition:</b> <a href="solver__control_8cc_source.html#l00127">solver_control.cc:127</a></div></div>
<div class="ttc" id="aclassFEValues_html"><div class="ttname"><a href="classFEValues.html">FEValues&lt; dim &gt;</a></div></div>
<div class="ttc" id="anamespaceDifferentiation_1_1SD_html_a592560ee80355620422a86087f11b9df"><div class="ttname"><a href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">Differentiation::SD::fabs</a></div><div class="ttdeci">Expression fabs(const Expression &amp;x)</div><div class="ttdef"><b>Definition:</b> <a href="symengine__math_8cc_source.html#l00273">symengine_math.cc:273</a></div></div>
<div class="ttc" id="afe_2fe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a"><div class="ttname"><a href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a></div><div class="ttdeci">@ update_quadrature_points</div><div class="ttdoc">Transformed quadrature points.</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__update__flags_8h_source.html#l00116">fe_update_flags.h:116</a></div></div>
<div class="ttc" id="aclassFiniteElementData_html_a2cbf5ad6b464871261dbd054bced18a8"><div class="ttname"><a href="classFiniteElementData.html#a2cbf5ad6b464871261dbd054bced18a8">FiniteElementData::degree</a></div><div class="ttdeci">const unsigned int degree</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__base_8h_source.html#l00428">fe_base.h:428</a></div></div>
<div class="ttc" id="aclassTimer_html"><div class="ttname"><a href="classTimer.html">Timer</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2timer_8h_source.html#l00130">timer.h:130</a></div></div>
<div class="ttc" id="anamespaceinternal_1_1TriangulationImplementation_html_a3344398031a9e10cb9eef0784f8da1be"><div class="ttname"><a href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">internal::TriangulationImplementation::n_active_cells</a></div><div class="ttdeci">unsigned int n_active_cells(const internal::TriangulationImplementation::NumberCache&lt; 1 &gt; &amp;c)</div><div class="ttdef"><b>Definition:</b> <a href="grid_2tria_8cc_source.html#l12595">tria.cc:12595</a></div></div>
<div class="ttc" id="anumerics_2vector__tools_8h_html"><div class="ttname"><a href="numerics_2vector__tools_8h.html">vector_tools.h</a></div></div>
<div class="ttc" id="abase_2function_8h_html"><div class="ttname"><a href="base_2function_8h.html">function.h</a></div></div>
<div class="ttc" id="anamespaceDoFTools_html_a43ee44769769065bc594d1730477a4b9"><div class="ttname"><a href="namespaceDoFTools.html#a43ee44769769065bc594d1730477a4b9">DoFTools::make_cell_patches</a></div><div class="ttdeci">void make_cell_patches(SparsityPattern &amp;block_list, const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, const unsigned int level, const std::vector&lt; bool &gt; &amp;selected_dofs={}, const types::global_dof_index offset=0)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools_8cc_source.html#l02411">dof_tools.cc:2411</a></div></div>
<div class="ttc" id="abase_2vectorization_8h_html_a19f846bda83b7e3f4531daacb40c64e1"><div class="ttname"><a href="base_2vectorization_8h.html#a19f846bda83b7e3f4531daacb40c64e1">std::exp</a></div><div class="ttdeci">inline ::VectorizedArray&lt; Number, width &gt; exp(const ::VectorizedArray&lt; Number, width &gt; &amp;x)</div><div class="ttdef"><b>Definition:</b> <a href="base_2vectorization_8h_source.html#l05647">vectorization.h:5647</a></div></div>
<div class="ttc" id="anumerical__algorithms__0_8txt_html_a852a1e245dd2de4943eeb66beeaf65b1"><div class="ttname"><a href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">vector</a></div><div class="ttdeci">****This module groups a diverse set of classes that generally implement some sort of numerical algorithm on top all the basic and finite element classes in the library They are generally unconnected to each other *Some of the like KellyErrorEstimator and act on solutions already and compute derived quantities in the first two or help transferring a set of vectors from one mesh to another *The namespaces and VectorTools provide an assortment of such as creating a Laplace projecting or interpolating a function onto the present finite element etc The difference to the functions in the DoFTools and FETools functions is that they work on the DoFTools functions only act on a given DoFHandler object without reference to a data vector</div><div class="ttdef"><b>Definition:</b> <a href="numerical__algorithms__0_8txt_source.html#l00008">numerical_algorithms_0.txt:8</a></div></div>
<div class="ttc" id="alac_2relaxation__block_8h_html"><div class="ttname"><a href="lac_2relaxation__block_8h.html">relaxation_block.h</a></div></div>
<div class="ttc" id="aclassMGSmootherPrecondition_html_a3cb789b815bf6719eee79e2137c9bd84"><div class="ttname"><a href="classMGSmootherPrecondition.html#a3cb789b815bf6719eee79e2137c9bd84">MGSmootherPrecondition::initialize</a></div><div class="ttdeci">void initialize(const MGLevelObject&lt; MatrixType2 &gt; &amp;matrices, const typename PreconditionerType::AdditionalData &amp;additional_data=typename PreconditionerType::AdditionalData())</div></div>
<div class="ttc" id="aclassPreconditionSOR_html"><div class="ttname"><a href="classPreconditionSOR.html">PreconditionSOR</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2precondition_8h_source.html#l00627">precondition.h:627</a></div></div>
<div class="ttc" id="aclassAffineConstraints_html_a373fbdacd8c486e675b8d2bff8943192"><div class="ttname"><a href="classAffineConstraints.html#a373fbdacd8c486e675b8d2bff8943192">AffineConstraints::distribute_local_to_global</a></div><div class="ttdeci">void distribute_local_to_global(const InVector &amp;local_vector, const std::vector&lt; size_type &gt; &amp;local_dof_indices, OutVector &amp;global_vector) const</div><div class="ttdef"><b>Definition:</b> <a href="lac_2affine__constraints_8h_source.html#l02250">affine_constraints.h:2250</a></div></div>
<div class="ttc" id="aconstraints__0_8txt_html_a5abc878123b65e2a7a16e57bba0e282e"><div class="ttname"><a href="constraints__0_8txt.html#a5abc878123b65e2a7a16e57bba0e282e">constraints</a></div><div class="ttdeci">******This module deals with constraints on degrees of freedom The central class to deal with constraints is the AffineConstraints class *Constraints typically come from several for one usually enforces them by requiring that degrees of freedom on the boundary have particular for example[2.x.3] if the boundary condition[2.x.4] requires that the finite element solution[2.x.5] at the location of degree of freedom has the value Such constraints are generated by those versions of the[2.x.6] function that take a AffineConstraints for example no normal as happens in flow problems and is handled by the[2.x.11] function or prescribed tangential as happens in electromagnetic problems and is handled by the[2.x.13] function For the former imagine for example that we are at at vertex where the normal vector has the form[2.x.14] and that and[2.x.17] components of the flow field at this vertex are associated with degrees of and Then the no normal flux condition means that we need to have the condition[2.x.18] The prescribed tangential component leads to similar constraints though there is often something on the right hand side ****If you have hanging node constraints</div><div class="ttdef"><b>Definition:</b> <a href="constraints__0_8txt_source.html#l00020">constraints_0.txt:20</a></div></div>
<div class="ttc" id="anumerics_2matrix__tools_8h_html"><div class="ttname"><a href="numerics_2matrix__tools_8h.html">matrix_tools.h</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga0d685aad996180f9851183ae3e29019a"><div class="ttname"><a href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">StandardExceptions::ExcIndexRange</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcIndexRange(int arg1, int arg2, int arg3)</div></div>
<div class="ttc" id="agroup__constraints_html_gaf78e864edbfba7e0a7477457bfb96b26"><div class="ttname"><a href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a></div><div class="ttdeci">void make_sparsity_pattern(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, SparsityPatternType &amp;sparsity_pattern, const AffineConstraints&lt; number &gt; &amp;constraints=AffineConstraints&lt; number &gt;(), const bool keep_constrained_dofs=true, const types::subdomain_id subdomain_id=numbers::invalid_subdomain_id)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools__sparsity_8cc_source.html#l00064">dof_tools_sparsity.cc:64</a></div></div>
<div class="ttc" id="aclassMGTransferMatrixFree_html_a8f214ffade006cfa85e902a94902fc7b"><div class="ttname"><a href="classMGTransferMatrixFree.html#a8f214ffade006cfa85e902a94902fc7b">MGTransferMatrixFree::build</a></div><div class="ttdeci">void build(const DoFHandler&lt; dim, dim &gt; &amp;dof_handler, const std::vector&lt; std::shared_ptr&lt; const Utilities::MPI::Partitioner &gt;&gt; &amp;external_partitioners=std::vector&lt; std::shared_ptr&lt; const Utilities::MPI::Partitioner &gt;&gt;())</div><div class="ttdef"><b>Definition:</b> <a href="mg__transfer__matrix__free_8cc_source.html#l00097">mg_transfer_matrix_free.cc:97</a></div></div>
<div class="ttc" id="aclassTensor_html_afd0934b4edd71063f66a9c67540e79fc"><div class="ttname"><a href="classTensor.html#afd0934b4edd71063f66a9c67540e79fc">Tensor::norm</a></div><div class="ttdeci">numbers::NumberTraits&lt; Number &gt;::real_type norm() const</div></div>
<div class="ttc" id="avector__tools__point__value__0_8txt_html_ac7a5c2ceb5c739d5b51cc7e0eee8100a"><div class="ttname"><a href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a></div><div class="ttdeci">*Assembling of right hand sides **Create a right hand side vector for a point source at point[2.x.1] In other it creates a vector[2.x.2] so that[2.x.3] where[2.x.4] are the shape functions described by[2.x.5] and[2.x.6] is the point at which the delta function is located Prior content of the given[2.x.7] vector is deleted This function is for the case of a scalar finite element This function is typically used in one of these two with different values for right hand sides or and then evaluate the solution at the same point every time You could do this by calling[2.x.8] after each solve</div><div class="ttdef"><b>Definition:</b> <a href="vector__tools__point__value__0_8txt_source.html#l00015">vector_tools_point_value_0.txt:15</a></div></div>
<div class="ttc" id="anamespaceDoFRenumbering_html_abbd608826acd7c01f91db401a3728e25"><div class="ttname"><a href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">DoFRenumbering::random</a></div><div class="ttdeci">void random(DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler)</div><div class="ttdef"><b>Definition:</b> <a href="dof__renumbering_8cc_source.html#l02088">dof_renumbering.cc:2088</a></div></div>
<div class="ttc" id="abase_2vectorization_8h_html_a11c48f86a4f2adf21555e64049ecde8c"><div class="ttname"><a href="base_2vectorization_8h.html#a11c48f86a4f2adf21555e64049ecde8c">std::cos</a></div><div class="ttdeci">inline ::VectorizedArray&lt; Number, width &gt; cos(const ::VectorizedArray&lt; Number, width &gt; &amp;x)</div><div class="ttdef"><b>Definition:</b> <a href="base_2vectorization_8h_source.html#l05605">vectorization.h:5605</a></div></div>
<div class="ttc" id="alac_2dynamic__sparsity__pattern_8h_html"><div class="ttname"><a href="lac_2dynamic__sparsity__pattern_8h.html">dynamic_sparsity_pattern.h</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_gae9a45f517af1401c50811a11083f9114"><div class="ttname"><a href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">StandardExceptions::ExcMessage</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcMessage(std::string arg1)</div></div>
<div class="ttc" id="aclassStep63_1_1BoundaryValues_html_abaf128aa6e5fbe6772fa6d4d8be5002c"><div class="ttname"><a href="classStep63_1_1BoundaryValues.html#abaf128aa6e5fbe6772fa6d4d8be5002c">Step63::BoundaryValues::value_list</a></div><div class="ttdeci">virtual void value_list(const std::vector&lt; Point&lt; dim &gt;&gt; &amp;points, std::vector&lt; double &gt; &amp;values, const unsigned int component=0) const override</div><div class="ttdef"><b>Definition:</b> <a href="step-63_8cc_source.html#l00371">step-63.cc:371</a></div></div>
<div class="ttc" id="astructStep63_1_1Settings_html_ac81d04517ae8edec21f699e62fa47fd8"><div class="ttname"><a href="structStep63_1_1Settings.html#ac81d04517ae8edec21f699e62fa47fd8">Step63::Settings::get_parameters</a></div><div class="ttdeci">void get_parameters(const std::string &amp;prm_filename)</div><div class="ttdef"><b>Definition:</b> <a href="step-63_8cc_source.html#l00136">step-63.cc:136</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a61fa98fdc0c52980a5b1de0ee1fc5bb2"><div class="ttname"><a href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">ParameterHandler::get_integer</a></div><div class="ttdeci">long int get_integer(const std::string &amp;entry_string) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l01025">parameter_handler.cc:1025</a></div></div>
<div class="ttc" id="anamespaceMGTools_html_a8c677f65f8f1d21fb1f4c55cb90079e0"><div class="ttname"><a href="namespaceMGTools.html#a8c677f65f8f1d21fb1f4c55cb90079e0">MGTools::make_interface_sparsity_pattern</a></div><div class="ttdeci">void make_interface_sparsity_pattern(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, const MGConstrainedDoFs &amp;mg_constrained_dofs, SparsityPatternType &amp;sparsity, const unsigned int level)</div><div class="ttdef"><b>Definition:</b> <a href="mg__tools_8cc_source.html#l01052">mg_tools.cc:1052</a></div></div>
<div class="ttc" id="aclassDoFHandler_html_a7797f796c0be511fbc7f230ccc22532e"><div class="ttname"><a href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">DoFHandler::get_triangulation</a></div><div class="ttdeci">const Triangulation&lt; dim, spacedim &gt; &amp; get_triangulation() const</div></div>
<div class="ttc" id="agroup__MeshWorker_html_ga76ec61fbd188fb320fe8ca166a79b322"><div class="ttname"><a href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop</a></div><div class="ttdeci">void mesh_loop(const CellIteratorType &amp;begin, const CellIteratorType &amp;end, const CellWorkerFunctionType &amp;cell_worker, const CopierType &amp;copier, const ScratchData &amp;sample_scratch_data, const CopyData &amp;sample_copy_data, const AssembleFlags flags=assemble_own_cells, const BoundaryWorkerFunctionType &amp;boundary_worker=BoundaryWorkerFunctionType(), const FaceWorkerFunctionType &amp;face_worker=FaceWorkerFunctionType(), const unsigned int queue_length=2 *MultithreadInfo::n_threads(), const unsigned int chunk_size=8)</div><div class="ttdef"><b>Definition:</b> <a href="meshworker_2mesh__loop_8h_source.html#l00278">mesh_loop.h:278</a></div></div>
<div class="ttc" id="aclassSolverGMRES_html"><div class="ttname"><a href="classSolverGMRES.html">SolverGMRES</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2solver__gmres_8h_source.html#l00168">solver_gmres.h:168</a></div></div>
<div class="ttc" id="aclassBoundaryValues_html_a45af33d412a06517009ba6f342340256"><div class="ttname"><a href="classBoundaryValues.html#a45af33d412a06517009ba6f342340256">BoundaryValues::value</a></div><div class="ttdeci">virtual double value(const Point&lt; dim &gt; &amp;p, const unsigned int component=0) const override</div><div class="ttdef"><b>Definition:</b> <a href="step-4_8cc_source.html#l00106">step-4.cc:106</a></div></div>
<div class="ttc" id="aclassTensor_html"><div class="ttname"><a href="classTensor.html">Tensor&lt; 1, dim &gt;</a></div></div>
<div class="ttc" id="aclassMGSmoother_html_a9976182b6b272aac7800a8fbf18c8ab9"><div class="ttname"><a href="classMGSmoother.html#a9976182b6b272aac7800a8fbf18c8ab9">MGSmoother::set_steps</a></div><div class="ttdeci">void set_steps(const unsigned int)</div></div>
<div class="ttc" id="aclassBoundaryValues_html"><div class="ttname"><a href="classBoundaryValues.html">BoundaryValues</a></div><div class="ttdef"><b>Definition:</b> <a href="step-4_8cc_source.html#l00086">step-4.cc:86</a></div></div>
<div class="ttc" id="anamespaceStep8_html_a8cfe56efd5e932e7421d357e26eab267"><div class="ttname"><a href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">Step8::right_hand_side</a></div><div class="ttdeci">void right_hand_side(const std::vector&lt; Point&lt; dim &gt;&gt; &amp;points, std::vector&lt; Tensor&lt; 1, dim &gt;&gt; &amp;values)</div><div class="ttdef"><b>Definition:</b> <a href="step-8_8cc_source.html#l00090">step-8.cc:90</a></div></div>
<div class="ttc" id="aclassDataOut_html_a087f63e22f0614bca326dbdca288c646"><div class="ttname"><a href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">DataOut::build_patches</a></div><div class="ttdeci">virtual void build_patches(const unsigned int n_subdivisions=0)</div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__out_8cc_source.html#l01071">data_out.cc:1071</a></div></div>
<div class="ttc" id="aclassmg_1_1Matrix_html"><div class="ttname"><a href="classmg_1_1Matrix.html">mg::Matrix</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_2mg__matrix_8h_source.html#l00045">mg_matrix.h:45</a></div></div>
<div class="ttc" id="amultigrid_2mg__smoother_8h_html"><div class="ttname"><a href="multigrid_2mg__smoother_8h.html">mg_smoother.h</a></div></div>
<div class="ttc" id="ageometry__info__0_8txt_html_a30a552b07accf65da90f851e25d14d1c"><div class="ttname"><a href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a></div><div class="ttdeci">3, where it offers following possibilities:a face(quad) being refined in x- or y-direction(in the face-intern coordinate system) separately,([2.x.79] or([2.x.80] which corresponds to([2.x.81]). Additionally, it offers the possibilities a face can have through repeated anisotropic refinement steps performed on one of the two neighboring cells. It might be possible for example, that a face(quad) is refined with[2.x.82] and afterwards the left child is again refined with[2.x.83], so that there are three active subfaces. Note, however, that only refinement cases are allowed such that each line on a face between two hexes has not more than one hanging node. Furthermore, it is not allowed that two neighboring hexes are refined such that one of the hexes refines the common face with[2.x.84] and the other hex refines that face with[2.x.85] . In fact,[2.x.86] takes care of this situation and ensures that each face of a refined cell is completely contained in a single face of neighboring cells. The following drawings explain the SubfacePossibilities and give the corresponding subface numbers:*[1.x.4] **[2.x.87] *[0.x.68] *Possible cases of faces being subdivided into subface. See documentation to the SubfacePossibilities&lt; 3 &gt; for more details on the subface possibilities. *[0.x.69] *A class that provides all possible cases a face(in the current space dimension[2.x.88] might be subdivided into subfaces. *[2.x.89] *[0.x.70] *Constructor. Take and store a value indicating a particular subface possibility in the list of possible situations specified in the base class. *[0.x.71] *Return the numeric value stored by this class. While the presence of this operator might seem dangerous, it is useful in cases where one would like to have code like&lt; code &gt;switch(subface_case)... case[2.x.90] ...&lt;/code &gt;, which can be written as&lt; code &gt;switch[2.x.91] Another application is to use an object of the current type as an index into an array dim</div><div class="ttdef"><b>Definition:</b> <a href="geometry__info__0_8txt_source.html#l00202">geometry_info_0.txt:202</a></div></div>
<div class="ttc" id="anamespaceStep63_html"><div class="ttname"><a href="namespaceStep63.html">Step63</a></div><div class="ttdef"><b>Definition:</b> <a href="step-63_8cc_source.html#l00071">step-63.cc:71</a></div></div>
<div class="ttc" id="anamespaceStep63_html_a679f6c35915713a90230f261b38f041e"><div class="ttname"><a href="namespaceStep63.html#a679f6c35915713a90230f261b38f041e">Step63::create_downstream_cell_ordering</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; create_downstream_cell_ordering(const DoFHandler&lt; dim &gt; &amp;dof_handler, const Tensor&lt; 1, dim &gt; direction, const unsigned int level)</div><div class="ttdef"><b>Definition:</b> <a href="step-63_8cc_source.html#l00208">step-63.cc:208</a></div></div>
<div class="ttc" id="amultithreading__0_8txt_html_a553c97770c66367cd8861ec511390650"><div class="ttname"><a href="multithreading__0_8txt.html#a553c97770c66367cd8861ec511390650">points</a></div><div class="ttdeci">for if the values of a function need to be evaluated at quadrature points</div><div class="ttdef"><b>Definition:</b> <a href="multithreading__0_8txt_source.html#l00182">multithreading_0.txt:182</a></div></div>
<div class="ttc" id="atrilinos__sparse__matrix__0_8txt_html_ab4e34663c28496ee1b07f40fd5d00fa1"><div class="ttname"><a href="trilinos__sparse__matrix__0_8txt.html#ab4e34663c28496ee1b07f40fd5d00fa1">sparsity_pattern</a></div><div class="ttdeci">all column elements of a row are stored on the same processor in any case The vector&lt; tt &gt; n_entries_per_row&lt;/tt &gt; specifies the number of entries in each row of the newly generated matrix **This function is initializes the Trilinos Epetra matrix according to the specified sparsity_pattern</div><div class="ttdef"><b>Definition:</b> <a href="trilinos__sparse__matrix__0_8txt_source.html#l00162">trilinos_sparse_matrix_0.txt:162</a></div></div>
<div class="ttc" id="aclassDynamicSparsityPattern_html"><div class="ttname"><a href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2dynamic__sparsity__pattern_8h_source.html#l00340">dynamic_sparsity_pattern.h:340</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a4ac3a8b19ade16e96e8ea25906daf23a"><div class="ttname"><a href="classParameterHandler.html#a4ac3a8b19ade16e96e8ea25906daf23a">ParameterHandler::print_parameters</a></div><div class="ttdeci">std::ostream &amp; print_parameters(std::ostream &amp;out, const OutputStyle style) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l01250">parameter_handler.cc:1250</a></div></div>
<div class="ttc" id="aclassSparsityPattern_html"><div class="ttname"><a href="classSparsityPattern.html">SparsityPattern</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2sparsity__pattern_8h_source.html#l00900">sparsity_pattern.h:900</a></div></div>
<div class="ttc" id="anamespaceVectorTools_html_ab2562d41bb26f362043f9719a8cd9b87"><div class="ttname"><a href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a></div><div class="ttdeci">void interpolate_boundary_values(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const std::map&lt; types::boundary_id, const Function&lt; spacedim, number &gt; * &gt; &amp;function_map, std::map&lt; types::global_dof_index, number &gt; &amp;boundary_values, const ComponentMask &amp;component_mask=ComponentMask())</div></div>
<div class="ttc" id="aclassMGTransferPrebuilt_html"><div class="ttname"><a href="classMGTransferPrebuilt.html">MGTransferPrebuilt</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_2mg__transfer_8h_source.html#l00671">mg_transfer.h:671</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga8364dda711b93753c6809eefe2a8e827a3a1480568c2713f53dcb21319bb28093"><div class="ttname"><a href="group__Exceptions.html#ga8364dda711b93753c6809eefe2a8e827a3a1480568c2713f53dcb21319bb28093">ParameterHandler::Text</a></div><div class="ttdeci">@ Text</div><div class="ttdef"><b>Definition:</b> <a href="base_2parameter__handler_8h_source.html#l00880">parameter_handler.h:880</a></div></div>
<div class="ttc" id="anamespaceStep63_html_abe37f2d8c4bdc6c9dc4255f0a778aeec"><div class="ttname"><a href="namespaceStep63.html#abe37f2d8c4bdc6c9dc4255f0a778aeec">Step63::compute_stabilization_delta</a></div><div class="ttdeci">double compute_stabilization_delta(const double hk, const double eps, const Tensor&lt; 1, dim &gt; dir, const double pk)</div><div class="ttdef"><b>Definition:</b> <a href="step-63_8cc_source.html#l00386">step-63.cc:386</a></div></div>
<div class="ttc" id="aauto__derivative__function__0_8txt_html_a53f941360577ad71fbd6bc110ec4f4de"><div class="ttname"><a href="auto__derivative__function__0_8txt.html#a53f941360577ad71fbd6bc110ec4f4de">value_list</a></div><div class="ttdeci">*This class automatically computes the gradient of a function by employing numerical difference quotients This only if the user function does not provide the gradient function himself *The following example of an user defined function overloads and implements only the where the latter function employs numerical difference quotients *****If the user overloads and implements also the gradient of the users gradient function is called that the usage of the also applies to the value_list() and gradient_list() functions as well as to the vector valued versions of these functions</div></div>
<div class="ttc" id="adofs_2dof__tools_8h_html"><div class="ttname"><a href="dofs_2dof__tools_8h.html">dof_tools.h</a></div></div>
<div class="ttc" id="agrid_2grid__refinement_8h_html"><div class="ttname"><a href="grid_2grid__refinement_8h.html">grid_refinement.h</a></div></div>
<div class="ttc" id="alac_2precondition_8h_html"><div class="ttname"><a href="lac_2precondition_8h.html">precondition.h</a></div></div>
<div class="ttc" id="agrid_2grid__out_8h_html"><div class="ttname"><a href="grid_2grid__out_8h.html">grid_out.h</a></div></div>
<div class="ttc" id="aclassFiniteElement_html"><div class="ttname"><a href="classFiniteElement.html">FiniteElement&lt; dim &gt;</a></div></div>
<div class="ttc" id="aadvection__0_8txt_html_a79a3cbbb7583dd309bf1b14dc20895b6"><div class="ttname"><a href="advection__0_8txt.html#a79a3cbbb7583dd309bf1b14dc20895b6">cell_matrix</a></div><div class="ttdeci">**its DG formulations All advection operators depend on an advection velocity denoted by[1.x.0] in the formulas below It is denoted as&lt; tt &gt; velocity&lt;/tt &gt; in the parameter lists The functions cell_matrix() and both upwind_value_matrix() are taking the equation in weak form</div></div>
<div class="ttc" id="ameshworker_2mesh__loop_8h_html"><div class="ttname"><a href="meshworker_2mesh__loop_8h.html">mesh_loop.h</a></div></div>
<div class="ttc" id="astructSettings_html"><div class="ttname"><a href="structSettings.html">Settings</a></div><div class="ttdef"><b>Definition:</b> <a href="step-50_8cc_source.html#l00248">step-50.cc:248</a></div></div>
<div class="ttc" id="aclassQGauss_html"><div class="ttname"><a href="classQGauss.html">QGauss</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2quadrature__lib_8h_source.html#l00039">quadrature_lib.h:39</a></div></div>
<div class="ttc" id="arelaxation__block__0_8txt_html_a2076fd56276055e74e230fad6edac013"><div class="ttname"><a href="relaxation__block__0_8txt.html#a2076fd56276055e74e230fad6edac013">AdditionalData</a></div><div class="ttdeci">*Base class for the implementation of overlapping multiplicative Schwarz relaxation methods and smoothers *This class uses the infrastructure provided by PreconditionBlockBase It adds functions to initialize with a block list and to do the relaxation step The actual relaxation method with the interface expected by SolverRelaxation and MGSmootherRelaxation is in the derived classes *This class allows for more general relaxation methods than PreconditionBlock since the index sets may be arbitrary and overlapping while there only contiguous disjoint sets of equal size are allowed As a drawback this class cannot be used as a preconditioner since its implementation relies on a straight forward implementation of the Gauss Seidel process *Parallel computations require you to specify an initialized ghost vector in *[2.x.0] *****Define number type of matrix **Value type for inverse matrices **Declare type for container size **Parameters for block relaxation methods In addition to typical control parameters like **Constructor **The mapping from indices to blocks Each row of this pattern enumerates the indices constituting a diagonal block to be inverted **Relaxation parameter **Invert diagonal during initialization diagonal blocks are inverted on the whenever they are used While inverting blocks in advance requires more it usually saves a lot of computation See **Assume all diagonal blocks are equal to save memory If this flag is then only the first diagonal block of the matrix is inverted and stored It is then used for all other blocks note Avoid setting this true if your blocks are not in particular if their sizes differ **Choose the inversion method for the blocks **If **If **The order in which blocks should be traversed This vector can initiate several modes of then the relaxation method will be executed from first to last block[2.x.6][2.x.7] If the length is then the inner vector must have the same size as the number of blocks The relaxation method is applied in the order given in this vector[2.x.8][2.x.9] If the outer vector has length greater then the relaxation method is applied several each time in the order given by the inner vector of the corresponding index This mode can for instance be used for ADI methods and similar direction sweeps *[2.x.10][2.x.11] *Temporary ghost vector that is used in the relaxation method when performing parallel MPI computations The user is required to have this point to an initialized vector that contains all indices that appear in the[2.x.12] sa ghost values this the set of locally active level DoFs Unused when VectorType is a serial vector type like Vector&lt; double &gt; **Return the memory allocated in this object **Initialize matrix and additional information In a second the inverses of the diagonal blocks may be computed Note that AdditionalData</div><div class="ttdef"><b>Definition:</b> <a href="relaxation__block__0_8txt_source.html#l00043">relaxation_block_0.txt:43</a></div></div>
<div class="ttc" id="aclassRightHandSide_html"><div class="ttname"><a href="classRightHandSide.html">RightHandSide</a></div><div class="ttdef"><b>Definition:</b> <a href="step-4_8cc_source.html#l00076">step-4.cc:76</a></div></div>
<div class="ttc" id="abase_2quadrature__lib_8h_html"><div class="ttname"><a href="base_2quadrature__lib_8h.html">quadrature_lib.h</a></div></div>
<div class="ttc" id="aautomatic__and__symbolic__differentiation__0_8txt_html_a96ecfde131843f52ee49d0e0c1180134"><div class="ttname"><a href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a></div><div class="ttdeci">computing derivatives of these terms is impractical in most applications in impossible to get right Higher derivatives are even more impossible to do without computer aid Automatic or symbolic differentiation is a way out of and gets compile time</div><div class="ttdef"><b>Definition:</b> <a href="automatic__and__symbolic__differentiation__0_8txt_source.html#l00012">automatic_and_symbolic_differentiation_0.txt:12</a></div></div>
<div class="ttc" id="anamespaceEvaluationFlags_html_a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f"><div class="ttname"><a href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a></div><div class="ttdeci">@ values</div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_2evaluation__flags_8h_source.html#l00055">evaluation_flags.h:55</a></div></div>
<div class="ttc" id="agrid_2manifold__lib_8h_html"><div class="ttname"><a href="grid_2manifold__lib_8h.html">manifold_lib.h</a></div></div>
<div class="ttc" id="afunction__time__0_8txt_html_aec9d63e7b1c02618470be701525a5211"><div class="ttname"><a href="function__time__0_8txt.html#aec9d63e7b1c02618470be701525a5211">sin</a></div><div class="ttdeci">*Support for time dependent functions The library was also designed for time dependent problems For this the function objects also contain a field which stores the as well as functions manipulating them Time independent problems should not access or even abuse them for other but since one normally does not create thousands of function the gain in generality weighs out the fact that we need not store the time value for not time dependent problems The second advantage is that the derived standard classes like&lt; tt &gt;&lt; tt &gt; ConstantFunction&lt;/tt &gt; etc also work for time dependent problems *Access to the time goes through the following so that derived classes can perform computations which need only be done once for every new time For if a time dependent function had a factor&lt; tt &gt; sin(t)&lt;/tt &gt;</div></div>
<div class="ttc" id="aclassMGCoarseGridHouseholder_html"><div class="ttname"><a href="classMGCoarseGridHouseholder.html">MGCoarseGridHouseholder</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_2mg__coarse_8h_source.html#l00192">mg_coarse.h:192</a></div></div>
<div class="ttc" id="aclassMGSmootherPrecondition_html"><div class="ttname"><a href="classMGSmootherPrecondition.html">MGSmootherPrecondition</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_2mg__smoother_8h_source.html#l00458">mg_smoother.h:458</a></div></div>
<div class="ttc" id="astructSettings_html_a4594afbef1241352404073ba65f20a97"><div class="ttname"><a href="structSettings.html#a4594afbef1241352404073ba65f20a97">Settings::output</a></div><div class="ttdeci">bool output</div><div class="ttdef"><b>Definition:</b> <a href="step-50_8cc_source.html#l00265">step-50.cc:265</a></div></div>
<div class="ttc" id="aclassMGLevelObject_html_a16213121f9153bd08f49652a11886259"><div class="ttname"><a href="classMGLevelObject.html#a16213121f9153bd08f49652a11886259">MGLevelObject::resize</a></div><div class="ttdeci">void resize(const unsigned int new_minlevel, const unsigned int new_maxlevel, Args &amp;&amp;... args)</div><div class="ttdef"><b>Definition:</b> <a href="base_2mg__level__object_8h_source.html#l00225">mg_level_object.h:225</a></div></div>
<div class="ttc" id="amultigrid_2mg__tools_8h_html"><div class="ttname"><a href="multigrid_2mg__tools_8h.html">mg_tools.h</a></div></div>
<div class="ttc" id="afe__evaluation__0_8txt_html_a8f384576a64c89a6fa8352847523e340"><div class="ttname"><a href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a></div><div class="ttdeci">FE_Q with hanging node constraints connects to more neighbors than a FE_DGQ for and cells which need data exchange are put in different positions inside the cell loop Of if the exact same and then the order is going to be the same because the algorithm is deterministic *dim Dimension in which this class is to be used *fe_degree Degree of the tensor product finite element with fe_degree degrees of freedom per coordinate direction Can be set to **if the degree is not known at compile but performance will usually be worse by a factor of *n_q_points_1d Number of points in the quadrature formula defaults to fe_degree *n_components Number of vector components when solving a system of PDEs If the same operation is applied to several components of a they can be applied simultaneously with one usually[2.x.339] or[2.x.340] Defaults to[2.x.341] double ******An alias to the base class **An underlying number type specified as template argument **The type of function e g VectorizedArrayType for e g Tensor&lt; 1, dim, VectorizedArrayType &gt; for n_q_points</div><div class="ttdef"><b>Definition:</b> <a href="fe__evaluation__0_8txt_source.html#l00537">fe_evaluation_0.txt:537</a></div></div>
<div class="ttc" id="aclassAffineConstraints_html"><div class="ttname"><a href="classAffineConstraints.html">AffineConstraints&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassAffineConstraints_html_a7b3d3f295bb56d6cd6856bdc6cbe8a01"><div class="ttname"><a href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">AffineConstraints::distribute</a></div><div class="ttdeci">void distribute(VectorType &amp;vec) const</div></div>
<div class="ttc" id="adofs_2dof__renumbering_8h_html"><div class="ttname"><a href="dofs_2dof__renumbering_8h.html">dof_renumbering.h</a></div></div>
<div class="ttc" id="aclassAffineConstraints_html_addd15bc409c61d6f795f0132c574335b"><div class="ttname"><a href="classAffineConstraints.html#addd15bc409c61d6f795f0132c574335b">AffineConstraints::clear</a></div><div class="ttdeci">void clear()</div></div>
<div class="ttc" id="aslepc__solver__0_8txt_html_afc0cee819555f10faaf9909433da6fba"><div class="ttname"><a href="slepc__solver__0_8txt.html#afc0cee819555f10faaf9909433da6fba">settings</a></div><div class="ttdeci">namespace are written in such a way that the underlying SLEPc objects are initialized in constructors By doing so one also avoid caching of different settings(such as target eigenvalue or type of the problem)</div></div>
<div class="ttc" id="afe_2fe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85"><div class="ttname"><a href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a></div><div class="ttdeci">@ update_JxW_values</div><div class="ttdoc">Transformed quadrature weights.</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__update__flags_8h_source.html#l00124">fe_update_flags.h:124</a></div></div>
<div class="ttc" id="amultigrid_2mg__matrix_8h_html"><div class="ttname"><a href="multigrid_2mg__matrix_8h.html">mg_matrix.h</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga70a0bb353656e704acf927945277bbc6"><div class="ttname"><a href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a></div><div class="ttdeci">#define Assert(cond, exc)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2exceptions_8h_source.html#l01581">exceptions.h:1581</a></div></div>
<div class="ttc" id="aclassPreconditionMG_html"><div class="ttname"><a href="classPreconditionMG.html">PreconditionMG</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_2multigrid_8h_source.html#l00492">multigrid.h:492</a></div></div>
<div class="ttc" id="alac_2full__matrix_8h_html"><div class="ttname"><a href="lac_2full__matrix_8h.html">full_matrix.h</a></div></div>
<div class="ttc" id="aclassMGLevelObject_html"><div class="ttname"><a href="classMGLevelObject.html">MGLevelObject&lt; SparsityPattern &gt;</a></div></div>
<div class="ttc" id="awork__stream__0_8txt_html_a8f80058531659e3e5ae0f7e91a963519"><div class="ttname"><a href="work__stream__0_8txt.html#a8f80058531659e3e5ae0f7e91a963519">ScratchData</a></div><div class="ttdeci">for for the purpose of assembling matrices or evaluating error an item could be a cell The TBB library determines how many threads are but the number of items that may be active at any given time is specified by the argument to the constructor It should be bigger or equal to the number of processor cores **the default is four times the number of cores on the current system *Items are created upon request by the TBB whenever one of the worker threads is idle or is expected to become idle It is then handed off to a worker typically a member function of a main class These worker functions are run in parallel on a number of and there is no guarantee that they are asked to work on items in any particular in particular not necessarily in the order in which items are generated from the iterator range worker functions need additional for example FEValues input data some of which can not be shared among threads To this the ScratchData</div><div class="ttdef"><b>Definition:</b> <a href="work__stream__0_8txt_source.html#l00009">work_stream_0.txt:9</a></div></div>
<div class="ttc" id="adofs_2dof__handler_8h_html"><div class="ttname"><a href="dofs_2dof__handler_8h.html">dof_handler.h</a></div></div>
<div class="ttc" id="astep-69_8cc_html_a66a64d07b4db87c87b639bdcf7b18c82"><div class="ttname"><a href="step-69_8cc.html#a66a64d07b4db87c87b639bdcf7b18c82">local_dof_indices</a></div><div class="ttdeci">std::vector&lt; types::global_dof_index &gt; local_dof_indices</div><div class="ttdef"><b>Definition:</b> <a href="step-69_8cc_source.html#l00534">step-69.cc:534</a></div></div>
<div class="ttc" id="alac_2vector_8h_html"><div class="ttname"><a href="lac_2vector_8h.html">vector.h</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_gaa3cbced9f1d4ae661f13018f4c980aa1ab87bd17d3acf6932f7bb6927f58fe3cd"><div class="ttname"><a href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1ab87bd17d3acf6932f7bb6927f58fe3cd">DataOutBase::eps</a></div><div class="ttdeci">@ eps</div><div class="ttdef"><b>Definition:</b> <a href="base_2data__out__base_8h_source.html#l01598">data_out_base.h:1598</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga6060b2304b8600f5efa0d31eeda0207d"><div class="ttname"><a href="group__Exceptions.html#ga6060b2304b8600f5efa0d31eeda0207d">StandardExceptions::ExcDimensionMismatch</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcDimensionMismatch(std::size_t arg1, std::size_t arg2)</div></div>
<div class="ttc" id="aclassPreconditionJacobi_html"><div class="ttname"><a href="classPreconditionJacobi.html">PreconditionJacobi</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2precondition_8h_source.html#l00544">precondition.h:544</a></div></div>
<div class="ttc" id="aclassPoint_html"><div class="ttname"><a href="classPoint.html">Point&lt; dim &gt;</a></div></div>
<div class="ttc" id="aclassTriangulation_html_a5ea5c9957dbb566a562bbe2c0f3971e9"><div class="ttname"><a href="classTriangulation.html#a5ea5c9957dbb566a562bbe2c0f3971e9">Triangulation::n_active_cells</a></div><div class="ttdeci">unsigned int n_active_cells() const</div><div class="ttdef"><b>Definition:</b> <a href="grid_2tria_8cc_source.html#l12645">tria.cc:12645</a></div></div>
<div class="ttc" id="afe__evaluation__0_8txt_html_ad3b9cdeadeb3bcdb52af5db70c041a6e"><div class="ttname"><a href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a></div><div class="ttdeci">FE_Q with hanging node constraints connects to more neighbors than a FE_DGQ for and cells which need data exchange are put in different positions inside the cell loop Of if the exact same and then the order is going to be the same because the algorithm is deterministic *dim Dimension in which this class is to be used *fe_degree Degree of the tensor product finite element with fe_degree degrees of freedom per coordinate direction Can be set to **if the degree is not known at compile but performance will usually be worse by a factor of *n_q_points_1d Number of points in the quadrature formula defaults to fe_degree *n_components Number of vector components when solving a system of PDEs If the same operation is applied to several components of a they can be applied simultaneously with one usually[2.x.339] or[2.x.340] Defaults to[2.x.341] double ******An alias to the base class **An underlying number type specified as template argument **The type of function e g VectorizedArrayType for e g Tensor&lt; 1, dim, VectorizedArrayType &gt; for can be different if such as FE_DGP **static The number of degrees of freedom of all components determined from the given template argument fe_degree Note that the actual number of degrees of freedom dofs_per_cell can be different if such as FE_DGP **static The number of degrees of freedom of all components determined from the given template argument fe_degree Note that the actual number of degrees of freedom dofs_per_cell can be different if such as FE_DGP **Constructor Takes all data stored in MatrixFree If applied to problems with more than one finite element or more than one quadrature formula selected during construction of[2.x.343] the appropriate component can be selected by the optional arguments[2.x.344] matrix_free Data object that contains all data[2.x.345] dof_no If matrix_free was set up with multiple DoFHandler this parameter selects to which DoFHandler AffineConstraints pair the given evaluator should be attached to[2.x.346] quad_no If matrix_free was set up with multiple Quadrature this parameter selects the appropriate number of the quadrature formula[2.x.347] first_selected_component If the dof_handler selected by dof_no uses an FESystem consisting of more than one this parameter allows for selecting the component where the current evaluation routine should start Note that one evaluator does not support combining different shape functions in different components In other the same base element of a FESystem needs to be set for the components between[2.x.348] and[2.x.349][2.x.350] active_fe_index If matrix_free was set up with DoFHandler objects with[2.x.351] this parameter selects to which DoFHandler AffineConstraints pair the given evaluator should be attached to[2.x.352] active_quad_index If matrix_free was set up with[2.x.353] this parameter selects the appropriate number of the quadrature formula **Constructor Takes all data stored in MatrixFree for a given cell which allows to automatically identify the active_fe_index and active_quad_index in case of a p adaptive strategy The rest of the arguments are the same as in the constructor above **Constructor that comes with reduced functionality and works similar as FEValues The arguments are similar to the ones passed to the constructor of with the notable difference that FEEvaluation expects a one dimensional quadrature instead of a[2.x.354] dimensional one The finite element can be both scalar or vector but this method always only selects a scalar base element at a the optional argument[2.x.356] allows to specify the index of the base element to be used for evaluation Note that the internal data structures always assume that the base element is non primitive are not supported currently As known from a call to the reinit method with a[2.x.357] is necessary to make the geometry and degrees of freedom of the current class known::If the iterator includes DoFHandler the initialization allows to also read from or write to vectors in the standard way for[2.x.359] types for one cell at a time this approach is much slower than the path with MatrixFree with MPI since index translation has to be done As only one cell at a time is this method does not vectorize over several but only possibly within the element if the evaluate integrate routines are combined inside user an object of type i the underlying mapping and quadrature points do only need to be evaluated once Make sure to not pass an optional object around when you intend to use the FEEvaluation object in parallel to the given one because otherwise the intended sharing may create race conditions **Copy constructor If FEEvaluationBase was constructed from a fe</div><div class="ttdef"><b>Definition:</b> <a href="fe__evaluation__0_8txt_source.html#l00555">fe_evaluation_0.txt:555</a></div></div>
<div class="ttc" id="aclassParameterHandler_html"><div class="ttname"><a href="classParameterHandler.html">ParameterHandler</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2parameter__handler_8h_source.html#l00820">parameter_handler.h:820</a></div></div>
<div class="ttc" id="aclassDoFHandler_html_a9aed31323cbd7619edac310c47e7a7ad"><div class="ttname"><a href="classDoFHandler.html#a9aed31323cbd7619edac310c47e7a7ad">DoFHandler::distribute_mg_dofs</a></div><div class="ttdeci">void distribute_mg_dofs()</div></div>
<div class="ttc" id="anamespaceMGTools_html_a19ba9ee4a2b65235c8bb3fb65ea8f4e0"><div class="ttname"><a href="namespaceMGTools.html#a19ba9ee4a2b65235c8bb3fb65ea8f4e0">MGTools::make_sparsity_pattern</a></div><div class="ttdeci">void make_sparsity_pattern(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, SparsityPatternType &amp;sparsity, const unsigned int level, const AffineConstraints&lt; number &gt; &amp;constraints=AffineConstraints&lt; number &gt;(), const bool keep_constrained_dofs=true)</div><div class="ttdef"><b>Definition:</b> <a href="mg__tools_8cc_source.html#l00593">mg_tools.cc:593</a></div></div>
<div class="ttc" id="aclassFullMatrix_html"><div class="ttname"><a href="classFullMatrix.html">FullMatrix&lt; double &gt;</a></div></div>
<div class="ttc" id="amultigrid_2mg__constrained__dofs_8h_html"><div class="ttname"><a href="multigrid_2mg__constrained__dofs_8h.html">mg_constrained_dofs.h</a></div></div>
<div class="ttc" id="aclassFunction_html"><div class="ttname"><a href="classFunction.html">Function</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2function_8h_source.html#l00140">function.h:140</a></div></div>
<div class="ttc" id="acoding__conventions__0_8txt_html_ac639e1db0b03fc797eca55e266afa976"><div class="ttname"><a href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a></div><div class="ttdeci">functions which clear bits or flags should be named[2.x.15] use[2.x.18] instead of *[2.x.19] In the implementation after each three empty lines are expected to enable better readability One empty line occurs in functions to group blocks of since two empty lines are not enough to visibly distinguish sufficiently that the code belongs to two different functions *[2.x.21] Whenever an integer variable can only assume nonnegative it is marked as unsigned The same applies to functions that can only return positive or zero values it should be marked even if passed by value we mark input parameters as const This aids as an additional documentation tool to clarify the intent of a which is often either involuntarily or poor style *[2.x.25] Whenever a function does not change any of the member variable of the embedding class it should be marked as const  *[2.x.27] Function and variable names may not consist of only one or two unless the variable is a pure counting index *[2.x.29] Type the number of children per cell</div><div class="ttdef"><b>Definition:</b> <a href="coding__conventions__0_8txt_source.html#l00027">coding_conventions_0.txt:27</a></div></div>
<div class="ttc" id="aclassMGCoarseGridHouseholder_html_a07bd76dc7f6f66cb22d3e7951a558f50"><div class="ttname"><a href="classMGCoarseGridHouseholder.html#a07bd76dc7f6f66cb22d3e7951a558f50">MGCoarseGridHouseholder::initialize</a></div><div class="ttdeci">void initialize(const FullMatrix&lt; number &gt; &amp;A)</div></div>
<div class="ttc" id="agroup__Exceptions_html_gaa3cbced9f1d4ae661f13018f4c980aa1acc6b05c836e9f74fb7ab9390ffc26f1c"><div class="ttname"><a href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1acc6b05c836e9f74fb7ab9390ffc26f1c">DataOutBase::none</a></div><div class="ttdeci">@ none</div><div class="ttdef"><b>Definition:</b> <a href="base_2data__out__base_8h_source.html#l01568">data_out_base.h:1568</a></div></div>
<div class="ttc" id="aclassSolverControl_html"><div class="ttname"><a href="classSolverControl.html">SolverControl</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2solver__control_8h_source.html#l00052">solver_control.h:52</a></div></div>
<div class="ttc" id="aclassStep63_1_1RightHandSide_html_a3c01155ebc56cbf683d19c7da2a27004"><div class="ttname"><a href="classStep63_1_1RightHandSide.html#a3c01155ebc56cbf683d19c7da2a27004">Step63::RightHandSide::value_list</a></div><div class="ttdeci">virtual void value_list(const std::vector&lt; Point&lt; dim &gt;&gt; &amp;points, std::vector&lt; double &gt; &amp;values, const unsigned int component=0) const override</div><div class="ttdef"><b>Definition:</b> <a href="step-63_8cc_source.html#l00324">step-63.cc:324</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Selection_html"><div class="ttname"><a href="classPatterns_1_1Selection.html">Patterns::Selection</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2patterns_8h_source.html#l00400">patterns.h:400</a></div></div>
<div class="ttc" id="agroup__CPP11_html_gaace8c98aca00e7e48a619bb5e08084aa"><div class="ttname"><a href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">DoFHandler::active_cell_iterators</a></div><div class="ttdeci">IteratorRange&lt; active_cell_iterator &gt; active_cell_iterators() const</div></div>
<div class="ttc" id="anamespaceTriangulationDescription_html_aa1531298eb0a267d9ceca5eb46ada8e0"><div class="ttname"><a href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">TriangulationDescription::Settings</a></div><div class="ttdeci">Settings</div><div class="ttdef"><b>Definition:</b> <a href="grid_2tria__description_8h_source.html#l00255">tria_description.h:255</a></div></div>
<div class="ttc" id="apolynomial__space__0_8txt_html_ac00ea19562c135512a6ff275a3cf0d8f"><div class="ttname"><a href="polynomial__space__0_8txt.html#ac00ea19562c135512a6ff275a3cf0d8f">j</a></div><div class="ttdeci">*Representation of the space of polynomials of degree at most n in higher dimensions *Given a vector of[1.x.0] one dimensional polynomials[1.x.1] where[1.x.3] has this class generates all dim dimensional polynomials of the where the sum and[1.x.8] is less than or equal *[1.x.9] The i e for each dim dimensional polynomial in the polynomial space it gives the indices j</div><div class="ttdef"><b>Definition:</b> <a href="polynomial__space__0_8txt_source.html#l00004">polynomial_space_0.txt:4</a></div></div>
<div class="ttc" id="amg__0_8txt_html_a1dadc108ee1520717957789de4b76416"><div class="ttname"><a href="mg__0_8txt.html#a1dadc108ee1520717957789de4b76416">cycle</a></div><div class="ttdeci">****Classes that have to do with multigrid algorithms *The main class with implementation of the multigrid scheme is Multigrid with its function[2.x.1] It uses the abstract following classes in order to perform the multigrid cycle</div><div class="ttdef"><b>Definition:</b> <a href="mg__0_8txt_source.html#l00007">mg_0.txt:7</a></div></div>
<div class="ttc" id="anamespaceDoFTools_html_a1fef7be07cf379b661646e39b9354e17"><div class="ttname"><a href="namespaceDoFTools.html#a1fef7be07cf379b661646e39b9354e17">DoFTools::extract_locally_relevant_level_dofs</a></div><div class="ttdeci">void extract_locally_relevant_level_dofs(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, const unsigned int level, IndexSet &amp;dof_set)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools_8cc_source.html#l01175">dof_tools.cc:1175</a></div></div>
<div class="ttc" id="afe_2mapping__q_8h_html"><div class="ttname"><a href="fe_2mapping__q_8h.html">mapping_q.h</a></div></div>
<div class="ttc" id="astructStep63_1_1Settings_html"><div class="ttname"><a href="structStep63_1_1Settings.html">Step63::Settings</a></div><div class="ttdef"><b>Definition:</b> <a href="step-63_8cc_source.html#l00113">step-63.cc:113</a></div></div>
<div class="ttc" id="aclassPreconditionBlockBase_html"><div class="ttname"><a href="classPreconditionBlockBase.html">PreconditionBlockBase</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2precondition__block__base_8h_source.html#l00057">precondition_block_base.h:57</a></div></div>
<div class="ttc" id="aclassTriangulation_html_abea687f123f3f5a8b09d7485cf03be72"><div class="ttname"><a href="classTriangulation.html#abea687f123f3f5a8b09d7485cf03be72">Triangulation::n_cells</a></div><div class="ttdeci">unsigned int n_cells() const</div><div class="ttdef"><b>Definition:</b> <a href="grid_2tria_8cc_source.html#l12637">tria.cc:12637</a></div></div>
<div class="ttc" id="anumerics_2data__out_8h_html"><div class="ttname"><a href="numerics_2data__out_8h.html">data_out.h</a></div></div>
<div class="ttc" id="aclassDataOut_html"><div class="ttname"><a href="classDataOut.html">DataOut&lt; dim &gt;</a></div></div>
<div class="ttc" id="anamespacenumbers_html_a3e24f194a9cb9b6ff4442b8a7a877d4a"><div class="ttname"><a href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a></div><div class="ttdeci">static constexpr double PI</div><div class="ttdef"><b>Definition:</b> <a href="base_2numbers_8h_source.html#l00237">numbers.h:237</a></div></div>
<div class="ttc" id="afe__evaluation__0_8txt_html_a66b432045b82ed9b1c850f6407d4b1ca"><div class="ttname"><a href="fe__evaluation__0_8txt.html#a66b432045b82ed9b1c850f6407d4b1ca">fe_degree</a></div><div class="ttdeci">FE_Q with hanging node constraints connects to more neighbors than a FE_DGQ for and cells which need data exchange are put in different positions inside the cell loop Of if the exact same and then the order is going to be the same because the algorithm is deterministic *dim Dimension in which this class is to be used *fe_degree Degree of the tensor product finite element with fe_degree degrees of freedom per coordinate direction Can be set to **if the degree is not known at compile but performance will usually be worse by a factor of *n_q_points_1d Number of points in the quadrature formula defaults to fe_degree *n_components Number of vector components when solving a system of PDEs If the same operation is applied to several components of a they can be applied simultaneously with one usually[2.x.339] or[2.x.340] Defaults to[2.x.341] double ******An alias to the base class **An underlying number type specified as template argument **The type of function e g VectorizedArrayType for e g Tensor&lt; 1, dim, VectorizedArrayType &gt; for can be different if fe_degree</div><div class="ttdef"><b>Definition:</b> <a href="fe__evaluation__0_8txt_source.html#l00537">fe_evaluation_0.txt:537</a></div></div>
<div class="ttc" id="afunctions__0_8txt_html_af9f808a82e8c618e2e7a19dd08a9eae3"><div class="ttname"><a href="functions__0_8txt.html#af9f808a82e8c618e2e7a19dd08a9eae3">value</a></div><div class="ttdeci">****Functions are used in various places in deal for example to describe boundary coefficients in forcing or exact solutions Since closed form expressions for equations are often hard to pass along as function deal II uses the Function base class to describe these objects Essentially the interface of this base class requires derived classes to implement the ability to return the value of a function at one or a list of particular locations and function objects can then be used by algorithms like[2.x.1][2.x.2] and other functions *Some functions are needed again and and are therefore already provided in deal II This includes a function with a constant value</div><div class="ttdef"><b>Definition:</b> <a href="functions__0_8txt_source.html#l00007">functions_0.txt:7</a></div></div>
<div class="ttc" id="aclassVector_html"><div class="ttname"><a href="classVector.html">Vector&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassStep63_1_1AdvectionProblem_html_a20cff1646814eaae513b4a304d4dde33"><div class="ttname"><a href="classStep63_1_1AdvectionProblem.html#a20cff1646814eaae513b4a304d4dde33">Step63::AdvectionProblem::AdvectionProblem</a></div><div class="ttdeci">AdvectionProblem(const Settings &amp;settings)</div><div class="ttdef"><b>Definition:</b> <a href="step-63_8cc_source.html#l00465">step-63.cc:465</a></div></div>
<div class="ttc" id="aclassRightHandSide_html_a07b87d7025c7c5feca044c5c7d4296ef"><div class="ttname"><a href="classRightHandSide.html#a07b87d7025c7c5feca044c5c7d4296ef">RightHandSide::value</a></div><div class="ttdeci">virtual double value(const Point&lt; dim &gt; &amp;p, const unsigned int component=0) const override</div><div class="ttdef"><b>Definition:</b> <a href="step-4_8cc_source.html#l00094">step-4.cc:94</a></div></div>
<div class="ttc" id="astructScratchData_html"><div class="ttname"><a href="structScratchData.html">ScratchData</a></div><div class="ttdef"><b>Definition:</b> <a href="step-50_8cc_source.html#l01072">step-50.cc:1072</a></div></div>
<div class="ttc" id="atria__base__0_8txt_html_ae719aa7414a4e6e44d55715033cbfc6e"><div class="ttname"><a href="tria__base__0_8txt.html#ae719aa7414a4e6e44d55715033cbfc6e">n_levels</a></div><div class="ttdeci">in other for vertices at the boundary of a the processor with the lowest subdomain id owns a vertex *It only makes sense to move vertices that are either located on locally owned cells or on cells in the ghost layer This is because you can be sure that these vertices indeed exist on the finest mesh aggregated over all whereas vertices on artificial cells but not at least in the ghost layer may or may not exist on the globally finest mesh the[2.x.36] argument may not contain vertices that aren t at least on ghost cells *This function moves vertices in such a way that on every the vertices of every locally owned and ghost cell is consistent with the corresponding location of these cells on other processors On the other the locations of artificial cells will in general be wrong since artificial cells may or may not exist on other processors and consequently it is not possible to determine their location in any way This is not usually a problem since one never does anything on artificial cells it may lead to problems if the mesh with moved vertices is refined in a later step If that s what you want to the right way to do it is to save the offset applied to every call this and before refining or coarsening the mesh apply the opposite offset and call this function again[2.x.38] vertex_locally_moved A bitmap indicating which vertices have been moved The size of this array must be equal to[2.x.39] and must be a subset of those vertices flagged by[2.x.40][2.x.41] This function is for in *[2.x.42] *MPI communicator to be used for the triangulation We create a unique communicator for this which is a duplicate of the one passed to the constructor **The subdomain id to be used for the current processor This is the MPI rank **The total number of so&lt; tt &gt; n_levels()&lt;</div></div>
<div class="ttc" id="alac_2sparse__matrix_8h_html"><div class="ttname"><a href="lac_2sparse__matrix_8h.html">sparse_matrix.h</a></div></div>
<div class="ttc" id="aclassAffineConstraints_html_a1611aa37f754086388ca76bcd421cce5"><div class="ttname"><a href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">AffineConstraints::close</a></div><div class="ttdeci">void close()</div></div>
<div class="ttc" id="agroup__Exceptions_html_gafc0ca7ad85b3ebd64e8e51689ac85caf"><div class="ttname"><a href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a></div><div class="ttdeci">#define AssertThrow(cond, exc)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2exceptions_8h_source.html#l01699">exceptions.h:1699</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a0ddaa05c5463c6c0b7701e18005717a9"><div class="ttname"><a href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">ParameterHandler::parse_input</a></div><div class="ttdeci">virtual void parse_input(std::istream &amp;input, const std::string &amp;filename=&quot;input file&quot;, const std::string &amp;last_line=&quot;&quot;, const bool skip_undefined=false)</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00399">parameter_handler.cc:399</a></div></div>
<div class="ttc" id="aclassFEValues_html_ae053b49309f1dce22268c6bc8fe50cb2"><div class="ttname"><a href="classFEValues.html#ae053b49309f1dce22268c6bc8fe50cb2">FEValues::get_quadrature</a></div><div class="ttdeci">const Quadrature&lt; dim &gt; &amp; get_quadrature() const</div></div>
<div class="ttc" id="aclassRelaxationBlock_html"><div class="ttname"><a href="classRelaxationBlock.html">RelaxationBlock</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2relaxation__block_8h_source.html#l00055">relaxation_block.h:55</a></div></div>
<div class="ttc" id="afe_2fe__values__0_8txt_html_a15ff2e0c168966d6ae13c4faabcec165"><div class="ttname"><a href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a></div><div class="ttdeci">we have to work a bit harder to compute this information **Default constructor Creates an invalid object **Constructor for an object that represents a single scalar component of a FEValuesBase for the shape function and quadrature point selected by the arguments[2.x.27] shape_function Number of the shape function to be evaluated Note that this number runs from zero to dofs_per_cell</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values__0_8txt_source.html#l00073">fe_values_0.txt:73</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Double_html"><div class="ttname"><a href="classPatterns_1_1Double.html">Patterns::Double</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2patterns_8h_source.html#l00307">patterns.h:307</a></div></div>
<div class="ttc" id="aparsed__convergence__table__0_8txt_html_a8a90f5ba57a42a3fd4c067e00f8b8aea"><div class="ttname"><a href="parsed__convergence__table__0_8txt.html#a8a90f5ba57a42a3fd4c067e00f8b8aea">p</a></div><div class="ttdeci">****This class simplifies the construction of convergence tables reading the options for the generation of the table from a parameter file It provides a series of methods that can be used to compute the error given a reference exact solution or the difference between two numerical solutions or any other custom computation of the error given via[2.x.1] objects *An example usage of this class is given by ****The above code constructs a ParsedConvergenceTable that works for scalar and will produce an error table with and Linfty_norm norms of the error *Whenever a call to the methods the instance of this class inspects its parameters computes all norms specified by the parameter given at construction time possibly modified via a parameter file computes all extra column entries specified using the method and writes one row of the convergence table *Once you have finished with the a call to and to the the same code can be used to estimate the errors of mixed or multi physics e and one component for the pressure field p</div><div class="ttdef"><b>Definition:</b> <a href="parsed__convergence__table__0_8txt_source.html#l00020">parsed_convergence_table_0.txt:20</a></div></div>
<div class="ttc" id="anamespaceMeshWorker_html_ac7a9db8b34d398d7d398d1e8809874aaacb8627085561cee8b7af9d74320696eb"><div class="ttname"><a href="namespaceMeshWorker.html#ac7a9db8b34d398d7d398d1e8809874aaacb8627085561cee8b7af9d74320696eb">MeshWorker::assemble_own_cells</a></div><div class="ttdeci">@ assemble_own_cells</div><div class="ttdef"><b>Definition:</b> <a href="meshworker_2assemble__flags_8h_source.html#l00050">assemble_flags.h:50</a></div></div>
<div class="ttc" id="agrid_2grid__generator_8h_html"><div class="ttname"><a href="grid_2grid__generator_8h.html">grid_generator.h</a></div></div>
<div class="ttc" id="atable__0_8txt_html_aa889bb34debce4db8c9ace2f875bdf0d"><div class="ttname"><a href="table__0_8txt.html#aa889bb34debce4db8c9ace2f875bdf0d">component</a></div><div class="ttdeci">tables that store three or more dimensional then there is nothing you can do about the size of these if your program is parallelized via then a typical first implementation would create a table object on every process and fill it on every MPI process by reading the data from a file This is inefficient from two the data stored on every process is the and while every process needs to be able to read from a it is not necessary that every process stores its own either by re creating a copy of the table in the other processes memory space if by creating copies in shared memory once for all processes located on each of the machines used by the MPI job ******Integer type used to count the number of elements in this container **Default constructor Set all dimensions to zero **Constructor Initialize the array with the given dimensions in each index component **Constructor Initialize the array with the given dimensions in each index component</div><div class="ttdef"><b>Definition:</b> <a href="table__0_8txt_source.html#l00083">table_0.txt:83</a></div></div>
<div class="ttc" id="aclassDoFHandler_html_aa5b8d3c4b9deb0774dde5c2851e07e1e"><div class="ttname"><a href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">DoFHandler::n_dofs</a></div><div class="ttdeci">types::global_dof_index n_dofs() const</div></div>
<div class="ttc" id="acoding__conventions__0_8txt_html_a02f5aa616d7b0799c538fe77d6c6c795"><div class="ttname"><a href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a></div><div class="ttdeci">i e</div><div class="ttdef"><b>Definition:</b> <a href="coding__conventions__0_8txt_source.html#l00028">coding_conventions_0.txt:28</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Integer_html"><div class="ttname"><a href="classPatterns_1_1Integer.html">Patterns::Integer</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2patterns_8h_source.html#l00198">patterns.h:198</a></div></div>
<div class="ttc" id="amultigrid_2mg__coarse_8h_html"><div class="ttname"><a href="multigrid_2mg__coarse_8h.html">mg_coarse.h</a></div></div>
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
