<!-- HTML header for doxygen 1.8.17-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="canonical" href="https://www.dealii.org/current/doxygen/deal.II/step_33.html" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The deal.II Library: The step-33 tutorial program</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link rel="SHORTCUT ICON" href="deal.ico"></link>
<script type="text/javascript" src="custom.js"></script>
<meta name="author" content="The deal.II Authors <authors@dealii.org>"></meta>
<meta name="copyright" content="Copyright (C) 1998 - 2021 by the deal.II authors"></meta>
<meta name="deal.II-version" content="10.0.0-pre"></meta>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo200.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Reference documentation for deal.II version 10.0.0-pre</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!--Extra macros for MathJax:-->
<div style="display:none">
\(\newcommand{\dealvcentcolon}{\mathrel{\mathop{:}}}\)
\(\newcommand{\dealcoloneq}{\dealvcentcolon\mathrel{\mkern-1.2mu}=}\)
\(\newcommand{\jump}[1]{\left[\!\left[ #1 \right]\!\right]}\)
\(\newcommand{\average}[1]{\left\{\!\left\{ #1 \right\}\!\right\}}\)
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">The step-33 tutorial program </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial depends on <a class="el" href="step_12.html">step-12</a>, <a class="el" href="step_71.html">step-71</a>.</p>
<p> 
<table class="tutorial" width="50%">
<tr><th colspan="2"><b><small>Table of contents</small></b></th></tr>
<tr><td width="50%" valign="top">
<ol>
  <li> <a href="#Intro" class=bold>Introduction</a>
    <ul>
        <li><a href="#Eulerflow">Euler flow</a>
        <li><a href="#Discretization">Discretization</a>
        <li><a href="#Automaticdifferentiation"> Automatic differentiation </a>
        <li><a href="#Trilinossolvers"> Trilinos solvers </a>
        <li><a href="#Adaptivity"> Adaptivity </a>
        <li><a href="#Inputdeckinitialandboundaryconditions">Input deck, initial and boundary conditions</a>
        <li><a href="#Implementation">Implementation</a>
    </ul>
  <li> <a href="#CommProg" class=bold>The commented program</a>
    <ul>
        <li><a href="#Includefiles">Include files</a>
        <li><a href="#Eulerequationspecifics">Euler equation specifics</a>
      <ul>
        <li><a href="#Componentdescription">Component description</a>
        <li><a href="#Transformationsbetweenvariables">Transformations between variables</a>
        <li><a href="#EulerEquationscompute_flux_matrix">EulerEquations::compute_flux_matrix</a>
        <li><a href="#EulerEquationscompute_normal_flux">EulerEquations::compute_normal_flux</a>
        <li><a href="#EulerEquationscompute_forcing_vector">EulerEquations::compute_forcing_vector</a>
        <li><a href="#Dealingwithboundaryconditions">Dealing with boundary conditions</a>
        <li><a href="#EulerEquationscompute_refinement_indicators">EulerEquations::compute_refinement_indicators</a>
        <li><a href="#EulerEquationsPostprocessor">EulerEquations::Postprocessor</a>
      </ul>
        <li><a href="#Runtimeparameterhandling">Run time parameter handling</a>
      <ul>
        <li><a href="#ParametersSolver">Parameters::Solver</a>
        <li><a href="#ParametersRefinement">Parameters::Refinement</a>
        <li><a href="#ParametersFlux">Parameters::Flux</a>
        <li><a href="#ParametersOutput">Parameters::Output</a>
        <li><a href="#ParametersAllParameters">Parameters::AllParameters</a>
      </ul>
        <li><a href="#Conservationlawclass">Conservation law class</a>
      <ul>
        <li><a href="#ConservationLawConservationLaw">ConservationLaw::ConservationLaw</a>
        <li><a href="#ConservationLawsetup_system">ConservationLaw::setup_system</a>
        <li><a href="#ConservationLawassemble_system">ConservationLaw::assemble_system</a>
        <li><a href="#ConservationLawassemble_cell_term">ConservationLaw::assemble_cell_term</a>
        <li><a href="#ConservationLawassemble_face_term">ConservationLaw::assemble_face_term</a>
        <li><a href="#ConservationLawsolve">ConservationLaw::solve</a>
        <li><a href="#ConservationLawcompute_refinement_indicators">ConservationLaw::compute_refinement_indicators</a>
        <li><a href="#ConservationLawrefine_grid">ConservationLaw::refine_grid</a>
        <li><a href="#ConservationLawoutput_results">ConservationLaw::output_results</a>
        <li><a href="#ConservationLawrun">ConservationLaw::run</a>
      </ul>
        <li><a href="#main">main()</a>
      </ul>
</ol></td><td width="50%" valign="top"><ol>
  <li value="3"> <a href="#Results" class=bold>Results</a>
    <ul>
        <li><a href="#Possibilitiesforextensions">Possibilities for extensions</a>
      <ul>
        <li><a href="#Stabilization">Stabilization</a>
        <li><a href="#Betterlinearsolvers">Better linear solvers</a>
        <li><a href="#Cachetheexplicitpartofresidual">Cache the explicit part of residual</a>
        <li><a href="#Otherconservationlaws">Other conservation laws</a>
    </ul>
    </ul>
  <li> <a href="#PlainProg" class=bold>The plain program</a>
</ol> </td> </tr> </table>
 <br  />
</p>
<p><em> This program was written for fun by David Neckels (NCAR) while working at Sandia (on the Wyoming Express bus to and from Corrales each day). The main purpose was to better understand Euler flow. The code solves the basic Euler equations of gas dynamics, by using a fully implicit Newton iteration (inspired by Sandia's Aria code). The code may be configured by an input file to run different simulations on different meshes, with differing boundary conditions. <br  />
 The original code and documentation was later slightly modified by Wolfgang Bangerth to make it more modular and allow replacing the parts that are specific to the Euler equations by other hyperbolic conservation laws without too much trouble. </em></p>
<dl class="section note"><dt>Note</dt><dd>The program uses the <a href="http://trilinos.org">Trilinos</a> linear solvers (these can be found in Trilinos in the Aztec/Amesos packages) and an automatic differentiation package, Sacado, also part of Trilinos. deal.II must be configured to use Trilinos. Refer to the <a href="../../readme.html#trilinos">ReadMe</a> file for instructions how to do this.</dd>
<dd>
While this program demonstrates the use of automatic differentiation well, it does not express the state of the art in Euler equation solvers. There are much faster and more accurate method for this equation, and you should take a look at <a class="el" href="step_67.html">step-67</a> and <a class="el" href="step_69.html">step-69</a> to see how this equation can be solved more efficiently.</dd></dl>
<p><a class="anchor" id="Introduction"></a><a class="anchor" id="Intro"></a> </p><h1>Introduction</h1>
<p><a class="anchor" id="Eulerflow"></a></p><h3>Euler flow</h3>
<p>The equations that describe the movement of a compressible, inviscid gas (the so-called Euler equations of gas dynamics) are a basic system of conservation laws. In spatial dimension \(d\) they read </p><p class="formulaDsp">
\[ \partial_t \mathbf{w} + \nabla \cdot \mathbf{F}(\mathbf{w}) = \mathbf{G}(\mathbf w), \]
</p>
<p> with the solution \(\mathbf{w}=(\rho v_1,\ldots,\rho v_d,\rho, E)^{\top}\) consisting of \(\rho\) the fluid density, \({\mathbf v}=(v_1,\ldots v_d)^T\) the flow velocity (and thus \(\rho\mathbf v\) being the linear momentum density), and \(E\) the energy density of the gas. We interpret the equations above as \(\partial_t \mathbf{w}_i + \nabla \cdot \mathbf{F}_i(\mathbf{w}) = \mathbf G_i(\mathbf w)\), \(i=1,\ldots,dim+2\).</p>
<p>For the Euler equations, the flux matrix \(\mathbf F\) (or system of flux functions) is defined as (shown here for the case \(d=3\)) </p><p class="formulaDsp">
\begin{eqnarray*} \mathbf F(\mathbf w) = \left( \begin{array}{ccc} \rho v_1^2+p &amp; \rho v_2v_1 &amp; \rho v_3v_1 \\ \rho v_1v_2 &amp; \rho v_2^2+p &amp; \rho v_3v_2 \\ \rho v_1v_3 &amp; \rho v_2v_3 &amp; \rho v_3^2+p \\ \rho v_1 &amp; \rho v_2 &amp; \rho v_3 \\ (E+p) v_1 &amp; (E+p) v_2 &amp; (E+p) v_3 \end{array} \right), \end{eqnarray*}
</p>
<p> and we will choose as particular right hand side forcing only the effects of gravity, described by </p><p class="formulaDsp">
\begin{eqnarray*} \mathbf G(\mathbf w) = \left( \begin{array}{c} g_1\rho \\ g_2\rho \\ g_3\rho \\ 0 \\ \rho \mathbf g \cdot \mathbf v \end{array} \right), \end{eqnarray*}
</p>
<p> where \(\mathbf g=(g_1,g_2,g_3)^T\) denotes the gravity vector. With this, the entire system of equations reads: </p><p class="formulaDsp">
\begin{eqnarray*} \partial_t (\rho v_i) + \sum_{s=1}^d \frac{\partial(\rho v_i v_s + \delta_{is} p)}{\partial x_s} &amp;=&amp; g_i \rho, \qquad i=1,\dots,d, \\ \partial_t \rho + \sum_{s=1}^d \frac{\partial(\rho v_s)}{\partial x_s} &amp;=&amp; 0, \\ \partial_t E + \sum_{s=1}^d \frac{\partial((E+p)v_s)}{\partial x_s} &amp;=&amp; \rho \mathbf g \cdot \mathbf v. \end{eqnarray*}
</p>
<p> These equations describe, respectively, the conservation of momentum, mass, and energy. The system is closed by a relation that defines the pressure: \(p = (\gamma -1)(E-\frac{1}{2} \rho |\mathbf v|^2)\). For the constituents of air (mainly nitrogen and oxygen) and other diatomic gases, the ratio of specific heats is \(\gamma=1.4\).</p>
<p>This problem obviously falls into the class of vector-valued problems. A general overview of how to deal with these problems in deal.II can be found in the <a class="el" href="group__vector__valued.html">Handling vector valued problems</a> module.</p>
<p><a class="anchor" id="Discretization"></a></p><h3>Discretization</h3>
<p>Discretization happens in the usual way, taking into account that this is a hyperbolic problem in the same style as the simple one discussed in <a class="el" href="step_12.html">step-12</a>: We choose a finite element space \(V_h\), and integrate our conservation law against our (vector-valued) test function \(\mathbf{z} \in V_h\). We then integrate by parts and approximate the boundary flux with a <em> numerical </em> flux \(\mathbf{H}\), </p><p class="formulaDsp">
\begin{eqnarray*} &amp;&amp;\int_{\Omega} (\partial_t \mathbf{w}, \mathbf{z}) + (\nabla \cdot \mathbf{F}(\mathbf{w}), \mathbf{z}) \\ &amp;\approx &amp;\int_{\Omega} (\partial_t \mathbf{w}, \mathbf{z}) - (\mathbf{F}(\mathbf{w}), \nabla \mathbf{z}) + h^{\eta}(\nabla \mathbf{w} , \nabla \mathbf{z}) + \int_{\partial \Omega} (\mathbf{H}(\mathbf{w}^+, \mathbf{w}^-, \mathbf{n}), \mathbf{z}^+), \end{eqnarray*}
</p>
<p> where a superscript \(+\) denotes the interior trace of a function, and \(-\) represents the outer trace. The diffusion term \(h^{\eta}(\nabla \mathbf{w} , \nabla \mathbf{z})\) is introduced strictly for stability, where \(h\) is the mesh size and \(\eta\) is a parameter prescribing how much diffusion to add.</p>
<p>On the boundary, we have to say what the outer trace \(\mathbf{w}^-\) is. Depending on the boundary condition, we prescribe either of the following: </p><ul>
<li>
Inflow boundary: \(\mathbf{w}^-\) is prescribed to be the desired value. </li>
<li>
Supersonic outflow boundary: \(\mathbf{w}^- = \mathbf{w}^+\) </li>
<li>
Subsonic outflow boundary: \(\mathbf{w}^- = \mathbf{w}^+\) except that the energy variable is modified to support a prescribed pressure \(p_o\), i.e. \(\mathbf{w}^- =(\rho^+, \rho v_1^+, \dots, \rho v_d^+, p_o/(\gamma -1) + 0.5 \rho |\mathbf{v}^+|^2)\) </li>
<li>
Reflective boundary: we set \(\mathbf{w}^-\) so that \((\mathbf{v}^+ + \mathbf{v}^-) \cdot \mathbf{n} = 0\) and \(\rho^- = \rho^+,E^-=E^+\). </li>
</ul>
<p>More information on these issues can be found, for example, in Ralf Hartmann's PhD thesis ("Adaptive Finite Element Methods for the
Compressible Euler Equations", PhD thesis, University of Heidelberg, 2002).</p>
<p>We use a time stepping scheme to substitute the time derivative in the above equations. For simplicity, we define \( \mathbf{B}({\mathbf{w}_{n}})(\mathbf z) \) as the spatial residual at time step \(n\) :</p>
<p class="formulaDsp">
\begin{eqnarray*} \mathbf{B}(\mathbf{w}_{n})(\mathbf z) &amp;=&amp; - \int_{\Omega} \left(\mathbf{F}(\mathbf{w}_n), \nabla\mathbf{z}\right) + h^{\eta}(\nabla \mathbf{w}_n , \nabla \mathbf{z}) \\ &amp;&amp; + \int_{\partial \Omega} \left(\mathbf{H}(\mathbf{w}_n^+, \mathbf{w}^-(\mathbf{w}_n^+), \mathbf{n}), \mathbf{z}\right) - \int_{\Omega} \left(\mathbf{G}(\mathbf{w}_n), \mathbf{z}\right) . \end{eqnarray*}
</p>
<p>At each time step, our full discretization is thus that the residual applied to any test function \(\mathbf z\) equals zero: </p><p class="formulaDsp">
\begin{eqnarray*} R(\mathbf{W}_{n+1})(\mathbf z) &amp;=&amp; \int_{\Omega} \left(\frac{{\mathbf w}_{n+1} - \mathbf{w}_n}{\delta t}, \mathbf{z}\right)+ \theta \mathbf{B}({\mathbf{w}}_{n+1}) + (1-\theta) \mathbf{B}({\mathbf w}_{n}) \\ &amp;=&amp; 0 \end{eqnarray*}
</p>
<p> where \( \theta \in [0,1] \) and \(\mathbf{w}_i = \sum_k \mathbf{W}_i^k \mathbf{\phi}_k\). Choosing \(\theta=0\) results in the explicit (forward) Euler scheme, \(\theta=1\) in the stable implicit (backward) Euler scheme, and \(\theta=\frac 12\) in the Crank-Nicolson scheme.</p>
<p>In the implementation below, we choose the Lax-Friedrichs flux for the function \(\mathbf H\), i.e. \(\mathbf{H}(\mathbf{a},\mathbf{b},\mathbf{n}) = \frac{1}{2}(\mathbf{F}(\mathbf{a})\cdot \mathbf{n} + \mathbf{F}(\mathbf{b})\cdot \mathbf{n} + \alpha (\mathbf{a} - \mathbf{b}))\), where \(\alpha\) is either a fixed number specified in the input file, or where \(\alpha\) is a mesh dependent value. In the latter case, it is chosen as \(\frac{h}{2\delta T}\) with \(h\) the diameter of the face to which the flux is applied, and \(\delta T\) the current time step.</p>
<p>With these choices, equating the residual to zero results in a nonlinear system of equations \(R(\mathbf{W}_{n+1})=0\). We solve this nonlinear system by a Newton iteration (in the same way as explained in <a class="el" href="step_15.html">step-15</a>), i.e. by iterating </p><p class="formulaDsp">
\begin{eqnarray*} R&#39;(\mathbf{W}^k_{n+1},\delta \mathbf{W}_{n+1}^k)(\mathbf z) &amp; = &amp; - R(\mathbf{W}^{k}_{n+1})(\mathbf z) \qquad \qquad \forall \mathbf z\in V_h \\ \mathbf{W}^{k+1}_{n+1} &amp;=&amp; \mathbf{W}^k_{n+1} + \delta \mathbf{W}^k_{n+1}, \end{eqnarray*}
</p>
<p> until \(|R(\mathbf{W}^k_{n+1})|\) (the residual) is sufficiently small. By testing with the nodal basis of a finite element space instead of all \(\mathbf z\), we arrive at a linear system for \(\delta \mathbf W\): </p><p class="formulaDsp">
\begin{eqnarray*} \mathbf R&#39;(\mathbf{W}^k_{n+1})\delta \mathbf{W}^k_{n+1} &amp; = &amp; - \mathbf R(\mathbf{W}^{k}_{n+1}). \end{eqnarray*}
</p>
<p> This linear system is, in general, neither symmetric nor has any particular definiteness properties. We will either use a direct solver or Trilinos' GMRES implementation to solve it. As will become apparent from the <a href="#Results">results shown below</a>, this fully implicit iteration converges very rapidly (typically in 3 steps) and with the quadratic convergence order expected from a Newton method.</p>
<p><a class="anchor" id="Automaticdifferentiation"></a></p><h3>Automatic differentiation </h3>
<p>Since computing the Jacobian matrix \(\mathbf R&#39;(\mathbf W^k)\) is a terrible beast, we use an automatic differentiation package, Sacado, to do this. Sacado is a package within the <a href="http://trilinos.org" target="_top">Trilinos</a> framework and offers a C++ template class <code>Sacado::Fad::DFad</code> (<code>Fad</code> standing for "forward automatic
differentiation") that supports basic arithmetic operators and functions such as <code> sqrt, sin, cos, pow, </code> etc. In order to use this feature, one declares a collection of variables of this type and then denotes some of this collection as degrees of freedom, the rest of the variables being functions of the independent variables. These variables are used in an algorithm, and as the variables are used, their sensitivities with respect to the degrees of freedom are continuously updated.</p>
<p>One can imagine that for the full Jacobian matrix as a whole, this could be prohibitively expensive: the number of independent variables are the \(\mathbf W^k\), the dependent variables the elements of the vector \(\mathbf R(\mathbf W^k)\). Both of these vectors can easily have tens of thousands of elements or more. However, it is important to note that not all elements of \(\mathbf R\) depend on all elements of \(\mathbf W^k\): in fact, an entry in \(\mathbf R\) only depends on an element of \(\mathbf W^k\) if the two corresponding shape functions overlap and couple in the weak form.</p>
<p>Specifically, it is wise to define a minimum set of independent AD variables that the residual on the current cell may possibly depend on: on every element, we define those variables as independent that correspond to the degrees of freedom defined on this cell (or, if we have to compute jump terms between cells, that correspond to degrees of freedom defined on either of the two adjacent cells), and the dependent variables are the elements of the local residual vector. Not doing this, i.e. defining <em>all</em> elements of \(\mathbf W^k\) as independent, will result a very expensive computation of a lot of zeros: the elements of the local residual vector are independent of almost all elements of the solution vector, and consequently their derivatives are zero; however, trying to compute these zeros can easily take 90% or more of the compute time of the entire program, as shown in an experiment inadvertently made by a student a few years after this program was first written.</p>
<p>Coming back to the question of computing the Jacobian automatically: The author has used this approach side by side with a hand coded Jacobian for the incompressible Navier-Stokes problem and found the Sacado approach to be just as fast as using a hand coded Jacobian, but infinitely simpler and less error prone: Since using the auto-differentiation requires only that one code the residual \(R(\mathbf{W})\), ensuring code correctness and maintaining code becomes tremendously more simple &ndash; the Jacobian matrix \(\mathbf R&#39;\) is computed by essentially the same code that also computes the residual \(\mathbf R\).</p>
<p>All this said, here's a very simple example showing how Sacado can be used:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;Sacado.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using</span> fad_double = Sacado::Fad::DFad&lt;double&gt;;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>() {</div>
<div class="line"> </div>
<div class="line">  fad_double <a class="code" href="function__tools__0_8txt.html#a1a2acf608502527a80c0aeecdc12c908">a</a>,<a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a>,<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="function__tools__0_8txt.html#a1a2acf608502527a80c0aeecdc12c908">a</a> = 1; <a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a> = 2;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="function__tools__0_8txt.html#a1a2acf608502527a80c0aeecdc12c908">a</a>.diff(0,2);  <span class="comment">// Set a to be dof 0, in a 2-dof system.</span></div>
<div class="line"> </div>
<div class="line">  <a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a>.diff(1,2);  <span class="comment">// Set b to be dof 1, in a 2-dof system.</span></div>
<div class="line"> </div>
<div class="line">  <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a> = 2*<a class="code" href="function__tools__0_8txt.html#a1a2acf608502527a80c0aeecdc12c908">a</a>+<a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="function__tools__0_8txt.html#a1a2acf608502527a80c0aeecdc12c908">a</a>*<a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> *derivs = &amp;<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>.fastAccessDx(0); <span class="comment">// Access derivatives</span></div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;dc/da = &quot;</span> &lt;&lt; derivs[0] &lt;&lt; <span class="stringliteral">&quot;, dc/db=&quot;</span> &lt;&lt; derivs[1] &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --><p>The output are the derivatives \(\frac{\partial c(a,b)}{\partial a}, \frac{\partial c(a,b)}{\partial b}\) of \(c(a,b)=2a+\cos(ab)\) at \(a=1,b=2\).</p>
<p>It should be noted that Sacado provides more auto-differentiation capabilities than the small subset used in this program. However, understanding the example above is enough to understand the use of Sacado in this Euler flow program.</p>
<p><a class="anchor" id="Trilinossolvers"></a></p><h3>Trilinos solvers </h3>
<p>The program uses either the Aztec iterative solvers, or the Amesos sparse direct solver, both provided by the Trilinos package. This package is inherently designed to be used in a parallel program, however, it may be used in serial just as easily, as is done here. The Epetra package is the basic vector/matrix library upon which the solvers are built. This very powerful package can be used to describe the parallel distribution of a vector, and to define sparse matrices that operate on these vectors. Please view the commented code for more details on how these solvers are used within the example.</p>
<p><a class="anchor" id="Adaptivity"></a></p><h3>Adaptivity </h3>
<p>The example uses an ad hoc refinement indicator that shows some usefulness in shock-type problems, and in the downhill flow example included. We refine according to the squared gradient of the density. Hanging nodes are handled by computing the numerical flux across cells that are of differing refinement levels, rather than using the <a class="el" href="classAffineConstraints.html">AffineConstraints</a> class as in all other tutorial programs so far. In this way, the example combines the continuous and DG methodologies. It also simplifies the generation of the Jacobian because we do not have to track constrained degrees of freedom through the automatic differentiation used to compute it.</p>
<dl class="section note"><dt>Note</dt><dd>Whereas this program was written in 2008, we were unaware of any publication that would actually have used this approach. However, a more recent paper by A. Dedner, R. Kl&ouml;fkorn, and M. Kr&auml;nkel ("Continuous Finite-Elements on Non-Conforming Grids Using
Discontinuous Galerkin Stabilization", Proceedings of Finite Volumes for Complex Applications VII - Methods and Theoretical Aspects, Springer, 2014) comes close.</dd></dl>
<p>Further, we enforce a maximum number of refinement levels to keep refinement under check. It is the author's experience that for adaptivity for a time dependent problem, refinement can easily lead the simulation to a screeching halt, because of time step restrictions if the mesh becomes too fine in any part of the domain, if care is not taken. The amount of refinement is limited in the example by letting the user specify the maximum level of refinement that will be present anywhere in the mesh. In this way, refinement tends not to slow the simulation to a halt. This, of course, is purely a heuristic strategy, and if the author's advisor heard about it, the author would likely be exiled forever from the finite element error estimation community.</p>
<p><a class="anchor" id="Inputdeckinitialandboundaryconditions"></a></p><h3>Input deck, initial and boundary conditions</h3>
<p>We use an input file deck to drive the simulation. In this way, we can alter the boundary conditions and other important properties of the simulation without having to recompile. For more information on the format, look at the <a href="#Results">results section</a>, where we describe an example input file in more detail.</p>
<p>In previous example programs, we have usually hard-coded the initial and boundary conditions. In this program, we instead use the expression parser class <a class="el" href="classFunctionParser.html">FunctionParser</a> so that we can specify a generic expression in the input file and have it parsed at run time &mdash; this way, we can change initial conditions without the need to recompile the program. Consequently, no classes named InitialConditions or BoundaryConditions will be declared in the program below.</p>
<p><a class="anchor" id="Implementation"></a></p><h3>Implementation</h3>
<p>The implementation of this program is split into three essential parts: </p><ul>
<li>
<p class="startli">The <code>EulerEquations</code> class that encapsulates everything that completely describes the specifics of the Euler equations. This includes the flux matrix \(\mathbf F(\mathbf W)\), the numerical flux \(\mathbf F(\mathbf W^+,\mathbf W^-,\mathbf n)\), the right hand side \(\mathbf G(\mathbf W)\), boundary conditions, refinement indicators, postprocessing the output, and similar things that require knowledge of the meaning of the individual components of the solution vectors and the equations.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">A namespace that deals with everything that has to do with run-time parameters.</p>
<p class="endli"></p>
</li>
<li>
The <code>ConservationLaw</code> class that deals with time stepping, outer nonlinear and inner linear solves, assembling the linear systems, and the top-level logic that drives all this. </li>
</ul>
<p>The reason for this approach is that it separates the various concerns in a program: the <code>ConservationLaw</code> is written in such a way that it would be relatively straightforward to adapt it to a different set of equations: One would simply re-implement the members of the <code>EulerEquations</code> class for some other hyperbolic equation, or augment the existing equations by additional ones (for example by advecting additional variables, or by adding chemistry, etc). Such modifications, however, would not affect the time stepping, or the nonlinear solvers if correctly done, and consequently nothing in the <code>ConservationLaw</code> would have to be modified.</p>
<p>Similarly, if we wanted to improve on the linear or nonlinear solvers, or on the time stepping scheme (as hinted at the end of the <a href="#Results">results section</a>), then this would not require changes in the <code>EulerEquations</code> at all.</p>
<p><a class="anchor" id="CommProg"></a> </p><h1>The commented program</h1>
<p><a class="anchor" id="Includefiles"></a> </p><h3>Include files</h3>
<p>First a standard set of deal.II includes. Nothing special to comment on here:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2parameter__handler_8h.html">deal.II/base/parameter_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2function__parser_8h.html">deal.II/base/function_parser.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="include_2deal_8II_2base_2utilities_8h.html">deal.II/base/utilities.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2conditional__ostream_8h.html">deal.II/base/conditional_ostream.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2vector_8h.html">deal.II/lac/vector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__out_8h.html">deal.II/grid/grid_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__refinement_8h.html">deal.II/grid/grid_refinement.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__in_8h.html">deal.II/grid/grid_in.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__values_8h.html">deal.II/fe/fe_values.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__system_8h.html">deal.II/fe/fe_system.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2mapping__q1_8h.html">deal.II/fe/mapping_q1.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2solution__transfer_8h.html">deal.II/numerics/solution_transfer.h</a>&gt;</span></div>
</div><!-- fragment --><p>Then, as mentioned in the introduction, we use various Trilinos packages as linear solvers as well as for automatic differentiation. These are in the following include files.</p>
<p>Since deal.II provides interfaces to the basic Trilinos matrices, preconditioners and solvers, we include them similarly as deal.II linear algebra structures.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2trilinos__sparse__matrix_8h.html">deal.II/lac/trilinos_sparse_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2trilinos__precondition_8h.html">deal.II/lac/trilinos_precondition.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2trilinos__solver_8h.html">deal.II/lac/trilinos_solver.h</a>&gt;</span></div>
</div><!-- fragment --><p>Sacado is the automatic differentiation package within Trilinos, which is used to find the Jacobian for a fully implicit Newton iteration:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;Sacado.hpp&gt;</span></div>
</div><!-- fragment --><p>And this again is C++:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;array&gt;</span></div>
</div><!-- fragment --><p>To end this section, introduce everything in the dealii library into the namespace into which the contents of this program will go:</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceStep33.html">Step33</a></div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
</div><!-- fragment --><p><a class="anchor" id="Eulerequationspecifics"></a> </p><h3>Euler equation specifics</h3>
<p>Here we define the flux function for this particular system of conservation laws, as well as pretty much everything else that's specific to the Euler equations for gas dynamics, for reasons discussed in the introduction. We group all this into a structure that defines everything that has to do with the flux. All members of this structure are static, i.e. the structure has no actual state specified by instance member variables. The better way to do this, rather than a structure with all static members would be to use a namespace &ndash; but namespaces can't be templatized and we want some of the member variables of the structure to depend on the space dimension, which we in our usual way introduce using a template parameter.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">struct </span>EulerEquations</div>
<div class="line">{</div>
</div><!-- fragment --><p><a class="anchor" id="Componentdescription"></a> </p><h4>Component description</h4>
<p>First a few variables that describe the various components of our solution vector in a generic way. This includes the number of components in the system (Euler's equations have one entry for momenta in each spatial direction, plus the energy and density components, for a total of <code>dim+2</code> components), as well as functions that describe the index within the solution vector of the first momentum component, the density component, and the energy density component. Note that all these numbers depend on the space dimension; defining them in a generic way (rather than by implicit convention) makes our code more flexible and makes it easier to later extend it, for example by adding more components to the equations.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>             = <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> + 2;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> first_momentum_component = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> density_component        = <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> energy_component         = <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> + 1;</div>
</div><!-- fragment --><p>When generating graphical output way down in this program, we need to specify the names of the solution variables as well as how the various components group into vector and scalar fields. We could describe this there, but in order to keep things that have to do with the Euler equation localized here and the rest of the program as generic as possible, we provide this sort of information in the following two functions:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> std::vector&lt;std::string&gt; component_names()</div>
<div class="line">{</div>
<div class="line">  std::vector&lt;std::string&gt; <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>(<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>, <span class="stringliteral">&quot;momentum&quot;</span>);</div>
<div class="line">  <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>.emplace_back(<span class="stringliteral">&quot;density&quot;</span>);</div>
<div class="line">  <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>.emplace_back(<span class="stringliteral">&quot;energy_density&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">component_interpretation()</div>
<div class="line">{</div>
<div class="line">  std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">    data_component_interpretation(</div>
<div class="line">      <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>, <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a9b7d9c85221484e1998f6869d98cba8b">DataComponentInterpretation::component_is_part_of_vector</a>);</div>
<div class="line">  data_component_interpretation.push_back(</div>
<div class="line">    <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa4924d31df0211f3fb9db3bbe1af0d1c">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line">  data_component_interpretation.push_back(</div>
<div class="line">    <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa4924d31df0211f3fb9db3bbe1af0d1c">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> data_component_interpretation;</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Transformationsbetweenvariables"></a> </p><h4>Transformations between variables</h4>
<p>Next, we define the gas constant. We will set it to 1.4 in its definition immediately following the declaration of this class (unlike integer variables, like the ones above, static const floating point member variables cannot be initialized within the class declaration in C++). This value of 1.4 is representative of a gas that consists of molecules composed of two atoms, such as air which consists up to small traces almost entirely of \(N_2\) and \(O_2\).</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> gas_gamma;</div>
</div><!-- fragment --><p>In the following, we will need to compute the kinetic energy and the pressure from a vector of conserved variables. This we can do based on the energy density and the kinetic energy \(\frac 12 \rho |\mathbf v|^2 = \frac{|\rho \mathbf v|^2}{2\rho}\) (note that the independent variables contain the momentum components \(\rho v_i\), not the velocities \(v_i\)).</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">typename</span> InputVector::value_type</div>
<div class="line">compute_kinetic_energy(<span class="keyword">const</span> InputVector &amp;W)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">typename</span> InputVector::value_type kinetic_energy = 0;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">    kinetic_energy +=</div>
<div class="line">      W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] * W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line">  kinetic_energy *= 1. / (2 * W[density_component]);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> kinetic_energy;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">typename</span> InputVector::value_type</div>
<div class="line">compute_pressure(<span class="keyword">const</span> InputVector &amp;W)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> ((gas_gamma - 1.0) *</div>
<div class="line">          (W[energy_component] - compute_kinetic_energy(W)));</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="EulerEquationscompute_flux_matrix"></a> </p><h4>EulerEquations::compute_flux_matrix</h4>
<p>We define the flux function \(F(W)\) as one large matrix. Each row of this matrix represents a scalar conservation law for the component in that row. The exact form of this matrix is given in the introduction. Note that we know the size of the matrix: it has as many rows as the system has components, and <code>dim</code> columns; rather than using a <a class="el" href="classFullMatrix.html">FullMatrix</a> object for such a matrix (which has a variable number of rows and columns and must therefore allocate memory on the heap each time such a matrix is created), we use a rectangular array of numbers right away.</p>
<p>We templatize the numerical type of the flux function so that we may use the automatic differentiation type here. Similarly, we will call the function with different input vector data types, so we templatize on it as well:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> compute_flux_matrix(<span class="keyword">const</span> InputVector &amp;W,</div>
<div class="line">                                <a class="code" href="base_2ndarray_8h.html#a82399009710c9549884b9d8c506ad695">ndarray</a>&lt;<span class="keyword">typename</span> InputVector::value_type,</div>
<div class="line">                                        <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>,</div>
<div class="line">                                        <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt; &amp;     <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>)</div>
<div class="line">{</div>
</div><!-- fragment --><p>First compute the pressure that appears in the flux matrix, and then compute the first <code>dim</code> columns of the matrix that correspond to the momentum terms:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keyword">typename</span> InputVector::value_type <a class="code" href="mg__transfer__0_8txt.html#a6b401cd9c6154fc787311f58ab910002">pressure</a> = compute_pressure(W);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a> = 0; <a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>)</div>
<div class="line">      <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>][<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>] =</div>
<div class="line">        W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] *</div>
<div class="line">        W[first_momentum_component + <a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>] / W[density_component];</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] += <a class="code" href="mg__transfer__0_8txt.html#a6b401cd9c6154fc787311f58ab910002">pressure</a>;</div>
<div class="line">  }</div>
</div><!-- fragment --><p>Then the terms for the density (i.e. mass conservation), and, lastly, conservation of energy:</p>
<div class="fragment"><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">    <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>[density_component][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] = W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">    <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>[energy_component][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] = W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] /</div>
<div class="line">                                W[density_component] *</div>
<div class="line">                                (W[energy_component] + <a class="code" href="mg__transfer__0_8txt.html#a6b401cd9c6154fc787311f58ab910002">pressure</a>);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="EulerEquationscompute_normal_flux"></a> </p><h4>EulerEquations::compute_normal_flux</h4>
<p>On the boundaries of the domain and across hanging nodes we use a numerical flux function to enforce boundary conditions. This routine is the basic Lax-Friedrich's flux with a stabilization parameter \(\alpha\). It's form has also been given already in the introduction:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> numerical_normal_flux(</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> &amp;                                      <a class="code" href="global__dof__index__0_8txt.html#a2b84b1d42e4fde15bdf79726ce1cc907">normal</a>,</div>
<div class="line">  <span class="keyword">const</span> InputVector &amp;                                         Wplus,</div>
<div class="line">  <span class="keyword">const</span> InputVector &amp;                                         Wminus,</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span>                                                <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>,</div>
<div class="line">  std::array&lt;typename InputVector::value_type, n_components&gt; &amp;normal_flux)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="base_2ndarray_8h.html#a82399009710c9549884b9d8c506ad695">ndarray</a>&lt;<span class="keyword">typename</span> InputVector::value_type,</div>
<div class="line">          <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>,</div>
<div class="line">          <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;</div>
<div class="line">    iflux, oflux;</div>
<div class="line"> </div>
<div class="line">  compute_flux_matrix(Wplus, iflux);</div>
<div class="line">  compute_flux_matrix(Wminus, oflux);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; di &lt; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>; ++di)</div>
<div class="line">    {</div>
<div class="line">      normal_flux[di] = 0;</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">        normal_flux[di] += 0.5 * (iflux[di][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] + oflux[di][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>]) * <a class="code" href="global__dof__index__0_8txt.html#a2b84b1d42e4fde15bdf79726ce1cc907">normal</a>[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line"> </div>
<div class="line">      normal_flux[di] += 0.5 * <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a> * (Wplus[di] - Wminus[di]);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="EulerEquationscompute_forcing_vector"></a> </p><h4>EulerEquations::compute_forcing_vector</h4>
<p>In the same way as describing the flux function \(\mathbf F(\mathbf w)\), we also need to have a way to describe the right hand side forcing term. As mentioned in the introduction, we consider only gravity here, which leads to the specific form \(\mathbf G(\mathbf w) = \left( g_1\rho, g_2\rho, g_3\rho, 0, \rho \mathbf g \cdot \mathbf v \right)^T\), shown here for the 3d case. More specifically, we will consider only \(\mathbf g=(0,0,-1)^T\) in 3d, or \(\mathbf g=(0,-1)^T\) in 2d. This naturally leads to the following function:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> compute_forcing_vector(</div>
<div class="line">  <span class="keyword">const</span> InputVector &amp;                                         W,</div>
<div class="line">  std::array&lt;typename InputVector::value_type, n_components&gt; &amp;forcing)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> gravity = -1.0;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a> = 0; <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a> &lt; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>; ++<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>)</div>
<div class="line">    <span class="keywordflow">switch</span> (<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">case</span> first_momentum_component + <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> - 1:</div>
<div class="line">          forcing[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = gravity * W[density_component];</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> energy_component:</div>
<div class="line">          forcing[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = gravity * W[first_momentum_component + <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> - 1];</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">          forcing[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = 0;</div>
<div class="line">      }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Dealingwithboundaryconditions"></a> </p><h4>Dealing with boundary conditions</h4>
<p>Another thing we have to deal with is boundary conditions. To this end, let us first define the kinds of boundary conditions we currently know how to deal with:</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> BoundaryKind</div>
<div class="line">{</div>
<div class="line">  inflow_boundary,</div>
<div class="line">  outflow_boundary,</div>
<div class="line">  no_penetration_boundary,</div>
<div class="line">  pressure_boundary</div>
<div class="line">};</div>
</div><!-- fragment --><p>The next part is to actually decide what to do at each kind of boundary. To this end, remember from the introduction that boundary conditions are specified by choosing a value \(\mathbf w^-\) on the outside of a boundary given an inhomogeneity \(\mathbf j\) and possibly the solution's value \(\mathbf w^+\) on the inside. Both are then passed to the numerical flux \(\mathbf H(\mathbf{w}^+, \mathbf{w}^-, \mathbf{n})\) to define boundary contributions to the bilinear form.</p>
<p>Boundary conditions can in some cases be specified for each component of the solution vector independently. For example, if component \(c\) is marked for inflow, then \(w^-_c = j_c\). If it is an outflow, then \(w^-_c = w^+_c\). These two simple cases are handled first in the function below.</p>
<p>There is a little snag that makes this function unpleasant from a C++ language viewpoint: The output vector <code>Wminus</code> will of course be modified, so it shouldn't be a <code>const</code> argument. Yet it is in the implementation below, and needs to be in order to allow the code to compile. The reason is that we call this function at a place where <code>Wminus</code> is of type <code><a class="el" href="classTable.html">Table</a>&lt;2,Sacado::Fad::DFad&lt;double&gt; &gt;</code>, this being 2d table with indices representing the quadrature point and the vector component, respectively. We call this function with <code>Wminus[q]</code> as last argument; subscripting a 2d table yields a temporary accessor object representing a 1d vector, just what we want here. The problem is that a temporary accessor object can't be bound to a non-const reference argument of a function, as we would like here, according to the C++ 1998 and 2003 standards (something that will be fixed with the next standard in the form of rvalue references). We get away with making the output argument here a constant because it is the <em>accessor</em> object that's constant, not the table it points to: that one can still be written to. The hack is unpleasant nevertheless because it restricts the kind of data types that may be used as template argument to this function: a regular vector isn't going to do because that one can not be written to when marked <code>const</code>. With no good solution around at the moment, we'll go with the pragmatic, even if not pretty, solution shown here:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataVector&gt;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">compute_Wminus(<span class="keyword">const</span> std::array&lt;BoundaryKind, n_components&gt; &amp;boundary_kind,</div>
<div class="line">               <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> &amp;                        normal_vector,</div>
<div class="line">               <span class="keyword">const</span> DataVector &amp;                            Wplus,</div>
<div class="line">               <span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;boundary_values,</div>
<div class="line">               <span class="keyword">const</span> DataVector &amp;    Wminus)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a> = 0; <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a> &lt; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>; <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>++)</div>
<div class="line">    <span class="keywordflow">switch</span> (boundary_kind[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>])</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">case</span> inflow_boundary:</div>
<div class="line">          {</div>
<div class="line">            Wminus[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = boundary_values(<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> outflow_boundary:</div>
<div class="line">          {</div>
<div class="line">            Wminus[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = Wplus[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>];</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">          }</div>
</div><!-- fragment --><p>Prescribed pressure boundary conditions are a bit more complicated by the fact that even though the pressure is prescribed, we really are setting the energy component here, which will depend on velocity and pressure. So even though this seems like a Dirichlet type boundary condition, we get sensitivities of energy to velocity and density (unless these are also prescribed):</p>
<div class="fragment"><div class="line"><span class="keywordflow">case</span> pressure_boundary:</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">typename</span> DataVector::value_type <a class="code" href="namespaceStep31_1_1EquationData.html#aa1e9e1a7297b10cb39c2065f86acc66f">density</a> =</div>
<div class="line">      (boundary_kind[density_component] == inflow_boundary ?</div>
<div class="line">         boundary_values(density_component) :</div>
<div class="line">         Wplus[density_component]);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">typename</span> DataVector::value_type kinetic_energy = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">      <span class="keywordflow">if</span> (boundary_kind[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] == inflow_boundary)</div>
<div class="line">        kinetic_energy += boundary_values(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>) * boundary_values(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>);</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        kinetic_energy += Wplus[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] * Wplus[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line">    kinetic_energy *= 1. / 2. / <a class="code" href="namespaceStep31_1_1EquationData.html#aa1e9e1a7297b10cb39c2065f86acc66f">density</a>;</div>
<div class="line"> </div>
<div class="line">    Wminus[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] =</div>
<div class="line">      boundary_values(<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>) / (gas_gamma - 1.0) + kinetic_energy;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">case</span> no_penetration_boundary:</div>
<div class="line">  {</div>
</div><!-- fragment --><p>We prescribe the velocity (we are dealing with a particular component here so that the average of the velocities is orthogonal to the surface normal. This creates sensitivities of across the velocity components.</p>
<div class="fragment"><div class="line">            <span class="keyword">typename</span> DataVector::value_type vdotn = 0;</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>++)</div>
<div class="line">              {</div>
<div class="line">                vdotn += Wplus[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] * normal_vector[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            Wminus[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = Wplus[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] - 2.0 * vdotn * normal_vector[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>];</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">      }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="EulerEquationscompute_refinement_indicators"></a> </p><h4>EulerEquations::compute_refinement_indicators</h4>
<p>In this class, we also want to specify how to refine the mesh. The class <code>ConservationLaw</code> that will use all the information we provide here in the <code>EulerEquation</code> class is pretty agnostic about the particular conservation law it solves: as doesn't even really care how many components a solution vector has. Consequently, it can't know what a reasonable refinement indicator would be. On the other hand, here we do, or at least we can come up with a reasonable choice: we simply look at the gradient of the density, and compute \(\eta_K=\log\left(1+|\nabla\rho(x_K)|\right)\), where \(x_K\) is the center of cell \(K\).</p>
<p>There are certainly a number of equally reasonable refinement indicators, but this one does, and it is easy to compute:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">compute_refinement_indicators(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div>
<div class="line">                              <span class="keyword">const</span> <a class="code" href="classMapping.html">Mapping&lt;dim&gt;</a> &amp;   <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                              <span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp; <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>,</div>
<div class="line">                              <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;       refinement_indicators)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> = dof_handler.<a class="code" href="classDoFHandler.html#ac1fedeb50b5f03b13d8b69f86e33f726">get_fe</a>().<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>();</div>
<div class="line">  std::vector&lt;unsigned int&gt; <a class="code" href="distributed__0_8txt.html#ad207fe81a5be05e18534713c2677da7b">dofs</a>(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classQMidpoint.html">QMidpoint&lt;dim&gt;</a> quadrature_formula;</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>    update_flags = <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a>;</div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>        fe_v(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                     dof_handler.<a class="code" href="classDoFHandler.html#ac1fedeb50b5f03b13d8b69f86e33f726">get_fe</a>(),</div>
<div class="line">                     quadrature_formula,</div>
<div class="line">                     update_flags);</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;std::vector&lt;Tensor&lt;1, dim&gt;&gt;&gt; dU(</div>
<div class="line">    1, <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a>&gt;(<a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>));</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell_no = <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;active_cell_index();</div>
<div class="line">      fe_v.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line">      fe_v.<a class="code" href="classFEValuesBase.html#ad1f4e0deb5d982e8172d82141c634a67">get_function_gradients</a>(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, dU);</div>
<div class="line"> </div>
<div class="line">      refinement_indicators(cell_no) = <a class="code" href="base_2vectorization_8h.html#a2aa674852f105b0ed1b35f569c19fea6">std::log</a>(</div>
<div class="line">        1 + <a class="code" href="solver__cg__0_8txt.html#a557c71e94a2542d697ca3426b8843cd4">std::sqrt</a>(dU[0][density_component] * dU[0][density_component]));</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="EulerEquationsPostprocessor"></a> </p><h4>EulerEquations::Postprocessor</h4>
<p>Finally, we declare a class that implements a postprocessing of data components. The problem this class solves is that the variables in the formulation of the Euler equations we use are in conservative rather than physical form: they are momentum densities \(\mathbf m=\rho\mathbf v\), density \(\rho\), and energy density \(E\). What we would like to also put into our output file are velocities \(\mathbf v=\frac{\mathbf m}{\rho}\) and pressure \(p=(\gamma-1)(E-\frac{1}{2} \rho |\mathbf v|^2)\).</p>
<p>In addition, we would like to add the possibility to generate schlieren plots. Schlieren plots are a way to visualize shocks and other sharp interfaces. The word "schlieren" is a German word that may be translated as "striae" &ndash; it may be simpler to explain it by an example, however: schlieren is what you see when you, for example, pour highly concentrated alcohol, or a transparent saline solution, into water; the two have the same color, but they have different refractive indices and so before they are fully mixed light goes through the mixture along bent rays that lead to brightness variations if you look at it. That's "schlieren". A similar effect happens in compressible flow because the refractive index depends on the pressure (and therefore the density) of the gas.</p>
<p>The origin of the word refers to two-dimensional projections of a three-dimensional volume (we see a 2d picture of the 3d fluid). In computational fluid dynamics, we can get an idea of this effect by considering what causes it: density variations. Schlieren plots are therefore produced by plotting \(s=|\nabla \rho|^2\); obviously, \(s\) is large in shocks and at other highly dynamic places. If so desired by the user (by specifying this in the input file), we would like to generate these schlieren plots in addition to the other derived quantities listed above.</p>
<p>The implementation of the algorithms to compute derived quantities from the ones that solve our problem, and to output them into data file, rests on the <a class="el" href="classDataPostprocessor.html">DataPostprocessor</a> class. It has extensive documentation, and other uses of the class can also be found in <a class="el" href="step_29.html">step-29</a>. We therefore refrain from extensive comments.</p>
<div class="fragment"><div class="line">  <span class="keyword">class </span>Postprocessor : <span class="keyword">public</span> <a class="code" href="classDataPostprocessor.html">DataPostprocessor</a>&lt;dim&gt;</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    Postprocessor(<span class="keyword">const</span> <span class="keywordtype">bool</span> do_schlieren_plot);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classDataPostprocessor.html#a1ba57b598d24d64365d469a854271c68">evaluate_vector_field</a>(</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="structDataPostprocessorInputs_1_1Vector.html">DataPostprocessorInputs::Vector&lt;dim&gt;</a> &amp;inputs,</div>
<div class="line">      <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt; &amp;computed_quantities) <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> std::vector&lt;std::string&gt; <a class="code" href="classDataPostprocessor.html#a254f38bcdf4bdb5aa94231b695da7d55">get_names</a>() <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;</div>
<div class="line">      <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0">DataComponentInterpretation::DataComponentInterpretation</a>&gt;</div>
<div class="line">    <a class="code" href="classDataPostprocessor.html#ae994223acf8a16471ab5e579a4d75053">get_data_component_interpretation</a>() <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> <a class="code" href="classDataPostprocessor.html#aadecdd040447b395164397ea1196f721">get_needed_update_flags</a>() <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> do_schlieren_plot;</div>
<div class="line">  };</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> EulerEquations&lt;dim&gt;::gas_gamma = 1.4;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">EulerEquations&lt;dim&gt;::Postprocessor::Postprocessor(</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">bool</span> do_schlieren_plot)</div>
<div class="line">  : do_schlieren_plot(do_schlieren_plot)</div>
<div class="line">{}</div>
</div><!-- fragment --><p>This is the only function worth commenting on. When generating graphical output, the <a class="el" href="classDataOut.html">DataOut</a> and related classes will call this function on each cell, with access to values, gradients, Hessians, and normal vectors (in case we're working on faces) at each quadrature point. Note that the data at each quadrature point is itself vector-valued, namely the conserved variables. What we're going to do here is to compute the quantities we're interested in at each quadrature point. Note that for this we can ignore the Hessians ("inputs.solution_hessians") and normal vectors ("inputs.normals").</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> EulerEquations&lt;dim&gt;::Postprocessor::evaluate_vector_field(</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="structDataPostprocessorInputs_1_1Vector.html">DataPostprocessorInputs::Vector&lt;dim&gt;</a> &amp;inputs,</div>
<div class="line">  <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt; &amp;               computed_quantities)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
</div><!-- fragment --><p>At the beginning of the function, let us make sure that all variables have the correct sizes, so that we can access individual vector elements without having to wonder whether we might read or write invalid elements; we also check that the <code>solution_gradients</code> vector only contains data if we really need it (the system knows about this because we say so in the <code><a class="el" href="data__postprocessor__0_8txt.html#abfdf708e97518fa7ad2b849b80afddc1">get_needed_update_flags()</a></code> function below). For the inner vectors, we check that at least the first element of the outer vector has the correct inner size:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_quadrature_points = inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a904b46a59d224ec214e4816e584cba5f">solution_values</a>.size();</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a2a918d936d56f2be4cdad1b8074c3a86">solution_gradients</a>.size() == n_quadrature_points,</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(computed_quantities.size() == n_quadrature_points,</div>
<div class="line">       <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a904b46a59d224ec214e4816e584cba5f">solution_values</a>[0].size() == <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>,</div>
<div class="line">       <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(computed_quantities[0].<a class="code" href="function__0_8txt.html#a4f780342f2d5d632f82cf7fd90158a66">size</a>() == <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> + 2, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">  }</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(computed_quantities[0].<a class="code" href="function__0_8txt.html#a4f780342f2d5d632f82cf7fd90158a66">size</a>() == <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> + 1, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">  }</div>
</div><!-- fragment --><p>Then loop over all quadrature points and do our work there. The code should be pretty self-explanatory. The order of output variables is first <code>dim</code> velocities, then the pressure, and if so desired the schlieren plot. Note that we try to be generic about the order of variables in the input vector, using the <code>first_momentum_component</code> and <code>density_component</code> information:</p>
<div class="fragment"><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_quadrature_points; ++q)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespaceStep31_1_1EquationData.html#aa1e9e1a7297b10cb39c2065f86acc66f">density</a> = inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a904b46a59d224ec214e4816e584cba5f">solution_values</a>[q](density_component);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">        computed_quantities[q](<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>) =</div>
<div class="line">          inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a904b46a59d224ec214e4816e584cba5f">solution_values</a>[q](first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>) / <a class="code" href="namespaceStep31_1_1EquationData.html#aa1e9e1a7297b10cb39c2065f86acc66f">density</a>;</div>
<div class="line"> </div>
<div class="line">      computed_quantities[q](<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>) =</div>
<div class="line">        compute_pressure(inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a904b46a59d224ec214e4816e584cba5f">solution_values</a>[q]);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">        computed_quantities[q](<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> + 1) =</div>
<div class="line">          inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a2a918d936d56f2be4cdad1b8074c3a86">solution_gradients</a>[q][density_component] *</div>
<div class="line">          inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a2a918d936d56f2be4cdad1b8074c3a86">solution_gradients</a>[q][density_component];</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">std::vector&lt;std::string&gt; <a class="code" href="data__postprocessor__0_8txt.html#afb21caeba7bf26aba89ce705266fedb1">EulerEquations&lt;dim&gt;::Postprocessor::get_names</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  std::vector&lt;std::string&gt; <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">    <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>.emplace_back(<span class="stringliteral">&quot;velocity&quot;</span>);</div>
<div class="line">  <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>.emplace_back(<span class="stringliteral">&quot;pressure&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">    <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>.emplace_back(<span class="stringliteral">&quot;schlieren_plot&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">EulerEquations&lt;dim&gt;::Postprocessor::get_data_component_interpretation()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">    interpretation(<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>,</div>
<div class="line">                   <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a9b7d9c85221484e1998f6869d98cba8b">DataComponentInterpretation::component_is_part_of_vector</a>);</div>
<div class="line"> </div>
<div class="line">  interpretation.push_back(<a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa4924d31df0211f3fb9db3bbe1af0d1c">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">    interpretation.push_back(</div>
<div class="line">      <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa4924d31df0211f3fb9db3bbe1af0d1c">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> interpretation;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a></div>
<div class="line"><a class="code" href="data__postprocessor__0_8txt.html#abfdf708e97518fa7ad2b849b80afddc1">EulerEquations&lt;dim&gt;::Postprocessor::get_needed_update_flags</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a>;</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Runtimeparameterhandling"></a> </p><h3>Run time parameter handling</h3>
<p>Our next job is to define a few classes that will contain run-time parameters (for example solver tolerances, number of iterations, stabilization parameter, and the like). One could do this in the main class, but we separate it from that one to make the program more modular and easier to read: Everything that has to do with run-time parameters will be in the following namespace, whereas the program logic is in the main class.</p>
<p>We will split the run-time parameters into a few separate structures, which we will all put into a namespace <code>Parameters</code>. Of these classes, there are a few that group the parameters for individual groups, such as for solvers, mesh refinement, or output. Each of these classes have functions <code><a class="el" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters()</a></code> and <code>parse_parameters()</code> that declare parameter subsections and entries in a <a class="el" href="classParameterHandler.html">ParameterHandler</a> object, and retrieve actual parameter values from such an object, respectively. These classes declare all their parameters in subsections of the <a class="el" href="classParameterHandler.html">ParameterHandler</a>.</p>
<p>The final class of the following namespace combines all the previous classes by deriving from them and taking care of a few more entries at the top level of the input file, as well as a few odd other entries in subsections that are too short to warrant a structure by themselves.</p>
<p>It is worth pointing out one thing here: None of the classes below have a constructor that would initialize the various member variables. This isn't a problem, however, since we will read all variables declared in these classes from the input file (or indirectly: a <a class="el" href="classParameterHandler.html">ParameterHandler</a> object will read it from there, and we will get the values from this object), and they will be initialized this way. In case a certain variable is not specified at all in the input file, this isn't a problem either: The <a class="el" href="classParameterHandler.html">ParameterHandler</a> class will in this case simply take the default value that was specified when declaring an entry in the <code><a class="el" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters()</a></code> functions of the classes below.</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>Parameters</div>
<div class="line">{</div>
</div><!-- fragment --><p><a class="anchor" id="ParametersSolver"></a> </p><h4>Parameters::Solver</h4>
<p>The first of these classes deals with parameters for the linear inner solver. It offers parameters that indicate which solver to use (GMRES as a solver for general non-symmetric indefinite systems, or a sparse direct solver), the amount of output to be produced, as well as various parameters that tweak the thresholded incomplete LU decomposition (ILUT) that we use as a preconditioner for GMRES.</p>
<p>In particular, the ILUT takes the following parameters:</p><ul>
<li>ilut_fill: the number of extra entries to add when forming the ILU decomposition</li>
<li>ilut_atol, ilut_rtol: When forming the preconditioner, for certain problems bad conditioning (or just bad luck) can cause the preconditioner to be very poorly conditioned. Hence it can help to add diagonal perturbations to the original matrix and form the preconditioner for this slightly better matrix. ATOL is an absolute perturbation that is added to the diagonal before forming the prec, and RTOL is a scaling factor \(rtol \geq 1\).</li>
<li>ilut_drop: The ILUT will drop any values that have magnitude less than this value. This is a way to manage the amount of memory used by this preconditioner.</li>
</ul>
<p>The meaning of each parameter is also briefly described in the third argument of the <a class="el" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">ParameterHandler::declare_entry</a> call in <code><a class="el" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters()</a></code>.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Solver</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">enum</span> <a class="code" href="namespaceStep56.html#a3c2f04c8033af75ffedd7bfbf96640a1">SolverType</a></div>
<div class="line">  {</div>
<div class="line">    gmres,</div>
<div class="line">    direct</div>
<div class="line">  };</div>
<div class="line">  <a class="code" href="namespaceStep56.html#a3c2f04c8033af75ffedd7bfbf96640a1">SolverType</a> <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">enum</span> OutputType</div>
<div class="line">  {</div>
<div class="line">    quiet,</div>
<div class="line">    verbose</div>
<div class="line">  };</div>
<div class="line">  OutputType <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> linear_residual;</div>
<div class="line">  <span class="keywordtype">int</span>    max_iterations;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> ilut_fill;</div>
<div class="line">  <span class="keywordtype">double</span> ilut_atol;</div>
<div class="line">  <span class="keywordtype">double</span> ilut_rtol;</div>
<div class="line">  <span class="keywordtype">double</span> ilut_drop;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">  <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Solver::declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;linear solver&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(</div>
<div class="line">      <span class="stringliteral">&quot;output&quot;</span>,</div>
<div class="line">      <span class="stringliteral">&quot;quiet&quot;</span>,</div>
<div class="line">      <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;quiet|verbose&quot;</span>),</div>
<div class="line">      <span class="stringliteral">&quot;State whether output from solver runs should be printed. &quot;</span></div>
<div class="line">      <span class="stringliteral">&quot;Choices are &lt;quiet|verbose&gt;.&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;method&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;gmres&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;gmres|direct&quot;</span>),</div>
<div class="line">                      <span class="stringliteral">&quot;The kind of solver for the linear system. &quot;</span></div>
<div class="line">                      <span class="stringliteral">&quot;Choices are &lt;gmres|direct&gt;.&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;residual&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1e-10&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Linear solver residual&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;max iters&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;300&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Maximum solver iterations&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;ilut fill&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Ilut preconditioner fill&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;ilut absolute tolerance&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1e-9&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Ilut preconditioner tolerance&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;ilut relative tolerance&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1.1&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Ilut relative tolerance&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;ilut drop tolerance&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1e-10&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Ilut drop tolerance&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Solver::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;linear solver&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> std::string op = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;output&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (op == <span class="stringliteral">&quot;verbose&quot;</span>)</div>
<div class="line">      <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a> = verbose;</div>
<div class="line">    <span class="keywordflow">if</span> (op == <span class="stringliteral">&quot;quiet&quot;</span>)</div>
<div class="line">      <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a> = quiet;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> std::string sv = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;method&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (sv == <span class="stringliteral">&quot;direct&quot;</span>)</div>
<div class="line">      <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a> = direct;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sv == <span class="stringliteral">&quot;gmres&quot;</span>)</div>
<div class="line">      <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a> = gmres;</div>
<div class="line"> </div>
<div class="line">    linear_residual = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;residual&quot;</span>);</div>
<div class="line">    max_iterations  = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;max iters&quot;</span>);</div>
<div class="line">    ilut_fill       = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;ilut fill&quot;</span>);</div>
<div class="line">    ilut_atol       = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;ilut absolute tolerance&quot;</span>);</div>
<div class="line">    ilut_rtol       = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;ilut relative tolerance&quot;</span>);</div>
<div class="line">    ilut_drop       = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;ilut drop tolerance&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ParametersRefinement"></a> </p><h4>Parameters::Refinement</h4>
<p>Similarly, here are a few parameters that determine how the mesh is to be refined (and if it is to be refined at all). For what exactly the shock parameters do, see the mesh refinement functions further down.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Refinement</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">bool</span>   do_refine;</div>
<div class="line">  <span class="keywordtype">double</span> shock_val;</div>
<div class="line">  <span class="keywordtype">double</span> shock_levels;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">  <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Refinement::declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;refinement&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;refinement&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Whether to perform mesh refinement or not&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;refinement fraction&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;0.1&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Fraction of high refinement&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;unrefinement fraction&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;0.1&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Fraction of low unrefinement&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;max elements&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1000000&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;maximum number of elements&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;shock value&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;4.0&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;value for shock indicator&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;shock levels&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;3.0&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;number of shock refinement levels&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Refinement::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;refinement&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    do_refine    = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;refinement&quot;</span>);</div>
<div class="line">    shock_val    = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;shock value&quot;</span>);</div>
<div class="line">    shock_levels = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;shock levels&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ParametersFlux"></a> </p><h4>Parameters::Flux</h4>
<p>Next a section on flux modifications to make it more stable. In particular, two options are offered to stabilize the Lax-Friedrichs flux: either choose \(\mathbf{H}(\mathbf{a},\mathbf{b},\mathbf{n}) = \frac{1}{2}(\mathbf{F}(\mathbf{a})\cdot \mathbf{n} + \mathbf{F}(\mathbf{b})\cdot \mathbf{n} + \alpha (\mathbf{a} - \mathbf{b}))\) where \(\alpha\) is either a fixed number specified in the input file, or where \(\alpha\) is a mesh dependent value. In the latter case, it is chosen as \(\frac{h}{2\delta T}\) with \(h\) the diameter of the face to which the flux is applied, and \(\delta T\) the current time step.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Flux</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">enum</span> StabilizationKind</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="fe__dgp__nonparametric__0_8txt.html#a8290746300287635d0fe47e4071ea1ef">constant</a>,</div>
<div class="line">    mesh_dependent</div>
<div class="line">  };</div>
<div class="line">  StabilizationKind stabilization_kind;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> stabilization_value;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">  <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Flux::declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;flux&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(</div>
<div class="line">      <span class="stringliteral">&quot;stab&quot;</span>,</div>
<div class="line">      <span class="stringliteral">&quot;mesh&quot;</span>,</div>
<div class="line">      <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;constant|mesh&quot;</span>),</div>
<div class="line">      <span class="stringliteral">&quot;Whether to use a constant stabilization parameter or &quot;</span></div>
<div class="line">      <span class="stringliteral">&quot;a mesh-dependent one&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;stab value&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;alpha stabilization&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Flux::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;flux&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> std::string stab = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;stab&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (stab == <span class="stringliteral">&quot;constant&quot;</span>)</div>
<div class="line">      stabilization_kind = <a class="code" href="fe__dgp__nonparametric__0_8txt.html#a8290746300287635d0fe47e4071ea1ef">constant</a>;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stab == <span class="stringliteral">&quot;mesh&quot;</span>)</div>
<div class="line">      stabilization_kind = mesh_dependent;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line"> </div>
<div class="line">    stabilization_value = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;stab value&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ParametersOutput"></a> </p><h4>Parameters::Output</h4>
<p>Then a section on output parameters. We offer to produce Schlieren plots (the squared gradient of the density, a tool to visualize shock fronts), and a time interval between graphical output in case we don't want an output file every time step.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Output</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">bool</span>   schlieren_plot;</div>
<div class="line">  <span class="keywordtype">double</span> output_step;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">  <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Output::declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;output&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;schlieren plot&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Whether or not to produce schlieren plots&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;step&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;-1&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Output once per this period&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Output::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;output&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    schlieren_plot = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;schlieren plot&quot;</span>);</div>
<div class="line">    output_step    = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;step&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ParametersAllParameters"></a> </p><h4>Parameters::AllParameters</h4>
<p>Finally the class that brings it all together. It declares a number of parameters itself, mostly ones at the top level of the parameter file as well as several in section too small to warrant their own classes. It also contains everything that is actually space dimension dependent, like initial or boundary conditions.</p>
<p>Since this class is derived from all the ones above, the <code><a class="el" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters()</a></code> and <code>parse_parameters()</code> functions call the respective functions of the base classes as well.</p>
<p>Note that this class also handles the declaration of initial and boundary conditions specified in the input file. To this end, in both cases, there are entries like "w_0 value" which represent an expression in terms of \(x,y,z\) that describe the initial or boundary condition as a formula that will later be parsed by the <a class="el" href="classFunctionParser.html">FunctionParser</a> class. Similar expressions exist for "w_1", "w_2", etc, denoting the <code>dim+2</code> conserved variables of the Euler system. Similarly, we allow up to <code>max_n_boundaries</code> boundary indicators to be used in the input file, and each of these boundary indicators can be associated with an inflow, outflow, or pressure boundary condition, with homogeneous boundary conditions being specified for each component and each boundary indicator separately.</p>
<p>The data structure used to store the boundary indicators is a bit complicated. It is an array of <code>max_n_boundaries</code> elements indicating the range of boundary indicators that will be accepted. For each entry in this array, we store a pair of data in the <code>BoundaryCondition</code> structure: first, an array of size <code>n_components</code> that for each component of the solution vector indicates whether it is an inflow, outflow, or other kind of boundary, and second a <a class="el" href="classFunctionParser.html">FunctionParser</a> object that describes all components of the solution vector for this boundary id at once.</p>
<p>The <code>BoundaryCondition</code> structure requires a constructor since we need to tell the function parser object at construction time how many vector components it is to describe. This initialization can therefore not wait till we actually set the formulas the <a class="el" href="classFunctionParser.html">FunctionParser</a> object represents later in <code>AllParameters::parse_parameters()</code></p>
<p>For the same reason of having to tell <a class="el" href="classFunction.html">Function</a> objects their vector size at construction time, we have to have a constructor of the <code>AllParameters</code> class that at least initializes the other <a class="el" href="classFunctionParser.html">FunctionParser</a> object, i.e. the one describing initial conditions.</p>
<div class="fragment"><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">struct </span>AllParameters : <span class="keyword">public</span> Solver,</div>
<div class="line">                         <span class="keyword">public</span> Refinement,</div>
<div class="line">                         <span class="keyword">public</span> Flux,</div>
<div class="line">                         <span class="keyword">public</span> Output</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_n_boundaries = 10;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>BoundaryConditions</div>
<div class="line">    {</div>
<div class="line">      std::array&lt;typename EulerEquations&lt;dim&gt;::BoundaryKind,</div>
<div class="line">                 <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>&gt;</div>
<div class="line">        <a class="code" href="mapping__0_8txt.html#a334bdbfb52225fe249c8d336acfab3e6">kind</a>;</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classFunctionParser.html">FunctionParser&lt;dim&gt;</a> <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>;</div>
<div class="line"> </div>
<div class="line">      BoundaryConditions();</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    AllParameters();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> diffusion_power;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> time_step, <a class="code" href="namespaceEuler__DG.html#ae1cc4c5ec49b9998f5dc924707c29ed4">final_time</a>;</div>
<div class="line">    <span class="keywordtype">double</span> theta;</div>
<div class="line">    <span class="keywordtype">bool</span>   is_stationary;</div>
<div class="line"> </div>
<div class="line">    std::string mesh_filename;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFunctionParser.html">FunctionParser&lt;dim&gt;</a> initial_conditions;</div>
<div class="line">    BoundaryConditions  boundary_conditions[max_n_boundaries];</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  AllParameters&lt;dim&gt;::BoundaryConditions::BoundaryConditions()</div>
<div class="line">    : <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>(EulerEquations&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;::<a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="convergence__table__0_8txt.html#a37c53a384d86a02751b04a0a89820c55">std::fill</a>(<a class="code" href="mapping__0_8txt.html#a334bdbfb52225fe249c8d336acfab3e6">kind</a>.begin(),</div>
<div class="line">              <a class="code" href="mapping__0_8txt.html#a334bdbfb52225fe249c8d336acfab3e6">kind</a>.end(),</div>
<div class="line">              EulerEquations&lt;dim&gt;::no_penetration_boundary);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  AllParameters&lt;dim&gt;::AllParameters()</div>
<div class="line">    : diffusion_power(0.)</div>
<div class="line">    , time_step(1.)</div>
<div class="line">    , <a class="code" href="namespaceEuler__DG.html#ae1cc4c5ec49b9998f5dc924707c29ed4">final_time</a>(1.)</div>
<div class="line">    , theta(.5)</div>
<div class="line">    , is_stationary(<a class="code" href="event__0_8txt.html#a60053d8ff825674cfcc1321aba229cd7">true</a>)</div>
<div class="line">    , initial_conditions(EulerEquations&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;::<a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">AllParameters&lt;dim&gt;::declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;mesh&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;grid.inp&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Anything.html">Patterns::Anything</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;input file name&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;diffusion power&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;2.0&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;power of mesh size for diffusion&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;time stepping&quot;</span>);</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;time step&quot;</span>,</div>
<div class="line">                        <span class="stringliteral">&quot;0.1&quot;</span>,</div>
<div class="line">                        <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0),</div>
<div class="line">                        <span class="stringliteral">&quot;simulation time step&quot;</span>);</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;final time&quot;</span>,</div>
<div class="line">                        <span class="stringliteral">&quot;10.0&quot;</span>,</div>
<div class="line">                        <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0),</div>
<div class="line">                        <span class="stringliteral">&quot;simulation end time&quot;</span>);</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;theta scheme value&quot;</span>,</div>
<div class="line">                        <span class="stringliteral">&quot;0.5&quot;</span>,</div>
<div class="line">                        <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0, 1),</div>
<div class="line">                        <span class="stringliteral">&quot;value for theta that interpolated between explicit &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;Euler (theta=0), Crank-Nicolson (theta=0.5), and &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;implicit Euler (theta=1).&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a> = 0; <a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a> &lt; max_n_boundaries; ++<a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a>)</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;boundary_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(<a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a>));</div>
<div class="line">        {</div>
<div class="line">          prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;no penetration&quot;</span>,</div>
<div class="line">                            <span class="stringliteral">&quot;false&quot;</span>,</div>
<div class="line">                            <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                            <span class="stringliteral">&quot;whether the named boundary allows gas to &quot;</span></div>
<div class="line">                            <span class="stringliteral">&quot;penetrate or is a rigid wall&quot;</span>);</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">di &lt; EulerEquations&lt;dim&gt;::n_components</a>;</div>
<div class="line">               ++di)</div>
<div class="line">            {</div>
<div class="line">              prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di),</div>
<div class="line">                                <span class="stringliteral">&quot;outflow&quot;</span>,</div>
<div class="line">                                <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(</div>
<div class="line">                                  <span class="stringliteral">&quot;inflow|outflow|pressure&quot;</span>),</div>
<div class="line">                                <span class="stringliteral">&quot;&lt;inflow|outflow|pressure&gt;&quot;</span>);</div>
<div class="line"> </div>
<div class="line">              prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di) +</div>
<div class="line">                                  <span class="stringliteral">&quot; value&quot;</span>,</div>
<div class="line">                                <span class="stringliteral">&quot;0.0&quot;</span>,</div>
<div class="line">                                <a class="code" href="classPatterns_1_1Anything.html">Patterns::Anything</a>(),</div>
<div class="line">                                <span class="stringliteral">&quot;expression in x,y,z&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;initial condition&quot;</span>);</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">di &lt; EulerEquations&lt;dim&gt;::n_components</a>; ++di)</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di) + <span class="stringliteral">&quot; value&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;0.0&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Anything.html">Patterns::Anything</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;expression in x,y,z&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Parameters::Solver::declare_parameters</a>(prm);</div>
<div class="line">    <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Parameters::Refinement::declare_parameters</a>(prm);</div>
<div class="line">    <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Parameters::Flux::declare_parameters</a>(prm);</div>
<div class="line">    <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Parameters::Output::declare_parameters</a>(prm);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> AllParameters&lt;dim&gt;::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">  {</div>
<div class="line">    mesh_filename   = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;mesh&quot;</span>);</div>
<div class="line">    diffusion_power = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;diffusion power&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;time stepping&quot;</span>);</div>
<div class="line">    {</div>
<div class="line">      time_step = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;time step&quot;</span>);</div>
<div class="line">      <span class="keywordflow">if</span> (time_step == 0)</div>
<div class="line">        {</div>
<div class="line">          is_stationary = <span class="keyword">true</span>;</div>
<div class="line">          time_step     = 1.0;</div>
<div class="line">          <a class="code" href="namespaceEuler__DG.html#ae1cc4c5ec49b9998f5dc924707c29ed4">final_time</a>    = 1.0;</div>
<div class="line">        }</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        is_stationary = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="namespaceEuler__DG.html#ae1cc4c5ec49b9998f5dc924707c29ed4">final_time</a> = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;final time&quot;</span>);</div>
<div class="line">      theta      = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;theta scheme value&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a> = 0; <a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a> &lt; max_n_boundaries;</div>
<div class="line">         ++<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>)</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;boundary_&quot;</span> +</div>
<div class="line">                             <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>));</div>
<div class="line">        {</div>
<div class="line">          std::vector&lt;std::string&gt; expressions(</div>
<div class="line">            <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>, <span class="stringliteral">&quot;0.0&quot;</span>);</div>
<div class="line"> </div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">bool</span> no_penetration = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;no penetration&quot;</span>);</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">di &lt; EulerEquations&lt;dim&gt;::n_components</a>;</div>
<div class="line">               ++di)</div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> std::string boundary_type =</div>
<div class="line">                prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di));</div>
<div class="line"> </div>
<div class="line">              <span class="keywordflow">if</span> ((di &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>) &amp;&amp; (no_penetration == <span class="keyword">true</span>))</div>
<div class="line">                boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].kind[di] =</div>
<div class="line">                  EulerEquations&lt;dim&gt;::no_penetration_boundary;</div>
<div class="line">              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (boundary_type == <span class="stringliteral">&quot;inflow&quot;</span>)</div>
<div class="line">                boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].kind[di] =</div>
<div class="line">                  EulerEquations&lt;dim&gt;::inflow_boundary;</div>
<div class="line">              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (boundary_type == <span class="stringliteral">&quot;pressure&quot;</span>)</div>
<div class="line">                boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].kind[di] =</div>
<div class="line">                  EulerEquations&lt;dim&gt;::pressure_boundary;</div>
<div class="line">              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (boundary_type == <span class="stringliteral">&quot;outflow&quot;</span>)</div>
<div class="line">                boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].kind[di] =</div>
<div class="line">                  EulerEquations&lt;dim&gt;::outflow_boundary;</div>
<div class="line">              <span class="keywordflow">else</span></div>
<div class="line">                <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line"> </div>
<div class="line">              expressions[di] =</div>
<div class="line">                prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di) + <span class="stringliteral">&quot; value&quot;</span>);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">          boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].values.initialize(</div>
<div class="line">            <a class="code" href="classFunctionParser.html">FunctionParser&lt;dim&gt;::default_variable_names</a>(),</div>
<div class="line">            expressions,</div>
<div class="line">            std::map&lt;std::string, double&gt;());</div>
<div class="line">        }</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;initial condition&quot;</span>);</div>
<div class="line">    {</div>
<div class="line">      std::vector&lt;std::string&gt; expressions(<a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>,</div>
<div class="line">                                           <span class="stringliteral">&quot;0.0&quot;</span>);</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">di &lt; EulerEquations&lt;dim&gt;::n_components</a>; di++)</div>
<div class="line">        expressions[di] =</div>
<div class="line">          prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di) + <span class="stringliteral">&quot; value&quot;</span>);</div>
<div class="line">      initial_conditions.initialize(</div>
<div class="line">        <a class="code" href="classFunctionParser.html">FunctionParser&lt;dim&gt;::default_variable_names</a>(),</div>
<div class="line">        expressions,</div>
<div class="line">        std::map&lt;std::string, double&gt;());</div>
<div class="line">    }</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line">    Parameters::Solver::parse_parameters(prm);</div>
<div class="line">    Parameters::Refinement::parse_parameters(prm);</div>
<div class="line">    Parameters::Flux::parse_parameters(prm);</div>
<div class="line">    Parameters::Output::parse_parameters(prm);</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Parameters</span></div>
</div><!-- fragment --><p><a class="anchor" id="Conservationlawclass"></a> </p><h3>Conservation law class</h3>
<p>Here finally comes the class that actually does something with all the Euler equation and parameter specifics we've defined above. The public interface is pretty much the same as always (the constructor now takes the name of a file from which to read parameters, which is passed on the command line). The private function interface is also pretty similar to the usual arrangement, with the <code>assemble_system</code> function split into three parts: one that contains the main loop over all cells and that then calls the other two for integrals over cells and faces, respectively.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>ConservationLaw</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  ConservationLaw(<span class="keyword">const</span> <span class="keywordtype">char</span> *input_filename);</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">run</a>();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keywordtype">void</span> setup_system();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> assemble_system();</div>
<div class="line">  <span class="keywordtype">void</span> assemble_cell_term(<span class="keyword">const</span> <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> &amp;                       fe_v,</div>
<div class="line">                          <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;<a class="code" href="distributed__0_8txt.html#ad207fe81a5be05e18534713c2677da7b">dofs</a>);</div>
<div class="line">  <span class="keywordtype">void</span> assemble_face_term(</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                          <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFEFaceValuesBase.html">FEFaceValuesBase&lt;dim&gt;</a> &amp;               fe_v,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFEFaceValuesBase.html">FEFaceValuesBase&lt;dim&gt;</a> &amp;               fe_v_neighbor,</div>
<div class="line">    <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;<a class="code" href="distributed__0_8txt.html#ad207fe81a5be05e18534713c2677da7b">dofs</a>,</div>
<div class="line">    <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dofs_neighbor,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span>                                  external_face,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                          <a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>                                face_diameter);</div>
<div class="line"> </div>
<div class="line">  std::pair&lt;unsigned int, double&gt; <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>(<a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> compute_refinement_indicators(<a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;<a class="code" href="grid__generator__0_8txt.html#ad40779ba24977c5f641bfa6ac51032ab">indicator</a>) <span class="keyword">const</span>;</div>
<div class="line">  <span class="keywordtype">void</span> refine_grid(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;<a class="code" href="grid__generator__0_8txt.html#ad40779ba24977c5f641bfa6ac51032ab">indicator</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> output_results() <span class="keyword">const</span>;</div>
</div><!-- fragment --><p>The first few member variables are also rather standard. Note that we define a mapping object to be used throughout the program when assembling terms (we will hand it to every <a class="el" href="classFEValues.html">FEValues</a> and <a class="el" href="classFEFaceValues.html">FEFaceValues</a> object); the mapping we use is just the standard \(Q_1\) mapping &ndash; nothing fancy, in other words &ndash; but declaring one here and using it throughout the program will make it simpler later on to change it if that should become necessary. This is, in fact, rather pertinent: it is known that for transsonic simulations with the Euler equations, computations do not converge even as \(h\rightarrow 0\) if the boundary approximation is not of sufficiently high order.</p>
<div class="fragment"><div class="line"><a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a>   <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>;</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classMappingQ1.html">MappingQ1&lt;dim&gt;</a> <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classFESystem.html">FESystem&lt;dim&gt;</a> <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>;</div>
<div class="line"><a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>     dof_handler;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>     <a class="code" href="update__flags__0_8txt.html#a5873b8f7eeaefb5e7a99005c6c93b175">quadrature</a>;</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> - 1&gt; face_quadrature;</div>
</div><!-- fragment --><p>Next come a number of data vectors that correspond to the solution of the previous time step (<code>old_solution</code>), the best guess of the current solution (<code>current_solution</code>; we say <em>guess</em> because the Newton iteration to compute it may not have converged yet, whereas <code>old_solution</code> refers to the fully converged final result of the previous time step), and a predictor for the solution at the next time step, computed by extrapolating the current and previous solution one time step into the future:</p>
<div class="fragment"><div class="line"><a class="code" href="classVector.html">Vector&lt;double&gt;</a> old_solution;</div>
<div class="line"><a class="code" href="classVector.html">Vector&lt;double&gt;</a> current_solution;</div>
<div class="line"><a class="code" href="classVector.html">Vector&lt;double&gt;</a> predictor;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classVector.html">Vector&lt;double&gt;</a> <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>;</div>
</div><!-- fragment --><p>This final set of member variables (except for the object holding all run-time parameters at the very bottom and a screen output stream that only prints something if verbose output has been requested) deals with the interface we have in this program to the Trilinos library that provides us with linear solvers. Similarly to including PETSc matrices in <a class="el" href="step_17.html">step-17</a> and <a class="el" href="step_18.html">step-18</a>, all we need to do is to create a Trilinos sparse matrix instead of the standard deal.II class. The system matrix is used for the Jacobian in each Newton step. Since we do not intend to run this program in parallel (which wouldn't be too hard with Trilinos data structures, though), we don't have to think about anything else like distributing the degrees of freedom.</p>
<div class="fragment"><div class="line">  <a class="code" href="classTrilinosWrappers_1_1SparseMatrix.html">TrilinosWrappers::SparseMatrix</a> system_matrix;</div>
<div class="line"> </div>
<div class="line">  Parameters::AllParameters&lt;dim&gt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>;</div>
<div class="line">  <a class="code" href="classConditionalOStream.html">ConditionalOStream</a>             verbose_cout;</div>
<div class="line">};</div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawConservationLaw"></a> </p><h4>ConservationLaw::ConservationLaw</h4>
<p>There is nothing much to say about the constructor. Essentially, it reads the input file and fills the parameter object with the parsed values:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">ConservationLaw&lt;dim&gt;::ConservationLaw(<span class="keyword">const</span> <span class="keywordtype">char</span> *input_filename)</div>
<div class="line">  : <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>()</div>
<div class="line">  , <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>(<a class="code" href="classFE__Q.html">FE_Q</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;(1), EulerEquations&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;::<a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>)</div>
<div class="line">  , dof_handler(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>)</div>
<div class="line">  , <a class="code" href="update__flags__0_8txt.html#a5873b8f7eeaefb5e7a99005c6c93b175">quadrature</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="polynomial__space__0_8txt.html#a03a2f48682e29e39f7bccc11a7d1c4d1">degree</a> + 1)</div>
<div class="line">  , face_quadrature(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="polynomial__space__0_8txt.html#a03a2f48682e29e39f7bccc11a7d1c4d1">degree</a> + 1)</div>
<div class="line">  , verbose_cout(std::cout, <a class="code" href="parsed__convergence__table__0_8txt.html#a2c7b85beed973f20ac73d33d8bbe8a57">false</a>)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classParameterHandler.html">ParameterHandler</a> prm;</div>
<div class="line">  <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Parameters::AllParameters&lt;dim&gt;::declare_parameters</a>(prm);</div>
<div class="line"> </div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">parse_input</a>(input_filename);</div>
<div class="line">  <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.parse_parameters(prm);</div>
<div class="line"> </div>
<div class="line">  verbose_cout.set_condition(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.output ==</div>
<div class="line">                             Parameters::Solver::verbose);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawsetup_system"></a> </p><h4>ConservationLaw::setup_system</h4>
<p>The following (easy) function is called each time the mesh is changed. All it does is to resize the Trilinos matrix according to a sparsity pattern that we generate as in all the previous tutorial programs.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> ConservationLaw&lt;dim&gt;::setup_system()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(), dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">  <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler, dsp);</div>
<div class="line"> </div>
<div class="line">  system_matrix.reinit(dsp);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawassemble_system"></a> </p><h4>ConservationLaw::assemble_system</h4>
<p>This and the following two functions are the meat of this program: They assemble the linear system that results from applying Newton's method to the nonlinear system of conservation equations.</p>
<p>This first function puts all of the assembly pieces together in a routine that dispatches the correct piece for each cell/face. The actual implementation of the assembly on these objects is done in the following functions.</p>
<p>At the top of the function we do the usual housekeeping: allocate <a class="el" href="classFEValues.html">FEValues</a>, <a class="el" href="classFEFaceValues.html">FEFaceValues</a>, and <a class="el" href="classFESubfaceValues.html">FESubfaceValues</a> objects necessary to do the integrations on cells, faces, and subfaces (in case of adjoining cells on different refinement levels). Note that we don't need all information (like values, gradients, or real locations of quadrature points) for all of these objects, so we only let the <a class="el" href="classFEValues.html">FEValues</a> classes whatever is actually necessary by specifying the minimal set of UpdateFlags. For example, when using a <a class="el" href="classFEFaceValues.html">FEFaceValues</a> object for the neighboring cell we only need the shape values: Given a specific face, the quadrature points and <code>JxW</code> values are the same as for the current cells, and the normal vectors are known to be the negative of the normal vectors of the current cell.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> ConservationLaw&lt;dim&gt;::assemble_system()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> = dof_handler.<a class="code" href="classDoFHandler.html#ac1fedeb50b5f03b13d8b69f86e33f726">get_fe</a>().<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>();</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; dof_indices(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; dof_indices_neighbor(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> update_flags = <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> |</div>
<div class="line">                                   <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> |</div>
<div class="line">                                   <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>,</div>
<div class="line">                    face_update_flags =</div>
<div class="line">                      <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> |</div>
<div class="line">                      <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f">update_normal_vectors</a>,</div>
<div class="line">                    neighbor_face_update_flags = <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>        fe_v(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>, <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>, <a class="code" href="update__flags__0_8txt.html#a5873b8f7eeaefb5e7a99005c6c93b175">quadrature</a>, update_flags);</div>
<div class="line">  <a class="code" href="classFEFaceValues.html">FEFaceValues&lt;dim&gt;</a>    fe_v_face(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                              <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                              face_quadrature,</div>
<div class="line">                              face_update_flags);</div>
<div class="line">  <a class="code" href="classFESubfaceValues.html">FESubfaceValues&lt;dim&gt;</a> fe_v_subface(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                    <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                                    face_quadrature,</div>
<div class="line">                                    face_update_flags);</div>
<div class="line">  <a class="code" href="classFEFaceValues.html">FEFaceValues&lt;dim&gt;</a>    fe_v_face_neighbor(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                       <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                                       face_quadrature,</div>
<div class="line">                                       neighbor_face_update_flags);</div>
<div class="line">  <a class="code" href="classFESubfaceValues.html">FESubfaceValues&lt;dim&gt;</a> fe_v_subface_neighbor(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                             <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                                             face_quadrature,</div>
<div class="line">                                             neighbor_face_update_flags);</div>
</div><!-- fragment --><p>Then loop over all cells, initialize the <a class="el" href="classFEValues.html">FEValues</a> object for the current cell and call the function that assembles the problem on this cell.</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">  {</div>
<div class="line">    fe_v.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line">    <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;get_dof_indices(dof_indices);</div>
<div class="line"> </div>
<div class="line">    assemble_cell_term(fe_v, dof_indices);</div>
</div><!-- fragment --><p>Then loop over all the faces of this cell. If a face is part of the external boundary, then assemble boundary conditions there (the fifth argument to <code>assemble_face_terms</code> indicates whether we are working on an external or internal face; if it is an external face, the fourth argument denoting the degrees of freedom indices of the neighbor is ignored, so we pass an empty vector):</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a> : <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;face_indices())</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;at_boundary(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>))</div>
<div class="line">    {</div>
<div class="line">      fe_v_face.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>);</div>
<div class="line">      assemble_face_term(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>,</div>
<div class="line">                         fe_v_face,</div>
<div class="line">                         fe_v_face,</div>
<div class="line">                         dof_indices,</div>
<div class="line">                         std::vector&lt;types::global_dof_index&gt;(),</div>
<div class="line">                         <span class="keyword">true</span>,</div>
<div class="line">                         <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;face(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;boundary_id(),</div>
<div class="line">                         <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;face(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;diameter());</div>
<div class="line">    }</div>
</div><!-- fragment --><p>The alternative is that we are dealing with an internal face. There are two cases that we need to distinguish: that this is a normal face between two cells at the same refinement level, and that it is a face between two cells of the different refinement levels.</p>
<p>In the first case, there is nothing we need to do: we are using a continuous finite element, and face terms do not appear in the bilinear form in this case. The second case usually does not lead to face terms either if we enforce hanging node constraints strongly (as in all previous tutorial programs so far whenever we used continuous finite elements &ndash; this enforcement is done by the <a class="el" href="classAffineConstraints.html">AffineConstraints</a> class together with <a class="el" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a>). In the current program, however, we opt to enforce continuity weakly at faces between cells of different refinement level, for two reasons: (i) because we can, and more importantly (ii) because we would have to thread the automatic differentiation we use to compute the elements of the Newton matrix from the residual through the operations of the <a class="el" href="classAffineConstraints.html">AffineConstraints</a> class. This would be possible, but is not trivial, and so we choose this alternative approach.</p>
<p>What needs to be decided is which side of an interface between two cells of different refinement level we are sitting on.</p>
<p>Let's take the case where the neighbor is more refined first. We then have to loop over the children of the face of the current cell and integrate on each of them. We sprinkle a couple of assertions into the code to ensure that our reasoning trying to figure out which of the neighbor's children's faces coincides with a given subface of the current cell's faces is correct &ndash; a bit of defensive programming never hurts.</p>
<p>We then call the function that integrates over faces; since this is an internal face, the fifth argument is false, and the sixth one is ignored so we pass an invalid value again:</p>
<div class="fragment"><div class="line"><span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;neighbor(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;has_children())</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> neighbor2 =</div>
<div class="line">          <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;neighbor_of_neighbor(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> subface_no = 0;</div>
<div class="line">             subface_no &lt; <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;face(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;n_children();</div>
<div class="line">             ++subface_no)</div>
<div class="line">          {</div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::active_cell_iterator</a></div>
<div class="line">              neighbor_child =</div>
<div class="line">                <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;neighbor_child_on_subface(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>, subface_no);</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(neighbor_child-&gt;face(neighbor2) ==</div>
<div class="line">                     <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;face(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;child(subface_no),</div>
<div class="line">                   <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">            <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(neighbor_child-&gt;is_active(), <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">            fe_v_subface.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>, subface_no);</div>
<div class="line">            fe_v_face_neighbor.reinit(neighbor_child, neighbor2);</div>
<div class="line"> </div>
<div class="line">            neighbor_child-&gt;get_dof_indices(dof_indices_neighbor);</div>
<div class="line"> </div>
<div class="line">            assemble_face_term(</div>
<div class="line">              <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>,</div>
<div class="line">              fe_v_subface,</div>
<div class="line">              fe_v_face_neighbor,</div>
<div class="line">              dof_indices,</div>
<div class="line">              dof_indices_neighbor,</div>
<div class="line">              <span class="keyword">false</span>,</div>
<div class="line">              <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>,</div>
<div class="line">              neighbor_child-&gt;face(neighbor2)-&gt;diameter());</div>
<div class="line">          }</div>
<div class="line">      }</div>
</div><!-- fragment --><p>The other possibility we have to care for is if the neighbor is coarser than the current cell (in particular, because of the usual restriction of only one hanging node per face, the neighbor must be exactly one level coarser than the current cell, something that we check with an assertion). Again, we then integrate over this interface:</p>
<div class="fragment"><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;neighbor(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;level() != <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;level())</div>
<div class="line">              {</div>
<div class="line">                <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::cell_iterator</a> <a class="code" href="fe_2fe__0_8txt.html#ad1bbe5407fe459d8e4e71ba7ed9f7428">neighbor</a> =</div>
<div class="line">                  <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;neighbor(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>);</div>
<div class="line">                <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="fe_2fe__0_8txt.html#ad1bbe5407fe459d8e4e71ba7ed9f7428">neighbor</a>-&gt;level() == <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;level() - 1,</div>
<div class="line">                       <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">                <a class="code" href="fe_2fe__0_8txt.html#ad1bbe5407fe459d8e4e71ba7ed9f7428">neighbor</a>-&gt;get_dof_indices(dof_indices_neighbor);</div>
<div class="line"> </div>
<div class="line">                <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; faceno_subfaceno =</div>
<div class="line">                  <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;neighbor_of_coarser_neighbor(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>);</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> neighbor_face_no = faceno_subfaceno.first,</div>
<div class="line">                                   neighbor_subface_no =</div>
<div class="line">                                     faceno_subfaceno.second;</div>
<div class="line"> </div>
<div class="line">                <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="fe_2fe__0_8txt.html#ad1bbe5407fe459d8e4e71ba7ed9f7428">neighbor</a>-&gt;neighbor_child_on_subface(</div>
<div class="line">                         neighbor_face_no, neighbor_subface_no) == <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>,</div>
<div class="line">                       <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">                fe_v_face.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>);</div>
<div class="line">                fe_v_subface_neighbor.reinit(<a class="code" href="fe_2fe__0_8txt.html#ad1bbe5407fe459d8e4e71ba7ed9f7428">neighbor</a>,</div>
<div class="line">                                             neighbor_face_no,</div>
<div class="line">                                             neighbor_subface_no);</div>
<div class="line"> </div>
<div class="line">                assemble_face_term(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>,</div>
<div class="line">                                   fe_v_face,</div>
<div class="line">                                   fe_v_subface_neighbor,</div>
<div class="line">                                   dof_indices,</div>
<div class="line">                                   dof_indices_neighbor,</div>
<div class="line">                                   <span class="keyword">false</span>,</div>
<div class="line">                                   <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>,</div>
<div class="line">                                   <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;face(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;diameter());</div>
<div class="line">              }</div>
<div class="line">          }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawassemble_cell_term"></a> </p><h4>ConservationLaw::assemble_cell_term</h4>
<p>This function assembles the cell term by computing the cell part of the residual, adding its negative to the right hand side vector, and adding its derivative with respect to the local variables to the Jacobian (i.e. the Newton matrix). Recall that the cell contributions to the residual read \(R_i = \left(\frac{\mathbf{w}^{k}_{n+1} - \mathbf{w}_n}{\delta t} , \mathbf{z}_i \right)_K \) \( + \theta \mathbf{B}(\mathbf{w}^{k}_{n+1})(\mathbf{z}_i)_K \) \( + (1-\theta) \mathbf{B}(\mathbf{w}_{n}) (\mathbf{z}_i)_K \) where \(\mathbf{B}(\mathbf{w})(\mathbf{z}_i)_K = - \left(\mathbf{F}(\mathbf{w}),\nabla\mathbf{z}_i\right)_K \) \( + h^{\eta}(\nabla \mathbf{w} , \nabla \mathbf{z}_i)_K \) \( - (\mathbf{G}(\mathbf {w}), \mathbf{z}_i)_K \) for both \(\mathbf{w} = \mathbf{w}^k_{n+1}\) and \(\mathbf{w} = \mathbf{w}_{n}\) , \(\mathbf{z}_i\) is the \(i\)th vector valued test function. Furthermore, the scalar product \(\left(\mathbf{F}(\mathbf{w}), \nabla\mathbf{z}_i\right)_K\) is understood as \(\int_K \sum_{c=1}^{\text{n\_components}} \sum_{d=1}^{\text{dim}} \mathbf{F}(\mathbf{w})_{cd} \frac{\partial z^c_i}{x_d}\) where \(z^c_i\) is the \(c\)th component of the \(i\)th test function.</p>
<p>At the top of this function, we do the usual housekeeping in terms of allocating some local variables that we will need later. In particular, we will allocate variables that will hold the values of the current solution \(W_{n+1}^k\) after the \(k\)th Newton iteration (variable <code>W</code>) and the previous time step's solution \(W_{n}\) (variable <code>W_old</code>).</p>
<p>In addition to these, we need the gradients of the current variables. It is a bit of a shame that we have to compute these; we almost don't. The nice thing about a simple conservation law is that the flux doesn't generally involve any gradients. We do need these, however, for the diffusion stabilization.</p>
<p>The actual format in which we store these variables requires some explanation. First, we need values at each quadrature point for each of the <code>EulerEquations::n_components</code> components of the solution vector. This makes for a two-dimensional table for which we use deal.II's <a class="el" href="classTable.html">Table</a> class (this is more efficient than <code>std::vector&lt;std::vector&lt;T&gt; &gt;</code> because it only needs to allocate memory once, rather than once for each element of the outer vector). Similarly, the gradient is a three-dimensional table, which the <a class="el" href="classTable.html">Table</a> class also supports.</p>
<p>Secondly, we want to use automatic differentiation. To this end, we use the Sacado::Fad::DFad template for everything that is computed from the variables with respect to which we would like to compute derivatives. This includes the current solution and gradient at the quadrature points (which are linear combinations of the degrees of freedom) as well as everything that is computed from them such as the residual, but not the previous time step's solution. These variables are all found in the first part of the function, along with a variable that we will use to store the derivatives of a single component of the residual:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> ConservationLaw&lt;dim&gt;::assemble_cell_term(</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> &amp;                       fe_v,</div>
<div class="line">  <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dof_indices)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> = fe_v.dofs_per_cell;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>    = fe_v.n_quadrature_points;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTable.html">Table&lt;2, Sacado::Fad::DFad&lt;double&gt;</a>&gt; W(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>,</div>
<div class="line">                                        <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTable.html">Table&lt;2, double&gt;</a> W_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTable.html">Table&lt;3, Sacado::Fad::DFad&lt;double&gt;</a>&gt; grad_W(</div>
<div class="line">    <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>, <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTable.html">Table&lt;3, double&gt;</a> grad_W_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>,</div>
<div class="line">                              <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>,</div>
<div class="line">                              <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>);</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;double&gt; residual_derivatives(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
</div><!-- fragment --><p>Next, we have to define the independent variables that we will try to determine by solving a Newton step. These independent variables are the values of the local degrees of freedom which we extract here:</p>
<div class="fragment"><div class="line">std::vector&lt;Sacado::Fad::DFad&lt;double&gt;&gt; independent_local_dof_values(</div>
<div class="line">  <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">  independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] = current_solution(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]);</div>
</div><!-- fragment --><p>The next step incorporates all the magic: we declare a subset of the autodifferentiation variables as independent degrees of freedom, whereas all the other ones remain dependent functions. These are precisely the local degrees of freedom just extracted. All calculations that reference them (either directly or indirectly) will accumulate sensitivities with respect to these variables.</p>
<p>In order to mark the variables as independent, the following does the trick, marking <code>independent_local_dof_values[i]</code> as the \(i\)th independent variable out of a total of <code>dofs_per_cell</code>:</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">  independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>].diff(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
</div><!-- fragment --><p>After all these declarations, let us actually compute something. First, the values of <code>W</code>, <code>W_old</code>, <code>grad_W</code> and <code>grad_W_old</code>, which we can compute from the local DoF values by using the formula \(W(x_q)=\sum_i \mathbf W_i \Phi_i(x_q)\), where \(\mathbf W_i\) is the \(i\)th entry of the (local part of the) solution vector, and \(\Phi_i(x_q)\) the value of the \(i\)th vector-valued shape function evaluated at quadrature point \(x_q\). The gradient can be computed in a similar way.</p>
<p>Ideally, we could compute this information using a call into something like FEValues::get_function_values and FEValues::get_function_gradients, but since (i) we would have to extend the <a class="el" href="classFEValues.html">FEValues</a> class for this, and (ii) we don't want to make the entire <code>old_solution</code> vector fad types, only the local cell variables, we explicitly code the loop above. Before this, we add another loop that initializes all the fad variables to zero:</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q)</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a> = 0; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">c &lt; EulerEquations&lt;dim&gt;::n_components</a>; ++<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>)</div>
<div class="line">    {</div>
<div class="line">      W[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>]     = 0;</div>
<div class="line">      W_old[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = 0;</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">        {</div>
<div class="line">          grad_W[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>]     = 0;</div>
<div class="line">          grad_W_old[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] = 0;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q)</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a> =</div>
<div class="line">        fe_v.get_fe().system_to_component_index(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>).first;</div>
<div class="line"> </div>
<div class="line">      W[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] += independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] *</div>
<div class="line">                 fe_v.shape_value_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>);</div>
<div class="line">      W_old[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] +=</div>
<div class="line">        old_solution(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) * fe_v.shape_value_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>++)</div>
<div class="line">        {</div>
<div class="line">          grad_W[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] += independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] *</div>
<div class="line">                             fe_v.shape_grad_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>)[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line">          grad_W_old[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] += old_solution(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) *</div>
<div class="line">                                 fe_v.shape_grad_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>)[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line">        }</div>
<div class="line">    }</div>
</div><!-- fragment --><p>Next, in order to compute the cell contributions, we need to evaluate \(\mathbf{F}({\mathbf w}^k_{n+1})\), \(\mathbf{G}({\mathbf w}^k_{n+1})\) and \(\mathbf{F}({\mathbf w}_n)\), \(\mathbf{G}({\mathbf w}_n)\) at all quadrature points. To store these, we also need to allocate a bit of memory. Note that we compute the flux matrices and right hand sides in terms of autodifferentiation variables, so that the Jacobian contributions can later easily be computed from it:</p>
<div class="fragment"><div class="line">std::vector&lt;ndarray&lt;Sacado::Fad::DFad&lt;double&gt;,</div>
<div class="line">                    <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>,</div>
<div class="line">                    <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;&gt;</div>
<div class="line">  <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">std::vector&lt;ndarray&lt;double, EulerEquations&lt;dim&gt;::n_components</a>, <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;&gt;</div>
<div class="line">  flux_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;</div>
<div class="line">  std::array&lt;Sacado::Fad::DFad&lt;double&gt;, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>&gt;&gt;</div>
<div class="line">  forcing(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">std::vector&lt;std::array&lt;double, EulerEquations&lt;dim&gt;::n_components</a>&gt;&gt;</div>
<div class="line">  forcing_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q)</div>
<div class="line">  {</div>
<div class="line">    EulerEquations&lt;dim&gt;::compute_flux_matrix(W_old[q], flux_old[q]);</div>
<div class="line">    EulerEquations&lt;dim&gt;::compute_forcing_vector(W_old[q], forcing_old[q]);</div>
<div class="line">    EulerEquations&lt;dim&gt;::compute_flux_matrix(W[q], <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>[q]);</div>
<div class="line">    EulerEquations&lt;dim&gt;::compute_forcing_vector(W[q], forcing[q]);</div>
<div class="line">  }</div>
</div><!-- fragment --><p>We now have all of the pieces in place, so perform the assembly. We have an outer loop through the components of the system, and an inner loop over the quadrature points, where we accumulate contributions to the \(i\)th residual \(R_i\). The general formula for this residual is given in the introduction and at the top of this function. We can, however, simplify it a bit taking into account that the \(i\)th (vector-valued) test function \(\mathbf{z}_i\) has in reality only a single nonzero component (more on this topic can be found in the <a class="el" href="group__vector__valued.html">Handling vector valued problems</a> module). It will be represented by the variable <code>component_i</code> below. With this, the residual term can be re-written as </p><p class="formulaDsp">
\begin{eqnarray*} R_i &amp;=&amp; \left(\frac{(\mathbf{w}_{n+1} - \mathbf{w}_n)_{\text{component\_i}}}{\delta t},(\mathbf{z}_i)_{\text{component\_i}}\right)_K \\ &amp;-&amp; \sum_{d=1}^{\text{dim}} \left( \theta \mathbf{F} ({\mathbf{w}^k_{n+1}})_{\text{component\_i},d} + (1-\theta) \mathbf{F} ({\mathbf{w}_{n}})_{\text{component\_i},d} , \frac{\partial(\mathbf{z}_i)_{\text{component\_i}}} {\partial x_d}\right)_K \\ &amp;+&amp; \sum_{d=1}^{\text{dim}} h^{\eta} \left( \theta \frac{\partial (\mathbf{w}^k_{n+1})_{\text{component\_i}}}{\partial x_d} + (1-\theta) \frac{\partial (\mathbf{w}_n)_{\text{component\_i}}}{\partial x_d} , \frac{\partial (\mathbf{z}_i)_{\text{component\_i}}}{\partial x_d} \right)_K \\ &amp;-&amp; \left( \theta\mathbf{G}({\mathbf{w}^k_n+1} )_{\text{component\_i}} + (1-\theta)\mathbf{G}({\mathbf{w}_n})_{\text{component\_i}} , (\mathbf{z}_i)_{\text{component\_i}} \right)_K , \end{eqnarray*}
</p>
<p> where integrals are understood to be evaluated through summation over quadrature points.</p>
<p>We initially sum all contributions of the residual in the positive sense, so that we don't need to negative the Jacobian entries. Then, when we sum into the <code>right_hand_side</code> vector, we negate this residual.</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; fe_v.dofs_per_cell; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">  {</div>
<div class="line">    Sacado::Fad::DFad&lt;double&gt; R_i = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">      fe_v.get_fe().system_to_component_index(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>).first;</div>
</div><!-- fragment --><p>The residual for each row (i) will be accumulating into this fad variable. At the end of the assembly for this row, we will query for the sensitivities to this variable and add them into the Jacobian.</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a> = 0; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a> &lt; fe_v.n_quadrature_points; ++<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.is_stationary == <span class="keyword">false</span>)</div>
<div class="line">      R_i += 1.0 / <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.time_step *</div>
<div class="line">             (W[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i] - W_old[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i]) *</div>
<div class="line">             fe_v.shape_value_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>, component_i) *</div>
<div class="line">             fe_v.JxW(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>++)</div>
<div class="line">      R_i -=</div>
<div class="line">        (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta * <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] +</div>
<div class="line">         (1.0 - <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta) * flux_old[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>]) *</div>
<div class="line">        fe_v.shape_grad_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>, component_i)[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] *</div>
<div class="line">        fe_v.JxW(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>++)</div>
<div class="line">      R_i +=</div>
<div class="line">        1.0 *</div>
<div class="line">        std::pow(fe_v.get_cell()-&gt;diameter(),</div>
<div class="line">                 <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.diffusion_power) *</div>
<div class="line">        (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta * grad_W[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] +</div>
<div class="line">         (1.0 - <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta) * grad_W_old[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>]) *</div>
<div class="line">        fe_v.shape_grad_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>, component_i)[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] *</div>
<div class="line">        fe_v.JxW(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>);</div>
<div class="line"> </div>
<div class="line">    R_i -=</div>
<div class="line">      (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta * forcing[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i] +</div>
<div class="line">       (1.0 - <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta) * forcing_old[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i]) *</div>
<div class="line">      fe_v.shape_value_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>, component_i) *</div>
<div class="line">      fe_v.JxW(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>);</div>
<div class="line">  }</div>
</div><!-- fragment --><p>At the end of the loop, we have to add the sensitivities to the matrix and subtract the residual from the right hand side. Trilinos FAD data type gives us access to the derivatives using <code>R_i.fastAccessDx(k)</code>, so we store the data in a temporary array. This information about the whole row of local dofs is then added to the Trilinos matrix at once (which supports the data types we have chosen).</p>
<div class="fragment"><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a> = 0; <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>)</div>
<div class="line">        residual_derivatives[<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>] = R_i.fastAccessDx(<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>);</div>
<div class="line">      system_matrix.add(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>], dof_indices, residual_derivatives);</div>
<div class="line">      <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) -= R_i.val();</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawassemble_face_term"></a> </p><h4>ConservationLaw::assemble_face_term</h4>
<p>Here, we do essentially the same as in the previous function. At the top, we introduce the independent variables. Because the current function is also used if we are working on an internal face between two cells, the independent variables are not only the degrees of freedom on the current cell but in the case of an interior face also the ones on the neighbor.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> ConservationLaw&lt;dim&gt;::assemble_face_term(</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                          <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>,</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classFEFaceValuesBase.html">FEFaceValuesBase&lt;dim&gt;</a> &amp;               fe_v,</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classFEFaceValuesBase.html">FEFaceValuesBase&lt;dim&gt;</a> &amp;               fe_v_neighbor,</div>
<div class="line">  <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dof_indices,</div>
<div class="line">  <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dof_indices_neighbor,</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">bool</span>                                  external_face,</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                          <a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>,</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span>                                face_diameter)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>    = fe_v.<a class="code" href="classFEValuesBase.html#a807c3049bfe81743fc0f237dfc2fbdea">n_quadrature_points</a>;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> = fe_v.<a class="code" href="classFEValuesBase.html#a5b264d5b2fb6615f5dea7a21135ed1a5">dofs_per_cell</a>;</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;Sacado::Fad::DFad&lt;double&gt;&gt; independent_local_dof_values(</div>
<div class="line">    <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>),</div>
<div class="line">    independent_neighbor_dof_values(external_face == <span class="keyword">false</span> ? <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> :</div>
<div class="line">                                                             0);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_independent_variables =</div>
<div class="line">    (external_face == <span class="keyword">false</span> ? 2 * <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> : <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>++)</div>
<div class="line">    {</div>
<div class="line">      independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] = current_solution(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]);</div>
<div class="line">      independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>].diff(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, n_independent_variables);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (external_face == <span class="keyword">false</span>)</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>++)</div>
<div class="line">      {</div>
<div class="line">        independent_neighbor_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] =</div>
<div class="line">          current_solution(dof_indices_neighbor[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]);</div>
<div class="line">        independent_neighbor_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>].diff(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> + <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>,</div>
<div class="line">                                                n_independent_variables);</div>
<div class="line">      }</div>
</div><!-- fragment --><p>Next, we need to define the values of the conservative variables \({\mathbf W}\) on this side of the face ( \( {\mathbf W}^+\)) and on the opposite side ( \({\mathbf W}^-\)), for both \({\mathbf W} = {\mathbf W}^k_{n+1}\) and \({\mathbf W} = {\mathbf W}_n\). The "this side" values can be computed in exactly the same way as in the previous function, but note that the <code>fe_v</code> variable now is of type <a class="el" href="classFEFaceValues.html">FEFaceValues</a> or <a class="el" href="classFESubfaceValues.html">FESubfaceValues</a>:</p>
<div class="fragment"><div class="line"><a class="code" href="classTable.html">Table&lt;2, Sacado::Fad::DFad&lt;double&gt;</a>&gt; Wplus(</div>
<div class="line">  <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>),</div>
<div class="line">  Wminus(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>);</div>
<div class="line"><a class="code" href="classTable.html">Table&lt;2, double&gt;</a> Wplus_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>),</div>
<div class="line">  Wminus_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q)</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">        fe_v.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#a86644fe67824373cd51e9ff7fca94f8c">system_to_component_index</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>).first;</div>
<div class="line">      Wplus[q][component_i] +=</div>
<div class="line">        independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] *</div>
<div class="line">        fe_v.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, component_i);</div>
<div class="line">      Wplus_old[q][component_i] +=</div>
<div class="line">        old_solution(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) *</div>
<div class="line">        fe_v.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, component_i);</div>
<div class="line">    }</div>
</div><!-- fragment --><p>Computing "opposite side" is a bit more complicated. If this is an internal face, we can compute it as above by simply using the independent variables from the neighbor:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (external_face == <span class="keyword">false</span>)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">            fe_v_neighbor.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#a86644fe67824373cd51e9ff7fca94f8c">system_to_component_index</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>).first;</div>
<div class="line">          Wminus[q][component_i] +=</div>
<div class="line">            independent_neighbor_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] *</div>
<div class="line">            fe_v_neighbor.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, component_i);</div>
<div class="line">          Wminus_old[q][component_i] +=</div>
<div class="line">            old_solution(dof_indices_neighbor[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) *</div>
<div class="line">            fe_v_neighbor.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, component_i);</div>
<div class="line">        }</div>
<div class="line">  }</div>
</div><!-- fragment --><p>On the other hand, if this is an external boundary face, then the values of \(\mathbf{W}^-\) will be either functions of \(\mathbf{W}^+\), or they will be prescribed, depending on the kind of boundary condition imposed here.</p>
<p>To start the evaluation, let us ensure that the boundary id specified for this boundary is one for which we actually have data in the parameters object. Next, we evaluate the function object for the inhomogeneity. This is a bit tricky: a given boundary might have both prescribed and implicit values. If a particular component is not prescribed, the values evaluate to zero and are ignored below.</p>
<p>The rest is done by a function that actually knows the specifics of Euler equation boundary conditions. Note that since we are using fad variables here, sensitivities will be updated appropriately, a process that would otherwise be tremendously complicated.</p>
<div class="fragment"><div class="line"><span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a> &lt; Parameters::AllParameters&lt;dim&gt;::max_n_boundaries,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>,</div>
<div class="line">                         0,</div>
<div class="line">                         Parameters::AllParameters&lt;dim&gt;::max_n_boundaries));</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;Vector&lt;double&gt;&gt; boundary_values(</div>
<div class="line">      <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>(<a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>));</div>
<div class="line">    <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].values.vector_value_list(</div>
<div class="line">      fe_v.<a class="code" href="classFEValuesBase.html#ae41b67cfd48e02f6035e39c84f0fb47a">get_quadrature_points</a>(), boundary_values);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; q++)</div>
<div class="line">      {</div>
<div class="line">        EulerEquations&lt;dim&gt;::compute_Wminus(</div>
<div class="line">          <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].kind,</div>
<div class="line">          fe_v.<a class="code" href="classFEValuesBase.html#ac25ec6835799c3b6c7c842f8acb05eb3">normal_vector</a>(q),</div>
<div class="line">          Wplus[q],</div>
<div class="line">          boundary_values[q],</div>
<div class="line">          Wminus[q]);</div>
</div><!-- fragment --><p>Here we assume that boundary type, boundary normal vector and boundary data values maintain the same during time advancing.</p>
<div class="fragment"><div class="line">      EulerEquations&lt;dim&gt;::compute_Wminus(</div>
<div class="line">        <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].kind,</div>
<div class="line">        fe_v.<a class="code" href="classFEValuesBase.html#ac25ec6835799c3b6c7c842f8acb05eb3">normal_vector</a>(q),</div>
<div class="line">        Wplus_old[q],</div>
<div class="line">        boundary_values[q],</div>
<div class="line">        Wminus_old[q]);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Now that we have \(\mathbf w^+\) and \(\mathbf w^-\), we can go about computing the numerical flux function \(\mathbf H(\mathbf w^+,\mathbf w^-, \mathbf n)\) for each quadrature point. Before calling the function that does so, we also need to determine the Lax-Friedrich's stability parameter:</p>
<div class="fragment"><div class="line"><a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;</div>
<div class="line">  std::array&lt;Sacado::Fad::DFad&lt;double&gt;, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>&gt;&gt;</div>
<div class="line">  normal_fluxes(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"><a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">std::vector&lt;std::array&lt;double, EulerEquations&lt;dim&gt;::n_components</a>&gt;&gt;</div>
<div class="line">  normal_fluxes_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">switch</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.stabilization_kind)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="fe__dgp__nonparametric__0_8txt.html#a8290746300287635d0fe47e4071ea1ef">Parameters::Flux::constant</a>:</div>
<div class="line">      <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a> = <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.stabilization_value;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> Parameters::Flux::mesh_dependent:</div>
<div class="line">      <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a> = face_diameter / (2.0 * <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.time_step);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">      <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a> = 1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q)</div>
<div class="line">  {</div>
<div class="line">    EulerEquations&lt;dim&gt;::numerical_normal_flux(</div>
<div class="line">      fe_v.<a class="code" href="classFEValuesBase.html#ac25ec6835799c3b6c7c842f8acb05eb3">normal_vector</a>(q), Wplus[q], Wminus[q], <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>, normal_fluxes[q]);</div>
<div class="line">    EulerEquations&lt;dim&gt;::numerical_normal_flux(fe_v.<a class="code" href="classFEValuesBase.html#ac25ec6835799c3b6c7c842f8acb05eb3">normal_vector</a>(q),</div>
<div class="line">                                               Wplus_old[q],</div>
<div class="line">                                               Wminus_old[q],</div>
<div class="line">                                               <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>,</div>
<div class="line">                                               normal_fluxes_old[q]);</div>
<div class="line">  }</div>
</div><!-- fragment --><p>Now assemble the face term in exactly the same way as for the cell contributions in the previous function. The only difference is that if this is an internal face, we also have to take into account the sensitivities of the residual contributions to the degrees of freedom on the neighboring cell:</p>
<div class="fragment"><div class="line">  std::vector&lt;double&gt; residual_derivatives(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; fe_v.<a class="code" href="classFEValuesBase.html#a5b264d5b2fb6615f5dea7a21135ed1a5">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">    <span class="keywordflow">if</span> (fe_v.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#ab275cbead21bb11b1208222b6d662357">has_support_on_face</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>) == <span class="keyword">true</span>)</div>
<div class="line">      {</div>
<div class="line">        Sacado::Fad::DFad&lt;double&gt; R_i = 0;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a> = 0; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a> &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>)</div>
<div class="line">          {</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">              fe_v.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#a86644fe67824373cd51e9ff7fca94f8c">system_to_component_index</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>).first;</div>
<div class="line"> </div>
<div class="line">            R_i += (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta * normal_fluxes[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i] +</div>
<div class="line">                    (1.0 - <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta) *</div>
<div class="line">                      normal_fluxes_old[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i]) *</div>
<div class="line">                   fe_v.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>, component_i) *</div>
<div class="line">                   fe_v.<a class="code" href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">JxW</a>(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a> = 0; <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>)</div>
<div class="line">          residual_derivatives[<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>] = R_i.fastAccessDx(<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>);</div>
<div class="line">        system_matrix.add(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>], dof_indices, residual_derivatives);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (external_face == <span class="keyword">false</span>)</div>
<div class="line">          {</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a> = 0; <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>)</div>
<div class="line">              residual_derivatives[<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>] = R_i.fastAccessDx(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> + <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>);</div>
<div class="line">            system_matrix.add(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>],</div>
<div class="line">                              dof_indices_neighbor,</div>
<div class="line">                              residual_derivatives);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) -= R_i.val();</div>
<div class="line">      }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawsolve"></a> </p><h4>ConservationLaw::solve</h4>
<p>Here, we actually solve the linear system, using either of Trilinos' Aztec or Amesos linear solvers. The result of the computation will be written into the argument vector passed to this function. The result is a pair of number of iterations and the final linear residual.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">std::pair&lt;unsigned int, double&gt;</div>
<div class="line"><a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">ConservationLaw&lt;dim&gt;::solve</a>(<a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;newton_update)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">switch</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.solver)</div>
<div class="line">    {</div>
</div><!-- fragment --><p>If the parameter file specified that a direct solver shall be used, then we'll get here. The process is straightforward, since deal.II provides a wrapper class to the Amesos direct solver within Trilinos. All we have to do is to create a solver control object (which is just a dummy object here, since we won't perform any iterations), and then create the direct solver object. When actually doing the solve, note that we don't pass a preconditioner. That wouldn't make much sense for a direct solver anyway. At the end we return the solver control statistics &mdash; which will tell that no iterations have been performed and that the final linear residual is zero, absent any better information that may be provided here:</p>
<div class="fragment"><div class="line"><span class="keywordflow">case</span> Parameters::Solver::direct:</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classSolverControl.html">SolverControl</a>                                  solver_control(1, 0);</div>
<div class="line">    <a class="code" href="structTrilinosWrappers_1_1SolverDirect_1_1AdditionalData.html">TrilinosWrappers::SolverDirect::AdditionalData</a> <a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>(</div>
<div class="line">      <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.output == Parameters::Solver::verbose);</div>
<div class="line">    <a class="code" href="classTrilinosWrappers_1_1SolverDirect.html">TrilinosWrappers::SolverDirect</a> direct(solver_control, <a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>);</div>
<div class="line"> </div>
<div class="line">    direct.solve(system_matrix, newton_update, <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> {solver_control.last_step(), solver_control.last_value()};</div>
<div class="line">  }</div>
</div><!-- fragment --><p>Likewise, if we are to use an iterative solver, we use Aztec's GMRES solver. We could use the Trilinos wrapper classes for iterative solvers and preconditioners here as well, but we choose to use an Aztec solver directly. For the given problem, Aztec's internal preconditioner implementations are superior over the ones deal.II has wrapper classes to, so we use ILU-T preconditioning within the AztecOO solver and set a bunch of options that can be changed from the parameter file.</p>
<p>There are two more practicalities: Since we have built our right hand side and solution vector as deal.II <a class="el" href="classVector.html">Vector</a> objects (as opposed to the matrix, which is a Trilinos object), we must hand the solvers Trilinos Epetra vectors. Luckily, they support the concept of a 'view', so we just send in a pointer to our deal.II vectors. We have to provide an Epetra_Map for the vector that sets the parallel distribution, which is just a dummy object in serial. The easiest way is to ask the matrix for its map, and we're going to be ready for matrix-vector products with it.</p>
<p>Secondly, the Aztec solver wants us to pass a Trilinos Epetra_CrsMatrix in, not the deal.II wrapper class itself. So we access to the actual Trilinos matrix in the Trilinos wrapper class by the command trilinos_matrix(). Trilinos wants the matrix to be non-constant, so we have to manually remove the constantness using a const_cast.</p>
<div class="fragment"><div class="line">      <span class="keywordflow">case</span> Parameters::Solver::gmres:</div>
<div class="line">        {</div>
<div class="line">          Epetra_Vector <a class="code" href="vector__valued__0_8txt.html#a2b24e414d1a0d32deea919c5e8899811">x</a>(<a class="code" href="namespaceFEValuesViews.html#af2099b26234f5816729f7f6dc523dc0f">View</a>,</div>
<div class="line">                          system_matrix.trilinos_matrix().DomainMap(),</div>
<div class="line">                          newton_update.<a class="code" href="classVector.html#af34b888fe493ef2ed188179de69ad7ed">begin</a>());</div>
<div class="line">          Epetra_Vector <a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a>(<a class="code" href="namespaceFEValuesViews.html#af2099b26234f5816729f7f6dc523dc0f">View</a>,</div>
<div class="line">                          system_matrix.trilinos_matrix().RangeMap(),</div>
<div class="line">                          <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>.begin());</div>
<div class="line"> </div>
<div class="line">          AztecOO <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>;</div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecOption(</div>
<div class="line">            AZ_output,</div>
<div class="line">            (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.output == Parameters::Solver::quiet ? AZ_none :</div>
<div class="line">                                                              AZ_all));</div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecOption(AZ_solver, AZ_gmres);</div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetRHS(&amp;<a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a>);</div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetLHS(&amp;<a class="code" href="vector__valued__0_8txt.html#a2b24e414d1a0d32deea919c5e8899811">x</a>);</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecOption(AZ_precond, AZ_dom_decomp);</div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecOption(AZ_subdomain_solve, AZ_ilut);</div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecOption(AZ_overlap, 0);</div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecOption(AZ_reorder, 0);</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecParam(AZ_drop, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.ilut_drop);</div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecParam(AZ_ilut_fill, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.ilut_fill);</div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecParam(AZ_athresh, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.ilut_atol);</div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecParam(AZ_rthresh, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.ilut_rtol);</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetUserMatrix(</div>
<div class="line">            <span class="keyword">const_cast&lt;</span>Epetra_CrsMatrix *<span class="keyword">&gt;</span>(&amp;system_matrix.trilinos_matrix()));</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.Iterate(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.max_iterations,</div>
<div class="line">                         <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.linear_residual);</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">return</span> {<a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.NumIters(), <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.TrueResidual()};</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">  <span class="keywordflow">return</span> {0, 0};</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawcompute_refinement_indicators"></a> </p><h4>ConservationLaw::compute_refinement_indicators</h4>
<p>This function is real simple: We don't pretend that we know here what a good refinement indicator would be. Rather, we assume that the <code>EulerEquation</code> class would know about this, and so we simply defer to the respective function we've implemented there:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> ConservationLaw&lt;dim&gt;::compute_refinement_indicators(</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;refinement_indicators)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  EulerEquations&lt;dim&gt;::compute_refinement_indicators(dof_handler,</div>
<div class="line">                                                     <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                                     predictor,</div>
<div class="line">                                                     refinement_indicators);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawrefine_grid"></a> </p><h4>ConservationLaw::refine_grid</h4>
<p>Here, we use the refinement indicators computed before and refine the mesh. At the beginning, we loop over all cells and mark those that we think should be refined:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">ConservationLaw&lt;dim&gt;::refine_grid(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;refinement_indicators)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell_no = <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;active_cell_index();</div>
<div class="line">      <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;clear_coarsen_flag();</div>
<div class="line">      <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;clear_refine_flag();</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> ((<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;level() &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.shock_levels) &amp;&amp;</div>
<div class="line">          (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(refinement_indicators(cell_no)) &gt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.shock_val))</div>
<div class="line">        <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;set_refine_flag();</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;level() &gt; 0) &amp;&amp;</div>
<div class="line">               (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(refinement_indicators(cell_no)) &lt;</div>
<div class="line">                0.75 * <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.shock_val))</div>
<div class="line">        <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;set_coarsen_flag();</div>
<div class="line">    }</div>
</div><!-- fragment --><p>Then we need to transfer the various solution vectors from the old to the new grid while we do the refinement. The <a class="el" href="classSolutionTransfer.html">SolutionTransfer</a> class is our friend here; it has a fairly extensive documentation, including examples, so we won't comment much on the following code. The last three lines simply re-set the sizes of some other vectors to the now correct size:</p>
<div class="fragment"><div class="line">  std::vector&lt;Vector&lt;double&gt;&gt; transfer_in;</div>
<div class="line">  std::vector&lt;Vector&lt;double&gt;&gt; transfer_out;</div>
<div class="line"> </div>
<div class="line">  transfer_in.push_back(old_solution);</div>
<div class="line">  transfer_in.push_back(predictor);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.prepare_coarsening_and_refinement();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classSolutionTransfer.html">SolutionTransfer&lt;dim&gt;</a> soltrans(dof_handler);</div>
<div class="line">  soltrans.prepare_for_coarsening_and_refinement(transfer_in);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.execute_coarsening_and_refinement();</div>
<div class="line"> </div>
<div class="line">  dof_handler.<a class="code" href="classDoFHandler.html#ad316958f8045d9a48094335b23a03a53">clear</a>();</div>
<div class="line">  dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
<div class="line"> </div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> new_old_solution(1);</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> new_predictor(1);</div>
<div class="line"> </div>
<div class="line">    transfer_out.push_back(new_old_solution);</div>
<div class="line">    transfer_out.push_back(new_predictor);</div>
<div class="line">    transfer_out[0].reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    transfer_out[1].reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  soltrans.interpolate(transfer_in, transfer_out);</div>
<div class="line"> </div>
<div class="line">  old_solution.reinit(transfer_out[0].<a class="code" href="function__0_8txt.html#a4f780342f2d5d632f82cf7fd90158a66">size</a>());</div>
<div class="line">  old_solution = transfer_out[0];</div>
<div class="line"> </div>
<div class="line">  predictor.reinit(transfer_out[1].<a class="code" href="function__0_8txt.html#a4f780342f2d5d632f82cf7fd90158a66">size</a>());</div>
<div class="line">  predictor = transfer_out[1];</div>
<div class="line"> </div>
<div class="line">  current_solution.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">  current_solution = old_solution;</div>
<div class="line">  <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawoutput_results"></a> </p><h4>ConservationLaw::output_results</h4>
<p>This function now is rather straightforward. All the magic, including transforming data from conservative variables to physical ones has been abstracted and moved into the EulerEquations class so that it can be replaced in case we want to solve some other hyperbolic conservation law.</p>
<p>Note that the number of the output file is determined by keeping a counter in the form of a static variable that is set to zero the first time we come to this function and is incremented by one at the end of each invocation.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> ConservationLaw&lt;dim&gt;::output_results()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keyword">typename</span> EulerEquations&lt;dim&gt;::Postprocessor <a class="code" href="data__postprocessor__0_8txt.html#a80e53cb52e5dbb182dd14ee528927a77">postprocessor</a>(</div>
<div class="line">    <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.schlieren_plot);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">attach_dof_handler</a>(dof_handler);</div>
<div class="line"> </div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(current_solution,</div>
<div class="line">                           EulerEquations&lt;dim&gt;::component_names(),</div>
<div class="line">                           <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;::type_dof_data</a>,</div>
<div class="line">                           EulerEquations&lt;dim&gt;::component_interpretation());</div>
<div class="line"> </div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(current_solution, <a class="code" href="data__postprocessor__0_8txt.html#a80e53cb52e5dbb182dd14ee528927a77">postprocessor</a>);</div>
<div class="line"> </div>
<div class="line">  data_out.<a class="code" href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">build_patches</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> output_file_number = 0;</div>
<div class="line">  std::string         filename =</div>
<div class="line">    <span class="stringliteral">&quot;solution-&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(output_file_number, 3) + <span class="stringliteral">&quot;.vtk&quot;</span>;</div>
<div class="line">  std::ofstream <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>(filename);</div>
<div class="line">  data_out.<a class="code" href="classDataOutInterface.html#acad99726038e4fca7f605fdffb3317e4">write_vtk</a>(<a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>);</div>
<div class="line"> </div>
<div class="line">  ++output_file_number;</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawrun"></a> </p><h4>ConservationLaw::run</h4>
<p>This function contains the top-level logic of this program: initialization, the time loop, and the inner Newton iteration.</p>
<p>At the beginning, we read the mesh file specified by the parameter file, setup the <a class="el" href="classDoFHandler.html">DoFHandler</a> and various vectors, and then interpolate the given initial conditions on this mesh. We then perform a number of mesh refinements, based on the initial conditions, to obtain a mesh that is already well adapted to the starting solution. At the end of this process, we output the initial solution.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">ConservationLaw&lt;dim&gt;::run</a>()</div>
<div class="line">{</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classGridIn.html">GridIn&lt;dim&gt;</a> grid_in;</div>
<div class="line">    grid_in.<a class="code" href="classGridIn.html#a82ac1c03b0efe87204ad45d2f1d87f7e">attach_triangulation</a>(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>);</div>
<div class="line"> </div>
<div class="line">    std::ifstream input_file(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.mesh_filename);</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(input_file, <a class="code" href="group__Exceptions.html#ga4c22c86ff89575667de2ca9778aa28e5">ExcFileNotOpen</a>(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.mesh_filename.c_str()));</div>
<div class="line"> </div>
<div class="line">    grid_in.<a class="code" href="classGridIn.html#abbb16aa0aa53bfa9231b69278d397616">read_ucd</a>(input_file);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  dof_handler.<a class="code" href="classDoFHandler.html#ad316958f8045d9a48094335b23a03a53">clear</a>();</div>
<div class="line">  dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
</div><!-- fragment --><p>Size all of the fields.</p>
<div class="fragment"><div class="line">old_solution.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">current_solution.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">predictor.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line"><a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line"> </div>
<div class="line">setup_system();</div>
<div class="line"> </div>
<div class="line"><a class="code" href="namespaceVectorTools.html#a761f008bdeb7d94a69205ae824deefad">VectorTools::interpolate</a>(dof_handler,</div>
<div class="line">                         <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.initial_conditions,</div>
<div class="line">                         old_solution);</div>
<div class="line">current_solution = old_solution;</div>
<div class="line">predictor        = old_solution;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.do_refine == <span class="keyword">true</span>)</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.shock_levels; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classVector.html">Vector&lt;double&gt;</a> refinement_indicators(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells());</div>
<div class="line"> </div>
<div class="line">      compute_refinement_indicators(refinement_indicators);</div>
<div class="line">      refine_grid(refinement_indicators);</div>
<div class="line"> </div>
<div class="line">      setup_system();</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="namespaceVectorTools.html#a761f008bdeb7d94a69205ae824deefad">VectorTools::interpolate</a>(dof_handler,</div>
<div class="line">                               <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.initial_conditions,</div>
<div class="line">                               old_solution);</div>
<div class="line">      current_solution = old_solution;</div>
<div class="line">      predictor        = old_solution;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">output_results();</div>
</div><!-- fragment --><p>We then enter into the main time stepping loop. At the top we simply output some status information so one can keep track of where a computation is, as well as the header for a table that indicates progress of the nonlinear inner iteration:</p>
<div class="fragment"><div class="line"><a class="code" href="classVector.html">Vector&lt;double&gt;</a> newton_update(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a>        = 0;</div>
<div class="line"><span class="keywordtype">double</span> next_output = <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a> + <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.output_step;</div>
<div class="line"> </div>
<div class="line">predictor = old_solution;</div>
<div class="line"><span class="keywordflow">while</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.final_time)</div>
<div class="line">  {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;T=&quot;</span> &lt;&lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a> &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;   Number of active cells:       &quot;</span></div>
<div class="line">              &lt;&lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells() &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;   Number of degrees of freedom: &quot;</span> &lt;&lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>()</div>
<div class="line">              &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;   NonLin Res     Lin Iter       Lin Res&quot;</span> &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;   _____________________________________&quot;</span> &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>Then comes the inner Newton iteration to solve the nonlinear problem in each time step. The way it works is to reset matrix and right hand side to zero, then assemble the linear system. If the norm of the right hand side is small enough, then we declare that the Newton iteration has converged. Otherwise, we solve the linear system, update the current solution with the Newton increment, and output convergence information. At the end, we check that the number of Newton iterations is not beyond a limit of 10 &ndash; if it is, it appears likely that iterations are diverging and further iterations would do no good. If that happens, we throw an exception that will be caught in <code><a class="el" href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main()</a></code> with status information being displayed before the program aborts.</p>
<p>Note that the way we write the AssertThrow macro below is by and large equivalent to writing something like <code>if (!(nonlin_iter &lt;= 10)) throw ExcMessage ("No convergence in nonlinear
 solver");</code>. The only significant difference is that AssertThrow also makes sure that the exception being thrown carries with it information about the location (file name and line number) where it was generated. This is not overly critical here, because there is only a single place where this sort of exception can happen; however, it is generally a very useful tool when one wants to find out where an error occurred.</p>
<div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nonlin_iter = 0;</div>
<div class="line">current_solution         = predictor;</div>
<div class="line"><span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line">  {</div>
<div class="line">    system_matrix = 0;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a> = 0;</div>
<div class="line">    assemble_system();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> res_norm = <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>.l2_norm();</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(res_norm) &lt; 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-10)</div>
<div class="line">      {</div>
<div class="line">        std::printf(<span class="stringliteral">&quot;   %-16.3e (converged)\n\n&quot;</span>, res_norm);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        newton_update = 0;</div>
<div class="line"> </div>
<div class="line">        std::pair&lt;unsigned int, double&gt; <a class="code" href="solver__0_8txt.html#a06078ea1995fa54b715bee3b7745f08f">convergence</a> =</div>
<div class="line">          <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>(newton_update);</div>
<div class="line"> </div>
<div class="line">        current_solution += newton_update;</div>
<div class="line"> </div>
<div class="line">        std::printf(<span class="stringliteral">&quot;   %-16.3e %04d        %-5.2e\n&quot;</span>,</div>
<div class="line">                    res_norm,</div>
<div class="line">                    <a class="code" href="solver__0_8txt.html#a06078ea1995fa54b715bee3b7745f08f">convergence</a>.first,</div>
<div class="line">                    <a class="code" href="solver__0_8txt.html#a06078ea1995fa54b715bee3b7745f08f">convergence</a>.second);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    ++nonlin_iter;</div>
<div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(nonlin_iter &lt;= 10,</div>
<div class="line">                <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;No convergence in nonlinear solver&quot;</span>));</div>
<div class="line">  }</div>
</div><!-- fragment --><p>We only get to this point if the Newton iteration has converged, so do various post convergence tasks here:</p>
<p>First, we update the time and produce graphical output if so desired. Then we update a predictor for the solution at the next time step by approximating \(\mathbf w^{n+1}\approx \mathbf w^n + \delta t \frac{\partial \mathbf w}{\partial t} \approx \mathbf w^n + \delta t \; \frac{\mathbf w^n-\mathbf w^{n-1}}{\delta t} = 2 \mathbf w^n - \mathbf w^{n-1}\) to try and make adaptivity work better. The idea is to try and refine ahead of a front, rather than stepping into a coarse set of elements and smearing the old_solution. This simple time extrapolator does the job. With this, we then refine the mesh if so desired by the user, and finally continue on with the next time step:</p>
<div class="fragment"><div class="line">        <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a> += <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.time_step;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.output_step &lt; 0)</div>
<div class="line">          output_results();</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a> &gt;= next_output)</div>
<div class="line">          {</div>
<div class="line">            output_results();</div>
<div class="line">            next_output += <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.output_step;</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        predictor = current_solution;</div>
<div class="line">        predictor.sadd(2.0, -1.0, old_solution);</div>
<div class="line"> </div>
<div class="line">        old_solution = current_solution;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.do_refine == <span class="keyword">true</span>)</div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="classVector.html">Vector&lt;double&gt;</a> refinement_indicators(</div>
<div class="line">              <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells());</div>
<div class="line">            compute_refinement_indicators(refinement_indicators);</div>
<div class="line"> </div>
<div class="line">            refine_grid(refinement_indicators);</div>
<div class="line">            setup_system();</div>
<div class="line"> </div>
<div class="line">            newton_update.<a class="code" href="classVector.html#ac4a4dbef7dd65ef8ad35ae56b57d7c05">reinit</a>(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Step33</span></div>
</div><!-- fragment --><p><a class="anchor" id="main"></a> </p><h3><a class="el" href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main()</a></h3>
<p>The following `&lsquo;main&rsquo;' function is similar to previous examples and need not to be commented on. Note that the program aborts if no input file name is given on the command line.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line">      <span class="keyword">using namespace </span><a class="code" href="namespaceStep33.html">Step33</a>;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (argc != 2)</div>
<div class="line">        {</div>
<div class="line">          std::cout &lt;&lt; <span class="stringliteral">&quot;Usage:&quot;</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">&quot; input_file&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">          std::exit(1);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classUtilities_1_1MPI_1_1MPI__InitFinalize.html">Utilities::MPI::MPI_InitFinalize</a> mpi_initialization(</div>
<div class="line">        argc, argv, ::<a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>);</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classStep33_1_1ConservationLaw.html">ConservationLaw&lt;2&gt;</a> cons(argv[1]);</div>
<div class="line">      cons.run();</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (<a class="code" href="parameter__handler__0_8txt.html#ad919e2b915d8e8226aef004c2d8399a8">std::exception</a> &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p> <a class="anchor" id="Results"></a> <a class="anchor" id="Results"></a></p><h1>Results</h1>
<p>We run the problem with the mesh <code>slide.inp</code> (this file is in the same directory as the source code for this program) and the following input deck (available as <code>input.prm</code> in the same directory): </p><pre class="fragment"># Listing of Parameters
# ---------------------

# The input grid
set mesh = slide.inp

# Stabilization parameter
set diffusion power = 2.0

# --------------------------------------------------
# Boundary conditions
# We may specify boundary conditions for up to MAX_BD boundaries.
# Your .inp file should have these boundaries designated.
subsection boundary_1
  set no penetration = true # reflective boundary condition
end

subsection boundary_2
  # outflow boundary
  # set w_2 = pressure
  # set w_2 value = 1.5 - y
end

subsection boundary_3
  set no penetration = true # reflective
  # set w_3 = pressure
  # set w_3 value = 1.0
end

subsection boundary_4
  set no penetration = true #reflective
end

# --------------------------------------------------
# Initial Conditions
# We set the initial conditions of the conservative variables.  These lines
# are passed to the expression parsing function.  You should use x,y,z for
# the coordinate variables.

subsection initial condition
  set w_0 value = 0
  set w_1 value = 0
  set w_2 value = 10*(x&lt;-0.7)*(y&gt; 0.3)*(y&lt; 0.45) + (1-(x&lt;-0.7)*(y&gt; 0.3)*(y&lt; 0.45))*1.0
  set w_3 value = (1.5-(1.0*1.0*y))/0.4
end

# --------------------------------------------------
# Time stepping control
subsection time stepping
  set final time = 10.0 # simulation end time
  set time step  = 0.02 # simulation time step
  set theta scheme value = 0.5
end

subsection linear solver
  set output         = quiet
  set method         = gmres
  set ilut fill      = 1.5
  set ilut drop tolerance = 1e-6
  set ilut absolute tolerance = 1e-6
  set ilut relative tolerance = 1.0
end

# --------------------------------------------------
# Output frequency and kind
subsection output
  set step           = 0.01
  set schlieren plot = true
end

# --------------------------------------------------
# Refinement control
subsection refinement
  set refinement = true # none only other option
  set shock value = 1.5
  set shock levels = 1 # how many levels of refinement to allow
end

# --------------------------------------------------
# Flux parameters
subsection flux
 set stab = constant
 #set stab value = 1.0
end
</pre><p>When we run the program, we get the following kind of output: </p><pre class="fragment">...
T=0.14
   Number of active cells:       1807
   Number of degrees of freedom: 7696

   NonLin Res     Lin Iter       Lin Res
   _____________________________________
   7.015e-03        0008        3.39e-13
   2.150e-05        0008        1.56e-15
   2.628e-09        0008        5.09e-20
   5.243e-16        (converged)

T=0.16
   Number of active cells:       1807
   Number of degrees of freedom: 7696

   NonLin Res     Lin Iter       Lin Res
   _____________________________________
   7.145e-03        0008        3.80e-13
   2.548e-05        0008        7.20e-16
   4.063e-09        0008        2.49e-19
   5.970e-16        (converged)

T=0.18
   Number of active cells:       1807
   Number of degrees of freedom: 7696

   NonLin Res     Lin Iter       Lin Res
   _____________________________________
   7.395e-03        0008        6.69e-13
   2.867e-05        0008        1.33e-15
   4.091e-09        0008        3.35e-19
   5.617e-16        (converged)
...
</pre><p>This output reports the progress of the Newton iterations and the time stepping. Note that our implementation of the Newton iteration indeed shows the expected quadratic convergence order: the norm of the nonlinear residual in each step is roughly the norm of the previous step squared. This leads to the very rapid convergence we can see here. This holds until times up to \(t=1.9\) at which time the nonlinear iteration reports a lack of convergence: </p><pre class="fragment">...

T=1.88
   Number of active cells:       2119
   Number of degrees of freedom: 9096

   NonLin Res     Lin Iter       Lin Res
   _____________________________________
   2.251e-01        0012        9.78e-12
   5.698e-03        0012        2.04e-13
   3.896e-05        0012        1.48e-15
   3.915e-09        0012        1.94e-19
   8.800e-16        (converged)

T=1.9
   Number of active cells:       2140
   Number of degrees of freedom: 9184

   NonLin Res     Lin Iter       Lin Res
   _____________________________________
   2.320e-01        0013        3.94e-12
   1.235e-01        0016        6.62e-12
   8.494e-02        0016        6.05e-12
   1.199e+01        0026        5.72e-10
   1.198e+03        0002        1.20e+03
   7.030e+03        0001        nan
   7.030e+03        0001        nan
   7.030e+03        0001        nan
   7.030e+03        0001        nan
   7.030e+03        0001        nan
   7.030e+03        0001        nan


----------------------------------------------------
Exception on processing:

--------------------------------------------------------
An error occurred in line &lt;2476&gt; of file &lt;step-33.cc&gt; in function
    void Step33::ConservationLaw&lt;dim&gt;::run() [with int dim = 2]
The violated condition was:
    nonlin_iter &lt;= 10
The name and call sequence of the exception was:
    ExcMessage ("No convergence in nonlinear solver")
Additional Information:
No convergence in nonlinear solver
--------------------------------------------------------

Aborting!
----------------------------------------------------
</pre><p>We may find out the cause and possible remedies by looking at the animation of the solution.</p>
<p>The result of running these computations is a bunch of output files that we can pass to our visualization program of choice. When we collate them into a movie, the results of last several time steps looks like this:</p>
<p><img src="https://www.dealii.org/images/steps/developer/step-33.oscillation.gif " alt="" height="300" class="inline"/></p>
<p>As we see, when the heavy mass of fluid hits the left bottom corner, some oscillation occurs and lead to the divergence of the iteration. A lazy solution to this issue is add more viscosity. If we set the diffusion power \(\eta = 1.5\) instead of \(2.0\), the simulation would be able to survive this crisis. Then, the result looks like this:</p>
<p><img src="https://www.dealii.org/images/steps/developer/step-33.slide.ed2.gif " alt="" height="300" class="inline"/></p>
<p>The heavy mass of fluid is drawn down the slope by gravity, where it collides with the ski lodge and is flung into the air! Hopefully everyone escapes! And also, we can see the boundary between heavy mass and light mass blur quickly due to the artificial viscosity.</p>
<p>We can also visualize the evolution of the adaptively refined grid:</p>
<p><img src="https://www.dealii.org/images/steps/developer/step-33.slide.adapt.ed2.gif " alt="" height="300" class="inline"/></p>
<p>The adaptivity follows and precedes the flow pattern, based on the heuristic refinement scheme discussed above.</p>
<p><a class="anchor" id="extensions"></a> <a class="anchor" id="Possibilitiesforextensions"></a></p><h3>Possibilities for extensions</h3>
<p><a class="anchor" id="Stabilization"></a></p><h4>Stabilization</h4>
<p>The numerical scheme we have chosen is not particularly stable when the artificial viscosity is small while is too diffusive when the artificial viscosity is large. Furthermore, it is known there are more advanced techniques to stabilize the solution, for example streamline diffusion, least-squares stabilization terms, entropy viscosity.</p>
<p><a class="anchor" id="Betterlinearsolvers"></a></p><h4>Better linear solvers</h4>
<p>While the Newton method as a nonlinear solver appears to work very well if the time step is small enough, the linear solver can be improved. For example, in the current scheme whenever we use an iterative solver, an ILU is computed anew for each Newton step; likewise, for the direct solver, an LU decomposition of the Newton matrix is computed in each step. This is obviously wasteful: from one Newton step to another, and probably also between time steps, the Newton matrix does not radically change: an ILU or a sparse LU decomposition for one Newton step is probably still a very good preconditioner for the next Newton or time step. Avoiding the recomputation would therefore be a good way to reduce the amount of compute time.</p>
<p>One could drive this a step further: since close to convergence the Newton matrix changes only a little bit, one may be able to define a quasi-Newton scheme where we only re-compute the residual (i.e. the right hand side vector) in each Newton iteration, and re-use the Newton matrix. The resulting scheme will likely not be of quadratic convergence order, and we have to expect to do a few more nonlinear iterations; however, given that we don't have to spend the time to build the Newton matrix each time, the resulting scheme may well be faster.</p>
<p><a class="anchor" id="Cachetheexplicitpartofresidual"></a></p><h4>Cache the explicit part of residual</h4>
<p>The residual calculated in ConservationLaw::assemble_cell_term function reads \(R_i = \left(\frac{\mathbf{w}^{k}_{n+1} - \mathbf{w}_n}{\delta t} , \mathbf{z}_i \right)_K + \theta \mathbf{B}({\mathbf{w}^{k}_{n+1}})(\mathbf{z}_i)_K + (1-\theta) \mathbf{B}({\mathbf{w}_{n}}) (\mathbf{z}_i)_K \) This means that we calculate the spatial residual twice at one Newton iteration step: once respect to the current solution \(\mathbf{w}^{k}_{n+1}\) and once more respect to the last time step solution \(\mathbf{w}_{n}\) which remains the same during all Newton iterations through one timestep. Cache up the explicit part of residual \( \mathbf{B}({\mathbf{w}_{n}}) (\mathbf{z}_i)_K\) during Newton iteration will save lots of labor.</p>
<p><a class="anchor" id="Otherconservationlaws"></a></p><h4>Other conservation laws</h4>
<p>Finally, as a direction beyond the immediate solution of the Euler equations, this program tries very hard to separate the implementation of everything that is specific to the Euler equations into one class (the <code>EulerEquation</code> class), and everything that is specific to assembling the matrices and vectors, nonlinear and linear solvers, and the general top-level logic into another (the <code>ConservationLaw</code> class).</p>
<p>By replacing the definitions of flux matrices and numerical fluxes in this class, as well as the various other parts defined there, it should be possible to apply the <code>ConservationLaw</code> class to other hyperbolic conservation laws as well.</p>
<p><a class="anchor" id="PlainProg"></a> </p><h1>The plain program</h1>
<div class="fragment"><div class="line"><span class="comment">/* ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2007 - 2021 by the deal.II authors</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file is part of the deal.II library.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The deal.II library is free software; you can use it, redistribute</span></div>
<div class="line"><span class="comment"> * it, and/or modify it under the terms of the GNU Lesser General</span></div>
<div class="line"><span class="comment"> * Public License as published by the Free Software Foundation; either</span></div>
<div class="line"><span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><span class="comment"> * The full text of the license can be found in the file LICENSE.md at</span></div>
<div class="line"><span class="comment"> * the top level directory of deal.II.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Author: David Neckels, Boulder, Colorado, 2007, 2008</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2parameter__handler_8h.html">deal.II/base/parameter_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2function__parser_8h.html">deal.II/base/function_parser.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="include_2deal_8II_2base_2utilities_8h.html">deal.II/base/utilities.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2conditional__ostream_8h.html">deal.II/base/conditional_ostream.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2vector_8h.html">deal.II/lac/vector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__out_8h.html">deal.II/grid/grid_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__refinement_8h.html">deal.II/grid/grid_refinement.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__in_8h.html">deal.II/grid/grid_in.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__values_8h.html">deal.II/fe/fe_values.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__system_8h.html">deal.II/fe/fe_system.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2mapping__q1_8h.html">deal.II/fe/mapping_q1.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2solution__transfer_8h.html">deal.II/numerics/solution_transfer.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2trilinos__sparse__matrix_8h.html">deal.II/lac/trilinos_sparse_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2trilinos__precondition_8h.html">deal.II/lac/trilinos_precondition.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2trilinos__solver_8h.html">deal.II/lac/trilinos_solver.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;Sacado.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;array&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceStep33.html">Step33</a></div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">struct </span>EulerEquations</div>
<div class="line">  {</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>             = <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> + 2;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> first_momentum_component = 0;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> density_component        = <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> energy_component         = <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> + 1;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> std::vector&lt;std::string&gt; component_names()</div>
<div class="line">    {</div>
<div class="line">      std::vector&lt;std::string&gt; <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>(<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>, <span class="stringliteral">&quot;momentum&quot;</span>);</div>
<div class="line">      <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>.emplace_back(<span class="stringliteral">&quot;density&quot;</span>);</div>
<div class="line">      <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>.emplace_back(<span class="stringliteral">&quot;energy_density&quot;</span>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">return</span> <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">    component_interpretation()</div>
<div class="line">    {</div>
<div class="line">      std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">        data_component_interpretation(</div>
<div class="line">          <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>, <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a9b7d9c85221484e1998f6869d98cba8b">DataComponentInterpretation::component_is_part_of_vector</a>);</div>
<div class="line">      data_component_interpretation.push_back(</div>
<div class="line">        <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa4924d31df0211f3fb9db3bbe1af0d1c">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line">      data_component_interpretation.push_back(</div>
<div class="line">        <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa4924d31df0211f3fb9db3bbe1af0d1c">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">return</span> data_component_interpretation;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> gas_gamma;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">typename</span> InputVector::value_type</div>
<div class="line">    compute_kinetic_energy(<span class="keyword">const</span> InputVector &amp;W)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">typename</span> InputVector::value_type kinetic_energy = 0;</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">        kinetic_energy +=</div>
<div class="line">          W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] * W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line">      kinetic_energy *= 1. / (2 * W[density_component]);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">return</span> kinetic_energy;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">typename</span> InputVector::value_type</div>
<div class="line">    compute_pressure(<span class="keyword">const</span> InputVector &amp;W)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">return</span> ((gas_gamma - 1.0) *</div>
<div class="line">              (W[energy_component] - compute_kinetic_energy(W)));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> compute_flux_matrix(<span class="keyword">const</span> InputVector &amp;W,</div>
<div class="line">                                    <a class="code" href="base_2ndarray_8h.html#a82399009710c9549884b9d8c506ad695">ndarray</a>&lt;<span class="keyword">typename</span> InputVector::value_type,</div>
<div class="line">                                            <a class="code" href="structStep33_1_1EulerEquations.html#a3b7415438757860701ee1e3ede1ee6ae">EulerEquations&lt;dim&gt;::n_components</a>,</div>
<div class="line">                                            <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt; &amp;     <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keyword">typename</span> InputVector::value_type <a class="code" href="mg__transfer__0_8txt.html#a6b401cd9c6154fc787311f58ab910002">pressure</a> = compute_pressure(W);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">        {</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a> = 0; <a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>)</div>
<div class="line">            <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>][<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>] =</div>
<div class="line">              W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] *</div>
<div class="line">              W[first_momentum_component + <a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>] / W[density_component];</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] += <a class="code" href="mg__transfer__0_8txt.html#a6b401cd9c6154fc787311f58ab910002">pressure</a>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">        <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>[density_component][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] = W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">        <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>[energy_component][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] = W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] /</div>
<div class="line">                                    W[density_component] *</div>
<div class="line">                                    (W[energy_component] + <a class="code" href="mg__transfer__0_8txt.html#a6b401cd9c6154fc787311f58ab910002">pressure</a>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> numerical_normal_flux(</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> &amp;                                      <a class="code" href="global__dof__index__0_8txt.html#a2b84b1d42e4fde15bdf79726ce1cc907">normal</a>,</div>
<div class="line">      <span class="keyword">const</span> InputVector &amp;                                         Wplus,</div>
<div class="line">      <span class="keyword">const</span> InputVector &amp;                                         Wminus,</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span>                                                <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>,</div>
<div class="line">      std::array&lt;typename InputVector::value_type, n_components&gt; &amp;normal_flux)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="base_2ndarray_8h.html#a82399009710c9549884b9d8c506ad695">ndarray</a>&lt;<span class="keyword">typename</span> InputVector::value_type,</div>
<div class="line">              <a class="code" href="structStep33_1_1EulerEquations.html#a3b7415438757860701ee1e3ede1ee6ae">EulerEquations&lt;dim&gt;::n_components</a>,</div>
<div class="line">              <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;</div>
<div class="line">        iflux, oflux;</div>
<div class="line"> </div>
<div class="line">      compute_flux_matrix(Wplus, iflux);</div>
<div class="line">      compute_flux_matrix(Wminus, oflux);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; di &lt; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>; ++di)</div>
<div class="line">        {</div>
<div class="line">          normal_flux[di] = 0;</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">            normal_flux[di] += 0.5 * (iflux[di][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] + oflux[di][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>]) * <a class="code" href="global__dof__index__0_8txt.html#a2b84b1d42e4fde15bdf79726ce1cc907">normal</a>[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line"> </div>
<div class="line">          normal_flux[di] += 0.5 * <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a> * (Wplus[di] - Wminus[di]);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> compute_forcing_vector(</div>
<div class="line">      <span class="keyword">const</span> InputVector &amp;                                         W,</div>
<div class="line">      std::array&lt;typename InputVector::value_type, n_components&gt; &amp;forcing)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> gravity = -1.0;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a> = 0; <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a> &lt; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>; ++<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>)</div>
<div class="line">        <span class="keywordflow">switch</span> (<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>)</div>
<div class="line">          {</div>
<div class="line">            <span class="keywordflow">case</span> first_momentum_component + <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> - 1:</div>
<div class="line">              forcing[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = gravity * W[density_component];</div>
<div class="line">              <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> energy_component:</div>
<div class="line">              forcing[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = gravity * W[first_momentum_component + <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> - 1];</div>
<div class="line">              <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">default</span>:</div>
<div class="line">              forcing[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = 0;</div>
<div class="line">          }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">enum</span> BoundaryKind</div>
<div class="line">    {</div>
<div class="line">      inflow_boundary,</div>
<div class="line">      outflow_boundary,</div>
<div class="line">      no_penetration_boundary,</div>
<div class="line">      pressure_boundary</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataVector&gt;</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">    compute_Wminus(<span class="keyword">const</span> std::array&lt;BoundaryKind, n_components&gt; &amp;boundary_kind,</div>
<div class="line">                   <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> &amp;                        normal_vector,</div>
<div class="line">                   <span class="keyword">const</span> DataVector &amp;                            Wplus,</div>
<div class="line">                   <span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;boundary_values,</div>
<div class="line">                   <span class="keyword">const</span> DataVector &amp;    Wminus)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a> = 0; <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a> &lt; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>; <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>++)</div>
<div class="line">        <span class="keywordflow">switch</span> (boundary_kind[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>])</div>
<div class="line">          {</div>
<div class="line">            <span class="keywordflow">case</span> inflow_boundary:</div>
<div class="line">              {</div>
<div class="line">                Wminus[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = boundary_values(<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">case</span> outflow_boundary:</div>
<div class="line">              {</div>
<div class="line">                Wminus[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = Wplus[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>];</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">case</span> pressure_boundary:</div>
<div class="line">              {</div>
<div class="line">                <span class="keyword">const</span> <span class="keyword">typename</span> DataVector::value_type <a class="code" href="namespaceStep31_1_1EquationData.html#aa1e9e1a7297b10cb39c2065f86acc66f">density</a> =</div>
<div class="line">                  (boundary_kind[density_component] == inflow_boundary ?</div>
<div class="line">                     boundary_values(density_component) :</div>
<div class="line">                     Wplus[density_component]);</div>
<div class="line"> </div>
<div class="line">                <span class="keyword">typename</span> DataVector::value_type kinetic_energy = 0;</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">                  <span class="keywordflow">if</span> (boundary_kind[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] == inflow_boundary)</div>
<div class="line">                    kinetic_energy += boundary_values(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>) * boundary_values(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>);</div>
<div class="line">                  <span class="keywordflow">else</span></div>
<div class="line">                    kinetic_energy += Wplus[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] * Wplus[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line">                kinetic_energy *= 1. / 2. / <a class="code" href="namespaceStep31_1_1EquationData.html#aa1e9e1a7297b10cb39c2065f86acc66f">density</a>;</div>
<div class="line"> </div>
<div class="line">                Wminus[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] =</div>
<div class="line">                  boundary_values(<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>) / (gas_gamma - 1.0) + kinetic_energy;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">case</span> no_penetration_boundary:</div>
<div class="line">              {</div>
<div class="line">                <span class="keyword">typename</span> DataVector::value_type vdotn = 0;</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>++)</div>
<div class="line">                  {</div>
<div class="line">                    vdotn += Wplus[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] * normal_vector[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line">                  }</div>
<div class="line"> </div>
<div class="line">                Wminus[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = Wplus[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] - 2.0 * vdotn * normal_vector[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>];</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">default</span>:</div>
<div class="line">              <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">          }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">    compute_refinement_indicators(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div>
<div class="line">                                  <span class="keyword">const</span> <a class="code" href="classMapping.html">Mapping&lt;dim&gt;</a> &amp;   <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                  <span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp; <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>,</div>
<div class="line">                                  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;       refinement_indicators)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> = dof_handler.<a class="code" href="classDoFHandler.html#ac1fedeb50b5f03b13d8b69f86e33f726">get_fe</a>().<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>();</div>
<div class="line">      std::vector&lt;unsigned int&gt; <a class="code" href="distributed__0_8txt.html#ad207fe81a5be05e18534713c2677da7b">dofs</a>(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classQMidpoint.html">QMidpoint&lt;dim&gt;</a> quadrature_formula;</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>    update_flags = <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a>;</div>
<div class="line">      <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>        fe_v(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                         dof_handler.<a class="code" href="classDoFHandler.html#ac1fedeb50b5f03b13d8b69f86e33f726">get_fe</a>(),</div>
<div class="line">                         quadrature_formula,</div>
<div class="line">                         update_flags);</div>
<div class="line"> </div>
<div class="line">      std::vector&lt;std::vector&lt;Tensor&lt;1, dim&gt;&gt;&gt; dU(</div>
<div class="line">        1, <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a>&gt;(<a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>));</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell_no = <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;active_cell_index();</div>
<div class="line">          fe_v.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line">          fe_v.<a class="code" href="classFEValuesBase.html#ad1f4e0deb5d982e8172d82141c634a67">get_function_gradients</a>(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, dU);</div>
<div class="line"> </div>
<div class="line">          refinement_indicators(cell_no) = <a class="code" href="base_2vectorization_8h.html#a2aa674852f105b0ed1b35f569c19fea6">std::log</a>(</div>
<div class="line">            1 + <a class="code" href="solver__cg__0_8txt.html#a557c71e94a2542d697ca3426b8843cd4">std::sqrt</a>(dU[0][density_component] * dU[0][density_component]));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">class </span>Postprocessor : <span class="keyword">public</span> <a class="code" href="classDataPostprocessor.html">DataPostprocessor</a>&lt;dim&gt;</div>
<div class="line">    {</div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">      Postprocessor(<span class="keyword">const</span> <span class="keywordtype">bool</span> do_schlieren_plot);</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">virtual</span> <span class="keywordtype">void</span> evaluate_vector_field(</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="structDataPostprocessorInputs_1_1Vector.html">DataPostprocessorInputs::Vector&lt;dim&gt;</a> &amp;inputs,</div>
<div class="line">        <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt; &amp;computed_quantities) <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">virtual</span> std::vector&lt;std::string&gt; <a class="code" href="data__postprocessor__0_8txt.html#afb21caeba7bf26aba89ce705266fedb1">get_names</a>() <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">virtual</span> <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;</div>
<div class="line">        <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0">DataComponentInterpretation::DataComponentInterpretation</a>&gt;</div>
<div class="line">      get_data_component_interpretation() <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">virtual</span> <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> <a class="code" href="data__postprocessor__0_8txt.html#abfdf708e97518fa7ad2b849b80afddc1">get_needed_update_flags</a>() <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">private</span>:</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">bool</span> do_schlieren_plot;</div>
<div class="line">    };</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="structStep33_1_1EulerEquations.html#a2070ab9564d2cc45fe65357c1bc914e8">EulerEquations&lt;dim&gt;::gas_gamma</a> = 1.4;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <a class="code" href="classStep33_1_1EulerEquations_1_1Postprocessor.html#adae3bcb8efa74ec959ac0c065c8eea9b">EulerEquations&lt;dim&gt;::Postprocessor::Postprocessor</a>(</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> do_schlieren_plot)</div>
<div class="line">    : do_schlieren_plot(do_schlieren_plot)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> EulerEquations&lt;dim&gt;::Postprocessor::evaluate_vector_field(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="structDataPostprocessorInputs_1_1Vector.html">DataPostprocessorInputs::Vector&lt;dim&gt;</a> &amp;inputs,</div>
<div class="line">    <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt; &amp;               computed_quantities)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_quadrature_points = inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a904b46a59d224ec214e4816e584cba5f">solution_values</a>.size();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a2a918d936d56f2be4cdad1b8074c3a86">solution_gradients</a>.size() == n_quadrature_points,</div>
<div class="line">             <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(computed_quantities.size() == n_quadrature_points,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a904b46a59d224ec214e4816e584cba5f">solution_values</a>[0].size() == <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(computed_quantities[0].<a class="code" href="function__0_8txt.html#a4f780342f2d5d632f82cf7fd90158a66">size</a>() == <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> + 2, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(computed_quantities[0].<a class="code" href="function__0_8txt.html#a4f780342f2d5d632f82cf7fd90158a66">size</a>() == <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> + 1, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_quadrature_points; ++q)</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespaceStep31_1_1EquationData.html#aa1e9e1a7297b10cb39c2065f86acc66f">density</a> = inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a904b46a59d224ec214e4816e584cba5f">solution_values</a>[q](density_component);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">          computed_quantities[q](<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>) =</div>
<div class="line">            inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a904b46a59d224ec214e4816e584cba5f">solution_values</a>[q](first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>) / <a class="code" href="namespaceStep31_1_1EquationData.html#aa1e9e1a7297b10cb39c2065f86acc66f">density</a>;</div>
<div class="line"> </div>
<div class="line">        computed_quantities[q](<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>) =</div>
<div class="line">          compute_pressure(inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a904b46a59d224ec214e4816e584cba5f">solution_values</a>[q]);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">          computed_quantities[q](<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> + 1) =</div>
<div class="line">            inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a2a918d936d56f2be4cdad1b8074c3a86">solution_gradients</a>[q][density_component] *</div>
<div class="line">            inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a2a918d936d56f2be4cdad1b8074c3a86">solution_gradients</a>[q][density_component];</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  std::vector&lt;std::string&gt; <a class="code" href="data__postprocessor__0_8txt.html#afb21caeba7bf26aba89ce705266fedb1">EulerEquations&lt;dim&gt;::Postprocessor::get_names</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    std::vector&lt;std::string&gt; <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">      <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>.emplace_back(<span class="stringliteral">&quot;velocity&quot;</span>);</div>
<div class="line">    <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>.emplace_back(<span class="stringliteral">&quot;pressure&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">      <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>.emplace_back(<span class="stringliteral">&quot;schlieren_plot&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">  EulerEquations&lt;dim&gt;::Postprocessor::get_data_component_interpretation()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">      interpretation(<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>,</div>
<div class="line">                     <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a9b7d9c85221484e1998f6869d98cba8b">DataComponentInterpretation::component_is_part_of_vector</a>);</div>
<div class="line"> </div>
<div class="line">    interpretation.push_back(<a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa4924d31df0211f3fb9db3bbe1af0d1c">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">      interpretation.push_back(</div>
<div class="line">        <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa4924d31df0211f3fb9db3bbe1af0d1c">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> interpretation;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a></div>
<div class="line">  <a class="code" href="data__postprocessor__0_8txt.html#abfdf708e97518fa7ad2b849b80afddc1">EulerEquations&lt;dim&gt;::Postprocessor::get_needed_update_flags</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">      <span class="keywordflow">return</span> <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a>;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      <span class="keywordflow">return</span> <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">namespace </span>Parameters</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">struct </span>Solver</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">enum</span> <a class="code" href="namespaceStep56.html#a3c2f04c8033af75ffedd7bfbf96640a1">SolverType</a></div>
<div class="line">      {</div>
<div class="line">        gmres,</div>
<div class="line">        direct</div>
<div class="line">      };</div>
<div class="line">      <a class="code" href="namespaceStep56.html#a3c2f04c8033af75ffedd7bfbf96640a1">SolverType</a> <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">enum</span> OutputType</div>
<div class="line">      {</div>
<div class="line">        quiet,</div>
<div class="line">        verbose</div>
<div class="line">      };</div>
<div class="line">      OutputType <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">double</span> linear_residual;</div>
<div class="line">      <span class="keywordtype">int</span>    max_iterations;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">double</span> ilut_fill;</div>
<div class="line">      <span class="keywordtype">double</span> ilut_atol;</div>
<div class="line">      <span class="keywordtype">double</span> ilut_rtol;</div>
<div class="line">      <span class="keywordtype">double</span> ilut_drop;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">      <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Solver::declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;linear solver&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(</div>
<div class="line">          <span class="stringliteral">&quot;output&quot;</span>,</div>
<div class="line">          <span class="stringliteral">&quot;quiet&quot;</span>,</div>
<div class="line">          <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;quiet|verbose&quot;</span>),</div>
<div class="line">          <span class="stringliteral">&quot;State whether output from solver runs should be printed. &quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;Choices are &lt;quiet|verbose&gt;.&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;method&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;gmres&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;gmres|direct&quot;</span>),</div>
<div class="line">                          <span class="stringliteral">&quot;The kind of solver for the linear system. &quot;</span></div>
<div class="line">                          <span class="stringliteral">&quot;Choices are &lt;gmres|direct&gt;.&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;residual&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;1e-10&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Linear solver residual&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;max iters&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;300&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Maximum solver iterations&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;ilut fill&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Ilut preconditioner fill&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;ilut absolute tolerance&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;1e-9&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Ilut preconditioner tolerance&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;ilut relative tolerance&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;1.1&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Ilut relative tolerance&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;ilut drop tolerance&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;1e-10&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Ilut drop tolerance&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Solver::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;linear solver&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> std::string op = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;output&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (op == <span class="stringliteral">&quot;verbose&quot;</span>)</div>
<div class="line">          <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a> = verbose;</div>
<div class="line">        <span class="keywordflow">if</span> (op == <span class="stringliteral">&quot;quiet&quot;</span>)</div>
<div class="line">          <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a> = quiet;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> std::string sv = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;method&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (sv == <span class="stringliteral">&quot;direct&quot;</span>)</div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a> = direct;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sv == <span class="stringliteral">&quot;gmres&quot;</span>)</div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a> = gmres;</div>
<div class="line"> </div>
<div class="line">        linear_residual = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;residual&quot;</span>);</div>
<div class="line">        max_iterations  = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;max iters&quot;</span>);</div>
<div class="line">        ilut_fill       = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;ilut fill&quot;</span>);</div>
<div class="line">        ilut_atol       = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;ilut absolute tolerance&quot;</span>);</div>
<div class="line">        ilut_rtol       = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;ilut relative tolerance&quot;</span>);</div>
<div class="line">        ilut_drop       = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;ilut drop tolerance&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>Refinement</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordtype">bool</span>   do_refine;</div>
<div class="line">      <span class="keywordtype">double</span> shock_val;</div>
<div class="line">      <span class="keywordtype">double</span> shock_levels;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">      <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Refinement::declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;refinement&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;refinement&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Whether to perform mesh refinement or not&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;refinement fraction&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;0.1&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Fraction of high refinement&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;unrefinement fraction&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;0.1&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Fraction of low unrefinement&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;max elements&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;1000000&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;maximum number of elements&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;shock value&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;4.0&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;value for shock indicator&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;shock levels&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;3.0&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;number of shock refinement levels&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Refinement::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;refinement&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        do_refine    = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;refinement&quot;</span>);</div>
<div class="line">        shock_val    = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;shock value&quot;</span>);</div>
<div class="line">        shock_levels = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;shock levels&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>Flux</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">enum</span> StabilizationKind</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="fe__dgp__nonparametric__0_8txt.html#a8290746300287635d0fe47e4071ea1ef">constant</a>,</div>
<div class="line">        mesh_dependent</div>
<div class="line">      };</div>
<div class="line">      StabilizationKind stabilization_kind;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">double</span> stabilization_value;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">      <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Flux::declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;flux&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(</div>
<div class="line">          <span class="stringliteral">&quot;stab&quot;</span>,</div>
<div class="line">          <span class="stringliteral">&quot;mesh&quot;</span>,</div>
<div class="line">          <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;constant|mesh&quot;</span>),</div>
<div class="line">          <span class="stringliteral">&quot;Whether to use a constant stabilization parameter or &quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;a mesh-dependent one&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;stab value&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;1&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;alpha stabilization&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Flux::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;flux&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> std::string stab = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;stab&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (stab == <span class="stringliteral">&quot;constant&quot;</span>)</div>
<div class="line">          stabilization_kind = <a class="code" href="fe__dgp__nonparametric__0_8txt.html#a8290746300287635d0fe47e4071ea1ef">constant</a>;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stab == <span class="stringliteral">&quot;mesh&quot;</span>)</div>
<div class="line">          stabilization_kind = mesh_dependent;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line"> </div>
<div class="line">        stabilization_value = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;stab value&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>Output</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordtype">bool</span>   schlieren_plot;</div>
<div class="line">      <span class="keywordtype">double</span> output_step;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">      <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Output::declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;output&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;schlieren plot&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Whether or not to produce schlieren plots&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;step&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;-1&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Output once per this period&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Output::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;output&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        schlieren_plot = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;schlieren plot&quot;</span>);</div>
<div class="line">        output_step    = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;step&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">    <span class="keyword">struct </span>AllParameters : <span class="keyword">public</span> Solver,</div>
<div class="line">                           <span class="keyword">public</span> Refinement,</div>
<div class="line">                           <span class="keyword">public</span> Flux,</div>
<div class="line">                           <span class="keyword">public</span> Output</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_n_boundaries = 10;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">struct </span>BoundaryConditions</div>
<div class="line">      {</div>
<div class="line">        std::array&lt;typename EulerEquations&lt;dim&gt;::BoundaryKind,</div>
<div class="line">                   <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>&gt;</div>
<div class="line">          <a class="code" href="mapping__0_8txt.html#a334bdbfb52225fe249c8d336acfab3e6">kind</a>;</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classFunctionParser.html">FunctionParser&lt;dim&gt;</a> <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>;</div>
<div class="line"> </div>
<div class="line">        BoundaryConditions();</div>
<div class="line">      };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      AllParameters();</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">double</span> diffusion_power;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">double</span> time_step, <a class="code" href="namespaceEuler__DG.html#ae1cc4c5ec49b9998f5dc924707c29ed4">final_time</a>;</div>
<div class="line">      <span class="keywordtype">double</span> theta;</div>
<div class="line">      <span class="keywordtype">bool</span>   is_stationary;</div>
<div class="line"> </div>
<div class="line">      std::string mesh_filename;</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classFunctionParser.html">FunctionParser&lt;dim&gt;</a> initial_conditions;</div>
<div class="line">      BoundaryConditions  boundary_conditions[max_n_boundaries];</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">      <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">    AllParameters&lt;dim&gt;::BoundaryConditions::BoundaryConditions()</div>
<div class="line">      : <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>(EulerEquations&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;::<a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="convergence__table__0_8txt.html#a37c53a384d86a02751b04a0a89820c55">std::fill</a>(<a class="code" href="mapping__0_8txt.html#a334bdbfb52225fe249c8d336acfab3e6">kind</a>.begin(),</div>
<div class="line">                <a class="code" href="mapping__0_8txt.html#a334bdbfb52225fe249c8d336acfab3e6">kind</a>.end(),</div>
<div class="line">                EulerEquations&lt;dim&gt;::no_penetration_boundary);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">    AllParameters&lt;dim&gt;::AllParameters()</div>
<div class="line">      : diffusion_power(0.)</div>
<div class="line">      , time_step(1.)</div>
<div class="line">      , <a class="code" href="namespaceEuler__DG.html#ae1cc4c5ec49b9998f5dc924707c29ed4">final_time</a>(1.)</div>
<div class="line">      , theta(.5)</div>
<div class="line">      , is_stationary(<a class="code" href="event__0_8txt.html#a60053d8ff825674cfcc1321aba229cd7">true</a>)</div>
<div class="line">      , initial_conditions(EulerEquations&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;::<a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">AllParameters&lt;dim&gt;::declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;mesh&quot;</span>,</div>
<div class="line">                        <span class="stringliteral">&quot;grid.inp&quot;</span>,</div>
<div class="line">                        <a class="code" href="classPatterns_1_1Anything.html">Patterns::Anything</a>(),</div>
<div class="line">                        <span class="stringliteral">&quot;input file name&quot;</span>);</div>
<div class="line"> </div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;diffusion power&quot;</span>,</div>
<div class="line">                        <span class="stringliteral">&quot;2.0&quot;</span>,</div>
<div class="line">                        <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                        <span class="stringliteral">&quot;power of mesh size for diffusion&quot;</span>);</div>
<div class="line"> </div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;time stepping&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;time step&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;0.1&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0),</div>
<div class="line">                          <span class="stringliteral">&quot;simulation time step&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;final time&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;10.0&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0),</div>
<div class="line">                          <span class="stringliteral">&quot;simulation end time&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;theta scheme value&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;0.5&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0, 1),</div>
<div class="line">                          <span class="stringliteral">&quot;value for theta that interpolated between explicit &quot;</span></div>
<div class="line">                          <span class="stringliteral">&quot;Euler (theta=0), Crank-Nicolson (theta=0.5), and &quot;</span></div>
<div class="line">                          <span class="stringliteral">&quot;implicit Euler (theta=1).&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a> = 0; <a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a> &lt; max_n_boundaries; ++<a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a>)</div>
<div class="line">        {</div>
<div class="line">          prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;boundary_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(<a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a>));</div>
<div class="line">          {</div>
<div class="line">            prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;no penetration&quot;</span>,</div>
<div class="line">                              <span class="stringliteral">&quot;false&quot;</span>,</div>
<div class="line">                              <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                              <span class="stringliteral">&quot;whether the named boundary allows gas to &quot;</span></div>
<div class="line">                              <span class="stringliteral">&quot;penetrate or is a rigid wall&quot;</span>);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">di &lt; EulerEquations&lt;dim&gt;::n_components</a>;</div>
<div class="line">                 ++di)</div>
<div class="line">              {</div>
<div class="line">                prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di),</div>
<div class="line">                                  <span class="stringliteral">&quot;outflow&quot;</span>,</div>
<div class="line">                                  <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(</div>
<div class="line">                                    <span class="stringliteral">&quot;inflow|outflow|pressure&quot;</span>),</div>
<div class="line">                                  <span class="stringliteral">&quot;&lt;inflow|outflow|pressure&gt;&quot;</span>);</div>
<div class="line"> </div>
<div class="line">                prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di) +</div>
<div class="line">                                    <span class="stringliteral">&quot; value&quot;</span>,</div>
<div class="line">                                  <span class="stringliteral">&quot;0.0&quot;</span>,</div>
<div class="line">                                  <a class="code" href="classPatterns_1_1Anything.html">Patterns::Anything</a>(),</div>
<div class="line">                                  <span class="stringliteral">&quot;expression in x,y,z&quot;</span>);</div>
<div class="line">              }</div>
<div class="line">          }</div>
<div class="line">          prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;initial condition&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">di &lt; EulerEquations&lt;dim&gt;::n_components</a>; ++di)</div>
<div class="line">          prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di) + <span class="stringliteral">&quot; value&quot;</span>,</div>
<div class="line">                            <span class="stringliteral">&quot;0.0&quot;</span>,</div>
<div class="line">                            <a class="code" href="classPatterns_1_1Anything.html">Patterns::Anything</a>(),</div>
<div class="line">                            <span class="stringliteral">&quot;expression in x,y,z&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Parameters::Solver::declare_parameters</a>(prm);</div>
<div class="line">      <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Parameters::Refinement::declare_parameters</a>(prm);</div>
<div class="line">      <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Parameters::Flux::declare_parameters</a>(prm);</div>
<div class="line">      <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Parameters::Output::declare_parameters</a>(prm);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">    <span class="keywordtype">void</span> AllParameters&lt;dim&gt;::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      mesh_filename   = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;mesh&quot;</span>);</div>
<div class="line">      diffusion_power = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;diffusion power&quot;</span>);</div>
<div class="line"> </div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;time stepping&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        time_step = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;time step&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (time_step == 0)</div>
<div class="line">          {</div>
<div class="line">            is_stationary = <span class="keyword">true</span>;</div>
<div class="line">            time_step     = 1.0;</div>
<div class="line">            <a class="code" href="namespaceEuler__DG.html#ae1cc4c5ec49b9998f5dc924707c29ed4">final_time</a>    = 1.0;</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          is_stationary = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespaceEuler__DG.html#ae1cc4c5ec49b9998f5dc924707c29ed4">final_time</a> = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;final time&quot;</span>);</div>
<div class="line">        theta      = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;theta scheme value&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a> = 0; <a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a> &lt; max_n_boundaries;</div>
<div class="line">           ++<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>)</div>
<div class="line">        {</div>
<div class="line">          prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;boundary_&quot;</span> +</div>
<div class="line">                               <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>));</div>
<div class="line">          {</div>
<div class="line">            std::vector&lt;std::string&gt; expressions(</div>
<div class="line">              <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>, <span class="stringliteral">&quot;0.0&quot;</span>);</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">bool</span> no_penetration = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;no penetration&quot;</span>);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">di &lt; EulerEquations&lt;dim&gt;::n_components</a>;</div>
<div class="line">                 ++di)</div>
<div class="line">              {</div>
<div class="line">                <span class="keyword">const</span> std::string boundary_type =</div>
<div class="line">                  prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di));</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> ((di &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>) &amp;&amp; (no_penetration == <span class="keyword">true</span>))</div>
<div class="line">                  boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].kind[di] =</div>
<div class="line">                    EulerEquations&lt;dim&gt;::no_penetration_boundary;</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (boundary_type == <span class="stringliteral">&quot;inflow&quot;</span>)</div>
<div class="line">                  boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].kind[di] =</div>
<div class="line">                    EulerEquations&lt;dim&gt;::inflow_boundary;</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (boundary_type == <span class="stringliteral">&quot;pressure&quot;</span>)</div>
<div class="line">                  boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].kind[di] =</div>
<div class="line">                    EulerEquations&lt;dim&gt;::pressure_boundary;</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (boundary_type == <span class="stringliteral">&quot;outflow&quot;</span>)</div>
<div class="line">                  boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].kind[di] =</div>
<div class="line">                    EulerEquations&lt;dim&gt;::outflow_boundary;</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                  <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line"> </div>
<div class="line">                expressions[di] =</div>
<div class="line">                  prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di) + <span class="stringliteral">&quot; value&quot;</span>);</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].values.initialize(</div>
<div class="line">              <a class="code" href="classFunctionParser.html">FunctionParser&lt;dim&gt;::default_variable_names</a>(),</div>
<div class="line">              expressions,</div>
<div class="line">              std::map&lt;std::string, double&gt;());</div>
<div class="line">          }</div>
<div class="line">          prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;initial condition&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        std::vector&lt;std::string&gt; expressions(<a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>,</div>
<div class="line">                                             <span class="stringliteral">&quot;0.0&quot;</span>);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">di &lt; EulerEquations&lt;dim&gt;::n_components</a>; di++)</div>
<div class="line">          expressions[di] =</div>
<div class="line">            prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di) + <span class="stringliteral">&quot; value&quot;</span>);</div>
<div class="line">        initial_conditions.initialize(</div>
<div class="line">          <a class="code" href="classFunctionParser.html">FunctionParser&lt;dim&gt;::default_variable_names</a>(),</div>
<div class="line">          expressions,</div>
<div class="line">          std::map&lt;std::string, double&gt;());</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line">      Parameters::Solver::parse_parameters(prm);</div>
<div class="line">      Parameters::Refinement::parse_parameters(prm);</div>
<div class="line">      Parameters::Flux::parse_parameters(prm);</div>
<div class="line">      Parameters::Output::parse_parameters(prm);</div>
<div class="line">    }</div>
<div class="line">  } <span class="comment">// namespace Parameters</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span><a class="code" href="classStep33_1_1ConservationLaw.html">ConservationLaw</a></div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <a class="code" href="classStep33_1_1ConservationLaw.html">ConservationLaw</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *input_filename);</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">run</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">void</span> setup_system();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> assemble_system();</div>
<div class="line">    <span class="keywordtype">void</span> assemble_cell_term(<span class="keyword">const</span> <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> &amp;                       fe_v,</div>
<div class="line">                            <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;<a class="code" href="distributed__0_8txt.html#ad207fe81a5be05e18534713c2677da7b">dofs</a>);</div>
<div class="line">    <span class="keywordtype">void</span> assemble_face_term(</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                          <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>,</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classFEFaceValuesBase.html">FEFaceValuesBase&lt;dim&gt;</a> &amp;               fe_v,</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classFEFaceValuesBase.html">FEFaceValuesBase&lt;dim&gt;</a> &amp;               fe_v_neighbor,</div>
<div class="line">      <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;<a class="code" href="distributed__0_8txt.html#ad207fe81a5be05e18534713c2677da7b">dofs</a>,</div>
<div class="line">      <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dofs_neighbor,</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">bool</span>                                  external_face,</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                          <a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>,</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span>                                face_diameter);</div>
<div class="line"> </div>
<div class="line">    std::pair&lt;unsigned int, double&gt; <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>(<a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> compute_refinement_indicators(<a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;<a class="code" href="grid__generator__0_8txt.html#ad40779ba24977c5f641bfa6ac51032ab">indicator</a>) <span class="keyword">const</span>;</div>
<div class="line">    <span class="keywordtype">void</span> refine_grid(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;<a class="code" href="grid__generator__0_8txt.html#ad40779ba24977c5f641bfa6ac51032ab">indicator</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> output_results() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a>   <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classMappingQ1.html">MappingQ1&lt;dim&gt;</a> <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFESystem.html">FESystem&lt;dim&gt;</a> <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>;</div>
<div class="line">    <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>     dof_handler;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>     <a class="code" href="update__flags__0_8txt.html#a5873b8f7eeaefb5e7a99005c6c93b175">quadrature</a>;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> - 1&gt; face_quadrature;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> old_solution;</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> current_solution;</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> predictor;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTrilinosWrappers_1_1SparseMatrix.html">TrilinosWrappers::SparseMatrix</a> system_matrix;</div>
<div class="line"> </div>
<div class="line">    Parameters::AllParameters&lt;dim&gt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>;</div>
<div class="line">    <a class="code" href="classConditionalOStream.html">ConditionalOStream</a>             verbose_cout;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <a class="code" href="classStep33_1_1ConservationLaw.html">ConservationLaw&lt;dim&gt;::ConservationLaw</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *input_filename)</div>
<div class="line">    : <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>()</div>
<div class="line">    , <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>(<a class="code" href="classFE__Q.html">FE_Q</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;(1), EulerEquations&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;::<a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>)</div>
<div class="line">    , dof_handler(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>)</div>
<div class="line">    , <a class="code" href="update__flags__0_8txt.html#a5873b8f7eeaefb5e7a99005c6c93b175">quadrature</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="polynomial__space__0_8txt.html#a03a2f48682e29e39f7bccc11a7d1c4d1">degree</a> + 1)</div>
<div class="line">    , face_quadrature(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="polynomial__space__0_8txt.html#a03a2f48682e29e39f7bccc11a7d1c4d1">degree</a> + 1)</div>
<div class="line">    , verbose_cout(std::cout, <a class="code" href="parsed__convergence__table__0_8txt.html#a2c7b85beed973f20ac73d33d8bbe8a57">false</a>)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classParameterHandler.html">ParameterHandler</a> prm;</div>
<div class="line">    <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Parameters::AllParameters&lt;dim&gt;::declare_parameters</a>(prm);</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">parse_input</a>(input_filename);</div>
<div class="line">    <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.parse_parameters(prm);</div>
<div class="line"> </div>
<div class="line">    verbose_cout.set_condition(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.output ==</div>
<div class="line">                               Parameters::Solver::verbose);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep33_1_1ConservationLaw.html">ConservationLaw&lt;dim&gt;::setup_system</a>()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(), dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler, dsp);</div>
<div class="line"> </div>
<div class="line">    system_matrix.reinit(dsp);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep33_1_1ConservationLaw.html">ConservationLaw&lt;dim&gt;::assemble_system</a>()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> = dof_handler.<a class="code" href="classDoFHandler.html#ac1fedeb50b5f03b13d8b69f86e33f726">get_fe</a>().<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>();</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; dof_indices(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; dof_indices_neighbor(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> update_flags = <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> |</div>
<div class="line">                                     <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> |</div>
<div class="line">                                     <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>,</div>
<div class="line">                      face_update_flags =</div>
<div class="line">                        <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> |</div>
<div class="line">                        <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f">update_normal_vectors</a>,</div>
<div class="line">                      neighbor_face_update_flags = <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>        fe_v(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>, <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>, <a class="code" href="update__flags__0_8txt.html#a5873b8f7eeaefb5e7a99005c6c93b175">quadrature</a>, update_flags);</div>
<div class="line">    <a class="code" href="classFEFaceValues.html">FEFaceValues&lt;dim&gt;</a>    fe_v_face(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                                face_quadrature,</div>
<div class="line">                                face_update_flags);</div>
<div class="line">    <a class="code" href="classFESubfaceValues.html">FESubfaceValues&lt;dim&gt;</a> fe_v_subface(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                      <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                                      face_quadrature,</div>
<div class="line">                                      face_update_flags);</div>
<div class="line">    <a class="code" href="classFEFaceValues.html">FEFaceValues&lt;dim&gt;</a>    fe_v_face_neighbor(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                         <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                                         face_quadrature,</div>
<div class="line">                                         neighbor_face_update_flags);</div>
<div class="line">    <a class="code" href="classFESubfaceValues.html">FESubfaceValues&lt;dim&gt;</a> fe_v_subface_neighbor(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                               <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                                               face_quadrature,</div>
<div class="line">                                               neighbor_face_update_flags);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">      {</div>
<div class="line">        fe_v.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line">        <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;get_dof_indices(dof_indices);</div>
<div class="line"> </div>
<div class="line">        assemble_cell_term(fe_v, dof_indices);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a> : <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;face_indices())</div>
<div class="line">          <span class="keywordflow">if</span> (<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;at_boundary(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>))</div>
<div class="line">            {</div>
<div class="line">              fe_v_face.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>);</div>
<div class="line">              assemble_face_term(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>,</div>
<div class="line">                                 fe_v_face,</div>
<div class="line">                                 fe_v_face,</div>
<div class="line">                                 dof_indices,</div>
<div class="line">                                 std::vector&lt;types::global_dof_index&gt;(),</div>
<div class="line">                                 <span class="keyword">true</span>,</div>
<div class="line">                                 <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;face(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;boundary_id(),</div>
<div class="line">                                 <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;face(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;diameter());</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">              <span class="keywordflow">if</span> (<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;neighbor(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;has_children())</div>
<div class="line">                {</div>
<div class="line">                  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> neighbor2 =</div>
<div class="line">                    <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;neighbor_of_neighbor(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>);</div>
<div class="line"> </div>
<div class="line">                  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> subface_no = 0;</div>
<div class="line">                       subface_no &lt; <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;face(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;n_children();</div>
<div class="line">                       ++subface_no)</div>
<div class="line">                    {</div>
<div class="line">                      <span class="keyword">const</span> <span class="keyword">typename</span> DoFHandler&lt;dim&gt;::active_cell_iterator</div>
<div class="line">                        neighbor_child =</div>
<div class="line">                          <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;neighbor_child_on_subface(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>, subface_no);</div>
<div class="line"> </div>
<div class="line">                      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(neighbor_child-&gt;face(neighbor2) ==</div>
<div class="line">                               <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;face(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;child(subface_no),</div>
<div class="line">                             <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">                      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(neighbor_child-&gt;is_active(), <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">                      fe_v_subface.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>, subface_no);</div>
<div class="line">                      fe_v_face_neighbor.reinit(neighbor_child, neighbor2);</div>
<div class="line"> </div>
<div class="line">                      neighbor_child-&gt;get_dof_indices(dof_indices_neighbor);</div>
<div class="line"> </div>
<div class="line">                      assemble_face_term(</div>
<div class="line">                        <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>,</div>
<div class="line">                        fe_v_subface,</div>
<div class="line">                        fe_v_face_neighbor,</div>
<div class="line">                        dof_indices,</div>
<div class="line">                        dof_indices_neighbor,</div>
<div class="line">                        <span class="keyword">false</span>,</div>
<div class="line">                        <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>,</div>
<div class="line">                        neighbor_child-&gt;face(neighbor2)-&gt;diameter());</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;neighbor(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;level() != <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;level())</div>
<div class="line">                {</div>
<div class="line">                  <span class="keyword">const</span> <span class="keyword">typename</span> DoFHandler&lt;dim&gt;::cell_iterator <a class="code" href="fe_2fe__0_8txt.html#ad1bbe5407fe459d8e4e71ba7ed9f7428">neighbor</a> =</div>
<div class="line">                    <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;neighbor(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>);</div>
<div class="line">                  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="fe_2fe__0_8txt.html#ad1bbe5407fe459d8e4e71ba7ed9f7428">neighbor</a>-&gt;level() == <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;level() - 1,</div>
<div class="line">                         <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">                  <a class="code" href="fe_2fe__0_8txt.html#ad1bbe5407fe459d8e4e71ba7ed9f7428">neighbor</a>-&gt;get_dof_indices(dof_indices_neighbor);</div>
<div class="line"> </div>
<div class="line">                  <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; faceno_subfaceno =</div>
<div class="line">                    <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;neighbor_of_coarser_neighbor(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>);</div>
<div class="line">                  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> neighbor_face_no = faceno_subfaceno.first,</div>
<div class="line">                                     neighbor_subface_no =</div>
<div class="line">                                       faceno_subfaceno.second;</div>
<div class="line"> </div>
<div class="line">                  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="fe_2fe__0_8txt.html#ad1bbe5407fe459d8e4e71ba7ed9f7428">neighbor</a>-&gt;neighbor_child_on_subface(</div>
<div class="line">                           neighbor_face_no, neighbor_subface_no) == <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>,</div>
<div class="line">                         <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">                  fe_v_face.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>);</div>
<div class="line">                  fe_v_subface_neighbor.reinit(<a class="code" href="fe_2fe__0_8txt.html#ad1bbe5407fe459d8e4e71ba7ed9f7428">neighbor</a>,</div>
<div class="line">                                               neighbor_face_no,</div>
<div class="line">                                               neighbor_subface_no);</div>
<div class="line"> </div>
<div class="line">                  assemble_face_term(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>,</div>
<div class="line">                                     fe_v_face,</div>
<div class="line">                                     fe_v_subface_neighbor,</div>
<div class="line">                                     dof_indices,</div>
<div class="line">                                     dof_indices_neighbor,</div>
<div class="line">                                     <span class="keyword">false</span>,</div>
<div class="line">                                     <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>,</div>
<div class="line">                                     <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;face(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;diameter());</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep33_1_1ConservationLaw.html">ConservationLaw&lt;dim&gt;::assemble_cell_term</a>(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> &amp;                       fe_v,</div>
<div class="line">    <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dof_indices)</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> = fe_v.dofs_per_cell;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>    = fe_v.n_quadrature_points;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;2, Sacado::Fad::DFad&lt;double&gt;</a>&gt; W(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>,</div>
<div class="line">                                          <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;2, double&gt;</a> W_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;3, Sacado::Fad::DFad&lt;double&gt;</a>&gt; grad_W(</div>
<div class="line">      <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>, <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;3, double&gt;</a> grad_W_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>,</div>
<div class="line">                                <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>,</div>
<div class="line">                                <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;double&gt; residual_derivatives(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;Sacado::Fad::DFad&lt;double&gt;&gt; independent_local_dof_values(</div>
<div class="line">      <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">      independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] = current_solution(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">      independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>].diff(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a> = 0; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">c &lt; EulerEquations&lt;dim&gt;::n_components</a>; ++<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>)</div>
<div class="line">        {</div>
<div class="line">          W[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>]     = 0;</div>
<div class="line">          W_old[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = 0;</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">            {</div>
<div class="line">              grad_W[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>]     = 0;</div>
<div class="line">              grad_W_old[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] = 0;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a> =</div>
<div class="line">            fe_v.get_fe().system_to_component_index(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>).first;</div>
<div class="line"> </div>
<div class="line">          W[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] += independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] *</div>
<div class="line">                     fe_v.shape_value_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>);</div>
<div class="line">          W_old[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] +=</div>
<div class="line">            old_solution(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) * fe_v.shape_value_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>);</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>++)</div>
<div class="line">            {</div>
<div class="line">              grad_W[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] += independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] *</div>
<div class="line">                                 fe_v.shape_grad_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>)[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line">              grad_W_old[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] += old_solution(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) *</div>
<div class="line">                                     fe_v.shape_grad_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>)[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    std::vector&lt;ndarray&lt;Sacado::Fad::DFad&lt;double&gt;,</div>
<div class="line">                        <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>,</div>
<div class="line">                        <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;&gt;</div>
<div class="line">      <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">std::vector&lt;ndarray&lt;double, EulerEquations&lt;dim&gt;::n_components</a>, <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;&gt;</div>
<div class="line">      flux_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;</div>
<div class="line">      std::array&lt;Sacado::Fad::DFad&lt;double&gt;, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>&gt;&gt;</div>
<div class="line">      forcing(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">std::vector&lt;std::array&lt;double, EulerEquations&lt;dim&gt;::n_components</a>&gt;&gt;</div>
<div class="line">      forcing_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q)</div>
<div class="line">      {</div>
<div class="line">        EulerEquations&lt;dim&gt;::compute_flux_matrix(W_old[q], flux_old[q]);</div>
<div class="line">        EulerEquations&lt;dim&gt;::compute_forcing_vector(W_old[q], forcing_old[q]);</div>
<div class="line">        EulerEquations&lt;dim&gt;::compute_flux_matrix(W[q], <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>[q]);</div>
<div class="line">        EulerEquations&lt;dim&gt;::compute_forcing_vector(W[q], forcing[q]);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; fe_v.dofs_per_cell; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">      {</div>
<div class="line">        Sacado::Fad::DFad&lt;double&gt; R_i = 0;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">          fe_v.get_fe().system_to_component_index(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>).first;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a> = 0; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a> &lt; fe_v.n_quadrature_points; ++<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>)</div>
<div class="line">          {</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.is_stationary == <span class="keyword">false</span>)</div>
<div class="line">              R_i += 1.0 / <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.time_step *</div>
<div class="line">                     (W[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i] - W_old[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i]) *</div>
<div class="line">                     fe_v.shape_value_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>, component_i) *</div>
<div class="line">                     fe_v.JxW(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>++)</div>
<div class="line">              R_i -=</div>
<div class="line">                (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta * <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] +</div>
<div class="line">                 (1.0 - <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta) * flux_old[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>]) *</div>
<div class="line">                fe_v.shape_grad_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>, component_i)[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] *</div>
<div class="line">                fe_v.JxW(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>++)</div>
<div class="line">              R_i +=</div>
<div class="line">                1.0 *</div>
<div class="line">                std::pow(fe_v.get_cell()-&gt;diameter(),</div>
<div class="line">                         <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.diffusion_power) *</div>
<div class="line">                (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta * grad_W[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] +</div>
<div class="line">                 (1.0 - <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta) * grad_W_old[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>]) *</div>
<div class="line">                fe_v.shape_grad_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>, component_i)[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] *</div>
<div class="line">                fe_v.JxW(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>);</div>
<div class="line"> </div>
<div class="line">            R_i -=</div>
<div class="line">              (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta * forcing[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i] +</div>
<div class="line">               (1.0 - <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta) * forcing_old[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i]) *</div>
<div class="line">              fe_v.shape_value_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>, component_i) *</div>
<div class="line">              fe_v.JxW(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a> = 0; <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>)</div>
<div class="line">          residual_derivatives[<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>] = R_i.fastAccessDx(<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>);</div>
<div class="line">        system_matrix.add(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>], dof_indices, residual_derivatives);</div>
<div class="line">        <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) -= R_i.val();</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep33_1_1ConservationLaw.html">ConservationLaw&lt;dim&gt;::assemble_face_term</a>(</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                          <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFEFaceValuesBase.html">FEFaceValuesBase&lt;dim&gt;</a> &amp;               fe_v,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFEFaceValuesBase.html">FEFaceValuesBase&lt;dim&gt;</a> &amp;               fe_v_neighbor,</div>
<div class="line">    <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dof_indices,</div>
<div class="line">    <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dof_indices_neighbor,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span>                                  external_face,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                          <a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>                                face_diameter)</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>    = fe_v.<a class="code" href="classFEValuesBase.html#a807c3049bfe81743fc0f237dfc2fbdea">n_quadrature_points</a>;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> = fe_v.<a class="code" href="classFEValuesBase.html#a5b264d5b2fb6615f5dea7a21135ed1a5">dofs_per_cell</a>;</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;Sacado::Fad::DFad&lt;double&gt;&gt; independent_local_dof_values(</div>
<div class="line">      <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>),</div>
<div class="line">      independent_neighbor_dof_values(external_face == <span class="keyword">false</span> ? <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> :</div>
<div class="line">                                                               0);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_independent_variables =</div>
<div class="line">      (external_face == <span class="keyword">false</span> ? 2 * <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> : <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>++)</div>
<div class="line">      {</div>
<div class="line">        independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] = current_solution(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]);</div>
<div class="line">        independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>].diff(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, n_independent_variables);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (external_face == <span class="keyword">false</span>)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>++)</div>
<div class="line">        {</div>
<div class="line">          independent_neighbor_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] =</div>
<div class="line">            current_solution(dof_indices_neighbor[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]);</div>
<div class="line">          independent_neighbor_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>].diff(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> + <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>,</div>
<div class="line">                                                  n_independent_variables);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;2, Sacado::Fad::DFad&lt;double&gt;</a>&gt; Wplus(</div>
<div class="line">      <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>),</div>
<div class="line">      Wminus(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>);</div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;2, double&gt;</a> Wplus_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>),</div>
<div class="line">      Wminus_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">            fe_v.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#a86644fe67824373cd51e9ff7fca94f8c">system_to_component_index</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>).first;</div>
<div class="line">          Wplus[q][component_i] +=</div>
<div class="line">            independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] *</div>
<div class="line">            fe_v.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, component_i);</div>
<div class="line">          Wplus_old[q][component_i] +=</div>
<div class="line">            old_solution(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) *</div>
<div class="line">            fe_v.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, component_i);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (external_face == <span class="keyword">false</span>)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q)</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">                fe_v_neighbor.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#a86644fe67824373cd51e9ff7fca94f8c">system_to_component_index</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>).first;</div>
<div class="line">              Wminus[q][component_i] +=</div>
<div class="line">                independent_neighbor_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] *</div>
<div class="line">                fe_v_neighbor.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, component_i);</div>
<div class="line">              Wminus_old[q][component_i] +=</div>
<div class="line">                old_solution(dof_indices_neighbor[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) *</div>
<div class="line">                fe_v_neighbor.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, component_i);</div>
<div class="line">            }</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a> &lt; Parameters::AllParameters&lt;dim&gt;::max_n_boundaries,</div>
<div class="line">               <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>,</div>
<div class="line">                             0,</div>
<div class="line">                             Parameters::AllParameters&lt;dim&gt;::max_n_boundaries));</div>
<div class="line"> </div>
<div class="line">        std::vector&lt;Vector&lt;double&gt;&gt; boundary_values(</div>
<div class="line">          <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>(<a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>));</div>
<div class="line">        <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].values.vector_value_list(</div>
<div class="line">          fe_v.<a class="code" href="classFEValuesBase.html#ae41b67cfd48e02f6035e39c84f0fb47a">get_quadrature_points</a>(), boundary_values);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; q++)</div>
<div class="line">          {</div>
<div class="line">            EulerEquations&lt;dim&gt;::compute_Wminus(</div>
<div class="line">              <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].kind,</div>
<div class="line">              fe_v.<a class="code" href="classFEValuesBase.html#ac25ec6835799c3b6c7c842f8acb05eb3">normal_vector</a>(q),</div>
<div class="line">              Wplus[q],</div>
<div class="line">              boundary_values[q],</div>
<div class="line">              Wminus[q]);</div>
<div class="line">            EulerEquations&lt;dim&gt;::compute_Wminus(</div>
<div class="line">              <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].kind,</div>
<div class="line">              fe_v.<a class="code" href="classFEValuesBase.html#ac25ec6835799c3b6c7c842f8acb05eb3">normal_vector</a>(q),</div>
<div class="line">              Wplus_old[q],</div>
<div class="line">              boundary_values[q],</div>
<div class="line">              Wminus_old[q]);</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;</div>
<div class="line">      std::array&lt;Sacado::Fad::DFad&lt;double&gt;, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>&gt;&gt;</div>
<div class="line">      normal_fluxes(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line">    <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">std::vector&lt;std::array&lt;double, EulerEquations&lt;dim&gt;::n_components</a>&gt;&gt;</div>
<div class="line">      normal_fluxes_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.stabilization_kind)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="fe__dgp__nonparametric__0_8txt.html#a8290746300287635d0fe47e4071ea1ef">Parameters::Flux::constant</a>:</div>
<div class="line">          <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a> = <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.stabilization_value;</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> Parameters::Flux::mesh_dependent:</div>
<div class="line">          <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a> = face_diameter / (2.0 * <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.time_step);</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">          <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a> = 1;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q)</div>
<div class="line">      {</div>
<div class="line">        EulerEquations&lt;dim&gt;::numerical_normal_flux(</div>
<div class="line">          fe_v.<a class="code" href="classFEValuesBase.html#ac25ec6835799c3b6c7c842f8acb05eb3">normal_vector</a>(q), Wplus[q], Wminus[q], <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>, normal_fluxes[q]);</div>
<div class="line">        EulerEquations&lt;dim&gt;::numerical_normal_flux(fe_v.<a class="code" href="classFEValuesBase.html#ac25ec6835799c3b6c7c842f8acb05eb3">normal_vector</a>(q),</div>
<div class="line">                                                   Wplus_old[q],</div>
<div class="line">                                                   Wminus_old[q],</div>
<div class="line">                                                   <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>,</div>
<div class="line">                                                   normal_fluxes_old[q]);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;double&gt; residual_derivatives(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; fe_v.<a class="code" href="classFEValuesBase.html#a5b264d5b2fb6615f5dea7a21135ed1a5">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">      <span class="keywordflow">if</span> (fe_v.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#ab275cbead21bb11b1208222b6d662357">has_support_on_face</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>) == <span class="keyword">true</span>)</div>
<div class="line">        {</div>
<div class="line">          Sacado::Fad::DFad&lt;double&gt; R_i = 0;</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a> = 0; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a> &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>)</div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">                fe_v.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#a86644fe67824373cd51e9ff7fca94f8c">system_to_component_index</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>).first;</div>
<div class="line"> </div>
<div class="line">              R_i += (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta * normal_fluxes[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i] +</div>
<div class="line">                      (1.0 - <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta) *</div>
<div class="line">                        normal_fluxes_old[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i]) *</div>
<div class="line">                     fe_v.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>, component_i) *</div>
<div class="line">                     fe_v.<a class="code" href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">JxW</a>(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a> = 0; <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>)</div>
<div class="line">            residual_derivatives[<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>] = R_i.fastAccessDx(<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>);</div>
<div class="line">          system_matrix.add(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>], dof_indices, residual_derivatives);</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">if</span> (external_face == <span class="keyword">false</span>)</div>
<div class="line">            {</div>
<div class="line">              <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a> = 0; <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>)</div>
<div class="line">                residual_derivatives[<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>] = R_i.fastAccessDx(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> + <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>);</div>
<div class="line">              system_matrix.add(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>],</div>
<div class="line">                                dof_indices_neighbor,</div>
<div class="line">                                residual_derivatives);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) -= R_i.val();</div>
<div class="line">        }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  std::pair&lt;unsigned int, double&gt;</div>
<div class="line">  <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">ConservationLaw&lt;dim&gt;::solve</a>(<a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;newton_update)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">switch</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.solver)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">case</span> Parameters::Solver::direct:</div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="classSolverControl.html">SolverControl</a>                                  solver_control(1, 0);</div>
<div class="line">            <a class="code" href="structTrilinosWrappers_1_1SolverDirect_1_1AdditionalData.html">TrilinosWrappers::SolverDirect::AdditionalData</a> <a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>(</div>
<div class="line">              <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.output == Parameters::Solver::verbose);</div>
<div class="line">            <a class="code" href="classTrilinosWrappers_1_1SolverDirect.html">TrilinosWrappers::SolverDirect</a> direct(solver_control, <a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>);</div>
<div class="line"> </div>
<div class="line">            direct.solve(system_matrix, newton_update, <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">return</span> {solver_control.last_step(), solver_control.last_value()};</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> Parameters::Solver::gmres:</div>
<div class="line">          {</div>
<div class="line">            Epetra_Vector <a class="code" href="vector__valued__0_8txt.html#a2b24e414d1a0d32deea919c5e8899811">x</a>(<a class="code" href="namespaceFEValuesViews.html#af2099b26234f5816729f7f6dc523dc0f">View</a>,</div>
<div class="line">                            system_matrix.trilinos_matrix().DomainMap(),</div>
<div class="line">                            newton_update.<a class="code" href="classVector.html#af34b888fe493ef2ed188179de69ad7ed">begin</a>());</div>
<div class="line">            Epetra_Vector <a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a>(<a class="code" href="namespaceFEValuesViews.html#af2099b26234f5816729f7f6dc523dc0f">View</a>,</div>
<div class="line">                            system_matrix.trilinos_matrix().RangeMap(),</div>
<div class="line">                            <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>.begin());</div>
<div class="line"> </div>
<div class="line">            AztecOO <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>;</div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecOption(</div>
<div class="line">              AZ_output,</div>
<div class="line">              (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.output == Parameters::Solver::quiet ? AZ_none :</div>
<div class="line">                                                                AZ_all));</div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecOption(AZ_solver, AZ_gmres);</div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetRHS(&amp;<a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a>);</div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetLHS(&amp;<a class="code" href="vector__valued__0_8txt.html#a2b24e414d1a0d32deea919c5e8899811">x</a>);</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecOption(AZ_precond, AZ_dom_decomp);</div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecOption(AZ_subdomain_solve, AZ_ilut);</div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecOption(AZ_overlap, 0);</div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecOption(AZ_reorder, 0);</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecParam(AZ_drop, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.ilut_drop);</div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecParam(AZ_ilut_fill, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.ilut_fill);</div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecParam(AZ_athresh, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.ilut_atol);</div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecParam(AZ_rthresh, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.ilut_rtol);</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetUserMatrix(</div>
<div class="line">              <span class="keyword">const_cast&lt;</span>Epetra_CrsMatrix *<span class="keyword">&gt;</span>(&amp;system_matrix.trilinos_matrix()));</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.Iterate(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.max_iterations,</div>
<div class="line">                           <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.linear_residual);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">return</span> {<a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.NumIters(), <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.TrueResidual()};</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">    <span class="keywordflow">return</span> {0, 0};</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep33_1_1ConservationLaw.html">ConservationLaw&lt;dim&gt;::compute_refinement_indicators</a>(</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;refinement_indicators)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    EulerEquations&lt;dim&gt;::compute_refinement_indicators(dof_handler,</div>
<div class="line">                                                       <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                                       predictor,</div>
<div class="line">                                                       refinement_indicators);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span></div>
<div class="line">  <a class="code" href="classStep33_1_1ConservationLaw.html">ConservationLaw&lt;dim&gt;::refine_grid</a>(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;refinement_indicators)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell_no = <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;active_cell_index();</div>
<div class="line">        <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;clear_coarsen_flag();</div>
<div class="line">        <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;clear_refine_flag();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> ((<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;level() &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.shock_levels) &amp;&amp;</div>
<div class="line">            (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(refinement_indicators(cell_no)) &gt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.shock_val))</div>
<div class="line">          <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;set_refine_flag();</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;level() &gt; 0) &amp;&amp;</div>
<div class="line">                 (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(refinement_indicators(cell_no)) &lt;</div>
<div class="line">                  0.75 * <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.shock_val))</div>
<div class="line">          <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;set_coarsen_flag();</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;Vector&lt;double&gt;&gt; transfer_in;</div>
<div class="line">    std::vector&lt;Vector&lt;double&gt;&gt; transfer_out;</div>
<div class="line"> </div>
<div class="line">    transfer_in.push_back(old_solution);</div>
<div class="line">    transfer_in.push_back(predictor);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.prepare_coarsening_and_refinement();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSolutionTransfer.html">SolutionTransfer&lt;dim&gt;</a> soltrans(dof_handler);</div>
<div class="line">    soltrans.prepare_for_coarsening_and_refinement(transfer_in);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.execute_coarsening_and_refinement();</div>
<div class="line"> </div>
<div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#ad316958f8045d9a48094335b23a03a53">clear</a>();</div>
<div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classVector.html">Vector&lt;double&gt;</a> new_old_solution(1);</div>
<div class="line">      <a class="code" href="classVector.html">Vector&lt;double&gt;</a> new_predictor(1);</div>
<div class="line"> </div>
<div class="line">      transfer_out.push_back(new_old_solution);</div>
<div class="line">      transfer_out.push_back(new_predictor);</div>
<div class="line">      transfer_out[0].reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">      transfer_out[1].reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    soltrans.interpolate(transfer_in, transfer_out);</div>
<div class="line"> </div>
<div class="line">    old_solution.reinit(transfer_out[0].<a class="code" href="function__0_8txt.html#a4f780342f2d5d632f82cf7fd90158a66">size</a>());</div>
<div class="line">    old_solution = transfer_out[0];</div>
<div class="line"> </div>
<div class="line">    predictor.reinit(transfer_out[1].<a class="code" href="function__0_8txt.html#a4f780342f2d5d632f82cf7fd90158a66">size</a>());</div>
<div class="line">    predictor = transfer_out[1];</div>
<div class="line"> </div>
<div class="line">    current_solution.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    current_solution = old_solution;</div>
<div class="line">    <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep33_1_1ConservationLaw.html">ConservationLaw&lt;dim&gt;::output_results</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keyword">typename</span> EulerEquations&lt;dim&gt;::Postprocessor <a class="code" href="data__postprocessor__0_8txt.html#a80e53cb52e5dbb182dd14ee528927a77">postprocessor</a>(</div>
<div class="line">      <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.schlieren_plot);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">attach_dof_handler</a>(dof_handler);</div>
<div class="line"> </div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(current_solution,</div>
<div class="line">                             EulerEquations&lt;dim&gt;::component_names(),</div>
<div class="line">                             <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;::type_dof_data</a>,</div>
<div class="line">                             EulerEquations&lt;dim&gt;::component_interpretation());</div>
<div class="line"> </div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(current_solution, <a class="code" href="data__postprocessor__0_8txt.html#a80e53cb52e5dbb182dd14ee528927a77">postprocessor</a>);</div>
<div class="line"> </div>
<div class="line">    data_out.<a class="code" href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">build_patches</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> output_file_number = 0;</div>
<div class="line">    std::string         filename =</div>
<div class="line">      <span class="stringliteral">&quot;solution-&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(output_file_number, 3) + <span class="stringliteral">&quot;.vtk&quot;</span>;</div>
<div class="line">    std::ofstream <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>(filename);</div>
<div class="line">    data_out.<a class="code" href="classDataOutInterface.html#acad99726038e4fca7f605fdffb3317e4">write_vtk</a>(<a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>);</div>
<div class="line"> </div>
<div class="line">    ++output_file_number;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">ConservationLaw&lt;dim&gt;::run</a>()</div>
<div class="line">  {</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classGridIn.html">GridIn&lt;dim&gt;</a> grid_in;</div>
<div class="line">      grid_in.<a class="code" href="classGridIn.html#a82ac1c03b0efe87204ad45d2f1d87f7e">attach_triangulation</a>(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>);</div>
<div class="line"> </div>
<div class="line">      std::ifstream input_file(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.mesh_filename);</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(input_file, <a class="code" href="group__Exceptions.html#ga4c22c86ff89575667de2ca9778aa28e5">ExcFileNotOpen</a>(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.mesh_filename.c_str()));</div>
<div class="line"> </div>
<div class="line">      grid_in.<a class="code" href="classGridIn.html#abbb16aa0aa53bfa9231b69278d397616">read_ucd</a>(input_file);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#ad316958f8045d9a48094335b23a03a53">clear</a>();</div>
<div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
<div class="line"> </div>
<div class="line">    old_solution.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    current_solution.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    predictor.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line"> </div>
<div class="line">    setup_system();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#a761f008bdeb7d94a69205ae824deefad">VectorTools::interpolate</a>(dof_handler,</div>
<div class="line">                             <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.initial_conditions,</div>
<div class="line">                             old_solution);</div>
<div class="line">    current_solution = old_solution;</div>
<div class="line">    predictor        = old_solution;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.do_refine == <span class="keyword">true</span>)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.shock_levels; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">        {</div>
<div class="line">          <a class="code" href="classVector.html">Vector&lt;double&gt;</a> refinement_indicators(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells());</div>
<div class="line"> </div>
<div class="line">          compute_refinement_indicators(refinement_indicators);</div>
<div class="line">          refine_grid(refinement_indicators);</div>
<div class="line"> </div>
<div class="line">          setup_system();</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="namespaceVectorTools.html#a761f008bdeb7d94a69205ae824deefad">VectorTools::interpolate</a>(dof_handler,</div>
<div class="line">                                   <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.initial_conditions,</div>
<div class="line">                                   old_solution);</div>
<div class="line">          current_solution = old_solution;</div>
<div class="line">          predictor        = old_solution;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">    output_results();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> newton_update(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a>        = 0;</div>
<div class="line">    <span class="keywordtype">double</span> next_output = <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a> + <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.output_step;</div>
<div class="line"> </div>
<div class="line">    predictor = old_solution;</div>
<div class="line">    <span class="keywordflow">while</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.final_time)</div>
<div class="line">      {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;T=&quot;</span> &lt;&lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a> &lt;&lt; std::endl</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;   Number of active cells:       &quot;</span></div>
<div class="line">                  &lt;&lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells() &lt;&lt; std::endl</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;   Number of degrees of freedom: &quot;</span> &lt;&lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>()</div>
<div class="line">                  &lt;&lt; std::endl</div>
<div class="line">                  &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;   NonLin Res     Lin Iter       Lin Res&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;   _____________________________________&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nonlin_iter = 0;</div>
<div class="line">        current_solution         = predictor;</div>
<div class="line">        <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line">          {</div>
<div class="line">            system_matrix = 0;</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a> = 0;</div>
<div class="line">            assemble_system();</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> res_norm = <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>.l2_norm();</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(res_norm) &lt; 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-10)</div>
<div class="line">              {</div>
<div class="line">                std::printf(<span class="stringliteral">&quot;   %-16.3e (converged)\n\n&quot;</span>, res_norm);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">              }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">              {</div>
<div class="line">                newton_update = 0;</div>
<div class="line"> </div>
<div class="line">                std::pair&lt;unsigned int, double&gt; <a class="code" href="solver__0_8txt.html#a06078ea1995fa54b715bee3b7745f08f">convergence</a> =</div>
<div class="line">                  <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>(newton_update);</div>
<div class="line"> </div>
<div class="line">                current_solution += newton_update;</div>
<div class="line"> </div>
<div class="line">                std::printf(<span class="stringliteral">&quot;   %-16.3e %04d        %-5.2e\n&quot;</span>,</div>
<div class="line">                            res_norm,</div>
<div class="line">                            <a class="code" href="solver__0_8txt.html#a06078ea1995fa54b715bee3b7745f08f">convergence</a>.first,</div>
<div class="line">                            <a class="code" href="solver__0_8txt.html#a06078ea1995fa54b715bee3b7745f08f">convergence</a>.second);</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            ++nonlin_iter;</div>
<div class="line">            <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(nonlin_iter &lt;= 10,</div>
<div class="line">                        <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;No convergence in nonlinear solver&quot;</span>));</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a> += <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.time_step;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.output_step &lt; 0)</div>
<div class="line">          output_results();</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a> &gt;= next_output)</div>
<div class="line">          {</div>
<div class="line">            output_results();</div>
<div class="line">            next_output += <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.output_step;</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        predictor = current_solution;</div>
<div class="line">        predictor.sadd(2.0, -1.0, old_solution);</div>
<div class="line"> </div>
<div class="line">        old_solution = current_solution;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.do_refine == <span class="keyword">true</span>)</div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="classVector.html">Vector&lt;double&gt;</a> refinement_indicators(</div>
<div class="line">              <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells());</div>
<div class="line">            compute_refinement_indicators(refinement_indicators);</div>
<div class="line"> </div>
<div class="line">            refine_grid(refinement_indicators);</div>
<div class="line">            setup_system();</div>
<div class="line"> </div>
<div class="line">            newton_update.<a class="code" href="classVector.html#ac4a4dbef7dd65ef8ad35ae56b57d7c05">reinit</a>(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Step33</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line">      <span class="keyword">using namespace </span><a class="code" href="namespaceStep33.html">Step33</a>;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (argc != 2)</div>
<div class="line">        {</div>
<div class="line">          std::cout &lt;&lt; <span class="stringliteral">&quot;Usage:&quot;</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">&quot; input_file&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">          std::exit(1);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classUtilities_1_1MPI_1_1MPI__InitFinalize.html">Utilities::MPI::MPI_InitFinalize</a> mpi_initialization(</div>
<div class="line">        argc, argv, ::<a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>);</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classStep33_1_1ConservationLaw.html">ConservationLaw&lt;2&gt;</a> cons(argv[1]);</div>
<div class="line">      cons.run();</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (<a class="code" href="parameter__handler__0_8txt.html#ad919e2b915d8e8226aef004c2d8399a8">std::exception</a> &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p><br  />
 This tutorial depends on <a class="el" href="step_12.html">step-12</a> , <a class="el" href="step_71.html">step-71</a> .  
<table class="tutorial" width="50%">
<tr><th colspan="2"><b><small>Table of contents</small></b><b><small>Table of contents</small></b></th></tr>
<tr><td width="50%" valign="top">
<ol>
  <li> <a href="#Intro" class=bold>Introduction</a><a href="#Intro" class=bold>Introduction</a>
    <ul>
        <li><a href="#Eulerflow">Euler flow</a><a href="#Eulerflow">Euler flow</a>
        <li><a href="#Discretization">Discretization</a><a href="#Discretization">Discretization</a>
        <li><a href="#Automaticdifferentiation"> Automatic differentiation </a><a href="#Automaticdifferentiation"> Automatic differentiation </a>
        <li><a href="#Trilinossolvers"> Trilinos solvers </a><a href="#Trilinossolvers"> Trilinos solvers </a>
        <li><a href="#Adaptivity"> Adaptivity </a><a href="#Adaptivity"> Adaptivity </a>
        <li><a href="#Inputdeckinitialandboundaryconditions">Input deck, initial and boundary conditions</a><a href="#Inputdeckinitialandboundaryconditions">Input deck, initial and boundary conditions</a>
        <li><a href="#Implementation">Implementation</a><a href="#Implementation">Implementation</a>
    </ul>
  <li> <a href="#CommProg" class=bold>The commented program</a><a href="#CommProg" class=bold>The commented program</a>
    <ul>
        <li><a href="#Includefiles">Include files</a><a href="#Includefiles">Include files</a>
        <li><a href="#Eulerequationspecifics">Euler equation specifics</a><a href="#Eulerequationspecifics">Euler equation specifics</a>
      <ul>
        <li><a href="#Componentdescription">Component description</a><a href="#Componentdescription">Component description</a>
        <li><a href="#Transformationsbetweenvariables">Transformations between variables</a><a href="#Transformationsbetweenvariables">Transformations between variables</a>
        <li><a href="#EulerEquationscompute_flux_matrix">EulerEquations::compute_flux_matrix</a><a href="#EulerEquationscompute_flux_matrix">EulerEquations::compute_flux_matrix</a>
        <li><a href="#EulerEquationscompute_normal_flux">EulerEquations::compute_normal_flux</a><a href="#EulerEquationscompute_normal_flux">EulerEquations::compute_normal_flux</a>
        <li><a href="#EulerEquationscompute_forcing_vector">EulerEquations::compute_forcing_vector</a><a href="#EulerEquationscompute_forcing_vector">EulerEquations::compute_forcing_vector</a>
        <li><a href="#Dealingwithboundaryconditions">Dealing with boundary conditions</a><a href="#Dealingwithboundaryconditions">Dealing with boundary conditions</a>
        <li><a href="#EulerEquationscompute_refinement_indicators">EulerEquations::compute_refinement_indicators</a><a href="#EulerEquationscompute_refinement_indicators">EulerEquations::compute_refinement_indicators</a>
        <li><a href="#EulerEquationsPostprocessor">EulerEquations::Postprocessor</a><a href="#EulerEquationsPostprocessor">EulerEquations::Postprocessor</a>
      </ul>
        <li><a href="#Runtimeparameterhandling">Run time parameter handling</a><a href="#Runtimeparameterhandling">Run time parameter handling</a>
      <ul>
        <li><a href="#ParametersSolver">Parameters::Solver</a><a href="#ParametersSolver">Parameters::Solver</a>
        <li><a href="#ParametersRefinement">Parameters::Refinement</a><a href="#ParametersRefinement">Parameters::Refinement</a>
        <li><a href="#ParametersFlux">Parameters::Flux</a><a href="#ParametersFlux">Parameters::Flux</a>
        <li><a href="#ParametersOutput">Parameters::Output</a><a href="#ParametersOutput">Parameters::Output</a>
        <li><a href="#ParametersAllParameters">Parameters::AllParameters</a><a href="#ParametersAllParameters">Parameters::AllParameters</a>
      </ul>
        <li><a href="#Conservationlawclass">Conservation law class</a><a href="#Conservationlawclass">Conservation law class</a>
      <ul>
        <li><a href="#ConservationLawConservationLaw">ConservationLaw::ConservationLaw</a><a href="#ConservationLawConservationLaw">ConservationLaw::ConservationLaw</a>
        <li><a href="#ConservationLawsetup_system">ConservationLaw::setup_system</a><a href="#ConservationLawsetup_system">ConservationLaw::setup_system</a>
        <li><a href="#ConservationLawassemble_system">ConservationLaw::assemble_system</a><a href="#ConservationLawassemble_system">ConservationLaw::assemble_system</a>
        <li><a href="#ConservationLawassemble_cell_term">ConservationLaw::assemble_cell_term</a><a href="#ConservationLawassemble_cell_term">ConservationLaw::assemble_cell_term</a>
        <li><a href="#ConservationLawassemble_face_term">ConservationLaw::assemble_face_term</a><a href="#ConservationLawassemble_face_term">ConservationLaw::assemble_face_term</a>
        <li><a href="#ConservationLawsolve">ConservationLaw::solve</a><a href="#ConservationLawsolve">ConservationLaw::solve</a>
        <li><a href="#ConservationLawcompute_refinement_indicators">ConservationLaw::compute_refinement_indicators</a><a href="#ConservationLawcompute_refinement_indicators">ConservationLaw::compute_refinement_indicators</a>
        <li><a href="#ConservationLawrefine_grid">ConservationLaw::refine_grid</a><a href="#ConservationLawrefine_grid">ConservationLaw::refine_grid</a>
        <li><a href="#ConservationLawoutput_results">ConservationLaw::output_results</a><a href="#ConservationLawoutput_results">ConservationLaw::output_results</a>
        <li><a href="#ConservationLawrun">ConservationLaw::run</a><a href="#ConservationLawrun">ConservationLaw::run</a>
      </ul>
        <li><a href="#main">main()</a><a href="#main">main()</a>
      </ul>
</ol></td><td width="50%" valign="top"><ol>
  <li value="3"> <a href="#Results" class=bold>Results</a><a href="#Results" class=bold>Results</a>
    <ul>
        <li><a href="#Possibilitiesforextensions">Possibilities for extensions</a><a href="#Possibilitiesforextensions">Possibilities for extensions</a>
      <ul>
        <li><a href="#Stabilization">Stabilization</a><a href="#Stabilization">Stabilization</a>
        <li><a href="#Betterlinearsolvers">Better linear solvers</a><a href="#Betterlinearsolvers">Better linear solvers</a>
        <li><a href="#Cachetheexplicitpartofresidual">Cache the explicit part of residual</a><a href="#Cachetheexplicitpartofresidual">Cache the explicit part of residual</a>
        <li><a href="#Otherconservationlaws">Other conservation laws</a><a href="#Otherconservationlaws">Other conservation laws</a>
    </ul>
    </ul>
  <li> <a href="#PlainProg" class=bold>The plain program</a><a href="#PlainProg" class=bold>The plain program</a>
</ol> </td> </tr> </table>
 <br  />
 <br  />
 <em> This program was written for fun by David Neckels (NCAR) while working at Sandia (on the Wyoming Express bus to and from Corrales each day). The main purpose was to better understand Euler flow. The code solves the basic Euler equations of gas dynamics, by using a fully implicit Newton iteration (inspired by Sandia's Aria code). The code may be configured by an input file to run different simulations on different meshes, with differing boundary conditions. <br  />
 The original code and documentation was later slightly modified by Wolfgang Bangerth to make it more modular and allow replacing the parts that are specific to the Euler equations by other hyperbolic conservation laws without too much trouble. </em> </p><dl class="section note"><dt>Note</dt><dd>The program uses the <a href="http://trilinos.org">Trilinos</a> linear solvers (these can be foundin Trilinos in the Aztec/Amesos packages) and an automaticdifferentiation package, Sacado, also part of Trilinos. deal.II mustbe configured to use Trilinos. Refer to the <a href="../../readme.html#trilinos">ReadMe</a> file for instructions how todo this. </dd>
<dd>
While this program demonstrates the use of automatic differentiationwell, it does not express the state of the art in Euler equation solvers.There are much faster and more accurate method for this equation, andyou should take a look at <a class="el" href="step_67.html">step-67</a> and <a class="el" href="step_69.html">step-69</a> to see how this equationcan be solved more efficiently.</dd></dl>
<p><a class="anchor" id="Introduction"></a><a class="anchor" id="Intro"></a> </p><h1>Introduction</h1>
<p><a class="anchor" id="Eulerflow"></a></p><h3>Euler flow</h3>
<p>The equations that describe the movement of a compressible, inviscidgas (the so-called Euler equations of gas dynamics) area basic system of conservation laws. In spatial dimension \(d\) they read </p><p class="formulaDsp">
\[ \partial_t \mathbf{w} + \nabla \cdot \mathbf{F}(\mathbf{w}) = \mathbf{G}(\mathbf w), \]
</p>
<p>@_fakenlwith the solution \(\mathbf{w}=(\rho v_1,\ldots,\rho v_d,\rho, E)^{\top}\) consisting of \(\rho\) the fluid density, \({\mathbf v}=(v_1,\ldots v_d)^T\) theflow velocity (and thus \(\rho\mathbf v\) being the linear momentumdensity), and \(E\) the energy density of the gas. We interpret the equations above as \(\partial_t \mathbf{w}_i + \nabla \cdot \mathbf{F}_i(\mathbf{w}) = \mathbf G_i(\mathbf w)\) , \(i=1,\ldots,dim+2\) . For the Euler equations, the flux matrix \(\mathbf F\) (or system of flux functions)is defined as (shown here for the case \(d=3\) ) </p><p class="formulaDsp">
\begin{eqnarray*} \mathbf F(\mathbf w) = \left( \begin{array}{ccc} \rho v_1^2+p &amp; \rho v_2v_1 &amp; \rho v_3v_1 \\ \rho v_1v_2 &amp; \rho v_2^2+p &amp; \rho v_3v_2 \\ \rho v_1v_3 &amp; \rho v_2v_3 &amp; \rho v_3^2+p \\ \rho v_1 &amp; \rho v_2 &amp; \rho v_3 \\ (E+p) v_1 &amp; (E+p) v_2 &amp; (E+p) v_3 \end{array} \right), \end{eqnarray*}
</p>
<p> and we will choose as particular right hand side forcing only the effects ofgravity, described by </p><p class="formulaDsp">
\begin{eqnarray*} \mathbf G(\mathbf w) = \left( \begin{array}{c} g_1\rho \\ g_2\rho \\ g_3\rho \\ 0 \\ \rho \mathbf g \cdot \mathbf v \end{array} \right), \end{eqnarray*}
</p>
<p> where \(\mathbf g=(g_1,g_2,g_3)^T\) denotes the gravity vector.With this, the entire system of equations reads: </p><p class="formulaDsp">
\begin{eqnarray*} \partial_t (\rho v_i) + \sum_{s=1}^d \frac{\partial(\rho v_i v_s + \delta_{is} p)}{\partial x_s} &amp;=&amp; g_i \rho, \qquad i=1,\dots,d, \\ \partial_t \rho + \sum_{s=1}^d \frac{\partial(\rho v_s)}{\partial x_s} &amp;=&amp; 0, \\ \partial_t E + \sum_{s=1}^d \frac{\partial((E+p)v_s)}{\partial x_s} &amp;=&amp; \rho \mathbf g \cdot \mathbf v. \end{eqnarray*}
</p>
<p> These equations describe, respectively, the conservation of momentum,mass, and energy.The system is closed by a relation that defines the pressure: \(p = (\gamma -1)(E-\frac{1}{2} \rho |\mathbf v|^2)\) . For the constituentsof air (mainly nitrogen and oxygen) and other diatomic gases, the ratio ofspecific heats is \(\gamma=1.4\) . This problem obviously falls into the class of vector-valuedproblems. A general overview of how to deal with these problems indeal.II can be found in the <a class="el" href="group__vector__valued.html">Handling vector valued problems</a> module. <a class="anchor" id="Discretization"></a></p><h3>Discretization</h3>
<p>Discretization happens in the usual way, taking into account that thisis a hyperbolic problem in the same style as the simple one discussedin <a class="el" href="step_12.html">step-12</a> :We choose a finite element space \(V_h\) , and integrate our conservation law againstour (vector-valued) test function \(\mathbf{z} \in V_h\) . We then integrate by parts and approximate theboundary flux with a <em> numerical </em> flux \(\mathbf{H}\) , </p><p class="formulaDsp">
\begin{eqnarray*} &amp;&amp;\int_{\Omega} (\partial_t \mathbf{w}, \mathbf{z}) + (\nabla \cdot \mathbf{F}(\mathbf{w}), \mathbf{z}) \\ &amp;\approx &amp;\int_{\Omega} (\partial_t \mathbf{w}, \mathbf{z}) - (\mathbf{F}(\mathbf{w}), \nabla \mathbf{z}) + h^{\eta}(\nabla \mathbf{w} , \nabla \mathbf{z}) + \int_{\partial \Omega} (\mathbf{H}(\mathbf{w}^+, \mathbf{w}^-, \mathbf{n}), \mathbf{z}^+), \end{eqnarray*}
</p>
<p> where a superscript \(+\) denotes the interior trace of a function, and \(-\) represents the outer trace.The diffusion term \(h^{\eta}(\nabla \mathbf{w} , \nabla \mathbf{z})\) is introduced strictly for stability, where \(h\) is the mesh size and \(\eta\) is a parameter prescribing how much diffusion to add. On the boundary, we have to say what the outer trace \(\mathbf{w}^-\) is.Depending on the boundary condition, we prescribe either of the following: </p><ul>
<li>
Inflow boundary: \(\mathbf{w}^-\) is prescribed to be the desired value. </li>
<li>
Supersonic outflow boundary: \(\mathbf{w}^- = \mathbf{w}^+\) </li>
<li>
Subsonic outflow boundary: \(\mathbf{w}^- = \mathbf{w}^+\) except that the energy variableis modified to support a prescribed pressure \(p_o\) , i.e. \(\mathbf{w}^- =(\rho^+, \rho v_1^+, \dots, \rho v_d^+, p_o/(\gamma -1) + 0.5 \rho |\mathbf{v}^+|^2)\) </li>
<li>
Reflective boundary: we set \(\mathbf{w}^-\) so that \((\mathbf{v}^+ + \mathbf{v}^-) \cdot \mathbf{n} = 0\) and \(\rho^- = \rho^+,E^-=E^+\) . </li>
</ul>
<p>More information on these issues can be found, for example, in RalfHartmann's PhD thesis ("Adaptive Finite Element Methods for theCompressible Euler Equations", PhD thesis, University of Heidelberg, 2002). We use a time stepping scheme to substitute the time derivative in theabove equations. For simplicity, we define \( \mathbf{B}({\mathbf{w}_{n}})(\mathbf z) \) as the spatial residual at time step \(n\) : </p><p class="formulaDsp">
\begin{eqnarray*} \mathbf{B}(\mathbf{w}_{n})(\mathbf z) &amp;=&amp; - \int_{\Omega} \left(\mathbf{F}(\mathbf{w}_n), \nabla\mathbf{z}\right) + h^{\eta}(\nabla \mathbf{w}_n , \nabla \mathbf{z}) \\ &amp;&amp; + \int_{\partial \Omega} \left(\mathbf{H}(\mathbf{w}_n^+, \mathbf{w}^-(\mathbf{w}_n^+), \mathbf{n}), \mathbf{z}\right) - \int_{\Omega} \left(\mathbf{G}(\mathbf{w}_n), \mathbf{z}\right) . \end{eqnarray*}
</p>
<p>At each time step, our full discretization is thusthat the residual applied to any testfunction \(\mathbf z\) equals zero: </p><p class="formulaDsp">
\begin{eqnarray*} R(\mathbf{W}_{n+1})(\mathbf z) &amp;=&amp; \int_{\Omega} \left(\frac{{\mathbf w}_{n+1} - \mathbf{w}_n}{\delta t}, \mathbf{z}\right)+ \theta \mathbf{B}({\mathbf{w}}_{n+1}) + (1-\theta) \mathbf{B}({\mathbf w}_{n}) \\ &amp;=&amp; 0 \end{eqnarray*}
</p>
<p> where \( \theta \in [0,1] \) and \(\mathbf{w}_i = \sum_k \mathbf{W}_i^k \mathbf{\phi}_k\) . Choosing \(\theta=0\) results in the explicit (forward) Euler scheme, \(\theta=1\) in the stable implicit (backward) Euler scheme, and \(\theta=\frac 12\) in the Crank-Nicolson scheme. In the implementation below, we choose the Lax-Friedrichs flux for thefunction \(\mathbf H\) , i.e. \(\mathbf{H}(\mathbf{a},\mathbf{b},\mathbf{n}) = \frac{1}{2}(\mathbf{F}(\mathbf{a})\cdot \mathbf{n} + \mathbf{F}(\mathbf{b})\cdot \mathbf{n} + \alpha (\mathbf{a} - \mathbf{b}))\) ,where \(\alpha\) is either a fixed number specified in the input file, or where \(\alpha\) is a mesh dependent value. In the latter case, it is chosen as \(\frac{h}{2\delta T}\) with \(h\) the diameter of the face to which the flux isapplied, and \(\delta T\) the current time step. With these choices, equating the residual to zero results in anonlinear system of equations \(R(\mathbf{W}_{n+1})=0\) . We solve this nonlinear system by aNewton iteration (in the same way as explained in <a class="el" href="step_15.html">step-15</a> ), i.e. by iterating </p><p class="formulaDsp">
\begin{eqnarray*} R&#39;(\mathbf{W}^k_{n+1},\delta \mathbf{W}_{n+1}^k)(\mathbf z) &amp; = &amp; - R(\mathbf{W}^{k}_{n+1})(\mathbf z) \qquad \qquad \forall \mathbf z\in V_h \\ \mathbf{W}^{k+1}_{n+1} &amp;=&amp; \mathbf{W}^k_{n+1} + \delta \mathbf{W}^k_{n+1}, \end{eqnarray*}
</p>
<p> until \(|R(\mathbf{W}^k_{n+1})|\) (the residual) is sufficiently small. Bytesting with the nodal basis of a finite element space instead of all \(\mathbf z\) , we arrive at a linear system for \(\delta \mathbf W\) : </p><p class="formulaDsp">
\begin{eqnarray*} \mathbf R&#39;(\mathbf{W}^k_{n+1})\delta \mathbf{W}^k_{n+1} &amp; = &amp; - \mathbf R(\mathbf{W}^{k}_{n+1}). \end{eqnarray*}
</p>
<p> This linear system is, in general, neither symmetric nor has anyparticular definiteness properties. We will either use a direct solveror Trilinos' GMRES implementation to solve it. As will become apparent fromthe <a href="#Results">results shown below</a>, this fully implicit iterationconverges very rapidly (typically in 3 steps) and with the quadraticconvergence order expected from a Newton method.</p>
<p><a class="anchor" id="Automaticdifferentiation"></a></p><h3>Automatic differentiation </h3>
<p>Since computing the Jacobian matrix \(\mathbf R&#39;(\mathbf W^k)\) is aterrible beast, we use an automatic differentiation package, Sacado,to do this. Sacado is a package within the <a href="http://trilinos.org" target="_top">Trilinos</a> frameworkand offers a C++ template class <code>Sacado::Fad::DFad</code> ( <code>Fad</code> standing for "forward automaticdifferentiation") that supports basic arithmetic operators andfunctions such as <code> sqrt, sin, cos, pow, </code> etc. In order touse this feature, one declares a collection of variables of this typeand then denotes some of this collection as degrees of freedom, the rest ofthe variables being functions of the independent variables. Thesevariables are used in an algorithm, and as the variables are used,their sensitivities with respect to the degrees of freedom arecontinuously updated. One can imagine that for the full Jacobian matrix as a whole,this could be prohibitively expensive: the number of independent variables arethe \(\mathbf W^k\) , the dependent variables the elements of the vector \(\mathbf R(\mathbf W^k)\) . Both of these vectors can easily have tens of thousands ofelements or more. However, it is important to note that not all elements of \(\mathbf R\) depend on all elements of \(\mathbf W^k\) : in fact, an entry in \(\mathbf R\) only depends on an element of \(\mathbf W^k\) if the twocorresponding shape functions overlap and couple in the weak form. Specifically, it is wise to define a minimum set ofindependent AD variables that the residual on the current cell may possiblydepend on: on every element, we define those variables asindependent that correspond to the degrees of freedom defined on thiscell (or, if we have to compute jump terms between cells, thatcorrespond to degrees of freedom defined on either of the two adjacentcells), and the dependent variables are the elements of the localresidual vector. Not doing this, i.e. defining <em>all</em> elements of \(\mathbf W^k\) as independent, will result a very expensive computationof a lot of zeros: the elements of the local residual vector areindependent of almost all elements of the solution vector, andconsequently their derivatives are zero; however, trying to computethese zeros can easily take 90% or more of the compute time of theentire program, as shown in an experiment inadvertently made by a student a fewyears after this program was first written.</p>
<p>Coming back to the question of computing the Jacobian automatically:The author has used this approach side by side with a hand coded Jacobian forthe incompressible Navier-Stokes problem and found the Sacado approach to bejust as fast as using a hand coded Jacobian, but infinitely simpler and lesserror prone: Since using the auto-differentiation requires only that one codethe residual \(R(\mathbf{W})\) , ensuring code correctness and maintaining codebecomes tremendously more simple</p>
<ul>
<li>the Jacobian matrix \(\mathbf R&#39;\) iscomputed by essentially the same code that also computes the residual \(\mathbf R\) . All this said, here's a very simple example showing how Sacado can beused: <div class="fragment"><div class="line"><span class="preprocessor">#include &lt;Sacado.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line">  </div>
<div class="line"><span class="keyword">using</span> fad_double = Sacado::Fad::DFad&lt;double&gt;;</div>
<div class="line">  </div>
<div class="line"><a class="code" href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>() {</div>
<div class="line">  </div>
<div class="line">  fad_double <a class="code" href="function__tools__0_8txt.html#a1a2acf608502527a80c0aeecdc12c908">a</a>,<a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a>,<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>;</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="function__tools__0_8txt.html#a1a2acf608502527a80c0aeecdc12c908">a</a> = 1; <a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a> = 2;</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="function__tools__0_8txt.html#a1a2acf608502527a80c0aeecdc12c908">a</a>.diff(0,2);  <span class="comment">// Set a to be dof 0, in a 2-dof system.</span></div>
<div class="line">  </div>
<div class="line">  <a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a>.diff(1,2);  <span class="comment">// Set b to be dof 1, in a 2-dof system.</span></div>
<div class="line">  </div>
<div class="line">  <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a> = 2*<a class="code" href="function__tools__0_8txt.html#a1a2acf608502527a80c0aeecdc12c908">a</a>+<a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="function__tools__0_8txt.html#a1a2acf608502527a80c0aeecdc12c908">a</a>*<a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a>);</div>
<div class="line">  </div>
<div class="line">  doublederivs = &amp;<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>.fastAccessDx(0); <span class="comment">// Access derivatives</span></div>
<div class="line">  </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;dc/da = &quot;</span> &lt;&lt; derivs[0] &lt;&lt; <span class="stringliteral">&quot;, dc/db=&quot;</span> &lt;&lt; derivs[1] &lt;&lt; std::endl;</div>
<div class="line">  </div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ul>
<p>The output are the derivatives \(\frac{\partial c(a,b)}{\partial a}, \frac{\partial c(a,b)}{\partial b}\) of \(c(a,b)=2a+\cos(ab)\) at \(a=1,b=2\) . It should be noted that Sacado provides more auto-differentiation capabilities than the small subsetused in this program. However, understanding the example above isenough to understand the use of Sacado in this Euler flow program. <a class="anchor" id="Trilinossolvers"></a></p><h3>Trilinos solvers </h3>
<p>The program uses either the Aztec iterative solvers, or the Amesossparse direct solver, both provided bythe Trilinos package. This package is inherently designed to be used in a parallel program, however,it may be used in serial just as easily, as is done here. The Epetra package is the basicvector/matrix library upon which the solvers are built. This very powerful package can be usedto describe the parallel distribution of a vector, and to define sparse matrices that operateon these vectors. Please view the commented code for more details on how these solvers are usedwithin the example. <a class="anchor" id="Adaptivity"></a></p><h3>Adaptivity </h3>
<p>The example uses an ad hoc refinement indicator that shows some usefulness in shock-type problems, andin the downhill flow example included. We refine according to the squared gradient of the density.Hanging nodes are handled by computing the numerical flux across cells that are of differingrefinement levels, rather than using the <a class="el" href="classAffineConstraints.html">AffineConstraints</a> class as inall other tutorial programs so far. In this way, the example combinesthe continuous and DG methodologies. It also simplifies the generationof the Jacobian because we do not have to track constrained degrees offreedom through the automatic differentiation used to compute it. </p><dl class="section note"><dt>Note</dt><dd>Whereas this program was written in 2008, we were unaware of anypublication that would actually have used this approach. However, amore recent paper by A. Dedner, R. Kl&ouml;fkorn, and M. Kr&auml;nkel("Continuous Finite-Elements on Non-Conforming Grids UsingDiscontinuous Galerkin Stabilization", Proceedings of Finite Volumesfor Complex Applications VII</dd></dl>
<ul>
<li>Methods and Theoretical Aspects,Springer, 2014) comes close. Further, we enforce a maximum number of refinement levels to keep refinement under check. It is theauthor's experience that for adaptivity for a time dependent problem, refinement can easily lead the simulation toa screeching halt, because of time step restrictions if the meshbecomes too fine in any part of the domain, if care is not taken. The amount of refinement islimited in the example by letting the user specify themaximum level of refinement that will be present anywhere in the mesh. In this way, refinementtends not to slow the simulation to a halt. This, of course, is purely a heuristic strategy, andif the author's advisor heard about it, the author would likely be exiled forever from the finite element error estimation community. <a class="anchor" id="Inputdeckinitialandboundaryconditions"></a><h3>Input deck, initial and boundary conditions</h3>
</li>
</ul>
<p>We use an input file deck to drive the simulation. In this way, we can alter the boundary conditionsand other important properties of the simulation without having to recompile. For more information onthe format, look at the <a href="#Results">results section</a>, where wedescribe an example input file in more detail. In previous example programs, we have usually hard-coded the initialand boundary conditions. In this program, we instead use theexpression parser class <a class="el" href="classFunctionParser.html">FunctionParser</a> so that we can specify ageneric expression in the input file and have it parsed at run time &mdash;this way, we can change initial conditions without the need torecompile the program. Consequently, no classes namedInitialConditions or BoundaryConditions will be declared in theprogram below.</p>
<p><a class="anchor" id="Implementation"></a></p><h3>Implementation</h3>
<p>The implementation of this program is split into three essential parts: </p><ul>
<li>
The <code>EulerEquations</code> class that encapsulates everything that completely describes the specifics of the Euler equations. This includes the flux matrix \(\mathbf F(\mathbf W)\) , the numerical flux \(\mathbf F(\mathbf W^+,\mathbf W^-,\mathbf n)\) , the right hand side \(\mathbf G(\mathbf W)\) , boundary conditions, refinement indicators, postprocessing the output, and similar things that require knowledge of the meaning of the individual components of the solution vectors and the equations. </li>
<li>
A namespace that deals with everything that has to do with run-time parameters. </li>
<li>
The <code>ConservationLaw</code> class that deals with time stepping, outer nonlinear and inner linear solves, assembling the linear systems, and the top-level logic that drives all this. </li>
</ul>
<p><br  />
 The reason for this approach is that it separates the various concerns in aprogram: the <code>ConservationLaw</code> is written in such a way that itwould be relatively straightforward to adapt it to a different set ofequations: One would simply re-implement the members of the <code>EulerEquations</code> class for some other hyperbolic equation, oraugment the existing equations by additional ones (for example by advectingadditional variables, or by adding chemistry, etc). Such modifications,however, would not affect the time stepping, or the nonlinear solvers ifcorrectly done, and consequently nothing in the <code>ConservationLaw</code> would have to be modified. Similarly, if we wanted to improve on the linear or nonlinear solvers, or onthe time stepping scheme (as hinted at the end of the <a href="#Results">results section</a>), then this would not require changes inthe <code>EulerEquations</code> at all.</p>
<p><a class="anchor" id="CommProg"></a> </p><h1>The commented program</h1>
<p><a class="anchor" id="Includefiles"></a> </p><h3>Include files</h3>
<p>First a standard set of deal.II includes. Nothing special to comment on here:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2parameter__handler_8h.html">deal.II/base/parameter_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2function__parser_8h.html">deal.II/base/function_parser.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="include_2deal_8II_2base_2utilities_8h.html">deal.II/base/utilities.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2conditional__ostream_8h.html">deal.II/base/conditional_ostream.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2vector_8h.html">deal.II/lac/vector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__out_8h.html">deal.II/grid/grid_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__refinement_8h.html">deal.II/grid/grid_refinement.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__in_8h.html">deal.II/grid/grid_in.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__values_8h.html">deal.II/fe/fe_values.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__system_8h.html">deal.II/fe/fe_system.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2mapping__q1_8h.html">deal.II/fe/mapping_q1.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2solution__transfer_8h.html">deal.II/numerics/solution_transfer.h</a>&gt;</span></div>
</div><!-- fragment --><p>Then, as mentioned in the introduction, we use various Trilinos packages as linear solvers as well as for automatic differentiation. These are in the following include files.</p>
<p>Since deal.II provides interfaces to the basic Trilinos matrices, preconditioners and solvers, we include them similarly as deal.II linear algebra structures.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2trilinos__sparse__matrix_8h.html">deal.II/lac/trilinos_sparse_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2trilinos__precondition_8h.html">deal.II/lac/trilinos_precondition.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2trilinos__solver_8h.html">deal.II/lac/trilinos_solver.h</a>&gt;</span></div>
</div><!-- fragment --><p>Sacado is the automatic differentiation package within Trilinos, which is used to find the Jacobian for a fully implicit Newton iteration:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;Sacado.hpp&gt;</span></div>
</div><!-- fragment --><p>And this again is C++:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;array&gt;</span></div>
</div><!-- fragment --><p>To end this section, introduce everything in the dealii library into the namespace into which the contents of this program will go:</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceStep33.html">Step33</a></div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
</div><!-- fragment --><p><a class="anchor" id="Eulerequationspecifics"></a> </p><h3>Euler equation specifics</h3>
<p>Here we define the flux function for this particular system of conservation laws, as well as pretty much everything else that's specific to the Euler equations for gas dynamics, for reasons discussed in the introduction. We group all this into a structure that defines everything that has to do with the flux. All members of this structure are static, i.e. the structure has no actual state specified by instance member variables. The better way to do this, rather than a structure with all static members would be to use a namespace</p>
<ul>
<li>but namespaces can't be templatized and we want some of the member variables of the structure to depend on the space dimension, which we in our usual way introduce using a template parameter.</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">struct </span>EulerEquations</div>
<div class="line">{</div>
</div><!-- fragment --><p><a class="anchor" id="Componentdescription"></a> </p><h4>Component description</h4>
<p>First a few variables that describe the various components of our solution vector in a generic way. This includes the number of components in the system (Euler's equations have one entry for momenta in each spatial direction, plus the energy and density components, for a total of <code>dim+2</code> components), as well as functions that describe the index within the solution vector of the first momentum component, the density component, and the energy density component. Note that all these numbers depend on the space dimension; defining them in a generic way (rather than by implicit convention) makes our code more flexible and makes it easier to later extend it, for example by adding more components to the equations.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>             = <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> + 2;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> first_momentum_component = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> density_component        = <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> energy_component         = <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> + 1;</div>
</div><!-- fragment --><p>When generating graphical output way down in this program, we need to specify the names of the solution variables as well as how the various components group into vector and scalar fields. We could describe this there, but in order to keep things that have to do with the Euler equation localized here and the rest of the program as generic as possible, we provide this sort of information in the following two functions:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> std::vector&lt;std::string&gt; component_names()</div>
<div class="line">{</div>
<div class="line">  std::vector&lt;std::string&gt; <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>(<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>, <span class="stringliteral">&quot;momentum&quot;</span>);</div>
<div class="line">  <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>.emplace_back(<span class="stringliteral">&quot;density&quot;</span>);</div>
<div class="line">  <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>.emplace_back(<span class="stringliteral">&quot;energy_density&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">component_interpretation()</div>
<div class="line">{</div>
<div class="line">  std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">    data_component_interpretation(</div>
<div class="line">      <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>, <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a9b7d9c85221484e1998f6869d98cba8b">DataComponentInterpretation::component_is_part_of_vector</a>);</div>
<div class="line">  data_component_interpretation.push_back(</div>
<div class="line">    <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa4924d31df0211f3fb9db3bbe1af0d1c">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line">  data_component_interpretation.push_back(</div>
<div class="line">    <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa4924d31df0211f3fb9db3bbe1af0d1c">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> data_component_interpretation;</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Transformationsbetweenvariables"></a> </p><h4>Transformations between variables</h4>
<p>Next, we define the gas constant. We will set it to 1.4 in its definition immediately following the declaration of this class (unlike integer variables, like the ones above, static const floating point member variables cannot be initialized within the class declaration in C++). This value of 1.4 is representative of a gas that consists of molecules composed of two atoms, such as air which consists up to small traces almost entirely of \(N_2\) and \(O_2\) .</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> gas_gamma;</div>
</div><!-- fragment --><p>In the following, we will need to compute the kinetic energy and the pressure from a vector of conserved variables. This we can do based on the energy density and the kinetic energy \(\frac 12 \rho |\mathbf v|^2 = \frac{|\rho \mathbf v|^2}{2\rho}\) (note that the independent variables contain the momentum components \(\rho v_i\) , not the velocities \(v_i\) ).</p>
<div class="fragment"><div class="line">     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line">     <span class="keyword">static</span> <span class="keyword">typename</span> InputVector::value_type</div>
<div class="line">     compute_kinetic_energy(<span class="keyword">const</span> InputVector &amp;W)</div>
<div class="line">     {</div>
<div class="line">       <span class="keyword">typename</span> InputVector::value_type kinetic_energy = 0;</div>
<div class="line">       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">         kinetic_energy +=</div>
<div class="line">           W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line">       kinetic_energy= 1. / (2 W[density_component]);</div>
<div class="line">  </div>
<div class="line">       <span class="keywordflow">return</span> kinetic_energy;</div>
<div class="line">     }</div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line">     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line">     <span class="keyword">static</span> <span class="keyword">typename</span> InputVector::value_type</div>
<div class="line">     compute_pressure(<span class="keyword">const</span> InputVector &amp;W)</div>
<div class="line">     {</div>
<div class="line">       <span class="keywordflow">return</span> ((gas_gamma</div>
<div class="line">  </div>
<div class="line">- 1.0)</div>
<div class="line">               (W[energy_component]</div>
<div class="line">  </div>
<div class="line">- compute_kinetic_energy(W)));</div>
<div class="line">     }</div>
</div><!-- fragment --><p><a class="anchor" id="EulerEquationscompute_flux_matrix"></a> </p><h4>EulerEquations::compute_flux_matrix</h4>
<p>We define the flux function \(F(W)\) as one large matrix. Each row of this matrix represents a scalar conservation law for the component in that row. The exact form of this matrix is given in the introduction. Note that we know the size of the matrix: it has as many rows as the system has components, and <code>dim</code> columns; rather than using a <a class="el" href="classFullMatrix.html">FullMatrix</a> object for such a matrix (which has a variable number of rows and columns and must therefore allocate memory on the heap each time such a matrix is created), we use a rectangular array of numbers right away. <br  />
 We templatize the numerical type of the flux function so that we may use the automatic differentiation type here. Similarly, we will call the function with different input vector data types, so we templatize on it as well:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> compute_flux_matrix(<span class="keyword">const</span> InputVector &amp;W,</div>
<div class="line">                                <a class="code" href="base_2ndarray_8h.html#a82399009710c9549884b9d8c506ad695">ndarray</a>&lt;<span class="keyword">typename</span> InputVector::value_type,</div>
<div class="line">                                        <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>,</div>
<div class="line">                                        <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt; &amp;     <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>)</div>
<div class="line">{</div>
</div><!-- fragment --><p>First compute the pressure that appears in the flux matrix, and then compute the first <code>dim</code> columns of the matrix that correspond to the momentum terms:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keyword">typename</span> InputVector::value_type <a class="code" href="mg__transfer__0_8txt.html#a6b401cd9c6154fc787311f58ab910002">pressure</a> = compute_pressure(W);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a> = 0; <a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>)</div>
<div class="line">      <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>][<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>] =</div>
<div class="line">        W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>]</div>
<div class="line">        W[first_momentum_component + <a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>] / W[density_component];</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] += <a class="code" href="mg__transfer__0_8txt.html#a6b401cd9c6154fc787311f58ab910002">pressure</a>;</div>
<div class="line">  }</div>
</div><!-- fragment --><p>Then the terms for the density (i.e. mass conservation), and, lastly, conservation of energy:</p>
<div class="fragment"><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">    <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>[density_component][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] = W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">    <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>[energy_component][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] = W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] /</div>
<div class="line">                                W[density_component]</div>
<div class="line">                                (W[energy_component] + <a class="code" href="mg__transfer__0_8txt.html#a6b401cd9c6154fc787311f58ab910002">pressure</a>);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="EulerEquationscompute_normal_flux"></a> </p><h4>EulerEquations::compute_normal_flux</h4>
<p>On the boundaries of the domain and across hanging nodes we use a numerical flux function to enforce boundary conditions. This routine is the basic Lax-Friedrich's flux with a stabilization parameter \(\alpha\) . It's form has also been given already in the introduction:</p>
<div class="fragment"><div class="line">     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line">     <span class="keyword">static</span> <span class="keywordtype">void</span> numerical_normal_flux(</div>
<div class="line">       <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> &amp;                                      <a class="code" href="global__dof__index__0_8txt.html#a2b84b1d42e4fde15bdf79726ce1cc907">normal</a>,</div>
<div class="line">       <span class="keyword">const</span> InputVector &amp;                                         Wplus,</div>
<div class="line">       <span class="keyword">const</span> InputVector &amp;                                         Wminus,</div>
<div class="line">       <span class="keyword">const</span> <span class="keywordtype">double</span>                                                <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>,</div>
<div class="line">       std::array&lt;typename InputVector::value_type, n_components&gt; &amp;normal_flux)</div>
<div class="line">     {</div>
<div class="line">       <a class="code" href="base_2ndarray_8h.html#a82399009710c9549884b9d8c506ad695">ndarray</a>&lt;<span class="keyword">typename</span> InputVector::value_type,</div>
<div class="line">               <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>,</div>
<div class="line">               <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;</div>
<div class="line">         iflux, oflux;</div>
<div class="line">  </div>
<div class="line">       compute_flux_matrix(Wplus, iflux);</div>
<div class="line">       compute_flux_matrix(Wminus, oflux);</div>
<div class="line">  </div>
<div class="line">       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; di &lt; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>; ++di)</div>
<div class="line">         {</div>
<div class="line">           normal_flux[di] = 0;</div>
<div class="line">           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">             normal_flux[di] += 0.5 (iflux[di][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] + oflux[di][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>]) <a class="code" href="global__dof__index__0_8txt.html#a2b84b1d42e4fde15bdf79726ce1cc907">normal</a>[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line">  </div>
<div class="line">           normal_flux[di] += 0.5 <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a> (Wplus[di]</div>
<div class="line">  </div>
<div class="line">- Wminus[di]);</div>
<div class="line">         }</div>
<div class="line">     }</div>
</div><!-- fragment --><p><a class="anchor" id="EulerEquationscompute_forcing_vector"></a> </p><h4>EulerEquations::compute_forcing_vector</h4>
<p>In the same way as describing the flux function \(\mathbf F(\mathbf w)\) , we also need to have a way to describe the right hand side forcing term. As mentioned in the introduction, we consider only gravity here, which leads to the specific form \(\mathbf G(\mathbf w) = \left( g_1\rho, g_2\rho, g_3\rho, 0, \rho \mathbf g \cdot \mathbf v \right)^T\) , shown here for the 3d case. More specifically, we will consider only \(\mathbf g=(0,0,-1)^T\) in 3d, or \(\mathbf g=(0,-1)^T\) in 2d. This naturally leads to the following function:</p>
<div class="fragment"><div class="line">     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line">     <span class="keyword">static</span> <span class="keywordtype">void</span> compute_forcing_vector(</div>
<div class="line">       <span class="keyword">const</span> InputVector &amp;                                         W,</div>
<div class="line">       std::array&lt;typename InputVector::value_type, n_components&gt; &amp;forcing)</div>
<div class="line">     {</div>
<div class="line">       <span class="keyword">const</span> <span class="keywordtype">double</span> gravity =</div>
<div class="line">  </div>
<div class="line">-1.0;</div>
<div class="line">  </div>
<div class="line">       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a> = 0; <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a> &lt; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>; ++<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>)</div>
<div class="line">         <span class="keywordflow">switch</span> (<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>)</div>
<div class="line">           {</div>
<div class="line">             <span class="keywordflow">case</span> first_momentum_component + <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a></div>
<div class="line">  </div>
<div class="line">- 1:</div>
<div class="line">               forcing[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = gravity W[density_component];</div>
<div class="line">               <span class="keywordflow">break</span>;</div>
<div class="line">             <span class="keywordflow">case</span> energy_component:</div>
<div class="line">               forcing[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = gravity W[first_momentum_component + <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a></div>
<div class="line">  </div>
<div class="line">- 1];</div>
<div class="line">               <span class="keywordflow">break</span>;</div>
<div class="line">             <span class="keywordflow">default</span>:</div>
<div class="line">               forcing[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = 0;</div>
<div class="line">           }</div>
<div class="line">     }</div>
</div><!-- fragment --><p><a class="anchor" id="Dealingwithboundaryconditions"></a> </p><h4>Dealing with boundary conditions</h4>
<p>Another thing we have to deal with is boundary conditions. To this end, let us first define the kinds of boundary conditions we currently know how to deal with:</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> BoundaryKind</div>
<div class="line">{</div>
<div class="line">  inflow_boundary,</div>
<div class="line">  outflow_boundary,</div>
<div class="line">  no_penetration_boundary,</div>
<div class="line">  pressure_boundary</div>
<div class="line">};</div>
</div><!-- fragment --><p>The next part is to actually decide what to do at each kind of boundary. To this end, remember from the introduction that boundary conditions are specified by choosing a value \(\mathbf w^-\) on the outside of a boundary given an inhomogeneity \(\mathbf j\) and possibly the solution's value \(\mathbf w^+\) on the inside. Both are then passed to the numerical flux \(\mathbf H(\mathbf{w}^+, \mathbf{w}^-, \mathbf{n})\) to define boundary contributions to the bilinear form. Boundary conditions can in some cases be specified for each component of the solution vector independently. For example, if component \(c\) is marked for inflow, then \(w^-_c = j_c\) . If it is an outflow, then \(w^-_c = w^+_c\) . These two simple cases are handled first in the function below. There is a little snag that makes this function unpleasant from a C++ language viewpoint: The output vector <code>Wminus</code> will of course be modified, so it shouldn't be a <code>const</code> argument. Yet it is in the implementation below, and needs to be in order to allow the code to compile. The reason is that we call this function at a place where <code>Wminus</code> is of type <code><a class="el" href="classTable.html">Table</a>&lt;2,Sacado::Fad::DFad&lt;double&gt; &gt;</code> , this being 2d table with indices representing the quadrature point and the vector component, respectively. We call this function with <code>Wminus[q]</code> as last argument; subscripting a 2d table yields a temporary accessor object representing a 1d vector, just what we want here. The problem is that a temporary accessor object can't be bound to a non-const reference argument of a function, as we would like here, according to the C++ 1998 and 2003 standards (something that will be fixed with the next standard in the form of rvalue references). We get away with making the output argument here a constant because it is the <em>accessor</em> object that's constant, not the table it points to: that one can still be written to. The hack is unpleasant nevertheless because it restricts the kind of data types that may be used as template argument to this function: a regular vector isn't going to do because that one can not be written to when marked <code>const</code> . With no good solution around at the moment, we'll go with the pragmatic, even if not pretty, solution shown here:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataVector&gt;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">compute_Wminus(<span class="keyword">const</span> std::array&lt;BoundaryKind, n_components&gt; &amp;boundary_kind,</div>
<div class="line">               <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> &amp;                        normal_vector,</div>
<div class="line">               <span class="keyword">const</span> DataVector &amp;                            Wplus,</div>
<div class="line">               <span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;boundary_values,</div>
<div class="line">               <span class="keyword">const</span> DataVector &amp;    Wminus)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a> = 0; <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a> &lt; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>; <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>++)</div>
<div class="line">    <span class="keywordflow">switch</span> (boundary_kind[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>])</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">case</span> inflow_boundary:</div>
<div class="line">          {</div>
<div class="line">            Wminus[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = boundary_values(<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> outflow_boundary:</div>
<div class="line">          {</div>
<div class="line">            Wminus[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = Wplus[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>];</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">          }</div>
</div><!-- fragment --><p>Prescribed pressure boundary conditions are a bit more complicated by the fact that even though the pressure is prescribed, we really are setting the energy component here, which will depend on velocity and pressure. So even though this seems like a Dirichlet type boundary condition, we get sensitivities of energy to velocity and density (unless these are also prescribed):</p>
<div class="fragment"><div class="line">             <span class="keywordflow">case</span> pressure_boundary:</div>
<div class="line">               {</div>
<div class="line">                 <span class="keyword">const</span> <span class="keyword">typename</span> DataVector::value_type <a class="code" href="namespaceStep31_1_1EquationData.html#aa1e9e1a7297b10cb39c2065f86acc66f">density</a> =</div>
<div class="line">                   (boundary_kind[density_component] == inflow_boundary ?</div>
<div class="line">                      boundary_values(density_component) :</div>
<div class="line">                      Wplus[density_component]);</div>
<div class="line">  </div>
<div class="line">                 <span class="keyword">typename</span> DataVector::value_type kinetic_energy = 0;</div>
<div class="line">                 <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">                   <span class="keywordflow">if</span> (boundary_kind[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] == inflow_boundary)</div>
<div class="line">                     kinetic_energy += boundary_values(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>) boundary_values(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>);</div>
<div class="line">                   <span class="keywordflow">else</span></div>
<div class="line">                     kinetic_energy += Wplus[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] Wplus[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line">                 kinetic_energy= 1. / 2. / <a class="code" href="namespaceStep31_1_1EquationData.html#aa1e9e1a7297b10cb39c2065f86acc66f">density</a>;</div>
<div class="line">  </div>
<div class="line">                 Wminus[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] =</div>
<div class="line">                   boundary_values(<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>) / (gas_gamma</div>
<div class="line">  </div>
<div class="line">- 1.0) + kinetic_energy;</div>
<div class="line">  </div>
<div class="line">                 <span class="keywordflow">break</span>;</div>
<div class="line">               }</div>
<div class="line">  </div>
<div class="line">             <span class="keywordflow">case</span> no_penetration_boundary:</div>
<div class="line">               {</div>
</div><!-- fragment --><p>We prescribe the velocity (we are dealing with a particular component here so that the average of the velocities is orthogonal to the surface normal. This creates sensitivities of across the velocity components.</p>
<div class="fragment"><div class="line">                 <span class="keyword">typename</span> DataVector::value_type vdotn = 0;</div>
<div class="line">                 <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>++)</div>
<div class="line">                   {</div>
<div class="line">                     vdotn += Wplus[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] normal_vector[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line">                   }</div>
<div class="line">  </div>
<div class="line">                 Wminus[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = Wplus[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>]</div>
<div class="line">  </div>
<div class="line">- 2.0 vdotn normal_vector[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>];</div>
<div class="line">                 <span class="keywordflow">break</span>;</div>
<div class="line">               }</div>
<div class="line">  </div>
<div class="line">             <span class="keywordflow">default</span>:</div>
<div class="line">               <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">           }</div>
<div class="line">     }</div>
</div><!-- fragment --><p><a class="anchor" id="EulerEquationscompute_refinement_indicators"></a> </p><h4>EulerEquations::compute_refinement_indicators</h4>
<p>In this class, we also want to specify how to refine the mesh. The class <code>ConservationLaw</code> that will use all the information we provide here in the <code>EulerEquation</code> class is pretty agnostic about the particular conservation law it solves: as doesn't even really care how many components a solution vector has. Consequently, it can't know what a reasonable refinement indicator would be. On the other hand, here we do, or at least we can come up with a reasonable choice: we simply look at the gradient of the density, and compute \(\eta_K=\log\left(1+|\nabla\rho(x_K)|\right)\) , where \(x_K\) is the center of cell \(K\) . <br  />
 There are certainly a number of equally reasonable refinement indicators, but this one does, and it is easy to compute:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">compute_refinement_indicators(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div>
<div class="line">                              <span class="keyword">const</span> <a class="code" href="classMapping.html">Mapping&lt;dim&gt;</a> &amp;   <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                              <span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp; <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>,</div>
<div class="line">                              <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;       refinement_indicators)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> = dof_handler.<a class="code" href="classDoFHandler.html#ac1fedeb50b5f03b13d8b69f86e33f726">get_fe</a>().<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>();</div>
<div class="line">  std::vector&lt;unsigned int&gt; <a class="code" href="distributed__0_8txt.html#ad207fe81a5be05e18534713c2677da7b">dofs</a>(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classQMidpoint.html">QMidpoint&lt;dim&gt;</a> quadrature_formula;</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>    update_flags = <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a>;</div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>        fe_v(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                     dof_handler.<a class="code" href="classDoFHandler.html#ac1fedeb50b5f03b13d8b69f86e33f726">get_fe</a>(),</div>
<div class="line">                     quadrature_formula,</div>
<div class="line">                     update_flags);</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;std::vector&lt;Tensor&lt;1, dim&gt;&gt;&gt; dU(</div>
<div class="line">    1, <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a>&gt;(<a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>));</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell_no = <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;active_cell_index();</div>
<div class="line">      fe_v.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line">      fe_v.<a class="code" href="classFEValuesBase.html#ad1f4e0deb5d982e8172d82141c634a67">get_function_gradients</a>(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, dU);</div>
<div class="line"> </div>
<div class="line">      refinement_indicators(cell_no) = <a class="code" href="base_2vectorization_8h.html#a2aa674852f105b0ed1b35f569c19fea6">std::log</a>(</div>
<div class="line">        1 + <a class="code" href="solver__cg__0_8txt.html#a557c71e94a2542d697ca3426b8843cd4">std::sqrt</a>(dU[0][density_component] dU[0][density_component]));</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="EulerEquationsPostprocessor"></a> </p><h4>EulerEquations::Postprocessor</h4>
<p>Finally, we declare a class that implements a postprocessing of data components. The problem this class solves is that the variables in the formulation of the Euler equations we use are in conservative rather than physical form: they are momentum densities \(\mathbf m=\rho\mathbf v\) , density \(\rho\) , and energy density \(E\) . What we would like to also put into our output file are velocities \(\mathbf v=\frac{\mathbf m}{\rho}\) and pressure \(p=(\gamma-1)(E-\frac{1}{2} \rho |\mathbf v|^2)\) . In addition, we would like to add the possibility to generate schlieren plots. Schlieren plots are a way to visualize shocks and other sharp interfaces. The word "schlieren" is a German word that may be translated as "striae"</p>
<ul>
<li>it may be simpler to explain it by an example, however: schlieren is what you see when you, for example, pour highly concentrated alcohol, or a transparent saline solution, into water; the two have the same color, but they have different refractive indices and so before they are fully mixed light goes through the mixture along bent rays that lead to brightness variations if you look at it. That's "schlieren". A similar effect happens in compressible flow because the refractive index depends on the pressure (and therefore the density) of the gas. <br  />
 The origin of the word refers to two-dimensional projections of a three-dimensional volume (we see a 2d picture of the 3d fluid). In computational fluid dynamics, we can get an idea of this effect by considering what causes it: density variations. Schlieren plots are therefore produced by plotting \(s=|\nabla \rho|^2\) ; obviously, \(s\) is large in shocks and at other highly dynamic places. If so desired by the user (by specifying this in the input file), we would like to generate these schlieren plots in addition to the other derived quantities listed above. <br  />
 The implementation of the algorithms to compute derived quantities from the ones that solve our problem, and to output them into data file, rests on the <a class="el" href="classDataPostprocessor.html">DataPostprocessor</a> class. It has extensive documentation, and other uses of the class can also be found in <a class="el" href="step_29.html">step-29</a> . We therefore refrain from extensive comments.</li>
</ul>
<div class="fragment"><div class="line">  <span class="keyword">class </span>Postprocessor : <span class="keyword">public</span> <a class="code" href="classDataPostprocessor.html">DataPostprocessor</a>&lt;dim&gt;</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    Postprocessor(<span class="keyword">const</span> <span class="keywordtype">bool</span> do_schlieren_plot);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classDataPostprocessor.html#a1ba57b598d24d64365d469a854271c68">evaluate_vector_field</a>(</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="structDataPostprocessorInputs_1_1Vector.html">DataPostprocessorInputs::Vector&lt;dim&gt;</a> &amp;inputs,</div>
<div class="line">      <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt; &amp;computed_quantities) <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> std::vector&lt;std::string&gt; <a class="code" href="classDataPostprocessor.html#a254f38bcdf4bdb5aa94231b695da7d55">get_names</a>() <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;</div>
<div class="line">      <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0">DataComponentInterpretation::DataComponentInterpretation</a>&gt;</div>
<div class="line">    <a class="code" href="classDataPostprocessor.html#ae994223acf8a16471ab5e579a4d75053">get_data_component_interpretation</a>() <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> <a class="code" href="classDataPostprocessor.html#aadecdd040447b395164397ea1196f721">get_needed_update_flags</a>() <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> do_schlieren_plot;</div>
<div class="line">  };</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> EulerEquations&lt;dim&gt;::gas_gamma = 1.4;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">EulerEquations&lt;dim&gt;::Postprocessor::Postprocessor(</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">bool</span> do_schlieren_plot)</div>
<div class="line">  : do_schlieren_plot(do_schlieren_plot)</div>
<div class="line">{}</div>
</div><!-- fragment --><p>This is the only function worth commenting on. When generating graphical output, the <a class="el" href="classDataOut.html">DataOut</a> and related classes will call this function on each cell, with access to values, gradients, Hessians, and normal vectors (in case we're working on faces) at each quadrature point. Note that the data at each quadrature point is itself vector-valued, namely the conserved variables. What we're going to do here is to compute the quantities we're interested in at each quadrature point. Note that for this we can ignore the Hessians ("inputs.solution_hessians") and normal vectors ("inputs.normals").</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> EulerEquations&lt;dim&gt;::Postprocessor::evaluate_vector_field(</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="structDataPostprocessorInputs_1_1Vector.html">DataPostprocessorInputs::Vector&lt;dim&gt;</a> &amp;inputs,</div>
<div class="line">  <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt; &amp;               computed_quantities)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
</div><!-- fragment --><p>At the beginning of the function, let us make sure that all variables have the correct sizes, so that we can access individual vector elements without having to wonder whether we might read or write invalid elements; we also check that the <code>solution_gradients</code> vector only contains data if we really need it (the system knows about this because we say so in the <code><a class="el" href="data__postprocessor__0_8txt.html#abfdf708e97518fa7ad2b849b80afddc1">get_needed_update_flags()</a></code> function below). For the inner vectors, we check that at least the first element of the outer vector has the correct inner size:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_quadrature_points = inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a904b46a59d224ec214e4816e584cba5f">solution_values</a>.size();</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a2a918d936d56f2be4cdad1b8074c3a86">solution_gradients</a>.size() == n_quadrature_points,</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(computed_quantities.size() == n_quadrature_points,</div>
<div class="line">       <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a904b46a59d224ec214e4816e584cba5f">solution_values</a>[0].size() == <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>,</div>
<div class="line">       <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(computed_quantities[0].<a class="code" href="function__0_8txt.html#a4f780342f2d5d632f82cf7fd90158a66">size</a>() == <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> + 2, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">  }</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(computed_quantities[0].<a class="code" href="function__0_8txt.html#a4f780342f2d5d632f82cf7fd90158a66">size</a>() == <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> + 1, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">  }</div>
</div><!-- fragment --><p>Then loop over all quadrature points and do our work there. The code should be pretty self-explanatory. The order of output variables is first <code>dim</code> velocities, then the pressure, and if so desired the schlieren plot. Note that we try to be generic about the order of variables in the input vector, using the <code>first_momentum_component</code> and <code>density_component</code> information:</p>
<div class="fragment"><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_quadrature_points; ++q)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespaceStep31_1_1EquationData.html#aa1e9e1a7297b10cb39c2065f86acc66f">density</a> = inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a904b46a59d224ec214e4816e584cba5f">solution_values</a>[q](density_component);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">        computed_quantities[q](<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>) =</div>
<div class="line">          inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a904b46a59d224ec214e4816e584cba5f">solution_values</a>[q](first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>) / <a class="code" href="namespaceStep31_1_1EquationData.html#aa1e9e1a7297b10cb39c2065f86acc66f">density</a>;</div>
<div class="line"> </div>
<div class="line">      computed_quantities[q](<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>) =</div>
<div class="line">        compute_pressure(inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a904b46a59d224ec214e4816e584cba5f">solution_values</a>[q]);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">        computed_quantities[q](<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> + 1) =</div>
<div class="line">          inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a2a918d936d56f2be4cdad1b8074c3a86">solution_gradients</a>[q][density_component]</div>
<div class="line">          inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a2a918d936d56f2be4cdad1b8074c3a86">solution_gradients</a>[q][density_component];</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">std::vector&lt;std::string&gt; <a class="code" href="data__postprocessor__0_8txt.html#afb21caeba7bf26aba89ce705266fedb1">EulerEquations&lt;dim&gt;::Postprocessor::get_names</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  std::vector&lt;std::string&gt; <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">    <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>.emplace_back(<span class="stringliteral">&quot;velocity&quot;</span>);</div>
<div class="line">  <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>.emplace_back(<span class="stringliteral">&quot;pressure&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">    <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>.emplace_back(<span class="stringliteral">&quot;schlieren_plot&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">EulerEquations&lt;dim&gt;::Postprocessor::get_data_component_interpretation()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">    interpretation(<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>,</div>
<div class="line">                   <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a9b7d9c85221484e1998f6869d98cba8b">DataComponentInterpretation::component_is_part_of_vector</a>);</div>
<div class="line"> </div>
<div class="line">  interpretation.push_back(<a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa4924d31df0211f3fb9db3bbe1af0d1c">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">    interpretation.push_back(</div>
<div class="line">      <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa4924d31df0211f3fb9db3bbe1af0d1c">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> interpretation;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a></div>
<div class="line"><a class="code" href="data__postprocessor__0_8txt.html#abfdf708e97518fa7ad2b849b80afddc1">EulerEquations&lt;dim&gt;::Postprocessor::get_needed_update_flags</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a>;</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Runtimeparameterhandling"></a> </p><h3>Run time parameter handling</h3>
<p>Our next job is to define a few classes that will contain run-time parameters (for example solver tolerances, number of iterations, stabilization parameter, and the like). One could do this in the main class, but we separate it from that one to make the program more modular and easier to read: Everything that has to do with run-time parameters will be in the following namespace, whereas the program logic is in the main class. <br  />
 We will split the run-time parameters into a few separate structures, which we will all put into a namespace <code>Parameters</code> . Of these classes, there are a few that group the parameters for individual groups, such as for solvers, mesh refinement, or output. Each of these classes have functions <code><a class="el" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters()</a></code> and <code>parse_parameters()</code> that declare parameter subsections and entries in a <a class="el" href="classParameterHandler.html">ParameterHandler</a> object, and retrieve actual parameter values from such an object, respectively. These classes declare all their parameters in subsections of the <a class="el" href="classParameterHandler.html">ParameterHandler</a>. <br  />
 The final class of the following namespace combines all the previous classes by deriving from them and taking care of a few more entries at the top level of the input file, as well as a few odd other entries in subsections that are too short to warrant a structure by themselves. <br  />
 It is worth pointing out one thing here: None of the classes below have a constructor that would initialize the various member variables. This isn't a problem, however, since we will read all variables declared in these classes from the input file (or indirectly: a <a class="el" href="classParameterHandler.html">ParameterHandler</a> object will read it from there, and we will get the values from this object), and they will be initialized this way. In case a certain variable is not specified at all in the input file, this isn't a problem either: The <a class="el" href="classParameterHandler.html">ParameterHandler</a> class will in this case simply take the default value that was specified when declaring an entry in the <code><a class="el" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters()</a></code> functions of the classes below.</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>Parameters</div>
<div class="line">{</div>
</div><!-- fragment --><p><a class="anchor" id="ParametersSolver"></a> </p><h4>Parameters::Solver</h4>
<p><br  />
 The first of these classes deals with parameters for the linear inner solver. It offers parameters that indicate which solver to use (GMRES as a solver for general non-symmetric indefinite systems, or a sparse direct solver), the amount of output to be produced, as well as various parameters that tweak the thresholded incomplete LU decomposition (ILUT) that we use as a preconditioner for GMRES. <br  />
 In particular, the ILUT takes the following parameters:</p>
<ul>
<li>ilut_fill: the number of extra entries to add when forming the ILU decomposition</li>
<li>ilut_atol, ilut_rtol: When forming the preconditioner, for certain problems bad conditioning (or just bad luck) can cause the preconditioner to be very poorly conditioned. Hence it can help to add diagonal perturbations to the original matrix and form the preconditioner for this slightly better matrix. ATOL is an absolute perturbation that is added to the diagonal before forming the prec, and RTOL is a scaling factor \(rtol \geq 1\) .</li>
<li>ilut_drop: The ILUT will drop any values that have magnitude less than this value. This is a way to manage the amount of memory used by this preconditioner. <br  />
 The meaning of each parameter is also briefly described in the third argument of the <a class="el" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">ParameterHandler::declare_entry</a> call in <code><a class="el" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters()</a></code> .</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Solver</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">enum</span> <a class="code" href="namespaceStep56.html#a3c2f04c8033af75ffedd7bfbf96640a1">SolverType</a></div>
<div class="line">  {</div>
<div class="line">    gmres,</div>
<div class="line">    direct</div>
<div class="line">  };</div>
<div class="line">  <a class="code" href="namespaceStep56.html#a3c2f04c8033af75ffedd7bfbf96640a1">SolverType</a> <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">enum</span> OutputType</div>
<div class="line">  {</div>
<div class="line">    quiet,</div>
<div class="line">    verbose</div>
<div class="line">  };</div>
<div class="line">  OutputType <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> linear_residual;</div>
<div class="line">  <span class="keywordtype">int</span>    max_iterations;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> ilut_fill;</div>
<div class="line">  <span class="keywordtype">double</span> ilut_atol;</div>
<div class="line">  <span class="keywordtype">double</span> ilut_rtol;</div>
<div class="line">  <span class="keywordtype">double</span> ilut_drop;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">  <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Solver::declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;linear solver&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(</div>
<div class="line">      <span class="stringliteral">&quot;output&quot;</span>,</div>
<div class="line">      <span class="stringliteral">&quot;quiet&quot;</span>,</div>
<div class="line">      <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;quiet|verbose&quot;</span>),</div>
<div class="line">      <span class="stringliteral">&quot;State whether output from solver runs should be printed. &quot;</span></div>
<div class="line">      <span class="stringliteral">&quot;Choices are &lt;quiet|verbose&gt;.&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;method&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;gmres&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;gmres|direct&quot;</span>),</div>
<div class="line">                      <span class="stringliteral">&quot;The kind of solver for the linear system. &quot;</span></div>
<div class="line">                      <span class="stringliteral">&quot;Choices are &lt;gmres|direct&gt;.&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;residual&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1e-10&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Linear solver residual&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;max iters&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;300&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Maximum solver iterations&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;ilut fill&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Ilut preconditioner fill&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;ilut absolute tolerance&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1e-9&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Ilut preconditioner tolerance&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;ilut relative tolerance&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1.1&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Ilut relative tolerance&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;ilut drop tolerance&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1e-10&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Ilut drop tolerance&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Solver::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;linear solver&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> std::string op = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;output&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (op == <span class="stringliteral">&quot;verbose&quot;</span>)</div>
<div class="line">      <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a> = verbose;</div>
<div class="line">    <span class="keywordflow">if</span> (op == <span class="stringliteral">&quot;quiet&quot;</span>)</div>
<div class="line">      <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a> = quiet;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> std::string sv = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;method&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (sv == <span class="stringliteral">&quot;direct&quot;</span>)</div>
<div class="line">      <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a> = direct;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sv == <span class="stringliteral">&quot;gmres&quot;</span>)</div>
<div class="line">      <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a> = gmres;</div>
<div class="line"> </div>
<div class="line">    linear_residual = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;residual&quot;</span>);</div>
<div class="line">    max_iterations  = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;max iters&quot;</span>);</div>
<div class="line">    ilut_fill       = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;ilut fill&quot;</span>);</div>
<div class="line">    ilut_atol       = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;ilut absolute tolerance&quot;</span>);</div>
<div class="line">    ilut_rtol       = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;ilut relative tolerance&quot;</span>);</div>
<div class="line">    ilut_drop       = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;ilut drop tolerance&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ParametersRefinement"></a> </p><h4>Parameters::Refinement</h4>
<p><br  />
 Similarly, here are a few parameters that determine how the mesh is to be refined (and if it is to be refined at all). For what exactly the shock parameters do, see the mesh refinement functions further down.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Refinement</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">bool</span>   do_refine;</div>
<div class="line">  <span class="keywordtype">double</span> shock_val;</div>
<div class="line">  <span class="keywordtype">double</span> shock_levels;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">  <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Refinement::declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;refinement&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;refinement&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Whether to perform mesh refinement or not&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;refinement fraction&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;0.1&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Fraction of high refinement&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;unrefinement fraction&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;0.1&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Fraction of low unrefinement&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;max elements&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1000000&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;maximum number of elements&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;shock value&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;4.0&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;value for shock indicator&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;shock levels&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;3.0&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;number of shock refinement levels&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Refinement::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;refinement&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    do_refine    = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;refinement&quot;</span>);</div>
<div class="line">    shock_val    = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;shock value&quot;</span>);</div>
<div class="line">    shock_levels = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;shock levels&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ParametersFlux"></a> </p><h4>Parameters::Flux</h4>
<p><br  />
 Next a section on flux modifications to make it more stable. In particular, two options are offered to stabilize the Lax-Friedrichs flux: either choose \(\mathbf{H}(\mathbf{a},\mathbf{b},\mathbf{n}) = \frac{1}{2}(\mathbf{F}(\mathbf{a})\cdot \mathbf{n} + \mathbf{F}(\mathbf{b})\cdot \mathbf{n} + \alpha (\mathbf{a} - \mathbf{b}))\) where \(\alpha\) is either a fixed number specified in the input file, or where \(\alpha\) is a mesh dependent value. In the latter case, it is chosen as \(\frac{h}{2\delta T}\) with \(h\) the diameter of the face to which the flux is applied, and \(\delta T\) the current time step.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Flux</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">enum</span> StabilizationKind</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="fe__dgp__nonparametric__0_8txt.html#a8290746300287635d0fe47e4071ea1ef">constant</a>,</div>
<div class="line">    mesh_dependent</div>
<div class="line">  };</div>
<div class="line">  StabilizationKind stabilization_kind;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> stabilization_value;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">  <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Flux::declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;flux&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(</div>
<div class="line">      <span class="stringliteral">&quot;stab&quot;</span>,</div>
<div class="line">      <span class="stringliteral">&quot;mesh&quot;</span>,</div>
<div class="line">      <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;constant|mesh&quot;</span>),</div>
<div class="line">      <span class="stringliteral">&quot;Whether to use a constant stabilization parameter or &quot;</span></div>
<div class="line">      <span class="stringliteral">&quot;a mesh-dependent one&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;stab value&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;alpha stabilization&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Flux::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;flux&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> std::string stab = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;stab&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (stab == <span class="stringliteral">&quot;constant&quot;</span>)</div>
<div class="line">      stabilization_kind = <a class="code" href="fe__dgp__nonparametric__0_8txt.html#a8290746300287635d0fe47e4071ea1ef">constant</a>;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stab == <span class="stringliteral">&quot;mesh&quot;</span>)</div>
<div class="line">      stabilization_kind = mesh_dependent;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line"> </div>
<div class="line">    stabilization_value = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;stab value&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ParametersOutput"></a> </p><h4>Parameters::Output</h4>
<p><br  />
 Then a section on output parameters. We offer to produce Schlieren plots (the squared gradient of the density, a tool to visualize shock fronts), and a time interval between graphical output in case we don't want an output file every time step.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Output</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">bool</span>   schlieren_plot;</div>
<div class="line">  <span class="keywordtype">double</span> output_step;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">  <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Output::declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;output&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;schlieren plot&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Whether or not to produce schlieren plots&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;step&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;-1&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Output once per this period&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Output::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;output&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    schlieren_plot = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;schlieren plot&quot;</span>);</div>
<div class="line">    output_step    = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;step&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ParametersAllParameters"></a> </p><h4>Parameters::AllParameters</h4>
<p><br  />
 Finally the class that brings it all together. It declares a number of parameters itself, mostly ones at the top level of the parameter file as well as several in section too small to warrant their own classes. It also contains everything that is actually space dimension dependent, like initial or boundary conditions. <br  />
 Since this class is derived from all the ones above, the <code><a class="el" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters()</a></code> and <code>parse_parameters()</code> functions call the respective functions of the base classes as well. <br  />
 Note that this class also handles the declaration of initial and boundary conditions specified in the input file. To this end, in both cases, there are entries like "w_0 value" which represent an expression in terms of \(x,y,z\) that describe the initial or boundary condition as a formula that will later be parsed by the <a class="el" href="classFunctionParser.html">FunctionParser</a> class. Similar expressions exist for "w_1", "w_2", etc, denoting the <code>dim+2</code> conserved variables of the Euler system. Similarly, we allow up to <code>max_n_boundaries</code> boundary indicators to be used in the input file, and each of these boundary indicators can be associated with an inflow, outflow, or pressure boundary condition, with homogeneous boundary conditions being specified for each component and each boundary indicator separately. <br  />
 The data structure used to store the boundary indicators is a bit complicated. It is an array of <code>max_n_boundaries</code> elements indicating the range of boundary indicators that will be accepted. For each entry in this array, we store a pair of data in the <code>BoundaryCondition</code> structure: first, an array of size <code>n_components</code> that for each component of the solution vector indicates whether it is an inflow, outflow, or other kind of boundary, and second a <a class="el" href="classFunctionParser.html">FunctionParser</a> object that describes all components of the solution vector for this boundary id at once. <br  />
 The <code>BoundaryCondition</code> structure requires a constructor since we need to tell the function parser object at construction time how many vector components it is to describe. This initialization can therefore not wait till we actually set the formulas the <a class="el" href="classFunctionParser.html">FunctionParser</a> object represents later in <code>AllParameters::parse_parameters()</code> <br  />
 For the same reason of having to tell <a class="el" href="classFunction.html">Function</a> objects their vector size at construction time, we have to have a constructor of the <code>AllParameters</code> class that at least initializes the other <a class="el" href="classFunctionParser.html">FunctionParser</a> object, i.e. the one describing initial conditions.</p>
<div class="fragment"><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">struct </span>AllParameters : <span class="keyword">public</span> Solver,</div>
<div class="line">                         <span class="keyword">public</span> Refinement,</div>
<div class="line">                         <span class="keyword">public</span> Flux,</div>
<div class="line">                         <span class="keyword">public</span> Output</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_n_boundaries = 10;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>BoundaryConditions</div>
<div class="line">    {</div>
<div class="line">      std::array&lt;typename EulerEquations&lt;dim&gt;::BoundaryKind,</div>
<div class="line">                 <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>&gt;</div>
<div class="line">        <a class="code" href="mapping__0_8txt.html#a334bdbfb52225fe249c8d336acfab3e6">kind</a>;</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classFunctionParser.html">FunctionParser&lt;dim&gt;</a> <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>;</div>
<div class="line"> </div>
<div class="line">      BoundaryConditions();</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    AllParameters();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> diffusion_power;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> time_step, <a class="code" href="namespaceEuler__DG.html#ae1cc4c5ec49b9998f5dc924707c29ed4">final_time</a>;</div>
<div class="line">    <span class="keywordtype">double</span> theta;</div>
<div class="line">    <span class="keywordtype">bool</span>   is_stationary;</div>
<div class="line"> </div>
<div class="line">    std::string mesh_filename;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFunctionParser.html">FunctionParser&lt;dim&gt;</a> initial_conditions;</div>
<div class="line">    BoundaryConditions  boundary_conditions[max_n_boundaries];</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  AllParameters&lt;dim&gt;::BoundaryConditions::BoundaryConditions()</div>
<div class="line">    : <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>(EulerEquations&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;::<a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="convergence__table__0_8txt.html#a37c53a384d86a02751b04a0a89820c55">std::fill</a>(<a class="code" href="mapping__0_8txt.html#a334bdbfb52225fe249c8d336acfab3e6">kind</a>.begin(),</div>
<div class="line">              <a class="code" href="mapping__0_8txt.html#a334bdbfb52225fe249c8d336acfab3e6">kind</a>.end(),</div>
<div class="line">              EulerEquations&lt;dim&gt;::no_penetration_boundary);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  AllParameters&lt;dim&gt;::AllParameters()</div>
<div class="line">    : diffusion_power(0.)</div>
<div class="line">    , time_step(1.)</div>
<div class="line">    , <a class="code" href="namespaceEuler__DG.html#ae1cc4c5ec49b9998f5dc924707c29ed4">final_time</a>(1.)</div>
<div class="line">    , theta(.5)</div>
<div class="line">    , is_stationary(<a class="code" href="event__0_8txt.html#a60053d8ff825674cfcc1321aba229cd7">true</a>)</div>
<div class="line">    , initial_conditions(EulerEquations&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;::<a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">AllParameters&lt;dim&gt;::declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;mesh&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;grid.inp&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Anything.html">Patterns::Anything</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;input file name&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;diffusion power&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;2.0&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;power of mesh size for diffusion&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;time stepping&quot;</span>);</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;time step&quot;</span>,</div>
<div class="line">                        <span class="stringliteral">&quot;0.1&quot;</span>,</div>
<div class="line">                        <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0),</div>
<div class="line">                        <span class="stringliteral">&quot;simulation time step&quot;</span>);</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;final time&quot;</span>,</div>
<div class="line">                        <span class="stringliteral">&quot;10.0&quot;</span>,</div>
<div class="line">                        <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0),</div>
<div class="line">                        <span class="stringliteral">&quot;simulation end time&quot;</span>);</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;theta scheme value&quot;</span>,</div>
<div class="line">                        <span class="stringliteral">&quot;0.5&quot;</span>,</div>
<div class="line">                        <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0, 1),</div>
<div class="line">                        <span class="stringliteral">&quot;value for theta that interpolated between explicit &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;Euler (theta=0), Crank-Nicolson (theta=0.5), and &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;implicit Euler (theta=1).&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a> = 0; <a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a> &lt; max_n_boundaries; ++<a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a>)</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;boundary_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(<a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a>));</div>
<div class="line">        {</div>
<div class="line">          prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;no penetration&quot;</span>,</div>
<div class="line">                            <span class="stringliteral">&quot;false&quot;</span>,</div>
<div class="line">                            <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                            <span class="stringliteral">&quot;whether the named boundary allows gas to &quot;</span></div>
<div class="line">                            <span class="stringliteral">&quot;penetrate or is a rigid wall&quot;</span>);</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">di &lt; EulerEquations&lt;dim&gt;::n_components</a>;</div>
<div class="line">               ++di)</div>
<div class="line">            {</div>
<div class="line">              prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di),</div>
<div class="line">                                <span class="stringliteral">&quot;outflow&quot;</span>,</div>
<div class="line">                                <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(</div>
<div class="line">                                  <span class="stringliteral">&quot;inflow|outflow|pressure&quot;</span>),</div>
<div class="line">                                <span class="stringliteral">&quot;&lt;inflow|outflow|pressure&gt;&quot;</span>);</div>
<div class="line"> </div>
<div class="line">              prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di) +</div>
<div class="line">                                  <span class="stringliteral">&quot; value&quot;</span>,</div>
<div class="line">                                <span class="stringliteral">&quot;0.0&quot;</span>,</div>
<div class="line">                                <a class="code" href="classPatterns_1_1Anything.html">Patterns::Anything</a>(),</div>
<div class="line">                                <span class="stringliteral">&quot;expression in x,y,z&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;initial condition&quot;</span>);</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">di &lt; EulerEquations&lt;dim&gt;::n_components</a>; ++di)</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di) + <span class="stringliteral">&quot; value&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;0.0&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Anything.html">Patterns::Anything</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;expression in x,y,z&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Parameters::Solver::declare_parameters</a>(prm);</div>
<div class="line">    <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Parameters::Refinement::declare_parameters</a>(prm);</div>
<div class="line">    <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Parameters::Flux::declare_parameters</a>(prm);</div>
<div class="line">    <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Parameters::Output::declare_parameters</a>(prm);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> AllParameters&lt;dim&gt;::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">  {</div>
<div class="line">    mesh_filename   = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;mesh&quot;</span>);</div>
<div class="line">    diffusion_power = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;diffusion power&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;time stepping&quot;</span>);</div>
<div class="line">    {</div>
<div class="line">      time_step = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;time step&quot;</span>);</div>
<div class="line">      <span class="keywordflow">if</span> (time_step == 0)</div>
<div class="line">        {</div>
<div class="line">          is_stationary = <span class="keyword">true</span>;</div>
<div class="line">          time_step     = 1.0;</div>
<div class="line">          <a class="code" href="namespaceEuler__DG.html#ae1cc4c5ec49b9998f5dc924707c29ed4">final_time</a>    = 1.0;</div>
<div class="line">        }</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        is_stationary = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="namespaceEuler__DG.html#ae1cc4c5ec49b9998f5dc924707c29ed4">final_time</a> = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;final time&quot;</span>);</div>
<div class="line">      theta      = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;theta scheme value&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a> = 0; <a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a> &lt; max_n_boundaries;</div>
<div class="line">         ++<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>)</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;boundary_&quot;</span> +</div>
<div class="line">                             <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>));</div>
<div class="line">        {</div>
<div class="line">          std::vector&lt;std::string&gt; expressions(</div>
<div class="line">            <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>, <span class="stringliteral">&quot;0.0&quot;</span>);</div>
<div class="line"> </div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">bool</span> no_penetration = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;no penetration&quot;</span>);</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">di &lt; EulerEquations&lt;dim&gt;::n_components</a>;</div>
<div class="line">               ++di)</div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> std::string boundary_type =</div>
<div class="line">                prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di));</div>
<div class="line"> </div>
<div class="line">              <span class="keywordflow">if</span> ((di &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>) &amp;&amp; (no_penetration == <span class="keyword">true</span>))</div>
<div class="line">                boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].kind[di] =</div>
<div class="line">                  EulerEquations&lt;dim&gt;::no_penetration_boundary;</div>
<div class="line">              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (boundary_type == <span class="stringliteral">&quot;inflow&quot;</span>)</div>
<div class="line">                boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].kind[di] =</div>
<div class="line">                  EulerEquations&lt;dim&gt;::inflow_boundary;</div>
<div class="line">              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (boundary_type == <span class="stringliteral">&quot;pressure&quot;</span>)</div>
<div class="line">                boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].kind[di] =</div>
<div class="line">                  EulerEquations&lt;dim&gt;::pressure_boundary;</div>
<div class="line">              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (boundary_type == <span class="stringliteral">&quot;outflow&quot;</span>)</div>
<div class="line">                boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].kind[di] =</div>
<div class="line">                  EulerEquations&lt;dim&gt;::outflow_boundary;</div>
<div class="line">              <span class="keywordflow">else</span></div>
<div class="line">                <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line"> </div>
<div class="line">              expressions[di] =</div>
<div class="line">                prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di) + <span class="stringliteral">&quot; value&quot;</span>);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">          boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].values.initialize(</div>
<div class="line">            <a class="code" href="classFunctionParser.html">FunctionParser&lt;dim&gt;::default_variable_names</a>(),</div>
<div class="line">            expressions,</div>
<div class="line">            std::map&lt;std::string, double&gt;());</div>
<div class="line">        }</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;initial condition&quot;</span>);</div>
<div class="line">    {</div>
<div class="line">      std::vector&lt;std::string&gt; expressions(<a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>,</div>
<div class="line">                                           <span class="stringliteral">&quot;0.0&quot;</span>);</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">di &lt; EulerEquations&lt;dim&gt;::n_components</a>; di++)</div>
<div class="line">        expressions[di] =</div>
<div class="line">          prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di) + <span class="stringliteral">&quot; value&quot;</span>);</div>
<div class="line">      initial_conditions.initialize(</div>
<div class="line">        <a class="code" href="classFunctionParser.html">FunctionParser&lt;dim&gt;::default_variable_names</a>(),</div>
<div class="line">        expressions,</div>
<div class="line">        std::map&lt;std::string, double&gt;());</div>
<div class="line">    }</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line">    Parameters::Solver::parse_parameters(prm);</div>
<div class="line">    Parameters::Refinement::parse_parameters(prm);</div>
<div class="line">    Parameters::Flux::parse_parameters(prm);</div>
<div class="line">    Parameters::Output::parse_parameters(prm);</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Parameters</span></div>
</div><!-- fragment --><p><a class="anchor" id="Conservationlawclass"></a> </p><h3>Conservation law class</h3>
<p>Here finally comes the class that actually does something with all the Euler equation and parameter specifics we've defined above. The public interface is pretty much the same as always (the constructor now takes the name of a file from which to read parameters, which is passed on the command line). The private function interface is also pretty similar to the usual arrangement, with the <code>assemble_system</code> function split into three parts: one that contains the main loop over all cells and that then calls the other two for integrals over cells and faces, respectively.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>ConservationLaw</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  ConservationLaw(<span class="keyword">const</span> charinput_filename);</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">run</a>();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keywordtype">void</span> setup_system();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> assemble_system();</div>
<div class="line">  <span class="keywordtype">void</span> assemble_cell_term(<span class="keyword">const</span> <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> &amp;                       fe_v,</div>
<div class="line">                          <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;<a class="code" href="distributed__0_8txt.html#ad207fe81a5be05e18534713c2677da7b">dofs</a>);</div>
<div class="line">  <span class="keywordtype">void</span> assemble_face_term(</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                          <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFEFaceValuesBase.html">FEFaceValuesBase&lt;dim&gt;</a> &amp;               fe_v,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFEFaceValuesBase.html">FEFaceValuesBase&lt;dim&gt;</a> &amp;               fe_v_neighbor,</div>
<div class="line">    <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;<a class="code" href="distributed__0_8txt.html#ad207fe81a5be05e18534713c2677da7b">dofs</a>,</div>
<div class="line">    <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dofs_neighbor,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span>                                  external_face,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                          <a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>                                face_diameter);</div>
<div class="line"> </div>
<div class="line">  std::pair&lt;unsigned int, double&gt; <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>(<a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> compute_refinement_indicators(<a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;<a class="code" href="grid__generator__0_8txt.html#ad40779ba24977c5f641bfa6ac51032ab">indicator</a>) <span class="keyword">const</span>;</div>
<div class="line">  <span class="keywordtype">void</span> refine_grid(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;<a class="code" href="grid__generator__0_8txt.html#ad40779ba24977c5f641bfa6ac51032ab">indicator</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> output_results() <span class="keyword">const</span>;</div>
</div><!-- fragment --><p>The first few member variables are also rather standard. Note that we define a mapping object to be used throughout the program when assembling terms (we will hand it to every <a class="el" href="classFEValues.html">FEValues</a> and <a class="el" href="classFEFaceValues.html">FEFaceValues</a> object); the mapping we use is just the standard \(Q_1\) mapping</p>
<ul>
<li>nothing fancy, in other words</li>
<li>but declaring one here and using it throughout the program will make it simpler later on to change it if that should become necessary. This is, in fact, rather pertinent: it is known that for transsonic simulations with the Euler equations, computations do not converge even as \(h\rightarrow 0\) if the boundary approximation is not of sufficiently high order.</li>
</ul>
<div class="fragment"><div class="line">     <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a>   <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>;</div>
<div class="line">     <span class="keyword">const</span> <a class="code" href="classMappingQ1.html">MappingQ1&lt;dim&gt;</a> <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>;</div>
<div class="line">  </div>
<div class="line">     <span class="keyword">const</span> <a class="code" href="classFESystem.html">FESystem&lt;dim&gt;</a> <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>;</div>
<div class="line">     <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>     dof_handler;</div>
<div class="line">  </div>
<div class="line">     <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>     <a class="code" href="update__flags__0_8txt.html#a5873b8f7eeaefb5e7a99005c6c93b175">quadrature</a>;</div>
<div class="line">     <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a></div>
<div class="line">  </div>
<div class="line">- 1&gt; face_quadrature;</div>
</div><!-- fragment --><p>Next come a number of data vectors that correspond to the solution of the previous time step ( <code>old_solution</code> ), the best guess of the current solution ( <code>current_solution</code> ; we say <em>guess</em> because the Newton iteration to compute it may not have converged yet, whereas <code>old_solution</code> refers to the fully converged final result of the previous time step), and a predictor for the solution at the next time step, computed by extrapolating the current and previous solution one time step into the future:</p>
<div class="fragment"><div class="line"><a class="code" href="classVector.html">Vector&lt;double&gt;</a> old_solution;</div>
<div class="line"><a class="code" href="classVector.html">Vector&lt;double&gt;</a> current_solution;</div>
<div class="line"><a class="code" href="classVector.html">Vector&lt;double&gt;</a> predictor;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classVector.html">Vector&lt;double&gt;</a> <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>;</div>
</div><!-- fragment --><p>This final set of member variables (except for the object holding all run-time parameters at the very bottom and a screen output stream that only prints something if verbose output has been requested) deals with the interface we have in this program to the Trilinos library that provides us with linear solvers. Similarly to including PETSc matrices in <a class="el" href="step_17.html">step-17</a> and <a class="el" href="step_18.html">step-18</a> , all we need to do is to create a Trilinos sparse matrix instead of the standard deal.II class. The system matrix is used for the Jacobian in each Newton step. Since we do not intend to run this program in parallel (which wouldn't be too hard with Trilinos data structures, though), we don't have to think about anything else like distributing the degrees of freedom.</p>
<div class="fragment"><div class="line">  <a class="code" href="classTrilinosWrappers_1_1SparseMatrix.html">TrilinosWrappers::SparseMatrix</a> system_matrix;</div>
<div class="line"> </div>
<div class="line">  Parameters::AllParameters&lt;dim&gt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>;</div>
<div class="line">  <a class="code" href="classConditionalOStream.html">ConditionalOStream</a>             verbose_cout;</div>
<div class="line">};</div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawConservationLaw"></a> </p><h4>ConservationLaw::ConservationLaw</h4>
<p><br  />
 There is nothing much to say about the constructor. Essentially, it reads the input file and fills the parameter object with the parsed values:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">ConservationLaw&lt;dim&gt;::ConservationLaw(<span class="keyword">const</span> charinput_filename)</div>
<div class="line">  : <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>()</div>
<div class="line">  , <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>(<a class="code" href="classFE__Q.html">FE_Q</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;(1), EulerEquations&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;::<a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>)</div>
<div class="line">  , dof_handler(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>)</div>
<div class="line">  , <a class="code" href="update__flags__0_8txt.html#a5873b8f7eeaefb5e7a99005c6c93b175">quadrature</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="polynomial__space__0_8txt.html#a03a2f48682e29e39f7bccc11a7d1c4d1">degree</a> + 1)</div>
<div class="line">  , face_quadrature(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="polynomial__space__0_8txt.html#a03a2f48682e29e39f7bccc11a7d1c4d1">degree</a> + 1)</div>
<div class="line">  , verbose_cout(std::cout, <a class="code" href="parsed__convergence__table__0_8txt.html#a2c7b85beed973f20ac73d33d8bbe8a57">false</a>)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classParameterHandler.html">ParameterHandler</a> prm;</div>
<div class="line">  <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Parameters::AllParameters&lt;dim&gt;::declare_parameters</a>(prm);</div>
<div class="line"> </div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">parse_input</a>(input_filename);</div>
<div class="line">  <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.parse_parameters(prm);</div>
<div class="line"> </div>
<div class="line">  verbose_cout.set_condition(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.output ==</div>
<div class="line">                             Parameters::Solver::verbose);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawsetup_system"></a> </p><h4>ConservationLaw::setup_system</h4>
<p><br  />
 The following (easy) function is called each time the mesh is changed. All it does is to resize the Trilinos matrix according to a sparsity pattern that we generate as in all the previous tutorial programs.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> ConservationLaw&lt;dim&gt;::setup_system()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(), dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">  <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler, dsp);</div>
<div class="line"> </div>
<div class="line">  system_matrix.reinit(dsp);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawassemble_system"></a> </p><h4>ConservationLaw::assemble_system</h4>
<p><br  />
 This and the following two functions are the meat of this program: They assemble the linear system that results from applying Newton's method to the nonlinear system of conservation equations. <br  />
 This first function puts all of the assembly pieces together in a routine that dispatches the correct piece for each cell/face. The actual implementation of the assembly on these objects is done in the following functions. <br  />
 At the top of the function we do the usual housekeeping: allocate <a class="el" href="classFEValues.html">FEValues</a>, <a class="el" href="classFEFaceValues.html">FEFaceValues</a>, and <a class="el" href="classFESubfaceValues.html">FESubfaceValues</a> objects necessary to do the integrations on cells, faces, and subfaces (in case of adjoining cells on different refinement levels). Note that we don't need all information (like values, gradients, or real locations of quadrature points) for all of these objects, so we only let the <a class="el" href="classFEValues.html">FEValues</a> classes whatever is actually necessary by specifying the minimal set of UpdateFlags. For example, when using a <a class="el" href="classFEFaceValues.html">FEFaceValues</a> object for the neighboring cell we only need the shape values: Given a specific face, the quadrature points and <code>JxW</code> values are the same as for the current cells, and the normal vectors are known to be the negative of the normal vectors of the current cell.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> ConservationLaw&lt;dim&gt;::assemble_system()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> = dof_handler.<a class="code" href="classDoFHandler.html#ac1fedeb50b5f03b13d8b69f86e33f726">get_fe</a>().<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>();</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; dof_indices(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; dof_indices_neighbor(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> update_flags = <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> |</div>
<div class="line">                                   <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> |</div>
<div class="line">                                   <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>,</div>
<div class="line">                    face_update_flags =</div>
<div class="line">                      <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> |</div>
<div class="line">                      <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f">update_normal_vectors</a>,</div>
<div class="line">                    neighbor_face_update_flags = <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>        fe_v(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>, <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>, <a class="code" href="update__flags__0_8txt.html#a5873b8f7eeaefb5e7a99005c6c93b175">quadrature</a>, update_flags);</div>
<div class="line">  <a class="code" href="classFEFaceValues.html">FEFaceValues&lt;dim&gt;</a>    fe_v_face(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                              <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                              face_quadrature,</div>
<div class="line">                              face_update_flags);</div>
<div class="line">  <a class="code" href="classFESubfaceValues.html">FESubfaceValues&lt;dim&gt;</a> fe_v_subface(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                    <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                                    face_quadrature,</div>
<div class="line">                                    face_update_flags);</div>
<div class="line">  <a class="code" href="classFEFaceValues.html">FEFaceValues&lt;dim&gt;</a>    fe_v_face_neighbor(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                       <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                                       face_quadrature,</div>
<div class="line">                                       neighbor_face_update_flags);</div>
<div class="line">  <a class="code" href="classFESubfaceValues.html">FESubfaceValues&lt;dim&gt;</a> fe_v_subface_neighbor(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                             <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                                             face_quadrature,</div>
<div class="line">                                             neighbor_face_update_flags);</div>
</div><!-- fragment --><p>Then loop over all cells, initialize the <a class="el" href="classFEValues.html">FEValues</a> object for the current cell and call the function that assembles the problem on this cell.</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">  {</div>
<div class="line">    fe_v.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line">    <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;get_dof_indices(dof_indices);</div>
<div class="line"> </div>
<div class="line">    assemble_cell_term(fe_v, dof_indices);</div>
</div><!-- fragment --><p>Then loop over all the faces of this cell. If a face is part of the external boundary, then assemble boundary conditions there (the fifth argument to <code>assemble_face_terms</code> indicates whether we are working on an external or internal face; if it is an external face, the fourth argument denoting the degrees of freedom indices of the neighbor is ignored, so we pass an empty vector):</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a> : <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;face_indices())</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;at_boundary(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>))</div>
<div class="line">    {</div>
<div class="line">      fe_v_face.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>);</div>
<div class="line">      assemble_face_term(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>,</div>
<div class="line">                         fe_v_face,</div>
<div class="line">                         fe_v_face,</div>
<div class="line">                         dof_indices,</div>
<div class="line">                         std::vector&lt;types::global_dof_index&gt;(),</div>
<div class="line">                         <span class="keyword">true</span>,</div>
<div class="line">                         <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;face(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;boundary_id(),</div>
<div class="line">                         <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;face(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;diameter());</div>
<div class="line">    }</div>
</div><!-- fragment --><p>The alternative is that we are dealing with an internal face. There are two cases that we need to distinguish: that this is a normal face between two cells at the same refinement level, and that it is a face between two cells of the different refinement levels. <br  />
 In the first case, there is nothing we need to do: we are using a continuous finite element, and face terms do not appear in the bilinear form in this case. The second case usually does not lead to face terms either if we enforce hanging node constraints strongly (as in all previous tutorial programs so far whenever we used continuous finite elements</p>
<ul>
<li>this enforcement is done by the <a class="el" href="classAffineConstraints.html">AffineConstraints</a> class together with <a class="el" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a>). In the current program, however, we opt to enforce continuity weakly at faces between cells of different refinement level, for two reasons: (i) because we can, and more importantly (ii) because we would have to thread the automatic differentiation we use to compute the elements of the Newton matrix from the residual through the operations of the <a class="el" href="classAffineConstraints.html">AffineConstraints</a> class. This would be possible, but is not trivial, and so we choose this alternative approach. <br  />
 What needs to be decided is which side of an interface between two cells of different refinement level we are sitting on. <br  />
 Let's take the case where the neighbor is more refined first. We then have to loop over the children of the face of the current cell and integrate on each of them. We sprinkle a couple of assertions into the code to ensure that our reasoning trying to figure out which of the neighbor's children's faces coincides with a given subface of the current cell's faces is correct</li>
<li>a bit of defensive programming never hurts. <br  />
 We then call the function that integrates over faces; since this is an internal face, the fifth argument is false, and the sixth one is ignored so we pass an invalid value again:</li>
</ul>
<div class="fragment"><div class="line"><span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;neighbor(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;has_children())</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> neighbor2 =</div>
<div class="line">          <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;neighbor_of_neighbor(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> subface_no = 0;</div>
<div class="line">             subface_no &lt; <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;face(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;n_children();</div>
<div class="line">             ++subface_no)</div>
<div class="line">          {</div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::active_cell_iterator</a></div>
<div class="line">              neighbor_child =</div>
<div class="line">                <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;neighbor_child_on_subface(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>, subface_no);</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(neighbor_child-&gt;face(neighbor2) ==</div>
<div class="line">                     <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;face(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;child(subface_no),</div>
<div class="line">                   <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">            <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(neighbor_child-&gt;is_active(), <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">            fe_v_subface.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>, subface_no);</div>
<div class="line">            fe_v_face_neighbor.reinit(neighbor_child, neighbor2);</div>
<div class="line"> </div>
<div class="line">            neighbor_child-&gt;get_dof_indices(dof_indices_neighbor);</div>
<div class="line"> </div>
<div class="line">            assemble_face_term(</div>
<div class="line">              <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>,</div>
<div class="line">              fe_v_subface,</div>
<div class="line">              fe_v_face_neighbor,</div>
<div class="line">              dof_indices,</div>
<div class="line">              dof_indices_neighbor,</div>
<div class="line">              <span class="keyword">false</span>,</div>
<div class="line">              <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>,</div>
<div class="line">              neighbor_child-&gt;face(neighbor2)-&gt;diameter());</div>
<div class="line">          }</div>
<div class="line">      }</div>
</div><!-- fragment --><p>The other possibility we have to care for is if the neighbor is coarser than the current cell (in particular, because of the usual restriction of only one hanging node per face, the neighbor must be exactly one level coarser than the current cell, something that we check with an assertion). Again, we then integrate over this interface:</p>
<div class="fragment"><div class="line">               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;neighbor(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;level() != <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;level())</div>
<div class="line">                 {</div>
<div class="line">                   <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::cell_iterator</a> <a class="code" href="fe_2fe__0_8txt.html#ad1bbe5407fe459d8e4e71ba7ed9f7428">neighbor</a> =</div>
<div class="line">                     <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;neighbor(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>);</div>
<div class="line">                   <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="fe_2fe__0_8txt.html#ad1bbe5407fe459d8e4e71ba7ed9f7428">neighbor</a>-&gt;level() == <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;level()</div>
<div class="line">  </div>
<div class="line">- 1,</div>
<div class="line">                          <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">  </div>
<div class="line">                   <a class="code" href="fe_2fe__0_8txt.html#ad1bbe5407fe459d8e4e71ba7ed9f7428">neighbor</a>-&gt;get_dof_indices(dof_indices_neighbor);</div>
<div class="line">  </div>
<div class="line">                   <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; faceno_subfaceno =</div>
<div class="line">                     <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;neighbor_of_coarser_neighbor(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>);</div>
<div class="line">                   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> neighbor_face_no = faceno_subfaceno.first,</div>
<div class="line">                                      neighbor_subface_no =</div>
<div class="line">                                        faceno_subfaceno.second;</div>
<div class="line">  </div>
<div class="line">                   <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="fe_2fe__0_8txt.html#ad1bbe5407fe459d8e4e71ba7ed9f7428">neighbor</a>-&gt;neighbor_child_on_subface(</div>
<div class="line">                            neighbor_face_no, neighbor_subface_no) == <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>,</div>
<div class="line">                          <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">  </div>
<div class="line">                   fe_v_face.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>);</div>
<div class="line">                   fe_v_subface_neighbor.reinit(<a class="code" href="fe_2fe__0_8txt.html#ad1bbe5407fe459d8e4e71ba7ed9f7428">neighbor</a>,</div>
<div class="line">                                                neighbor_face_no,</div>
<div class="line">                                                neighbor_subface_no);</div>
<div class="line">  </div>
<div class="line">                   assemble_face_term(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>,</div>
<div class="line">                                      fe_v_face,</div>
<div class="line">                                      fe_v_subface_neighbor,</div>
<div class="line">                                      dof_indices,</div>
<div class="line">                                      dof_indices_neighbor,</div>
<div class="line">                                      <span class="keyword">false</span>,</div>
<div class="line">                                      <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>,</div>
<div class="line">                                      <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;face(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;diameter());</div>
<div class="line">                 }</div>
<div class="line">             }</div>
<div class="line">       }</div>
<div class="line">   }</div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawassemble_cell_term"></a> </p><h4>ConservationLaw::assemble_cell_term</h4>
<p><br  />
 This function assembles the cell term by computing the cell part of the residual, adding its negative to the right hand side vector, and adding its derivative with respect to the local variables to the Jacobian (i.e. the Newton matrix). Recall that the cell contributions to the residual read \(R_i = \left(\frac{\mathbf{w}^{k}_{n+1} - \mathbf{w}_n}{\delta t} , \mathbf{z}_i \right)_K \) \( + \theta \mathbf{B}(\mathbf{w}^{k}_{n+1})(\mathbf{z}_i)_K \) \( + (1-\theta) \mathbf{B}(\mathbf{w}_{n}) (\mathbf{z}_i)_K \) where \(\mathbf{B}(\mathbf{w})(\mathbf{z}_i)_K = - \left(\mathbf{F}(\mathbf{w}),\nabla\mathbf{z}_i\right)_K \) \( + h^{\eta}(\nabla \mathbf{w} , \nabla \mathbf{z}_i)_K \) \( - (\mathbf{G}(\mathbf {w}), \mathbf{z}_i)_K \) for both \(\mathbf{w} = \mathbf{w}^k_{n+1}\) and \(\mathbf{w} = \mathbf{w}_{n}\) , \(\mathbf{z}_i\) is the \(i\) th vector valued test function. Furthermore, the scalar product \(\left(\mathbf{F}(\mathbf{w}), \nabla\mathbf{z}_i\right)_K\) is understood as \(\int_K \sum_{c=1}^{\text{n\_components}} \sum_{d=1}^{\text{dim}} \mathbf{F}(\mathbf{w})_{cd} \frac{\partial z^c_i}{x_d}\) where \(z^c_i\) is the \(c\) th component of the \(i\) th test function.</p>
<p>At the top of this function, we do the usual housekeeping in terms of allocating some local variables that we will need later. In particular, we will allocate variables that will hold the values of the current solution \(W_{n+1}^k\) after the \(k\) th Newton iteration (variable <code>W</code> ) and the previous time step's solution \(W_{n}\) (variable <code>W_old</code> ). <br  />
 In addition to these, we need the gradients of the current variables. It is a bit of a shame that we have to compute these; we almost don't. The nice thing about a simple conservation law is that the flux doesn't generally involve any gradients. We do need these, however, for the diffusion stabilization. <br  />
 The actual format in which we store these variables requires some explanation. First, we need values at each quadrature point for each of the <code>EulerEquations::n_components</code> components of the solution vector. This makes for a two-dimensional table for which we use deal.II's <a class="el" href="classTable.html">Table</a> class (this is more efficient than <code>std::vector&lt;std::vector&lt;T&gt; &gt;</code> because it only needs to allocate memory once, rather than once for each element of the outer vector). Similarly, the gradient is a three-dimensional table, which the <a class="el" href="classTable.html">Table</a> class also supports. <br  />
 Secondly, we want to use automatic differentiation. To this end, we use the Sacado::Fad::DFad template for everything that is computed from the variables with respect to which we would like to compute derivatives. This includes the current solution and gradient at the quadrature points (which are linear combinations of the degrees of freedom) as well as everything that is computed from them such as the residual, but not the previous time step's solution. These variables are all found in the first part of the function, along with a variable that we will use to store the derivatives of a single component of the residual:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> ConservationLaw&lt;dim&gt;::assemble_cell_term(</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> &amp;                       fe_v,</div>
<div class="line">  <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dof_indices)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> = fe_v.dofs_per_cell;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>    = fe_v.n_quadrature_points;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTable.html">Table&lt;2, Sacado::Fad::DFad&lt;double&gt;</a>&gt; W(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>,</div>
<div class="line">                                        <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTable.html">Table&lt;2, double&gt;</a> W_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTable.html">Table&lt;3, Sacado::Fad::DFad&lt;double&gt;</a>&gt; grad_W(</div>
<div class="line">    <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>, <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTable.html">Table&lt;3, double&gt;</a> grad_W_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>,</div>
<div class="line">                              <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>,</div>
<div class="line">                              <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>);</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;double&gt; residual_derivatives(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
</div><!-- fragment --><p>Next, we have to define the independent variables that we will try to determine by solving a Newton step. These independent variables are the values of the local degrees of freedom which we extract here:</p>
<div class="fragment"><div class="line">std::vector&lt;Sacado::Fad::DFad&lt;double&gt;&gt; independent_local_dof_values(</div>
<div class="line">  <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">  independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] = current_solution(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]);</div>
</div><!-- fragment --><p>The next step incorporates all the magic: we declare a subset of the autodifferentiation variables as independent degrees of freedom, whereas all the other ones remain dependent functions. These are precisely the local degrees of freedom just extracted. All calculations that reference them (either directly or indirectly) will accumulate sensitivities with respect to these variables. <br  />
 In order to mark the variables as independent, the following does the trick, marking <code>independent_local_dof_values[i]</code> as the \(i\) th independent variable out of a total of <code>dofs_per_cell</code> :</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">  independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>].diff(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
</div><!-- fragment --><p>After all these declarations, let us actually compute something. First, the values of <code>W</code>, <code>W_old</code>, <code>grad_W</code> and <code>grad_W_old</code> , which we can compute from the local DoF values by using the formula \(W(x_q)=\sum_i \mathbf W_i \Phi_i(x_q)\) , where \(\mathbf W_i\) is the \(i\) th entry of the (local part of the) solution vector, and \(\Phi_i(x_q)\) the value of the \(i\) th vector-valued shape function evaluated at quadrature point \(x_q\) . The gradient can be computed in a similar way. <br  />
 Ideally, we could compute this information using a call into something like FEValues::get_function_values and FEValues::get_function_gradients, but since (i) we would have to extend the <a class="el" href="classFEValues.html">FEValues</a> class for this, and (ii) we don't want to make the entire <code>old_solution</code> vector fad types, only the local cell variables, we explicitly code the loop above. Before this, we add another loop that initializes all the fad variables to zero:</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q)</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a> = 0; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">c &lt; EulerEquations&lt;dim&gt;::n_components</a>; ++<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>)</div>
<div class="line">    {</div>
<div class="line">      W[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>]     = 0;</div>
<div class="line">      W_old[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = 0;</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">        {</div>
<div class="line">          grad_W[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>]     = 0;</div>
<div class="line">          grad_W_old[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] = 0;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q)</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a> =</div>
<div class="line">        fe_v.get_fe().system_to_component_index(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>).first;</div>
<div class="line"> </div>
<div class="line">      W[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] += independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]</div>
<div class="line">                 fe_v.shape_value_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>);</div>
<div class="line">      W_old[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] +=</div>
<div class="line">        old_solution(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) fe_v.shape_value_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>++)</div>
<div class="line">        {</div>
<div class="line">          grad_W[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] += independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]</div>
<div class="line">                             fe_v.shape_grad_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>)[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line">          grad_W_old[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] += old_solution(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>])</div>
<div class="line">                                 fe_v.shape_grad_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>)[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line">        }</div>
<div class="line">    }</div>
</div><!-- fragment --><p>Next, in order to compute the cell contributions, we need to evaluate \(\mathbf{F}({\mathbf w}^k_{n+1})\) , \(\mathbf{G}({\mathbf w}^k_{n+1})\) and \(\mathbf{F}({\mathbf w}_n)\) , \(\mathbf{G}({\mathbf w}_n)\) at all quadrature points. To store these, we also need to allocate a bit of memory. Note that we compute the flux matrices and right hand sides in terms of autodifferentiation variables, so that the Jacobian contributions can later easily be computed from it:</p>
<div class="fragment"><div class="line">std::vector&lt;ndarray&lt;Sacado::Fad::DFad&lt;double&gt;,</div>
<div class="line">                    <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>,</div>
<div class="line">                    <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;&gt;</div>
<div class="line">  <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">std::vector&lt;ndarray&lt;double, EulerEquations&lt;dim&gt;::n_components</a>, <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;&gt;</div>
<div class="line">  flux_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;</div>
<div class="line">  std::array&lt;Sacado::Fad::DFad&lt;double&gt;, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>&gt;&gt;</div>
<div class="line">  forcing(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">std::vector&lt;std::array&lt;double, EulerEquations&lt;dim&gt;::n_components</a>&gt;&gt;</div>
<div class="line">  forcing_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q)</div>
<div class="line">  {</div>
<div class="line">    EulerEquations&lt;dim&gt;::compute_flux_matrix(W_old[q], flux_old[q]);</div>
<div class="line">    EulerEquations&lt;dim&gt;::compute_forcing_vector(W_old[q], forcing_old[q]);</div>
<div class="line">    EulerEquations&lt;dim&gt;::compute_flux_matrix(W[q], <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>[q]);</div>
<div class="line">    EulerEquations&lt;dim&gt;::compute_forcing_vector(W[q], forcing[q]);</div>
<div class="line">  }</div>
</div><!-- fragment --><p>We now have all of the pieces in place, so perform the assembly. We have an outer loop through the components of the system, and an inner loop over the quadrature points, where we accumulate contributions to the \(i\) th residual \(R_i\) . The general formula for this residual is given in the introduction and at the top of this function. We can, however, simplify it a bit taking into account that the \(i\) th (vector-valued) test function \(\mathbf{z}_i\) has in reality only a single nonzero component (more on this topic can be found in the <a class="el" href="group__vector__valued.html">Handling vector valued problems</a> module). It will be represented by the variable <code>component_i</code> below. With this, the residual term can be re-written as </p><p class="formulaDsp">
\begin{eqnarray*} R_i &amp;=&amp; \left(\frac{(\mathbf{w}_{n+1} - \mathbf{w}_n)_{\text{component\_i}}}{\delta t},(\mathbf{z}_i)_{\text{component\_i}}\right)_K \\ &amp;-&amp; \sum_{d=1}^{\text{dim}} \left( \theta \mathbf{F} ({\mathbf{w}^k_{n+1}})_{\text{component\_i},d} + (1-\theta) \mathbf{F} ({\mathbf{w}_{n}})_{\text{component\_i},d} , \frac{\partial(\mathbf{z}_i)_{\text{component\_i}}} {\partial x_d}\right)_K \\ &amp;+&amp; \sum_{d=1}^{\text{dim}} h^{\eta} \left( \theta \frac{\partial (\mathbf{w}^k_{n+1})_{\text{component\_i}}}{\partial x_d} + (1-\theta) \frac{\partial (\mathbf{w}_n)_{\text{component\_i}}}{\partial x_d} , \frac{\partial (\mathbf{z}_i)_{\text{component\_i}}}{\partial x_d} \right)_K \\ &amp;-&amp; \left( \theta\mathbf{G}({\mathbf{w}^k_n+1} )_{\text{component\_i}} + (1-\theta)\mathbf{G}({\mathbf{w}_n})_{\text{component\_i}} , (\mathbf{z}_i)_{\text{component\_i}} \right)_K , \end{eqnarray*}
</p>
<p> where integrals are understood to be evaluated through summation over quadrature points. <br  />
 We initially sum all contributions of the residual in the positive sense, so that we don't need to negative the Jacobian entries. Then, when we sum into the <code>right_hand_side</code> vector, we negate this residual.</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; fe_v.dofs_per_cell; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">  {</div>
<div class="line">    Sacado::Fad::DFad&lt;double&gt; R_i = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">      fe_v.get_fe().system_to_component_index(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>).first;</div>
</div><!-- fragment --><p>The residual for each row (i) will be accumulating into this fad variable. At the end of the assembly for this row, we will query for the sensitivities to this variable and add them into the Jacobian.</p>
<div class="fragment"><div class="line">         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a> = 0; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a> &lt; fe_v.n_quadrature_points; ++<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>)</div>
<div class="line">           {</div>
<div class="line">             <span class="keywordflow">if</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.is_stationary == <span class="keyword">false</span>)</div>
<div class="line">               R_i += 1.0 / <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.time_step</div>
<div class="line">                      (W[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i]</div>
<div class="line">  </div>
<div class="line">- W_old[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i])</div>
<div class="line">                      fe_v.shape_value_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>, component_i)</div>
<div class="line">                      fe_v.JxW(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>);</div>
<div class="line">  </div>
<div class="line">             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>++)</div>
<div class="line">               R_i</div>
<div class="line">  </div>
<div class="line">-=</div>
<div class="line">                 (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] +</div>
<div class="line">                  (1.0</div>
<div class="line">  </div>
<div class="line">- <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta) flux_old[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>])</div>
<div class="line">                 fe_v.shape_grad_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>, component_i)[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>]</div>
<div class="line">                 fe_v.JxW(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>);</div>
<div class="line">  </div>
<div class="line">             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>++)</div>
<div class="line">               R_i +=</div>
<div class="line">                 1.0</div>
<div class="line">                 std::pow(fe_v.get_cell()-&gt;diameter(),</div>
<div class="line">                          <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.diffusion_power)</div>
<div class="line">                 (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta grad_W[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] +</div>
<div class="line">                  (1.0</div>
<div class="line">  </div>
<div class="line">- <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta) grad_W_old[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>])</div>
<div class="line">                 fe_v.shape_grad_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>, component_i)[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>]</div>
<div class="line">                 fe_v.JxW(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>);</div>
<div class="line">  </div>
<div class="line">             R_i</div>
<div class="line">  </div>
<div class="line">-=</div>
<div class="line">               (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta forcing[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i] +</div>
<div class="line">                (1.0</div>
<div class="line">  </div>
<div class="line">- <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta) forcing_old[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i])</div>
<div class="line">               fe_v.shape_value_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>, component_i)</div>
<div class="line">               fe_v.JxW(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>);</div>
<div class="line">           }</div>
</div><!-- fragment --><p>At the end of the loop, we have to add the sensitivities to the matrix and subtract the residual from the right hand side. Trilinos FAD data type gives us access to the derivatives using <code>R_i.fastAccessDx(k)</code> , so we store the data in a temporary array. This information about the whole row of local dofs is then added to the Trilinos matrix at once (which supports the data types we have chosen).</p>
<div class="fragment"><div class="line">         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a> = 0; <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>)</div>
<div class="line">           residual_derivatives[<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>] = R_i.fastAccessDx(<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>);</div>
<div class="line">         system_matrix.add(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>], dof_indices, residual_derivatives);</div>
<div class="line">         <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>])</div>
<div class="line">  </div>
<div class="line">-= R_i.val();</div>
<div class="line">       }</div>
<div class="line">   }</div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawassemble_face_term"></a> </p><h4>ConservationLaw::assemble_face_term</h4>
<p><br  />
 Here, we do essentially the same as in the previous function. At the top, we introduce the independent variables. Because the current function is also used if we are working on an internal face between two cells, the independent variables are not only the degrees of freedom on the current cell but in the case of an interior face also the ones on the neighbor.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> ConservationLaw&lt;dim&gt;::assemble_face_term(</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                          <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>,</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classFEFaceValuesBase.html">FEFaceValuesBase&lt;dim&gt;</a> &amp;               fe_v,</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classFEFaceValuesBase.html">FEFaceValuesBase&lt;dim&gt;</a> &amp;               fe_v_neighbor,</div>
<div class="line">  <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dof_indices,</div>
<div class="line">  <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dof_indices_neighbor,</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">bool</span>                                  external_face,</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                          <a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>,</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span>                                face_diameter)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>    = fe_v.<a class="code" href="classFEValuesBase.html#a807c3049bfe81743fc0f237dfc2fbdea">n_quadrature_points</a>;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> = fe_v.<a class="code" href="classFEValuesBase.html#a5b264d5b2fb6615f5dea7a21135ed1a5">dofs_per_cell</a>;</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;Sacado::Fad::DFad&lt;double&gt;&gt; independent_local_dof_values(</div>
<div class="line">    <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>),</div>
<div class="line">    independent_neighbor_dof_values(external_face == <span class="keyword">false</span> ? <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> :</div>
<div class="line">                                                             0);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_independent_variables =</div>
<div class="line">    (external_face == <span class="keyword">false</span> ? 2 <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> : <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>++)</div>
<div class="line">    {</div>
<div class="line">      independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] = current_solution(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]);</div>
<div class="line">      independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>].diff(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, n_independent_variables);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (external_face == <span class="keyword">false</span>)</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>++)</div>
<div class="line">      {</div>
<div class="line">        independent_neighbor_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] =</div>
<div class="line">          current_solution(dof_indices_neighbor[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]);</div>
<div class="line">        independent_neighbor_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>].diff(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> + <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>,</div>
<div class="line">                                                n_independent_variables);</div>
<div class="line">      }</div>
</div><!-- fragment --><p>Next, we need to define the values of the conservative variables \({\mathbf W}\) on this side of the face ( \( {\mathbf W}^+\) ) and on the opposite side ( \({\mathbf W}^-\) ), for both \({\mathbf W} = {\mathbf W}^k_{n+1}\) and \({\mathbf W} = {\mathbf W}_n\) . The "this side" values can be computed in exactly the same way as in the previous function, but note that the <code>fe_v</code> variable now is of type <a class="el" href="classFEFaceValues.html">FEFaceValues</a> or <a class="el" href="classFESubfaceValues.html">FESubfaceValues</a>:</p>
<div class="fragment"><div class="line"><a class="code" href="classTable.html">Table&lt;2, Sacado::Fad::DFad&lt;double&gt;</a>&gt; Wplus(</div>
<div class="line">  <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>),</div>
<div class="line">  Wminus(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>);</div>
<div class="line"><a class="code" href="classTable.html">Table&lt;2, double&gt;</a> Wplus_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>),</div>
<div class="line">  Wminus_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q)</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">        fe_v.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#a86644fe67824373cd51e9ff7fca94f8c">system_to_component_index</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>).first;</div>
<div class="line">      Wplus[q][component_i] +=</div>
<div class="line">        independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]</div>
<div class="line">        fe_v.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, component_i);</div>
<div class="line">      Wplus_old[q][component_i] +=</div>
<div class="line">        old_solution(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>])</div>
<div class="line">        fe_v.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, component_i);</div>
<div class="line">    }</div>
</div><!-- fragment --><p>Computing "opposite side" is a bit more complicated. If this is an internal face, we can compute it as above by simply using the independent variables from the neighbor:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (external_face == <span class="keyword">false</span>)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">            fe_v_neighbor.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#a86644fe67824373cd51e9ff7fca94f8c">system_to_component_index</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>).first;</div>
<div class="line">          Wminus[q][component_i] +=</div>
<div class="line">            independent_neighbor_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]</div>
<div class="line">            fe_v_neighbor.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, component_i);</div>
<div class="line">          Wminus_old[q][component_i] +=</div>
<div class="line">            old_solution(dof_indices_neighbor[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>])</div>
<div class="line">            fe_v_neighbor.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, component_i);</div>
<div class="line">        }</div>
<div class="line">  }</div>
</div><!-- fragment --><p>On the other hand, if this is an external boundary face, then the values of \(\mathbf{W}^-\) will be either functions of \(\mathbf{W}^+\) , or they will be prescribed, depending on the kind of boundary condition imposed here. <br  />
 To start the evaluation, let us ensure that the boundary id specified for this boundary is one for which we actually have data in the parameters object. Next, we evaluate the function object for the inhomogeneity. This is a bit tricky: a given boundary might have both prescribed and implicit values. If a particular component is not prescribed, the values evaluate to zero and are ignored below. <br  />
 The rest is done by a function that actually knows the specifics of Euler equation boundary conditions. Note that since we are using fad variables here, sensitivities will be updated appropriately, a process that would otherwise be tremendously complicated.</p>
<div class="fragment"><div class="line"><span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a> &lt; Parameters::AllParameters&lt;dim&gt;::max_n_boundaries,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>,</div>
<div class="line">                         0,</div>
<div class="line">                         Parameters::AllParameters&lt;dim&gt;::max_n_boundaries));</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;Vector&lt;double&gt;&gt; boundary_values(</div>
<div class="line">      <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>(<a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>));</div>
<div class="line">    <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].values.vector_value_list(</div>
<div class="line">      fe_v.<a class="code" href="classFEValuesBase.html#ae41b67cfd48e02f6035e39c84f0fb47a">get_quadrature_points</a>(), boundary_values);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; q++)</div>
<div class="line">      {</div>
<div class="line">        EulerEquations&lt;dim&gt;::compute_Wminus(</div>
<div class="line">          <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].kind,</div>
<div class="line">          fe_v.<a class="code" href="classFEValuesBase.html#ac25ec6835799c3b6c7c842f8acb05eb3">normal_vector</a>(q),</div>
<div class="line">          Wplus[q],</div>
<div class="line">          boundary_values[q],</div>
<div class="line">          Wminus[q]);</div>
</div><!-- fragment --><p>Here we assume that boundary type, boundary normal vector and boundary data values maintain the same during time advancing.</p>
<div class="fragment"><div class="line">      EulerEquations&lt;dim&gt;::compute_Wminus(</div>
<div class="line">        <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].kind,</div>
<div class="line">        fe_v.<a class="code" href="classFEValuesBase.html#ac25ec6835799c3b6c7c842f8acb05eb3">normal_vector</a>(q),</div>
<div class="line">        Wplus_old[q],</div>
<div class="line">        boundary_values[q],</div>
<div class="line">        Wminus_old[q]);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Now that we have \(\mathbf w^+\) and \(\mathbf w^-\) , we can go about computing the numerical flux function \(\mathbf H(\mathbf w^+,\mathbf w^-, \mathbf n)\) for each quadrature point. Before calling the function that does so, we also need to determine the Lax-Friedrich's stability parameter:</p>
<div class="fragment"><div class="line"><a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;</div>
<div class="line">  std::array&lt;Sacado::Fad::DFad&lt;double&gt;, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>&gt;&gt;</div>
<div class="line">  normal_fluxes(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"><a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">std::vector&lt;std::array&lt;double, EulerEquations&lt;dim&gt;::n_components</a>&gt;&gt;</div>
<div class="line">  normal_fluxes_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">switch</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.stabilization_kind)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="fe__dgp__nonparametric__0_8txt.html#a8290746300287635d0fe47e4071ea1ef">Parameters::Flux::constant</a>:</div>
<div class="line">      <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a> = <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.stabilization_value;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> Parameters::Flux::mesh_dependent:</div>
<div class="line">      <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a> = face_diameter / (2.0 <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.time_step);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">      <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a> = 1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q)</div>
<div class="line">  {</div>
<div class="line">    EulerEquations&lt;dim&gt;::numerical_normal_flux(</div>
<div class="line">      fe_v.<a class="code" href="classFEValuesBase.html#ac25ec6835799c3b6c7c842f8acb05eb3">normal_vector</a>(q), Wplus[q], Wminus[q], <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>, normal_fluxes[q]);</div>
<div class="line">    EulerEquations&lt;dim&gt;::numerical_normal_flux(fe_v.<a class="code" href="classFEValuesBase.html#ac25ec6835799c3b6c7c842f8acb05eb3">normal_vector</a>(q),</div>
<div class="line">                                               Wplus_old[q],</div>
<div class="line">                                               Wminus_old[q],</div>
<div class="line">                                               <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>,</div>
<div class="line">                                               normal_fluxes_old[q]);</div>
<div class="line">  }</div>
</div><!-- fragment --><p>Now assemble the face term in exactly the same way as for the cell contributions in the previous function. The only difference is that if this is an internal face, we also have to take into account the sensitivities of the residual contributions to the degrees of freedom on the neighboring cell:</p>
<div class="fragment"><div class="line">     std::vector&lt;double&gt; residual_derivatives(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; fe_v.<a class="code" href="classFEValuesBase.html#a5b264d5b2fb6615f5dea7a21135ed1a5">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">       <span class="keywordflow">if</span> (fe_v.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#ab275cbead21bb11b1208222b6d662357">has_support_on_face</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>) == <span class="keyword">true</span>)</div>
<div class="line">         {</div>
<div class="line">           Sacado::Fad::DFad&lt;double&gt; R_i = 0;</div>
<div class="line">  </div>
<div class="line">           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a> = 0; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a> &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>)</div>
<div class="line">             {</div>
<div class="line">               <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">                 fe_v.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#a86644fe67824373cd51e9ff7fca94f8c">system_to_component_index</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>).first;</div>
<div class="line">  </div>
<div class="line">               R_i += (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta normal_fluxes[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i] +</div>
<div class="line">                       (1.0</div>
<div class="line">  </div>
<div class="line">- <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta)</div>
<div class="line">                         normal_fluxes_old[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i])</div>
<div class="line">                      fe_v.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>, component_i)</div>
<div class="line">                      fe_v.<a class="code" href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">JxW</a>(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>);</div>
<div class="line">             }</div>
<div class="line">  </div>
<div class="line">           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a> = 0; <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>)</div>
<div class="line">             residual_derivatives[<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>] = R_i.fastAccessDx(<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>);</div>
<div class="line">           system_matrix.add(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>], dof_indices, residual_derivatives);</div>
<div class="line">  </div>
<div class="line">           <span class="keywordflow">if</span> (external_face == <span class="keyword">false</span>)</div>
<div class="line">             {</div>
<div class="line">               <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a> = 0; <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>)</div>
<div class="line">                 residual_derivatives[<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>] = R_i.fastAccessDx(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> + <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>);</div>
<div class="line">               system_matrix.add(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>],</div>
<div class="line">                                 dof_indices_neighbor,</div>
<div class="line">                                 residual_derivatives);</div>
<div class="line">             }</div>
<div class="line">  </div>
<div class="line">           <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>])</div>
<div class="line">  </div>
<div class="line">-= R_i.val();</div>
<div class="line">         }</div>
<div class="line">   }</div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawsolve"></a> </p><h4>ConservationLaw::solve</h4>
<p><br  />
 Here, we actually solve the linear system, using either of Trilinos' Aztec or Amesos linear solvers. The result of the computation will be written into the argument vector passed to this function. The result is a pair of number of iterations and the final linear residual.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">std::pair&lt;unsigned int, double&gt;</div>
<div class="line"><a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">ConservationLaw&lt;dim&gt;::solve</a>(<a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;newton_update)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">switch</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.solver)</div>
<div class="line">    {</div>
</div><!-- fragment --><p>If the parameter file specified that a direct solver shall be used, then we'll get here. The process is straightforward, since deal.II provides a wrapper class to the Amesos direct solver within Trilinos. All we have to do is to create a solver control object (which is just a dummy object here, since we won't perform any iterations), and then create the direct solver object. When actually doing the solve, note that we don't pass a preconditioner. That wouldn't make much sense for a direct solver anyway. At the end we return the solver control statistics &mdash; which will tell that no iterations have been performed and that the final linear residual is zero, absent any better information that may be provided here:</p>
<div class="fragment"><div class="line"><span class="keywordflow">case</span> Parameters::Solver::direct:</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classSolverControl.html">SolverControl</a>                                  solver_control(1, 0);</div>
<div class="line">    <a class="code" href="structTrilinosWrappers_1_1SolverDirect_1_1AdditionalData.html">TrilinosWrappers::SolverDirect::AdditionalData</a> <a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>(</div>
<div class="line">      <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.output == Parameters::Solver::verbose);</div>
<div class="line">    <a class="code" href="classTrilinosWrappers_1_1SolverDirect.html">TrilinosWrappers::SolverDirect</a> direct(solver_control, <a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>);</div>
<div class="line"> </div>
<div class="line">    direct.solve(system_matrix, newton_update, <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> {solver_control.last_step(), solver_control.last_value()};</div>
<div class="line">  }</div>
</div><!-- fragment --><p>Likewise, if we are to use an iterative solver, we use Aztec's GMRES solver. We could use the Trilinos wrapper classes for iterative solvers and preconditioners here as well, but we choose to use an Aztec solver directly. For the given problem, Aztec's internal preconditioner implementations are superior over the ones deal.II has wrapper classes to, so we use ILU-T preconditioning within the AztecOO solver and set a bunch of options that can be changed from the parameter file. <br  />
 There are two more practicalities: Since we have built our right hand side and solution vector as deal.II <a class="el" href="classVector.html">Vector</a> objects (as opposed to the matrix, which is a Trilinos object), we must hand the solvers Trilinos Epetra vectors. Luckily, they support the concept of a 'view', so we just send in a pointer to our deal.II vectors. We have to provide an Epetra_Map for the vector that sets the parallel distribution, which is just a dummy object in serial. The easiest way is to ask the matrix for its map, and we're going to be ready for matrix-vector products with it. <br  />
 Secondly, the Aztec solver wants us to pass a Trilinos Epetra_CrsMatrix in, not the deal.II wrapper class itself. So we access to the actual Trilinos matrix in the Trilinos wrapper class by the command trilinos_matrix(). Trilinos wants the matrix to be non-constant, so we have to manually remove the constantness using a const_cast.</p>
<div class="fragment"><div class="line">      <span class="keywordflow">case</span> Parameters::Solver::gmres:</div>
<div class="line">        {</div>
<div class="line">          Epetra_Vector <a class="code" href="vector__valued__0_8txt.html#a2b24e414d1a0d32deea919c5e8899811">x</a>(<a class="code" href="namespaceFEValuesViews.html#af2099b26234f5816729f7f6dc523dc0f">View</a>,</div>
<div class="line">                          system_matrix.trilinos_matrix().DomainMap(),</div>
<div class="line">                          newton_update.<a class="code" href="classVector.html#af34b888fe493ef2ed188179de69ad7ed">begin</a>());</div>
<div class="line">          Epetra_Vector <a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a>(<a class="code" href="namespaceFEValuesViews.html#af2099b26234f5816729f7f6dc523dc0f">View</a>,</div>
<div class="line">                          system_matrix.trilinos_matrix().RangeMap(),</div>
<div class="line">                          <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>.begin());</div>
<div class="line"> </div>
<div class="line">          AztecOO <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>;</div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecOption(</div>
<div class="line">            AZ_output,</div>
<div class="line">            (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.output == Parameters::Solver::quiet ? AZ_none :</div>
<div class="line">                                                              AZ_all));</div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecOption(AZ_solver, AZ_gmres);</div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetRHS(&amp;<a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a>);</div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetLHS(&amp;<a class="code" href="vector__valued__0_8txt.html#a2b24e414d1a0d32deea919c5e8899811">x</a>);</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecOption(AZ_precond, AZ_dom_decomp);</div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecOption(AZ_subdomain_solve, AZ_ilut);</div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecOption(AZ_overlap, 0);</div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecOption(AZ_reorder, 0);</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecParam(AZ_drop, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.ilut_drop);</div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecParam(AZ_ilut_fill, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.ilut_fill);</div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecParam(AZ_athresh, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.ilut_atol);</div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecParam(AZ_rthresh, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.ilut_rtol);</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetUserMatrix(</div>
<div class="line">            <span class="keyword">const_cast&lt;</span>Epetra_CrsMatrix<span class="keyword">&gt;</span>(&amp;system_matrix.trilinos_matrix()));</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.Iterate(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.max_iterations,</div>
<div class="line">                         <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.linear_residual);</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">return</span> {<a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.NumIters(), <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.TrueResidual()};</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">  <span class="keywordflow">return</span> {0, 0};</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawcompute_refinement_indicators"></a> </p><h4>ConservationLaw::compute_refinement_indicators</h4>
<p>This function is real simple: We don't pretend that we know here what a good refinement indicator would be. Rather, we assume that the <code>EulerEquation</code> class would know about this, and so we simply defer to the respective function we've implemented there:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> ConservationLaw&lt;dim&gt;::compute_refinement_indicators(</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;refinement_indicators)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  EulerEquations&lt;dim&gt;::compute_refinement_indicators(dof_handler,</div>
<div class="line">                                                     <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                                     predictor,</div>
<div class="line">                                                     refinement_indicators);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawrefine_grid"></a> </p><h4>ConservationLaw::refine_grid</h4>
<p>Here, we use the refinement indicators computed before and refine the mesh. At the beginning, we loop over all cells and mark those that we think should be refined:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">ConservationLaw&lt;dim&gt;::refine_grid(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;refinement_indicators)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell_no = <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;active_cell_index();</div>
<div class="line">      <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;clear_coarsen_flag();</div>
<div class="line">      <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;clear_refine_flag();</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> ((<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;level() &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.shock_levels) &amp;&amp;</div>
<div class="line">          (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(refinement_indicators(cell_no)) &gt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.shock_val))</div>
<div class="line">        <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;set_refine_flag();</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;level() &gt; 0) &amp;&amp;</div>
<div class="line">               (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(refinement_indicators(cell_no)) &lt;</div>
<div class="line">                0.75 <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.shock_val))</div>
<div class="line">        <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;set_coarsen_flag();</div>
<div class="line">    }</div>
</div><!-- fragment --><p>Then we need to transfer the various solution vectors from the old to the new grid while we do the refinement. The <a class="el" href="classSolutionTransfer.html">SolutionTransfer</a> class is our friend here; it has a fairly extensive documentation, including examples, so we won't comment much on the following code. The last three lines simply re-set the sizes of some other vectors to the now correct size:</p>
<div class="fragment"><div class="line">  std::vector&lt;Vector&lt;double&gt;&gt; transfer_in;</div>
<div class="line">  std::vector&lt;Vector&lt;double&gt;&gt; transfer_out;</div>
<div class="line"> </div>
<div class="line">  transfer_in.push_back(old_solution);</div>
<div class="line">  transfer_in.push_back(predictor);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.prepare_coarsening_and_refinement();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classSolutionTransfer.html">SolutionTransfer&lt;dim&gt;</a> soltrans(dof_handler);</div>
<div class="line">  soltrans.prepare_for_coarsening_and_refinement(transfer_in);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.execute_coarsening_and_refinement();</div>
<div class="line"> </div>
<div class="line">  dof_handler.<a class="code" href="classDoFHandler.html#ad316958f8045d9a48094335b23a03a53">clear</a>();</div>
<div class="line">  dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
<div class="line"> </div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> new_old_solution(1);</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> new_predictor(1);</div>
<div class="line"> </div>
<div class="line">    transfer_out.push_back(new_old_solution);</div>
<div class="line">    transfer_out.push_back(new_predictor);</div>
<div class="line">    transfer_out[0].reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    transfer_out[1].reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  soltrans.interpolate(transfer_in, transfer_out);</div>
<div class="line"> </div>
<div class="line">  old_solution.reinit(transfer_out[0].<a class="code" href="function__0_8txt.html#a4f780342f2d5d632f82cf7fd90158a66">size</a>());</div>
<div class="line">  old_solution = transfer_out[0];</div>
<div class="line"> </div>
<div class="line">  predictor.reinit(transfer_out[1].<a class="code" href="function__0_8txt.html#a4f780342f2d5d632f82cf7fd90158a66">size</a>());</div>
<div class="line">  predictor = transfer_out[1];</div>
<div class="line"> </div>
<div class="line">  current_solution.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">  current_solution = old_solution;</div>
<div class="line">  <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawoutput_results"></a> </p><h4>ConservationLaw::output_results</h4>
<p>This function now is rather straightforward. All the magic, including transforming data from conservative variables to physical ones has been abstracted and moved into the EulerEquations class so that it can be replaced in case we want to solve some other hyperbolic conservation law. <br  />
 Note that the number of the output file is determined by keeping a counter in the form of a static variable that is set to zero the first time we come to this function and is incremented by one at the end of each invocation.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> ConservationLaw&lt;dim&gt;::output_results()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keyword">typename</span> EulerEquations&lt;dim&gt;::Postprocessor <a class="code" href="data__postprocessor__0_8txt.html#a80e53cb52e5dbb182dd14ee528927a77">postprocessor</a>(</div>
<div class="line">    <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.schlieren_plot);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">attach_dof_handler</a>(dof_handler);</div>
<div class="line"> </div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(current_solution,</div>
<div class="line">                           EulerEquations&lt;dim&gt;::component_names(),</div>
<div class="line">                           <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;::type_dof_data</a>,</div>
<div class="line">                           EulerEquations&lt;dim&gt;::component_interpretation());</div>
<div class="line"> </div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(current_solution, <a class="code" href="data__postprocessor__0_8txt.html#a80e53cb52e5dbb182dd14ee528927a77">postprocessor</a>);</div>
<div class="line"> </div>
<div class="line">  data_out.<a class="code" href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">build_patches</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> output_file_number = 0;</div>
<div class="line">  std::string         filename =</div>
<div class="line">    <span class="stringliteral">&quot;solution-&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(output_file_number, 3) + <span class="stringliteral">&quot;.vtk&quot;</span>;</div>
<div class="line">  std::ofstream <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>(filename);</div>
<div class="line">  data_out.<a class="code" href="classDataOutInterface.html#acad99726038e4fca7f605fdffb3317e4">write_vtk</a>(<a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>);</div>
<div class="line"> </div>
<div class="line">  ++output_file_number;</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawrun"></a> </p><h4>ConservationLaw::run</h4>
<p>This function contains the top-level logic of this program: initialization, the time loop, and the inner Newton iteration. <br  />
 At the beginning, we read the mesh file specified by the parameter file, setup the <a class="el" href="classDoFHandler.html">DoFHandler</a> and various vectors, and then interpolate the given initial conditions on this mesh. We then perform a number of mesh refinements, based on the initial conditions, to obtain a mesh that is already well adapted to the starting solution. At the end of this process, we output the initial solution.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">ConservationLaw&lt;dim&gt;::run</a>()</div>
<div class="line">{</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classGridIn.html">GridIn&lt;dim&gt;</a> grid_in;</div>
<div class="line">    grid_in.<a class="code" href="classGridIn.html#a82ac1c03b0efe87204ad45d2f1d87f7e">attach_triangulation</a>(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>);</div>
<div class="line"> </div>
<div class="line">    std::ifstream input_file(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.mesh_filename);</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(input_file, <a class="code" href="group__Exceptions.html#ga4c22c86ff89575667de2ca9778aa28e5">ExcFileNotOpen</a>(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.mesh_filename.c_str()));</div>
<div class="line"> </div>
<div class="line">    grid_in.<a class="code" href="classGridIn.html#abbb16aa0aa53bfa9231b69278d397616">read_ucd</a>(input_file);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  dof_handler.<a class="code" href="classDoFHandler.html#ad316958f8045d9a48094335b23a03a53">clear</a>();</div>
<div class="line">  dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
</div><!-- fragment --><p>Size all of the fields.</p>
<div class="fragment"><div class="line">old_solution.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">current_solution.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">predictor.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line"><a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line"> </div>
<div class="line">setup_system();</div>
<div class="line"> </div>
<div class="line"><a class="code" href="namespaceVectorTools.html#a761f008bdeb7d94a69205ae824deefad">VectorTools::interpolate</a>(dof_handler,</div>
<div class="line">                         <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.initial_conditions,</div>
<div class="line">                         old_solution);</div>
<div class="line">current_solution = old_solution;</div>
<div class="line">predictor        = old_solution;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.do_refine == <span class="keyword">true</span>)</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.shock_levels; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classVector.html">Vector&lt;double&gt;</a> refinement_indicators(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells());</div>
<div class="line"> </div>
<div class="line">      compute_refinement_indicators(refinement_indicators);</div>
<div class="line">      refine_grid(refinement_indicators);</div>
<div class="line"> </div>
<div class="line">      setup_system();</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="namespaceVectorTools.html#a761f008bdeb7d94a69205ae824deefad">VectorTools::interpolate</a>(dof_handler,</div>
<div class="line">                               <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.initial_conditions,</div>
<div class="line">                               old_solution);</div>
<div class="line">      current_solution = old_solution;</div>
<div class="line">      predictor        = old_solution;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">output_results();</div>
</div><!-- fragment --><p>We then enter into the main time stepping loop. At the top we simply output some status information so one can keep track of where a computation is, as well as the header for a table that indicates progress of the nonlinear inner iteration:</p>
<div class="fragment"><div class="line"><a class="code" href="classVector.html">Vector&lt;double&gt;</a> newton_update(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a>        = 0;</div>
<div class="line"><span class="keywordtype">double</span> next_output = <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a> + <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.output_step;</div>
<div class="line"> </div>
<div class="line">predictor = old_solution;</div>
<div class="line"><span class="keywordflow">while</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.final_time)</div>
<div class="line">  {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;T=&quot;</span> &lt;&lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a> &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;   Number of active cells:       &quot;</span></div>
<div class="line">              &lt;&lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells() &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;   Number of degrees of freedom: &quot;</span> &lt;&lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>()</div>
<div class="line">              &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;   NonLin Res     Lin Iter       Lin Res&quot;</span> &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;   _____________________________________&quot;</span> &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>Then comes the inner Newton iteration to solve the nonlinear problem in each time step. The way it works is to reset matrix and right hand side to zero, then assemble the linear system. If the norm of the right hand side is small enough, then we declare that the Newton iteration has converged. Otherwise, we solve the linear system, update the current solution with the Newton increment, and output convergence information. At the end, we check that the number of Newton iterations is not beyond a limit of 10</p>
<ul>
<li>if it is, it appears likely that iterations are diverging and further iterations would do no good. If that happens, we throw an exception that will be caught in <code><a class="el" href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main()</a></code> with status information being displayed before the program aborts. <br  />
 Note that the way we write the AssertThrow macro below is by and large equivalent to writing something like <code>if (!(nonlin_iter &lt;= 10)) throw ExcMessage ("No convergence in nonlinear solver");</code>. The only significant difference is that AssertThrow also makes sure that the exception being thrown carries with it information about the location (file name and line number) where it was generated. This is not overly critical here, because there is only a single place where this sort of exception can happen; however, it is generally a very useful tool when one wants to find out where an error occurred.</li>
</ul>
<div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nonlin_iter = 0;</div>
<div class="line">current_solution         = predictor;</div>
<div class="line"><span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line">  {</div>
<div class="line">    system_matrix = 0;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a> = 0;</div>
<div class="line">    assemble_system();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> res_norm = <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>.l2_norm();</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(res_norm) &lt; 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-10)</div>
<div class="line">      {</div>
<div class="line">        std::printf(<span class="stringliteral">&quot;   %-16.3e (converged)\n\n&quot;</span>, res_norm);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        newton_update = 0;</div>
<div class="line"> </div>
<div class="line">        std::pair&lt;unsigned int, double&gt; <a class="code" href="solver__0_8txt.html#a06078ea1995fa54b715bee3b7745f08f">convergence</a> =</div>
<div class="line">          <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>(newton_update);</div>
<div class="line"> </div>
<div class="line">        current_solution += newton_update;</div>
<div class="line"> </div>
<div class="line">        std::printf(<span class="stringliteral">&quot;   %-16.3e %04d        %-5.2e\n&quot;</span>,</div>
<div class="line">                    res_norm,</div>
<div class="line">                    <a class="code" href="solver__0_8txt.html#a06078ea1995fa54b715bee3b7745f08f">convergence</a>.first,</div>
<div class="line">                    <a class="code" href="solver__0_8txt.html#a06078ea1995fa54b715bee3b7745f08f">convergence</a>.second);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    ++nonlin_iter;</div>
<div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(nonlin_iter &lt;= 10,</div>
<div class="line">                <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;No convergence in nonlinear solver&quot;</span>));</div>
<div class="line">  }</div>
</div><!-- fragment --><p>We only get to this point if the Newton iteration has converged, so do various post convergence tasks here: <br  />
 First, we update the time and produce graphical output if so desired. Then we update a predictor for the solution at the next time step by approximating \(\mathbf w^{n+1}\approx \mathbf w^n + \delta t \frac{\partial \mathbf w}{\partial t} \approx \mathbf w^n + \delta t \; \frac{\mathbf w^n-\mathbf w^{n-1}}{\delta t} = 2 \mathbf w^n - \mathbf w^{n-1}\) to try and make adaptivity work better. The idea is to try and refine ahead of a front, rather than stepping into a coarse set of elements and smearing the old_solution. This simple time extrapolator does the job. With this, we then refine the mesh if so desired by the user, and finally continue on with the next time step:</p>
<div class="fragment"><div class="line">         <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a> += <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.time_step;</div>
<div class="line">  </div>
<div class="line">         <span class="keywordflow">if</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.output_step &lt; 0)</div>
<div class="line">           output_results();</div>
<div class="line">         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a> &gt;= next_output)</div>
<div class="line">           {</div>
<div class="line">             output_results();</div>
<div class="line">             next_output += <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.output_step;</div>
<div class="line">           }</div>
<div class="line">  </div>
<div class="line">         predictor = current_solution;</div>
<div class="line">         predictor.sadd(2.0,</div>
<div class="line">  </div>
<div class="line">-1.0, old_solution);</div>
<div class="line">  </div>
<div class="line">         old_solution = current_solution;</div>
<div class="line">  </div>
<div class="line">         <span class="keywordflow">if</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.do_refine == <span class="keyword">true</span>)</div>
<div class="line">           {</div>
<div class="line">             <a class="code" href="classVector.html">Vector&lt;double&gt;</a> refinement_indicators(</div>
<div class="line">               <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells());</div>
<div class="line">             compute_refinement_indicators(refinement_indicators);</div>
<div class="line">  </div>
<div class="line">             refine_grid(refinement_indicators);</div>
<div class="line">             setup_system();</div>
<div class="line">  </div>
<div class="line">             newton_update.<a class="code" href="classVector.html#ac4a4dbef7dd65ef8ad35ae56b57d7c05">reinit</a>(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">           }</div>
<div class="line">       }</div>
<div class="line">   }</div>
<div class="line"> } <span class="comment">// namespace Step33</span></div>
</div><!-- fragment --><p><a class="anchor" id="main"></a> </p><h3><a class="el" href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main()</a></h3>
<p>The following `&lsquo;main&rsquo;' function is similar to previous examples and need not to be commented on. Note that the program aborts if no input file name is given on the command line.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(<span class="keywordtype">int</span> argc, charargv[])</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line">      <span class="keyword">using namespace </span><a class="code" href="namespaceStep33.html">Step33</a>;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (argc != 2)</div>
<div class="line">        {</div>
<div class="line">          std::cout &lt;&lt; <span class="stringliteral">&quot;Usage:&quot;</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">&quot; input_file&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">          std::exit(1);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classUtilities_1_1MPI_1_1MPI__InitFinalize.html">Utilities::MPI::MPI_InitFinalize</a> mpi_initialization(</div>
<div class="line">        argc, argv, ::<a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>);</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classStep33_1_1ConservationLaw.html">ConservationLaw&lt;2&gt;</a> cons(argv[1]);</div>
<div class="line">      cons.run();</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (<a class="code" href="parameter__handler__0_8txt.html#ad919e2b915d8e8226aef004c2d8399a8">std::exception</a> &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p> <a class="anchor" id="Results"></a><a class="anchor" id="Results"></a></p><h1>Results</h1>
<p>We run the problem with the mesh <code>slide.inp</code> (this file is in thesame directory as the source code for this program) and the following inputdeck (available as <code>input.prm</code> in the same directory): </p><pre class="fragment"># Listing of Parameters
#
* 
---------------------
* 
# The input grid
set mesh = slide.inp
* 
# Stabilization parameter
set diffusion power = 2.0
* 
#
* 
--------------------------------------------------
# Boundary conditions
# We may specify boundary conditions for up to MAX_BD boundaries.
# Your .inp file should have these boundaries designated.
subsection boundary_1
  set no penetration = true # reflective boundary condition
end
* 
subsection boundary_2
  # outflow boundary
  # set w_2 = pressure
  # set w_2 value = 1.5
* 
- y
end
* 
subsection boundary_3
  set no penetration = true # reflective
  # set w_3 = pressure
  # set w_3 value = 1.0
end
* 
subsection boundary_4
  set no penetration = true #reflective
end
* 
#
* 
--------------------------------------------------
# Initial Conditions
# We set the initial conditions of the conservative variables.  These lines
# are passed to the expression parsing function.  You should use x,y,z for
# the coordinate variables.
* 
subsection initial condition
  set w_0 value = 0
  set w_1 value = 0
  set w_2 value = 10*(x&lt;-0.7)*(y&gt; 0.3)*(y&lt; 0.45) + (1-(x&lt;-0.7)*(y&gt; 0.3)*(y&lt; 0.45))*1.0
  set w_3 value = (1.5-(1.0*1.0*y))/0.4
end
* 
#
* 
--------------------------------------------------
# Time stepping control
subsection time stepping
  set final time = 10.0 # simulation end time
  set time step  = 0.02 # simulation time step
  set theta scheme value = 0.5
end
* 
subsection linear solver
  set output         = quiet
  set method         = gmres
  set ilut fill      = 1.5
  set ilut drop tolerance = 1e-6
  set ilut absolute tolerance = 1e-6
  set ilut relative tolerance = 1.0
end
* 
#
* 
--------------------------------------------------
# Output frequency and kind
subsection output
  set step           = 0.01
  set schlieren plot = true
end
* 
#
* 
--------------------------------------------------
# Refinement control
subsection refinement
  set refinement = true # none only other option
  set shock value = 1.5
  set shock levels = 1 # how many levels of refinement to allow
end
* 
#
* 
--------------------------------------------------
# Flux parameters
subsection flux
 set stab = constant
 #set stab value = 1.0
end
</pre><p>When we run the program, we get the following kind of output: </p><pre class="fragment">...
T=0.14
   Number of active cells:       1807
   Number of degrees of freedom: 7696
* 
   NonLin Res     Lin Iter       Lin Res
   _____________________________________
   7.015e-03        0008        3.39e-13
   2.150e-05        0008        1.56e-15
   2.628e-09        0008        5.09e-20
   5.243e-16        (converged)
* 
T=0.16
   Number of active cells:       1807
   Number of degrees of freedom: 7696
* 
   NonLin Res     Lin Iter       Lin Res
   _____________________________________
   7.145e-03        0008        3.80e-13
   2.548e-05        0008        7.20e-16
   4.063e-09        0008        2.49e-19
   5.970e-16        (converged)
* 
T=0.18
   Number of active cells:       1807
   Number of degrees of freedom: 7696
* 
   NonLin Res     Lin Iter       Lin Res
   _____________________________________
   7.395e-03        0008        6.69e-13
   2.867e-05        0008        1.33e-15
   4.091e-09        0008        3.35e-19
   5.617e-16        (converged)
...
</pre><p>This output reports the progress of the Newton iterations and the timestepping. Note that our implementation of the Newton iteration indeed showsthe expected quadratic convergence order: the norm of the nonlinear residualin each step is roughly the norm of the previous step squared. This leads tothe very rapid convergence we can see here. This holds untiltimes up to \(t=1.9\) at which time the nonlinear iteration reports alack of convergence: </p><pre class="fragment">...
* 
T=1.88
   Number of active cells:       2119
   Number of degrees of freedom: 9096
* 
   NonLin Res     Lin Iter       Lin Res
   _____________________________________
   2.251e-01        0012        9.78e-12
   5.698e-03        0012        2.04e-13
   3.896e-05        0012        1.48e-15
   3.915e-09        0012        1.94e-19
   8.800e-16        (converged)
* 
T=1.9
   Number of active cells:       2140
   Number of degrees of freedom: 9184
* 
   NonLin Res     Lin Iter       Lin Res
   _____________________________________
   2.320e-01        0013        3.94e-12
   1.235e-01        0016        6.62e-12
   8.494e-02        0016        6.05e-12
   1.199e+01        0026        5.72e-10
   1.198e+03        0002        1.20e+03
   7.030e+03        0001        nan
   7.030e+03        0001        nan
   7.030e+03        0001        nan
   7.030e+03        0001        nan
   7.030e+03        0001        nan
   7.030e+03        0001        nan
* 


* 
* 
----------------------------------------------------
Exception on processing:
* 
--------------------------------------------------------
An error occurred in line &lt;2476&gt; of file &lt;step-33.cc&gt; in function
    void Step33::ConservationLaw&lt;dim&gt;::run() [with int dim = 2]
The violated condition was:
    nonlin_iter &lt;= 10
The name and call sequence of the exception was:
    ExcMessage ("No convergence in nonlinear solver")
Additional Information:
No convergence in nonlinear solver
* 
--------------------------------------------------------
* 
Aborting!
* 
----------------------------------------------------
</pre><p>We may find out the cause and possible remedies by looking at the animation of the solution. The result of running these computations is a bunch of output files that wecan pass to our visualization program of choice. When we collate them into amovie, the results of last several time steps looks like this: <img src="https://www.dealii.org/images/steps/developer/step-33.oscillation.gif " alt="" height="300" class="inline"/> <br  />
 As we see, when the heavy mass of fluid hits the left bottom corner,some oscillation occurs and lead to the divergence of the iteration. A lazy solution tothis issue is add more viscosity. If we set the diffusion power \(\eta = 1.5\) instead of \(2.0\) ,the simulation would be able to survive this crisis. Then, the result looks like this:</p>
<p><img src="https://www.dealii.org/images/steps/developer/step-33.slide.ed2.gif " alt="" height="300" class="inline"/> <br  />
 The heavy mass of fluid is drawn down the slope by gravity, whereit collides with the ski lodge and is flung into the air! Hopefully everyoneescapes! And also, we can see the boundary between heavy mass and light mass blur quicklydue to the artificial viscosity. We can also visualize the evolution of the adaptively refined grid: <img src="https://www.dealii.org/images/steps/developer/step-33.slide.adapt.ed2.gif " alt="" height="300" class="inline"/> <br  />
 The adaptivity follows and precedes the flow pattern, based on the heuristicrefinement scheme discussed above.</p>
<p><a class="anchor" id="extensions"></a><a class="anchor" id="Possibilitiesforextensions"></a></p><h3>Possibilities for extensions</h3>
<p><a class="anchor" id="Stabilization"></a></p><h4>Stabilization</h4>
<p>The numerical scheme we have chosen is not particularlystable when the artificial viscosity is small while is too diffusive whenthe artificial viscosity is large. Furthermore, it is known there are moreadvanced techniques to stabilize the solution, for example streamlinediffusion, least-squares stabilization terms, entropy viscosity.</p>
<p><a class="anchor" id="Betterlinearsolvers"></a></p><h4>Better linear solvers</h4>
<p>While the Newton method as a nonlinear solver appears to work verywell if the time step is small enough, the linear solver can beimproved. For example, in the current scheme whenever we use aniterative solver, an ILU is computed anew for each Newton step;likewise, for the direct solver, an LU decomposition of the Newtonmatrix is computed in each step. This is obviously wasteful: from oneNewton step to another, and probably also between time steps, theNewton matrix does not radically change: an ILU or a sparse LUdecomposition for one Newton step is probably still a very goodpreconditioner for the next Newton or time step. Avoiding therecomputation would therefore be a good way to reduce the amount ofcompute time. One could drive this a step further: since close to convergence theNewton matrix changes only a little bit, one may be able to define aquasi-Newton scheme where we only re-compute the residual (i.e. theright hand side vector) in each Newton iteration, and re-use theNewton matrix. The resulting scheme will likely not be of quadraticconvergence order, and we have to expect to do a few more nonlineariterations; however, given that we don't have to spend the time tobuild the Newton matrix each time, the resulting scheme may well befaster.</p>
<p><a class="anchor" id="Cachetheexplicitpartofresidual"></a></p><h4>Cache the explicit part of residual</h4>
<p>The residual calculated in ConservationLaw::assemble_cell_term functionreads \(R_i = \left(\frac{\mathbf{w}^{k}_{n+1} - \mathbf{w}_n}{\delta t} , \mathbf{z}_i \right)_K + \theta \mathbf{B}({\mathbf{w}^{k}_{n+1}})(\mathbf{z}_i)_K + (1-\theta) \mathbf{B}({\mathbf{w}_{n}}) (\mathbf{z}_i)_K \) This means that we calculate the spatial residual twice at one Newtoniteration step: once respect to the current solution \(\mathbf{w}^{k}_{n+1}\) and once more respect to the last time step solution \(\mathbf{w}_{n}\) whichremains the same during all Newton iterations through one timestep.Cache up the explicit part of residual \( \mathbf{B}({\mathbf{w}_{n}}) (\mathbf{z}_i)_K\) during Newton iteration will save lots of labor.</p>
<p><a class="anchor" id="Otherconservationlaws"></a></p><h4>Other conservation laws</h4>
<p>Finally, as a direction beyond the immediate solution of the Eulerequations, this program tries very hard to separate the implementationof everything that is specific to the Euler equations into one class(the <code>EulerEquation</code> class), and everything that isspecific to assembling the matrices and vectors, nonlinear and linearsolvers, and the general top-level logic into another (the <code>ConservationLaw</code> class). By replacing the definitions of flux matrices and numerical fluxes inthis class, as well as the various other parts defined there, itshould be possible to apply the <code>ConservationLaw</code> class toother hyperbolic conservation laws as well.</p>
<p><a class="anchor" id="PlainProg"></a></p><h1>The plain program</h1>
<div class="fragment"><div class="line"><span class="comment">/* ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2007 - 2021 by the deal.II authors</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file is part of the deal.II library.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The deal.II library is free software; you can use it, redistribute</span></div>
<div class="line"><span class="comment"> * it, and/or modify it under the terms of the GNU Lesser General</span></div>
<div class="line"><span class="comment"> * Public License as published by the Free Software Foundation; either</span></div>
<div class="line"><span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><span class="comment"> * The full text of the license can be found in the file LICENSE.md at</span></div>
<div class="line"><span class="comment"> * the top level directory of deal.II.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Author: David Neckels, Boulder, Colorado, 2007, 2008</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2parameter__handler_8h.html">deal.II/base/parameter_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2function__parser_8h.html">deal.II/base/function_parser.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="include_2deal_8II_2base_2utilities_8h.html">deal.II/base/utilities.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2conditional__ostream_8h.html">deal.II/base/conditional_ostream.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2vector_8h.html">deal.II/lac/vector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__out_8h.html">deal.II/grid/grid_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__refinement_8h.html">deal.II/grid/grid_refinement.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__in_8h.html">deal.II/grid/grid_in.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__values_8h.html">deal.II/fe/fe_values.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__system_8h.html">deal.II/fe/fe_system.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2mapping__q1_8h.html">deal.II/fe/mapping_q1.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2solution__transfer_8h.html">deal.II/numerics/solution_transfer.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2trilinos__sparse__matrix_8h.html">deal.II/lac/trilinos_sparse_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2trilinos__precondition_8h.html">deal.II/lac/trilinos_precondition.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lac_2trilinos__solver_8h.html">deal.II/lac/trilinos_solver.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;Sacado.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;array&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceStep33.html">Step33</a></div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">struct </span>EulerEquations</div>
<div class="line">  {</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>             = <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> + 2;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> first_momentum_component = 0;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> density_component        = <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> energy_component         = <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> + 1;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> std::vector&lt;std::string&gt; component_names()</div>
<div class="line">    {</div>
<div class="line">      std::vector&lt;std::string&gt; <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>(<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>, <span class="stringliteral">&quot;momentum&quot;</span>);</div>
<div class="line">      <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>.emplace_back(<span class="stringliteral">&quot;density&quot;</span>);</div>
<div class="line">      <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>.emplace_back(<span class="stringliteral">&quot;energy_density&quot;</span>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">return</span> <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">    component_interpretation()</div>
<div class="line">    {</div>
<div class="line">      std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">        data_component_interpretation(</div>
<div class="line">          <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>, <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a9b7d9c85221484e1998f6869d98cba8b">DataComponentInterpretation::component_is_part_of_vector</a>);</div>
<div class="line">      data_component_interpretation.push_back(</div>
<div class="line">        <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa4924d31df0211f3fb9db3bbe1af0d1c">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line">      data_component_interpretation.push_back(</div>
<div class="line">        <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa4924d31df0211f3fb9db3bbe1af0d1c">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">return</span> data_component_interpretation;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> gas_gamma;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">typename</span> InputVector::value_type</div>
<div class="line">    compute_kinetic_energy(<span class="keyword">const</span> InputVector &amp;W)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">typename</span> InputVector::value_type kinetic_energy = 0;</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">        kinetic_energy +=</div>
<div class="line">          W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] * W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line">      kinetic_energy *= 1. / (2 * W[density_component]);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">return</span> kinetic_energy;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">typename</span> InputVector::value_type</div>
<div class="line">    compute_pressure(<span class="keyword">const</span> InputVector &amp;W)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">return</span> ((gas_gamma - 1.0) *</div>
<div class="line">              (W[energy_component] - compute_kinetic_energy(W)));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> compute_flux_matrix(<span class="keyword">const</span> InputVector &amp;W,</div>
<div class="line">                                    <a class="code" href="base_2ndarray_8h.html#a82399009710c9549884b9d8c506ad695">ndarray</a>&lt;<span class="keyword">typename</span> InputVector::value_type,</div>
<div class="line">                                            <a class="code" href="structStep33_1_1EulerEquations.html#a3b7415438757860701ee1e3ede1ee6ae">EulerEquations&lt;dim&gt;::n_components</a>,</div>
<div class="line">                                            <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt; &amp;     <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keyword">typename</span> InputVector::value_type <a class="code" href="mg__transfer__0_8txt.html#a6b401cd9c6154fc787311f58ab910002">pressure</a> = compute_pressure(W);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">        {</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a> = 0; <a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>)</div>
<div class="line">            <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>][<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>] =</div>
<div class="line">              W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] *</div>
<div class="line">              W[first_momentum_component + <a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>] / W[density_component];</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] += <a class="code" href="mg__transfer__0_8txt.html#a6b401cd9c6154fc787311f58ab910002">pressure</a>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">        <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>[density_component][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] = W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">        <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>[energy_component][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] = W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] /</div>
<div class="line">                                    W[density_component] *</div>
<div class="line">                                    (W[energy_component] + <a class="code" href="mg__transfer__0_8txt.html#a6b401cd9c6154fc787311f58ab910002">pressure</a>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> numerical_normal_flux(</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> &amp;                                      <a class="code" href="global__dof__index__0_8txt.html#a2b84b1d42e4fde15bdf79726ce1cc907">normal</a>,</div>
<div class="line">      <span class="keyword">const</span> InputVector &amp;                                         Wplus,</div>
<div class="line">      <span class="keyword">const</span> InputVector &amp;                                         Wminus,</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span>                                                <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>,</div>
<div class="line">      std::array&lt;typename InputVector::value_type, n_components&gt; &amp;normal_flux)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="base_2ndarray_8h.html#a82399009710c9549884b9d8c506ad695">ndarray</a>&lt;<span class="keyword">typename</span> InputVector::value_type,</div>
<div class="line">              <a class="code" href="structStep33_1_1EulerEquations.html#a3b7415438757860701ee1e3ede1ee6ae">EulerEquations&lt;dim&gt;::n_components</a>,</div>
<div class="line">              <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;</div>
<div class="line">        iflux, oflux;</div>
<div class="line"> </div>
<div class="line">      compute_flux_matrix(Wplus, iflux);</div>
<div class="line">      compute_flux_matrix(Wminus, oflux);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; di &lt; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>; ++di)</div>
<div class="line">        {</div>
<div class="line">          normal_flux[di] = 0;</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">            normal_flux[di] += 0.5 * (iflux[di][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] + oflux[di][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>]) * <a class="code" href="global__dof__index__0_8txt.html#a2b84b1d42e4fde15bdf79726ce1cc907">normal</a>[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line"> </div>
<div class="line">          normal_flux[di] += 0.5 * <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a> * (Wplus[di] - Wminus[di]);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> compute_forcing_vector(</div>
<div class="line">      <span class="keyword">const</span> InputVector &amp;                                         W,</div>
<div class="line">      std::array&lt;typename InputVector::value_type, n_components&gt; &amp;forcing)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> gravity = -1.0;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a> = 0; <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a> &lt; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>; ++<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>)</div>
<div class="line">        <span class="keywordflow">switch</span> (<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>)</div>
<div class="line">          {</div>
<div class="line">            <span class="keywordflow">case</span> first_momentum_component + <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> - 1:</div>
<div class="line">              forcing[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = gravity * W[density_component];</div>
<div class="line">              <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> energy_component:</div>
<div class="line">              forcing[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = gravity * W[first_momentum_component + <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> - 1];</div>
<div class="line">              <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">default</span>:</div>
<div class="line">              forcing[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = 0;</div>
<div class="line">          }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">enum</span> BoundaryKind</div>
<div class="line">    {</div>
<div class="line">      inflow_boundary,</div>
<div class="line">      outflow_boundary,</div>
<div class="line">      no_penetration_boundary,</div>
<div class="line">      pressure_boundary</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataVector&gt;</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">    compute_Wminus(<span class="keyword">const</span> std::array&lt;BoundaryKind, n_components&gt; &amp;boundary_kind,</div>
<div class="line">                   <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> &amp;                        normal_vector,</div>
<div class="line">                   <span class="keyword">const</span> DataVector &amp;                            Wplus,</div>
<div class="line">                   <span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;boundary_values,</div>
<div class="line">                   <span class="keyword">const</span> DataVector &amp;    Wminus)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a> = 0; <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a> &lt; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>; <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>++)</div>
<div class="line">        <span class="keywordflow">switch</span> (boundary_kind[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>])</div>
<div class="line">          {</div>
<div class="line">            <span class="keywordflow">case</span> inflow_boundary:</div>
<div class="line">              {</div>
<div class="line">                Wminus[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = boundary_values(<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">case</span> outflow_boundary:</div>
<div class="line">              {</div>
<div class="line">                Wminus[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = Wplus[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>];</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">case</span> pressure_boundary:</div>
<div class="line">              {</div>
<div class="line">                <span class="keyword">const</span> <span class="keyword">typename</span> DataVector::value_type <a class="code" href="namespaceStep31_1_1EquationData.html#aa1e9e1a7297b10cb39c2065f86acc66f">density</a> =</div>
<div class="line">                  (boundary_kind[density_component] == inflow_boundary ?</div>
<div class="line">                     boundary_values(density_component) :</div>
<div class="line">                     Wplus[density_component]);</div>
<div class="line"> </div>
<div class="line">                <span class="keyword">typename</span> DataVector::value_type kinetic_energy = 0;</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">                  <span class="keywordflow">if</span> (boundary_kind[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] == inflow_boundary)</div>
<div class="line">                    kinetic_energy += boundary_values(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>) * boundary_values(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>);</div>
<div class="line">                  <span class="keywordflow">else</span></div>
<div class="line">                    kinetic_energy += Wplus[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] * Wplus[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line">                kinetic_energy *= 1. / 2. / <a class="code" href="namespaceStep31_1_1EquationData.html#aa1e9e1a7297b10cb39c2065f86acc66f">density</a>;</div>
<div class="line"> </div>
<div class="line">                Wminus[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] =</div>
<div class="line">                  boundary_values(<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>) / (gas_gamma - 1.0) + kinetic_energy;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">case</span> no_penetration_boundary:</div>
<div class="line">              {</div>
<div class="line">                <span class="keyword">typename</span> DataVector::value_type vdotn = 0;</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>++)</div>
<div class="line">                  {</div>
<div class="line">                    vdotn += Wplus[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] * normal_vector[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line">                  }</div>
<div class="line"> </div>
<div class="line">                Wminus[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = Wplus[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] - 2.0 * vdotn * normal_vector[<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>];</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">default</span>:</div>
<div class="line">              <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">          }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">    compute_refinement_indicators(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div>
<div class="line">                                  <span class="keyword">const</span> <a class="code" href="classMapping.html">Mapping&lt;dim&gt;</a> &amp;   <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                  <span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp; <a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>,</div>
<div class="line">                                  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;       refinement_indicators)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> = dof_handler.<a class="code" href="classDoFHandler.html#ac1fedeb50b5f03b13d8b69f86e33f726">get_fe</a>().<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>();</div>
<div class="line">      std::vector&lt;unsigned int&gt; <a class="code" href="distributed__0_8txt.html#ad207fe81a5be05e18534713c2677da7b">dofs</a>(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classQMidpoint.html">QMidpoint&lt;dim&gt;</a> quadrature_formula;</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>    update_flags = <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a>;</div>
<div class="line">      <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>        fe_v(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                         dof_handler.<a class="code" href="classDoFHandler.html#ac1fedeb50b5f03b13d8b69f86e33f726">get_fe</a>(),</div>
<div class="line">                         quadrature_formula,</div>
<div class="line">                         update_flags);</div>
<div class="line"> </div>
<div class="line">      std::vector&lt;std::vector&lt;Tensor&lt;1, dim&gt;&gt;&gt; dU(</div>
<div class="line">        1, <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a>&gt;(<a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>));</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell_no = <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;active_cell_index();</div>
<div class="line">          fe_v.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line">          fe_v.<a class="code" href="classFEValuesBase.html#ad1f4e0deb5d982e8172d82141c634a67">get_function_gradients</a>(<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>, dU);</div>
<div class="line"> </div>
<div class="line">          refinement_indicators(cell_no) = <a class="code" href="base_2vectorization_8h.html#a2aa674852f105b0ed1b35f569c19fea6">std::log</a>(</div>
<div class="line">            1 + <a class="code" href="solver__cg__0_8txt.html#a557c71e94a2542d697ca3426b8843cd4">std::sqrt</a>(dU[0][density_component] * dU[0][density_component]));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">class </span>Postprocessor : <span class="keyword">public</span> <a class="code" href="classDataPostprocessor.html">DataPostprocessor</a>&lt;dim&gt;</div>
<div class="line">    {</div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">      Postprocessor(<span class="keyword">const</span> <span class="keywordtype">bool</span> do_schlieren_plot);</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">virtual</span> <span class="keywordtype">void</span> evaluate_vector_field(</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="structDataPostprocessorInputs_1_1Vector.html">DataPostprocessorInputs::Vector&lt;dim&gt;</a> &amp;inputs,</div>
<div class="line">        <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt; &amp;computed_quantities) <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">virtual</span> std::vector&lt;std::string&gt; <a class="code" href="data__postprocessor__0_8txt.html#afb21caeba7bf26aba89ce705266fedb1">get_names</a>() <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">virtual</span> <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;</div>
<div class="line">        <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0">DataComponentInterpretation::DataComponentInterpretation</a>&gt;</div>
<div class="line">      get_data_component_interpretation() <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">virtual</span> <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> <a class="code" href="data__postprocessor__0_8txt.html#abfdf708e97518fa7ad2b849b80afddc1">get_needed_update_flags</a>() <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">private</span>:</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">bool</span> do_schlieren_plot;</div>
<div class="line">    };</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="structStep33_1_1EulerEquations.html#a2070ab9564d2cc45fe65357c1bc914e8">EulerEquations&lt;dim&gt;::gas_gamma</a> = 1.4;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <a class="code" href="classStep33_1_1EulerEquations_1_1Postprocessor.html#adae3bcb8efa74ec959ac0c065c8eea9b">EulerEquations&lt;dim&gt;::Postprocessor::Postprocessor</a>(</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> do_schlieren_plot)</div>
<div class="line">    : do_schlieren_plot(do_schlieren_plot)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> EulerEquations&lt;dim&gt;::Postprocessor::evaluate_vector_field(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="structDataPostprocessorInputs_1_1Vector.html">DataPostprocessorInputs::Vector&lt;dim&gt;</a> &amp;inputs,</div>
<div class="line">    <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;<a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt; &amp;               computed_quantities)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_quadrature_points = inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a904b46a59d224ec214e4816e584cba5f">solution_values</a>.size();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a2a918d936d56f2be4cdad1b8074c3a86">solution_gradients</a>.size() == n_quadrature_points,</div>
<div class="line">             <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(computed_quantities.size() == n_quadrature_points,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a904b46a59d224ec214e4816e584cba5f">solution_values</a>[0].size() == <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(computed_quantities[0].<a class="code" href="function__0_8txt.html#a4f780342f2d5d632f82cf7fd90158a66">size</a>() == <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> + 2, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(computed_quantities[0].<a class="code" href="function__0_8txt.html#a4f780342f2d5d632f82cf7fd90158a66">size</a>() == <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> + 1, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_quadrature_points; ++q)</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespaceStep31_1_1EquationData.html#aa1e9e1a7297b10cb39c2065f86acc66f">density</a> = inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a904b46a59d224ec214e4816e584cba5f">solution_values</a>[q](density_component);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">          computed_quantities[q](<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>) =</div>
<div class="line">            inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a904b46a59d224ec214e4816e584cba5f">solution_values</a>[q](first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>) / <a class="code" href="namespaceStep31_1_1EquationData.html#aa1e9e1a7297b10cb39c2065f86acc66f">density</a>;</div>
<div class="line"> </div>
<div class="line">        computed_quantities[q](<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>) =</div>
<div class="line">          compute_pressure(inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a904b46a59d224ec214e4816e584cba5f">solution_values</a>[q]);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">          computed_quantities[q](<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> + 1) =</div>
<div class="line">            inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a2a918d936d56f2be4cdad1b8074c3a86">solution_gradients</a>[q][density_component] *</div>
<div class="line">            inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a2a918d936d56f2be4cdad1b8074c3a86">solution_gradients</a>[q][density_component];</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  std::vector&lt;std::string&gt; <a class="code" href="data__postprocessor__0_8txt.html#afb21caeba7bf26aba89ce705266fedb1">EulerEquations&lt;dim&gt;::Postprocessor::get_names</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    std::vector&lt;std::string&gt; <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">      <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>.emplace_back(<span class="stringliteral">&quot;velocity&quot;</span>);</div>
<div class="line">    <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>.emplace_back(<span class="stringliteral">&quot;pressure&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">      <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>.emplace_back(<span class="stringliteral">&quot;schlieren_plot&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">  EulerEquations&lt;dim&gt;::Postprocessor::get_data_component_interpretation()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">      interpretation(<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>,</div>
<div class="line">                     <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a9b7d9c85221484e1998f6869d98cba8b">DataComponentInterpretation::component_is_part_of_vector</a>);</div>
<div class="line"> </div>
<div class="line">    interpretation.push_back(<a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa4924d31df0211f3fb9db3bbe1af0d1c">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">      interpretation.push_back(</div>
<div class="line">        <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa4924d31df0211f3fb9db3bbe1af0d1c">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> interpretation;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a></div>
<div class="line">  <a class="code" href="data__postprocessor__0_8txt.html#abfdf708e97518fa7ad2b849b80afddc1">EulerEquations&lt;dim&gt;::Postprocessor::get_needed_update_flags</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">      <span class="keywordflow">return</span> <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a>;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      <span class="keywordflow">return</span> <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">namespace </span>Parameters</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">struct </span>Solver</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">enum</span> <a class="code" href="namespaceStep56.html#a3c2f04c8033af75ffedd7bfbf96640a1">SolverType</a></div>
<div class="line">      {</div>
<div class="line">        gmres,</div>
<div class="line">        direct</div>
<div class="line">      };</div>
<div class="line">      <a class="code" href="namespaceStep56.html#a3c2f04c8033af75ffedd7bfbf96640a1">SolverType</a> <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">enum</span> OutputType</div>
<div class="line">      {</div>
<div class="line">        quiet,</div>
<div class="line">        verbose</div>
<div class="line">      };</div>
<div class="line">      OutputType <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">double</span> linear_residual;</div>
<div class="line">      <span class="keywordtype">int</span>    max_iterations;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">double</span> ilut_fill;</div>
<div class="line">      <span class="keywordtype">double</span> ilut_atol;</div>
<div class="line">      <span class="keywordtype">double</span> ilut_rtol;</div>
<div class="line">      <span class="keywordtype">double</span> ilut_drop;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">      <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Solver::declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;linear solver&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(</div>
<div class="line">          <span class="stringliteral">&quot;output&quot;</span>,</div>
<div class="line">          <span class="stringliteral">&quot;quiet&quot;</span>,</div>
<div class="line">          <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;quiet|verbose&quot;</span>),</div>
<div class="line">          <span class="stringliteral">&quot;State whether output from solver runs should be printed. &quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;Choices are &lt;quiet|verbose&gt;.&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;method&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;gmres&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;gmres|direct&quot;</span>),</div>
<div class="line">                          <span class="stringliteral">&quot;The kind of solver for the linear system. &quot;</span></div>
<div class="line">                          <span class="stringliteral">&quot;Choices are &lt;gmres|direct&gt;.&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;residual&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;1e-10&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Linear solver residual&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;max iters&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;300&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Maximum solver iterations&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;ilut fill&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Ilut preconditioner fill&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;ilut absolute tolerance&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;1e-9&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Ilut preconditioner tolerance&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;ilut relative tolerance&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;1.1&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Ilut relative tolerance&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;ilut drop tolerance&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;1e-10&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Ilut drop tolerance&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Solver::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;linear solver&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> std::string op = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;output&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (op == <span class="stringliteral">&quot;verbose&quot;</span>)</div>
<div class="line">          <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a> = verbose;</div>
<div class="line">        <span class="keywordflow">if</span> (op == <span class="stringliteral">&quot;quiet&quot;</span>)</div>
<div class="line">          <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a> = quiet;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> std::string sv = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;method&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (sv == <span class="stringliteral">&quot;direct&quot;</span>)</div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a> = direct;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sv == <span class="stringliteral">&quot;gmres&quot;</span>)</div>
<div class="line">          <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a> = gmres;</div>
<div class="line"> </div>
<div class="line">        linear_residual = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;residual&quot;</span>);</div>
<div class="line">        max_iterations  = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;max iters&quot;</span>);</div>
<div class="line">        ilut_fill       = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;ilut fill&quot;</span>);</div>
<div class="line">        ilut_atol       = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;ilut absolute tolerance&quot;</span>);</div>
<div class="line">        ilut_rtol       = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;ilut relative tolerance&quot;</span>);</div>
<div class="line">        ilut_drop       = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;ilut drop tolerance&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>Refinement</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordtype">bool</span>   do_refine;</div>
<div class="line">      <span class="keywordtype">double</span> shock_val;</div>
<div class="line">      <span class="keywordtype">double</span> shock_levels;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">      <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Refinement::declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;refinement&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;refinement&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Whether to perform mesh refinement or not&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;refinement fraction&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;0.1&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Fraction of high refinement&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;unrefinement fraction&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;0.1&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Fraction of low unrefinement&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;max elements&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;1000000&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;maximum number of elements&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;shock value&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;4.0&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;value for shock indicator&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;shock levels&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;3.0&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;number of shock refinement levels&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Refinement::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;refinement&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        do_refine    = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;refinement&quot;</span>);</div>
<div class="line">        shock_val    = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;shock value&quot;</span>);</div>
<div class="line">        shock_levels = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;shock levels&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>Flux</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">enum</span> StabilizationKind</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="fe__dgp__nonparametric__0_8txt.html#a8290746300287635d0fe47e4071ea1ef">constant</a>,</div>
<div class="line">        mesh_dependent</div>
<div class="line">      };</div>
<div class="line">      StabilizationKind stabilization_kind;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">double</span> stabilization_value;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">      <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Flux::declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;flux&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(</div>
<div class="line">          <span class="stringliteral">&quot;stab&quot;</span>,</div>
<div class="line">          <span class="stringliteral">&quot;mesh&quot;</span>,</div>
<div class="line">          <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;constant|mesh&quot;</span>),</div>
<div class="line">          <span class="stringliteral">&quot;Whether to use a constant stabilization parameter or &quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;a mesh-dependent one&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;stab value&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;1&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;alpha stabilization&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Flux::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;flux&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> std::string stab = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;stab&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (stab == <span class="stringliteral">&quot;constant&quot;</span>)</div>
<div class="line">          stabilization_kind = <a class="code" href="fe__dgp__nonparametric__0_8txt.html#a8290746300287635d0fe47e4071ea1ef">constant</a>;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stab == <span class="stringliteral">&quot;mesh&quot;</span>)</div>
<div class="line">          stabilization_kind = mesh_dependent;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line"> </div>
<div class="line">        stabilization_value = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;stab value&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>Output</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordtype">bool</span>   schlieren_plot;</div>
<div class="line">      <span class="keywordtype">double</span> output_step;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">      <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Output::declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;output&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;schlieren plot&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Whether or not to produce schlieren plots&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;step&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;-1&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Output once per this period&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Output::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;output&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        schlieren_plot = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;schlieren plot&quot;</span>);</div>
<div class="line">        output_step    = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;step&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">    <span class="keyword">struct </span>AllParameters : <span class="keyword">public</span> Solver,</div>
<div class="line">                           <span class="keyword">public</span> Refinement,</div>
<div class="line">                           <span class="keyword">public</span> Flux,</div>
<div class="line">                           <span class="keyword">public</span> Output</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_n_boundaries = 10;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">struct </span>BoundaryConditions</div>
<div class="line">      {</div>
<div class="line">        std::array&lt;typename EulerEquations&lt;dim&gt;::BoundaryKind,</div>
<div class="line">                   <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>&gt;</div>
<div class="line">          <a class="code" href="mapping__0_8txt.html#a334bdbfb52225fe249c8d336acfab3e6">kind</a>;</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classFunctionParser.html">FunctionParser&lt;dim&gt;</a> <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>;</div>
<div class="line"> </div>
<div class="line">        BoundaryConditions();</div>
<div class="line">      };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      AllParameters();</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">double</span> diffusion_power;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">double</span> time_step, <a class="code" href="namespaceEuler__DG.html#ae1cc4c5ec49b9998f5dc924707c29ed4">final_time</a>;</div>
<div class="line">      <span class="keywordtype">double</span> theta;</div>
<div class="line">      <span class="keywordtype">bool</span>   is_stationary;</div>
<div class="line"> </div>
<div class="line">      std::string mesh_filename;</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classFunctionParser.html">FunctionParser&lt;dim&gt;</a> initial_conditions;</div>
<div class="line">      BoundaryConditions  boundary_conditions[max_n_boundaries];</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">      <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">    AllParameters&lt;dim&gt;::BoundaryConditions::BoundaryConditions()</div>
<div class="line">      : <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">values</a>(EulerEquations&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;::<a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="convergence__table__0_8txt.html#a37c53a384d86a02751b04a0a89820c55">std::fill</a>(<a class="code" href="mapping__0_8txt.html#a334bdbfb52225fe249c8d336acfab3e6">kind</a>.begin(),</div>
<div class="line">                <a class="code" href="mapping__0_8txt.html#a334bdbfb52225fe249c8d336acfab3e6">kind</a>.end(),</div>
<div class="line">                EulerEquations&lt;dim&gt;::no_penetration_boundary);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">    AllParameters&lt;dim&gt;::AllParameters()</div>
<div class="line">      : diffusion_power(0.)</div>
<div class="line">      , time_step(1.)</div>
<div class="line">      , <a class="code" href="namespaceEuler__DG.html#ae1cc4c5ec49b9998f5dc924707c29ed4">final_time</a>(1.)</div>
<div class="line">      , theta(.5)</div>
<div class="line">      , is_stationary(<a class="code" href="event__0_8txt.html#a60053d8ff825674cfcc1321aba229cd7">true</a>)</div>
<div class="line">      , initial_conditions(EulerEquations&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;::<a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">AllParameters&lt;dim&gt;::declare_parameters</a>(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;mesh&quot;</span>,</div>
<div class="line">                        <span class="stringliteral">&quot;grid.inp&quot;</span>,</div>
<div class="line">                        <a class="code" href="classPatterns_1_1Anything.html">Patterns::Anything</a>(),</div>
<div class="line">                        <span class="stringliteral">&quot;input file name&quot;</span>);</div>
<div class="line"> </div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;diffusion power&quot;</span>,</div>
<div class="line">                        <span class="stringliteral">&quot;2.0&quot;</span>,</div>
<div class="line">                        <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                        <span class="stringliteral">&quot;power of mesh size for diffusion&quot;</span>);</div>
<div class="line"> </div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;time stepping&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;time step&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;0.1&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0),</div>
<div class="line">                          <span class="stringliteral">&quot;simulation time step&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;final time&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;10.0&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0),</div>
<div class="line">                          <span class="stringliteral">&quot;simulation end time&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;theta scheme value&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;0.5&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0, 1),</div>
<div class="line">                          <span class="stringliteral">&quot;value for theta that interpolated between explicit &quot;</span></div>
<div class="line">                          <span class="stringliteral">&quot;Euler (theta=0), Crank-Nicolson (theta=0.5), and &quot;</span></div>
<div class="line">                          <span class="stringliteral">&quot;implicit Euler (theta=1).&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a> = 0; <a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a> &lt; max_n_boundaries; ++<a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a>)</div>
<div class="line">        {</div>
<div class="line">          prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;boundary_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(<a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a>));</div>
<div class="line">          {</div>
<div class="line">            prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;no penetration&quot;</span>,</div>
<div class="line">                              <span class="stringliteral">&quot;false&quot;</span>,</div>
<div class="line">                              <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                              <span class="stringliteral">&quot;whether the named boundary allows gas to &quot;</span></div>
<div class="line">                              <span class="stringliteral">&quot;penetrate or is a rigid wall&quot;</span>);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">di &lt; EulerEquations&lt;dim&gt;::n_components</a>;</div>
<div class="line">                 ++di)</div>
<div class="line">              {</div>
<div class="line">                prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di),</div>
<div class="line">                                  <span class="stringliteral">&quot;outflow&quot;</span>,</div>
<div class="line">                                  <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(</div>
<div class="line">                                    <span class="stringliteral">&quot;inflow|outflow|pressure&quot;</span>),</div>
<div class="line">                                  <span class="stringliteral">&quot;&lt;inflow|outflow|pressure&gt;&quot;</span>);</div>
<div class="line"> </div>
<div class="line">                prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di) +</div>
<div class="line">                                    <span class="stringliteral">&quot; value&quot;</span>,</div>
<div class="line">                                  <span class="stringliteral">&quot;0.0&quot;</span>,</div>
<div class="line">                                  <a class="code" href="classPatterns_1_1Anything.html">Patterns::Anything</a>(),</div>
<div class="line">                                  <span class="stringliteral">&quot;expression in x,y,z&quot;</span>);</div>
<div class="line">              }</div>
<div class="line">          }</div>
<div class="line">          prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;initial condition&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">di &lt; EulerEquations&lt;dim&gt;::n_components</a>; ++di)</div>
<div class="line">          prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di) + <span class="stringliteral">&quot; value&quot;</span>,</div>
<div class="line">                            <span class="stringliteral">&quot;0.0&quot;</span>,</div>
<div class="line">                            <a class="code" href="classPatterns_1_1Anything.html">Patterns::Anything</a>(),</div>
<div class="line">                            <span class="stringliteral">&quot;expression in x,y,z&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Parameters::Solver::declare_parameters</a>(prm);</div>
<div class="line">      <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Parameters::Refinement::declare_parameters</a>(prm);</div>
<div class="line">      <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Parameters::Flux::declare_parameters</a>(prm);</div>
<div class="line">      <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Parameters::Output::declare_parameters</a>(prm);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">    <span class="keywordtype">void</span> AllParameters&lt;dim&gt;::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      mesh_filename   = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;mesh&quot;</span>);</div>
<div class="line">      diffusion_power = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;diffusion power&quot;</span>);</div>
<div class="line"> </div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;time stepping&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        time_step = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;time step&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (time_step == 0)</div>
<div class="line">          {</div>
<div class="line">            is_stationary = <span class="keyword">true</span>;</div>
<div class="line">            time_step     = 1.0;</div>
<div class="line">            <a class="code" href="namespaceEuler__DG.html#ae1cc4c5ec49b9998f5dc924707c29ed4">final_time</a>    = 1.0;</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          is_stationary = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespaceEuler__DG.html#ae1cc4c5ec49b9998f5dc924707c29ed4">final_time</a> = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;final time&quot;</span>);</div>
<div class="line">        theta      = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;theta scheme value&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a> = 0; <a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a> &lt; max_n_boundaries;</div>
<div class="line">           ++<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>)</div>
<div class="line">        {</div>
<div class="line">          prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;boundary_&quot;</span> +</div>
<div class="line">                               <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>));</div>
<div class="line">          {</div>
<div class="line">            std::vector&lt;std::string&gt; expressions(</div>
<div class="line">              <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>, <span class="stringliteral">&quot;0.0&quot;</span>);</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">bool</span> no_penetration = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;no penetration&quot;</span>);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">di &lt; EulerEquations&lt;dim&gt;::n_components</a>;</div>
<div class="line">                 ++di)</div>
<div class="line">              {</div>
<div class="line">                <span class="keyword">const</span> std::string boundary_type =</div>
<div class="line">                  prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di));</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> ((di &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>) &amp;&amp; (no_penetration == <span class="keyword">true</span>))</div>
<div class="line">                  boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].kind[di] =</div>
<div class="line">                    EulerEquations&lt;dim&gt;::no_penetration_boundary;</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (boundary_type == <span class="stringliteral">&quot;inflow&quot;</span>)</div>
<div class="line">                  boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].kind[di] =</div>
<div class="line">                    EulerEquations&lt;dim&gt;::inflow_boundary;</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (boundary_type == <span class="stringliteral">&quot;pressure&quot;</span>)</div>
<div class="line">                  boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].kind[di] =</div>
<div class="line">                    EulerEquations&lt;dim&gt;::pressure_boundary;</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (boundary_type == <span class="stringliteral">&quot;outflow&quot;</span>)</div>
<div class="line">                  boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].kind[di] =</div>
<div class="line">                    EulerEquations&lt;dim&gt;::outflow_boundary;</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                  <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line"> </div>
<div class="line">                expressions[di] =</div>
<div class="line">                  prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di) + <span class="stringliteral">&quot; value&quot;</span>);</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].values.initialize(</div>
<div class="line">              <a class="code" href="classFunctionParser.html">FunctionParser&lt;dim&gt;::default_variable_names</a>(),</div>
<div class="line">              expressions,</div>
<div class="line">              std::map&lt;std::string, double&gt;());</div>
<div class="line">          }</div>
<div class="line">          prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;initial condition&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        std::vector&lt;std::string&gt; expressions(<a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>,</div>
<div class="line">                                             <span class="stringliteral">&quot;0.0&quot;</span>);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">di &lt; EulerEquations&lt;dim&gt;::n_components</a>; di++)</div>
<div class="line">          expressions[di] =</div>
<div class="line">            prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di) + <span class="stringliteral">&quot; value&quot;</span>);</div>
<div class="line">        initial_conditions.initialize(</div>
<div class="line">          <a class="code" href="classFunctionParser.html">FunctionParser&lt;dim&gt;::default_variable_names</a>(),</div>
<div class="line">          expressions,</div>
<div class="line">          std::map&lt;std::string, double&gt;());</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line">      Parameters::Solver::parse_parameters(prm);</div>
<div class="line">      Parameters::Refinement::parse_parameters(prm);</div>
<div class="line">      Parameters::Flux::parse_parameters(prm);</div>
<div class="line">      Parameters::Output::parse_parameters(prm);</div>
<div class="line">    }</div>
<div class="line">  } <span class="comment">// namespace Parameters</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span><a class="code" href="classStep33_1_1ConservationLaw.html">ConservationLaw</a></div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <a class="code" href="classStep33_1_1ConservationLaw.html">ConservationLaw</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *input_filename);</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">run</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">void</span> setup_system();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> assemble_system();</div>
<div class="line">    <span class="keywordtype">void</span> assemble_cell_term(<span class="keyword">const</span> <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> &amp;                       fe_v,</div>
<div class="line">                            <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;<a class="code" href="distributed__0_8txt.html#ad207fe81a5be05e18534713c2677da7b">dofs</a>);</div>
<div class="line">    <span class="keywordtype">void</span> assemble_face_term(</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                          <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>,</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classFEFaceValuesBase.html">FEFaceValuesBase&lt;dim&gt;</a> &amp;               fe_v,</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classFEFaceValuesBase.html">FEFaceValuesBase&lt;dim&gt;</a> &amp;               fe_v_neighbor,</div>
<div class="line">      <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;<a class="code" href="distributed__0_8txt.html#ad207fe81a5be05e18534713c2677da7b">dofs</a>,</div>
<div class="line">      <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dofs_neighbor,</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">bool</span>                                  external_face,</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                          <a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>,</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span>                                face_diameter);</div>
<div class="line"> </div>
<div class="line">    std::pair&lt;unsigned int, double&gt; <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>(<a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;<a class="code" href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> compute_refinement_indicators(<a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;<a class="code" href="grid__generator__0_8txt.html#ad40779ba24977c5f641bfa6ac51032ab">indicator</a>) <span class="keyword">const</span>;</div>
<div class="line">    <span class="keywordtype">void</span> refine_grid(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;<a class="code" href="grid__generator__0_8txt.html#ad40779ba24977c5f641bfa6ac51032ab">indicator</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> output_results() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a>   <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classMappingQ1.html">MappingQ1&lt;dim&gt;</a> <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFESystem.html">FESystem&lt;dim&gt;</a> <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>;</div>
<div class="line">    <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>     dof_handler;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>     <a class="code" href="update__flags__0_8txt.html#a5873b8f7eeaefb5e7a99005c6c93b175">quadrature</a>;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a> - 1&gt; face_quadrature;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> old_solution;</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> current_solution;</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> predictor;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTrilinosWrappers_1_1SparseMatrix.html">TrilinosWrappers::SparseMatrix</a> system_matrix;</div>
<div class="line"> </div>
<div class="line">    Parameters::AllParameters&lt;dim&gt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>;</div>
<div class="line">    <a class="code" href="classConditionalOStream.html">ConditionalOStream</a>             verbose_cout;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <a class="code" href="classStep33_1_1ConservationLaw.html">ConservationLaw&lt;dim&gt;::ConservationLaw</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *input_filename)</div>
<div class="line">    : <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>()</div>
<div class="line">    , <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>(<a class="code" href="classFE__Q.html">FE_Q</a>&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;(1), EulerEquations&lt;<a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;::<a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a>)</div>
<div class="line">    , dof_handler(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>)</div>
<div class="line">    , <a class="code" href="update__flags__0_8txt.html#a5873b8f7eeaefb5e7a99005c6c93b175">quadrature</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="polynomial__space__0_8txt.html#a03a2f48682e29e39f7bccc11a7d1c4d1">degree</a> + 1)</div>
<div class="line">    , face_quadrature(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>.<a class="code" href="polynomial__space__0_8txt.html#a03a2f48682e29e39f7bccc11a7d1c4d1">degree</a> + 1)</div>
<div class="line">    , verbose_cout(std::cout, <a class="code" href="parsed__convergence__table__0_8txt.html#a2c7b85beed973f20ac73d33d8bbe8a57">false</a>)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classParameterHandler.html">ParameterHandler</a> prm;</div>
<div class="line">    <a class="code" href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">Parameters::AllParameters&lt;dim&gt;::declare_parameters</a>(prm);</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">parse_input</a>(input_filename);</div>
<div class="line">    <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.parse_parameters(prm);</div>
<div class="line"> </div>
<div class="line">    verbose_cout.set_condition(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.output ==</div>
<div class="line">                               Parameters::Solver::verbose);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep33_1_1ConservationLaw.html">ConservationLaw&lt;dim&gt;::setup_system</a>()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(), dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler, dsp);</div>
<div class="line"> </div>
<div class="line">    system_matrix.reinit(dsp);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep33_1_1ConservationLaw.html">ConservationLaw&lt;dim&gt;::assemble_system</a>()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> = dof_handler.<a class="code" href="classDoFHandler.html#ac1fedeb50b5f03b13d8b69f86e33f726">get_fe</a>().<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>();</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; dof_indices(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; dof_indices_neighbor(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> update_flags = <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> |</div>
<div class="line">                                     <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> |</div>
<div class="line">                                     <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>,</div>
<div class="line">                      face_update_flags =</div>
<div class="line">                        <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> |</div>
<div class="line">                        <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> | <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f">update_normal_vectors</a>,</div>
<div class="line">                      neighbor_face_update_flags = <a class="code" href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>        fe_v(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>, <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>, <a class="code" href="update__flags__0_8txt.html#a5873b8f7eeaefb5e7a99005c6c93b175">quadrature</a>, update_flags);</div>
<div class="line">    <a class="code" href="classFEFaceValues.html">FEFaceValues&lt;dim&gt;</a>    fe_v_face(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                                face_quadrature,</div>
<div class="line">                                face_update_flags);</div>
<div class="line">    <a class="code" href="classFESubfaceValues.html">FESubfaceValues&lt;dim&gt;</a> fe_v_subface(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                      <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                                      face_quadrature,</div>
<div class="line">                                      face_update_flags);</div>
<div class="line">    <a class="code" href="classFEFaceValues.html">FEFaceValues&lt;dim&gt;</a>    fe_v_face_neighbor(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                         <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                                         face_quadrature,</div>
<div class="line">                                         neighbor_face_update_flags);</div>
<div class="line">    <a class="code" href="classFESubfaceValues.html">FESubfaceValues&lt;dim&gt;</a> fe_v_subface_neighbor(<a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                               <a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>,</div>
<div class="line">                                               face_quadrature,</div>
<div class="line">                                               neighbor_face_update_flags);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">      {</div>
<div class="line">        fe_v.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>);</div>
<div class="line">        <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;get_dof_indices(dof_indices);</div>
<div class="line"> </div>
<div class="line">        assemble_cell_term(fe_v, dof_indices);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a> : <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;face_indices())</div>
<div class="line">          <span class="keywordflow">if</span> (<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;at_boundary(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>))</div>
<div class="line">            {</div>
<div class="line">              fe_v_face.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>);</div>
<div class="line">              assemble_face_term(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>,</div>
<div class="line">                                 fe_v_face,</div>
<div class="line">                                 fe_v_face,</div>
<div class="line">                                 dof_indices,</div>
<div class="line">                                 std::vector&lt;types::global_dof_index&gt;(),</div>
<div class="line">                                 <span class="keyword">true</span>,</div>
<div class="line">                                 <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;face(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;boundary_id(),</div>
<div class="line">                                 <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;face(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;diameter());</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">              <span class="keywordflow">if</span> (<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;neighbor(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;has_children())</div>
<div class="line">                {</div>
<div class="line">                  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> neighbor2 =</div>
<div class="line">                    <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;neighbor_of_neighbor(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>);</div>
<div class="line"> </div>
<div class="line">                  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> subface_no = 0;</div>
<div class="line">                       subface_no &lt; <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;face(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;n_children();</div>
<div class="line">                       ++subface_no)</div>
<div class="line">                    {</div>
<div class="line">                      <span class="keyword">const</span> <span class="keyword">typename</span> DoFHandler&lt;dim&gt;::active_cell_iterator</div>
<div class="line">                        neighbor_child =</div>
<div class="line">                          <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;neighbor_child_on_subface(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>, subface_no);</div>
<div class="line"> </div>
<div class="line">                      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(neighbor_child-&gt;face(neighbor2) ==</div>
<div class="line">                               <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;face(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;child(subface_no),</div>
<div class="line">                             <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">                      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(neighbor_child-&gt;is_active(), <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">                      fe_v_subface.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>, subface_no);</div>
<div class="line">                      fe_v_face_neighbor.reinit(neighbor_child, neighbor2);</div>
<div class="line"> </div>
<div class="line">                      neighbor_child-&gt;get_dof_indices(dof_indices_neighbor);</div>
<div class="line"> </div>
<div class="line">                      assemble_face_term(</div>
<div class="line">                        <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>,</div>
<div class="line">                        fe_v_subface,</div>
<div class="line">                        fe_v_face_neighbor,</div>
<div class="line">                        dof_indices,</div>
<div class="line">                        dof_indices_neighbor,</div>
<div class="line">                        <span class="keyword">false</span>,</div>
<div class="line">                        <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>,</div>
<div class="line">                        neighbor_child-&gt;face(neighbor2)-&gt;diameter());</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;neighbor(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;level() != <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;level())</div>
<div class="line">                {</div>
<div class="line">                  <span class="keyword">const</span> <span class="keyword">typename</span> DoFHandler&lt;dim&gt;::cell_iterator <a class="code" href="fe_2fe__0_8txt.html#ad1bbe5407fe459d8e4e71ba7ed9f7428">neighbor</a> =</div>
<div class="line">                    <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;neighbor(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>);</div>
<div class="line">                  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="fe_2fe__0_8txt.html#ad1bbe5407fe459d8e4e71ba7ed9f7428">neighbor</a>-&gt;level() == <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;level() - 1,</div>
<div class="line">                         <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">                  <a class="code" href="fe_2fe__0_8txt.html#ad1bbe5407fe459d8e4e71ba7ed9f7428">neighbor</a>-&gt;get_dof_indices(dof_indices_neighbor);</div>
<div class="line"> </div>
<div class="line">                  <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; faceno_subfaceno =</div>
<div class="line">                    <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;neighbor_of_coarser_neighbor(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>);</div>
<div class="line">                  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> neighbor_face_no = faceno_subfaceno.first,</div>
<div class="line">                                     neighbor_subface_no =</div>
<div class="line">                                       faceno_subfaceno.second;</div>
<div class="line"> </div>
<div class="line">                  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="fe_2fe__0_8txt.html#ad1bbe5407fe459d8e4e71ba7ed9f7428">neighbor</a>-&gt;neighbor_child_on_subface(</div>
<div class="line">                           neighbor_face_no, neighbor_subface_no) == <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>,</div>
<div class="line">                         <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">                  fe_v_face.reinit(<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>, <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>);</div>
<div class="line">                  fe_v_subface_neighbor.reinit(<a class="code" href="fe_2fe__0_8txt.html#ad1bbe5407fe459d8e4e71ba7ed9f7428">neighbor</a>,</div>
<div class="line">                                               neighbor_face_no,</div>
<div class="line">                                               neighbor_subface_no);</div>
<div class="line"> </div>
<div class="line">                  assemble_face_term(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>,</div>
<div class="line">                                     fe_v_face,</div>
<div class="line">                                     fe_v_subface_neighbor,</div>
<div class="line">                                     dof_indices,</div>
<div class="line">                                     dof_indices_neighbor,</div>
<div class="line">                                     <span class="keyword">false</span>,</div>
<div class="line">                                     <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>,</div>
<div class="line">                                     <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;face(<a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>)-&gt;diameter());</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep33_1_1ConservationLaw.html">ConservationLaw&lt;dim&gt;::assemble_cell_term</a>(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> &amp;                       fe_v,</div>
<div class="line">    <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dof_indices)</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> = fe_v.dofs_per_cell;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>    = fe_v.n_quadrature_points;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;2, Sacado::Fad::DFad&lt;double&gt;</a>&gt; W(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>,</div>
<div class="line">                                          <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;2, double&gt;</a> W_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;3, Sacado::Fad::DFad&lt;double&gt;</a>&gt; grad_W(</div>
<div class="line">      <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>, <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;3, double&gt;</a> grad_W_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>,</div>
<div class="line">                                <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>,</div>
<div class="line">                                <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;double&gt; residual_derivatives(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;Sacado::Fad::DFad&lt;double&gt;&gt; independent_local_dof_values(</div>
<div class="line">      <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">      independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] = current_solution(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">      independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>].diff(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a> = 0; <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">c &lt; EulerEquations&lt;dim&gt;::n_components</a>; ++<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>)</div>
<div class="line">        {</div>
<div class="line">          W[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>]     = 0;</div>
<div class="line">          W_old[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] = 0;</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>)</div>
<div class="line">            {</div>
<div class="line">              grad_W[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>]     = 0;</div>
<div class="line">              grad_W_old[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] = 0;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a> =</div>
<div class="line">            fe_v.get_fe().system_to_component_index(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>).first;</div>
<div class="line"> </div>
<div class="line">          W[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] += independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] *</div>
<div class="line">                     fe_v.shape_value_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>);</div>
<div class="line">          W_old[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>] +=</div>
<div class="line">            old_solution(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) * fe_v.shape_value_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>);</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>++)</div>
<div class="line">            {</div>
<div class="line">              grad_W[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] += independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] *</div>
<div class="line">                                 fe_v.shape_grad_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>)[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line">              grad_W_old[q][<a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] += old_solution(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) *</div>
<div class="line">                                     fe_v.shape_grad_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, <a class="code" href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a>)[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>];</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    std::vector&lt;ndarray&lt;Sacado::Fad::DFad&lt;double&gt;,</div>
<div class="line">                        <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>,</div>
<div class="line">                        <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;&gt;</div>
<div class="line">      <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">std::vector&lt;ndarray&lt;double, EulerEquations&lt;dim&gt;::n_components</a>, <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>&gt;&gt;</div>
<div class="line">      flux_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;</div>
<div class="line">      std::array&lt;Sacado::Fad::DFad&lt;double&gt;, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>&gt;&gt;</div>
<div class="line">      forcing(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">std::vector&lt;std::array&lt;double, EulerEquations&lt;dim&gt;::n_components</a>&gt;&gt;</div>
<div class="line">      forcing_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q)</div>
<div class="line">      {</div>
<div class="line">        EulerEquations&lt;dim&gt;::compute_flux_matrix(W_old[q], flux_old[q]);</div>
<div class="line">        EulerEquations&lt;dim&gt;::compute_forcing_vector(W_old[q], forcing_old[q]);</div>
<div class="line">        EulerEquations&lt;dim&gt;::compute_flux_matrix(W[q], <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>[q]);</div>
<div class="line">        EulerEquations&lt;dim&gt;::compute_forcing_vector(W[q], forcing[q]);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; fe_v.dofs_per_cell; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">      {</div>
<div class="line">        Sacado::Fad::DFad&lt;double&gt; R_i = 0;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">          fe_v.get_fe().system_to_component_index(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>).first;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a> = 0; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a> &lt; fe_v.n_quadrature_points; ++<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>)</div>
<div class="line">          {</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.is_stationary == <span class="keyword">false</span>)</div>
<div class="line">              R_i += 1.0 / <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.time_step *</div>
<div class="line">                     (W[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i] - W_old[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i]) *</div>
<div class="line">                     fe_v.shape_value_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>, component_i) *</div>
<div class="line">                     fe_v.JxW(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>++)</div>
<div class="line">              R_i -=</div>
<div class="line">                (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta * <a class="code" href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a>[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] +</div>
<div class="line">                 (1.0 - <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta) * flux_old[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>]) *</div>
<div class="line">                fe_v.shape_grad_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>, component_i)[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] *</div>
<div class="line">                fe_v.JxW(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a> &lt; <a class="code" href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a>; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>++)</div>
<div class="line">              R_i +=</div>
<div class="line">                1.0 *</div>
<div class="line">                std::pow(fe_v.get_cell()-&gt;diameter(),</div>
<div class="line">                         <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.diffusion_power) *</div>
<div class="line">                (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta * grad_W[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] +</div>
<div class="line">                 (1.0 - <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta) * grad_W_old[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>]) *</div>
<div class="line">                fe_v.shape_grad_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>, component_i)[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">d</a>] *</div>
<div class="line">                fe_v.JxW(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>);</div>
<div class="line"> </div>
<div class="line">            R_i -=</div>
<div class="line">              (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta * forcing[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i] +</div>
<div class="line">               (1.0 - <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta) * forcing_old[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i]) *</div>
<div class="line">              fe_v.shape_value_component(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>, component_i) *</div>
<div class="line">              fe_v.JxW(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a> = 0; <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>)</div>
<div class="line">          residual_derivatives[<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>] = R_i.fastAccessDx(<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>);</div>
<div class="line">        system_matrix.add(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>], dof_indices, residual_derivatives);</div>
<div class="line">        <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) -= R_i.val();</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep33_1_1ConservationLaw.html">ConservationLaw&lt;dim&gt;::assemble_face_term</a>(</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                          <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFEFaceValuesBase.html">FEFaceValuesBase&lt;dim&gt;</a> &amp;               fe_v,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFEFaceValuesBase.html">FEFaceValuesBase&lt;dim&gt;</a> &amp;               fe_v_neighbor,</div>
<div class="line">    <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dof_indices,</div>
<div class="line">    <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dof_indices_neighbor,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span>                                  external_face,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                          <a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>                                face_diameter)</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>    = fe_v.<a class="code" href="classFEValuesBase.html#a807c3049bfe81743fc0f237dfc2fbdea">n_quadrature_points</a>;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> = fe_v.<a class="code" href="classFEValuesBase.html#a5b264d5b2fb6615f5dea7a21135ed1a5">dofs_per_cell</a>;</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;Sacado::Fad::DFad&lt;double&gt;&gt; independent_local_dof_values(</div>
<div class="line">      <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>),</div>
<div class="line">      independent_neighbor_dof_values(external_face == <span class="keyword">false</span> ? <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> :</div>
<div class="line">                                                               0);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_independent_variables =</div>
<div class="line">      (external_face == <span class="keyword">false</span> ? 2 * <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> : <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>++)</div>
<div class="line">      {</div>
<div class="line">        independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] = current_solution(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]);</div>
<div class="line">        independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>].diff(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, n_independent_variables);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (external_face == <span class="keyword">false</span>)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>++)</div>
<div class="line">        {</div>
<div class="line">          independent_neighbor_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] =</div>
<div class="line">            current_solution(dof_indices_neighbor[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]);</div>
<div class="line">          independent_neighbor_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>].diff(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> + <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>,</div>
<div class="line">                                                  n_independent_variables);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;2, Sacado::Fad::DFad&lt;double&gt;</a>&gt; Wplus(</div>
<div class="line">      <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>),</div>
<div class="line">      Wminus(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>);</div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;2, double&gt;</a> Wplus_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>),</div>
<div class="line">      Wminus_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">            fe_v.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#a86644fe67824373cd51e9ff7fca94f8c">system_to_component_index</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>).first;</div>
<div class="line">          Wplus[q][component_i] +=</div>
<div class="line">            independent_local_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] *</div>
<div class="line">            fe_v.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, component_i);</div>
<div class="line">          Wplus_old[q][component_i] +=</div>
<div class="line">            old_solution(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) *</div>
<div class="line">            fe_v.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, component_i);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (external_face == <span class="keyword">false</span>)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q)</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">                fe_v_neighbor.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#a86644fe67824373cd51e9ff7fca94f8c">system_to_component_index</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>).first;</div>
<div class="line">              Wminus[q][component_i] +=</div>
<div class="line">                independent_neighbor_dof_values[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>] *</div>
<div class="line">                fe_v_neighbor.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, component_i);</div>
<div class="line">              Wminus_old[q][component_i] +=</div>
<div class="line">                old_solution(dof_indices_neighbor[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) *</div>
<div class="line">                fe_v_neighbor.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, q, component_i);</div>
<div class="line">            }</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a> &lt; Parameters::AllParameters&lt;dim&gt;::max_n_boundaries,</div>
<div class="line">               <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>,</div>
<div class="line">                             0,</div>
<div class="line">                             Parameters::AllParameters&lt;dim&gt;::max_n_boundaries));</div>
<div class="line"> </div>
<div class="line">        std::vector&lt;Vector&lt;double&gt;&gt; boundary_values(</div>
<div class="line">          <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>(<a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>));</div>
<div class="line">        <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].values.vector_value_list(</div>
<div class="line">          fe_v.<a class="code" href="classFEValuesBase.html#ae41b67cfd48e02f6035e39c84f0fb47a">get_quadrature_points</a>(), boundary_values);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; q++)</div>
<div class="line">          {</div>
<div class="line">            EulerEquations&lt;dim&gt;::compute_Wminus(</div>
<div class="line">              <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].kind,</div>
<div class="line">              fe_v.<a class="code" href="classFEValuesBase.html#ac25ec6835799c3b6c7c842f8acb05eb3">normal_vector</a>(q),</div>
<div class="line">              Wplus[q],</div>
<div class="line">              boundary_values[q],</div>
<div class="line">              Wminus[q]);</div>
<div class="line">            EulerEquations&lt;dim&gt;::compute_Wminus(</div>
<div class="line">              <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.boundary_conditions[<a class="code" href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">boundary_id</a>].kind,</div>
<div class="line">              fe_v.<a class="code" href="classFEValuesBase.html#ac25ec6835799c3b6c7c842f8acb05eb3">normal_vector</a>(q),</div>
<div class="line">              Wplus_old[q],</div>
<div class="line">              boundary_values[q],</div>
<div class="line">              Wminus_old[q]);</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">std::vector</a>&lt;</div>
<div class="line">      std::array&lt;Sacado::Fad::DFad&lt;double&gt;, <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">EulerEquations&lt;dim&gt;::n_components</a>&gt;&gt;</div>
<div class="line">      normal_fluxes(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line">    <a class="code" href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">std::vector&lt;std::array&lt;double, EulerEquations&lt;dim&gt;::n_components</a>&gt;&gt;</div>
<div class="line">      normal_fluxes_old(<a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.stabilization_kind)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="fe__dgp__nonparametric__0_8txt.html#a8290746300287635d0fe47e4071ea1ef">Parameters::Flux::constant</a>:</div>
<div class="line">          <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a> = <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.stabilization_value;</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> Parameters::Flux::mesh_dependent:</div>
<div class="line">          <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a> = face_diameter / (2.0 * <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.time_step);</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">          <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a> = 1;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++q)</div>
<div class="line">      {</div>
<div class="line">        EulerEquations&lt;dim&gt;::numerical_normal_flux(</div>
<div class="line">          fe_v.<a class="code" href="classFEValuesBase.html#ac25ec6835799c3b6c7c842f8acb05eb3">normal_vector</a>(q), Wplus[q], Wminus[q], <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>, normal_fluxes[q]);</div>
<div class="line">        EulerEquations&lt;dim&gt;::numerical_normal_flux(fe_v.<a class="code" href="classFEValuesBase.html#ac25ec6835799c3b6c7c842f8acb05eb3">normal_vector</a>(q),</div>
<div class="line">                                                   Wplus_old[q],</div>
<div class="line">                                                   Wminus_old[q],</div>
<div class="line">                                                   <a class="code" href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">alpha</a>,</div>
<div class="line">                                                   normal_fluxes_old[q]);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;double&gt; residual_derivatives(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; fe_v.<a class="code" href="classFEValuesBase.html#a5b264d5b2fb6615f5dea7a21135ed1a5">dofs_per_cell</a>; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">      <span class="keywordflow">if</span> (fe_v.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#ab275cbead21bb11b1208222b6d662357">has_support_on_face</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a>) == <span class="keyword">true</span>)</div>
<div class="line">        {</div>
<div class="line">          Sacado::Fad::DFad&lt;double&gt; R_i = 0;</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a> = 0; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a> &lt; <a class="code" href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a>; ++<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>)</div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">                fe_v.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#a86644fe67824373cd51e9ff7fca94f8c">system_to_component_index</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>).first;</div>
<div class="line"> </div>
<div class="line">              R_i += (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta * normal_fluxes[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i] +</div>
<div class="line">                      (1.0 - <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.theta) *</div>
<div class="line">                        normal_fluxes_old[<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>][component_i]) *</div>
<div class="line">                     fe_v.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>, component_i) *</div>
<div class="line">                     fe_v.<a class="code" href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">JxW</a>(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a>);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a> = 0; <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>)</div>
<div class="line">            residual_derivatives[<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>] = R_i.fastAccessDx(<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>);</div>
<div class="line">          system_matrix.add(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>], dof_indices, residual_derivatives);</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">if</span> (external_face == <span class="keyword">false</span>)</div>
<div class="line">            {</div>
<div class="line">              <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a> = 0; <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a> &lt; <a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a>; ++<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>)</div>
<div class="line">                residual_derivatives[<a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>] = R_i.fastAccessDx(<a class="code" href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a> + <a class="code" href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a>);</div>
<div class="line">              system_matrix.add(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>],</div>
<div class="line">                                dof_indices_neighbor,</div>
<div class="line">                                residual_derivatives);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>(dof_indices[<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>]) -= R_i.val();</div>
<div class="line">        }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  std::pair&lt;unsigned int, double&gt;</div>
<div class="line">  <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">ConservationLaw&lt;dim&gt;::solve</a>(<a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;newton_update)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">switch</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.solver)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">case</span> Parameters::Solver::direct:</div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="classSolverControl.html">SolverControl</a>                                  solver_control(1, 0);</div>
<div class="line">            <a class="code" href="structTrilinosWrappers_1_1SolverDirect_1_1AdditionalData.html">TrilinosWrappers::SolverDirect::AdditionalData</a> <a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>(</div>
<div class="line">              <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.output == Parameters::Solver::verbose);</div>
<div class="line">            <a class="code" href="classTrilinosWrappers_1_1SolverDirect.html">TrilinosWrappers::SolverDirect</a> direct(solver_control, <a class="code" href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a>);</div>
<div class="line"> </div>
<div class="line">            direct.solve(system_matrix, newton_update, <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">return</span> {solver_control.last_step(), solver_control.last_value()};</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> Parameters::Solver::gmres:</div>
<div class="line">          {</div>
<div class="line">            Epetra_Vector <a class="code" href="vector__valued__0_8txt.html#a2b24e414d1a0d32deea919c5e8899811">x</a>(<a class="code" href="namespaceFEValuesViews.html#af2099b26234f5816729f7f6dc523dc0f">View</a>,</div>
<div class="line">                            system_matrix.trilinos_matrix().DomainMap(),</div>
<div class="line">                            newton_update.<a class="code" href="classVector.html#af34b888fe493ef2ed188179de69ad7ed">begin</a>());</div>
<div class="line">            Epetra_Vector <a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a>(<a class="code" href="namespaceFEValuesViews.html#af2099b26234f5816729f7f6dc523dc0f">View</a>,</div>
<div class="line">                            system_matrix.trilinos_matrix().RangeMap(),</div>
<div class="line">                            <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>.begin());</div>
<div class="line"> </div>
<div class="line">            AztecOO <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>;</div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecOption(</div>
<div class="line">              AZ_output,</div>
<div class="line">              (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.output == Parameters::Solver::quiet ? AZ_none :</div>
<div class="line">                                                                AZ_all));</div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecOption(AZ_solver, AZ_gmres);</div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetRHS(&amp;<a class="code" href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a>);</div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetLHS(&amp;<a class="code" href="vector__valued__0_8txt.html#a2b24e414d1a0d32deea919c5e8899811">x</a>);</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecOption(AZ_precond, AZ_dom_decomp);</div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecOption(AZ_subdomain_solve, AZ_ilut);</div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecOption(AZ_overlap, 0);</div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecOption(AZ_reorder, 0);</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecParam(AZ_drop, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.ilut_drop);</div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecParam(AZ_ilut_fill, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.ilut_fill);</div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecParam(AZ_athresh, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.ilut_atol);</div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetAztecParam(AZ_rthresh, <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.ilut_rtol);</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.SetUserMatrix(</div>
<div class="line">              <span class="keyword">const_cast&lt;</span>Epetra_CrsMatrix *<span class="keyword">&gt;</span>(&amp;system_matrix.trilinos_matrix()));</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.Iterate(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.max_iterations,</div>
<div class="line">                           <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.linear_residual);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">return</span> {<a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.NumIters(), <a class="code" href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a>.TrueResidual()};</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">    <span class="keywordflow">return</span> {0, 0};</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep33_1_1ConservationLaw.html">ConservationLaw&lt;dim&gt;::compute_refinement_indicators</a>(</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;refinement_indicators)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    EulerEquations&lt;dim&gt;::compute_refinement_indicators(dof_handler,</div>
<div class="line">                                                       <a class="code" href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a>,</div>
<div class="line">                                                       predictor,</div>
<div class="line">                                                       refinement_indicators);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span></div>
<div class="line">  <a class="code" href="classStep33_1_1ConservationLaw.html">ConservationLaw&lt;dim&gt;::refine_grid</a>(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;refinement_indicators)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a> : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell_no = <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;active_cell_index();</div>
<div class="line">        <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;clear_coarsen_flag();</div>
<div class="line">        <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;clear_refine_flag();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> ((<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;level() &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.shock_levels) &amp;&amp;</div>
<div class="line">            (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(refinement_indicators(cell_no)) &gt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.shock_val))</div>
<div class="line">          <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;set_refine_flag();</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;level() &gt; 0) &amp;&amp;</div>
<div class="line">                 (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(refinement_indicators(cell_no)) &lt;</div>
<div class="line">                  0.75 * <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.shock_val))</div>
<div class="line">          <a class="code" href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a>-&gt;set_coarsen_flag();</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;Vector&lt;double&gt;&gt; transfer_in;</div>
<div class="line">    std::vector&lt;Vector&lt;double&gt;&gt; transfer_out;</div>
<div class="line"> </div>
<div class="line">    transfer_in.push_back(old_solution);</div>
<div class="line">    transfer_in.push_back(predictor);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.prepare_coarsening_and_refinement();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSolutionTransfer.html">SolutionTransfer&lt;dim&gt;</a> soltrans(dof_handler);</div>
<div class="line">    soltrans.prepare_for_coarsening_and_refinement(transfer_in);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.execute_coarsening_and_refinement();</div>
<div class="line"> </div>
<div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#ad316958f8045d9a48094335b23a03a53">clear</a>();</div>
<div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classVector.html">Vector&lt;double&gt;</a> new_old_solution(1);</div>
<div class="line">      <a class="code" href="classVector.html">Vector&lt;double&gt;</a> new_predictor(1);</div>
<div class="line"> </div>
<div class="line">      transfer_out.push_back(new_old_solution);</div>
<div class="line">      transfer_out.push_back(new_predictor);</div>
<div class="line">      transfer_out[0].reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">      transfer_out[1].reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    soltrans.interpolate(transfer_in, transfer_out);</div>
<div class="line"> </div>
<div class="line">    old_solution.reinit(transfer_out[0].<a class="code" href="function__0_8txt.html#a4f780342f2d5d632f82cf7fd90158a66">size</a>());</div>
<div class="line">    old_solution = transfer_out[0];</div>
<div class="line"> </div>
<div class="line">    predictor.reinit(transfer_out[1].<a class="code" href="function__0_8txt.html#a4f780342f2d5d632f82cf7fd90158a66">size</a>());</div>
<div class="line">    predictor = transfer_out[1];</div>
<div class="line"> </div>
<div class="line">    current_solution.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    current_solution = old_solution;</div>
<div class="line">    <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="classStep33_1_1ConservationLaw.html">ConservationLaw&lt;dim&gt;::output_results</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keyword">typename</span> EulerEquations&lt;dim&gt;::Postprocessor <a class="code" href="data__postprocessor__0_8txt.html#a80e53cb52e5dbb182dd14ee528927a77">postprocessor</a>(</div>
<div class="line">      <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.schlieren_plot);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">attach_dof_handler</a>(dof_handler);</div>
<div class="line"> </div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(current_solution,</div>
<div class="line">                             EulerEquations&lt;dim&gt;::component_names(),</div>
<div class="line">                             <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;::type_dof_data</a>,</div>
<div class="line">                             EulerEquations&lt;dim&gt;::component_interpretation());</div>
<div class="line"> </div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(current_solution, <a class="code" href="data__postprocessor__0_8txt.html#a80e53cb52e5dbb182dd14ee528927a77">postprocessor</a>);</div>
<div class="line"> </div>
<div class="line">    data_out.<a class="code" href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">build_patches</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> output_file_number = 0;</div>
<div class="line">    std::string         filename =</div>
<div class="line">      <span class="stringliteral">&quot;solution-&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(output_file_number, 3) + <span class="stringliteral">&quot;.vtk&quot;</span>;</div>
<div class="line">    std::ofstream <a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>(filename);</div>
<div class="line">    data_out.<a class="code" href="classDataOutInterface.html#acad99726038e4fca7f605fdffb3317e4">write_vtk</a>(<a class="code" href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a>);</div>
<div class="line"> </div>
<div class="line">    ++output_file_number;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">ConservationLaw&lt;dim&gt;::run</a>()</div>
<div class="line">  {</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classGridIn.html">GridIn&lt;dim&gt;</a> grid_in;</div>
<div class="line">      grid_in.<a class="code" href="classGridIn.html#a82ac1c03b0efe87204ad45d2f1d87f7e">attach_triangulation</a>(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>);</div>
<div class="line"> </div>
<div class="line">      std::ifstream input_file(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.mesh_filename);</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(input_file, <a class="code" href="group__Exceptions.html#ga4c22c86ff89575667de2ca9778aa28e5">ExcFileNotOpen</a>(<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.mesh_filename.c_str()));</div>
<div class="line"> </div>
<div class="line">      grid_in.<a class="code" href="classGridIn.html#abbb16aa0aa53bfa9231b69278d397616">read_ucd</a>(input_file);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#ad316958f8045d9a48094335b23a03a53">clear</a>();</div>
<div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(<a class="code" href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a>);</div>
<div class="line"> </div>
<div class="line">    old_solution.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    current_solution.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    predictor.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line"> </div>
<div class="line">    setup_system();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#a761f008bdeb7d94a69205ae824deefad">VectorTools::interpolate</a>(dof_handler,</div>
<div class="line">                             <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.initial_conditions,</div>
<div class="line">                             old_solution);</div>
<div class="line">    current_solution = old_solution;</div>
<div class="line">    predictor        = old_solution;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.do_refine == <span class="keyword">true</span>)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> = 0; <a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.shock_levels; ++<a class="code" href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a>)</div>
<div class="line">        {</div>
<div class="line">          <a class="code" href="classVector.html">Vector&lt;double&gt;</a> refinement_indicators(<a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells());</div>
<div class="line"> </div>
<div class="line">          compute_refinement_indicators(refinement_indicators);</div>
<div class="line">          refine_grid(refinement_indicators);</div>
<div class="line"> </div>
<div class="line">          setup_system();</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="namespaceVectorTools.html#a761f008bdeb7d94a69205ae824deefad">VectorTools::interpolate</a>(dof_handler,</div>
<div class="line">                                   <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.initial_conditions,</div>
<div class="line">                                   old_solution);</div>
<div class="line">          current_solution = old_solution;</div>
<div class="line">          predictor        = old_solution;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">    output_results();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> newton_update(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a>        = 0;</div>
<div class="line">    <span class="keywordtype">double</span> next_output = <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a> + <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.output_step;</div>
<div class="line"> </div>
<div class="line">    predictor = old_solution;</div>
<div class="line">    <span class="keywordflow">while</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a> &lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.final_time)</div>
<div class="line">      {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;T=&quot;</span> &lt;&lt; <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a> &lt;&lt; std::endl</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;   Number of active cells:       &quot;</span></div>
<div class="line">                  &lt;&lt; <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells() &lt;&lt; std::endl</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;   Number of degrees of freedom: &quot;</span> &lt;&lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>()</div>
<div class="line">                  &lt;&lt; std::endl</div>
<div class="line">                  &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;   NonLin Res     Lin Iter       Lin Res&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;   _____________________________________&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nonlin_iter = 0;</div>
<div class="line">        current_solution         = predictor;</div>
<div class="line">        <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line">          {</div>
<div class="line">            system_matrix = 0;</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a> = 0;</div>
<div class="line">            assemble_system();</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> res_norm = <a class="code" href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">right_hand_side</a>.l2_norm();</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(res_norm) &lt; 1<a class="code" href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a>-10)</div>
<div class="line">              {</div>
<div class="line">                std::printf(<span class="stringliteral">&quot;   %-16.3e (converged)\n\n&quot;</span>, res_norm);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">              }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">              {</div>
<div class="line">                newton_update = 0;</div>
<div class="line"> </div>
<div class="line">                std::pair&lt;unsigned int, double&gt; <a class="code" href="solver__0_8txt.html#a06078ea1995fa54b715bee3b7745f08f">convergence</a> =</div>
<div class="line">                  <a class="code" href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a>(newton_update);</div>
<div class="line"> </div>
<div class="line">                current_solution += newton_update;</div>
<div class="line"> </div>
<div class="line">                std::printf(<span class="stringliteral">&quot;   %-16.3e %04d        %-5.2e\n&quot;</span>,</div>
<div class="line">                            res_norm,</div>
<div class="line">                            <a class="code" href="solver__0_8txt.html#a06078ea1995fa54b715bee3b7745f08f">convergence</a>.first,</div>
<div class="line">                            <a class="code" href="solver__0_8txt.html#a06078ea1995fa54b715bee3b7745f08f">convergence</a>.second);</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            ++nonlin_iter;</div>
<div class="line">            <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(nonlin_iter &lt;= 10,</div>
<div class="line">                        <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;No convergence in nonlinear solver&quot;</span>));</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a> += <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.time_step;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.output_step &lt; 0)</div>
<div class="line">          output_results();</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a> &gt;= next_output)</div>
<div class="line">          {</div>
<div class="line">            output_results();</div>
<div class="line">            next_output += <a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.output_step;</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        predictor = current_solution;</div>
<div class="line">        predictor.sadd(2.0, -1.0, old_solution);</div>
<div class="line"> </div>
<div class="line">        old_solution = current_solution;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a>.do_refine == <span class="keyword">true</span>)</div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="classVector.html">Vector&lt;double&gt;</a> refinement_indicators(</div>
<div class="line">              <a class="code" href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a>.n_active_cells());</div>
<div class="line">            compute_refinement_indicators(refinement_indicators);</div>
<div class="line"> </div>
<div class="line">            refine_grid(refinement_indicators);</div>
<div class="line">            setup_system();</div>
<div class="line"> </div>
<div class="line">            newton_update.<a class="code" href="classVector.html#ac4a4dbef7dd65ef8ad35ae56b57d7c05">reinit</a>(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Step33</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line">      <span class="keyword">using namespace </span><a class="code" href="namespaceStep33.html">Step33</a>;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (argc != 2)</div>
<div class="line">        {</div>
<div class="line">          std::cout &lt;&lt; <span class="stringliteral">&quot;Usage:&quot;</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">&quot; input_file&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">          std::exit(1);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classUtilities_1_1MPI_1_1MPI__InitFinalize.html">Utilities::MPI::MPI_InitFinalize</a> mpi_initialization(</div>
<div class="line">        argc, argv, ::<a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>);</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classStep33_1_1ConservationLaw.html">ConservationLaw&lt;2&gt;</a> cons(argv[1]);</div>
<div class="line">      cons.run();</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (<a class="code" href="parameter__handler__0_8txt.html#ad919e2b915d8e8226aef004c2d8399a8">std::exception</a> &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p> <br  />
 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="apolynomial__0_8txt_html_af1258c87f1d73d29bd17331843ac1d25"><div class="ttname"><a href="polynomial__0_8txt.html#af1258c87f1d73d29bd17331843ac1d25">i</a></div><div class="ttdeci">namespace in which classes relating to the description of d polynomial spaces are declared ***Base class for all D polynomials A polynomial is represented in this class by its coefficients which are set through the constructor or by derived classes There are two paths for evaluation of polynomials One is based on the coefficients which are evaluated through the Horner scheme which is a robust general purpose scheme An alternative and more stable evaluation of high degree polynomials with roots in the unit interval is provided by a product in terms of the roots This form is available for special polynomials such as Lagrange polynomials or Legendre polynomials and used with the respective constructor To obtain this more stable evaluation form the constructor with the roots in form of a Lagrange polynomial must be used In case a manipulation is done that changes the roots the representation is switched to the coefficient form This class is a typical example of a possible template argument for the TensorProductPolynomials class **Constructor The coefficients of the polynomial are passed as and denote the i e the first element of the array denotes the constant the second the linear and so on The degree of the polynomial represented by this object is thus the number of elements in the&lt; tt &gt; coefficient&lt;/tt &gt; array minus one **Constructor creating a zero polynomial of degree *[2.x.3] *Constructor for a Lagrange polynomial and its point of evaluation The idea is to where j is the evaluation point specified as argument and the support points contain all the evaluation is based on products of the whereas the Horner scheme is used for polynomials in the coefficient form **Return the values and the derivatives of the Polynomial at point&lt; tt &gt; x&lt;/tt &gt;&lt; tt &gt; i</div><div class="ttdef"><b>Definition:</b> <a href="polynomial__0_8txt_source.html#l00024">polynomial_0.txt:24</a></div></div>
<div class="ttc" id="aclassDataOut__DoFData_html_a79cbe2f02f8dfb85026c71d783dbb703"><div class="ttname"><a href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">DataOut_DoFData::add_data_vector</a></div><div class="ttdeci">void add_data_vector(const VectorType &amp;data, const std::vector&lt; std::string &gt; &amp;names, const DataVectorType type=type_automatic, const std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt; &amp;data_component_interpretation=std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt;())</div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__out__dof__data_8h_source.html#l01096">data_out_dof_data.h:1096</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a91cfbaca954f444047302446a4e87125"><div class="ttname"><a href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">ParameterHandler::get</a></div><div class="ttdeci">std::string get(const std::string &amp;entry_string) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00987">parameter_handler.cc:987</a></div></div>
<div class="ttc" id="anamespaceStep31_1_1EquationData_html_aa1e9e1a7297b10cb39c2065f86acc66f"><div class="ttname"><a href="namespaceStep31_1_1EquationData.html#aa1e9e1a7297b10cb39c2065f86acc66f">Step31::EquationData::density</a></div><div class="ttdeci">constexpr double density</div><div class="ttdef"><b>Definition:</b> <a href="step-31_8cc_source.html#l00075">step-31.cc:75</a></div></div>
<div class="ttc" id="aconstraints__0_8txt_html_a9c19e2f34c53e5e4662b0fa119e2c99d"><div class="ttname"><a href="constraints__0_8txt.html#a9c19e2f34c53e5e4662b0fa119e2c99d">flux</a></div><div class="ttdeci">******This module deals with constraints on degrees of freedom The central class to deal with constraints is the AffineConstraints class *Constraints typically come from several for one usually enforces them by requiring that degrees of freedom on the boundary have particular for example[2.x.3] if the boundary condition[2.x.4] requires that the finite element solution[2.x.5] at the location of degree of freedom has the value Such constraints are generated by those versions of the[2.x.6] function that take a AffineConstraints for example no normal flux</div><div class="ttdef"><b>Definition:</b> <a href="constraints__0_8txt_source.html#l00020">constraints_0.txt:20</a></div></div>
<div class="ttc" id="aclassDataPostprocessor_html"><div class="ttname"><a href="classDataPostprocessor.html">DataPostprocessor</a></div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__postprocessor_8h_source.html#l00477">data_postprocessor.h:477</a></div></div>
<div class="ttc" id="afe_2fe__values_8h_html"><div class="ttname"><a href="fe_2fe__values_8h.html">fe_values.h</a></div></div>
<div class="ttc" id="anamespaceVectorTools_html_a761f008bdeb7d94a69205ae824deefad"><div class="ttname"><a href="namespaceVectorTools.html#a761f008bdeb7d94a69205ae824deefad">VectorTools::interpolate</a></div><div class="ttdeci">void interpolate(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const Function&lt; spacedim, typename VectorType::value_type &gt; &amp;function, VectorType &amp;vec, const ComponentMask &amp;component_mask=ComponentMask())</div></div>
<div class="ttc" id="afe_2fe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20"><div class="ttname"><a href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a></div><div class="ttdeci">@ update_gradients</div><div class="ttdoc">Shape function gradients.</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__update__flags_8h_source.html#l00077">fe_update_flags.h:77</a></div></div>
<div class="ttc" id="aclassGridIn_html_abbb16aa0aa53bfa9231b69278d397616"><div class="ttname"><a href="classGridIn.html#abbb16aa0aa53bfa9231b69278d397616">GridIn::read_ucd</a></div><div class="ttdeci">void read_ucd(std::istream &amp;in, const bool apply_all_indicators_to_manifolds=false)</div><div class="ttdef"><b>Definition:</b> <a href="grid__in_8cc_source.html#l00874">grid_in.cc:874</a></div></div>
<div class="ttc" id="adistributed__0_8txt_html_afec1b694405cadb2d251275096ad3563"><div class="ttname"><a href="distributed__0_8txt.html#afec1b694405cadb2d251275096ad3563">output</a></div><div class="ttdeci">if we even only hold bytes per line in this sparsity we ll need GB for this object even if every single line is empty Of only million lines will be non for which we need MB plus whatever is necessary to store the actual column indices of nonzero entries Let s say we have a moderately complex problem with entries per for each of which we store the column index worth then we ll need bytes for each of the million lines that correspond to the degrees of freedom we for a total of GB And we ll need bytes for each of the million lines that we don t for a total of GB It is clear that this ratio doesn t become any better if we go to even higher numbers of processors *The solution to this problem is to really only use any memory at all for those parts of the linear system that we or need for some other reason For all other we must know that they but we can not set up any part of our data structure To this there exists a class called IndexSet that denotes a set of indices which we care for and for which we may have to allocate memory The data structures for sparsity patterns constraint matrices matrices and vector can be initialized with these IndexSet objects to really only care for those rows or entries that correspond to indices in the index set and not care about all others These objects will then ask how many indices exist in the set allocate memory for each one of and when you want to access data for global degree of freedom[2.x.28] you will be redirected to the result of calling[2.x.29] with index[2.x.30] instead Accessing data for elements[2.x.31] for which[2.x.32] is false will yield an error *The remaining question is how to identify the set of indices that correspond to degrees of freedom we need to worry about on each processor To this you can use the[2.x.33] function to get at all the indices a processor owns Note that this is a subset of the degrees of freedom that are defined on the locally owned one sometimes needs the set of all degrees of freedom on the locally owned subdomain as well as the adjacent ghost cells This information is provided by the[2.x.35] function ***A typical parallel application is dealing with two different kinds of parallel but there are of course different vector types that can each represent both ghosted vectors are typically used for data output</div><div class="ttdef"><b>Definition:</b> <a href="distributed__0_8txt_source.html#l00059">distributed_0.txt:59</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_aeaf3c7846747695b1f327677e3716ec5"><div class="ttname"><a href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">ParameterHandler::get_double</a></div><div class="ttdeci">double get_double(const std::string &amp;entry_name) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l01068">parameter_handler.cc:1068</a></div></div>
<div class="ttc" id="adistributed__0_8txt_html_ad207fe81a5be05e18534713c2677da7b"><div class="ttname"><a href="distributed__0_8txt.html#ad207fe81a5be05e18534713c2677da7b">dofs</a></div><div class="ttdeci">if we even only hold bytes per line in this sparsity we ll need GB for this object even if every single line is empty Of only million lines will be non for which we need MB plus whatever is necessary to store the actual column indices of nonzero entries Let s say we have a moderately complex problem with entries per for each of which we store the column index worth then we ll need bytes for each of the million lines that correspond to the degrees of freedom we for a total of GB And we ll need bytes for each of the million lines that we don t for a total of GB It is clear that this ratio doesn t become any better if we go to even higher numbers of processors *The solution to this problem is to really only use any memory at all for those parts of the linear system that we or need for some other reason For all other we must know that they but we can not set up any part of our data structure To this there exists a class called IndexSet that denotes a set of indices which we care for and for which we may have to allocate memory The data structures for sparsity patterns constraint matrices matrices and vector can be initialized with these IndexSet objects to really only care for those rows or entries that correspond to indices in the index set and not care about all others These objects will then ask how many indices exist in the set allocate memory for each one of and when you want to access data for global degree of freedom[2.x.28] you will be redirected to the result of calling[2.x.29] with index[2.x.30] instead Accessing data for elements[2.x.31] for which[2.x.32] is false will yield an error *The remaining question is how to identify the set of indices that correspond to degrees of freedom we need to worry about on each processor To this you can use the[2.x.33] function to get at all the indices a processor owns Note that this is a subset of the degrees of freedom that are defined on the locally owned one sometimes needs the set of all degrees of freedom on the locally owned subdomain as well as the adjacent ghost cells This information is provided by the[2.x.35] function ***A typical parallel application is dealing with two different kinds of parallel but there are of course different vector types that can each represent both ghosted vectors are typically used for data error input in integration This is because in these one typically needs access not only to[2.x.39] locally owned dofs but also to[2.x.40] locally active dofs and sometimes to[2.x.41] locally relevant dofs</div><div class="ttdef"><b>Definition:</b> <a href="distributed__0_8txt_source.html#l00059">distributed_0.txt:59</a></div></div>
<div class="ttc" id="aevent__0_8txt_html_a60053d8ff825674cfcc1321aba229cd7"><div class="ttname"><a href="event__0_8txt.html#a60053d8ff825674cfcc1321aba229cd7">true</a></div><div class="ttdeci">*Objects of this kind are used to notify interior applications of changes provoked by an outer loop They are handed to the application through[2.x.0] and it is up to the actual application how to handle them Event is organized as an extensible binary enumerator Every class can add its own events using here is how to retrieve it knowing the name generating a clear Event **Clear all flags **Set all flags **Add the flags of the other event **Clear the flags of the other event **Test whether all the flags set in the other Event are also set in this one **Return&lt; tt &gt; true&lt;/tt &gt; if any event is set **List the flags to a stream **List all assigned events actions have to be taken by all means if this value is true</div><div class="ttdef"><b>Definition:</b> <a href="event__0_8txt_source.html#l00028">event_0.txt:28</a></div></div>
<div class="ttc" id="afe_2fe__0_8txt_html_ad1bbe5407fe459d8e4e71ba7ed9f7428"><div class="ttname"><a href="fe_2fe__0_8txt.html#ad1bbe5407fe459d8e4e71ba7ed9f7428">neighbor</a></div><div class="ttdeci">it is possible that some of them are in turn constrained leading to longer chains of constraints that the AffineConstraints class will eventually have to sort this is of no concern for the FiniteElement and derived classes since they only act locally on one cell and its immediate neighbor</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__0_8txt_source.html#l00123">fe_0.txt:123</a></div></div>
<div class="ttc" id="aA-headers_2exceptions__0_8txt_html_a8fba07b9a84b89e6be225f5f95c3e355"><div class="ttname"><a href="A-headers_2exceptions__0_8txt.html#a8fba07b9a84b89e6be225f5f95c3e355">run</a></div><div class="ttdeci">the program is just and one can not intelligently work around that *It is sometimes useful to change the behavior of the[2.x.6] macro from aborting a program to throwing exceptions On the other exceptions are not allowed to propagate out of destructors of classes For this there is a variant of the called[2.x.7] that can be used in destructors These use cases are discussed further down below on this page **Dynamic such as whether an output file can be written to *These are things that shouldn t be checked because it is not guaranteed that a program for which the condition is satisfied in a debug mode run</div><div class="ttdef"><b>Definition:</b> <a href="A-headers_2exceptions__0_8txt_source.html#l00022">exceptions_0.txt:22</a></div></div>
<div class="ttc" id="astructDataPostprocessorInputs_1_1Vector_html_a904b46a59d224ec214e4816e584cba5f"><div class="ttname"><a href="structDataPostprocessorInputs_1_1Vector.html#a904b46a59d224ec214e4816e584cba5f">DataPostprocessorInputs::Vector::solution_values</a></div><div class="ttdeci">std::vector&lt;::Vector&lt; double &gt; &gt; solution_values</div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__postprocessor_8h_source.html#l00330">data_postprocessor.h:330</a></div></div>
<div class="ttc" id="aclassFE__Q_html"><div class="ttname"><a href="classFE__Q.html">FE_Q</a></div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__q_8h_source.html#l00587">fe_q.h:587</a></div></div>
<div class="ttc" id="anamespaceUtilities_html_a6195c5f009ea8c7c536c6ffdf108c32f"><div class="ttname"><a href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a></div><div class="ttdeci">std::string int_to_string(const unsigned int value, const unsigned int digits=numbers::invalid_unsigned_int)</div><div class="ttdef"><b>Definition:</b> <a href="base_2utilities_8cc_source.html#l00473">utilities.cc:473</a></div></div>
<div class="ttc" id="aparsed__convergence__table__0_8txt_html_a2e990f30e4c3b71e80e78084f073ca9b"><div class="ttname"><a href="parsed__convergence__table__0_8txt.html#a2e990f30e4c3b71e80e78084f073ca9b">names</a></div><div class="ttdeci">****This class simplifies the construction of convergence tables reading the options for the generation of the table from a parameter file It provides a series of methods that can be used to compute the error given a reference exact solution or the difference between two numerical solutions or any other custom computation of the error given via[2.x.1] objects *An example usage of this class is given by ****The above code constructs a ParsedConvergenceTable that works for scalar and will produce an error table with and Linfty_norm norms of the error *Whenever a call to the methods the instance of this class inspects its parameters computes all norms specified by the parameter given at construction time possibly modified via a parameter file computes all extra column entries specified using the method and writes one row of the convergence table *Once you have finished with the a call to and to the the same code can be used to estimate the errors of mixed or multi physics e and one component for the pressure field and will produce an error table with H1 and L2 norm of the error in the velocity to write the table only to the file specified in the parameter file *By calling the method the following options will be defined in the given ParameterHandler and can be modified at run time through a parameter please cite ******Minimal constructor for ParsedConvergenceTable objects The number of components must match the number of components of the finite element space that is used to compute the errors If a component name is than it is interpreted as a vector and the errors of the repeated components are grouped together The size of the vector[2.x.3] must match the number of unique component names</div><div class="ttdef"><b>Definition:</b> <a href="parsed__convergence__table__0_8txt_source.html#l00035">parsed_convergence_table_0.txt:35</a></div></div>
<div class="ttc" id="aconvergence__table__0_8txt_html_a37c53a384d86a02751b04a0a89820c55"><div class="ttname"><a href="convergence__table__0_8txt.html#a37c53a384d86a02751b04a0a89820c55">fill</a></div><div class="ttdeci">*The ConvergenceTable class is an application to the TableHandler class and stores some convergence data such as residuals of the cg method or some evaluated[1.x.0] errors of discrete and evaluates convergence rates or orders *The already implemented *For the number of cells may be added to the table by calling n_dofs Of one can also add more kinds of information by calling before the output of the table the functions it switches off the auto fill mode of the TableHandler base class If you intend to add further data with auto fill</div><div class="ttdef"><b>Definition:</b> <a href="convergence__table__0_8txt_source.html#l00025">convergence_table_0.txt:25</a></div></div>
<div class="ttc" id="anamespacedealii_html"><div class="ttname"><a href="namespacedealii.html">dealii</a></div><div class="ttdef"><b>Definition:</b> <a href="doc_2doxygen_2headers_2namespace__dealii_8h_source.html#l00026">namespace_dealii.h:26</a></div></div>
<div class="ttc" id="amatrix__free_2dof__info__0_8txt_html_afc846d40941f6f9934e92e469096f30f"><div class="ttname"><a href="matrix__free_2dof__info__0_8txt.html#afc846d40941f6f9934e92e469096f30f">n_components</a></div><div class="ttdeci">We set the granularity to **that is a number sufficiently large to minimize loop peel overhead within the this function always returns index If an index is not found in hp it returns *[2.x.2] *Populate the vector[2.x.3] with locally owned degrees of freedom stored on the cell block[2.x.4] If[2.x.5] is then the returned vector will contain indices required to resolve constraints The image below illustrates the output of this function for cell blocks zero and one with zero Dirichlet boundary conditions at the bottom of the domain Note that due to the presence of the DoFs returned by this function for the case i indices that are located on another get a temporary number by this and will later be assigned the correct index after all the ghost indices have been collected by the call to *[2.x.12] *This method assigns the correct indices to ghost indices from the temporary numbering employed by the[2.x.13] function The numbers are localized with respect to the MPI and ghosts start at the end of the locally owned range This we get direct access to all vector entries **This method reorders the way cells are gone through based on a given renumbering of the cells It also takes[2.x.14] cells together and interprets them as one cell as is needed for vectorization **Finds possible compression for the cell indices that we can apply for increased efficiency Run at the end of reorder_cells **Finds possible compression for the face indices that we can apply for increased efficiency Run at the end of reorder_cells **This function computes the connectivity of the currently stored indices in terms of connections between the individual cells and fills the structure into a sparsity pattern **In case face integrals are find out whether certain loops over the unknowns only access a subset of all the ghost dofs we keep in the main partitioner **Given[2.x.15] containing the index of cells of macro the index ordering can be improved for typical DG elements by interleaving the degrees of freedom from batches of which avoids the data transposition in[2.x.16] these more advanced features are not so there is only limited value of this function **Fills the array that defines how to zero selected ranges in the result vector within the cell filling the two member variables[2.x.17] vector_zero_range_list_index and[2.x.18] The intent of this pattern is to zero the vector entries in close temporal proximity to the first access and thus keeping the vector entries in cache **Return the memory consumption in bytes of this class **Prints a detailed summary of memory consumption in the different structures of this class to the given output stream **Prints a representation of the indices in the class to the given output stream **Enum for various storage variants of the indices This storage format is used to implement more efficient indexing schemes in case the underlying data structures allow for and to inform the access functions in[2.x.19] on which array to get the data from One example of more efficient storage is the enum value[2.x.20] which means that one can get the indices to all degrees of freedom of a cell by reading only the first index for each whereas all subsequent indices are merely an offset from the first index **This value indicates that no index compression was found and the only valid storage is to access all indices present on the possibly including constraints For a cell face of this index the data access in FEEvaluationBase is directed to the array[2.x.21] dof_indices with the index row_starts[cell_index *n_vectorization *n_components] first **This value indicates that the indices are interleaved for access with vectorized gather and scatter operation This storage variant is possible in case there are no constraints on the cell and the indices in the batch of cells are not pointing to the same global index in different slots of a vectorized the data access in FEEvaluationBase is directed to the array dof_indices_interleaved with the index row_starts[cell_index *n_vectorization *n_components] first **This value indicates that the indices within a cell are all and one can get the index to the cell by reading that single value for each of the cells in the cell batch For a cell face of this index the data access in FEEvaluationBase is directed to the array dof_indices_contiguous with the index cell_index *n_vectorization *n_components **This value indicates that the indices with a cell are contiguous and interleaved for i the first DoF index on a cell to the four or eight cells in the vectorization batch come than the second DoF and so on the interleaving between cells implies that only the batches for vectorization can be accessed whereas there is a strided access for getting only some of the entries The two additional categories interleaved_contiguous_strided and interleaved_contiguous_mixed_strides are a consequence of this storage type The former is for faces where at least one of the two adjacent sides will break with the interleaved storage We then have to make a strided access as described in the next category The last category interleaved_contiguous_mixed_strides appears in the ghost see the more detailed description of that category below this is something that cannot be avoided in general once we interleave the indices between cells For a cell face of this index the data access in FEEvaluationBase is directed to the array dof_indices_contiguous with the index cell_index *n_vectorization *n_components **Similar to interleaved_contiguous but for the case when the interleaved indices are only contiguous within the degrees of but not also over the components of a vectorized array This happens typically on faces with DG where the cells have interleaved_contiguous storage but the faces numbering is not the same as the cell s numbering For a cell face of this index the data access in FEEvaluationBase is directed to the array dof_indices_contiguous with the index cell_index *n_vectorization *n_components **Similar to interleaved_contiguous_separate but for the case when the interleaved indices are not n_vectorization apart This happens typically within the ghost layer of DG where the remote owner has applied an interleaved storage and the current processor only sees some of the cells For a cell face of this index the data access in FEEvaluationBase is directed to the array dof_indices_contiguous with the index cell_index *n_vectorization * n_components</div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_2dof__info__0_8txt_source.html#l00070">dof_info_0.txt:70</a></div></div>
<div class="ttc" id="aclassTrilinosWrappers_1_1SparseMatrix_html"><div class="ttname"><a href="classTrilinosWrappers_1_1SparseMatrix.html">TrilinosWrappers::SparseMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2trilinos__sparse__matrix_8h_source.html#l00505">trilinos_sparse_matrix.h:505</a></div></div>
<div class="ttc" id="afe_2fe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea"><div class="ttname"><a href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a></div><div class="ttdeci">@ update_values</div><div class="ttdoc">Shape function values.</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__update__flags_8h_source.html#l00070">fe_update_flags.h:70</a></div></div>
<div class="ttc" id="aiterators__0_8txt_html_a6cf0880ba2af3a1be4aacdbbd4b90f9c"><div class="ttname"><a href="iterators__0_8txt.html#a6cf0880ba2af3a1be4aacdbbd4b90f9c">triangulation</a></div><div class="ttdeci">where BaseIterator usually is one of thestandard iterators discussed above *The FilteredIterator gets an additional Predicate in its constructor and willskip all objects where this Predicate evaluates to&lt; tt &gt; false&lt;/tt &gt; Acollection of predicates already implemented can be found in the namespaceIteratorFilters ***IteratorsLoops Iterating over objects *All iterators of the same kind and iterating over thesame kind of geometrical objects traverse the mesh in the sameorder Take this code all iterators will always point to the same mesh even though&lt; tt &gt; DoFHandler&lt;/tt &gt; and&lt; tt &gt; Triangulation&lt;/tt &gt; are very different and even if the DoFHandlers are handling different finite the difference is only in the Accessor As mentioned the order in which iterators traverse the forest ofobjects is actually well but application programs should notassume any such but rather consider this an implementation detailof the library *Corresponding to above the order in which iterators traverse activeobjects is the same for all iterators in the following the difference to the previous example being that here we only consider active but theyare really rather dumb Their magic only lies in the fact that they point tosome useful in this case the Accessor For they point to anactual object that stores some data On the other the deal II when do not return a reference to an actual but returnan object that knows how to get at the data that represents cells In thisobject doesn t store itself where the vertices of a cell are or what its neighborsare it knows how to tease this sort of information from out of thearrays and tables and lists that the Triangulation class sets up to describe amesh *Accessing data that characterizes a cell is always done through the i e the expression[2.x.10] grants access to[1.x.6] attributes of this Accessor Examples of properties you can query from aniterator are ***Since dereferencing iterators yields accessor these calls are tomember etc These in turn figure out the relevant datafrom the various data structures that store this data How this is actuallydone and what data structures are used is not really of concern to authors ofapplications in deal II In by hiding the actual data structureswe are able to store data in an efficient not necessarily in a way thatmakes it easily accessible or understandable to application writers ***IteratorsTypedefs Kinds of accessors *Depending on what sort of data you want to there are different kindsof accessor and hexes that make up a triangulation</div><div class="ttdef"><b>Definition:</b> <a href="iterators__0_8txt_source.html#l00063">iterators_0.txt:63</a></div></div>
<div class="ttc" id="aclassGridIn_html_a82ac1c03b0efe87204ad45d2f1d87f7e"><div class="ttname"><a href="classGridIn.html#a82ac1c03b0efe87204ad45d2f1d87f7e">GridIn::attach_triangulation</a></div><div class="ttdeci">void attach_triangulation(Triangulation&lt; dim, spacedim &gt; &amp;tria)</div><div class="ttdef"><b>Definition:</b> <a href="grid__in_8cc_source.html#l00119">grid_in.cc:119</a></div></div>
<div class="ttc" id="ageodynamics__0_8txt_html_a47b3a2cd492d04754f4796002e14ed13"><div class="ttname"><a href="geodynamics__0_8txt.html#a47b3a2cd492d04754f4796002e14ed13">solver</a></div><div class="ttdeci">all others have started as modifications of one of the tutorial programs *The tutorial programs we propose to write will provide students and researchers with a reference implementation of current numerical technology such as higher order sophisticated linear and nonlinear stabilization etc Providing these as starting points for further development by others will also serve the goal of training a new generation of geodynamicists in modern numerical algorithms *In deal it is fairly simple to extend a set of equations by another for example an additional advected quantity that enters the existing equations as a right hand side or in one of the coefficients Since applications typically use blocked matrices rather than the one big matrix for everything it is also not complicated to find suitable linear solvers for augmented equations deal II is a good tool for trying out more complex formulations of or more complete models and their effects on the accuracy of solutions *deal II provides many interchangeable components that allow rapid prototyping of finite element kinds and stabilization or linear solvers For typically only a few lines of code have to be changed to replace low order by high order elements Through it becomes relatively simple to try out higher order a different block elimination solver</div><div class="ttdef"><b>Definition:</b> <a href="geodynamics__0_8txt_source.html#l00033">geodynamics_0.txt:33</a></div></div>
<div class="ttc" id="astep-1_8cc_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="step-1_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdef"><b>Definition:</b> <a href="step-1_8cc_source.html#l00086">step-1.cc:86</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a6bb45dc67787e3fab7882461929b5fbe"><div class="ttname"><a href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">ParameterHandler::get_bool</a></div><div class="ttdeci">bool get_bool(const std::string &amp;entry_name) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l01113">parameter_handler.cc:1113</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga7b52b286796c23ef9ff178faf7a4b68f"><div class="ttname"><a href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">StandardExceptions::ExcNotImplemented</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcNotImplemented()</div></div>
<div class="ttc" id="adata__out__base__0_8txt_html_a918b7763318d7dd4fc059a2898fe1ef6"><div class="ttname"><a href="data__out__base__0_8txt.html#a918b7763318d7dd4fc059a2898fe1ef6">declare_parameters</a></div><div class="ttdeci">derived classes use their own type to fill in the so that&lt; tt &gt; memory_consumption&lt;/tt &gt; works correctly See the Wikipedia page on the pattern for more information ***Declare all flags with name and type as offered by this for use in input files This method does but child classes may override this method to add fields to&lt; tt &gt; prm&lt;/tt &gt; **Read the parameters declared in declare_parameters() and set the flags for this output format accordingly. This method does nothing</div></div>
<div class="ttc" id="aclassTriangulation_html"><div class="ttname"><a href="classTriangulation.html">Triangulation&lt; dim &gt;</a></div></div>
<div class="ttc" id="agrid_2tria_8h_html"><div class="ttname"><a href="grid_2tria_8h.html">tria.h</a></div></div>
<div class="ttc" id="abase_2parameter__handler_8h_html"><div class="ttname"><a href="base_2parameter__handler_8h.html">parameter_handler.h</a></div></div>
<div class="ttc" id="aupdate__flags__0_8txt_html_a5873b8f7eeaefb5e7a99005c6c93b175"><div class="ttname"><a href="update__flags__0_8txt.html#a5873b8f7eeaefb5e7a99005c6c93b175">quadrature</a></div><div class="ttdeci">and a mapping object that provides the Jacobian as well as its determinant Dealing with all these objects would be cumbersome and error prone *On the other these three kinds of objects almost always appear and it is in fact very rare for deal II application codes to do anything with quadrature</div><div class="ttdef"><b>Definition:</b> <a href="update__flags__0_8txt_source.html#l00019">update_flags_0.txt:19</a></div></div>
<div class="ttc" id="afe_2fe__q_8h_html"><div class="ttname"><a href="fe_2fe__q_8h.html">fe_q.h</a></div></div>
<div class="ttc" id="ampi__remote__point__evaluation__0_8txt_html_a45c57074a631760cdab557f450e880e0"><div class="ttname"><a href="mpi__remote__point__evaluation__0_8txt.html#a45c57074a631760cdab557f450e880e0">mapping</a></div><div class="ttdeci">*Helper class to access values on non matching grids *The name of the fields are chosen with the method quantities are computed at specified arbitrary positioned which receive the result and resort the result according to the points **Constructor[2.x.1] tolerance Tolerance in terms of unit cell coordinates for determining all cells around a point passed to the class during it might be necessary to adjust the tolerance in order to be able to identify a cell Floating point arithmetic implies that a point in not lie exactly on a or face[2.x.2] enforce_unique_mapping Enforce unique mapping</div><div class="ttdef"><b>Definition:</b> <a href="mpi__remote__point__evaluation__0_8txt_source.html#l00005">mpi_remote_point_evaluation_0.txt:5</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a6d65f458be69e23a348221cb67fc411d"><div class="ttname"><a href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">ParameterHandler::declare_entry</a></div><div class="ttdeci">void declare_entry(const std::string &amp;entry, const std::string &amp;default_value, const Patterns::PatternBase &amp;pattern=Patterns::Anything(), const std::string &amp;documentation=&quot;&quot;, const bool has_to_be_set=false)</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00796">parameter_handler.cc:796</a></div></div>
<div class="ttc" id="aclassFEValuesBase_html_aa57a7e777b0798ec009b4ce888ad9574"><div class="ttname"><a href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">FEValuesBase&lt; dim, dim &gt;::shape_value_component</a></div><div class="ttdeci">double shape_value_component(const unsigned int function_no, const unsigned int point_no, const unsigned int component) const</div></div>
<div class="ttc" id="ainclude_2deal_8II_2base_2utilities_8h_html"><div class="ttname"><a href="include_2deal_8II_2base_2utilities_8h.html">utilities.h</a></div></div>
<div class="ttc" id="aclassFEValuesBase_html_ac25ec6835799c3b6c7c842f8acb05eb3"><div class="ttname"><a href="classFEValuesBase.html#ac25ec6835799c3b6c7c842f8acb05eb3">FEValuesBase&lt; dim, dim &gt;::normal_vector</a></div><div class="ttdeci">const Tensor&lt; 1, spacedim &gt; &amp; normal_vector(const unsigned int i) const</div></div>
<div class="ttc" id="asolver__0_8txt_html_a06078ea1995fa54b715bee3b7745f08f"><div class="ttname"><a href="solver__0_8txt.html#a06078ea1995fa54b715bee3b7745f08f">convergence</a></div><div class="ttdeci">ii the value that is used to determine convergence(oftentimes the residual, but in other cases other quantities may be used as long as they converge to zero as the iterate approaches the solution of the linear system)</div></div>
<div class="ttc" id="amg__0_8txt_html_a05d914308ac970c97c941a291a81ccc1"><div class="ttname"><a href="mg__0_8txt.html#a05d914308ac970c97c941a291a81ccc1">b</a></div><div class="ttdeci">which is a wrapper around Multigrid with the standard interface of deal II[2.x.9] Preconditioners PreconditionMG also uses the classes inheriting from for instance where it uses[2.x.10] and[2.x.11] which transfer between the global vector and the level vectors we have several auxiliary namely which stores an object on each level **See b</div><div class="ttdef"><b>Definition:</b> <a href="mg__0_8txt_source.html#l00011">mg_0.txt:11</a></div></div>
<div class="ttc" id="astructDataPostprocessorInputs_1_1Vector_html_a2a918d936d56f2be4cdad1b8074c3a86"><div class="ttname"><a href="structDataPostprocessorInputs_1_1Vector.html#a2a918d936d56f2be4cdad1b8074c3a86">DataPostprocessorInputs::Vector::solution_gradients</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; Tensor&lt; 1, spacedim &gt; &gt; &gt; solution_gradients</div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__postprocessor_8h_source.html#l00347">data_postprocessor.h:347</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Bool_html"><div class="ttname"><a href="classPatterns_1_1Bool.html">Patterns::Bool</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2patterns_8h_source.html#l01054">patterns.h:1054</a></div></div>
<div class="ttc" id="amapping__info__0_8txt_html_aaed09e22b1fee38bd2273caeedfb0e90"><div class="ttname"><a href="mapping__info__0_8txt.html#aaed09e22b1fee38bd2273caeedfb0e90">c</a></div><div class="ttdeci">*An enum to identify various types of cells and faces The most general type is what we typically compute in the FEValues context but for many geometries we can save significant storage ***The cell or face is Cartesian **The cell or face can be described with an affine mapping **The face is i the normal factor on a face is the same on all quadrature points This type is not assigned for cells **There is no special information available for compressing the representation of the object under consideration **Definition of a structure that stores all cached data related to the evaluated geometry from the mapping In order to support hp adaptivity and compressed storage length can be different for different rows it allows to jump at the data of individual rows similar to compressed row storage in sparse matrices We have two different start indices for fields with different sizes The first category of offsets are the indices for Jacobians of the transformation from unit to real second JxW and normal vectors We keep separate arrays for all these data structures because a user code might access only some of them In such a one array will be gone through in a contiguous order with access to all which makes it easy for the processor to prefetch data Having all data in a single array would require some strides in the access which is much more complicated for the processor to called which contains the quadrature weights and permutations of how to go through quadrature points in case of face data The latter comes in a vector for the support of hp with several data fields for the individual quadrature formulas ***Constructor Does nothing **Set up the lengths in the various members of this struct **Set up the lengths in the various members of this struct **Returns the memory consumption in bytes **Number of quadrature points applied on the given cell or face **Original one dimensional quadrature formula applied on the given cell or face **Quadrature formula applied on the given cell or face **Quadrature weights separated by dimension for use in specific situations **A cached vector of quadrature weights in the given number the evaluation of basis functions is not in the correct order if a face is not in the standard orientation to a given element This data structure is used to re order the data evaluated on quadrature points to represent the correct order **A class describing the layout of the sections in the[2.x.2] field and also includes some data that depends on the number of quadrature points in the hp context such as the inner quadrature formula and re indexing for faces that are not in the standard orientation **Collection of quadrature formulae applied on the given face *Only filled for since faces might be quadrilateral or triangle shaped **Stores the index offset into the arrays[2.x.4][2.x.5][2.x.6] and the second derivatives Note that affine cells have shorter fields of where the others have lengths equal to the number of quadrature points of the given cell **The storage of the Jacobian i the inverse and transposed Jacobians of the transformation from the unit to the real cell Indexed by[2.x.9] Contains two fields for access from both sides for interior but the default only the upper diagonal and diagonal part are needed The first index runs through the starting with the diagonal and then continuing row i and so on The second index is the spatial coordinate Indexed by[2.x.12] Contains two fields for access from both sides for interior but the default including a compression scheme for Cartesian cells where we do not need to store the full data on all points Indexed by *[2.x.16] *Clears all data fields except the descriptor vector **Returns the quadrature index for a given number of quadrature points If not in hp mode or if the index is not this function always returns index this function does not check whether the given degree is actually present **Prints a detailed summary of memory consumption in the different structures of this class to the given output stream **Returns the memory consumption in bytes **The class that stores all geometry dependent data related with cell interiors for use in the matrix free class ***Compute the information in the given cells and faces The cells are specified by the level and the index within the a mapping and several quadrature formulas are given **Update the information in the given cells and faces that is the result of a change in the given mapping keeping the quadrature formulas and other unknowns unchanged This call is only valid if[2.x.20] has been called before **Return the type of a given cell as detected during initialization **Clear all data fields in this class **Return the memory consumption of this class in bytes **Prints a detailed summary of memory consumption in the different structures of this class to the given output stream **The given update flags for computing the geometry on the cells **The given update flags for computing the geometry on the boundary faces **The given update flags for computing the geometry on the interior faces **The given update flags for computing the geometry on the faces for cell centric loops **Stores whether a cell is has constant transform data() or is whether it represents an affine whether it is a flat face where the normal vector is the same throughout the or is following the[2.x.21] variable for the cell types **The pointer to the underlying[2.x.22] object **The pointer to the first entry of mapping_collection **Reference cell type related to each quadrature and active quadrature index **Internal function to compute the geometry for the case the mapping is a MappingQ and a single quadrature formula per i it uses a polynomial description of the cell especially when several different quadrature formulas are and consumes less memory[2.x.23] tria The triangulation to be used for setup[2.x.24] cells The actual cells of the triangulation to be worked given as a tuple of the level and index within the level as used in the main initialization of the class ::x faces The description of the connectivity from faces to cells as filled in the MatrixFree class **Computes the information in the given called within initialize **Computes the information in the given called within initialize **Computes the information in the given called within initialize **Helper function to determine which update flags must be set in the internal functions to initialize all data as requested by the user **A helper class to extract either cell or face data from mapping info for use in FEEvaluationBase **A class that is used to compare floating point c</div><div class="ttdef"><b>Definition:</b> <a href="mapping__info__0_8txt_source.html#l00116">mapping_info_0.txt:116</a></div></div>
<div class="ttc" id="aclassTrilinosWrappers_1_1SolverDirect_html"><div class="ttname"><a href="classTrilinosWrappers_1_1SolverDirect.html">TrilinosWrappers::SolverDirect</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2trilinos__solver_8h_source.html#l00599">trilinos_solver.h:599</a></div></div>
<div class="ttc" id="amapping__0_8txt_html_a334bdbfb52225fe249c8d336acfab3e6"><div class="ttname"><a href="mapping__0_8txt.html#a334bdbfb52225fe249c8d336acfab3e6">kind</a></div><div class="ttdeci">*The transformation kind used for the[2.x.0] functions *Special finite elements may need special Mapping from the reference cell to the actual mesh cell In order to be most this enum provides an extensible interface for arbitrary transformations Nevertheless these must be implemented in the i shape functions are not mapped from a reference cell but instead are defined right on the real space cell **Covariant we introduce a separate mapping kind</div><div class="ttdef"><b>Definition:</b> <a href="mapping__0_8txt_source.html#l00025">mapping_0.txt:25</a></div></div>
<div class="ttc" id="anamespacePhysics_1_1Elasticity_1_1Kinematics_html_a93f65b0385560a34ec1d3c5ec5a882b8"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a93f65b0385560a34ec1d3c5ec5a882b8">Physics::Elasticity::Kinematics::d</a></div><div class="ttdeci">SymmetricTensor&lt; 2, dim, Number &gt; d(const Tensor&lt; 2, dim, Number &gt; &amp;F, const Tensor&lt; 2, dim, Number &gt; &amp;dF_dt)</div></div>
<div class="ttc" id="adata__postprocessor__0_8txt_html_a80e53cb52e5dbb182dd14ee528927a77"><div class="ttname"><a href="data__postprocessor__0_8txt.html#a80e53cb52e5dbb182dd14ee528927a77">postprocessor</a></div><div class="ttdeci">the current data is generated on a coarser mesh for the background color corresponds to the magnitude of the gradient vector and the vector glyphs to the gradient itself It may be surprising at first to see that from each multiple vectors going in different directions But that is because the solution is only the gradient is discontinuous across and so the multiple vectors originating from each vertex simply represent the differing gradients of the solution at each adjacent cell *The output above the gradient[2.x.114] of the solution **corresponds to the temperature gradient if one interpreted[2.x.115] as solving a steady state heat transfer problem It is very small in the central part of the domain because in[2.x.116] we are solving an equation that has a coefficient[2.x.117] that is large in the central part and small on the outside This can be thought as a material that conducts heat and consequently the temperature gradient is small On the other the heat flux corresponds to the quantity[2.x.118] For the solution of that the flux should be continuous across the interface This is easily verified by the following modification of the postprocessor</div><div class="ttdef"><b>Definition:</b> <a href="data__postprocessor__0_8txt_source.html#l00138">data_postprocessor_0.txt:138</a></div></div>
<div class="ttc" id="adata__postprocessor__0_8txt_html_afb21caeba7bf26aba89ce705266fedb1"><div class="ttname"><a href="data__postprocessor__0_8txt.html#afb21caeba7bf26aba89ce705266fedb1">get_names</a></div><div class="ttdeci">note that this is only determined by the number of components in the finite element in and not by whether the data computed by a class derived from the current one is scalar or vector valued derived classes have to implement the get_names() function</div></div>
<div class="ttc" id="adistributed__0_8txt_html_ac2b339f054fd752a401e197097db8cfe"><div class="ttname"><a href="distributed__0_8txt.html#ac2b339f054fd752a401e197097db8cfe">solution</a></div><div class="ttdeci">********clusters ***deal II can use multiple machines connected via MPI to parallelize in addition to the parallelization within a shared memory machine discussed in the[2.x.4] module There are essentially two ways to utilize multiple but only a share of the global sparsity and solution vector is stored on each machine ****The mesh and DoF handler are also i e each processor stores only a share of the cells and degrees of freedom No processor has knowledge of the entire or solution</div><div class="ttdef"><b>Definition:</b> <a href="distributed__0_8txt_source.html#l00025">distributed_0.txt:25</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga4c22c86ff89575667de2ca9778aa28e5"><div class="ttname"><a href="group__Exceptions.html#ga4c22c86ff89575667de2ca9778aa28e5">StandardExceptions::ExcFileNotOpen</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcFileNotOpen(std::string arg1)</div></div>
<div class="ttc" id="aparameter__handler__0_8txt_html_ad919e2b915d8e8226aef004c2d8399a8"><div class="ttname"><a href="parameter__handler__0_8txt.html#ad919e2b915d8e8226aef004c2d8399a8">exception</a></div><div class="ttdeci">since default values may change in the process of program you cannot know the values of parameters not specified in the input file ****It is often convenient to have something happen as soon as a parameter value is read This could be a check that it is valid that a file that is listed in the parameter file exists **or to initiate something else in such as setting a variable outside the this action could also be initiated once all parameters are read via but it is sometimes[1.x.19] to do it right away *This is facilitated by the and can then do whatever they want with it **e save it somewhere outside the ParameterHandler in C one doesn t usually pass around the address of a but an action can be a function like object(taking a string as argument) that results from calling such as a[1.x.20] that has the form **[1.x.21] *and that is attached to a specific parameter. *A typical example of such an action would be as follows the content of the file equals the default value of the parameter the contents of files are never changed after declaration of a parameter a directory in this file system may not have a file called[2.x.20] in it In that the directory represents a subsection as declared and the directory s name will correspond to the name of the subsection It will then have no files in it at but it may have further directories in the code above will lead to a hierarchical representation of data that looks like this(the content of files is indicated at the right in a different font) this is only used when creating output for exceptions If non empty[2.x.35] is the ParameterHandler object will stop parsing lines after encountering[2.x.36] This is handy when adding extra data that shall be parsed manually If[2.x.37] the parameter handler will skip undefined sections and entries This is useful for partially parsing a parameter for example to obtain only the spatial dimension of the problem By default all entries and subsections are expected to be declared The function sets the value of all parameters it encounters in the input file to the provided value Parameters not explicitly listed in the input file are left at the value they previously which will be the default value provided to and for each parameter all associated actions that may previously have been set by or if an associated action throws an exception</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler__0_8txt_source.html#l00241">parameter_handler_0.txt:241</a></div></div>
<div class="ttc" id="aclassDataOut__DoFData_html_a6ed7c846331069f406b8c9933c37fda4"><div class="ttname"><a href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">DataOut_DoFData::attach_dof_handler</a></div><div class="ttdeci">void attach_dof_handler(const DoFHandler&lt; dim, spacedim &gt; &amp;)</div></div>
<div class="ttc" id="aclassDoFHandler_html"><div class="ttname"><a href="classDoFHandler.html">DoFHandler</a></div><div class="ttdef"><b>Definition:</b> <a href="dofs_2dof__handler_8h_source.html#l00266">dof_handler.h:266</a></div></div>
<div class="ttc" id="aclassVectorizedArray_html_adea3423146bcdda2dce143cfb4d10ae8"><div class="ttname"><a href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">VectorizedArray::cos</a></div><div class="ttdeci">VectorizedArray&lt; Number, width &gt; cos(const ::VectorizedArray&lt; Number, width &gt; &amp;x)</div><div class="ttdef"><b>Definition:</b> <a href="base_2vectorization_8h_source.html#l05605">vectorization.h:5605</a></div></div>
<div class="ttc" id="aclassFEValuesBase_html_ad1f4e0deb5d982e8172d82141c634a67"><div class="ttname"><a href="classFEValuesBase.html#ad1f4e0deb5d982e8172d82141c634a67">FEValuesBase&lt; dim, dim &gt;::get_function_gradients</a></div><div class="ttdeci">void get_function_gradients(const InputVector &amp;fe_function, std::vector&lt; Tensor&lt; 1, spacedim, typename InputVector::value_type &gt;&gt; &amp;gradients) const</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values_8cc_source.html#l03664">fe_values.cc:3664</a></div></div>
<div class="ttc" id="anamespaceDataComponentInterpretation_html_a0cd2da3afe902f9004c23a73dbcc8ab0a9b7d9c85221484e1998f6869d98cba8b"><div class="ttname"><a href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a9b7d9c85221484e1998f6869d98cba8b">DataComponentInterpretation::component_is_part_of_vector</a></div><div class="ttdeci">@ component_is_part_of_vector</div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__component__interpretation_8h_source.html#l00062">data_component_interpretation.h:62</a></div></div>
<div class="ttc" id="asolver__cg__0_8txt_html_a557c71e94a2542d697ca3426b8843cd4"><div class="ttname"><a href="solver__cg__0_8txt.html#a557c71e94a2542d697ca3426b8843cd4">sqrt</a></div><div class="ttdeci">*This class implements the preconditioned Conjugate but is used in many other tutorial programs as well Like all other solver it can work on any kind of vector and matrix as long as they satisfy certain and defaults to *[2.x.2] **This version of CG is taken from D Braess s book Finite Elements It requires a symmetric the projected matrix[2.x.4] is tri diagonal Since the projection is the eigenvalues of[2.x.5] approximate those of the original preconditioned matrix[2.x.6] In after[2.x.7] where[2.x.8] is the dimension of the original the eigenvalues of both matrices are equal even for small numbers of iteration the condition number of[2.x.9] is a good estimate for the one of *[2.x.10] After[2.x.11] steps the matrix T_m can be written in terms of the coefficients[2.x.12] and[2.x.13] as the tri diagonal matrix with diagonal elements&lt; tt &gt;&lt; tt &gt; alpha_1 beta_0&lt; tt &gt;&lt; tt &gt; sqrt(beta_{m-2&lt;/tt &gt;)/alpha_</div><div class="ttdef"><b>Definition:</b> <a href="solver__cg__0_8txt_source.html#l00011">solver_cg_0.txt:11</a></div></div>
<div class="ttc" id="aclassTable_html"><div class="ttname"><a href="classTable.html">Table</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2array__view_8h_source.html#l00033">array_view.h:33</a></div></div>
<div class="ttc" id="aclassDoFHandler_html_a553ca864aaf70330d9be86bc78f36d1e"><div class="ttname"><a href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">DoFHandler::distribute_dofs</a></div><div class="ttdeci">void distribute_dofs(const FiniteElement&lt; dim, spacedim &gt; &amp;fe)</div></div>
<div class="ttc" id="aclassFEValues_html"><div class="ttname"><a href="classFEValues.html">FEValues&lt; dim &gt;</a></div></div>
<div class="ttc" id="anamespaceDifferentiation_1_1SD_html_a592560ee80355620422a86087f11b9df"><div class="ttname"><a href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">Differentiation::SD::fabs</a></div><div class="ttdeci">Expression fabs(const Expression &amp;x)</div><div class="ttdef"><b>Definition:</b> <a href="symengine__math_8cc_source.html#l00273">symengine_math.cc:273</a></div></div>
<div class="ttc" id="afe_2fe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a"><div class="ttname"><a href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a></div><div class="ttdeci">@ update_quadrature_points</div><div class="ttdoc">Transformed quadrature points.</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__update__flags_8h_source.html#l00116">fe_update_flags.h:116</a></div></div>
<div class="ttc" id="aclassFEValuesBase_html_a5b264d5b2fb6615f5dea7a21135ed1a5"><div class="ttname"><a href="classFEValuesBase.html#a5b264d5b2fb6615f5dea7a21135ed1a5">FEValuesBase&lt; dim, dim &gt;::dofs_per_cell</a></div><div class="ttdeci">const unsigned int dofs_per_cell</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values_8h_source.html#l02424">fe_values.h:2424</a></div></div>
<div class="ttc" id="apolynomials__abf__0_8txt_html_a7a716deb19e461cf8ba2a26e01c6a908"><div class="ttname"><a href="polynomials__abf__0_8txt.html#a7a716deb19e461cf8ba2a26e01c6a908">k</a></div><div class="ttdeci">*This class implements the[1.x.0] vector valued Arnold Boffi Falk polynomials as described in the article by Arnold Boffi SIAM J Numer Anal pp **The ABF polynomials are constructed such that the divergence is in the tensor product polynomial space[1.x.1] the polynomial order of each component must be two orders higher in the corresponding yielding the polynomial spaces[1.x.2] and[1.x.3] in resp ******Constructor Creates all basis functions for Raviart Thomas polynomials of given degree[2.x.1] k</div><div class="ttdef"><b>Definition:</b> <a href="polynomials__abf__0_8txt_source.html#l00013">polynomials_abf_0.txt:13</a></div></div>
<div class="ttc" id="anumerics_2vector__tools_8h_html"><div class="ttname"><a href="numerics_2vector__tools_8h.html">vector_tools.h</a></div></div>
<div class="ttc" id="abase_2function_8h_html"><div class="ttname"><a href="base_2function_8h.html">function.h</a></div></div>
<div class="ttc" id="aclassVector_html_ac4a4dbef7dd65ef8ad35ae56b57d7c05"><div class="ttname"><a href="classVector.html#ac4a4dbef7dd65ef8ad35ae56b57d7c05">Vector::reinit</a></div><div class="ttdeci">virtual void reinit(const size_type N, const bool omit_zeroing_entries=false)</div></div>
<div class="ttc" id="abase_2vectorization_8h_html_a2aa674852f105b0ed1b35f569c19fea6"><div class="ttname"><a href="base_2vectorization_8h.html#a2aa674852f105b0ed1b35f569c19fea6">std::log</a></div><div class="ttdeci">inline ::VectorizedArray&lt; Number, width &gt; log(const ::VectorizedArray&lt; Number, width &gt; &amp;x)</div><div class="ttdef"><b>Definition:</b> <a href="base_2vectorization_8h_source.html#l05668">vectorization.h:5668</a></div></div>
<div class="ttc" id="anumerical__algorithms__0_8txt_html_a852a1e245dd2de4943eeb66beeaf65b1"><div class="ttname"><a href="numerical__algorithms__0_8txt.html#a852a1e245dd2de4943eeb66beeaf65b1">vector</a></div><div class="ttdeci">****This module groups a diverse set of classes that generally implement some sort of numerical algorithm on top all the basic and finite element classes in the library They are generally unconnected to each other *Some of the like KellyErrorEstimator and act on solutions already and compute derived quantities in the first two or help transferring a set of vectors from one mesh to another *The namespaces and VectorTools provide an assortment of such as creating a Laplace projecting or interpolating a function onto the present finite element etc The difference to the functions in the DoFTools and FETools functions is that they work on the DoFTools functions only act on a given DoFHandler object without reference to a data vector</div><div class="ttdef"><b>Definition:</b> <a href="numerical__algorithms__0_8txt_source.html#l00008">numerical_algorithms_0.txt:8</a></div></div>
<div class="ttc" id="aclassDataPostprocessor_html_a1ba57b598d24d64365d469a854271c68"><div class="ttname"><a href="classDataPostprocessor.html#a1ba57b598d24d64365d469a854271c68">DataPostprocessor::evaluate_vector_field</a></div><div class="ttdeci">virtual void evaluate_vector_field(const DataPostprocessorInputs::Vector&lt; dim &gt; &amp;input_data, std::vector&lt; Vector&lt; double &gt;&gt; &amp;computed_quantities) const</div><div class="ttdef"><b>Definition:</b> <a href="data__postprocessor_8cc_source.html#l00037">data_postprocessor.cc:37</a></div></div>
<div class="ttc" id="anamespacetypes_html_aaf4eb6ec214fa642dfd956f11a9cd2d7"><div class="ttname"><a href="namespacetypes.html#aaf4eb6ec214fa642dfd956f11a9cd2d7">types::boundary_id</a></div><div class="ttdeci">unsigned int boundary_id</div><div class="ttdef"><b>Definition:</b> <a href="base_2types_8h_source.html#l00117">types.h:117</a></div></div>
<div class="ttc" id="anumerics_2solution__transfer_8h_html"><div class="ttname"><a href="numerics_2solution__transfer_8h.html">solution_transfer.h</a></div></div>
<div class="ttc" id="afunction__tools__0_8txt_html_a1a2acf608502527a80c0aeecdc12c908"><div class="ttname"><a href="function__tools__0_8txt.html#a1a2acf608502527a80c0aeecdc12c908">a</a></div><div class="ttdeci">*Estimate bounds on the value and bounds on each gradient component of a over a by approximating it by a order Taylor polynomial starting from the box center Each lower and upper bound is returned as a[2.x.1]</div><div class="ttdef"><b>Definition:</b> <a href="function__tools__0_8txt_source.html#l00002">function_tools_0.txt:2</a></div></div>
<div class="ttc" id="astructTrilinosWrappers_1_1SolverDirect_1_1AdditionalData_html"><div class="ttname"><a href="structTrilinosWrappers_1_1SolverDirect_1_1AdditionalData.html">TrilinosWrappers::SolverDirect::AdditionalData</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2trilinos__solver_8h_source.html#l00607">trilinos_solver.h:607</a></div></div>
<div class="ttc" id="aclassMapping_html"><div class="ttname"><a href="classMapping.html">Mapping</a></div><div class="ttdoc">Abstract base class for mapping classes. This class declares the interface for the functionality to d...</div><div class="ttdef"><b>Definition:</b> <a href="fe_2mapping_8h_source.html#l00270">mapping.h:270</a></div></div>
<div class="ttc" id="alac_2trilinos__precondition_8h_html"><div class="ttname"><a href="lac_2trilinos__precondition_8h.html">trilinos_precondition.h</a></div></div>
<div class="ttc" id="aclassDataOutInterface_html_acad99726038e4fca7f605fdffb3317e4"><div class="ttname"><a href="classDataOutInterface.html#acad99726038e4fca7f605fdffb3317e4">DataOutInterface::write_vtk</a></div><div class="ttdeci">void write_vtk(std::ostream &amp;out) const</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8cc_source.html#l07221">data_out_base.cc:7221</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga0d685aad996180f9851183ae3e29019a"><div class="ttname"><a href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">StandardExceptions::ExcIndexRange</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcIndexRange(int arg1, int arg2, int arg3)</div></div>
<div class="ttc" id="agroup__constraints_html_gaf78e864edbfba7e0a7477457bfb96b26"><div class="ttname"><a href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a></div><div class="ttdeci">void make_sparsity_pattern(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, SparsityPatternType &amp;sparsity_pattern, const AffineConstraints&lt; number &gt; &amp;constraints=AffineConstraints&lt; number &gt;(), const bool keep_constrained_dofs=true, const types::subdomain_id subdomain_id=numbers::invalid_subdomain_id)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools__sparsity_8cc_source.html#l00064">dof_tools_sparsity.cc:64</a></div></div>
<div class="ttc" id="amg__transfer__0_8txt_html_a6b401cd9c6154fc787311f58ab910002"><div class="ttname"><a href="mg__transfer__0_8txt.html#a6b401cd9c6154fc787311f58ab910002">pressure</a></div><div class="ttdeci">MGTransferBase is defined in mg_base h ***Implementation of transfer between the global vectors and the multigrid levels for use in the derived class MGTransferPrebuilt and other classes ***Reset the object to the state it had right after the default constructor **Transfer from a vector on the global grid to vectors defined on each of the levels separately for the active degrees of freedom In for a globally refined mesh only the finest level in[2.x.0] is filled as a plain copy of[2.x.1] All the other level objects are left untouched **Transfer from multi level vector to normal vector Copies data from active portions of an MGVector into the respective positions of a&lt; tt &gt; Vector&lt; number &gt;&lt;/tt &gt; In order to keep the result constrained degrees of freedom are set to zero **Add a multi level vector to a normal vector Works as the previous but probably not for continuous elements **If this object operates on BlockVector we need to describe how the individual vector components are mapped to the blocks of a vector For for a Stokes we have dim vector components for velocity and pressure</div><div class="ttdef"><b>Definition:</b> <a href="mg__transfer__0_8txt_source.html#l00017">mg_transfer_0.txt:17</a></div></div>
<div class="ttc" id="avector__tools__point__value__0_8txt_html_ac7a5c2ceb5c739d5b51cc7e0eee8100a"><div class="ttname"><a href="vector__tools__point__value__0_8txt.html#ac7a5c2ceb5c739d5b51cc7e0eee8100a">solve</a></div><div class="ttdeci">*Assembling of right hand sides **Create a right hand side vector for a point source at point[2.x.1] In other it creates a vector[2.x.2] so that[2.x.3] where[2.x.4] are the shape functions described by[2.x.5] and[2.x.6] is the point at which the delta function is located Prior content of the given[2.x.7] vector is deleted This function is for the case of a scalar finite element This function is typically used in one of these two with different values for right hand sides or and then evaluate the solution at the same point every time You could do this by calling[2.x.8] after each solve</div><div class="ttdef"><b>Definition:</b> <a href="vector__tools__point__value__0_8txt_source.html#l00015">vector_tools_point_value_0.txt:15</a></div></div>
<div class="ttc" id="alac_2dynamic__sparsity__pattern_8h_html"><div class="ttname"><a href="lac_2dynamic__sparsity__pattern_8h.html">dynamic_sparsity_pattern.h</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_gae9a45f517af1401c50811a11083f9114"><div class="ttname"><a href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">StandardExceptions::ExcMessage</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcMessage(std::string arg1)</div></div>
<div class="ttc" id="anamespaceDataComponentInterpretation_html_a0cd2da3afe902f9004c23a73dbcc8ab0aa4924d31df0211f3fb9db3bbe1af0d1c"><div class="ttname"><a href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa4924d31df0211f3fb9db3bbe1af0d1c">DataComponentInterpretation::component_is_scalar</a></div><div class="ttdeci">@ component_is_scalar</div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__component__interpretation_8h_source.html#l00055">data_component_interpretation.h:55</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a61fa98fdc0c52980a5b1de0ee1fc5bb2"><div class="ttname"><a href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">ParameterHandler::get_integer</a></div><div class="ttdeci">long int get_integer(const std::string &amp;entry_string) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l01025">parameter_handler.cc:1025</a></div></div>
<div class="ttc" id="aclassFiniteElement_html_a86644fe67824373cd51e9ff7fca94f8c"><div class="ttname"><a href="classFiniteElement.html#a86644fe67824373cd51e9ff7fca94f8c">FiniteElement::system_to_component_index</a></div><div class="ttdeci">std::pair&lt; unsigned int, unsigned int &gt; system_to_component_index(const unsigned int index) const</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2fe_2fe_8h_source.html#l03180">fe.h:3180</a></div></div>
<div class="ttc" id="alac_2trilinos__solver_8h_html"><div class="ttname"><a href="lac_2trilinos__solver_8h.html">trilinos_solver.h</a></div></div>
<div class="ttc" id="afe_2fe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f"><div class="ttname"><a href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f">update_normal_vectors</a></div><div class="ttdeci">@ update_normal_vectors</div><div class="ttdoc">Normal vectors.</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__update__flags_8h_source.html#l00132">fe_update_flags.h:132</a></div></div>
<div class="ttc" id="aclassTensor_html"><div class="ttname"><a href="classTensor.html">Tensor&lt; 1, dim &gt;</a></div></div>
<div class="ttc" id="aclassMappingQ1_html"><div class="ttname"><a href="classMappingQ1.html">MappingQ1&lt; dim &gt;</a></div></div>
<div class="ttc" id="anamespaceStep8_html_a8cfe56efd5e932e7421d357e26eab267"><div class="ttname"><a href="namespaceStep8.html#a8cfe56efd5e932e7421d357e26eab267">Step8::right_hand_side</a></div><div class="ttdeci">void right_hand_side(const std::vector&lt; Point&lt; dim &gt;&gt; &amp;points, std::vector&lt; Tensor&lt; 1, dim &gt;&gt; &amp;values)</div><div class="ttdef"><b>Definition:</b> <a href="step-8_8cc_source.html#l00090">step-8.cc:90</a></div></div>
<div class="ttc" id="aclassDataOut_html_a087f63e22f0614bca326dbdca288c646"><div class="ttname"><a href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">DataOut::build_patches</a></div><div class="ttdeci">virtual void build_patches(const unsigned int n_subdivisions=0)</div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__out_8cc_source.html#l01071">data_out.cc:1071</a></div></div>
<div class="ttc" id="aclassSolutionTransfer_html"><div class="ttname"><a href="classSolutionTransfer.html">SolutionTransfer</a></div><div class="ttdef"><b>Definition:</b> <a href="numerics_2solution__transfer_8h_source.html#l00277">solution_transfer.h:277</a></div></div>
<div class="ttc" id="afe__system__0_8txt_html_aec4ff0d63baa29c5fcf5471aef3241f6"><div class="ttname"><a href="fe__system__0_8txt.html#aec4ff0d63baa29c5fcf5471aef3241f6">face_no</a></div><div class="ttdeci">we then get the vector from this temporary object immediately to pass it to the constructor of[2.x.69] destructor is called at the end of the entire expression(after the constructor of[2.x.70] has finished) and destroys the elements of the temporary vector. Voila calls[2.x.169] if&lt; tt &gt; face_no</div><div class="ttdef"><b>Definition:</b> <a href="fe__system__0_8txt_source.html#l00178">fe_system_0.txt:178</a></div></div>
<div class="ttc" id="ageometry__info__0_8txt_html_a30a552b07accf65da90f851e25d14d1c"><div class="ttname"><a href="geometry__info__0_8txt.html#a30a552b07accf65da90f851e25d14d1c">dim</a></div><div class="ttdeci">3, where it offers following possibilities:a face(quad) being refined in x- or y-direction(in the face-intern coordinate system) separately,([2.x.79] or([2.x.80] which corresponds to([2.x.81]). Additionally, it offers the possibilities a face can have through repeated anisotropic refinement steps performed on one of the two neighboring cells. It might be possible for example, that a face(quad) is refined with[2.x.82] and afterwards the left child is again refined with[2.x.83], so that there are three active subfaces. Note, however, that only refinement cases are allowed such that each line on a face between two hexes has not more than one hanging node. Furthermore, it is not allowed that two neighboring hexes are refined such that one of the hexes refines the common face with[2.x.84] and the other hex refines that face with[2.x.85] . In fact,[2.x.86] takes care of this situation and ensures that each face of a refined cell is completely contained in a single face of neighboring cells. The following drawings explain the SubfacePossibilities and give the corresponding subface numbers:*[1.x.4] **[2.x.87] *[0.x.68] *Possible cases of faces being subdivided into subface. See documentation to the SubfacePossibilities&lt; 3 &gt; for more details on the subface possibilities. *[0.x.69] *A class that provides all possible cases a face(in the current space dimension[2.x.88] might be subdivided into subfaces. *[2.x.89] *[0.x.70] *Constructor. Take and store a value indicating a particular subface possibility in the list of possible situations specified in the base class. *[0.x.71] *Return the numeric value stored by this class. While the presence of this operator might seem dangerous, it is useful in cases where one would like to have code like&lt; code &gt;switch(subface_case)... case[2.x.90] ...&lt;/code &gt;, which can be written as&lt; code &gt;switch[2.x.91] Another application is to use an object of the current type as an index into an array dim</div><div class="ttdef"><b>Definition:</b> <a href="geometry__info__0_8txt_source.html#l00202">geometry_info_0.txt:202</a></div></div>
<div class="ttc" id="aclassFEValuesBase_html_ae41b67cfd48e02f6035e39c84f0fb47a"><div class="ttname"><a href="classFEValuesBase.html#ae41b67cfd48e02f6035e39c84f0fb47a">FEValuesBase&lt; dim, dim &gt;::get_quadrature_points</a></div><div class="ttdeci">const std::vector&lt; Point&lt; spacedim &gt; &gt; &amp; get_quadrature_points() const</div></div>
<div class="ttc" id="aA-headers_2exceptions__0_8txt_html_af85863b31be0cbd660acba99051e0634"><div class="ttname"><a href="A-headers_2exceptions__0_8txt.html#af85863b31be0cbd660acba99051e0634">data</a></div><div class="ttdeci">****This module contains classes that are used in the exception mechanism of deal II **Exceptions are used in two different not in static assertions are typically used to check that parameters to functions satisfy certain that internal data structures are and similar assertions For static assertions are used to make sure that two vectors that are added together have the same number of components **everything else would not make any sense anyway *Such checks are performed by the[2.x.3] macro in several thousand places within the library several tutorial programs starting with[2.x.4] show how to do this *If static a assertion is the exception mechanism generates an exception of a type that indicates what exactly goes wrong displays appropriate information including the exact location where the problem was detected and then aborts the program **if you try to add two vectors of different there is nothing that can be done within the program to cope with the you have to go fix the program code instead There is generally not even a reason to[2.x.5] an exception object using the usual C exception mechanism because there is nothing a function higher up could do in such cases to rectify the situation and deal with it in a useful way **it s not that the program received bad data</div><div class="ttdef"><b>Definition:</b> <a href="A-headers_2exceptions__0_8txt_source.html#l00015">exceptions_0.txt:15</a></div></div>
<div class="ttc" id="aclassDynamicSparsityPattern_html"><div class="ttname"><a href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2dynamic__sparsity__pattern_8h_source.html#l00340">dynamic_sparsity_pattern.h:340</a></div></div>
<div class="ttc" id="anamespaceStep20_1_1PrescribedSolution_html_a6142e18d25af27882714d1787af4ee59"><div class="ttname"><a href="namespaceStep20_1_1PrescribedSolution.html#a6142e18d25af27882714d1787af4ee59">Step20::PrescribedSolution::alpha</a></div><div class="ttdeci">constexpr double alpha</div><div class="ttdef"><b>Definition:</b> <a href="step-20_8cc_source.html#l00087">step-20.cc:87</a></div></div>
<div class="ttc" id="aclassFEValuesBase_html_abade89efb068b71b7ced7082012a2441"><div class="ttname"><a href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">FEValuesBase&lt; dim, dim &gt;::JxW</a></div><div class="ttdeci">double JxW(const unsigned int quadrature_point) const</div></div>
<div class="ttc" id="adofs_2dof__tools_8h_html"><div class="ttname"><a href="dofs_2dof__tools_8h.html">dof_tools.h</a></div></div>
<div class="ttc" id="astructStep33_1_1EulerEquations_html_a2070ab9564d2cc45fe65357c1bc914e8"><div class="ttname"><a href="structStep33_1_1EulerEquations.html#a2070ab9564d2cc45fe65357c1bc914e8">Step33::EulerEquations::gas_gamma</a></div><div class="ttdeci">static const double gas_gamma</div><div class="ttdef"><b>Definition:</b> <a href="step-33_8cc_source.html#l00104">step-33.cc:104</a></div></div>
<div class="ttc" id="agrid_2grid__refinement_8h_html"><div class="ttname"><a href="grid_2grid__refinement_8h.html">grid_refinement.h</a></div></div>
<div class="ttc" id="afe_2fe__system_8h_html"><div class="ttname"><a href="fe_2fe__system_8h.html">fe_system.h</a></div></div>
<div class="ttc" id="agrid_2grid__out_8h_html"><div class="ttname"><a href="grid_2grid__out_8h.html">grid_out.h</a></div></div>
<div class="ttc" id="avector__valued__0_8txt_html_a2b24e414d1a0d32deea919c5e8899811"><div class="ttname"><a href="vector__valued__0_8txt.html#a2b24e414d1a0d32deea919c5e8899811">x</a></div><div class="ttdeci">([1.x.8]&lt; sub &gt;1&lt;/sub &gt;, [1.x.9]&lt; sub &gt;2&lt;/sub &gt;, [1.x.10]&lt; sub &gt;3&lt;/sub &gt;)&lt; sup &gt;T&lt;/sup &gt; and[1.x.11] accordingly. Then, we can write the simplified equation in coordinates as[1.x.12] We see, that this is just three copies of the bilinear form of the Laplacian, one applied to each component(this is where the formulation with the[2.x.33] is more exciting, and we want to derive a framework that applies to that one as well). We can make this weak form a system of differential equations again by choosing special test functions:first, choose[1.x.13]=([1.x.14]&lt; sub &gt;1&lt;/sub &gt;, 0, 0)&lt; sup &gt;T&lt;/sup &gt;, then[1.x.15]=(0, [1.x.16]&lt; sub &gt;2&lt;/sub &gt;, 0)&lt; sup &gt;T&lt;/sup &gt;, and finally[1.x.17]=(0, 0, [1.x.18]&lt; sub &gt;3&lt;/sub &gt;)&lt; sup &gt;T&lt;/sup &gt;. writing the outcomes below each other, we obtain the system[1.x.19] where we used the standard inner product notation[2.x.34] . It is important for our understanding, that we keep in mind that the latter form as a system of PDE is completely equivalent to the original definition of the bilinear form[1.x.20]([1.x.21], [1.x.22]), which does not immediately exhibit this system structure. Let us close by writing the full system of the elastic equation with symmetric gradient[1.x.23]:[1.x.24] Very formally, if we believe in operator valued matrices, we can rewrite this in the form[1.x.25]&lt; sup &gt;T&lt;/sup &gt;[1.x.26]=[1.x.27]&lt; sup &gt;T&lt;/sup &gt;[1.x.28] or[1.x.29] *[1.x.30] Now, let us consider a more complex example, the mixed Laplace equations discussed in[2.x.35] in three dimensions:[1.x.31] **Here, we have four solution components:the scalar pressure[2.x.36] and the vector-valued velocity[2.x.37] with three vector components. Note as important difference to the previous example, that the vector space[1.x.32] is not just simply a copy of three identical spaces/*A systematic way to get a weak or variational form for this and other vector problems is to first consider it as a problem where the operators and solution variables are written in vector and matrix form. For the example, this would read as follows:[1.x.33] **This makes it clear that the solution[1.x.34] *indeed has four components. We note that we could change the ordering of the solution components[2.x.38] and[2.x.39] inside[2.x.40] if we also change columns of the matrix operator.*Next, we need to think about test functions[2.x.41] . We want to multiply both sides of the equation with them, then integrate over[2.x.42] . The result should be a scalar equality. We can achieve this by choosing[2.x.43] also vector valued as[1.x.35] **It is convenient to multiply the matrix-vector equation by the test function from the left, since this way we automatically get the correct matrix later on(in the linear system, the matrix is also multiplied from the right with the solution variable, not from the left), whereas if we multiplied from the right then the matrix so assembled is the transpose of the one we really want. *With this in mind, let us multiply by[2.x.44] and integrate to get the following equation which has to hold for all test functions[2.x.45] :[1.x.36] *or equivalently:[1.x.37] ***We get the final form by integrating by part the second term:[1.x.38] **It is this form that we will later use in assembling the discrete weak form into a matrix and a right hand side vector:the form in which we have solution and test functions[2.x.46] that each consist of a number of vector components that we can extract. **[2.x.47] VVFEs[1.x.39] *Once we have settled on a bilinear form and a functional setting, we need to find a way to describe the vector-valued finite element spaces from which we draw solution and test functions. This is where the FESystem class comes in:it composes vector-valued finite element spaces from simpler ones. In the example of the elasticity problem, we need[2.x.48] copies of the same element, for instance **[1.x.40] *This will generate a vector valued space of dimension[2.x.49], where each component is a continuous bilinear element of type FE_Q. It will have[2.x.50] times as many basis functions as the corresponding FE_Q, and each of these basis functions is a basis function of FE_Q, lifted into one of the components of the vector. *For the mixed Laplacian, the situation is more complex. First, we have to settle on a pair of discrete spaces[2.x.51] . One option would be the stable Raviart-Thomas pair **[1.x.41] *The first element in this system is already a vector valued element of dimension[2.x.52], while the second is a regular scalar element. *Alternatively to using the stable Raviart-Thomas pair, we could consider a stabilized formulation for the mixed Laplacian, for instance the LDG method. There, we have the option of using the same spaces for velocity components and pressure, namely **[1.x.42] *This system just has[2.x.53] equal copies of the same discontinuous element, which not really reflects the structure of the system. Therefore, we prefer **[1.x.43] *Here, we have a system of two elements, one vector-valued and one scalar, very much like with the[2.x.54] . Indeed, in many codes, the two can be interchanged. This element also allows us easily to switch to an LDG method with lower order approximation in the velocity, namely **[1.x.44] *It must be pointed out, that this element is different from **[1.x.45] *While the constructor call is very similar to[2.x.55], the result actually resembles more[2.x.56] in that this element produces[2.x.57] independent components. A more detailed comparison of the resulting FESystem objects is below. *[1.x.46] *FESystem has a few internal variables which reflect the internal structure set up by the constructor. These can then also be used by application programs to give structure to matrix assembling and linear algebra. We give the names and values of these variables for the examples above in the following table:&lt; table border=&quot;1&quot;&gt;&lt; tr &gt;&lt; th &gt;System Element&lt;/th &gt;[2.x.58][2.x.59][2.x.60]&lt;/tr &gt;&lt; tr &gt;&lt; td &gt;[2.x.61]&lt;/td &gt;&lt; td &gt;1&lt;/td &gt;&lt;/tr &gt;&lt; tr &gt;&lt; td &gt;[2.x.62]&lt;/td &gt;&lt; td &gt;2&lt;/td &gt;&lt;/tr &gt;&lt; tr &gt;&lt; td &gt;[2.x.63]&lt;/td &gt;&lt; td &gt;2&lt;/td &gt;&lt;/tr &gt;&lt; tr &gt;&lt; td &gt;[2.x.64]&lt;/td &gt;&lt; td &gt;1&lt;/td &gt;&lt;/tr &gt;&lt; tr &gt;&lt; td &gt;[2.x.65]&lt;/td &gt;&lt; td &gt;2&lt;/td &gt;&lt;/tr &gt;&lt;/table &gt; *From this table, it is clear that the FESystem reflects a lot of the structure of the system of differential equations in the cases of the[2.x.66] and the[2.x.67], in that we have a vector valued and a scalar variable. On the other hand, the convoluted elements do not have this structure and we have to reconstruct it somehow when assembling systems, as described below. *At this point, it is important to note that nesting of two FESystem object can give the whole FESystem a richer structure than just concatenating them. This structure can be exploited by application programs, but is not automatically so. *[2.x.68] VVAssembling[1.x.47] The next step is to assemble the linear system. How to do this for the simple case of a scalar problem has been shown in many tutorial programs, starting with[2.x.69] . Here we will show how to do it for vector problems. Corresponding to the different characterizations of weak formulations above and the different system elements created, we have a few options which are outlined below. *The whole concept is probably best explained by showing an example illustrating how the local contribution of a cell to the weak form of above mixed Laplace equations could be assembled. *[1.x.48] This is essentially how[2.x.70] does it:**[1.x.49] **So here 's what is happening:[2.x.71][2.x.72] The first thing we do is to declare &quot;extractors&quot;(see the FEValuesExtractors namespace). These are objects that don 't do much except store which components of a vector-valued finite element constitute a single scalar component, or a tensor of rank 1(i.e. what we call a &quot;physical vector&quot;, always consisting of[2.x.73] components). Here, we declare an object that represents the velocities consisting of[2.x.74] components starting at component zero, and the extractor for the pressure, which is a scalar component at position[2.x.75] . *[2.x.76] We then do our usual loop over all cells, shape functions, and quadrature points. In the innermost loop, we compute the local contribution of a pair of shape functions to the global matrix and right hand side vector. Recall that the cell contributions to the bilinear form(i.e. neglecting boundary terms) looked as follows, based on shape functions[2.x.77] :[1.x.50] *whereas the implementation looked like this:*[1.x.51] *The similarities are pretty obvious. *[2.x.78] Essentially, what happens in above code is this:when you do[2.x.79], a so-called &quot;view&quot; is created, i.e. an object that unlike the full FEValues object represents not all components of a finite element, but only the one(s) represented by the extractor object[2.x.80] or[2.x.81] . *[2.x.82] These views can then be asked for information about these individual components. For example, when you write[2.x.83] you get the value of the pressure component of the[2.x.84] th shape function[2.x.85] at the[2.x.86] th quadrature point. Because the extractor[2.x.87] represents a scalar component, the results of the operator[2.x.88] is a scalar number. On the other hand, the call[2.x.89] would produce the value of a whole set of[2.x.90] components, which would be of type[2.x.91] . *[2.x.92] Other things that can be done with views is to ask for the gradient of a particular shape function 's components described by an extractor. For example,[2.x.93] would represent the gradient of the scalar pressure component, which is of type[2.x.94], whereas the gradient of the velocities components,[2.x.95] is a[2.x.96], i.e. a matrix[2.x.97] that consists of entries[2.x.98] . Finally, both scalar and vector views can be asked for the second derivatives(&quot;Hessians&quot;) and vector views can be asked for the symmetric gradient, defined as[2.x.99] as well as the divergence[2.x.100] .[2.x.101] Other examples of using extractors and views are shown in tutorial programs[2.x.102],[2.x.103],[2.x.104] and several other programs. ***[2.x.105] In the current context, when we talk about a vector(for example in extracting the velocity components above), we mean the word in the sense physics uses it:it has[2.x.106] components that behave in specific ways under coordinate system transformations. Examples include velocity or displacement fields. This is opposed to how mathematics uses the word &quot;vector&quot;(and how we use this word in other contexts in the library, for example in the Vector class), where it really stands for a collection of numbers. An example of this latter use of the word could be the set of concentrations of chemical species in a flame x</div><div class="ttdef"><b>Definition:</b> <a href="vector__valued__0_8txt_source.html#l00090">vector_valued_0.txt:90</a></div></div>
<div class="ttc" id="agrid__generator__0_8txt_html_ad40779ba24977c5f641bfa6ac51032ab"><div class="ttname"><a href="grid__generator__0_8txt.html#ad40779ba24977c5f641bfa6ac51032ab">indicator</a></div><div class="ttdeci">namespace provides a collection of functions for generating triangulations for some basic geometries *Some of these functions receive a parts of the boundary receive different[2.x.2] boundary indicators allowing them to be distinguished for the purpose of evaluating different boundary conditions *If the domain is each of the domain parts that should be refined by following an appropriate Manifold description will receive a different[2.x.3] manifold indicator</div><div class="ttdef"><b>Definition:</b> <a href="grid__generator__0_8txt_source.html#l00004">grid_generator_0.txt:4</a></div></div>
<div class="ttc" id="aclassQGauss_html"><div class="ttname"><a href="classQGauss.html">QGauss</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2quadrature__lib_8h_source.html#l00039">quadrature_lib.h:39</a></div></div>
<div class="ttc" id="aparsed__convergence__table__0_8txt_html_a2c7b85beed973f20ac73d33d8bbe8a57"><div class="ttname"><a href="parsed__convergence__table__0_8txt.html#a2c7b85beed973f20ac73d33d8bbe8a57">false</a></div><div class="ttdeci">compute_rate If set to then this column will be included in the list of columns for which error rates are computed You may want to set this to false if you want to compute error rates with respect to this column In this you should also specify[2.x.28] as the rate key in the parameter file **Difference between two solutions in the same vector space **Same as with a non default mapping **Write the error table to the[2.x.29] no output is written **Add rates to the output table **Names of the solution components **Same as but containing repeated component names only once **Masks for each unique component name **Additional methods to call when adding rows to the table **Type of error to compute per components **Exponent to use in p norm types **The actual table **Extra columns to add to the table **The name of column with respect to which we compute convergence rates **Reduction rate mode See[2.x.30] for a documentation **The precision used to output the table **Filename to use when writing to file **Compute the error If this is false</div><div class="ttdef"><b>Definition:</b> <a href="parsed__convergence__table__0_8txt_source.html#l00093">parsed_convergence_table_0.txt:93</a></div></div>
<div class="ttc" id="anamespaceEuler__DG_html_ae1cc4c5ec49b9998f5dc924707c29ed4"><div class="ttname"><a href="namespaceEuler__DG.html#ae1cc4c5ec49b9998f5dc924707c29ed4">Euler_DG::final_time</a></div><div class="ttdeci">constexpr double final_time</div><div class="ttdef"><b>Definition:</b> <a href="step-67_8cc_source.html#l00067">step-67.cc:67</a></div></div>
<div class="ttc" id="apolynomial__space__0_8txt_html_a03a2f48682e29e39f7bccc11a7d1c4d1"><div class="ttname"><a href="polynomial__space__0_8txt.html#a03a2f48682e29e39f7bccc11a7d1c4d1">degree</a></div><div class="ttdeci">*Representation of the space of polynomials of degree at most n in higher dimensions *Given a vector of[1.x.0] one dimensional polynomials[1.x.1] where[1.x.3] has degree[1.x.4]</div><div class="ttdef"><b>Definition:</b> <a href="polynomial__space__0_8txt_source.html#l00003">polynomial_space_0.txt:3</a></div></div>
<div class="ttc" id="aclassFiniteElement_html_ab275cbead21bb11b1208222b6d662357"><div class="ttname"><a href="classFiniteElement.html#ab275cbead21bb11b1208222b6d662357">FiniteElement::has_support_on_face</a></div><div class="ttdeci">virtual bool has_support_on_face(const unsigned int shape_index, const unsigned int face_index) const</div><div class="ttdef"><b>Definition:</b> <a href="fe_8cc_source.html#l01154">fe.cc:1154</a></div></div>
<div class="ttc" id="abase_2quadrature__lib_8h_html"><div class="ttname"><a href="base_2quadrature__lib_8h.html">quadrature_lib.h</a></div></div>
<div class="ttc" id="aautomatic__and__symbolic__differentiation__0_8txt_html_a96ecfde131843f52ee49d0e0c1180134"><div class="ttname"><a href="automatic__and__symbolic__differentiation__0_8txt.html#a96ecfde131843f52ee49d0e0c1180134">time</a></div><div class="ttdeci">computing derivatives of these terms is impractical in most applications in impossible to get right Higher derivatives are even more impossible to do without computer aid Automatic or symbolic differentiation is a way out of and gets compile time</div><div class="ttdef"><b>Definition:</b> <a href="automatic__and__symbolic__differentiation__0_8txt_source.html#l00012">automatic_and_symbolic_differentiation_0.txt:12</a></div></div>
<div class="ttc" id="anamespaceEvaluationFlags_html_a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f"><div class="ttname"><a href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeade3f4c40082ead56c7aef5e90e43242f">EvaluationFlags::values</a></div><div class="ttdeci">@ values</div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_2evaluation__flags_8h_source.html#l00055">evaluation_flags.h:55</a></div></div>
<div class="ttc" id="afe__dgp__nonparametric__0_8txt_html_a8290746300287635d0fe47e4071ea1ef"><div class="ttname"><a href="fe__dgp__nonparametric__0_8txt.html#a8290746300287635d0fe47e4071ea1ef">constant</a></div><div class="ttdeci">*Discontinuous finite elements evaluated at the mapped quadrature points yet Don t use it *This finite element implements complete polynomial that dimensional polynomials of order *[2.x.1] The polynomials are not mapped they are constant</div><div class="ttdef"><b>Definition:</b> <a href="fe__dgp__nonparametric__0_8txt_source.html#l00005">fe_dgp_nonparametric_0.txt:5</a></div></div>
<div class="ttc" id="aclassVector_html_af34b888fe493ef2ed188179de69ad7ed"><div class="ttname"><a href="classVector.html#af34b888fe493ef2ed188179de69ad7ed">Vector::begin</a></div><div class="ttdeci">iterator begin()</div></div>
<div class="ttc" id="aclassFESubfaceValues_html"><div class="ttname"><a href="classFESubfaceValues.html">FESubfaceValues&lt; dim &gt;</a></div></div>
<div class="ttc" id="afe__evaluation__0_8txt_html_a8f384576a64c89a6fa8352847523e340"><div class="ttname"><a href="fe__evaluation__0_8txt.html#a8f384576a64c89a6fa8352847523e340">n_q_points</a></div><div class="ttdeci">FE_Q with hanging node constraints connects to more neighbors than a FE_DGQ for and cells which need data exchange are put in different positions inside the cell loop Of if the exact same and then the order is going to be the same because the algorithm is deterministic *dim Dimension in which this class is to be used *fe_degree Degree of the tensor product finite element with fe_degree degrees of freedom per coordinate direction Can be set to **if the degree is not known at compile but performance will usually be worse by a factor of *n_q_points_1d Number of points in the quadrature formula defaults to fe_degree *n_components Number of vector components when solving a system of PDEs If the same operation is applied to several components of a they can be applied simultaneously with one usually[2.x.339] or[2.x.340] Defaults to[2.x.341] double ******An alias to the base class **An underlying number type specified as template argument **The type of function e g VectorizedArrayType for e g Tensor&lt; 1, dim, VectorizedArrayType &gt; for n_q_points</div><div class="ttdef"><b>Definition:</b> <a href="fe__evaluation__0_8txt_source.html#l00537">fe_evaluation_0.txt:537</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga31978c026b8b6b5116df30b8e748f6b7"><div class="ttname"><a href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">StandardExceptions::ExcInternalError</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcInternalError()</div></div>
<div class="ttc" id="anamespaceStep56_html_a3c2f04c8033af75ffedd7bfbf96640a1"><div class="ttname"><a href="namespaceStep56.html#a3c2f04c8033af75ffedd7bfbf96640a1">Step56::SolverType</a></div><div class="ttdeci">SolverType</div><div class="ttdef"><b>Definition:</b> <a href="step-56_8cc_source.html#l00075">step-56.cc:75</a></div></div>
<div class="ttc" id="aclassQMidpoint_html"><div class="ttname"><a href="classQMidpoint.html">QMidpoint</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2quadrature__lib_8h_source.html#l00093">quadrature_lib.h:93</a></div></div>
<div class="ttc" id="afe_2fe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85"><div class="ttname"><a href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a></div><div class="ttdeci">@ update_JxW_values</div><div class="ttdoc">Transformed quadrature weights.</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__update__flags_8h_source.html#l00124">fe_update_flags.h:124</a></div></div>
<div class="ttc" id="astructStep33_1_1EulerEquations_html_a3b7415438757860701ee1e3ede1ee6ae"><div class="ttname"><a href="structStep33_1_1EulerEquations.html#a3b7415438757860701ee1e3ede1ee6ae">Step33::EulerEquations::n_components</a></div><div class="ttdeci">static const unsigned int n_components</div><div class="ttdef"><b>Definition:</b> <a href="step-33_8cc_source.html#l00073">step-33.cc:73</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga70a0bb353656e704acf927945277bbc6"><div class="ttname"><a href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a></div><div class="ttdeci">#define Assert(cond, exc)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2exceptions_8h_source.html#l01581">exceptions.h:1581</a></div></div>
<div class="ttc" id="abase_2conditional__ostream_8h_html"><div class="ttname"><a href="base_2conditional__ostream_8h.html">conditional_ostream.h</a></div></div>
<div class="ttc" id="aautomatic__and__symbolic__differentiation__0_8txt_html_afc7bd61123bcefecf640866d9e92d9c6"><div class="ttname"><a href="automatic__and__symbolic__differentiation__0_8txt.html#afc7bd61123bcefecf640866d9e92d9c6">point</a></div><div class="ttdeci">and situations where one is given a parameter dependent problem[2.x.4] and wants to form derivatives with regards to the for example to optimize an output functional with regards or for a sensitivity analysis with regards to[2.x.7] One should think of[2.x.8] as design the width or shape of a the stiffness coefficients of a material chosen to build an the power sent to a the chemical composition of the gases sent to a burner In all of these one should think of[2.x.9] and[2.x.10] as[1.x.0] and cumbersome to differentiate **at least when doing it by hand A relatively simple case of a nonlinear problem that already highlights the tedium of computing derivatives by hand is shown in[2.x.11] in one for think about problems such as chemically reactive flows where the fluid equations have coefficients such as the density and viscosity that depend strongly and nonlinearly on the chemical and pressure of the fluid at each point</div><div class="ttdef"><b>Definition:</b> <a href="automatic__and__symbolic__differentiation__0_8txt_source.html#l00012">automatic_and_symbolic_differentiation_0.txt:12</a></div></div>
<div class="ttc" id="aclassFEValuesBase_html_ade22ffd9fb5b07842daa504929244aa7"><div class="ttname"><a href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">FEValuesBase&lt; dim, dim &gt;::get_fe</a></div><div class="ttdeci">const FiniteElement&lt; dim, spacedim &gt; &amp; get_fe() const</div></div>
<div class="ttc" id="aautomatic__and__symbolic__differentiation__0_8txt_html_a680d8b0d6d9162296d224196cfd47028"><div class="ttname"><a href="automatic__and__symbolic__differentiation__0_8txt.html#a680d8b0d6d9162296d224196cfd47028">parameters</a></div><div class="ttdeci">and situations where one is given a parameter dependent problem[2.x.4] and wants to form derivatives with regards to the parameters[2.x.5]</div><div class="ttdef"><b>Definition:</b> <a href="automatic__and__symbolic__differentiation__0_8txt_source.html#l00010">automatic_and_symbolic_differentiation_0.txt:10</a></div></div>
<div class="ttc" id="aclassStep33_1_1EulerEquations_1_1Postprocessor_html_adae3bcb8efa74ec959ac0c065c8eea9b"><div class="ttname"><a href="classStep33_1_1EulerEquations_1_1Postprocessor.html#adae3bcb8efa74ec959ac0c065c8eea9b">Step33::EulerEquations::Postprocessor::Postprocessor</a></div><div class="ttdeci">Postprocessor(const bool do_schlieren_plot)</div><div class="ttdef"><b>Definition:</b> <a href="step-33_8cc_source.html#l00344">step-33.cc:344</a></div></div>
<div class="ttc" id="aclassStep33_1_1ConservationLaw_html"><div class="ttname"><a href="classStep33_1_1ConservationLaw.html">Step33::ConservationLaw</a></div><div class="ttdef"><b>Definition:</b> <a href="step-33_8cc_source.html#l00930">step-33.cc:930</a></div></div>
<div class="ttc" id="abase_2ndarray_8h_html_a82399009710c9549884b9d8c506ad695"><div class="ttname"><a href="base_2ndarray_8h.html#a82399009710c9549884b9d8c506ad695">ndarray</a></div><div class="ttdeci">typename internal::ndarray::HelperArray&lt; T, Ns... &gt;::type ndarray</div><div class="ttdef"><b>Definition:</b> <a href="base_2ndarray_8h_source.html#l00117">ndarray.h:117</a></div></div>
<div class="ttc" id="afe_2mapping__q1_8h_html"><div class="ttname"><a href="fe_2mapping__q1_8h.html">mapping_q1.h</a></div></div>
<div class="ttc" id="abase_2function__parser_8h_html"><div class="ttname"><a href="base_2function__parser_8h.html">function_parser.h</a></div></div>
<div class="ttc" id="aclassDoFHandler_html_ad316958f8045d9a48094335b23a03a53"><div class="ttname"><a href="classDoFHandler.html#ad316958f8045d9a48094335b23a03a53">DoFHandler::clear</a></div><div class="ttdeci">void clear()</div></div>
<div class="ttc" id="adofs_2dof__handler_8h_html"><div class="ttname"><a href="dofs_2dof__handler_8h.html">dof_handler.h</a></div></div>
<div class="ttc" id="aclassGridIn_html"><div class="ttname"><a href="classGridIn.html">GridIn</a></div><div class="ttdef"><b>Definition:</b> <a href="grid_2grid__in_8h_source.html#l00248">grid_in.h:248</a></div></div>
<div class="ttc" id="aclassConditionalOStream_html"><div class="ttname"><a href="classConditionalOStream.html">ConditionalOStream</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2conditional__ostream_8h_source.html#l00083">conditional_ostream.h:83</a></div></div>
<div class="ttc" id="anamespacenumbers_html_a8ae36952c7e0cc778b47b5371b3aeff1"><div class="ttname"><a href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a></div><div class="ttdeci">static const unsigned int invalid_unsigned_int</div><div class="ttdef"><b>Definition:</b> <a href="base_2types_8h_source.html#l00179">types.h:179</a></div></div>
<div class="ttc" id="alac_2vector_8h_html"><div class="ttname"><a href="lac_2vector_8h.html">vector.h</a></div></div>
<div class="ttc" id="aclassFEFaceValuesBase_html"><div class="ttname"><a href="classFEFaceValuesBase.html">FEFaceValuesBase</a></div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values_8h_source.html#l04039">fe_values.h:4039</a></div></div>
<div class="ttc" id="afe__evaluation__0_8txt_html_ad3b9cdeadeb3bcdb52af5db70c041a6e"><div class="ttname"><a href="fe__evaluation__0_8txt.html#ad3b9cdeadeb3bcdb52af5db70c041a6e">fe</a></div><div class="ttdeci">FE_Q with hanging node constraints connects to more neighbors than a FE_DGQ for and cells which need data exchange are put in different positions inside the cell loop Of if the exact same and then the order is going to be the same because the algorithm is deterministic *dim Dimension in which this class is to be used *fe_degree Degree of the tensor product finite element with fe_degree degrees of freedom per coordinate direction Can be set to **if the degree is not known at compile but performance will usually be worse by a factor of *n_q_points_1d Number of points in the quadrature formula defaults to fe_degree *n_components Number of vector components when solving a system of PDEs If the same operation is applied to several components of a they can be applied simultaneously with one usually[2.x.339] or[2.x.340] Defaults to[2.x.341] double ******An alias to the base class **An underlying number type specified as template argument **The type of function e g VectorizedArrayType for e g Tensor&lt; 1, dim, VectorizedArrayType &gt; for can be different if such as FE_DGP **static The number of degrees of freedom of all components determined from the given template argument fe_degree Note that the actual number of degrees of freedom dofs_per_cell can be different if such as FE_DGP **static The number of degrees of freedom of all components determined from the given template argument fe_degree Note that the actual number of degrees of freedom dofs_per_cell can be different if such as FE_DGP **Constructor Takes all data stored in MatrixFree If applied to problems with more than one finite element or more than one quadrature formula selected during construction of[2.x.343] the appropriate component can be selected by the optional arguments[2.x.344] matrix_free Data object that contains all data[2.x.345] dof_no If matrix_free was set up with multiple DoFHandler this parameter selects to which DoFHandler AffineConstraints pair the given evaluator should be attached to[2.x.346] quad_no If matrix_free was set up with multiple Quadrature this parameter selects the appropriate number of the quadrature formula[2.x.347] first_selected_component If the dof_handler selected by dof_no uses an FESystem consisting of more than one this parameter allows for selecting the component where the current evaluation routine should start Note that one evaluator does not support combining different shape functions in different components In other the same base element of a FESystem needs to be set for the components between[2.x.348] and[2.x.349][2.x.350] active_fe_index If matrix_free was set up with DoFHandler objects with[2.x.351] this parameter selects to which DoFHandler AffineConstraints pair the given evaluator should be attached to[2.x.352] active_quad_index If matrix_free was set up with[2.x.353] this parameter selects the appropriate number of the quadrature formula **Constructor Takes all data stored in MatrixFree for a given cell which allows to automatically identify the active_fe_index and active_quad_index in case of a p adaptive strategy The rest of the arguments are the same as in the constructor above **Constructor that comes with reduced functionality and works similar as FEValues The arguments are similar to the ones passed to the constructor of with the notable difference that FEEvaluation expects a one dimensional quadrature instead of a[2.x.354] dimensional one The finite element can be both scalar or vector but this method always only selects a scalar base element at a the optional argument[2.x.356] allows to specify the index of the base element to be used for evaluation Note that the internal data structures always assume that the base element is non primitive are not supported currently As known from a call to the reinit method with a[2.x.357] is necessary to make the geometry and degrees of freedom of the current class known::If the iterator includes DoFHandler the initialization allows to also read from or write to vectors in the standard way for[2.x.359] types for one cell at a time this approach is much slower than the path with MatrixFree with MPI since index translation has to be done As only one cell at a time is this method does not vectorize over several but only possibly within the element if the evaluate integrate routines are combined inside user an object of type i the underlying mapping and quadrature points do only need to be evaluated once Make sure to not pass an optional object around when you intend to use the FEEvaluation object in parallel to the given one because otherwise the intended sharing may create race conditions **Copy constructor If FEEvaluationBase was constructed from a fe</div><div class="ttdef"><b>Definition:</b> <a href="fe__evaluation__0_8txt_source.html#l00555">fe_evaluation_0.txt:555</a></div></div>
<div class="ttc" id="alac_2trilinos__sparse__matrix_8h_html"><div class="ttname"><a href="lac_2trilinos__sparse__matrix_8h.html">trilinos_sparse_matrix.h</a></div></div>
<div class="ttc" id="aclassFEValuesBase_html_a807c3049bfe81743fc0f237dfc2fbdea"><div class="ttname"><a href="classFEValuesBase.html#a807c3049bfe81743fc0f237dfc2fbdea">FEValuesBase&lt; dim, dim &gt;::n_quadrature_points</a></div><div class="ttdeci">const unsigned int n_quadrature_points</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values_8h_source.html#l02405">fe_values.h:2405</a></div></div>
<div class="ttc" id="aglobal__dof__index__0_8txt_html_a2b84b1d42e4fde15bdf79726ce1cc907"><div class="ttname"><a href="global__dof__index__0_8txt.html#a2b84b1d42e4fde15bdf79726ce1cc907">normal</a></div><div class="ttdeci">**deal II can be configured to use bit indices for degrees of rather than the usual unsigned integers that default to bit on most current systems This is necessary since we want to be able to solve problems with more than billion we do not want to indiscriminately replace all integers in deal II with bit since this would increase memory use in many places where we represent quantities that will most definitely not be larger than billion *The data type we define for these indices to keep the bulk of the code base free of[2.x.1] s is[2.x.2] If deal II is configured as normal</div><div class="ttdef"><b>Definition:</b> <a href="global__dof__index__0_8txt_source.html#l00004">global_dof_index_0.txt:4</a></div></div>
<div class="ttc" id="aclassParameterHandler_html"><div class="ttname"><a href="classParameterHandler.html">ParameterHandler</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2parameter__handler_8h_source.html#l00820">parameter_handler.h:820</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_af29c20cde6d44186806d559beb468696"><div class="ttname"><a href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">ParameterHandler::enter_subsection</a></div><div class="ttdeci">void enter_subsection(const std::string &amp;subsection)</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00939">parameter_handler.cc:939</a></div></div>
<div class="ttc" id="aclassDataPostprocessor_html_aadecdd040447b395164397ea1196f721"><div class="ttname"><a href="classDataPostprocessor.html#aadecdd040447b395164397ea1196f721">DataPostprocessor::get_needed_update_flags</a></div><div class="ttdeci">virtual UpdateFlags get_needed_update_flags() const =0</div></div>
<div class="ttc" id="adata__postprocessor__0_8txt_html_abfdf708e97518fa7ad2b849b80afddc1"><div class="ttname"><a href="data__postprocessor__0_8txt.html#abfdf708e97518fa7ad2b849b80afddc1">get_needed_update_flags</a></div><div class="ttdeci">is not the size of the solution then if the solution is real valued the solution_values variable below will be an array with as many entries as there are evaluation points on a and each entry is a vector of length[2.x.31] representing the[2.x.32] solution functions evaluated at a point On the other if the solution is complex then the solution_values member variable of this class will have[2.x.34] entries for each evaluation point The first[2.x.35] of these entries represent the real parts of the and the second[2.x.36] entries correspond to the imaginary parts of the solution evaluated at the evaluation point The same layout is used for the solution_gradients and solution_hessians then all the gradients Hessians of the imaginary components There is more information about the subject in the documentation of the DataPostprocessor class itself[2.x.37] provides an example of how this class is used in a complex valued situation Through the fields in the CommonInputs base class this class also makes available access to the locations of evaluations points normal and which cell data is currently being evaluated or other object The outer vector runs over the evaluation whereas the inner vector runs over the components of the finite element field for which output will be generated **An array of gradients of a vector valued solution at each of the evaluation points used to create graphical output from one or other object The outer vector runs over the evaluation whereas the inner vector runs over the components of the finite element field for which output will be generated This array is only filled if a user derived class overloads the[2.x.38] and the function a class derived from DataPostprocessorScalar DataPostprocessorVector or DataPostprocessorTensor may pass this flag to the constructor of these three classes **An array of second derivatives of a vector valued solution at each of the evaluation points used to create graphical output from one or other object The outer vector runs over the evaluation whereas the inner vector runs over the components of the finite element field for which output will be generated This array is only filled if a user derived class overloads the[2.x.40] and the function a class derived from DataPostprocessorScalar DataPostprocessorVector or DataPostprocessorTensor may pass this flag to the constructor of these three classes **This class provides an interface to compute derived quantities from a solution that can then be output in graphical formats for visualization using facilities such as the DataOut class *For which are calculated from the values of the solution and possibly the first and second derivatives of the solution Examples are the calculation of Mach numbers from velocity and density in supersonic flow or the computation of the magnitude of a complex valued solution as demonstrated in[2.x.42] the functions of this class can be overloaded to compute new quantities *A data vector and an object of a class derived from the current one can be given to the[2.x.46] in reality the object of your derived class has to live until the DataOut object is destroyed as the latter keeps a pointer to the former and will complain if the object pointed to is destroyed while the latter still has a pointer to it If both the data postprocessor and DataOut objects are variables of a then you can avoid this error by declaring the data postprocessor variable before the DataOut variable as objects are destroyed in reverse order of declaration *In order not to perform needless DataPostprocessor has to provide information which input data is needed for the calculation of the derived i e whether it needs the the first derivative and or the second derivative of the provided data DataPostprocessor objects which are used in combination with a DataOutFaces object can also ask for the normal vectors at each point The information which data is needed has to be provided via the UpdateFlags returned by virtual the function get_needed_update_flags(). It is your responsibility to use only those values which were updated in the calculation of derived quantities. The DataOut object will provide references to the requested data in the call to evaluate_scalar_field() or evaluate_vector_field()(DataOut decides which of the two functions to call depending on whether the finite element in use has only a single</div></div>
<div class="ttc" id="acoding__conventions__0_8txt_html_ac639e1db0b03fc797eca55e266afa976"><div class="ttname"><a href="coding__conventions__0_8txt.html#ac639e1db0b03fc797eca55e266afa976">cell</a></div><div class="ttdeci">functions which clear bits or flags should be named[2.x.15] use[2.x.18] instead of *[2.x.19] In the implementation after each three empty lines are expected to enable better readability One empty line occurs in functions to group blocks of since two empty lines are not enough to visibly distinguish sufficiently that the code belongs to two different functions *[2.x.21] Whenever an integer variable can only assume nonnegative it is marked as unsigned The same applies to functions that can only return positive or zero values it should be marked even if passed by value we mark input parameters as const This aids as an additional documentation tool to clarify the intent of a which is often either involuntarily or poor style *[2.x.25] Whenever a function does not change any of the member variable of the embedding class it should be marked as const  *[2.x.27] Function and variable names may not consist of only one or two unless the variable is a pure counting index *[2.x.29] Type the number of children per cell</div><div class="ttdef"><b>Definition:</b> <a href="coding__conventions__0_8txt_source.html#l00027">coding_conventions_0.txt:27</a></div></div>
<div class="ttc" id="aclassSolverControl_html"><div class="ttname"><a href="classSolverControl.html">SolverControl</a></div><div class="ttdef"><b>Definition:</b> <a href="lac_2solver__control_8h_source.html#l00052">solver_control.h:52</a></div></div>
<div class="ttc" id="aclassFEFaceValues_html"><div class="ttname"><a href="classFEFaceValues.html">FEFaceValues&lt; dim &gt;</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Selection_html"><div class="ttname"><a href="classPatterns_1_1Selection.html">Patterns::Selection</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2patterns_8h_source.html#l00400">patterns.h:400</a></div></div>
<div class="ttc" id="agroup__CPP11_html_gaace8c98aca00e7e48a619bb5e08084aa"><div class="ttname"><a href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">DoFHandler::active_cell_iterators</a></div><div class="ttdeci">IteratorRange&lt; active_cell_iterator &gt; active_cell_iterators() const</div></div>
<div class="ttc" id="aclassPatterns_1_1Anything_html"><div class="ttname"><a href="classPatterns_1_1Anything.html">Patterns::Anything</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2patterns_8h_source.html#l01101">patterns.h:1101</a></div></div>
<div class="ttc" id="anamespaceDataComponentInterpretation_html_a0cd2da3afe902f9004c23a73dbcc8ab0"><div class="ttname"><a href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0">DataComponentInterpretation::DataComponentInterpretation</a></div><div class="ttdeci">DataComponentInterpretation</div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__component__interpretation_8h_source.html#l00048">data_component_interpretation.h:48</a></div></div>
<div class="ttc" id="agrid_2grid__in_8h_html"><div class="ttname"><a href="grid_2grid__in_8h.html">grid_in.h</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a599462cacd492e2f712bf7369507dcff"><div class="ttname"><a href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">ParameterHandler::leave_subsection</a></div><div class="ttdeci">void leave_subsection()</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00953">parameter_handler.cc:953</a></div></div>
<div class="ttc" id="aclassDataPostprocessor_html_a254f38bcdf4bdb5aa94231b695da7d55"><div class="ttname"><a href="classDataPostprocessor.html#a254f38bcdf4bdb5aa94231b695da7d55">DataPostprocessor::get_names</a></div><div class="ttdeci">virtual std::vector&lt; std::string &gt; get_names() const =0</div></div>
<div class="ttc" id="anumerics_2data__out_8h_html"><div class="ttname"><a href="numerics_2data__out_8h.html">data_out.h</a></div></div>
<div class="ttc" id="aclassFiniteElementData_html_a33b522422da89e5c080e7405ad49d7c7"><div class="ttname"><a href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">FiniteElementData::n_dofs_per_cell</a></div><div class="ttdeci">unsigned int n_dofs_per_cell() const</div></div>
<div class="ttc" id="aclassDataOut_html"><div class="ttname"><a href="classDataOut.html">DataOut&lt; dim &gt;</a></div></div>
<div class="ttc" id="aclassVector_html"><div class="ttname"><a href="classVector.html">Vector&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassFESystem_html"><div class="ttname"><a href="classFESystem.html">FESystem&lt; dim &gt;</a></div></div>
<div class="ttc" id="aclassDoFHandler_html_ac1fedeb50b5f03b13d8b69f86e33f726"><div class="ttname"><a href="classDoFHandler.html#ac1fedeb50b5f03b13d8b69f86e33f726">DoFHandler::get_fe</a></div><div class="ttdeci">const FiniteElement&lt; dim, spacedim &gt; &amp; get_fe(const unsigned int index=0) const</div></div>
<div class="ttc" id="agroup__Exceptions_html_gafc0ca7ad85b3ebd64e8e51689ac85caf"><div class="ttname"><a href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a></div><div class="ttdeci">#define AssertThrow(cond, exc)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2exceptions_8h_source.html#l01699">exceptions.h:1699</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a0ddaa05c5463c6c0b7701e18005717a9"><div class="ttname"><a href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">ParameterHandler::parse_input</a></div><div class="ttdeci">virtual void parse_input(std::istream &amp;input, const std::string &amp;filename=&quot;input file&quot;, const std::string &amp;last_line=&quot;&quot;, const bool skip_undefined=false)</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00399">parameter_handler.cc:399</a></div></div>
<div class="ttc" id="anamespaceFEValuesViews_html_af2099b26234f5816729f7f6dc523dc0f"><div class="ttname"><a href="namespaceFEValuesViews.html#af2099b26234f5816729f7f6dc523dc0f">FEValuesViews::View</a></div><div class="ttdeci">typename ::internal::FEValuesViews::ViewType&lt; dim, spacedim, Extractor &gt;::type View</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values_8h_source.html#l02303">fe_values.h:2303</a></div></div>
<div class="ttc" id="aclassFunctionParser_html"><div class="ttname"><a href="classFunctionParser.html">FunctionParser</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2function__parser_8h_source.html#l00246">function_parser.h:246</a></div></div>
<div class="ttc" id="afe_2fe__values__0_8txt_html_a15ff2e0c168966d6ae13c4faabcec165"><div class="ttname"><a href="fe_2fe__values__0_8txt.html#a15ff2e0c168966d6ae13c4faabcec165">dofs_per_cell</a></div><div class="ttdeci">we have to work a bit harder to compute this information **Default constructor Creates an invalid object **Constructor for an object that represents a single scalar component of a FEValuesBase for the shape function and quadrature point selected by the arguments[2.x.27] shape_function Number of the shape function to be evaluated Note that this number runs from zero to dofs_per_cell</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values__0_8txt_source.html#l00073">fe_values_0.txt:73</a></div></div>
<div class="ttc" id="astructDataPostprocessorInputs_1_1Vector_html"><div class="ttname"><a href="structDataPostprocessorInputs_1_1Vector.html">DataPostprocessorInputs::Vector</a></div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__postprocessor_8h_source.html#l00319">data_postprocessor.h:319</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Double_html"><div class="ttname"><a href="classPatterns_1_1Double.html">Patterns::Double</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2patterns_8h_source.html#l00307">patterns.h:307</a></div></div>
<div class="ttc" id="agrid_2grid__generator_8h_html"><div class="ttname"><a href="grid_2grid__generator_8h.html">grid_generator.h</a></div></div>
<div class="ttc" id="anamespaceStep33_html"><div class="ttname"><a href="namespaceStep33.html">Step33</a></div><div class="ttdef"><b>Definition:</b> <a href="step-33_8cc_source.html#l00063">step-33.cc:63</a></div></div>
<div class="ttc" id="aclassDataPostprocessor_html_ae994223acf8a16471ab5e579a4d75053"><div class="ttname"><a href="classDataPostprocessor.html#ae994223acf8a16471ab5e579a4d75053">DataPostprocessor::get_data_component_interpretation</a></div><div class="ttdeci">virtual std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt; get_data_component_interpretation() const</div><div class="ttdef"><b>Definition:</b> <a href="data__postprocessor_8cc_source.html#l00048">data_postprocessor.cc:48</a></div></div>
<div class="ttc" id="afe_2fe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52f"><div class="ttname"><a href="fe_2fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a></div><div class="ttdeci">UpdateFlags</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__update__flags_8h_source.html#l00057">fe_update_flags.h:57</a></div></div>
<div class="ttc" id="aclassDoFHandler_html_aa5b8d3c4b9deb0774dde5c2851e07e1e"><div class="ttname"><a href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">DoFHandler::n_dofs</a></div><div class="ttdeci">types::global_dof_index n_dofs() const</div></div>
<div class="ttc" id="afunction__0_8txt_html_a4f780342f2d5d632f82cf7fd90158a66"><div class="ttname"><a href="function__0_8txt.html#a4f780342f2d5d632f82cf7fd90158a66">size</a></div><div class="ttdeci">it defaults to i e the first component **Return all components of a vector valued function at a given point&lt; tt &gt; values&lt;/tt &gt; shall have the right size i e **Set&lt; tt &gt; values&lt;/tt &gt; to the point values of the specified component of the function at the&lt; tt &gt; points&lt;/tt &gt; It is assumed that&lt; tt &gt; values&lt;/tt &gt; already has the right size</div><div class="ttdef"><b>Definition:</b> <a href="function__0_8txt_source.html#l00052">function_0.txt:52</a></div></div>
<div class="ttc" id="aclassUtilities_1_1MPI_1_1MPI__InitFinalize_html"><div class="ttname"><a href="classUtilities_1_1MPI_1_1MPI__InitFinalize.html">Utilities::MPI::MPI_InitFinalize</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2mpi_8h_source.html#l00836">mpi.h:836</a></div></div>
<div class="ttc" id="acoding__conventions__0_8txt_html_a02f5aa616d7b0799c538fe77d6c6c795"><div class="ttname"><a href="coding__conventions__0_8txt.html#a02f5aa616d7b0799c538fe77d6c6c795">e</a></div><div class="ttdeci">i e</div><div class="ttdef"><b>Definition:</b> <a href="coding__conventions__0_8txt_source.html#l00028">coding_conventions_0.txt:28</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Integer_html"><div class="ttname"><a href="classPatterns_1_1Integer.html">Patterns::Integer</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2patterns_8h_source.html#l00198">patterns.h:198</a></div></div>
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
